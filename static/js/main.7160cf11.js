/*! For license information please see main.7160cf11.js.LICENSE.txt */
(()=>{var __webpack_modules__={4:(t,e,i)=>{"use strict";var n=i(853),r=i(43),s=i(950);function a(t){var e="https://react.dev/errors/"+t;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var i=2;i<arguments.length;i++)e+="&args[]="+encodeURIComponent(arguments[i])}return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(t){return!(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)}var l=Symbol.for("react.element"),h=Symbol.for("react.transitional.element"),c=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),d=Symbol.for("react.strict_mode"),p=Symbol.for("react.profiler"),f=Symbol.for("react.provider"),m=Symbol.for("react.consumer"),g=Symbol.for("react.context"),v=Symbol.for("react.forward_ref"),y=Symbol.for("react.suspense"),b=Symbol.for("react.suspense_list"),x=Symbol.for("react.memo"),w=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var S=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var A=Symbol.for("react.memo_cache_sentinel"),E=Symbol.iterator;function _(t){return null===t||"object"!==typeof t?null:"function"===typeof(t=E&&t[E]||t["@@iterator"])?t:null}var C=Symbol.for("react.client.reference");function M(t){if(null==t)return null;if("function"===typeof t)return t.$$typeof===C?null:t.displayName||t.name||null;if("string"===typeof t)return t;switch(t){case u:return"Fragment";case c:return"Portal";case p:return"Profiler";case d:return"StrictMode";case y:return"Suspense";case b:return"SuspenseList"}if("object"===typeof t)switch(t.$$typeof){case g:return(t.displayName||"Context")+".Provider";case m:return(t._context.displayName||"Context")+".Consumer";case v:var e=t.render;return(t=t.displayName)||(t=""!==(t=e.displayName||e.name||"")?"ForwardRef("+t+")":"ForwardRef"),t;case x:return null!==(e=t.displayName||null)?e:M(t.type)||"Memo";case w:e=t._payload,t=t._init;try{return M(t(e))}catch(i){}}return null}var P,T,D=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,k=Object.assign;function I(t){if(void 0===P)try{throw Error()}catch(i){var e=i.stack.trim().match(/\n( *(at )?)/);P=e&&e[1]||"",T=-1<i.stack.indexOf("\n    at")?" (<anonymous>)":-1<i.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+P+t+T}var R=!1;function O(t,e){if(!t||R)return"";R=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var n={DetermineComponentFrameRoot:function(){try{if(e){var i=function(){throw Error()};if(Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(i,[])}catch(r){var n=r}Reflect.construct(t,[],i)}else{try{i.call()}catch(s){n=s}t.call(i.prototype)}}else{try{throw Error()}catch(a){n=a}(i=t())&&"function"===typeof i.catch&&i.catch((function(){}))}}catch(o){if(o&&n&&"string"===typeof o.stack)return[o.stack,n.stack]}return[null,null]}};n.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var r=Object.getOwnPropertyDescriptor(n.DetermineComponentFrameRoot,"name");r&&r.configurable&&Object.defineProperty(n.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var s=n.DetermineComponentFrameRoot(),a=s[0],o=s[1];if(a&&o){var l=a.split("\n"),h=o.split("\n");for(r=n=0;n<l.length&&!l[n].includes("DetermineComponentFrameRoot");)n++;for(;r<h.length&&!h[r].includes("DetermineComponentFrameRoot");)r++;if(n===l.length||r===h.length)for(n=l.length-1,r=h.length-1;1<=n&&0<=r&&l[n]!==h[r];)r--;for(;1<=n&&0<=r;n--,r--)if(l[n]!==h[r]){if(1!==n||1!==r)do{if(n--,0>--r||l[n]!==h[r]){var c="\n"+l[n].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}}while(1<=n&&0<=r);break}}}finally{R=!1,Error.prepareStackTrace=i}return(i=t?t.displayName||t.name:"")?I(i):""}function L(t){switch(t.tag){case 26:case 27:case 5:return I(t.type);case 16:return I("Lazy");case 13:return I("Suspense");case 19:return I("SuspenseList");case 0:case 15:return t=O(t.type,!1);case 11:return t=O(t.type.render,!1);case 1:return t=O(t.type,!0);default:return""}}function B(t){try{var e="";do{e+=L(t),t=t.return}while(t);return e}catch(i){return"\nError generating stack: "+i.message+"\n"+i.stack}}function z(t){var e=t,i=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do{0!==(4098&(e=t).flags)&&(i=e.return),t=e.return}while(t)}return 3===e.tag?i:null}function F(t){if(13===t.tag){var e=t.memoizedState;if(null===e&&(null!==(t=t.alternate)&&(e=t.memoizedState)),null!==e)return e.dehydrated}return null}function N(t){if(z(t)!==t)throw Error(a(188))}function U(t){var e=t.tag;if(5===e||26===e||27===e||6===e)return t;for(t=t.child;null!==t;){if(null!==(e=U(t)))return e;t=t.sibling}return null}var V=Array.isArray,j=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,G={pending:!1,data:null,method:null,action:null},H=[],W=-1;function q(t){return{current:t}}function Y(t){0>W||(t.current=H[W],H[W]=null,W--)}function X(t,e){W++,H[W]=t.current,t.current=e}var Q=q(null),K=q(null),Z=q(null),J=q(null);function $(t,e){switch(X(Z,e),X(K,t),X(Q,null),t=e.nodeType){case 9:case 11:e=(e=e.documentElement)&&(e=e.namespaceURI)?Kc(e):0;break;default:if(e=(t=8===t?e.parentNode:e).tagName,t=t.namespaceURI)e=Zc(t=Kc(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}Y(Q),X(Q,e)}function tt(){Y(Q),Y(K),Y(Z)}function et(t){null!==t.memoizedState&&X(J,t);var e=Q.current,i=Zc(e,t.type);e!==i&&(X(K,t),X(Q,i))}function it(t){K.current===t&&(Y(Q),Y(K)),J.current===t&&(Y(J),Bu._currentValue=G)}var nt=Object.prototype.hasOwnProperty,rt=n.unstable_scheduleCallback,st=n.unstable_cancelCallback,at=n.unstable_shouldYield,ot=n.unstable_requestPaint,lt=n.unstable_now,ht=n.unstable_getCurrentPriorityLevel,ct=n.unstable_ImmediatePriority,ut=n.unstable_UserBlockingPriority,dt=n.unstable_NormalPriority,pt=n.unstable_LowPriority,ft=n.unstable_IdlePriority,mt=n.log,gt=n.unstable_setDisableYieldValue,vt=null,yt=null;function bt(t){if("function"===typeof mt&&gt(t),yt&&"function"===typeof yt.setStrictMode)try{yt.setStrictMode(vt,t)}catch(e){}}var xt=Math.clz32?Math.clz32:function(t){return 0===(t>>>=0)?32:31-(wt(t)/St|0)|0},wt=Math.log,St=Math.LN2;var At=128,Et=4194304;function _t(t){var e=42&t;if(0!==e)return e;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194176&t;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&t;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function Ct(t,e){var i=t.pendingLanes;if(0===i)return 0;var n=0,r=t.suspendedLanes,s=t.pingedLanes,a=t.warmLanes;t=0!==t.finishedLanes;var o=134217727&i;return 0!==o?0!==(i=o&~r)?n=_t(i):0!==(s&=o)?n=_t(s):t||0!==(a=o&~a)&&(n=_t(a)):0!==(o=i&~r)?n=_t(o):0!==s?n=_t(s):t||0!==(a=i&~a)&&(n=_t(a)),0===n?0:0!==e&&e!==n&&0===(e&r)&&((r=n&-n)>=(a=e&-e)||32===r&&0!==(4194176&a))?e:n}function Mt(t,e){return 0===(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&e)}function Pt(t,e){switch(t){case 1:case 2:case 4:case 8:return e+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;default:return-1}}function Tt(){var t=At;return 0===(4194176&(At<<=1))&&(At=128),t}function Dt(){var t=Et;return 0===(62914560&(Et<<=1))&&(Et=4194304),t}function kt(t){for(var e=[],i=0;31>i;i++)e.push(t);return e}function It(t,e){t.pendingLanes|=e,268435456!==e&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function Rt(t,e,i){t.pendingLanes|=e,t.suspendedLanes&=~e;var n=31-xt(e);t.entangledLanes|=e,t.entanglements[n]=1073741824|t.entanglements[n]|4194218&i}function Ot(t,e){var i=t.entangledLanes|=e;for(t=t.entanglements;i;){var n=31-xt(i),r=1<<n;r&e|t[n]&e&&(t[n]|=e),i&=~r}}function Lt(t){return 2<(t&=-t)?8<t?0!==(134217727&t)?32:268435456:8:2}function Bt(){var t=j.p;return 0!==t?t:void 0===(t=window.event)?32:Zu(t.type)}var zt=Math.random().toString(36).slice(2),Ft="__reactFiber$"+zt,Nt="__reactProps$"+zt,Ut="__reactContainer$"+zt,Vt="__reactEvents$"+zt,jt="__reactListeners$"+zt,Gt="__reactHandles$"+zt,Ht="__reactResources$"+zt,Wt="__reactMarker$"+zt;function qt(t){delete t[Ft],delete t[Nt],delete t[Vt],delete t[jt],delete t[Gt]}function Yt(t){var e=t[Ft];if(e)return e;for(var i=t.parentNode;i;){if(e=i[Ut]||i[Ft]){if(i=e.alternate,null!==e.child||null!==i&&null!==i.child)for(t=lu(t);null!==t;){if(i=t[Ft])return i;t=lu(t)}return e}i=(t=i).parentNode}return null}function Xt(t){if(t=t[Ft]||t[Ut]){var e=t.tag;if(5===e||6===e||13===e||26===e||27===e||3===e)return t}return null}function Qt(t){var e=t.tag;if(5===e||26===e||27===e||6===e)return t.stateNode;throw Error(a(33))}function Kt(t){var e=t[Ht];return e||(e=t[Ht]={hoistableStyles:new Map,hoistableScripts:new Map}),e}function Zt(t){t[Wt]=!0}var Jt=new Set,$t={};function te(t,e){ee(t,e),ee(t+"Capture",e)}function ee(t,e){for($t[t]=e,t=0;t<e.length;t++)Jt.add(e[t])}var ie=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),ne=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),re={},se={};function ae(t,e,i){if(r=e,nt.call(se,r)||!nt.call(re,r)&&(ne.test(r)?se[r]=!0:(re[r]=!0,0)))if(null===i)t.removeAttribute(e);else{switch(typeof i){case"undefined":case"function":case"symbol":return void t.removeAttribute(e);case"boolean":var n=e.toLowerCase().slice(0,5);if("data-"!==n&&"aria-"!==n)return void t.removeAttribute(e)}t.setAttribute(e,""+i)}var r}function oe(t,e,i){if(null===i)t.removeAttribute(e);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":return void t.removeAttribute(e)}t.setAttribute(e,""+i)}}function le(t,e,i,n){if(null===n)t.removeAttribute(i);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void t.removeAttribute(i)}t.setAttributeNS(e,i,""+n)}}function he(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return t;default:return""}}function ce(t){var e=t.type;return(t=t.nodeName)&&"input"===t.toLowerCase()&&("checkbox"===e||"radio"===e)}function ue(t){t._valueTracker||(t._valueTracker=function(t){var e=ce(t)?"checked":"value",i=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),n=""+t[e];if(!t.hasOwnProperty(e)&&"undefined"!==typeof i&&"function"===typeof i.get&&"function"===typeof i.set){var r=i.get,s=i.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(t){n=""+t,s.call(this,t)}}),Object.defineProperty(t,e,{enumerable:i.enumerable}),{getValue:function(){return n},setValue:function(t){n=""+t},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}(t))}function de(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var i=e.getValue(),n="";return t&&(n=ce(t)?t.checked?"true":"false":t.value),(t=n)!==i&&(e.setValue(t),!0)}function pe(t){if("undefined"===typeof(t=t||("undefined"!==typeof document?document:void 0)))return null;try{return t.activeElement||t.body}catch(e){return t.body}}var fe=/[\n"\\]/g;function me(t){return t.replace(fe,(function(t){return"\\"+t.charCodeAt(0).toString(16)+" "}))}function ge(t,e,i,n,r,s,a,o){t.name="",null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a?t.type=a:t.removeAttribute("type"),null!=e?"number"===a?(0===e&&""===t.value||t.value!=e)&&(t.value=""+he(e)):t.value!==""+he(e)&&(t.value=""+he(e)):"submit"!==a&&"reset"!==a||t.removeAttribute("value"),null!=e?ye(t,a,he(e)):null!=i?ye(t,a,he(i)):null!=n&&t.removeAttribute("value"),null==r&&null!=s&&(t.defaultChecked=!!s),null!=r&&(t.checked=r&&"function"!==typeof r&&"symbol"!==typeof r),null!=o&&"function"!==typeof o&&"symbol"!==typeof o&&"boolean"!==typeof o?t.name=""+he(o):t.removeAttribute("name")}function ve(t,e,i,n,r,s,a,o){if(null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s&&(t.type=s),null!=e||null!=i){if(!("submit"!==s&&"reset"!==s||void 0!==e&&null!==e))return;i=null!=i?""+he(i):"",e=null!=e?""+he(e):i,o||e===t.value||(t.value=e),t.defaultValue=e}n="function"!==typeof(n=null!=n?n:r)&&"symbol"!==typeof n&&!!n,t.checked=o?t.checked:!!n,t.defaultChecked=!!n,null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a&&(t.name=a)}function ye(t,e,i){"number"===e&&pe(t.ownerDocument)===t||t.defaultValue===""+i||(t.defaultValue=""+i)}function be(t,e,i,n){if(t=t.options,e){e={};for(var r=0;r<i.length;r++)e["$"+i[r]]=!0;for(i=0;i<t.length;i++)r=e.hasOwnProperty("$"+t[i].value),t[i].selected!==r&&(t[i].selected=r),r&&n&&(t[i].defaultSelected=!0)}else{for(i=""+he(i),e=null,r=0;r<t.length;r++){if(t[r].value===i)return t[r].selected=!0,void(n&&(t[r].defaultSelected=!0));null!==e||t[r].disabled||(e=t[r])}null!==e&&(e.selected=!0)}}function xe(t,e,i){null==e||((e=""+he(e))!==t.value&&(t.value=e),null!=i)?t.defaultValue=null!=i?""+he(i):"":t.defaultValue!==e&&(t.defaultValue=e)}function we(t,e,i,n){if(null==e){if(null!=n){if(null!=i)throw Error(a(92));if(V(n)){if(1<n.length)throw Error(a(93));n=n[0]}i=n}null==i&&(i=""),e=i}i=he(e),t.defaultValue=i,(n=t.textContent)===i&&""!==n&&null!==n&&(t.value=n)}function Se(t,e){if(e){var i=t.firstChild;if(i&&i===t.lastChild&&3===i.nodeType)return void(i.nodeValue=e)}t.textContent=e}var Ae=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ee(t,e,i){var n=0===e.indexOf("--");null==i||"boolean"===typeof i||""===i?n?t.setProperty(e,""):"float"===e?t.cssFloat="":t[e]="":n?t.setProperty(e,i):"number"!==typeof i||0===i||Ae.has(e)?"float"===e?t.cssFloat=i:t[e]=(""+i).trim():t[e]=i+"px"}function _e(t,e,i){if(null!=e&&"object"!==typeof e)throw Error(a(62));if(t=t.style,null!=i){for(var n in i)!i.hasOwnProperty(n)||null!=e&&e.hasOwnProperty(n)||(0===n.indexOf("--")?t.setProperty(n,""):"float"===n?t.cssFloat="":t[n]="");for(var r in e)n=e[r],e.hasOwnProperty(r)&&i[r]!==n&&Ee(t,r,n)}else for(var s in e)e.hasOwnProperty(s)&&Ee(t,s,e[s])}function Ce(t){if(-1===t.indexOf("-"))return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Me=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Pe=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Te(t){return Pe.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}var De=null;function ke(t){return(t=t.target||t.srcElement||window).correspondingUseElement&&(t=t.correspondingUseElement),3===t.nodeType?t.parentNode:t}var Ie=null,Re=null;function Oe(t){var e=Xt(t);if(e&&(t=e.stateNode)){var i=t[Nt]||null;t:switch(t=e.stateNode,e.type){case"input":if(ge(t,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name),e=i.name,"radio"===i.type&&null!=e){for(i=t;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll('input[name="'+me(""+e)+'"][type="radio"]'),e=0;e<i.length;e++){var n=i[e];if(n!==t&&n.form===t.form){var r=n[Nt]||null;if(!r)throw Error(a(90));ge(n,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name)}}for(e=0;e<i.length;e++)(n=i[e]).form===t.form&&de(n)}break t;case"textarea":xe(t,i.value,i.defaultValue);break t;case"select":null!=(e=i.value)&&be(t,!!i.multiple,e,!1)}}}var Le=!1;function Be(t,e,i){if(Le)return t(e,i);Le=!0;try{return t(e)}finally{if(Le=!1,(null!==Ie||null!==Re)&&(Fh(),Ie&&(e=Ie,t=Re,Re=Ie=null,Oe(e),t)))for(e=0;e<t.length;e++)Oe(t[e])}}function ze(t,e){var i=t.stateNode;if(null===i)return null;var n=i[Nt]||null;if(null===n)return null;i=n[e];t:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(n=!("button"===(t=t.type)||"input"===t||"select"===t||"textarea"===t)),t=!n;break t;default:t=!1}if(t)return null;if(i&&"function"!==typeof i)throw Error(a(231,e,typeof i));return i}var Fe=!1;if(ie)try{var Ne={};Object.defineProperty(Ne,"passive",{get:function(){Fe=!0}}),window.addEventListener("test",Ne,Ne),window.removeEventListener("test",Ne,Ne)}catch(wd){Fe=!1}var Ue=null,Ve=null,je=null;function Ge(){if(je)return je;var t,e,i=Ve,n=i.length,r="value"in Ue?Ue.value:Ue.textContent,s=r.length;for(t=0;t<n&&i[t]===r[t];t++);var a=n-t;for(e=1;e<=a&&i[n-e]===r[s-e];e++);return je=r.slice(t,1<e?1-e:void 0)}function He(t){var e=t.keyCode;return"charCode"in t?0===(t=t.charCode)&&13===e&&(t=13):t=e,10===t&&(t=13),32<=t||13===t?t:0}function We(){return!0}function qe(){return!1}function Ye(t){function e(e,i,n,r,s){for(var a in this._reactName=e,this._targetInst=n,this.type=i,this.nativeEvent=r,this.target=s,this.currentTarget=null,t)t.hasOwnProperty(a)&&(e=t[a],this[a]=e?e(r):r[a]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?We:qe,this.isPropagationStopped=qe,this}return k(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():"unknown"!==typeof t.returnValue&&(t.returnValue=!1),this.isDefaultPrevented=We)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():"unknown"!==typeof t.cancelBubble&&(t.cancelBubble=!0),this.isPropagationStopped=We)},persist:function(){},isPersistent:We}),e}var Xe,Qe,Ke,Ze={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Je=Ye(Ze),$e=k({},Ze,{view:0,detail:0}),ti=Ye($e),ei=k({},$e,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:di,button:0,buttons:0,relatedTarget:function(t){return void 0===t.relatedTarget?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ke&&(Ke&&"mousemove"===t.type?(Xe=t.screenX-Ke.screenX,Qe=t.screenY-Ke.screenY):Qe=Xe=0,Ke=t),Xe)},movementY:function(t){return"movementY"in t?t.movementY:Qe}}),ii=Ye(ei),ni=Ye(k({},ei,{dataTransfer:0})),ri=Ye(k({},$e,{relatedTarget:0})),si=Ye(k({},Ze,{animationName:0,elapsedTime:0,pseudoElement:0})),ai=Ye(k({},Ze,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}})),oi=Ye(k({},Ze,{data:0})),li={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hi={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ci={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ui(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):!!(t=ci[t])&&!!e[t]}function di(){return ui}var pi=Ye(k({},$e,{key:function(t){if(t.key){var e=li[t.key]||t.key;if("Unidentified"!==e)return e}return"keypress"===t.type?13===(t=He(t))?"Enter":String.fromCharCode(t):"keydown"===t.type||"keyup"===t.type?hi[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:di,charCode:function(t){return"keypress"===t.type?He(t):0},keyCode:function(t){return"keydown"===t.type||"keyup"===t.type?t.keyCode:0},which:function(t){return"keypress"===t.type?He(t):"keydown"===t.type||"keyup"===t.type?t.keyCode:0}})),fi=Ye(k({},ei,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),mi=Ye(k({},$e,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:di})),gi=Ye(k({},Ze,{propertyName:0,elapsedTime:0,pseudoElement:0})),vi=Ye(k({},ei,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0})),yi=Ye(k({},Ze,{newState:0,oldState:0})),bi=[9,13,27,32],xi=ie&&"CompositionEvent"in window,wi=null;ie&&"documentMode"in document&&(wi=document.documentMode);var Si=ie&&"TextEvent"in window&&!wi,Ai=ie&&(!xi||wi&&8<wi&&11>=wi),Ei=String.fromCharCode(32),_i=!1;function Ci(t,e){switch(t){case"keyup":return-1!==bi.indexOf(e.keyCode);case"keydown":return 229!==e.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Mi(t){return"object"===typeof(t=t.detail)&&"data"in t?t.data:null}var Pi=!1;var Ti={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Di(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return"input"===e?!!Ti[t.type]:"textarea"===e}function ki(t,e,i,n){Ie?Re?Re.push(n):Re=[n]:Ie=n,0<(e=Bc(e,"onChange")).length&&(i=new Je("onChange","change",null,i,n),t.push({event:i,listeners:e}))}var Ii=null,Ri=null;function Oi(t){Pc(t,0)}function Li(t){if(de(Qt(t)))return t}function Bi(t,e){if("change"===t)return e}var zi=!1;if(ie){var Fi;if(ie){var Ni="oninput"in document;if(!Ni){var Ui=document.createElement("div");Ui.setAttribute("oninput","return;"),Ni="function"===typeof Ui.oninput}Fi=Ni}else Fi=!1;zi=Fi&&(!document.documentMode||9<document.documentMode)}function Vi(){Ii&&(Ii.detachEvent("onpropertychange",ji),Ri=Ii=null)}function ji(t){if("value"===t.propertyName&&Li(Ri)){var e=[];ki(e,Ri,t,ke(t)),Be(Oi,e)}}function Gi(t,e,i){"focusin"===t?(Vi(),Ri=i,(Ii=e).attachEvent("onpropertychange",ji)):"focusout"===t&&Vi()}function Hi(t){if("selectionchange"===t||"keyup"===t||"keydown"===t)return Li(Ri)}function Wi(t,e){if("click"===t)return Li(e)}function qi(t,e){if("input"===t||"change"===t)return Li(e)}var Yi="function"===typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t===1/e)||t!==t&&e!==e};function Xi(t,e){if(Yi(t,e))return!0;if("object"!==typeof t||null===t||"object"!==typeof e||null===e)return!1;var i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(n=0;n<i.length;n++){var r=i[n];if(!nt.call(e,r)||!Yi(t[r],e[r]))return!1}return!0}function Qi(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Ki(t,e){var i,n=Qi(t);for(t=0;n;){if(3===n.nodeType){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}t:{for(;n;){if(n.nextSibling){n=n.nextSibling;break t}n=n.parentNode}n=void 0}n=Qi(n)}}function Zi(t,e){return!(!t||!e)&&(t===e||(!t||3!==t.nodeType)&&(e&&3===e.nodeType?Zi(t,e.parentNode):"contains"in t?t.contains(e):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(e))))}function Ji(t){for(var e=pe((t=null!=t&&null!=t.ownerDocument&&null!=t.ownerDocument.defaultView?t.ownerDocument.defaultView:window).document);e instanceof t.HTMLIFrameElement;){try{var i="string"===typeof e.contentWindow.location.href}catch(n){i=!1}if(!i)break;e=pe((t=e.contentWindow).document)}return e}function $i(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&("input"===e&&("text"===t.type||"search"===t.type||"tel"===t.type||"url"===t.type||"password"===t.type)||"textarea"===e||"true"===t.contentEditable)}function tn(t,e){var i=Ji(e);e=t.focusedElem;var n=t.selectionRange;if(i!==e&&e&&e.ownerDocument&&Zi(e.ownerDocument.documentElement,e)){if(null!==n&&$i(e))if(t=n.start,void 0===(i=n.end)&&(i=t),"selectionStart"in e)e.selectionStart=t,e.selectionEnd=Math.min(i,e.value.length);else if((i=(t=e.ownerDocument||document)&&t.defaultView||window).getSelection){i=i.getSelection();var r=e.textContent.length,s=Math.min(n.start,r);n=void 0===n.end?s:Math.min(n.end,r),!i.extend&&s>n&&(r=n,n=s,s=r),r=Ki(e,s);var a=Ki(e,n);r&&a&&(1!==i.rangeCount||i.anchorNode!==r.node||i.anchorOffset!==r.offset||i.focusNode!==a.node||i.focusOffset!==a.offset)&&((t=t.createRange()).setStart(r.node,r.offset),i.removeAllRanges(),s>n?(i.addRange(t),i.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),i.addRange(t)))}for(t=[],i=e;i=i.parentNode;)1===i.nodeType&&t.push({element:i,left:i.scrollLeft,top:i.scrollTop});for("function"===typeof e.focus&&e.focus(),e=0;e<t.length;e++)(i=t[e]).element.scrollLeft=i.left,i.element.scrollTop=i.top}}var en=ie&&"documentMode"in document&&11>=document.documentMode,nn=null,rn=null,sn=null,an=!1;function on(t,e,i){var n=i.window===i?i.document:9===i.nodeType?i:i.ownerDocument;an||null==nn||nn!==pe(n)||("selectionStart"in(n=nn)&&$i(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},sn&&Xi(sn,n)||(sn=n,0<(n=Bc(rn,"onSelect")).length&&(e=new Je("onSelect","select",null,e,i),t.push({event:e,listeners:n}),e.target=nn)))}function ln(t,e){var i={};return i[t.toLowerCase()]=e.toLowerCase(),i["Webkit"+t]="webkit"+e,i["Moz"+t]="moz"+e,i}var hn={animationend:ln("Animation","AnimationEnd"),animationiteration:ln("Animation","AnimationIteration"),animationstart:ln("Animation","AnimationStart"),transitionrun:ln("Transition","TransitionRun"),transitionstart:ln("Transition","TransitionStart"),transitioncancel:ln("Transition","TransitionCancel"),transitionend:ln("Transition","TransitionEnd")},cn={},un={};function dn(t){if(cn[t])return cn[t];if(!hn[t])return t;var e,i=hn[t];for(e in i)if(i.hasOwnProperty(e)&&e in un)return cn[t]=i[e];return t}ie&&(un=document.createElement("div").style,"AnimationEvent"in window||(delete hn.animationend.animation,delete hn.animationiteration.animation,delete hn.animationstart.animation),"TransitionEvent"in window||delete hn.transitionend.transition);var pn=dn("animationend"),fn=dn("animationiteration"),mn=dn("animationstart"),gn=dn("transitionrun"),vn=dn("transitionstart"),yn=dn("transitioncancel"),bn=dn("transitionend"),xn=new Map,wn="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function Sn(t,e){xn.set(t,e),te(e,[t])}var An=[],En=0,_n=0;function Cn(){for(var t=En,e=_n=En=0;e<t;){var i=An[e];An[e++]=null;var n=An[e];An[e++]=null;var r=An[e];An[e++]=null;var s=An[e];if(An[e++]=null,null!==n&&null!==r){var a=n.pending;null===a?r.next=r:(r.next=a.next,a.next=r),n.pending=r}0!==s&&Dn(i,r,s)}}function Mn(t,e,i,n){An[En++]=t,An[En++]=e,An[En++]=i,An[En++]=n,_n|=n,t.lanes|=n,null!==(t=t.alternate)&&(t.lanes|=n)}function Pn(t,e,i,n){return Mn(t,e,i,n),kn(t)}function Tn(t,e){return Mn(t,null,null,e),kn(t)}function Dn(t,e,i){t.lanes|=i;var n=t.alternate;null!==n&&(n.lanes|=i);for(var r=!1,s=t.return;null!==s;)s.childLanes|=i,null!==(n=s.alternate)&&(n.childLanes|=i),22===s.tag&&(null===(t=s.stateNode)||1&t._visibility||(r=!0)),t=s,s=s.return;r&&null!==e&&3===t.tag&&(s=t.stateNode,r=31-xt(i),null===(t=(s=s.hiddenUpdates)[r])?s[r]=[e]:t.push(e),e.lane=536870912|i)}function kn(t){if(50<Ph)throw Ph=0,Th=null,Error(a(185));for(var e=t.return;null!==e;)e=(t=e).return;return 3===t.tag?t.stateNode:null}var In={},Rn=new WeakMap;function On(t,e){if("object"===typeof t&&null!==t){var i=Rn.get(t);return void 0!==i?i:(e={value:t,source:e,stack:B(e)},Rn.set(t,e),e)}return{value:t,source:e,stack:B(e)}}var Ln=[],Bn=0,zn=null,Fn=0,Nn=[],Un=0,Vn=null,jn=1,Gn="";function Hn(t,e){Ln[Bn++]=Fn,Ln[Bn++]=zn,zn=t,Fn=e}function Wn(t,e,i){Nn[Un++]=jn,Nn[Un++]=Gn,Nn[Un++]=Vn,Vn=t;var n=jn;t=Gn;var r=32-xt(n)-1;n&=~(1<<r),i+=1;var s=32-xt(e)+r;if(30<s){var a=r-r%5;s=(n&(1<<a)-1).toString(32),n>>=a,r-=a,jn=1<<32-xt(e)+r|i<<r|n,Gn=s+t}else jn=1<<s|i<<r|n,Gn=t}function qn(t){null!==t.return&&(Hn(t,1),Wn(t,1,0))}function Yn(t){for(;t===zn;)zn=Ln[--Bn],Ln[Bn]=null,Fn=Ln[--Bn],Ln[Bn]=null;for(;t===Vn;)Vn=Nn[--Un],Nn[Un]=null,Gn=Nn[--Un],Nn[Un]=null,jn=Nn[--Un],Nn[Un]=null}var Xn=null,Qn=null,Kn=!1,Zn=null,Jn=!1,$n=Error(a(519));function tr(t){throw sr(On(Error(a(418,"")),t)),$n}function er(t){var e=t.stateNode,i=t.type,n=t.memoizedProps;switch(e[Ft]=t,e[Nt]=n,i){case"dialog":Tc("cancel",e),Tc("close",e);break;case"iframe":case"object":case"embed":Tc("load",e);break;case"video":case"audio":for(i=0;i<Cc.length;i++)Tc(Cc[i],e);break;case"source":Tc("error",e);break;case"img":case"image":case"link":Tc("error",e),Tc("load",e);break;case"details":Tc("toggle",e);break;case"input":Tc("invalid",e),ve(e,n.value,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name,!0),ue(e);break;case"select":Tc("invalid",e);break;case"textarea":Tc("invalid",e),we(e,n.value,n.defaultValue,n.children),ue(e)}"string"!==typeof(i=n.children)&&"number"!==typeof i&&"bigint"!==typeof i||e.textContent===""+i||!0===n.suppressHydrationWarning||jc(e.textContent,i)?(null!=n.popover&&(Tc("beforetoggle",e),Tc("toggle",e)),null!=n.onScroll&&Tc("scroll",e),null!=n.onScrollEnd&&Tc("scrollend",e),null!=n.onClick&&(e.onclick=Gc),e=!0):e=!1,e||tr(t)}function ir(t){for(Xn=t.return;Xn;)switch(Xn.tag){case 3:case 27:return void(Jn=!0);case 5:case 13:return void(Jn=!1);default:Xn=Xn.return}}function nr(t){if(t!==Xn)return!1;if(!Kn)return ir(t),Kn=!0,!1;var e,i=!1;if((e=3!==t.tag&&27!==t.tag)&&((e=5===t.tag)&&(e=!("form"!==(e=t.type)&&"button"!==e)||Jc(t.type,t.memoizedProps)),e=!e),e&&(i=!0),i&&Qn&&tr(t),ir(t),13===t.tag){if(!(t=null!==(t=t.memoizedState)?t.dehydrated:null))throw Error(a(317));t:{for(t=t.nextSibling,i=0;t;){if(8===t.nodeType)if("/$"===(e=t.data)){if(0===i){Qn=ou(t.nextSibling);break t}i--}else"$"!==e&&"$!"!==e&&"$?"!==e||i++;t=t.nextSibling}Qn=null}}else Qn=Xn?ou(t.stateNode.nextSibling):null;return!0}function rr(){Qn=Xn=null,Kn=!1}function sr(t){null===Zn?Zn=[t]:Zn.push(t)}var ar=Error(a(460)),or=Error(a(474)),lr={then:function(){}};function hr(t){return"fulfilled"===(t=t.status)||"rejected"===t}function cr(){}function ur(t,e,i){switch(void 0===(i=t[i])?t.push(e):i!==e&&(e.then(cr,cr),e=i),e.status){case"fulfilled":return e.value;case"rejected":if((t=e.reason)===ar)throw Error(a(483));throw t;default:if("string"===typeof e.status)e.then(cr,cr);else{if(null!==(t=eh)&&100<t.shellSuspendCounter)throw Error(a(482));(t=e).status="pending",t.then((function(t){if("pending"===e.status){var i=e;i.status="fulfilled",i.value=t}}),(function(t){if("pending"===e.status){var i=e;i.status="rejected",i.reason=t}}))}switch(e.status){case"fulfilled":return e.value;case"rejected":if((t=e.reason)===ar)throw Error(a(483));throw t}throw dr=e,ar}}var dr=null;function pr(){if(null===dr)throw Error(a(459));var t=dr;return dr=null,t}var fr=null,mr=0;function gr(t){var e=mr;return mr+=1,null===fr&&(fr=[]),ur(fr,t,e)}function vr(t,e){e=e.props.ref,t.ref=void 0!==e?e:null}function yr(t,e){if(e.$$typeof===l)throw Error(a(525));throw t=Object.prototype.toString.call(e),Error(a(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function br(t){return(0,t._init)(t._payload)}function xr(t){function e(e,i){if(t){var n=e.deletions;null===n?(e.deletions=[i],e.flags|=16):n.push(i)}}function i(i,n){if(!t)return null;for(;null!==n;)e(i,n),n=n.sibling;return null}function n(t){for(var e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(t,e){return(t=zl(t,e)).index=0,t.sibling=null,t}function s(e,i,n){return e.index=n,t?null!==(n=e.alternate)?(n=n.index)<i?(e.flags|=33554434,i):n:(e.flags|=33554434,i):(e.flags|=1048576,i)}function o(e){return t&&null===e.alternate&&(e.flags|=33554434),e}function l(t,e,i,n){return null===e||6!==e.tag?((e=jl(i,t.mode,n)).return=t,e):((e=r(e,i)).return=t,e)}function d(t,e,i,n){var s=i.type;return s===u?f(t,e,i.props.children,n,i.key):null!==e&&(e.elementType===s||"object"===typeof s&&null!==s&&s.$$typeof===w&&br(s)===e.type)?(vr(e=r(e,i.props),i),e.return=t,e):(vr(e=Nl(i.type,i.key,i.props,null,t.mode,n),i),e.return=t,e)}function p(t,e,i,n){return null===e||4!==e.tag||e.stateNode.containerInfo!==i.containerInfo||e.stateNode.implementation!==i.implementation?((e=Gl(i,t.mode,n)).return=t,e):((e=r(e,i.children||[])).return=t,e)}function f(t,e,i,n,s){return null===e||7!==e.tag?((e=Ul(i,t.mode,n,s)).return=t,e):((e=r(e,i)).return=t,e)}function m(t,e,i){if("string"===typeof e&&""!==e||"number"===typeof e||"bigint"===typeof e)return(e=jl(""+e,t.mode,i)).return=t,e;if("object"===typeof e&&null!==e){switch(e.$$typeof){case h:return vr(i=Nl(e.type,e.key,e.props,null,t.mode,i),e),i.return=t,i;case c:return(e=Gl(e,t.mode,i)).return=t,e;case w:return m(t,e=(0,e._init)(e._payload),i)}if(V(e)||_(e))return(e=Ul(e,t.mode,i,null)).return=t,e;if("function"===typeof e.then)return m(t,gr(e),i);if(e.$$typeof===g)return m(t,Co(t,e),i);yr(t,e)}return null}function v(t,e,i,n){var r=null!==e?e.key:null;if("string"===typeof i&&""!==i||"number"===typeof i||"bigint"===typeof i)return null!==r?null:l(t,e,""+i,n);if("object"===typeof i&&null!==i){switch(i.$$typeof){case h:return i.key===r?d(t,e,i,n):null;case c:return i.key===r?p(t,e,i,n):null;case w:return v(t,e,i=(r=i._init)(i._payload),n)}if(V(i)||_(i))return null!==r?null:f(t,e,i,n,null);if("function"===typeof i.then)return v(t,e,gr(i),n);if(i.$$typeof===g)return v(t,e,Co(t,i),n);yr(t,i)}return null}function y(t,e,i,n,r){if("string"===typeof n&&""!==n||"number"===typeof n||"bigint"===typeof n)return l(e,t=t.get(i)||null,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case h:return d(e,t=t.get(null===n.key?i:n.key)||null,n,r);case c:return p(e,t=t.get(null===n.key?i:n.key)||null,n,r);case w:return y(t,e,i,n=(0,n._init)(n._payload),r)}if(V(n)||_(n))return f(e,t=t.get(i)||null,n,r,null);if("function"===typeof n.then)return y(t,e,i,gr(n),r);if(n.$$typeof===g)return y(t,e,i,Co(e,n),r);yr(e,n)}return null}function b(l,d,p,f){if("object"===typeof p&&null!==p&&p.type===u&&null===p.key&&(p=p.props.children),"object"===typeof p&&null!==p){switch(p.$$typeof){case h:t:{for(var x=p.key;null!==d;){if(d.key===x){if((x=p.type)===u){if(7===d.tag){i(l,d.sibling),(f=r(d,p.props.children)).return=l,l=f;break t}}else if(d.elementType===x||"object"===typeof x&&null!==x&&x.$$typeof===w&&br(x)===d.type){i(l,d.sibling),vr(f=r(d,p.props),p),f.return=l,l=f;break t}i(l,d);break}e(l,d),d=d.sibling}p.type===u?((f=Ul(p.props.children,l.mode,f,p.key)).return=l,l=f):(vr(f=Nl(p.type,p.key,p.props,null,l.mode,f),p),f.return=l,l=f)}return o(l);case c:t:{for(x=p.key;null!==d;){if(d.key===x){if(4===d.tag&&d.stateNode.containerInfo===p.containerInfo&&d.stateNode.implementation===p.implementation){i(l,d.sibling),(f=r(d,p.children||[])).return=l,l=f;break t}i(l,d);break}e(l,d),d=d.sibling}(f=Gl(p,l.mode,f)).return=l,l=f}return o(l);case w:return b(l,d,p=(x=p._init)(p._payload),f)}if(V(p))return function(r,a,o,l){for(var h=null,c=null,u=a,d=a=0,p=null;null!==u&&d<o.length;d++){u.index>d?(p=u,u=null):p=u.sibling;var f=v(r,u,o[d],l);if(null===f){null===u&&(u=p);break}t&&u&&null===f.alternate&&e(r,u),a=s(f,a,d),null===c?h=f:c.sibling=f,c=f,u=p}if(d===o.length)return i(r,u),Kn&&Hn(r,d),h;if(null===u){for(;d<o.length;d++)null!==(u=m(r,o[d],l))&&(a=s(u,a,d),null===c?h=u:c.sibling=u,c=u);return Kn&&Hn(r,d),h}for(u=n(u);d<o.length;d++)null!==(p=y(u,r,d,o[d],l))&&(t&&null!==p.alternate&&u.delete(null===p.key?d:p.key),a=s(p,a,d),null===c?h=p:c.sibling=p,c=p);return t&&u.forEach((function(t){return e(r,t)})),Kn&&Hn(r,d),h}(l,d,p,f);if(_(p)){if("function"!==typeof(x=_(p)))throw Error(a(150));return function(r,o,l,h){if(null==l)throw Error(a(151));for(var c=null,u=null,d=o,p=o=0,f=null,g=l.next();null!==d&&!g.done;p++,g=l.next()){d.index>p?(f=d,d=null):f=d.sibling;var b=v(r,d,g.value,h);if(null===b){null===d&&(d=f);break}t&&d&&null===b.alternate&&e(r,d),o=s(b,o,p),null===u?c=b:u.sibling=b,u=b,d=f}if(g.done)return i(r,d),Kn&&Hn(r,p),c;if(null===d){for(;!g.done;p++,g=l.next())null!==(g=m(r,g.value,h))&&(o=s(g,o,p),null===u?c=g:u.sibling=g,u=g);return Kn&&Hn(r,p),c}for(d=n(d);!g.done;p++,g=l.next())null!==(g=y(d,r,p,g.value,h))&&(t&&null!==g.alternate&&d.delete(null===g.key?p:g.key),o=s(g,o,p),null===u?c=g:u.sibling=g,u=g);return t&&d.forEach((function(t){return e(r,t)})),Kn&&Hn(r,p),c}(l,d,p=x.call(p),f)}if("function"===typeof p.then)return b(l,d,gr(p),f);if(p.$$typeof===g)return b(l,d,Co(l,p),f);yr(l,p)}return"string"===typeof p&&""!==p||"number"===typeof p||"bigint"===typeof p?(p=""+p,null!==d&&6===d.tag?(i(l,d.sibling),(f=r(d,p)).return=l,l=f):(i(l,d),(f=jl(p,l.mode,f)).return=l,l=f),o(l)):i(l,d)}return function(t,e,i,n){try{mr=0;var r=b(t,e,i,n);return fr=null,r}catch(a){if(a===ar)throw a;var s=Ll(29,a,null,t.mode);return s.lanes=n,s.return=t,s}}}var wr=xr(!0),Sr=xr(!1),Ar=q(null),Er=q(0);function _r(t,e){X(Er,t=hh),X(Ar,e),hh=t|e.baseLanes}function Cr(){X(Er,hh),X(Ar,Ar.current)}function Mr(){hh=Er.current,Y(Ar),Y(Er)}var Pr=q(null),Tr=null;function Dr(t){var e=t.alternate;X(Or,1&Or.current),X(Pr,t),null===Tr&&(null===e||null!==Ar.current||null!==e.memoizedState)&&(Tr=t)}function kr(t){if(22===t.tag){if(X(Or,Or.current),X(Pr,t),null===Tr){var e=t.alternate;null!==e&&null!==e.memoizedState&&(Tr=t)}}else Ir()}function Ir(){X(Or,Or.current),X(Pr,Pr.current)}function Rr(t){Y(Pr),Tr===t&&(Tr=null),Y(Or)}var Or=q(0);function Lr(t){for(var e=t;null!==e;){if(13===e.tag){var i=e.memoizedState;if(null!==i&&(null===(i=i.dehydrated)||"$?"===i.data||"$!"===i.data))return e}else if(19===e.tag&&void 0!==e.memoizedProps.revealOrder){if(0!==(128&e.flags))return e}else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Br="undefined"!==typeof AbortController?AbortController:function(){var t=[],e=this.signal={aborted:!1,addEventListener:function(e,i){t.push(i)}};this.abort=function(){e.aborted=!0,t.forEach((function(t){return t()}))}},zr=n.unstable_scheduleCallback,Fr=n.unstable_NormalPriority,Nr={$$typeof:g,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ur(){return{controller:new Br,data:new Map,refCount:0}}function Vr(t){t.refCount--,0===t.refCount&&zr(Fr,(function(){t.controller.abort()}))}var jr=null,Gr=0,Hr=0,Wr=null;function qr(){if(0===--Gr&&null!==jr){null!==Wr&&(Wr.status="fulfilled");var t=jr;jr=null,Hr=0,Wr=null;for(var e=0;e<t.length;e++)(0,t[e])()}}var Yr=D.S;D.S=function(t,e){"object"===typeof e&&null!==e&&"function"===typeof e.then&&function(t,e){if(null===jr){var i=jr=[];Gr=0,Hr=wc(),Wr={status:"pending",value:void 0,then:function(t){i.push(t)}}}Gr++,e.then(qr,qr)}(0,e),null!==Yr&&Yr(t,e)};var Xr=q(null);function Qr(){var t=Xr.current;return null!==t?t:eh.pooledCache}function Kr(t,e){X(Xr,null===e?Xr.current:e.pool)}function Zr(){var t=Qr();return null===t?null:{parent:Nr._currentValue,pool:t}}var Jr=0,$r=null,ts=null,es=null,is=!1,ns=!1,rs=!1,ss=0,as=0,os=null,ls=0;function hs(){throw Error(a(321))}function cs(t,e){if(null===e)return!1;for(var i=0;i<e.length&&i<t.length;i++)if(!Yi(t[i],e[i]))return!1;return!0}function us(t,e,i,n,r,s){return Jr=s,$r=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,D.H=null===t||null===t.memoizedState?_a:Ca,rs=!1,s=i(n,r),rs=!1,ns&&(s=ps(e,i,n,r)),ds(t),s}function ds(t){D.H=Ea;var e=null!==ts&&null!==ts.next;if(Jr=0,es=ts=$r=null,is=!1,as=0,os=null,e)throw Error(a(300));null===t||Ga||null!==(t=t.dependencies)&&Ao(t)&&(Ga=!0)}function ps(t,e,i,n){$r=t;var r=0;do{if(ns&&(os=null),as=0,ns=!1,25<=r)throw Error(a(301));if(r+=1,es=ts=null,null!=t.updateQueue){var s=t.updateQueue;s.lastEffect=null,s.events=null,s.stores=null,null!=s.memoCache&&(s.memoCache.index=0)}D.H=Ma,s=e(i,n)}while(ns);return s}function fs(){var t=D.H,e=t.useState()[0];return e="function"===typeof e.then?xs(e):e,t=t.useState()[0],(null!==ts?ts.memoizedState:null)!==t&&($r.flags|=1024),e}function ms(){var t=0!==ss;return ss=0,t}function gs(t,e,i){e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i}function vs(t){if(is){for(t=t.memoizedState;null!==t;){var e=t.queue;null!==e&&(e.pending=null),t=t.next}is=!1}Jr=0,es=ts=$r=null,ns=!1,as=ss=0,os=null}function ys(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===es?$r.memoizedState=es=t:es=es.next=t,es}function bs(){if(null===ts){var t=$r.alternate;t=null!==t?t.memoizedState:null}else t=ts.next;var e=null===es?$r.memoizedState:es.next;if(null!==e)es=e,ts=t;else{if(null===t){if(null===$r.alternate)throw Error(a(467));throw Error(a(310))}t={memoizedState:(ts=t).memoizedState,baseState:ts.baseState,baseQueue:ts.baseQueue,queue:ts.queue,next:null},null===es?$r.memoizedState=es=t:es=es.next=t}return es}function xs(t){var e=as;return as+=1,null===os&&(os=[]),t=ur(os,t,e),e=$r,null===(null===es?e.memoizedState:es.next)&&(e=e.alternate,D.H=null===e||null===e.memoizedState?_a:Ca),t}function ws(t){if(null!==t&&"object"===typeof t){if("function"===typeof t.then)return xs(t);if(t.$$typeof===g)return _o(t)}throw Error(a(438,String(t)))}function Ss(t){var e=null,i=$r.updateQueue;if(null!==i&&(e=i.memoCache),null==e){var n=$r.alternate;null!==n&&(null!==(n=n.updateQueue)&&(null!=(n=n.memoCache)&&(e={data:n.data.map((function(t){return t.slice()})),index:0})))}if(null==e&&(e={data:[],index:0}),null===i&&(i={lastEffect:null,events:null,stores:null,memoCache:null},$r.updateQueue=i),i.memoCache=e,void 0===(i=e.data[e.index]))for(i=e.data[e.index]=Array(t),n=0;n<t;n++)i[n]=A;return e.index++,i}function As(t,e){return"function"===typeof e?e(t):e}function Es(t){return _s(bs(),ts,t)}function _s(t,e,i){var n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=i;var r=t.baseQueue,s=n.pending;if(null!==s){if(null!==r){var o=r.next;r.next=s.next,s.next=o}e.baseQueue=r=s,n.pending=null}if(s=t.baseState,null===r)t.memoizedState=s;else{var l=o=null,h=null,c=e=r.next,u=!1;do{var d=-536870913&c.lane;if(d!==c.lane?(nh&d)===d:(Jr&d)===d){var p=c.revertLane;if(0===p)null!==h&&(h=h.next={lane:0,revertLane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),d===Hr&&(u=!0);else{if((Jr&p)===p){c=c.next,p===Hr&&(u=!0);continue}d={lane:0,revertLane:c.revertLane,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},null===h?(l=h=d,o=s):h=h.next=d,$r.lanes|=p,uh|=p}d=c.action,rs&&i(s,d),s=c.hasEagerState?c.eagerState:i(s,d)}else p={lane:d,revertLane:c.revertLane,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},null===h?(l=h=p,o=s):h=h.next=p,$r.lanes|=d,uh|=d;c=c.next}while(null!==c&&c!==e);if(null===h?o=s:h.next=l,!Yi(s,t.memoizedState)&&(Ga=!0,u&&null!==(i=Wr)))throw i;t.memoizedState=s,t.baseState=o,t.baseQueue=h,n.lastRenderedState=s}return null===r&&(n.lanes=0),[t.memoizedState,n.dispatch]}function Cs(t){var e=bs(),i=e.queue;if(null===i)throw Error(a(311));i.lastRenderedReducer=t;var n=i.dispatch,r=i.pending,s=e.memoizedState;if(null!==r){i.pending=null;var o=r=r.next;do{s=t(s,o.action),o=o.next}while(o!==r);Yi(s,e.memoizedState)||(Ga=!0),e.memoizedState=s,null===e.baseQueue&&(e.baseState=s),i.lastRenderedState=s}return[s,n]}function Ms(t,e,i){var n=$r,r=bs(),s=Kn;if(s){if(void 0===i)throw Error(a(407));i=i()}else i=e();var o=!Yi((ts||r).memoizedState,i);if(o&&(r.memoizedState=i,Ga=!0),r=r.queue,Js(Ds.bind(null,n,r,t),[t]),r.getSnapshot!==e||o||null!==es&&1&es.memoizedState.tag){if(n.flags|=2048,Ys(9,Ts.bind(null,n,r,i,e),{destroy:void 0},null),null===eh)throw Error(a(349));s||0!==(60&Jr)||Ps(n,e,i)}return i}function Ps(t,e,i){t.flags|=16384,t={getSnapshot:e,value:i},null===(e=$r.updateQueue)?(e={lastEffect:null,events:null,stores:null,memoCache:null},$r.updateQueue=e,e.stores=[t]):null===(i=e.stores)?e.stores=[t]:i.push(t)}function Ts(t,e,i,n){e.value=i,e.getSnapshot=n,ks(e)&&Is(t)}function Ds(t,e,i){return i((function(){ks(e)&&Is(t)}))}function ks(t){var e=t.getSnapshot;t=t.value;try{var i=e();return!Yi(t,i)}catch(n){return!0}}function Is(t){var e=Tn(t,2);null!==e&&Ih(e,t,2)}function Rs(t){var e=ys();if("function"===typeof t){var i=t;if(t=i(),rs){bt(!0);try{i()}finally{bt(!1)}}}return e.memoizedState=e.baseState=t,e.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:As,lastRenderedState:t},e}function Os(t,e,i,n){return t.baseState=i,_s(t,ts,"function"===typeof n?n:As)}function Ls(t,e,i,n,r){if(wa(t))throw Error(a(485));if(null!==(t=e.action)){var s={payload:r,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(t){s.listeners.push(t)}};null!==D.T?i(!0):s.isTransition=!1,n(s),null===(i=e.pending)?(s.next=e.pending=s,Bs(e,s)):(s.next=i.next,e.pending=i.next=s)}}function Bs(t,e){var i=e.action,n=e.payload,r=t.state;if(e.isTransition){var s=D.T,a={};D.T=a;try{var o=i(r,n),l=D.S;null!==l&&l(a,o),zs(t,e,o)}catch(h){Ns(t,e,h)}finally{D.T=s}}else try{zs(t,e,s=i(r,n))}catch(c){Ns(t,e,c)}}function zs(t,e,i){null!==i&&"object"===typeof i&&"function"===typeof i.then?i.then((function(i){Fs(t,e,i)}),(function(i){return Ns(t,e,i)})):Fs(t,e,i)}function Fs(t,e,i){e.status="fulfilled",e.value=i,Us(e),t.state=i,null!==(e=t.pending)&&((i=e.next)===e?t.pending=null:(i=i.next,e.next=i,Bs(t,i)))}function Ns(t,e,i){var n=t.pending;if(t.pending=null,null!==n){n=n.next;do{e.status="rejected",e.reason=i,Us(e),e=e.next}while(e!==n)}t.action=null}function Us(t){t=t.listeners;for(var e=0;e<t.length;e++)(0,t[e])()}function Vs(t,e){return e}function js(t,e){if(Kn){var i=eh.formState;if(null!==i){t:{var n=$r;if(Kn){if(Qn){e:{for(var r=Qn,s=Jn;8!==r.nodeType;){if(!s){r=null;break e}if(null===(r=ou(r.nextSibling))){r=null;break e}}r="F!"===(s=r.data)||"F"===s?r:null}if(r){Qn=ou(r.nextSibling),n="F!"===r.data;break t}}tr(n)}n=!1}n&&(e=i[0])}}return(i=ys()).memoizedState=i.baseState=e,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Vs,lastRenderedState:e},i.queue=n,i=ya.bind(null,$r,n),n.dispatch=i,n=Rs(!1),s=xa.bind(null,$r,!1,n.queue),r={state:e,dispatch:null,action:t,pending:null},(n=ys()).queue=r,i=Ls.bind(null,$r,r,s,i),r.dispatch=i,n.memoizedState=t,[e,i,!1]}function Gs(t){return Hs(bs(),ts,t)}function Hs(t,e,i){e=_s(t,e,Vs)[0],t=Es(As)[0],e="object"===typeof e&&null!==e&&"function"===typeof e.then?xs(e):e;var n=bs(),r=n.queue,s=r.dispatch;return i!==n.memoizedState&&($r.flags|=2048,Ys(9,Ws.bind(null,r,i),{destroy:void 0},null)),[e,s,t]}function Ws(t,e){t.action=e}function qs(t){var e=bs(),i=ts;if(null!==i)return Hs(e,i,t);bs(),e=e.memoizedState;var n=(i=bs()).queue.dispatch;return i.memoizedState=t,[e,n,!1]}function Ys(t,e,i,n){return t={tag:t,create:e,inst:i,deps:n,next:null},null===(e=$r.updateQueue)&&(e={lastEffect:null,events:null,stores:null,memoCache:null},$r.updateQueue=e),null===(i=e.lastEffect)?e.lastEffect=t.next=t:(n=i.next,i.next=t,t.next=n,e.lastEffect=t),t}function Xs(){return bs().memoizedState}function Qs(t,e,i,n){var r=ys();$r.flags|=t,r.memoizedState=Ys(1|e,i,{destroy:void 0},void 0===n?null:n)}function Ks(t,e,i,n){var r=bs();n=void 0===n?null:n;var s=r.memoizedState.inst;null!==ts&&null!==n&&cs(n,ts.memoizedState.deps)?r.memoizedState=Ys(e,i,s,n):($r.flags|=t,r.memoizedState=Ys(1|e,i,s,n))}function Zs(t,e){Qs(8390656,8,t,e)}function Js(t,e){Ks(2048,8,t,e)}function $s(t,e){return Ks(4,2,t,e)}function ta(t,e){return Ks(4,4,t,e)}function ea(t,e){if("function"===typeof e){t=t();var i=e(t);return function(){"function"===typeof i?i():e(null)}}if(null!==e&&void 0!==e)return t=t(),e.current=t,function(){e.current=null}}function ia(t,e,i){i=null!==i&&void 0!==i?i.concat([t]):null,Ks(4,4,ea.bind(null,e,t),i)}function na(){}function ra(t,e){var i=bs();e=void 0===e?null:e;var n=i.memoizedState;return null!==e&&cs(e,n[1])?n[0]:(i.memoizedState=[t,e],t)}function sa(t,e){var i=bs();e=void 0===e?null:e;var n=i.memoizedState;if(null!==e&&cs(e,n[1]))return n[0];if(n=t(),rs){bt(!0);try{t()}finally{bt(!1)}}return i.memoizedState=[n,e],n}function aa(t,e,i){return void 0===i||0!==(1073741824&Jr)?t.memoizedState=e:(t.memoizedState=i,t=kh(),$r.lanes|=t,uh|=t,i)}function oa(t,e,i,n){return Yi(i,e)?i:null!==Ar.current?(t=aa(t,i,n),Yi(t,e)||(Ga=!0),t):0===(42&Jr)?(Ga=!0,t.memoizedState=i):(t=kh(),$r.lanes|=t,uh|=t,e)}function la(t,e,i,n,r){var s=j.p;j.p=0!==s&&8>s?s:8;var a=D.T,o={};D.T=o,xa(t,!1,e,i);try{var l=r(),h=D.S;if(null!==h&&h(o,l),null!==l&&"object"===typeof l&&"function"===typeof l.then)ba(t,e,function(t,e){var i=[],n={status:"pending",value:null,reason:null,then:function(t){i.push(t)}};return t.then((function(){n.status="fulfilled",n.value=e;for(var t=0;t<i.length;t++)(0,i[t])(e)}),(function(t){for(n.status="rejected",n.reason=t,t=0;t<i.length;t++)(0,i[t])(void 0)})),n}(l,n),Dh());else ba(t,e,n,Dh())}catch(c){ba(t,e,{then:function(){},status:"rejected",reason:c},Dh())}finally{j.p=s,D.T=a}}function ha(){}function ca(t,e,i,n){if(5!==t.tag)throw Error(a(476));var r=ua(t).queue;la(t,r,e,G,null===i?ha:function(){return da(t),i(n)})}function ua(t){var e=t.memoizedState;if(null!==e)return e;var i={};return(e={memoizedState:G,baseState:G,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:As,lastRenderedState:G},next:null}).next={memoizedState:i,baseState:i,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:As,lastRenderedState:i},next:null},t.memoizedState=e,null!==(t=t.alternate)&&(t.memoizedState=e),e}function da(t){ba(t,ua(t).next.queue,{},Dh())}function pa(){return _o(Bu)}function fa(){return bs().memoizedState}function ma(){return bs().memoizedState}function ga(t){for(var e=t.return;null!==e;){switch(e.tag){case 24:case 3:var i=Dh(),n=Io(e,t=ko(i),i);return null!==n&&(Ih(n,e,i),Ro(n,e,i)),e={cache:Ur()},void(t.payload=e)}e=e.return}}function va(t,e,i){var n=Dh();i={lane:n,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null},wa(t)?Sa(e,i):null!==(i=Pn(t,e,i,n))&&(Ih(i,t,n),Aa(i,e,n))}function ya(t,e,i){ba(t,e,i,Dh())}function ba(t,e,i,n){var r={lane:n,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null};if(wa(t))Sa(e,r);else{var s=t.alternate;if(0===t.lanes&&(null===s||0===s.lanes)&&null!==(s=e.lastRenderedReducer))try{var a=e.lastRenderedState,o=s(a,i);if(r.hasEagerState=!0,r.eagerState=o,Yi(o,a))return Mn(t,e,r,0),null===eh&&Cn(),!1}catch(l){}if(null!==(i=Pn(t,e,r,n)))return Ih(i,t,n),Aa(i,e,n),!0}return!1}function xa(t,e,i,n){if(n={lane:2,revertLane:wc(),action:n,hasEagerState:!1,eagerState:null,next:null},wa(t)){if(e)throw Error(a(479))}else null!==(e=Pn(t,i,n,2))&&Ih(e,t,2)}function wa(t){var e=t.alternate;return t===$r||null!==e&&e===$r}function Sa(t,e){ns=is=!0;var i=t.pending;null===i?e.next=e:(e.next=i.next,i.next=e),t.pending=e}function Aa(t,e,i){if(0!==(4194176&i)){var n=e.lanes;i|=n&=t.pendingLanes,e.lanes=i,Ot(t,i)}}var Ea={readContext:_o,use:ws,useCallback:hs,useContext:hs,useEffect:hs,useImperativeHandle:hs,useLayoutEffect:hs,useInsertionEffect:hs,useMemo:hs,useReducer:hs,useRef:hs,useState:hs,useDebugValue:hs,useDeferredValue:hs,useTransition:hs,useSyncExternalStore:hs,useId:hs};Ea.useCacheRefresh=hs,Ea.useMemoCache=hs,Ea.useHostTransitionStatus=hs,Ea.useFormState=hs,Ea.useActionState=hs,Ea.useOptimistic=hs;var _a={readContext:_o,use:ws,useCallback:function(t,e){return ys().memoizedState=[t,void 0===e?null:e],t},useContext:_o,useEffect:Zs,useImperativeHandle:function(t,e,i){i=null!==i&&void 0!==i?i.concat([t]):null,Qs(4194308,4,ea.bind(null,e,t),i)},useLayoutEffect:function(t,e){return Qs(4194308,4,t,e)},useInsertionEffect:function(t,e){Qs(4,2,t,e)},useMemo:function(t,e){var i=ys();e=void 0===e?null:e;var n=t();if(rs){bt(!0);try{t()}finally{bt(!1)}}return i.memoizedState=[n,e],n},useReducer:function(t,e,i){var n=ys();if(void 0!==i){var r=i(e);if(rs){bt(!0);try{i(e)}finally{bt(!1)}}}else r=e;return n.memoizedState=n.baseState=r,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:r},n.queue=t,t=t.dispatch=va.bind(null,$r,t),[n.memoizedState,t]},useRef:function(t){return t={current:t},ys().memoizedState=t},useState:function(t){var e=(t=Rs(t)).queue,i=ya.bind(null,$r,e);return e.dispatch=i,[t.memoizedState,i]},useDebugValue:na,useDeferredValue:function(t,e){return aa(ys(),t,e)},useTransition:function(){var t=Rs(!1);return t=la.bind(null,$r,t.queue,!0,!1),ys().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,e,i){var n=$r,r=ys();if(Kn){if(void 0===i)throw Error(a(407));i=i()}else{if(i=e(),null===eh)throw Error(a(349));0!==(60&nh)||Ps(n,e,i)}r.memoizedState=i;var s={value:i,getSnapshot:e};return r.queue=s,Zs(Ds.bind(null,n,s,t),[t]),n.flags|=2048,Ys(9,Ts.bind(null,n,s,i,e),{destroy:void 0},null),i},useId:function(){var t=ys(),e=eh.identifierPrefix;if(Kn){var i=Gn;e=":"+e+"R"+(i=(jn&~(1<<32-xt(jn)-1)).toString(32)+i),0<(i=ss++)&&(e+="H"+i.toString(32)),e+=":"}else e=":"+e+"r"+(i=ls++).toString(32)+":";return t.memoizedState=e},useCacheRefresh:function(){return ys().memoizedState=ga.bind(null,$r)}};_a.useMemoCache=Ss,_a.useHostTransitionStatus=pa,_a.useFormState=js,_a.useActionState=js,_a.useOptimistic=function(t){var e=ys();e.memoizedState=e.baseState=t;var i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return e.queue=i,e=xa.bind(null,$r,!0,i),i.dispatch=e,[t,e]};var Ca={readContext:_o,use:ws,useCallback:ra,useContext:_o,useEffect:Js,useImperativeHandle:ia,useInsertionEffect:$s,useLayoutEffect:ta,useMemo:sa,useReducer:Es,useRef:Xs,useState:function(){return Es(As)},useDebugValue:na,useDeferredValue:function(t,e){return oa(bs(),ts.memoizedState,t,e)},useTransition:function(){var t=Es(As)[0],e=bs().memoizedState;return["boolean"===typeof t?t:xs(t),e]},useSyncExternalStore:Ms,useId:fa};Ca.useCacheRefresh=ma,Ca.useMemoCache=Ss,Ca.useHostTransitionStatus=pa,Ca.useFormState=Gs,Ca.useActionState=Gs,Ca.useOptimistic=function(t,e){return Os(bs(),0,t,e)};var Ma={readContext:_o,use:ws,useCallback:ra,useContext:_o,useEffect:Js,useImperativeHandle:ia,useInsertionEffect:$s,useLayoutEffect:ta,useMemo:sa,useReducer:Cs,useRef:Xs,useState:function(){return Cs(As)},useDebugValue:na,useDeferredValue:function(t,e){var i=bs();return null===ts?aa(i,t,e):oa(i,ts.memoizedState,t,e)},useTransition:function(){var t=Cs(As)[0],e=bs().memoizedState;return["boolean"===typeof t?t:xs(t),e]},useSyncExternalStore:Ms,useId:fa};function Pa(t,e,i,n){i=null===(i=i(n,e=t.memoizedState))||void 0===i?e:k({},e,i),t.memoizedState=i,0===t.lanes&&(t.updateQueue.baseState=i)}Ma.useCacheRefresh=ma,Ma.useMemoCache=Ss,Ma.useHostTransitionStatus=pa,Ma.useFormState=qs,Ma.useActionState=qs,Ma.useOptimistic=function(t,e){var i=bs();return null!==ts?Os(i,0,t,e):(i.baseState=t,[t,i.queue.dispatch])};var Ta={isMounted:function(t){return!!(t=t._reactInternals)&&z(t)===t},enqueueSetState:function(t,e,i){t=t._reactInternals;var n=Dh(),r=ko(n);r.payload=e,void 0!==i&&null!==i&&(r.callback=i),null!==(e=Io(t,r,n))&&(Ih(e,t,n),Ro(e,t,n))},enqueueReplaceState:function(t,e,i){t=t._reactInternals;var n=Dh(),r=ko(n);r.tag=1,r.payload=e,void 0!==i&&null!==i&&(r.callback=i),null!==(e=Io(t,r,n))&&(Ih(e,t,n),Ro(e,t,n))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var i=Dh(),n=ko(i);n.tag=2,void 0!==e&&null!==e&&(n.callback=e),null!==(e=Io(t,n,i))&&(Ih(e,t,i),Ro(e,t,i))}};function Da(t,e,i,n,r,s,a){return"function"===typeof(t=t.stateNode).shouldComponentUpdate?t.shouldComponentUpdate(n,s,a):!e.prototype||!e.prototype.isPureReactComponent||(!Xi(i,n)||!Xi(r,s))}function ka(t,e,i,n){t=e.state,"function"===typeof e.componentWillReceiveProps&&e.componentWillReceiveProps(i,n),"function"===typeof e.UNSAFE_componentWillReceiveProps&&e.UNSAFE_componentWillReceiveProps(i,n),e.state!==t&&Ta.enqueueReplaceState(e,e.state,null)}function Ia(t,e){var i=e;if("ref"in e)for(var n in i={},e)"ref"!==n&&(i[n]=e[n]);if(t=t.defaultProps)for(var r in i===e&&(i=k({},i)),t)void 0===i[r]&&(i[r]=t[r]);return i}var Ra="function"===typeof reportError?reportError:function(t){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof t&&null!==t&&"string"===typeof t.message?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",t);console.error(t)};function Oa(t){Ra(t)}function La(t){console.error(t)}function Ba(t){Ra(t)}function za(t,e){try{(0,t.onUncaughtError)(e.value,{componentStack:e.stack})}catch(i){setTimeout((function(){throw i}))}}function Fa(t,e,i){try{(0,t.onCaughtError)(i.value,{componentStack:i.stack,errorBoundary:1===e.tag?e.stateNode:null})}catch(n){setTimeout((function(){throw n}))}}function Na(t,e,i){return(i=ko(i)).tag=3,i.payload={element:null},i.callback=function(){za(t,e)},i}function Ua(t){return(t=ko(t)).tag=3,t}function Va(t,e,i,n){var r=i.type.getDerivedStateFromError;if("function"===typeof r){var s=n.value;t.payload=function(){return r(s)},t.callback=function(){Fa(e,i,n)}}var a=i.stateNode;null!==a&&"function"===typeof a.componentDidCatch&&(t.callback=function(){Fa(e,i,n),"function"!==typeof r&&(null===Sh?Sh=new Set([this]):Sh.add(this));var t=n.stack;this.componentDidCatch(n.value,{componentStack:null!==t?t:""})})}var ja=Error(a(461)),Ga=!1;function Ha(t,e,i,n){e.child=null===t?Sr(e,null,i,n):wr(e,t.child,i,n)}function Wa(t,e,i,n,r){i=i.render;var s=e.ref;if("ref"in n){var a={};for(var o in n)"ref"!==o&&(a[o]=n[o])}else a=n;return Eo(e),n=us(t,e,i,a,s,r),o=ms(),null===t||Ga?(Kn&&o&&qn(e),e.flags|=1,Ha(t,e,n,r),e.child):(gs(t,e,r),uo(t,e,r))}function qa(t,e,i,n,r){if(null===t){var s=i.type;return"function"!==typeof s||Bl(s)||void 0!==s.defaultProps||null!==i.compare?((t=Nl(i.type,null,n,e,e.mode,r)).ref=e.ref,t.return=e,e.child=t):(e.tag=15,e.type=s,Ya(t,e,s,n,r))}if(s=t.child,!po(t,r)){var a=s.memoizedProps;if((i=null!==(i=i.compare)?i:Xi)(a,n)&&t.ref===e.ref)return uo(t,e,r)}return e.flags|=1,(t=zl(s,n)).ref=e.ref,t.return=e,e.child=t}function Ya(t,e,i,n,r){if(null!==t){var s=t.memoizedProps;if(Xi(s,n)&&t.ref===e.ref){if(Ga=!1,e.pendingProps=n=s,!po(t,r))return e.lanes=t.lanes,uo(t,e,r);0!==(131072&t.flags)&&(Ga=!0)}}return Za(t,e,i,n,r)}function Xa(t,e,i){var n=e.pendingProps,r=n.children,s=0!==(2&e.stateNode._pendingVisibility),a=null!==t?t.memoizedState:null;if(Ka(t,e),"hidden"===n.mode||s){if(0!==(128&e.flags)){if(n=null!==a?a.baseLanes|i:i,null!==t){for(r=e.child=t.child,s=0;null!==r;)s=s|r.lanes|r.childLanes,r=r.sibling;e.childLanes=s&~n}else e.childLanes=0,e.child=null;return Qa(t,e,n,i)}if(0===(536870912&i))return e.lanes=e.childLanes=536870912,Qa(t,e,null!==a?a.baseLanes|i:i,i);e.memoizedState={baseLanes:0,cachePool:null},null!==t&&Kr(0,null!==a?a.cachePool:null),null!==a?_r(e,a):Cr(),kr(e)}else null!==a?(Kr(0,a.cachePool),_r(e,a),Ir(),e.memoizedState=null):(null!==t&&Kr(0,null),Cr(),Ir());return Ha(t,e,r,i),e.child}function Qa(t,e,i,n){var r=Qr();return r=null===r?null:{parent:Nr._currentValue,pool:r},e.memoizedState={baseLanes:i,cachePool:r},null!==t&&Kr(0,null),Cr(),kr(e),null!==t&&So(t,e,n,!0),null}function Ka(t,e){var i=e.ref;if(null===i)null!==t&&null!==t.ref&&(e.flags|=2097664);else{if("function"!==typeof i&&"object"!==typeof i)throw Error(a(284));null!==t&&t.ref===i||(e.flags|=2097664)}}function Za(t,e,i,n,r){return Eo(e),i=us(t,e,i,n,void 0,r),n=ms(),null===t||Ga?(Kn&&n&&qn(e),e.flags|=1,Ha(t,e,i,r),e.child):(gs(t,e,r),uo(t,e,r))}function Ja(t,e,i,n,r,s){return Eo(e),e.updateQueue=null,i=ps(e,n,i,r),ds(t),n=ms(),null===t||Ga?(Kn&&n&&qn(e),e.flags|=1,Ha(t,e,i,s),e.child):(gs(t,e,s),uo(t,e,s))}function $a(t,e,i,n,r){if(Eo(e),null===e.stateNode){var s=In,a=i.contextType;"object"===typeof a&&null!==a&&(s=_o(a)),s=new i(n,s),e.memoizedState=null!==s.state&&void 0!==s.state?s.state:null,s.updater=Ta,e.stateNode=s,s._reactInternals=e,(s=e.stateNode).props=n,s.state=e.memoizedState,s.refs={},To(e),a=i.contextType,s.context="object"===typeof a&&null!==a?_o(a):In,s.state=e.memoizedState,"function"===typeof(a=i.getDerivedStateFromProps)&&(Pa(e,i,a,n),s.state=e.memoizedState),"function"===typeof i.getDerivedStateFromProps||"function"===typeof s.getSnapshotBeforeUpdate||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||(a=s.state,"function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount(),a!==s.state&&Ta.enqueueReplaceState(s,s.state,null),zo(e,n,s,r),Bo(),s.state=e.memoizedState),"function"===typeof s.componentDidMount&&(e.flags|=4194308),n=!0}else if(null===t){s=e.stateNode;var o=e.memoizedProps,l=Ia(i,o);s.props=l;var h=s.context,c=i.contextType;a=In,"object"===typeof c&&null!==c&&(a=_o(c));var u=i.getDerivedStateFromProps;c="function"===typeof u||"function"===typeof s.getSnapshotBeforeUpdate,o=e.pendingProps!==o,c||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(o||h!==a)&&ka(e,s,n,a),Po=!1;var d=e.memoizedState;s.state=d,zo(e,n,s,r),Bo(),h=e.memoizedState,o||d!==h||Po?("function"===typeof u&&(Pa(e,i,u,n),h=e.memoizedState),(l=Po||Da(e,i,l,n,d,h,a))?(c||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(e.flags|=4194308)):("function"===typeof s.componentDidMount&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=h),s.props=n,s.state=h,s.context=a,n=l):("function"===typeof s.componentDidMount&&(e.flags|=4194308),n=!1)}else{s=e.stateNode,Do(t,e),c=Ia(i,a=e.memoizedProps),s.props=c,u=e.pendingProps,d=s.context,h=i.contextType,l=In,"object"===typeof h&&null!==h&&(l=_o(h)),(h="function"===typeof(o=i.getDerivedStateFromProps)||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==u||d!==l)&&ka(e,s,n,l),Po=!1,d=e.memoizedState,s.state=d,zo(e,n,s,r),Bo();var p=e.memoizedState;a!==u||d!==p||Po||null!==t&&null!==t.dependencies&&Ao(t.dependencies)?("function"===typeof o&&(Pa(e,i,o,n),p=e.memoizedState),(c=Po||Da(e,i,c,n,d,p,l)||null!==t&&null!==t.dependencies&&Ao(t.dependencies))?(h||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(n,p,l),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(n,p,l)),"function"===typeof s.componentDidUpdate&&(e.flags|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(e.flags|=1024)):("function"!==typeof s.componentDidUpdate||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=p),s.props=n,s.state=p,s.context=l,n=c):("function"!==typeof s.componentDidUpdate||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),n=!1)}return s=n,Ka(t,e),n=0!==(128&e.flags),s||n?(s=e.stateNode,i=n&&"function"!==typeof i.getDerivedStateFromError?null:s.render(),e.flags|=1,null!==t&&n?(e.child=wr(e,t.child,null,r),e.child=wr(e,null,i,r)):Ha(t,e,i,r),e.memoizedState=s.state,t=e.child):t=uo(t,e,r),t}function to(t,e,i,n){return rr(),e.flags|=256,Ha(t,e,i,n),e.child}var eo={dehydrated:null,treeContext:null,retryLane:0};function io(t){return{baseLanes:t,cachePool:Zr()}}function no(t,e,i){return t=null!==t?t.childLanes&~i:0,e&&(t|=fh),t}function ro(t,e,i){var n,r=e.pendingProps,s=!1,o=0!==(128&e.flags);if((n=o)||(n=(null===t||null!==t.memoizedState)&&0!==(2&Or.current)),n&&(s=!0,e.flags&=-129),n=0!==(32&e.flags),e.flags&=-33,null===t){if(Kn){if(s?Dr(e):Ir(),Kn){var l,h=Qn;if(l=h){t:{for(l=h,h=Jn;8!==l.nodeType;){if(!h){h=null;break t}if(null===(l=ou(l.nextSibling))){h=null;break t}}h=l}null!==h?(e.memoizedState={dehydrated:h,treeContext:null!==Vn?{id:jn,overflow:Gn}:null,retryLane:536870912},(l=Ll(18,null,null,0)).stateNode=h,l.return=e,e.child=l,Xn=e,Qn=null,l=!0):l=!1}l||tr(e)}if(null!==(h=e.memoizedState)&&null!==(h=h.dehydrated))return"$!"===h.data?e.lanes=16:e.lanes=536870912,null;Rr(e)}return h=r.children,r=r.fallback,s?(Ir(),h=ao({mode:"hidden",children:h},s=e.mode),r=Ul(r,s,i,null),h.return=e,r.return=e,h.sibling=r,e.child=h,(s=e.child).memoizedState=io(i),s.childLanes=no(t,n,i),e.memoizedState=eo,r):(Dr(e),so(e,h))}if(null!==(l=t.memoizedState)&&null!==(h=l.dehydrated)){if(o)256&e.flags?(Dr(e),e.flags&=-257,e=oo(t,e,i)):null!==e.memoizedState?(Ir(),e.child=t.child,e.flags|=128,e=null):(Ir(),s=r.fallback,h=e.mode,r=ao({mode:"visible",children:r.children},h),(s=Ul(s,h,i,null)).flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,wr(e,t.child,null,i),(r=e.child).memoizedState=io(i),r.childLanes=no(t,n,i),e.memoizedState=eo,e=s);else if(Dr(e),"$!"===h.data){if(n=h.nextSibling&&h.nextSibling.dataset)var c=n.dgst;n=c,(r=Error(a(419))).stack="",r.digest=n,sr({value:r,source:null,stack:null}),e=oo(t,e,i)}else if(Ga||So(t,e,i,!1),n=0!==(i&t.childLanes),Ga||n){if(null!==(n=eh)){if(0!==(42&(r=i&-i)))r=1;else switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=64;break;case 268435456:r=134217728;break;default:r=0}if(0!==(r=0!==(r&(n.suspendedLanes|i))?0:r)&&r!==l.retryLane)throw l.retryLane=r,Tn(t,r),Ih(n,t,r),ja}"$?"===h.data||Hh(),e=oo(t,e,i)}else"$?"===h.data?(e.flags|=128,e.child=t.child,e=oc.bind(null,t),h._reactRetry=e,e=null):(t=l.treeContext,Qn=ou(h.nextSibling),Xn=e,Kn=!0,Zn=null,Jn=!1,null!==t&&(Nn[Un++]=jn,Nn[Un++]=Gn,Nn[Un++]=Vn,jn=t.id,Gn=t.overflow,Vn=e),(e=so(e,r.children)).flags|=4096);return e}return s?(Ir(),s=r.fallback,h=e.mode,c=(l=t.child).sibling,(r=zl(l,{mode:"hidden",children:r.children})).subtreeFlags=31457280&l.subtreeFlags,null!==c?s=zl(c,s):(s=Ul(s,h,i,null)).flags|=2,s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,null===(h=t.child.memoizedState)?h=io(i):(null!==(l=h.cachePool)?(c=Nr._currentValue,l=l.parent!==c?{parent:c,pool:c}:l):l=Zr(),h={baseLanes:h.baseLanes|i,cachePool:l}),s.memoizedState=h,s.childLanes=no(t,n,i),e.memoizedState=eo,r):(Dr(e),t=(i=t.child).sibling,(i=zl(i,{mode:"visible",children:r.children})).return=e,i.sibling=null,null!==t&&(null===(n=e.deletions)?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i)}function so(t,e){return(e=ao({mode:"visible",children:e},t.mode)).return=t,t.child=e}function ao(t,e){return Vl(t,e,0,null)}function oo(t,e,i){return wr(e,t.child,null,i),(t=so(e,e.pendingProps.children)).flags|=2,e.memoizedState=null,t}function lo(t,e,i){t.lanes|=e;var n=t.alternate;null!==n&&(n.lanes|=e),xo(t.return,e,i)}function ho(t,e,i,n,r){var s=t.memoizedState;null===s?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:i,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=i,s.tailMode=r)}function co(t,e,i){var n=e.pendingProps,r=n.revealOrder,s=n.tail;if(Ha(t,e,n.children,i),0!==(2&(n=Or.current)))n=1&n|2,e.flags|=128;else{if(null!==t&&0!==(128&t.flags))t:for(t=e.child;null!==t;){if(13===t.tag)null!==t.memoizedState&&lo(t,i,e);else if(19===t.tag)lo(t,i,e);else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break t;for(;null===t.sibling;){if(null===t.return||t.return===e)break t;t=t.return}t.sibling.return=t.return,t=t.sibling}n&=1}switch(X(Or,n),r){case"forwards":for(i=e.child,r=null;null!==i;)null!==(t=i.alternate)&&null===Lr(t)&&(r=i),i=i.sibling;null===(i=r)?(r=e.child,e.child=null):(r=i.sibling,i.sibling=null),ho(e,!1,r,i,s);break;case"backwards":for(i=null,r=e.child,e.child=null;null!==r;){if(null!==(t=r.alternate)&&null===Lr(t)){e.child=r;break}t=r.sibling,r.sibling=i,i=r,r=t}ho(e,!0,i,null,s);break;case"together":ho(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function uo(t,e,i){if(null!==t&&(e.dependencies=t.dependencies),uh|=e.lanes,0===(i&e.childLanes)){if(null===t)return null;if(So(t,e,i,!1),0===(i&e.childLanes))return null}if(null!==t&&e.child!==t.child)throw Error(a(153));if(null!==e.child){for(i=zl(t=e.child,t.pendingProps),e.child=i,i.return=e;null!==t.sibling;)t=t.sibling,(i=i.sibling=zl(t,t.pendingProps)).return=e;i.sibling=null}return e.child}function po(t,e){return 0!==(t.lanes&e)||!(null===(t=t.dependencies)||!Ao(t))}function fo(t,e,i){if(null!==t)if(t.memoizedProps!==e.pendingProps)Ga=!0;else{if(!po(t,i)&&0===(128&e.flags))return Ga=!1,function(t,e,i){switch(e.tag){case 3:$(e,e.stateNode.containerInfo),yo(e,Nr,t.memoizedState.cache),rr();break;case 27:case 5:et(e);break;case 4:$(e,e.stateNode.containerInfo);break;case 10:yo(e,e.type,e.memoizedProps.value);break;case 13:var n=e.memoizedState;if(null!==n)return null!==n.dehydrated?(Dr(e),e.flags|=128,null):0!==(i&e.child.childLanes)?ro(t,e,i):(Dr(e),null!==(t=uo(t,e,i))?t.sibling:null);Dr(e);break;case 19:var r=0!==(128&t.flags);if((n=0!==(i&e.childLanes))||(So(t,e,i,!1),n=0!==(i&e.childLanes)),r){if(n)return co(t,e,i);e.flags|=128}if(null!==(r=e.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),X(Or,Or.current),n)break;return null;case 22:case 23:return e.lanes=0,Xa(t,e,i);case 24:yo(e,Nr,t.memoizedState.cache)}return uo(t,e,i)}(t,e,i);Ga=0!==(131072&t.flags)}else Ga=!1,Kn&&0!==(1048576&e.flags)&&Wn(e,Fn,e.index);switch(e.lanes=0,e.tag){case 16:t:{t=e.pendingProps;var n=e.elementType,r=n._init;if(n=r(n._payload),e.type=n,"function"!==typeof n){if(void 0!==n&&null!==n){if((r=n.$$typeof)===v){e.tag=11,e=Wa(null,e,n,t,i);break t}if(r===x){e.tag=14,e=qa(null,e,n,t,i);break t}}throw e=M(n)||n,Error(a(306,e,""))}Bl(n)?(t=Ia(n,t),e.tag=1,e=$a(null,e,n,t,i)):(e.tag=0,e=Za(null,e,n,t,i))}return e;case 0:return Za(t,e,e.type,e.pendingProps,i);case 1:return $a(t,e,n=e.type,r=Ia(n,e.pendingProps),i);case 3:t:{if($(e,e.stateNode.containerInfo),null===t)throw Error(a(387));var s=e.pendingProps;n=(r=e.memoizedState).element,Do(t,e),zo(e,s,null,i);var o=e.memoizedState;if(s=o.cache,yo(e,Nr,s),s!==r.cache&&wo(e,[Nr],i,!0),Bo(),s=o.element,r.isDehydrated){if(r={element:s,isDehydrated:!1,cache:o.cache},e.updateQueue.baseState=r,e.memoizedState=r,256&e.flags){e=to(t,e,s,i);break t}if(s!==n){sr(n=On(Error(a(424)),e)),e=to(t,e,s,i);break t}for(Qn=ou(e.stateNode.containerInfo.firstChild),Xn=e,Kn=!0,Zn=null,Jn=!0,i=Sr(e,null,s,i),e.child=i;i;)i.flags=-3&i.flags|4096,i=i.sibling}else{if(rr(),s===n){e=uo(t,e,i);break t}Ha(t,e,s,i)}e=e.child}return e;case 26:return Ka(t,e),null===t?(i=gu(e.type,null,e.pendingProps,null))?e.memoizedState=i:Kn||(i=e.type,t=e.pendingProps,(n=Qc(Z.current).createElement(i))[Ft]=e,n[Nt]=t,qc(n,i,t),Zt(n),e.stateNode=n):e.memoizedState=gu(e.type,t.memoizedProps,e.pendingProps,t.memoizedState),null;case 27:return et(e),null===t&&Kn&&(n=e.stateNode=hu(e.type,e.pendingProps,Z.current),Xn=e,Jn=!0,Qn=ou(n.firstChild)),n=e.pendingProps.children,null!==t||Kn?Ha(t,e,n,i):e.child=wr(e,null,n,i),Ka(t,e),e.child;case 5:return null===t&&Kn&&((r=n=Qn)&&(null!==(n=function(t,e,i,n){for(;1===t.nodeType;){var r=i;if(t.nodeName.toLowerCase()!==e.toLowerCase()){if(!n&&("INPUT"!==t.nodeName||"hidden"!==t.type))break}else if(n){if(!t[Wt])switch(e){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if("stylesheet"===(s=t.getAttribute("rel"))&&t.hasAttribute("data-precedence"))break;if(s!==r.rel||t.getAttribute("href")!==(null==r.href?null:r.href)||t.getAttribute("crossorigin")!==(null==r.crossOrigin?null:r.crossOrigin)||t.getAttribute("title")!==(null==r.title?null:r.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(((s=t.getAttribute("src"))!==(null==r.src?null:r.src)||t.getAttribute("type")!==(null==r.type?null:r.type)||t.getAttribute("crossorigin")!==(null==r.crossOrigin?null:r.crossOrigin))&&s&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else{if("input"!==e||"hidden"!==t.type)return t;var s=null==r.name?null:""+r.name;if("hidden"===r.type&&t.getAttribute("name")===s)return t}if(null===(t=ou(t.nextSibling)))break}return null}(n,e.type,e.pendingProps,Jn))?(e.stateNode=n,Xn=e,Qn=ou(n.firstChild),Jn=!1,r=!0):r=!1),r||tr(e)),et(e),r=e.type,s=e.pendingProps,o=null!==t?t.memoizedProps:null,n=s.children,Jc(r,s)?n=null:null!==o&&Jc(r,o)&&(e.flags|=32),null!==e.memoizedState&&(r=us(t,e,fs,null,null,i),Bu._currentValue=r),Ka(t,e),Ha(t,e,n,i),e.child;case 6:return null===t&&Kn&&((t=i=Qn)&&(null!==(i=function(t,e,i){if(""===e)return null;for(;3!==t.nodeType;){if((1!==t.nodeType||"INPUT"!==t.nodeName||"hidden"!==t.type)&&!i)return null;if(null===(t=ou(t.nextSibling)))return null}return t}(i,e.pendingProps,Jn))?(e.stateNode=i,Xn=e,Qn=null,t=!0):t=!1),t||tr(e)),null;case 13:return ro(t,e,i);case 4:return $(e,e.stateNode.containerInfo),n=e.pendingProps,null===t?e.child=wr(e,null,n,i):Ha(t,e,n,i),e.child;case 11:return Wa(t,e,e.type,e.pendingProps,i);case 7:return Ha(t,e,e.pendingProps,i),e.child;case 8:case 12:return Ha(t,e,e.pendingProps.children,i),e.child;case 10:return n=e.pendingProps,yo(e,e.type,n.value),Ha(t,e,n.children,i),e.child;case 9:return r=e.type._context,n=e.pendingProps.children,Eo(e),n=n(r=_o(r)),e.flags|=1,Ha(t,e,n,i),e.child;case 14:return qa(t,e,e.type,e.pendingProps,i);case 15:return Ya(t,e,e.type,e.pendingProps,i);case 19:return co(t,e,i);case 22:return Xa(t,e,i);case 24:return Eo(e),n=_o(Nr),null===t?(null===(r=Qr())&&(r=eh,s=Ur(),r.pooledCache=s,s.refCount++,null!==s&&(r.pooledCacheLanes|=i),r=s),e.memoizedState={parent:n,cache:r},To(e),yo(e,Nr,r)):(0!==(t.lanes&i)&&(Do(t,e),zo(e,null,null,i),Bo()),r=t.memoizedState,s=e.memoizedState,r.parent!==n?(r={parent:n,cache:n},e.memoizedState=r,0===e.lanes&&(e.memoizedState=e.updateQueue.baseState=r),yo(e,Nr,n)):(n=s.cache,yo(e,Nr,n),n!==r.cache&&wo(e,[Nr],i,!0))),Ha(t,e,e.pendingProps.children,i),e.child;case 29:throw e.pendingProps}throw Error(a(156,e.tag))}var mo=q(null),go=null,vo=null;function yo(t,e,i){X(mo,e._currentValue),e._currentValue=i}function bo(t){t._currentValue=mo.current,Y(mo)}function xo(t,e,i){for(;null!==t;){var n=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,null!==n&&(n.childLanes|=e)):null!==n&&(n.childLanes&e)!==e&&(n.childLanes|=e),t===i)break;t=t.return}}function wo(t,e,i,n){var r=t.child;for(null!==r&&(r.return=t);null!==r;){var s=r.dependencies;if(null!==s){var o=r.child;s=s.firstContext;t:for(;null!==s;){var l=s;s=r;for(var h=0;h<e.length;h++)if(l.context===e[h]){s.lanes|=i,null!==(l=s.alternate)&&(l.lanes|=i),xo(s.return,i,t),n||(o=null);break t}s=l.next}}else if(18===r.tag){if(null===(o=r.return))throw Error(a(341));o.lanes|=i,null!==(s=o.alternate)&&(s.lanes|=i),xo(o,i,t),o=null}else o=r.child;if(null!==o)o.return=r;else for(o=r;null!==o;){if(o===t){o=null;break}if(null!==(r=o.sibling)){r.return=o.return,o=r;break}o=o.return}r=o}}function So(t,e,i,n){t=null;for(var r=e,s=!1;null!==r;){if(!s)if(0!==(524288&r.flags))s=!0;else if(0!==(262144&r.flags))break;if(10===r.tag){var o=r.alternate;if(null===o)throw Error(a(387));if(null!==(o=o.memoizedProps)){var l=r.type;Yi(r.pendingProps.value,o.value)||(null!==t?t.push(l):t=[l])}}else if(r===J.current){if(null===(o=r.alternate))throw Error(a(387));o.memoizedState.memoizedState!==r.memoizedState.memoizedState&&(null!==t?t.push(Bu):t=[Bu])}r=r.return}null!==t&&wo(e,t,i,n),e.flags|=262144}function Ao(t){for(t=t.firstContext;null!==t;){if(!Yi(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function Eo(t){go=t,vo=null,null!==(t=t.dependencies)&&(t.firstContext=null)}function _o(t){return Mo(go,t)}function Co(t,e){return null===go&&Eo(t),Mo(t,e)}function Mo(t,e){var i=e._currentValue;if(e={context:e,memoizedValue:i,next:null},null===vo){if(null===t)throw Error(a(308));vo=e,t.dependencies={lanes:0,firstContext:e},t.flags|=524288}else vo=vo.next=e;return i}var Po=!1;function To(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Do(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function ko(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function Io(t,e,i){var n=t.updateQueue;if(null===n)return null;if(n=n.shared,0!==(2&th)){var r=n.pending;return null===r?e.next=e:(e.next=r.next,r.next=e),n.pending=e,e=kn(t),Dn(t,null,i),e}return Mn(t,n,e,i),kn(t)}function Ro(t,e,i){if(null!==(e=e.updateQueue)&&(e=e.shared,0!==(4194176&i))){var n=e.lanes;i|=n&=t.pendingLanes,e.lanes=i,Ot(t,i)}}function Oo(t,e){var i=t.updateQueue,n=t.alternate;if(null!==n&&i===(n=n.updateQueue)){var r=null,s=null;if(null!==(i=i.firstBaseUpdate)){do{var a={lane:i.lane,tag:i.tag,payload:i.payload,callback:null,next:null};null===s?r=s=a:s=s.next=a,i=i.next}while(null!==i);null===s?r=s=e:s=s.next=e}else r=s=e;return i={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:n.shared,callbacks:n.callbacks},void(t.updateQueue=i)}null===(t=i.lastBaseUpdate)?i.firstBaseUpdate=e:t.next=e,i.lastBaseUpdate=e}var Lo=!1;function Bo(){if(Lo){if(null!==Wr)throw Wr}}function zo(t,e,i,n){Lo=!1;var r=t.updateQueue;Po=!1;var s=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(null!==o){r.shared.pending=null;var l=o,h=l.next;l.next=null,null===a?s=h:a.next=h,a=l;var c=t.alternate;null!==c&&((o=(c=c.updateQueue).lastBaseUpdate)!==a&&(null===o?c.firstBaseUpdate=h:o.next=h,c.lastBaseUpdate=l))}if(null!==s){var u=r.baseState;for(a=0,c=h=l=null,o=s;;){var d=-536870913&o.lane,p=d!==o.lane;if(p?(nh&d)===d:(n&d)===d){0!==d&&d===Hr&&(Lo=!0),null!==c&&(c=c.next={lane:0,tag:o.tag,payload:o.payload,callback:null,next:null});t:{var f=t,m=o;d=e;var g=i;switch(m.tag){case 1:if("function"===typeof(f=m.payload)){u=f.call(g,u,d);break t}u=f;break t;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(d="function"===typeof(f=m.payload)?f.call(g,u,d):f)||void 0===d)break t;u=k({},u,d);break t;case 2:Po=!0}}null!==(d=o.callback)&&(t.flags|=64,p&&(t.flags|=8192),null===(p=r.callbacks)?r.callbacks=[d]:p.push(d))}else p={lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===c?(h=c=p,l=u):c=c.next=p,a|=d;if(null===(o=o.next)){if(null===(o=r.shared.pending))break;o=(p=o).next,p.next=null,r.lastBaseUpdate=p,r.shared.pending=null}}null===c&&(l=u),r.baseState=l,r.firstBaseUpdate=h,r.lastBaseUpdate=c,null===s&&(r.shared.lanes=0),uh|=a,t.lanes=a,t.memoizedState=u}}function Fo(t,e){if("function"!==typeof t)throw Error(a(191,t));t.call(e)}function No(t,e){var i=t.callbacks;if(null!==i)for(t.callbacks=null,t=0;t<i.length;t++)Fo(i[t],e)}function Uo(t,e){try{var i=e.updateQueue,n=null!==i?i.lastEffect:null;if(null!==n){var r=n.next;i=r;do{if((i.tag&t)===t){n=void 0;var s=i.create,a=i.inst;n=s(),a.destroy=n}i=i.next}while(i!==r)}}catch(o){nc(e,e.return,o)}}function Vo(t,e,i){try{var n=e.updateQueue,r=null!==n?n.lastEffect:null;if(null!==r){var s=r.next;n=s;do{if((n.tag&t)===t){var a=n.inst,o=a.destroy;if(void 0!==o){a.destroy=void 0,r=e;var l=i;try{o()}catch(h){nc(r,l,h)}}}n=n.next}while(n!==s)}}catch(h){nc(e,e.return,h)}}function jo(t){var e=t.updateQueue;if(null!==e){var i=t.stateNode;try{No(e,i)}catch(n){nc(t,t.return,n)}}}function Go(t,e,i){i.props=Ia(t.type,t.memoizedProps),i.state=t.memoizedState;try{i.componentWillUnmount()}catch(n){nc(t,e,n)}}function Ho(t,e){try{var i=t.ref;if(null!==i){var n=t.stateNode;switch(t.tag){case 26:case 27:case 5:var r=n;break;default:r=n}"function"===typeof i?t.refCleanup=i(r):i.current=r}}catch(s){nc(t,e,s)}}function Wo(t,e){var i=t.ref,n=t.refCleanup;if(null!==i)if("function"===typeof n)try{n()}catch(r){nc(t,e,r)}finally{t.refCleanup=null,null!=(t=t.alternate)&&(t.refCleanup=null)}else if("function"===typeof i)try{i(null)}catch(s){nc(t,e,s)}else i.current=null}function qo(t){var e=t.type,i=t.memoizedProps,n=t.stateNode;try{t:switch(e){case"button":case"input":case"select":case"textarea":i.autoFocus&&n.focus();break t;case"img":i.src?n.src=i.src:i.srcSet&&(n.srcset=i.srcSet)}}catch(r){nc(t,t.return,r)}}function Yo(t,e,i){try{var n=t.stateNode;!function(t,e,i,n){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var r=null,s=null,o=null,l=null,h=null,c=null,u=null;for(f in i){var d=i[f];if(i.hasOwnProperty(f)&&null!=d)switch(f){case"checked":case"value":break;case"defaultValue":h=d;default:n.hasOwnProperty(f)||Hc(t,e,f,null,n,d)}}for(var p in n){var f=n[p];if(d=i[p],n.hasOwnProperty(p)&&(null!=f||null!=d))switch(p){case"type":s=f;break;case"name":r=f;break;case"checked":c=f;break;case"defaultChecked":u=f;break;case"value":o=f;break;case"defaultValue":l=f;break;case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(a(137,e));break;default:f!==d&&Hc(t,e,p,f,n,d)}}return void ge(t,o,l,h,c,u,s,r);case"select":for(s in f=o=l=p=null,i)if(h=i[s],i.hasOwnProperty(s)&&null!=h)switch(s){case"value":break;case"multiple":f=h;default:n.hasOwnProperty(s)||Hc(t,e,s,null,n,h)}for(r in n)if(s=n[r],h=i[r],n.hasOwnProperty(r)&&(null!=s||null!=h))switch(r){case"value":p=s;break;case"defaultValue":l=s;break;case"multiple":o=s;default:s!==h&&Hc(t,e,r,s,n,h)}return e=l,i=o,n=f,void(null!=p?be(t,!!i,p,!1):!!n!==!!i&&(null!=e?be(t,!!i,e,!0):be(t,!!i,i?[]:"",!1)));case"textarea":for(l in f=p=null,i)if(r=i[l],i.hasOwnProperty(l)&&null!=r&&!n.hasOwnProperty(l))switch(l){case"value":case"children":break;default:Hc(t,e,l,null,n,r)}for(o in n)if(r=n[o],s=i[o],n.hasOwnProperty(o)&&(null!=r||null!=s))switch(o){case"value":p=r;break;case"defaultValue":f=r;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=r)throw Error(a(91));break;default:r!==s&&Hc(t,e,o,r,n,s)}return void xe(t,p,f);case"option":for(var m in i)if(p=i[m],i.hasOwnProperty(m)&&null!=p&&!n.hasOwnProperty(m))if("selected"===m)t.selected=!1;else Hc(t,e,m,null,n,p);for(h in n)if(p=n[h],f=i[h],n.hasOwnProperty(h)&&p!==f&&(null!=p||null!=f))if("selected"===h)t.selected=p&&"function"!==typeof p&&"symbol"!==typeof p;else Hc(t,e,h,p,n,f);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var g in i)p=i[g],i.hasOwnProperty(g)&&null!=p&&!n.hasOwnProperty(g)&&Hc(t,e,g,null,n,p);for(c in n)if(p=n[c],f=i[c],n.hasOwnProperty(c)&&p!==f&&(null!=p||null!=f))switch(c){case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(a(137,e));break;default:Hc(t,e,c,p,n,f)}return;default:if(Ce(e)){for(var v in i)p=i[v],i.hasOwnProperty(v)&&void 0!==p&&!n.hasOwnProperty(v)&&Wc(t,e,v,void 0,n,p);for(u in n)p=n[u],f=i[u],!n.hasOwnProperty(u)||p===f||void 0===p&&void 0===f||Wc(t,e,u,p,n,f);return}}for(var y in i)p=i[y],i.hasOwnProperty(y)&&null!=p&&!n.hasOwnProperty(y)&&Hc(t,e,y,null,n,p);for(d in n)p=n[d],f=i[d],!n.hasOwnProperty(d)||p===f||null==p&&null==f||Hc(t,e,d,p,n,f)}(n,t.type,i,e),n[Nt]=e}catch(r){nc(t,t.return,r)}}function Xo(t){return 5===t.tag||3===t.tag||26===t.tag||27===t.tag||4===t.tag}function Qo(t){t:for(;;){for(;null===t.sibling;){if(null===t.return||Xo(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;5!==t.tag&&6!==t.tag&&27!==t.tag&&18!==t.tag;){if(2&t.flags)continue t;if(null===t.child||4===t.tag)continue t;t.child.return=t,t=t.child}if(!(2&t.flags))return t.stateNode}}function Ko(t,e,i){var n=t.tag;if(5===n||6===n)t=t.stateNode,e?8===i.nodeType?i.parentNode.insertBefore(t,e):i.insertBefore(t,e):(8===i.nodeType?(e=i.parentNode).insertBefore(t,i):(e=i).appendChild(t),null!==(i=i._reactRootContainer)&&void 0!==i||null!==e.onclick||(e.onclick=Gc));else if(4!==n&&27!==n&&null!==(t=t.child))for(Ko(t,e,i),t=t.sibling;null!==t;)Ko(t,e,i),t=t.sibling}function Zo(t,e,i){var n=t.tag;if(5===n||6===n)t=t.stateNode,e?i.insertBefore(t,e):i.appendChild(t);else if(4!==n&&27!==n&&null!==(t=t.child))for(Zo(t,e,i),t=t.sibling;null!==t;)Zo(t,e,i),t=t.sibling}var Jo=!1,$o=!1,tl=!1,el="function"===typeof WeakSet?WeakSet:Set,il=null,nl=!1;function rl(t,e,i){var n=i.flags;switch(i.tag){case 0:case 11:case 15:vl(t,i),4&n&&Uo(5,i);break;case 1:if(vl(t,i),4&n)if(t=i.stateNode,null===e)try{t.componentDidMount()}catch(o){nc(i,i.return,o)}else{var r=Ia(i.type,e.memoizedProps);e=e.memoizedState;try{t.componentDidUpdate(r,e,t.__reactInternalSnapshotBeforeUpdate)}catch(l){nc(i,i.return,l)}}64&n&&jo(i),512&n&&Ho(i,i.return);break;case 3:if(vl(t,i),64&n&&null!==(n=i.updateQueue)){if(t=null,null!==i.child)switch(i.child.tag){case 27:case 5:case 1:t=i.child.stateNode}try{No(n,t)}catch(o){nc(i,i.return,o)}}break;case 26:vl(t,i),512&n&&Ho(i,i.return);break;case 27:case 5:vl(t,i),null===e&&4&n&&qo(i),512&n&&Ho(i,i.return);break;case 12:default:vl(t,i);break;case 13:vl(t,i),4&n&&cl(t,i);break;case 22:if(!(r=null!==i.memoizedState||Jo)){e=null!==e&&null!==e.memoizedState||$o;var s=Jo,a=$o;Jo=r,($o=e)&&!a?bl(t,i,0!==(8772&i.subtreeFlags)):vl(t,i),Jo=s,$o=a}512&n&&("manual"===i.memoizedProps.mode?Ho(i,i.return):Wo(i,i.return))}}function sl(t){var e=t.alternate;null!==e&&(t.alternate=null,sl(e)),t.child=null,t.deletions=null,t.sibling=null,5===t.tag&&(null!==(e=t.stateNode)&&qt(e)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var al=null,ol=!1;function ll(t,e,i){for(i=i.child;null!==i;)hl(t,e,i),i=i.sibling}function hl(t,e,i){if(yt&&"function"===typeof yt.onCommitFiberUnmount)try{yt.onCommitFiberUnmount(vt,i)}catch(a){}switch(i.tag){case 26:$o||Wo(i,e),ll(t,e,i),i.memoizedState?i.memoizedState.count--:i.stateNode&&(i=i.stateNode).parentNode.removeChild(i);break;case 27:$o||Wo(i,e);var n=al,r=ol;for(al=i.stateNode,ll(t,e,i),e=(i=i.stateNode).attributes;e.length;)i.removeAttributeNode(e[0]);qt(i),al=n,ol=r;break;case 5:$o||Wo(i,e);case 6:r=al;var s=ol;if(al=null,ll(t,e,i),ol=s,null!==(al=r))if(ol)try{t=al,n=i.stateNode,8===t.nodeType?t.parentNode.removeChild(n):t.removeChild(n)}catch(o){nc(i,e,o)}else try{al.removeChild(i.stateNode)}catch(o){nc(i,e,o)}break;case 18:null!==al&&(ol?(e=al,i=i.stateNode,8===e.nodeType?su(e.parentNode,i):1===e.nodeType&&su(e,i),md(e)):su(al,i.stateNode));break;case 4:n=al,r=ol,al=i.stateNode.containerInfo,ol=!0,ll(t,e,i),al=n,ol=r;break;case 0:case 11:case 14:case 15:$o||Vo(2,i,e),$o||Vo(4,i,e),ll(t,e,i);break;case 1:$o||(Wo(i,e),"function"===typeof(n=i.stateNode).componentWillUnmount&&Go(i,e,n)),ll(t,e,i);break;case 21:ll(t,e,i);break;case 22:$o||Wo(i,e),$o=(n=$o)||null!==i.memoizedState,ll(t,e,i),$o=n;break;default:ll(t,e,i)}}function cl(t,e){if(null===e.memoizedState&&(null!==(t=e.alternate)&&(null!==(t=t.memoizedState)&&null!==(t=t.dehydrated))))try{md(t)}catch(i){nc(e,e.return,i)}}function ul(t,e){var i=function(t){switch(t.tag){case 13:case 19:var e=t.stateNode;return null===e&&(e=t.stateNode=new el),e;case 22:return null===(e=(t=t.stateNode)._retryCache)&&(e=t._retryCache=new el),e;default:throw Error(a(435,t.tag))}}(t);e.forEach((function(e){var n=lc.bind(null,t,e);i.has(e)||(i.add(e),e.then(n,n))}))}function dl(t,e){var i=e.deletions;if(null!==i)for(var n=0;n<i.length;n++){var r=i[n],s=t,o=e,l=o;t:for(;null!==l;){switch(l.tag){case 27:case 5:al=l.stateNode,ol=!1;break t;case 3:case 4:al=l.stateNode.containerInfo,ol=!0;break t}l=l.return}if(null===al)throw Error(a(160));hl(s,o,r),al=null,ol=!1,null!==(s=r.alternate)&&(s.return=null),r.return=null}if(13878&e.subtreeFlags)for(e=e.child;null!==e;)fl(e,t),e=e.sibling}var pl=null;function fl(t,e){var i=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:dl(e,t),ml(t),4&n&&(Vo(3,t,t.return),Uo(3,t),Vo(5,t,t.return));break;case 1:dl(e,t),ml(t),512&n&&($o||null===i||Wo(i,i.return)),64&n&&Jo&&(null!==(t=t.updateQueue)&&(null!==(n=t.callbacks)&&(i=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=null===i?n:i.concat(n))));break;case 26:var r=pl;if(dl(e,t),ml(t),512&n&&($o||null===i||Wo(i,i.return)),4&n){var s=null!==i?i.memoizedState:null;if(n=t.memoizedState,null===i)if(null===n)if(null===t.stateNode){t:{n=t.type,i=t.memoizedProps,r=r.ownerDocument||r;e:switch(n){case"title":(!(s=r.getElementsByTagName("title")[0])||s[Wt]||s[Ft]||"http://www.w3.org/2000/svg"===s.namespaceURI||s.hasAttribute("itemprop"))&&(s=r.createElement(n),r.head.insertBefore(s,r.querySelector("head > title"))),qc(s,n,i),s[Ft]=t,Zt(s),n=s;break t;case"link":var o=Mu("link","href",r).get(n+(i.href||""));if(o)for(var l=0;l<o.length;l++)if((s=o[l]).getAttribute("href")===(null==i.href?null:i.href)&&s.getAttribute("rel")===(null==i.rel?null:i.rel)&&s.getAttribute("title")===(null==i.title?null:i.title)&&s.getAttribute("crossorigin")===(null==i.crossOrigin?null:i.crossOrigin)){o.splice(l,1);break e}qc(s=r.createElement(n),n,i),r.head.appendChild(s);break;case"meta":if(o=Mu("meta","content",r).get(n+(i.content||"")))for(l=0;l<o.length;l++)if((s=o[l]).getAttribute("content")===(null==i.content?null:""+i.content)&&s.getAttribute("name")===(null==i.name?null:i.name)&&s.getAttribute("property")===(null==i.property?null:i.property)&&s.getAttribute("http-equiv")===(null==i.httpEquiv?null:i.httpEquiv)&&s.getAttribute("charset")===(null==i.charSet?null:i.charSet)){o.splice(l,1);break e}qc(s=r.createElement(n),n,i),r.head.appendChild(s);break;default:throw Error(a(468,n))}s[Ft]=t,Zt(s),n=s}t.stateNode=n}else Pu(r,t.type,t.stateNode);else t.stateNode=Su(r,n,t.memoizedProps);else s!==n?(null===s?null!==i.stateNode&&(i=i.stateNode).parentNode.removeChild(i):s.count--,null===n?Pu(r,t.type,t.stateNode):Su(r,n,t.memoizedProps)):null===n&&null!==t.stateNode&&Yo(t,t.memoizedProps,i.memoizedProps)}break;case 27:if(4&n&&null===t.alternate){r=t.stateNode,s=t.memoizedProps;try{for(var h=r.firstChild;h;){var c=h.nextSibling,u=h.nodeName;h[Wt]||"HEAD"===u||"BODY"===u||"SCRIPT"===u||"STYLE"===u||"LINK"===u&&"stylesheet"===h.rel.toLowerCase()||r.removeChild(h),h=c}for(var d=t.type,p=r.attributes;p.length;)r.removeAttributeNode(p[0]);qc(r,d,s),r[Ft]=t,r[Nt]=s}catch(m){nc(t,t.return,m)}}case 5:if(dl(e,t),ml(t),512&n&&($o||null===i||Wo(i,i.return)),32&t.flags){r=t.stateNode;try{Se(r,"")}catch(m){nc(t,t.return,m)}}4&n&&null!=t.stateNode&&Yo(t,r=t.memoizedProps,null!==i?i.memoizedProps:r),1024&n&&(tl=!0);break;case 6:if(dl(e,t),ml(t),4&n){if(null===t.stateNode)throw Error(a(162));n=t.memoizedProps,i=t.stateNode;try{i.nodeValue=n}catch(m){nc(t,t.return,m)}}break;case 3:if(Cu=null,r=pl,pl=du(e.containerInfo),dl(e,t),pl=r,ml(t),4&n&&null!==i&&i.memoizedState.isDehydrated)try{md(e.containerInfo)}catch(m){nc(t,t.return,m)}tl&&(tl=!1,gl(t));break;case 4:n=pl,pl=du(t.stateNode.containerInfo),dl(e,t),ml(t),pl=n;break;case 12:dl(e,t),ml(t);break;case 13:dl(e,t),ml(t),8192&t.child.flags&&null!==t.memoizedState!==(null!==i&&null!==i.memoizedState)&&(bh=lt()),4&n&&(null!==(n=t.updateQueue)&&(t.updateQueue=null,ul(t,n)));break;case 22:if(512&n&&($o||null===i||Wo(i,i.return)),h=null!==t.memoizedState,c=null!==i&&null!==i.memoizedState,Jo=(u=Jo)||h,$o=(d=$o)||c,dl(e,t),$o=d,Jo=u,ml(t),(e=t.stateNode)._current=t,e._visibility&=-3,e._visibility|=2&e._pendingVisibility,8192&n&&(e._visibility=h?-2&e._visibility:1|e._visibility,h&&(e=Jo||$o,null===i||c||e||yl(t)),null===t.memoizedProps||"manual"!==t.memoizedProps.mode))t:for(i=null,e=t;;){if(5===e.tag||26===e.tag||27===e.tag){if(null===i){c=i=e;try{if(r=c.stateNode,h)"function"===typeof(s=r.style).setProperty?s.setProperty("display","none","important"):s.display="none";else{o=c.stateNode;var f=void 0!==(l=c.memoizedProps.style)&&null!==l&&l.hasOwnProperty("display")?l.display:null;o.style.display=null==f||"boolean"===typeof f?"":(""+f).trim()}}catch(m){nc(c,c.return,m)}}}else if(6===e.tag){if(null===i){c=e;try{c.stateNode.nodeValue=h?"":c.memoizedProps}catch(m){nc(c,c.return,m)}}}else if((22!==e.tag&&23!==e.tag||null===e.memoizedState||e===t)&&null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break t;for(;null===e.sibling;){if(null===e.return||e.return===t)break t;i===e&&(i=null),e=e.return}i===e&&(i=null),e.sibling.return=e.return,e=e.sibling}4&n&&(null!==(n=t.updateQueue)&&(null!==(i=n.retryQueue)&&(n.retryQueue=null,ul(t,i))));break;case 19:dl(e,t),ml(t),4&n&&(null!==(n=t.updateQueue)&&(t.updateQueue=null,ul(t,n)));break;case 21:break;default:dl(e,t),ml(t)}}function ml(t){var e=t.flags;if(2&e){try{if(27!==t.tag){t:{for(var i=t.return;null!==i;){if(Xo(i)){var n=i;break t}i=i.return}throw Error(a(160))}switch(n.tag){case 27:var r=n.stateNode;Zo(t,Qo(t),r);break;case 5:var s=n.stateNode;32&n.flags&&(Se(s,""),n.flags&=-33),Zo(t,Qo(t),s);break;case 3:case 4:var o=n.stateNode.containerInfo;Ko(t,Qo(t),o);break;default:throw Error(a(161))}}}catch(l){nc(t,t.return,l)}t.flags&=-3}4096&e&&(t.flags&=-4097)}function gl(t){if(1024&t.subtreeFlags)for(t=t.child;null!==t;){var e=t;gl(e),5===e.tag&&1024&e.flags&&e.stateNode.reset(),t=t.sibling}}function vl(t,e){if(8772&e.subtreeFlags)for(e=e.child;null!==e;)rl(t,e.alternate,e),e=e.sibling}function yl(t){for(t=t.child;null!==t;){var e=t;switch(e.tag){case 0:case 11:case 14:case 15:Vo(4,e,e.return),yl(e);break;case 1:Wo(e,e.return);var i=e.stateNode;"function"===typeof i.componentWillUnmount&&Go(e,e.return,i),yl(e);break;case 26:case 27:case 5:Wo(e,e.return),yl(e);break;case 22:Wo(e,e.return),null===e.memoizedState&&yl(e);break;default:yl(e)}t=t.sibling}}function bl(t,e,i){for(i=i&&0!==(8772&e.subtreeFlags),e=e.child;null!==e;){var n=e.alternate,r=t,s=e,a=s.flags;switch(s.tag){case 0:case 11:case 15:bl(r,s,i),Uo(4,s);break;case 1:if(bl(r,s,i),"function"===typeof(r=(n=s).stateNode).componentDidMount)try{r.componentDidMount()}catch(h){nc(n,n.return,h)}if(null!==(r=(n=s).updateQueue)){var o=n.stateNode;try{var l=r.shared.hiddenCallbacks;if(null!==l)for(r.shared.hiddenCallbacks=null,r=0;r<l.length;r++)Fo(l[r],o)}catch(h){nc(n,n.return,h)}}i&&64&a&&jo(s),Ho(s,s.return);break;case 26:case 27:case 5:bl(r,s,i),i&&null===n&&4&a&&qo(s),Ho(s,s.return);break;case 12:default:bl(r,s,i);break;case 13:bl(r,s,i),i&&4&a&&cl(r,s);break;case 22:null===s.memoizedState&&bl(r,s,i),Ho(s,s.return)}e=e.sibling}}function xl(t,e){var i=null;null!==t&&null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(i=t.memoizedState.cachePool.pool),t=null,null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(t=e.memoizedState.cachePool.pool),t!==i&&(null!=t&&t.refCount++,null!=i&&Vr(i))}function wl(t,e){t=null,null!==e.alternate&&(t=e.alternate.memoizedState.cache),(e=e.memoizedState.cache)!==t&&(e.refCount++,null!=t&&Vr(t))}function Sl(t,e,i,n){if(10256&e.subtreeFlags)for(e=e.child;null!==e;)Al(t,e,i,n),e=e.sibling}function Al(t,e,i,n){var r=e.flags;switch(e.tag){case 0:case 11:case 15:Sl(t,e,i,n),2048&r&&Uo(9,e);break;case 3:Sl(t,e,i,n),2048&r&&(t=null,null!==e.alternate&&(t=e.alternate.memoizedState.cache),(e=e.memoizedState.cache)!==t&&(e.refCount++,null!=t&&Vr(t)));break;case 12:if(2048&r){Sl(t,e,i,n),t=e.stateNode;try{var s=e.memoizedProps,a=s.id,o=s.onPostCommit;"function"===typeof o&&o(a,null===e.alternate?"mount":"update",t.passiveEffectDuration,-0)}catch(l){nc(e,e.return,l)}}else Sl(t,e,i,n);break;case 23:break;case 22:s=e.stateNode,null!==e.memoizedState?4&s._visibility?Sl(t,e,i,n):_l(t,e):4&s._visibility?Sl(t,e,i,n):(s._visibility|=4,El(t,e,i,n,0!==(10256&e.subtreeFlags))),2048&r&&xl(e.alternate,e);break;case 24:Sl(t,e,i,n),2048&r&&wl(e.alternate,e);break;default:Sl(t,e,i,n)}}function El(t,e,i,n,r){for(r=r&&0!==(10256&e.subtreeFlags),e=e.child;null!==e;){var s=t,a=e,o=i,l=n,h=a.flags;switch(a.tag){case 0:case 11:case 15:El(s,a,o,l,r),Uo(8,a);break;case 23:break;case 22:var c=a.stateNode;null!==a.memoizedState?4&c._visibility?El(s,a,o,l,r):_l(s,a):(c._visibility|=4,El(s,a,o,l,r)),r&&2048&h&&xl(a.alternate,a);break;case 24:El(s,a,o,l,r),r&&2048&h&&wl(a.alternate,a);break;default:El(s,a,o,l,r)}e=e.sibling}}function _l(t,e){if(10256&e.subtreeFlags)for(e=e.child;null!==e;){var i=t,n=e,r=n.flags;switch(n.tag){case 22:_l(i,n),2048&r&&xl(n.alternate,n);break;case 24:_l(i,n),2048&r&&wl(n.alternate,n);break;default:_l(i,n)}e=e.sibling}}var Cl=8192;function Ml(t){if(t.subtreeFlags&Cl)for(t=t.child;null!==t;)Pl(t),t=t.sibling}function Pl(t){switch(t.tag){case 26:Ml(t),t.flags&Cl&&null!==t.memoizedState&&function(t,e,i){if(null===Du)throw Error(a(475));var n=Du;if("stylesheet"===e.type&&("string"!==typeof i.media||!1!==matchMedia(i.media).matches)&&0===(4&e.state.loading)){if(null===e.instance){var r=vu(i.href),s=t.querySelector(yu(r));if(s)return null!==(t=s._p)&&"object"===typeof t&&"function"===typeof t.then&&(n.count++,n=Iu.bind(n),t.then(n,n)),e.state.loading|=4,e.instance=s,void Zt(s);s=t.ownerDocument||t,i=bu(i),(r=cu.get(r))&&Eu(i,r),Zt(s=s.createElement("link"));var o=s;o._p=new Promise((function(t,e){o.onload=t,o.onerror=e})),qc(s,"link",i),e.instance=s}null===n.stylesheets&&(n.stylesheets=new Map),n.stylesheets.set(e,t),(t=e.state.preload)&&0===(3&e.state.loading)&&(n.count++,e=Iu.bind(n),t.addEventListener("load",e),t.addEventListener("error",e))}}(pl,t.memoizedState,t.memoizedProps);break;case 5:default:Ml(t);break;case 3:case 4:var e=pl;pl=du(t.stateNode.containerInfo),Ml(t),pl=e;break;case 22:null===t.memoizedState&&(null!==(e=t.alternate)&&null!==e.memoizedState?(e=Cl,Cl=16777216,Ml(t),Cl=e):Ml(t))}}function Tl(t){var e=t.alternate;if(null!==e&&null!==(t=e.child)){e.child=null;do{e=t.sibling,t.sibling=null,t=e}while(null!==t)}}function Dl(t){var e=t.deletions;if(0!==(16&t.flags)){if(null!==e)for(var i=0;i<e.length;i++){var n=e[i];il=n,Rl(n,t)}Tl(t)}if(10256&t.subtreeFlags)for(t=t.child;null!==t;)kl(t),t=t.sibling}function kl(t){switch(t.tag){case 0:case 11:case 15:Dl(t),2048&t.flags&&Vo(9,t,t.return);break;case 3:case 12:default:Dl(t);break;case 22:var e=t.stateNode;null!==t.memoizedState&&4&e._visibility&&(null===t.return||13!==t.return.tag)?(e._visibility&=-5,Il(t)):Dl(t)}}function Il(t){var e=t.deletions;if(0!==(16&t.flags)){if(null!==e)for(var i=0;i<e.length;i++){var n=e[i];il=n,Rl(n,t)}Tl(t)}for(t=t.child;null!==t;){switch((e=t).tag){case 0:case 11:case 15:Vo(8,e,e.return),Il(e);break;case 22:4&(i=e.stateNode)._visibility&&(i._visibility&=-5,Il(e));break;default:Il(e)}t=t.sibling}}function Rl(t,e){for(;null!==il;){var i=il;switch(i.tag){case 0:case 11:case 15:Vo(8,i,e);break;case 23:case 22:if(null!==i.memoizedState&&null!==i.memoizedState.cachePool){var n=i.memoizedState.cachePool.pool;null!=n&&n.refCount++}break;case 24:Vr(i.memoizedState.cache)}if(null!==(n=i.child))n.return=i,il=n;else t:for(i=t;null!==il;){var r=(n=il).sibling,s=n.return;if(sl(n),n===i){il=null;break t}if(null!==r){r.return=s,il=r;break t}il=s}}}function Ol(t,e,i,n){this.tag=t,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ll(t,e,i,n){return new Ol(t,e,i,n)}function Bl(t){return!(!(t=t.prototype)||!t.isReactComponent)}function zl(t,e){var i=t.alternate;return null===i?((i=Ll(t.tag,e,t.key,t.mode)).elementType=t.elementType,i.type=t.type,i.stateNode=t.stateNode,i.alternate=t,t.alternate=i):(i.pendingProps=e,i.type=t.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=31457280&t.flags,i.childLanes=t.childLanes,i.lanes=t.lanes,i.child=t.child,i.memoizedProps=t.memoizedProps,i.memoizedState=t.memoizedState,i.updateQueue=t.updateQueue,e=t.dependencies,i.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext},i.sibling=t.sibling,i.index=t.index,i.ref=t.ref,i.refCleanup=t.refCleanup,i}function Fl(t,e){t.flags&=31457282;var i=t.alternate;return null===i?(t.childLanes=0,t.lanes=e,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=i.childLanes,t.lanes=i.lanes,t.child=i.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=i.memoizedProps,t.memoizedState=i.memoizedState,t.updateQueue=i.updateQueue,t.type=i.type,e=i.dependencies,t.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),t}function Nl(t,e,i,n,r,s){var o=0;if(n=t,"function"===typeof t)Bl(t)&&(o=1);else if("string"===typeof t)o=function(t,e,i){if(1===i||null!=e.itemProp)return!1;switch(t){case"meta":case"title":return!0;case"style":if("string"!==typeof e.precedence||"string"!==typeof e.href||""===e.href)break;return!0;case"link":if("string"!==typeof e.rel||"string"!==typeof e.href||""===e.href||e.onLoad||e.onError)break;return"stylesheet"!==e.rel||(t=e.disabled,"string"===typeof e.precedence&&null==t);case"script":if(e.async&&"function"!==typeof e.async&&"symbol"!==typeof e.async&&!e.onLoad&&!e.onError&&e.src&&"string"===typeof e.src)return!0}return!1}(t,i,Q.current)?26:"html"===t||"head"===t||"body"===t?27:5;else t:switch(t){case u:return Ul(i.children,r,s,e);case d:o=8,r|=24;break;case p:return(t=Ll(12,i,e,2|r)).elementType=p,t.lanes=s,t;case y:return(t=Ll(13,i,e,r)).elementType=y,t.lanes=s,t;case b:return(t=Ll(19,i,e,r)).elementType=b,t.lanes=s,t;case S:return Vl(i,r,s,e);default:if("object"===typeof t&&null!==t)switch(t.$$typeof){case f:case g:o=10;break t;case m:o=9;break t;case v:o=11;break t;case x:o=14;break t;case w:o=16,n=null;break t}o=29,i=Error(a(130,null===t?"null":typeof t,"")),n=null}return(e=Ll(o,i,e,r)).elementType=t,e.type=n,e.lanes=s,e}function Ul(t,e,i,n){return(t=Ll(7,t,n,e)).lanes=i,t}function Vl(t,e,i,n){(t=Ll(22,t,n,e)).elementType=S,t.lanes=i;var r={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var t=r._current;if(null===t)throw Error(a(456));if(0===(2&r._pendingVisibility)){var e=Tn(t,2);null!==e&&(r._pendingVisibility|=2,Ih(e,t,2))}},attach:function(){var t=r._current;if(null===t)throw Error(a(456));if(0!==(2&r._pendingVisibility)){var e=Tn(t,2);null!==e&&(r._pendingVisibility&=-3,Ih(e,t,2))}}};return t.stateNode=r,t}function jl(t,e,i){return(t=Ll(6,t,null,e)).lanes=i,t}function Gl(t,e,i){return(e=Ll(4,null!==t.children?t.children:[],t.key,e)).lanes=i,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Hl(t){t.flags|=4}function Wl(t,e){if("stylesheet"!==e.type||0!==(4&e.state.loading))t.flags&=-16777217;else if(t.flags|=16777216,!Tu(e)){if(null!==(e=Pr.current)&&((4194176&nh)===nh?null!==Tr:(62914560&nh)!==nh&&0===(536870912&nh)||e!==Tr))throw dr=lr,or;t.flags|=8192}}function ql(t,e){null!==e&&(t.flags|=4),16384&t.flags&&(e=22!==t.tag?Dt():536870912,t.lanes|=e,mh|=e)}function Yl(t,e){if(!Kn)switch(t.tailMode){case"hidden":e=t.tail;for(var i=null;null!==e;)null!==e.alternate&&(i=e),e=e.sibling;null===i?t.tail=null:i.sibling=null;break;case"collapsed":i=t.tail;for(var n=null;null!==i;)null!==i.alternate&&(n=i),i=i.sibling;null===n?e||null===t.tail?t.tail=null:t.tail.sibling=null:n.sibling=null}}function Xl(t){var e=null!==t.alternate&&t.alternate.child===t.child,i=0,n=0;if(e)for(var r=t.child;null!==r;)i|=r.lanes|r.childLanes,n|=31457280&r.subtreeFlags,n|=31457280&r.flags,r.return=t,r=r.sibling;else for(r=t.child;null!==r;)i|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=n,t.childLanes=i,e}function Ql(t,e,i){var n=e.pendingProps;switch(Yn(e),e.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return Xl(e),null;case 3:return i=e.stateNode,n=null,null!==t&&(n=t.memoizedState.cache),e.memoizedState.cache!==n&&(e.flags|=2048),bo(Nr),tt(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==t&&null!==t.child||(nr(e)?Hl(e):null===t||t.memoizedState.isDehydrated&&0===(256&e.flags)||(e.flags|=1024,null!==Zn&&(Oh(Zn),Zn=null))),Xl(e),null;case 26:return i=e.memoizedState,null===t?(Hl(e),null!==i?(Xl(e),Wl(e,i)):(Xl(e),e.flags&=-16777217)):i?i!==t.memoizedState?(Hl(e),Xl(e),Wl(e,i)):(Xl(e),e.flags&=-16777217):(t.memoizedProps!==n&&Hl(e),Xl(e),e.flags&=-16777217),null;case 27:it(e),i=Z.current;var r=e.type;if(null!==t&&null!=e.stateNode)t.memoizedProps!==n&&Hl(e);else{if(!n){if(null===e.stateNode)throw Error(a(166));return Xl(e),null}t=Q.current,nr(e)?er(e):(t=hu(r,n,i),e.stateNode=t,Hl(e))}return Xl(e),null;case 5:if(it(e),i=e.type,null!==t&&null!=e.stateNode)t.memoizedProps!==n&&Hl(e);else{if(!n){if(null===e.stateNode)throw Error(a(166));return Xl(e),null}if(t=Q.current,nr(e))er(e);else{switch(r=Qc(Z.current),t){case 1:t=r.createElementNS("http://www.w3.org/2000/svg",i);break;case 2:t=r.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;default:switch(i){case"svg":t=r.createElementNS("http://www.w3.org/2000/svg",i);break;case"math":t=r.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;case"script":(t=r.createElement("div")).innerHTML="<script><\/script>",t=t.removeChild(t.firstChild);break;case"select":t="string"===typeof n.is?r.createElement("select",{is:n.is}):r.createElement("select"),n.multiple?t.multiple=!0:n.size&&(t.size=n.size);break;default:t="string"===typeof n.is?r.createElement(i,{is:n.is}):r.createElement(i)}}t[Ft]=e,t[Nt]=n;t:for(r=e.child;null!==r;){if(5===r.tag||6===r.tag)t.appendChild(r.stateNode);else if(4!==r.tag&&27!==r.tag&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===e)break t;for(;null===r.sibling;){if(null===r.return||r.return===e)break t;r=r.return}r.sibling.return=r.return,r=r.sibling}e.stateNode=t;t:switch(qc(t,i,n),i){case"button":case"input":case"select":case"textarea":t=!!n.autoFocus;break t;case"img":t=!0;break t;default:t=!1}t&&Hl(e)}}return Xl(e),e.flags&=-16777217,null;case 6:if(t&&null!=e.stateNode)t.memoizedProps!==n&&Hl(e);else{if("string"!==typeof n&&null===e.stateNode)throw Error(a(166));if(t=Z.current,nr(e)){if(t=e.stateNode,i=e.memoizedProps,n=null,null!==(r=Xn))switch(r.tag){case 27:case 5:n=r.memoizedProps}t[Ft]=e,(t=!!(t.nodeValue===i||null!==n&&!0===n.suppressHydrationWarning||jc(t.nodeValue,i)))||tr(e)}else(t=Qc(t).createTextNode(n))[Ft]=e,e.stateNode=t}return Xl(e),null;case 13:if(n=e.memoizedState,null===t||null!==t.memoizedState&&null!==t.memoizedState.dehydrated){if(r=nr(e),null!==n&&null!==n.dehydrated){if(null===t){if(!r)throw Error(a(318));if(!(r=null!==(r=e.memoizedState)?r.dehydrated:null))throw Error(a(317));r[Ft]=e}else rr(),0===(128&e.flags)&&(e.memoizedState=null),e.flags|=4;Xl(e),r=!1}else null!==Zn&&(Oh(Zn),Zn=null),r=!0;if(!r)return 256&e.flags?(Rr(e),e):(Rr(e),null)}if(Rr(e),0!==(128&e.flags))return e.lanes=i,e;if(i=null!==n,t=null!==t&&null!==t.memoizedState,i){r=null,null!==(n=e.child).alternate&&null!==n.alternate.memoizedState&&null!==n.alternate.memoizedState.cachePool&&(r=n.alternate.memoizedState.cachePool.pool);var s=null;null!==n.memoizedState&&null!==n.memoizedState.cachePool&&(s=n.memoizedState.cachePool.pool),s!==r&&(n.flags|=2048)}return i!==t&&i&&(e.child.flags|=8192),ql(e,e.updateQueue),Xl(e),null;case 4:return tt(),null===t&&Ic(e.stateNode.containerInfo),Xl(e),null;case 10:return bo(e.type),Xl(e),null;case 19:if(Y(Or),null===(r=e.memoizedState))return Xl(e),null;if(n=0!==(128&e.flags),null===(s=r.rendering))if(n)Yl(r,!1);else{if(0!==ch||null!==t&&0!==(128&t.flags))for(t=e.child;null!==t;){if(null!==(s=Lr(t))){for(e.flags|=128,Yl(r,!1),t=s.updateQueue,e.updateQueue=t,ql(e,t),e.subtreeFlags=0,t=i,i=e.child;null!==i;)Fl(i,t),i=i.sibling;return X(Or,1&Or.current|2),e.child}t=t.sibling}null!==r.tail&&lt()>xh&&(e.flags|=128,n=!0,Yl(r,!1),e.lanes=4194304)}else{if(!n)if(null!==(t=Lr(s))){if(e.flags|=128,n=!0,t=t.updateQueue,e.updateQueue=t,ql(e,t),Yl(r,!0),null===r.tail&&"hidden"===r.tailMode&&!s.alternate&&!Kn)return Xl(e),null}else 2*lt()-r.renderingStartTime>xh&&536870912!==i&&(e.flags|=128,n=!0,Yl(r,!1),e.lanes=4194304);r.isBackwards?(s.sibling=e.child,e.child=s):(null!==(t=r.last)?t.sibling=s:e.child=s,r.last=s)}return null!==r.tail?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=lt(),e.sibling=null,t=Or.current,X(Or,n?1&t|2:1&t),e):(Xl(e),null);case 22:case 23:return Rr(e),Mr(),n=null!==e.memoizedState,null!==t?null!==t.memoizedState!==n&&(e.flags|=8192):n&&(e.flags|=8192),n?0!==(536870912&i)&&0===(128&e.flags)&&(Xl(e),6&e.subtreeFlags&&(e.flags|=8192)):Xl(e),null!==(i=e.updateQueue)&&ql(e,i.retryQueue),i=null,null!==t&&null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(i=t.memoizedState.cachePool.pool),n=null,null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),n!==i&&(e.flags|=2048),null!==t&&Y(Xr),null;case 24:return i=null,null!==t&&(i=t.memoizedState.cache),e.memoizedState.cache!==i&&(e.flags|=2048),bo(Nr),Xl(e),null;case 25:return null}throw Error(a(156,e.tag))}function Kl(t,e){switch(Yn(e),e.tag){case 1:return 65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 3:return bo(Nr),tt(),0!==(65536&(t=e.flags))&&0===(128&t)?(e.flags=-65537&t|128,e):null;case 26:case 27:case 5:return it(e),null;case 13:if(Rr(e),null!==(t=e.memoizedState)&&null!==t.dehydrated){if(null===e.alternate)throw Error(a(340));rr()}return 65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 19:return Y(Or),null;case 4:return tt(),null;case 10:return bo(e.type),null;case 22:case 23:return Rr(e),Mr(),null!==t&&Y(Xr),65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 24:return bo(Nr),null;default:return null}}function Zl(t,e){switch(Yn(e),e.tag){case 3:bo(Nr),tt();break;case 26:case 27:case 5:it(e);break;case 4:tt();break;case 13:Rr(e);break;case 19:Y(Or);break;case 10:bo(e.type);break;case 22:case 23:Rr(e),Mr(),null!==t&&Y(Xr);break;case 24:bo(Nr)}}var Jl={getCacheForType:function(t){var e=_o(Nr),i=e.data.get(t);return void 0===i&&(i=t(),e.data.set(t,i)),i}},$l="function"===typeof WeakMap?WeakMap:Map,th=0,eh=null,ih=null,nh=0,rh=0,sh=null,ah=!1,oh=!1,lh=!1,hh=0,ch=0,uh=0,dh=0,ph=0,fh=0,mh=0,gh=null,vh=null,yh=!1,bh=0,xh=1/0,wh=null,Sh=null,Ah=!1,Eh=null,_h=0,Ch=0,Mh=null,Ph=0,Th=null;function Dh(){if(0!==(2&th)&&0!==nh)return nh&-nh;if(null!==D.T){return 0!==Hr?Hr:wc()}return Bt()}function kh(){0===fh&&(fh=0===(536870912&nh)||Kn?Tt():536870912);var t=Pr.current;return null!==t&&(t.flags|=32),fh}function Ih(t,e,i){(t===eh&&2===rh||null!==t.cancelPendingCommit)&&(Uh(t,0),zh(t,nh,fh,!1)),It(t,i),0!==(2&th)&&t===eh||(t===eh&&(0===(2&th)&&(dh|=i),4===ch&&zh(t,nh,fh,!1)),mc(t))}function Rh(t,e,i){if(0!==(6&th))throw Error(a(327));for(var n=!i&&0===(60&e)&&0===(e&t.expiredLanes)||Mt(t,e),r=n?function(t,e){var i=th;th|=2;var n=jh(),r=Gh();eh!==t||nh!==e?(wh=null,xh=lt()+500,Uh(t,e)):oh=Mt(t,e);t:for(;;)try{if(0!==rh&&null!==ih){e=ih;var s=sh;e:switch(rh){case 1:rh=0,sh=null,Kh(t,e,s,1);break;case 2:if(hr(s)){rh=0,sh=null,Qh(e);break}e=function(){2===rh&&eh===t&&(rh=7),mc(t)},s.then(e,e);break t;case 3:rh=7;break t;case 4:rh=5;break t;case 7:hr(s)?(rh=0,sh=null,Qh(e)):(rh=0,sh=null,Kh(t,e,s,7));break;case 5:var o=null;switch(ih.tag){case 26:o=ih.memoizedState;case 5:case 27:var l=ih;if(!o||Tu(o)){rh=0,sh=null;var h=l.sibling;if(null!==h)ih=h;else{var c=l.return;null!==c?(ih=c,Zh(c)):ih=null}break e}}rh=0,sh=null,Kh(t,e,s,5);break;case 6:rh=0,sh=null,Kh(t,e,s,6);break;case 8:Nh(),ch=6;break t;default:throw Error(a(462))}}Yh();break}catch(u){Vh(t,u)}return vo=go=null,D.H=n,D.A=r,th=i,null!==ih?0:(eh=null,nh=0,Cn(),ch)}(t,e):Wh(t,e,!0),s=n;;){if(0===r){oh&&!n&&zh(t,e,0,!1);break}if(6===r)zh(t,e,0,!ah);else{if(i=t.current.alternate,s&&!Bh(i)){r=Wh(t,e,!1),s=!1;continue}if(2===r){if(s=e,t.errorRecoveryDisabledLanes&s)var o=0;else o=0!==(o=-536870913&t.pendingLanes)?o:536870912&o?536870912:0;if(0!==o){e=o;t:{var l=t;r=gh;var h=l.current.memoizedState.isDehydrated;if(h&&(Uh(l,o).flags|=256),2!==(o=Wh(l,o,!1))){if(lh&&!h){l.errorRecoveryDisabledLanes|=s,dh|=s,r=4;break t}s=vh,vh=r,null!==s&&Oh(s)}r=o}if(s=!1,2!==r)continue}}if(1===r){Uh(t,0),zh(t,e,0,!0);break}t:{switch(n=t,r){case 0:case 1:throw Error(a(345));case 4:if((4194176&e)===e){zh(n,e,fh,!ah);break t}break;case 2:vh=null;break;case 3:case 5:break;default:throw Error(a(329))}if(n.finishedWork=i,n.finishedLanes=e,(62914560&e)===e&&10<(s=bh+300-lt())){if(zh(n,e,fh,!ah),0!==Ct(n,0))break t;n.timeoutHandle=tu(Lh.bind(null,n,i,vh,wh,yh,e,fh,dh,mh,ah,2,-0,0),s)}else Lh(n,i,vh,wh,yh,e,fh,dh,mh,ah,0,-0,0)}}break}mc(t)}function Oh(t){null===vh?vh=t:vh.push.apply(vh,t)}function Lh(t,e,i,n,r,s,o,l,h,c,u,d,p){var f=e.subtreeFlags;if((8192&f||16785408===(16785408&f))&&(Du={stylesheets:null,count:0,unsuspend:ku},Pl(e),null!==(e=function(){if(null===Du)throw Error(a(475));var t=Du;return t.stylesheets&&0===t.count&&Ou(t,t.stylesheets),0<t.count?function(e){var i=setTimeout((function(){if(t.stylesheets&&Ou(t,t.stylesheets),t.unsuspend){var e=t.unsuspend;t.unsuspend=null,e()}}),6e4);return t.unsuspend=e,function(){t.unsuspend=null,clearTimeout(i)}}:null}())))return t.cancelPendingCommit=e($h.bind(null,t,i,n,r,o,l,h,1,d,p)),void zh(t,s,o,!c);$h(t,i,n,r,o,l,h,u,d,p)}function Bh(t){for(var e=t;;){var i=e.tag;if((0===i||11===i||15===i)&&16384&e.flags&&(null!==(i=e.updateQueue)&&null!==(i=i.stores)))for(var n=0;n<i.length;n++){var r=i[n],s=r.getSnapshot;r=r.value;try{if(!Yi(s(),r))return!1}catch(a){return!1}}if(i=e.child,16384&e.subtreeFlags&&null!==i)i.return=e,e=i;else{if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function zh(t,e,i,n){e&=~ph,e&=~dh,t.suspendedLanes|=e,t.pingedLanes&=~e,n&&(t.warmLanes|=e),n=t.expirationTimes;for(var r=e;0<r;){var s=31-xt(r),a=1<<s;n[s]=-1,r&=~a}0!==i&&Rt(t,i,e)}function Fh(){return 0!==(6&th)||(gc(0,!1),!1)}function Nh(){if(null!==ih){if(0===rh)var t=ih.return;else vo=go=null,vs(t=ih),fr=null,mr=0,t=ih;for(;null!==t;)Zl(t.alternate,t),t=t.return;ih=null}}function Uh(t,e){t.finishedWork=null,t.finishedLanes=0;var i=t.timeoutHandle;-1!==i&&(t.timeoutHandle=-1,eu(i)),null!==(i=t.cancelPendingCommit)&&(t.cancelPendingCommit=null,i()),Nh(),eh=t,ih=i=zl(t.current,null),nh=e,rh=0,sh=null,ah=!1,oh=Mt(t,e),lh=!1,mh=fh=ph=dh=uh=ch=0,vh=gh=null,yh=!1,0!==(8&e)&&(e|=32&e);var n=t.entangledLanes;if(0!==n)for(t=t.entanglements,n&=e;0<n;){var r=31-xt(n),s=1<<r;e|=t[r],n&=~s}return hh=e,Cn(),i}function Vh(t,e){$r=null,D.H=Ea,e===ar?(e=pr(),rh=3):e===or?(e=pr(),rh=4):rh=e===ja?8:null!==e&&"object"===typeof e&&"function"===typeof e.then?6:1,sh=e,null===ih&&(ch=1,za(t,On(e,t.current)))}function jh(){var t=D.H;return D.H=Ea,null===t?Ea:t}function Gh(){var t=D.A;return D.A=Jl,t}function Hh(){ch=4,ah||(4194176&nh)!==nh&&null!==Pr.current||(oh=!0),0===(134217727&uh)&&0===(134217727&dh)||null===eh||zh(eh,nh,fh,!1)}function Wh(t,e,i){var n=th;th|=2;var r=jh(),s=Gh();eh===t&&nh===e||(wh=null,Uh(t,e)),e=!1;var a=ch;t:for(;;)try{if(0!==rh&&null!==ih){var o=ih,l=sh;switch(rh){case 8:Nh(),a=6;break t;case 3:case 2:case 6:null===Pr.current&&(e=!0);var h=rh;if(rh=0,sh=null,Kh(t,o,l,h),i&&oh){a=0;break t}break;default:h=rh,rh=0,sh=null,Kh(t,o,l,h)}}qh(),a=ch;break}catch(c){Vh(t,c)}return e&&t.shellSuspendCounter++,vo=go=null,th=n,D.H=r,D.A=s,null===ih&&(eh=null,nh=0,Cn()),a}function qh(){for(;null!==ih;)Xh(ih)}function Yh(){for(;null!==ih&&!at();)Xh(ih)}function Xh(t){var e=fo(t.alternate,t,hh);t.memoizedProps=t.pendingProps,null===e?Zh(t):ih=e}function Qh(t){var e=t,i=e.alternate;switch(e.tag){case 15:case 0:e=Ja(i,e,e.pendingProps,e.type,void 0,nh);break;case 11:e=Ja(i,e,e.pendingProps,e.type.render,e.ref,nh);break;case 5:vs(e);default:Zl(i,e),e=fo(i,e=ih=Fl(e,hh),hh)}t.memoizedProps=t.pendingProps,null===e?Zh(t):ih=e}function Kh(t,e,i,n){vo=go=null,vs(e),fr=null,mr=0;var r=e.return;try{if(function(t,e,i,n,r){if(i.flags|=32768,null!==n&&"object"===typeof n&&"function"===typeof n.then){if(null!==(e=i.alternate)&&So(e,i,r,!0),null!==(i=Pr.current)){switch(i.tag){case 13:return null===Tr?Hh():null===i.alternate&&0===ch&&(ch=3),i.flags&=-257,i.flags|=65536,i.lanes=r,n===lr?i.flags|=16384:(null===(e=i.updateQueue)?i.updateQueue=new Set([n]):e.add(n),rc(t,n,r)),!1;case 22:return i.flags|=65536,n===lr?i.flags|=16384:(null===(e=i.updateQueue)?(e={transitions:null,markerInstances:null,retryQueue:new Set([n])},i.updateQueue=e):null===(i=e.retryQueue)?e.retryQueue=new Set([n]):i.add(n),rc(t,n,r)),!1}throw Error(a(435,i.tag))}return rc(t,n,r),Hh(),!1}if(Kn)return null!==(e=Pr.current)?(0===(65536&e.flags)&&(e.flags|=256),e.flags|=65536,e.lanes=r,n!==$n&&sr(On(t=Error(a(422),{cause:n}),i))):(n!==$n&&sr(On(e=Error(a(423),{cause:n}),i)),(t=t.current.alternate).flags|=65536,r&=-r,t.lanes|=r,n=On(n,i),Oo(t,r=Na(t.stateNode,n,r)),4!==ch&&(ch=2)),!1;var s=Error(a(520),{cause:n});if(s=On(s,i),null===gh?gh=[s]:gh.push(s),4!==ch&&(ch=2),null===e)return!0;n=On(n,i),i=e;do{switch(i.tag){case 3:return i.flags|=65536,t=r&-r,i.lanes|=t,Oo(i,t=Na(i.stateNode,n,t)),!1;case 1:if(e=i.type,s=i.stateNode,0===(128&i.flags)&&("function"===typeof e.getDerivedStateFromError||null!==s&&"function"===typeof s.componentDidCatch&&(null===Sh||!Sh.has(s))))return i.flags|=65536,r&=-r,i.lanes|=r,Va(r=Ua(r),t,i,n),Oo(i,r),!1}i=i.return}while(null!==i);return!1}(t,r,e,i,nh))return ch=1,za(t,On(i,t.current)),void(ih=null)}catch(s){if(null!==r)throw ih=r,s;return ch=1,za(t,On(i,t.current)),void(ih=null)}32768&e.flags?(Kn||1===n?t=!0:oh||0!==(536870912&nh)?t=!1:(ah=t=!0,(2===n||3===n||6===n)&&(null!==(n=Pr.current)&&13===n.tag&&(n.flags|=16384))),Jh(e,t)):Zh(e)}function Zh(t){var e=t;do{if(0!==(32768&e.flags))return void Jh(e,ah);t=e.return;var i=Ql(e.alternate,e,hh);if(null!==i)return void(ih=i);if(null!==(e=e.sibling))return void(ih=e);ih=e=t}while(null!==e);0===ch&&(ch=5)}function Jh(t,e){do{var i=Kl(t.alternate,t);if(null!==i)return i.flags&=32767,void(ih=i);if(null!==(i=t.return)&&(i.flags|=32768,i.subtreeFlags=0,i.deletions=null),!e&&null!==(t=t.sibling))return void(ih=t);ih=t=i}while(null!==t);ch=6,ih=null}function $h(t,e,i,n,r,s,o,l,h,c){var u=D.T,d=j.p;try{j.p=2,D.T=null,function(t,e,i,n,r,s,o,l){do{ec()}while(null!==Eh);if(0!==(6&th))throw Error(a(327));var h=t.finishedWork;if(n=t.finishedLanes,null===h)return null;if(t.finishedWork=null,t.finishedLanes=0,h===t.current)throw Error(a(177));t.callbackNode=null,t.callbackPriority=0,t.cancelPendingCommit=null;var c=h.lanes|h.childLanes;if(function(t,e,i,n,r,s){var a=t.pendingLanes;t.pendingLanes=i,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=i,t.entangledLanes&=i,t.errorRecoveryDisabledLanes&=i,t.shellSuspendCounter=0;var o=t.entanglements,l=t.expirationTimes,h=t.hiddenUpdates;for(i=a&~i;0<i;){var c=31-xt(i),u=1<<c;o[c]=0,l[c]=-1;var d=h[c];if(null!==d)for(h[c]=null,c=0;c<d.length;c++){var p=d[c];null!==p&&(p.lane&=-536870913)}i&=~u}0!==n&&Rt(t,n,0),0!==s&&0===r&&0!==t.tag&&(t.suspendedLanes|=s&~(a&~e))}(t,n,c|=_n,s,o,l),t===eh&&(ih=eh=null,nh=0),0===(10256&h.subtreeFlags)&&0===(10256&h.flags)||Ah||(Ah=!0,Ch=c,Mh=i,function(t,e){rt(t,e)}(dt,(function(){return ec(),null}))),i=0!==(15990&h.flags),0!==(15990&h.subtreeFlags)||i?(i=D.T,D.T=null,s=j.p,j.p=2,o=th,th|=4,function(t,e){if(t=t.containerInfo,Yc=Hu,$i(t=Ji(t))){if("selectionStart"in t)var i={start:t.selectionStart,end:t.selectionEnd};else t:{var n=(i=(i=t.ownerDocument)&&i.defaultView||window).getSelection&&i.getSelection();if(n&&0!==n.rangeCount){i=n.anchorNode;var r=n.anchorOffset,s=n.focusNode;n=n.focusOffset;try{i.nodeType,s.nodeType}catch(g){i=null;break t}var o=0,l=-1,h=-1,c=0,u=0,d=t,p=null;e:for(;;){for(var f;d!==i||0!==r&&3!==d.nodeType||(l=o+r),d!==s||0!==n&&3!==d.nodeType||(h=o+n),3===d.nodeType&&(o+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===t)break e;if(p===i&&++c===r&&(l=o),p===s&&++u===n&&(h=o),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}i=-1===l||-1===h?null:{start:l,end:h}}else i=null}i=i||{start:0,end:0}}else i=null;for(Xc={focusedElem:t,selectionRange:i},Hu=!1,il=e;null!==il;)if(t=(e=il).child,0!==(1028&e.subtreeFlags)&&null!==t)t.return=e,il=t;else for(;null!==il;){switch(s=(e=il).alternate,t=e.flags,e.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(0!==(1024&t)&&null!==s){t=void 0,i=e,r=s.memoizedProps,s=s.memoizedState,n=i.stateNode;try{var m=Ia(i.type,r,(i.elementType,i.type));t=n.getSnapshotBeforeUpdate(m,s),n.__reactInternalSnapshotBeforeUpdate=t}catch(v){nc(i,i.return,v)}}break;case 3:if(0!==(1024&t))if(9===(i=(t=e.stateNode.containerInfo).nodeType))au(t);else if(1===i)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":au(t);break;default:t.textContent=""}break;default:if(0!==(1024&t))throw Error(a(163))}if(null!==(t=e.sibling)){t.return=e.return,il=t;break}il=e.return}m=nl,nl=!1}(t,h),fl(h,t),tn(Xc,t.containerInfo),Hu=!!Yc,Xc=Yc=null,t.current=h,rl(t,h.alternate,h),ot(),th=o,j.p=s,D.T=i):t.current=h,Ah?(Ah=!1,Eh=t,_h=n):tc(t,c),c=t.pendingLanes,0===c&&(Sh=null),function(t){if(yt&&"function"===typeof yt.onCommitFiberRoot)try{yt.onCommitFiberRoot(vt,t,void 0,128===(128&t.current.flags))}catch(e){}}(h.stateNode),mc(t),null!==e)for(r=t.onRecoverableError,h=0;h<e.length;h++)c=e[h],r(c.value,{componentStack:c.stack});0!==(3&_h)&&ec(),c=t.pendingLanes,0!==(4194218&n)&&0!==(42&c)?t===Th?Ph++:(Ph=0,Th=t):Ph=0,gc(0,!1)}(t,e,i,n,d,r,s,o)}finally{D.T=u,j.p=d}}function tc(t,e){0===(t.pooledCacheLanes&=e)&&(null!=(e=t.pooledCache)&&(t.pooledCache=null,Vr(e)))}function ec(){if(null!==Eh){var t=Eh,e=Ch;Ch=0;var i=Lt(_h),n=D.T,r=j.p;try{if(j.p=32>i?32:i,D.T=null,null===Eh)var s=!1;else{i=Mh,Mh=null;var o=Eh,l=_h;if(Eh=null,_h=0,0!==(6&th))throw Error(a(331));var h=th;if(th|=4,kl(o.current),Al(o,o.current,l,i),th=h,gc(0,!1),yt&&"function"===typeof yt.onPostCommitFiberRoot)try{yt.onPostCommitFiberRoot(vt,o)}catch(c){}s=!0}return s}finally{j.p=r,D.T=n,tc(t,e)}}return!1}function ic(t,e,i){e=On(i,e),null!==(t=Io(t,e=Na(t.stateNode,e,2),2))&&(It(t,2),mc(t))}function nc(t,e,i){if(3===t.tag)ic(t,t,i);else for(;null!==e;){if(3===e.tag){ic(e,t,i);break}if(1===e.tag){var n=e.stateNode;if("function"===typeof e.type.getDerivedStateFromError||"function"===typeof n.componentDidCatch&&(null===Sh||!Sh.has(n))){t=On(i,t),null!==(n=Io(e,i=Ua(2),2))&&(Va(i,n,e,t),It(n,2),mc(n));break}}e=e.return}}function rc(t,e,i){var n=t.pingCache;if(null===n){n=t.pingCache=new $l;var r=new Set;n.set(e,r)}else void 0===(r=n.get(e))&&(r=new Set,n.set(e,r));r.has(i)||(lh=!0,r.add(i),t=sc.bind(null,t,e,i),e.then(t,t))}function sc(t,e,i){var n=t.pingCache;null!==n&&n.delete(e),t.pingedLanes|=t.suspendedLanes&i,t.warmLanes&=~i,eh===t&&(nh&i)===i&&(4===ch||3===ch&&(62914560&nh)===nh&&300>lt()-bh?0===(2&th)&&Uh(t,0):ph|=i,mh===nh&&(mh=0)),mc(t)}function ac(t,e){0===e&&(e=Dt()),null!==(t=Tn(t,e))&&(It(t,e),mc(t))}function oc(t){var e=t.memoizedState,i=0;null!==e&&(i=e.retryLane),ac(t,i)}function lc(t,e){var i=0;switch(t.tag){case 13:var n=t.stateNode,r=t.memoizedState;null!==r&&(i=r.retryLane);break;case 19:n=t.stateNode;break;case 22:n=t.stateNode._retryCache;break;default:throw Error(a(314))}null!==n&&n.delete(e),ac(t,i)}var hc=null,cc=null,uc=!1,dc=!1,pc=!1,fc=0;function mc(t){var e;t!==cc&&null===t.next&&(null===cc?hc=cc=t:cc=cc.next=t),dc=!0,uc||(uc=!0,e=vc,nu((function(){0!==(6&th)?rt(ct,e):e()})))}function gc(t,e){if(!pc&&dc){pc=!0;do{for(var i=!1,n=hc;null!==n;){if(!e)if(0!==t){var r=n.pendingLanes;if(0===r)var s=0;else{var a=n.suspendedLanes,o=n.pingedLanes;s=(1<<31-xt(42|t)+1)-1,s=201326677&(s&=r&~(a&~o))?201326677&s|1:s?2|s:0}0!==s&&(i=!0,xc(n,s))}else s=nh,0===(3&(s=Ct(n,n===eh?s:0)))||Mt(n,s)||(i=!0,xc(n,s));n=n.next}}while(i);pc=!1}}function vc(){dc=uc=!1;var t=0;0!==fc&&(function(){var t=window.event;if(t&&"popstate"===t.type)return t!==$c&&($c=t,!0);return $c=null,!1}()&&(t=fc),fc=0);for(var e=lt(),i=null,n=hc;null!==n;){var r=n.next,s=yc(n,e);0===s?(n.next=null,null===i?hc=r:i.next=r,null===r&&(cc=i)):(i=n,(0!==t||0!==(3&s))&&(dc=!0)),n=r}gc(t,!1)}function yc(t,e){for(var i=t.suspendedLanes,n=t.pingedLanes,r=t.expirationTimes,s=-62914561&t.pendingLanes;0<s;){var a=31-xt(s),o=1<<a,l=r[a];-1===l?0!==(o&i)&&0===(o&n)||(r[a]=Pt(o,e)):l<=e&&(t.expiredLanes|=o),s&=~o}if(i=nh,i=Ct(t,t===(e=eh)?i:0),n=t.callbackNode,0===i||t===e&&2===rh||null!==t.cancelPendingCommit)return null!==n&&null!==n&&st(n),t.callbackNode=null,t.callbackPriority=0;if(0===(3&i)||Mt(t,i)){if((e=i&-i)===t.callbackPriority)return e;switch(null!==n&&st(n),Lt(i)){case 2:case 8:i=ut;break;case 32:default:i=dt;break;case 268435456:i=ft}return n=bc.bind(null,t),i=rt(i,n),t.callbackPriority=e,t.callbackNode=i,e}return null!==n&&null!==n&&st(n),t.callbackPriority=2,t.callbackNode=null,2}function bc(t,e){var i=t.callbackNode;if(ec()&&t.callbackNode!==i)return null;var n=nh;return 0===(n=Ct(t,t===eh?n:0))?null:(Rh(t,n,e),yc(t,lt()),null!=t.callbackNode&&t.callbackNode===i?bc.bind(null,t):null)}function xc(t,e){if(ec())return null;Rh(t,e,!0)}function wc(){return 0===fc&&(fc=Tt()),fc}function Sc(t){return null==t||"symbol"===typeof t||"boolean"===typeof t?null:"function"===typeof t?t:Te(""+t)}function Ac(t,e){var i=e.ownerDocument.createElement("input");return i.name=e.name,i.value=e.value,t.id&&i.setAttribute("form",t.id),e.parentNode.insertBefore(i,e),t=new FormData(t),i.parentNode.removeChild(i),t}for(var Ec=0;Ec<wn.length;Ec++){var _c=wn[Ec];Sn(_c.toLowerCase(),"on"+(_c[0].toUpperCase()+_c.slice(1)))}Sn(pn,"onAnimationEnd"),Sn(fn,"onAnimationIteration"),Sn(mn,"onAnimationStart"),Sn("dblclick","onDoubleClick"),Sn("focusin","onFocus"),Sn("focusout","onBlur"),Sn(gn,"onTransitionRun"),Sn(vn,"onTransitionStart"),Sn(yn,"onTransitionCancel"),Sn(bn,"onTransitionEnd"),ee("onMouseEnter",["mouseout","mouseover"]),ee("onMouseLeave",["mouseout","mouseover"]),ee("onPointerEnter",["pointerout","pointerover"]),ee("onPointerLeave",["pointerout","pointerover"]),te("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),te("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),te("onBeforeInput",["compositionend","keypress","textInput","paste"]),te("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),te("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),te("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Cc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mc=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Cc));function Pc(t,e){e=0!==(4&e);for(var i=0;i<t.length;i++){var n=t[i],r=n.event;n=n.listeners;t:{var s=void 0;if(e)for(var a=n.length-1;0<=a;a--){var o=n[a],l=o.instance,h=o.currentTarget;if(o=o.listener,l!==s&&r.isPropagationStopped())break t;s=o,r.currentTarget=h;try{s(r)}catch(c){Ra(c)}r.currentTarget=null,s=l}else for(a=0;a<n.length;a++){if(l=(o=n[a]).instance,h=o.currentTarget,o=o.listener,l!==s&&r.isPropagationStopped())break t;s=o,r.currentTarget=h;try{s(r)}catch(c){Ra(c)}r.currentTarget=null,s=l}}}}function Tc(t,e){var i=e[Vt];void 0===i&&(i=e[Vt]=new Set);var n=t+"__bubble";i.has(n)||(Rc(e,t,2,!1),i.add(n))}function Dc(t,e,i){var n=0;e&&(n|=4),Rc(i,t,n,e)}var kc="_reactListening"+Math.random().toString(36).slice(2);function Ic(t){if(!t[kc]){t[kc]=!0,Jt.forEach((function(e){"selectionchange"!==e&&(Mc.has(e)||Dc(e,!1,t),Dc(e,!0,t))}));var e=9===t.nodeType?t:t.ownerDocument;null===e||e[kc]||(e[kc]=!0,Dc("selectionchange",!1,e))}}function Rc(t,e,i,n){switch(Zu(e)){case 2:var r=Wu;break;case 8:r=qu;break;default:r=Yu}i=r.bind(null,e,i,t),r=void 0,!Fe||"touchstart"!==e&&"touchmove"!==e&&"wheel"!==e||(r=!0),n?void 0!==r?t.addEventListener(e,i,{capture:!0,passive:r}):t.addEventListener(e,i,!0):void 0!==r?t.addEventListener(e,i,{passive:r}):t.addEventListener(e,i,!1)}function Oc(t,e,i,n,r){var s=n;if(0===(1&e)&&0===(2&e)&&null!==n)t:for(;;){if(null===n)return;var a=n.tag;if(3===a||4===a){var o=n.stateNode.containerInfo;if(o===r||8===o.nodeType&&o.parentNode===r)break;if(4===a)for(a=n.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;a=a.return}for(;null!==o;){if(null===(a=Yt(o)))return;if(5===(l=a.tag)||6===l||26===l||27===l){n=s=a;continue t}o=o.parentNode}}n=n.return}Be((function(){var n=s,r=ke(i),a=[];t:{var o=xn.get(t);if(void 0!==o){var l=Je,h=t;switch(t){case"keypress":if(0===He(i))break t;case"keydown":case"keyup":l=pi;break;case"focusin":h="focus",l=ri;break;case"focusout":h="blur",l=ri;break;case"beforeblur":case"afterblur":l=ri;break;case"click":if(2===i.button)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=ii;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=ni;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=mi;break;case pn:case fn:case mn:l=si;break;case bn:l=gi;break;case"scroll":case"scrollend":l=ti;break;case"wheel":l=vi;break;case"copy":case"cut":case"paste":l=ai;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=fi;break;case"toggle":case"beforetoggle":l=yi}var c=0!==(4&e),u=!c&&("scroll"===t||"scrollend"===t),d=c?null!==o?o+"Capture":null:o;c=[];for(var p,f=n;null!==f;){var m=f;if(p=m.stateNode,5!==(m=m.tag)&&26!==m&&27!==m||null===p||null===d||null!=(m=ze(f,d))&&c.push(Lc(f,m,p)),u)break;f=f.return}0<c.length&&(o=new l(o,h,null,i,r),a.push({event:o,listeners:c}))}}if(0===(7&e)){if(l="mouseout"===t||"pointerout"===t,(!(o="mouseover"===t||"pointerover"===t)||i===De||!(h=i.relatedTarget||i.fromElement)||!Yt(h)&&!h[Ut])&&(l||o)&&(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=n,null!==(h=(h=i.relatedTarget||i.toElement)?Yt(h):null)&&(u=z(h),c=h.tag,h!==u||5!==c&&27!==c&&6!==c)&&(h=null)):(l=null,h=n),l!==h)){if(c=ii,m="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==t&&"pointerover"!==t||(c=fi,m="onPointerLeave",d="onPointerEnter",f="pointer"),u=null==l?o:Qt(l),p=null==h?o:Qt(h),(o=new c(m,f+"leave",l,i,r)).target=u,o.relatedTarget=p,m=null,Yt(r)===n&&((c=new c(d,f+"enter",h,i,r)).target=p,c.relatedTarget=u,m=c),u=m,l&&h)t:{for(d=h,f=0,p=c=l;p;p=zc(p))f++;for(p=0,m=d;m;m=zc(m))p++;for(;0<f-p;)c=zc(c),f--;for(;0<p-f;)d=zc(d),p--;for(;f--;){if(c===d||null!==d&&c===d.alternate)break t;c=zc(c),d=zc(d)}c=null}else c=null;null!==l&&Fc(a,o,l,c,!1),null!==h&&null!==u&&Fc(a,u,h,c,!0)}if("select"===(l=(o=n?Qt(n):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var g=Bi;else if(Di(o))if(zi)g=qi;else{g=Hi;var v=Gi}else!(l=o.nodeName)||"input"!==l.toLowerCase()||"checkbox"!==o.type&&"radio"!==o.type?n&&Ce(n.elementType)&&(g=Bi):g=Wi;switch(g&&(g=g(t,n))?ki(a,g,i,r):(v&&v(t,o,n),"focusout"===t&&n&&"number"===o.type&&null!=n.memoizedProps.value&&ye(o,"number",o.value)),v=n?Qt(n):window,t){case"focusin":(Di(v)||"true"===v.contentEditable)&&(nn=v,rn=n,sn=null);break;case"focusout":sn=rn=nn=null;break;case"mousedown":an=!0;break;case"contextmenu":case"mouseup":case"dragend":an=!1,on(a,i,r);break;case"selectionchange":if(en)break;case"keydown":case"keyup":on(a,i,r)}var y;if(xi)t:{switch(t){case"compositionstart":var b="onCompositionStart";break t;case"compositionend":b="onCompositionEnd";break t;case"compositionupdate":b="onCompositionUpdate";break t}b=void 0}else Pi?Ci(t,i)&&(b="onCompositionEnd"):"keydown"===t&&229===i.keyCode&&(b="onCompositionStart");b&&(Ai&&"ko"!==i.locale&&(Pi||"onCompositionStart"!==b?"onCompositionEnd"===b&&Pi&&(y=Ge()):(Ve="value"in(Ue=r)?Ue.value:Ue.textContent,Pi=!0)),0<(v=Bc(n,b)).length&&(b=new oi(b,t,null,i,r),a.push({event:b,listeners:v}),y?b.data=y:null!==(y=Mi(i))&&(b.data=y))),(y=Si?function(t,e){switch(t){case"compositionend":return Mi(e);case"keypress":return 32!==e.which?null:(_i=!0,Ei);case"textInput":return(t=e.data)===Ei&&_i?null:t;default:return null}}(t,i):function(t,e){if(Pi)return"compositionend"===t||!xi&&Ci(t,e)?(t=Ge(),je=Ve=Ue=null,Pi=!1,t):null;switch(t){case"paste":default:return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Ai&&"ko"!==e.locale?null:e.data}}(t,i))&&(0<(b=Bc(n,"onBeforeInput")).length&&(v=new oi("onBeforeInput","beforeinput",null,i,r),a.push({event:v,listeners:b}),v.data=y)),function(t,e,i,n,r){if("submit"===e&&i&&i.stateNode===r){var s=Sc((r[Nt]||null).action),a=n.submitter;a&&null!==(e=(e=a[Nt]||null)?Sc(e.formAction):a.getAttribute("formAction"))&&(s=e,a=null);var o=new Je("action","action",null,n,r);t.push({event:o,listeners:[{instance:null,listener:function(){if(n.defaultPrevented){if(0!==fc){var t=a?Ac(r,a):new FormData(r);ca(i,{pending:!0,data:t,method:r.method,action:s},null,t)}}else"function"===typeof s&&(o.preventDefault(),t=a?Ac(r,a):new FormData(r),ca(i,{pending:!0,data:t,method:r.method,action:s},s,t))},currentTarget:r}]})}}(a,t,n,i,r)}Pc(a,e)}))}function Lc(t,e,i){return{instance:t,listener:e,currentTarget:i}}function Bc(t,e){for(var i=e+"Capture",n=[];null!==t;){var r=t,s=r.stateNode;5!==(r=r.tag)&&26!==r&&27!==r||null===s||(null!=(r=ze(t,i))&&n.unshift(Lc(t,r,s)),null!=(r=ze(t,e))&&n.push(Lc(t,r,s))),t=t.return}return n}function zc(t){if(null===t)return null;do{t=t.return}while(t&&5!==t.tag&&27!==t.tag);return t||null}function Fc(t,e,i,n,r){for(var s=e._reactName,a=[];null!==i&&i!==n;){var o=i,l=o.alternate,h=o.stateNode;if(o=o.tag,null!==l&&l===n)break;5!==o&&26!==o&&27!==o||null===h||(l=h,r?null!=(h=ze(i,s))&&a.unshift(Lc(i,h,l)):r||null!=(h=ze(i,s))&&a.push(Lc(i,h,l))),i=i.return}0!==a.length&&t.push({event:e,listeners:a})}var Nc=/\r\n?/g,Uc=/\u0000|\uFFFD/g;function Vc(t){return("string"===typeof t?t:""+t).replace(Nc,"\n").replace(Uc,"")}function jc(t,e){return e=Vc(e),Vc(t)===e}function Gc(){}function Hc(t,e,i,n,r,s){switch(i){case"children":"string"===typeof n?"body"===e||"textarea"===e&&""===n||Se(t,n):("number"===typeof n||"bigint"===typeof n)&&"body"!==e&&Se(t,""+n);break;case"className":oe(t,"class",n);break;case"tabIndex":oe(t,"tabindex",n);break;case"dir":case"role":case"viewBox":case"width":case"height":oe(t,i,n);break;case"style":_e(t,n,s);break;case"data":if("object"!==e){oe(t,"data",n);break}case"src":case"href":if(""===n&&("a"!==e||"href"!==i)){t.removeAttribute(i);break}if(null==n||"function"===typeof n||"symbol"===typeof n||"boolean"===typeof n){t.removeAttribute(i);break}n=Te(""+n),t.setAttribute(i,n);break;case"action":case"formAction":if("function"===typeof n){t.setAttribute(i,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"===typeof s&&("formAction"===i?("input"!==e&&Hc(t,e,"name",r.name,r,null),Hc(t,e,"formEncType",r.formEncType,r,null),Hc(t,e,"formMethod",r.formMethod,r,null),Hc(t,e,"formTarget",r.formTarget,r,null)):(Hc(t,e,"encType",r.encType,r,null),Hc(t,e,"method",r.method,r,null),Hc(t,e,"target",r.target,r,null))),null==n||"symbol"===typeof n||"boolean"===typeof n){t.removeAttribute(i);break}n=Te(""+n),t.setAttribute(i,n);break;case"onClick":null!=n&&(t.onclick=Gc);break;case"onScroll":null!=n&&Tc("scroll",t);break;case"onScrollEnd":null!=n&&Tc("scrollend",t);break;case"dangerouslySetInnerHTML":if(null!=n){if("object"!==typeof n||!("__html"in n))throw Error(a(61));if(null!=(i=n.__html)){if(null!=r.children)throw Error(a(60));t.innerHTML=i}}break;case"multiple":t.multiple=n&&"function"!==typeof n&&"symbol"!==typeof n;break;case"muted":t.muted=n&&"function"!==typeof n&&"symbol"!==typeof n;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==n||"function"===typeof n||"boolean"===typeof n||"symbol"===typeof n){t.removeAttribute("xlink:href");break}i=Te(""+n),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=n&&"function"!==typeof n&&"symbol"!==typeof n?t.setAttribute(i,""+n):t.removeAttribute(i);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":n&&"function"!==typeof n&&"symbol"!==typeof n?t.setAttribute(i,""):t.removeAttribute(i);break;case"capture":case"download":!0===n?t.setAttribute(i,""):!1!==n&&null!=n&&"function"!==typeof n&&"symbol"!==typeof n?t.setAttribute(i,n):t.removeAttribute(i);break;case"cols":case"rows":case"size":case"span":null!=n&&"function"!==typeof n&&"symbol"!==typeof n&&!isNaN(n)&&1<=n?t.setAttribute(i,n):t.removeAttribute(i);break;case"rowSpan":case"start":null==n||"function"===typeof n||"symbol"===typeof n||isNaN(n)?t.removeAttribute(i):t.setAttribute(i,n);break;case"popover":Tc("beforetoggle",t),Tc("toggle",t),ae(t,"popover",n);break;case"xlinkActuate":le(t,"http://www.w3.org/1999/xlink","xlink:actuate",n);break;case"xlinkArcrole":le(t,"http://www.w3.org/1999/xlink","xlink:arcrole",n);break;case"xlinkRole":le(t,"http://www.w3.org/1999/xlink","xlink:role",n);break;case"xlinkShow":le(t,"http://www.w3.org/1999/xlink","xlink:show",n);break;case"xlinkTitle":le(t,"http://www.w3.org/1999/xlink","xlink:title",n);break;case"xlinkType":le(t,"http://www.w3.org/1999/xlink","xlink:type",n);break;case"xmlBase":le(t,"http://www.w3.org/XML/1998/namespace","xml:base",n);break;case"xmlLang":le(t,"http://www.w3.org/XML/1998/namespace","xml:lang",n);break;case"xmlSpace":le(t,"http://www.w3.org/XML/1998/namespace","xml:space",n);break;case"is":ae(t,"is",n);break;case"innerText":case"textContent":break;default:(!(2<i.length)||"o"!==i[0]&&"O"!==i[0]||"n"!==i[1]&&"N"!==i[1])&&ae(t,i=Me.get(i)||i,n)}}function Wc(t,e,i,n,r,s){switch(i){case"style":_e(t,n,s);break;case"dangerouslySetInnerHTML":if(null!=n){if("object"!==typeof n||!("__html"in n))throw Error(a(61));if(null!=(i=n.__html)){if(null!=r.children)throw Error(a(60));t.innerHTML=i}}break;case"children":"string"===typeof n?Se(t,n):("number"===typeof n||"bigint"===typeof n)&&Se(t,""+n);break;case"onScroll":null!=n&&Tc("scroll",t);break;case"onScrollEnd":null!=n&&Tc("scrollend",t);break;case"onClick":null!=n&&(t.onclick=Gc);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:$t.hasOwnProperty(i)||("o"!==i[0]||"n"!==i[1]||(r=i.endsWith("Capture"),e=i.slice(2,r?i.length-7:void 0),"function"===typeof(s=null!=(s=t[Nt]||null)?s[i]:null)&&t.removeEventListener(e,s,r),"function"!==typeof n)?i in t?t[i]=n:!0===n?t.setAttribute(i,""):ae(t,i,n):("function"!==typeof s&&null!==s&&(i in t?t[i]=null:t.hasAttribute(i)&&t.removeAttribute(i)),t.addEventListener(e,n,r)))}}function qc(t,e,i){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Tc("error",t),Tc("load",t);var n,r=!1,s=!1;for(n in i)if(i.hasOwnProperty(n)){var o=i[n];if(null!=o)switch(n){case"src":r=!0;break;case"srcSet":s=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,e));default:Hc(t,e,n,o,i,null)}}return s&&Hc(t,e,"srcSet",i.srcSet,i,null),void(r&&Hc(t,e,"src",i.src,i,null));case"input":Tc("invalid",t);var l=n=o=s=null,h=null,c=null;for(r in i)if(i.hasOwnProperty(r)){var u=i[r];if(null!=u)switch(r){case"name":s=u;break;case"type":o=u;break;case"checked":h=u;break;case"defaultChecked":c=u;break;case"value":n=u;break;case"defaultValue":l=u;break;case"children":case"dangerouslySetInnerHTML":if(null!=u)throw Error(a(137,e));break;default:Hc(t,e,r,u,i,null)}}return ve(t,n,l,h,c,o,s,!1),void ue(t);case"select":for(s in Tc("invalid",t),r=o=n=null,i)if(i.hasOwnProperty(s)&&null!=(l=i[s]))switch(s){case"value":n=l;break;case"defaultValue":o=l;break;case"multiple":r=l;default:Hc(t,e,s,l,i,null)}return e=n,i=o,t.multiple=!!r,void(null!=e?be(t,!!r,e,!1):null!=i&&be(t,!!r,i,!0));case"textarea":for(o in Tc("invalid",t),n=s=r=null,i)if(i.hasOwnProperty(o)&&null!=(l=i[o]))switch(o){case"value":r=l;break;case"defaultValue":s=l;break;case"children":n=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(a(91));break;default:Hc(t,e,o,l,i,null)}return we(t,r,s,n),void ue(t);case"option":for(h in i)if(i.hasOwnProperty(h)&&null!=(r=i[h]))if("selected"===h)t.selected=r&&"function"!==typeof r&&"symbol"!==typeof r;else Hc(t,e,h,r,i,null);return;case"dialog":Tc("cancel",t),Tc("close",t);break;case"iframe":case"object":Tc("load",t);break;case"video":case"audio":for(r=0;r<Cc.length;r++)Tc(Cc[r],t);break;case"image":Tc("error",t),Tc("load",t);break;case"details":Tc("toggle",t);break;case"embed":case"source":case"link":Tc("error",t),Tc("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(c in i)if(i.hasOwnProperty(c)&&null!=(r=i[c]))switch(c){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,e));default:Hc(t,e,c,r,i,null)}return;default:if(Ce(e)){for(u in i)i.hasOwnProperty(u)&&(void 0!==(r=i[u])&&Wc(t,e,u,r,i,void 0));return}}for(l in i)i.hasOwnProperty(l)&&(null!=(r=i[l])&&Hc(t,e,l,r,i,null))}var Yc=null,Xc=null;function Qc(t){return 9===t.nodeType?t:t.ownerDocument}function Kc(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Zc(t,e){if(0===t)switch(e){case"svg":return 1;case"math":return 2;default:return 0}return 1===t&&"foreignObject"===e?0:t}function Jc(t,e){return"textarea"===t||"noscript"===t||"string"===typeof e.children||"number"===typeof e.children||"bigint"===typeof e.children||"object"===typeof e.dangerouslySetInnerHTML&&null!==e.dangerouslySetInnerHTML&&null!=e.dangerouslySetInnerHTML.__html}var $c=null;var tu="function"===typeof setTimeout?setTimeout:void 0,eu="function"===typeof clearTimeout?clearTimeout:void 0,iu="function"===typeof Promise?Promise:void 0,nu="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof iu?function(t){return iu.resolve(null).then(t).catch(ru)}:tu;function ru(t){setTimeout((function(){throw t}))}function su(t,e){var i=e,n=0;do{var r=i.nextSibling;if(t.removeChild(i),r&&8===r.nodeType)if("/$"===(i=r.data)){if(0===n)return t.removeChild(r),void md(e);n--}else"$"!==i&&"$?"!==i&&"$!"!==i||n++;i=r}while(i);md(e)}function au(t){var e=t.firstChild;for(e&&10===e.nodeType&&(e=e.nextSibling);e;){var i=e;switch(e=e.nextSibling,i.nodeName){case"HTML":case"HEAD":case"BODY":au(i),qt(i);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===i.rel.toLowerCase())continue}t.removeChild(i)}}function ou(t){for(;null!=t;t=t.nextSibling){var e=t.nodeType;if(1===e||3===e)break;if(8===e){if("$"===(e=t.data)||"$!"===e||"$?"===e||"F!"===e||"F"===e)break;if("/$"===e)return null}}return t}function lu(t){t=t.previousSibling;for(var e=0;t;){if(8===t.nodeType){var i=t.data;if("$"===i||"$!"===i||"$?"===i){if(0===e)return t;e--}else"/$"===i&&e++}t=t.previousSibling}return null}function hu(t,e,i){switch(e=Qc(i),t){case"html":if(!(t=e.documentElement))throw Error(a(452));return t;case"head":if(!(t=e.head))throw Error(a(453));return t;case"body":if(!(t=e.body))throw Error(a(454));return t;default:throw Error(a(451))}}var cu=new Map,uu=new Set;function du(t){return"function"===typeof t.getRootNode?t.getRootNode():t.ownerDocument}var pu=j.d;j.d={f:function(){var t=pu.f(),e=Fh();return t||e},r:function(t){var e=Xt(t);null!==e&&5===e.tag&&"form"===e.type?da(e):pu.r(t)},D:function(t){pu.D(t),mu("dns-prefetch",t,null)},C:function(t,e){pu.C(t,e),mu("preconnect",t,e)},L:function(t,e,i){pu.L(t,e,i);var n=fu;if(n&&t&&e){var r='link[rel="preload"][as="'+me(e)+'"]';"image"===e&&i&&i.imageSrcSet?(r+='[imagesrcset="'+me(i.imageSrcSet)+'"]',"string"===typeof i.imageSizes&&(r+='[imagesizes="'+me(i.imageSizes)+'"]')):r+='[href="'+me(t)+'"]';var s=r;switch(e){case"style":s=vu(t);break;case"script":s=xu(t)}cu.has(s)||(t=k({rel:"preload",href:"image"===e&&i&&i.imageSrcSet?void 0:t,as:e},i),cu.set(s,t),null!==n.querySelector(r)||"style"===e&&n.querySelector(yu(s))||"script"===e&&n.querySelector(wu(s))||(qc(e=n.createElement("link"),"link",t),Zt(e),n.head.appendChild(e)))}},m:function(t,e){pu.m(t,e);var i=fu;if(i&&t){var n=e&&"string"===typeof e.as?e.as:"script",r='link[rel="modulepreload"][as="'+me(n)+'"][href="'+me(t)+'"]',s=r;switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":s=xu(t)}if(!cu.has(s)&&(t=k({rel:"modulepreload",href:t},e),cu.set(s,t),null===i.querySelector(r))){switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(i.querySelector(wu(s)))return}qc(n=i.createElement("link"),"link",t),Zt(n),i.head.appendChild(n)}}},X:function(t,e){pu.X(t,e);var i=fu;if(i&&t){var n=Kt(i).hoistableScripts,r=xu(t),s=n.get(r);s||((s=i.querySelector(wu(r)))||(t=k({src:t,async:!0},e),(e=cu.get(r))&&_u(t,e),Zt(s=i.createElement("script")),qc(s,"link",t),i.head.appendChild(s)),s={type:"script",instance:s,count:1,state:null},n.set(r,s))}},S:function(t,e,i){pu.S(t,e,i);var n=fu;if(n&&t){var r=Kt(n).hoistableStyles,s=vu(t);e=e||"default";var a=r.get(s);if(!a){var o={loading:0,preload:null};if(a=n.querySelector(yu(s)))o.loading=5;else{t=k({rel:"stylesheet",href:t,"data-precedence":e},i),(i=cu.get(s))&&Eu(t,i);var l=a=n.createElement("link");Zt(l),qc(l,"link",t),l._p=new Promise((function(t,e){l.onload=t,l.onerror=e})),l.addEventListener("load",(function(){o.loading|=1})),l.addEventListener("error",(function(){o.loading|=2})),o.loading|=4,Au(a,e,n)}a={type:"stylesheet",instance:a,count:1,state:o},r.set(s,a)}}},M:function(t,e){pu.M(t,e);var i=fu;if(i&&t){var n=Kt(i).hoistableScripts,r=xu(t),s=n.get(r);s||((s=i.querySelector(wu(r)))||(t=k({src:t,async:!0,type:"module"},e),(e=cu.get(r))&&_u(t,e),Zt(s=i.createElement("script")),qc(s,"link",t),i.head.appendChild(s)),s={type:"script",instance:s,count:1,state:null},n.set(r,s))}}};var fu="undefined"===typeof document?null:document;function mu(t,e,i){var n=fu;if(n&&"string"===typeof e&&e){var r=me(e);r='link[rel="'+t+'"][href="'+r+'"]',"string"===typeof i&&(r+='[crossorigin="'+i+'"]'),uu.has(r)||(uu.add(r),t={rel:t,crossOrigin:i,href:e},null===n.querySelector(r)&&(qc(e=n.createElement("link"),"link",t),Zt(e),n.head.appendChild(e)))}}function gu(t,e,i,n){var r,s,o,l,h=(h=Z.current)?du(h):null;if(!h)throw Error(a(446));switch(t){case"meta":case"title":return null;case"style":return"string"===typeof i.precedence&&"string"===typeof i.href?(e=vu(i.href),(n=(i=Kt(h).hoistableStyles).get(e))||(n={type:"style",instance:null,count:0,state:null},i.set(e,n)),n):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===i.rel&&"string"===typeof i.href&&"string"===typeof i.precedence){t=vu(i.href);var c=Kt(h).hoistableStyles,u=c.get(t);if(u||(h=h.ownerDocument||h,u={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},c.set(t,u),(c=h.querySelector(yu(t)))&&!c._p&&(u.instance=c,u.state.loading=5),cu.has(t)||(i={rel:"preload",as:"style",href:i.href,crossOrigin:i.crossOrigin,integrity:i.integrity,media:i.media,hrefLang:i.hrefLang,referrerPolicy:i.referrerPolicy},cu.set(t,i),c||(r=h,s=t,o=i,l=u.state,r.querySelector('link[rel="preload"][as="style"]['+s+"]")?l.loading=1:(s=r.createElement("link"),l.preload=s,s.addEventListener("load",(function(){return l.loading|=1})),s.addEventListener("error",(function(){return l.loading|=2})),qc(s,"link",o),Zt(s),r.head.appendChild(s))))),e&&null===n)throw Error(a(528,""));return u}if(e&&null!==n)throw Error(a(529,""));return null;case"script":return e=i.async,"string"===typeof(i=i.src)&&e&&"function"!==typeof e&&"symbol"!==typeof e?(e=xu(i),(n=(i=Kt(h).hoistableScripts).get(e))||(n={type:"script",instance:null,count:0,state:null},i.set(e,n)),n):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,t))}}function vu(t){return'href="'+me(t)+'"'}function yu(t){return'link[rel="stylesheet"]['+t+"]"}function bu(t){return k({},t,{"data-precedence":t.precedence,precedence:null})}function xu(t){return'[src="'+me(t)+'"]'}function wu(t){return"script[async]"+t}function Su(t,e,i){if(e.count++,null===e.instance)switch(e.type){case"style":var n=t.querySelector('style[data-href~="'+me(i.href)+'"]');if(n)return e.instance=n,Zt(n),n;var r=k({},i,{"data-href":i.href,"data-precedence":i.precedence,href:null,precedence:null});return Zt(n=(t.ownerDocument||t).createElement("style")),qc(n,"style",r),Au(n,i.precedence,t),e.instance=n;case"stylesheet":r=vu(i.href);var s=t.querySelector(yu(r));if(s)return e.state.loading|=4,e.instance=s,Zt(s),s;n=bu(i),(r=cu.get(r))&&Eu(n,r),Zt(s=(t.ownerDocument||t).createElement("link"));var o=s;return o._p=new Promise((function(t,e){o.onload=t,o.onerror=e})),qc(s,"link",n),e.state.loading|=4,Au(s,i.precedence,t),e.instance=s;case"script":return s=xu(i.src),(r=t.querySelector(wu(s)))?(e.instance=r,Zt(r),r):(n=i,(r=cu.get(s))&&_u(n=k({},i),r),Zt(r=(t=t.ownerDocument||t).createElement("script")),qc(r,"link",n),t.head.appendChild(r),e.instance=r);case"void":return null;default:throw Error(a(443,e.type))}else"stylesheet"===e.type&&0===(4&e.state.loading)&&(n=e.instance,e.state.loading|=4,Au(n,i.precedence,t));return e.instance}function Au(t,e,i){for(var n=i.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),r=n.length?n[n.length-1]:null,s=r,a=0;a<n.length;a++){var o=n[a];if(o.dataset.precedence===e)s=o;else if(s!==r)break}s?s.parentNode.insertBefore(t,s.nextSibling):(e=9===i.nodeType?i.head:i).insertBefore(t,e.firstChild)}function Eu(t,e){null==t.crossOrigin&&(t.crossOrigin=e.crossOrigin),null==t.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),null==t.title&&(t.title=e.title)}function _u(t,e){null==t.crossOrigin&&(t.crossOrigin=e.crossOrigin),null==t.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),null==t.integrity&&(t.integrity=e.integrity)}var Cu=null;function Mu(t,e,i){if(null===Cu){var n=new Map,r=Cu=new Map;r.set(i,n)}else(n=(r=Cu).get(i))||(n=new Map,r.set(i,n));if(n.has(t))return n;for(n.set(t,null),i=i.getElementsByTagName(t),r=0;r<i.length;r++){var s=i[r];if(!(s[Wt]||s[Ft]||"link"===t&&"stylesheet"===s.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==s.namespaceURI){var a=s.getAttribute(e)||"";a=t+a;var o=n.get(a);o?o.push(s):n.set(a,[s])}}return n}function Pu(t,e,i){(t=t.ownerDocument||t).head.insertBefore(i,"title"===e?t.querySelector("head > title"):null)}function Tu(t){return"stylesheet"!==t.type||0!==(3&t.state.loading)}var Du=null;function ku(){}function Iu(){if(this.count--,0===this.count)if(this.stylesheets)Ou(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}var Ru=null;function Ou(t,e){t.stylesheets=null,null!==t.unsuspend&&(t.count++,Ru=new Map,e.forEach(Lu,t),Ru=null,Iu.call(t))}function Lu(t,e){if(!(4&e.state.loading)){var i=Ru.get(t);if(i)var n=i.get(null);else{i=new Map,Ru.set(t,i);for(var r=t.querySelectorAll("link[data-precedence],style[data-precedence]"),s=0;s<r.length;s++){var a=r[s];"LINK"!==a.nodeName&&"not all"===a.getAttribute("media")||(i.set(a.dataset.precedence,a),n=a)}n&&i.set(null,n)}a=(r=e.instance).getAttribute("data-precedence"),(s=i.get(a)||n)===n&&i.set(null,r),i.set(a,r),this.count++,n=Iu.bind(this),r.addEventListener("load",n),r.addEventListener("error",n),s?s.parentNode.insertBefore(r,s.nextSibling):(t=9===t.nodeType?t.head:t).insertBefore(r,t.firstChild),e.state.loading|=4}}var Bu={$$typeof:g,Provider:null,Consumer:null,_currentValue:G,_currentValue2:G,_threadCount:0};function zu(t,e,i,n,r,s,a,o){this.tag=1,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=kt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=kt(0),this.hiddenUpdates=kt(null),this.identifierPrefix=n,this.onUncaughtError=r,this.onCaughtError=s,this.onRecoverableError=a,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=o,this.incompleteTransitions=new Map}function Fu(t,e,i,n,r,s,a,o,l,h,c,u){return t=new zu(t,e,i,a,o,l,h,u),e=1,!0===s&&(e|=24),s=Ll(3,null,null,e),t.current=s,s.stateNode=t,(e=Ur()).refCount++,t.pooledCache=e,e.refCount++,s.memoizedState={element:n,isDehydrated:i,cache:e},To(s),t}function Nu(t){return t?t=In:In}function Uu(t,e,i,n,r,s){r=Nu(r),null===n.context?n.context=r:n.pendingContext=r,(n=ko(e)).payload={element:i},null!==(s=void 0===s?null:s)&&(n.callback=s),null!==(i=Io(t,n,e))&&(Ih(i,0,e),Ro(i,t,e))}function Vu(t,e){if(null!==(t=t.memoizedState)&&null!==t.dehydrated){var i=t.retryLane;t.retryLane=0!==i&&i<e?i:e}}function ju(t,e){Vu(t,e),(t=t.alternate)&&Vu(t,e)}function Gu(t){if(13===t.tag){var e=Tn(t,67108864);null!==e&&Ih(e,0,67108864),ju(t,67108864)}}var Hu=!0;function Wu(t,e,i,n){var r=D.T;D.T=null;var s=j.p;try{j.p=2,Yu(t,e,i,n)}finally{j.p=s,D.T=r}}function qu(t,e,i,n){var r=D.T;D.T=null;var s=j.p;try{j.p=8,Yu(t,e,i,n)}finally{j.p=s,D.T=r}}function Yu(t,e,i,n){if(Hu){var r=Xu(n);if(null===r)Oc(t,e,n,Qu,i),ad(t,n);else if(function(t,e,i,n,r){switch(e){case"focusin":return $u=od($u,t,e,i,n,r),!0;case"dragenter":return td=od(td,t,e,i,n,r),!0;case"mouseover":return ed=od(ed,t,e,i,n,r),!0;case"pointerover":var s=r.pointerId;return id.set(s,od(id.get(s)||null,t,e,i,n,r)),!0;case"gotpointercapture":return s=r.pointerId,nd.set(s,od(nd.get(s)||null,t,e,i,n,r)),!0}return!1}(r,t,e,i,n))n.stopPropagation();else if(ad(t,n),4&e&&-1<sd.indexOf(t)){for(;null!==r;){var s=Xt(r);if(null!==s)switch(s.tag){case 3:if((s=s.stateNode).current.memoizedState.isDehydrated){var a=_t(s.pendingLanes);if(0!==a){var o=s;for(o.pendingLanes|=2,o.entangledLanes|=2;a;){var l=1<<31-xt(a);o.entanglements[1]|=l,a&=~l}mc(s),0===(6&th)&&(xh=lt()+500,gc(0,!1))}}break;case 13:null!==(o=Tn(s,2))&&Ih(o,0,2),Fh(),ju(s,2)}if(null===(s=Xu(n))&&Oc(t,e,n,Qu,i),s===r)break;r=s}null!==r&&n.stopPropagation()}else Oc(t,e,n,null,i)}}function Xu(t){return Ku(t=ke(t))}var Qu=null;function Ku(t){if(Qu=null,null!==(t=Yt(t))){var e=z(t);if(null===e)t=null;else{var i=e.tag;if(13===i){if(null!==(t=F(e)))return t;t=null}else if(3===i){if(e.stateNode.current.memoizedState.isDehydrated)return 3===e.tag?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null)}}return Qu=t,null}function Zu(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ht()){case ct:return 2;case ut:return 8;case dt:case pt:return 32;case ft:return 268435456;default:return 32}default:return 32}}var Ju=!1,$u=null,td=null,ed=null,id=new Map,nd=new Map,rd=[],sd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function ad(t,e){switch(t){case"focusin":case"focusout":$u=null;break;case"dragenter":case"dragleave":td=null;break;case"mouseover":case"mouseout":ed=null;break;case"pointerover":case"pointerout":id.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":nd.delete(e.pointerId)}}function od(t,e,i,n,r,s){return null===t||t.nativeEvent!==s?(t={blockedOn:e,domEventName:i,eventSystemFlags:n,nativeEvent:s,targetContainers:[r]},null!==e&&(null!==(e=Xt(e))&&Gu(e)),t):(t.eventSystemFlags|=n,e=t.targetContainers,null!==r&&-1===e.indexOf(r)&&e.push(r),t)}function ld(t){var e=Yt(t.target);if(null!==e){var i=z(e);if(null!==i)if(13===(e=i.tag)){if(null!==(e=F(i)))return t.blockedOn=e,void function(t,e){var i=j.p;try{return j.p=t,e()}finally{j.p=i}}(t.priority,(function(){if(13===i.tag){var t=Dh(),e=Tn(i,t);null!==e&&Ih(e,0,t),ju(i,t)}}))}else if(3===e&&i.stateNode.current.memoizedState.isDehydrated)return void(t.blockedOn=3===i.tag?i.stateNode.containerInfo:null)}t.blockedOn=null}function hd(t){if(null!==t.blockedOn)return!1;for(var e=t.targetContainers;0<e.length;){var i=Xu(t.nativeEvent);if(null!==i)return null!==(e=Xt(i))&&Gu(e),t.blockedOn=i,!1;var n=new(i=t.nativeEvent).constructor(i.type,i);De=n,i.target.dispatchEvent(n),De=null,e.shift()}return!0}function cd(t,e,i){hd(t)&&i.delete(e)}function ud(){Ju=!1,null!==$u&&hd($u)&&($u=null),null!==td&&hd(td)&&(td=null),null!==ed&&hd(ed)&&(ed=null),id.forEach(cd),nd.forEach(cd)}function dd(t,e){t.blockedOn===e&&(t.blockedOn=null,Ju||(Ju=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,ud)))}var pd=null;function fd(t){pd!==t&&(pd=t,n.unstable_scheduleCallback(n.unstable_NormalPriority,(function(){pd===t&&(pd=null);for(var e=0;e<t.length;e+=3){var i=t[e],n=t[e+1],r=t[e+2];if("function"!==typeof n){if(null===Ku(n||i))continue;break}var s=Xt(i);null!==s&&(t.splice(e,3),e-=3,ca(s,{pending:!0,data:r,method:i.method,action:n},n,r))}})))}function md(t){function e(e){return dd(e,t)}null!==$u&&dd($u,t),null!==td&&dd(td,t),null!==ed&&dd(ed,t),id.forEach(e),nd.forEach(e);for(var i=0;i<rd.length;i++){var n=rd[i];n.blockedOn===t&&(n.blockedOn=null)}for(;0<rd.length&&null===(i=rd[0]).blockedOn;)ld(i),null===i.blockedOn&&rd.shift();if(null!=(i=(t.ownerDocument||t).$$reactFormReplay))for(n=0;n<i.length;n+=3){var r=i[n],s=i[n+1],a=r[Nt]||null;if("function"===typeof s)a||fd(i);else if(a){var o=null;if(s&&s.hasAttribute("formAction")){if(r=s,a=s[Nt]||null)o=a.formAction;else if(null!==Ku(r))continue}else o=a.action;"function"===typeof o?i[n+1]=o:(i.splice(n,3),n-=3),fd(i)}}}function gd(t){this._internalRoot=t}function vd(t){this._internalRoot=t}vd.prototype.render=gd.prototype.render=function(t){var e=this._internalRoot;if(null===e)throw Error(a(409));Uu(e.current,Dh(),t,e,null,null)},vd.prototype.unmount=gd.prototype.unmount=function(){var t=this._internalRoot;if(null!==t){this._internalRoot=null;var e=t.containerInfo;0===t.tag&&ec(),Uu(t.current,2,null,t,null,null),Fh(),e[Ut]=null}},vd.prototype.unstable_scheduleHydration=function(t){if(t){var e=Bt();t={blockedOn:null,target:t,priority:e};for(var i=0;i<rd.length&&0!==e&&e<rd[i].priority;i++);rd.splice(i,0,t),0===i&&ld(t)}};var yd=r.version;if("19.0.0"!==yd)throw Error(a(527,yd,"19.0.0"));j.findDOMNode=function(t){var e=t._reactInternals;if(void 0===e){if("function"===typeof t.render)throw Error(a(188));throw t=Object.keys(t).join(","),Error(a(268,t))}return t=function(t){var e=t.alternate;if(!e){if(null===(e=z(t)))throw Error(a(188));return e!==t?null:t}for(var i=t,n=e;;){var r=i.return;if(null===r)break;var s=r.alternate;if(null===s){if(null!==(n=r.return)){i=n;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===i)return N(r),t;if(s===n)return N(r),e;s=s.sibling}throw Error(a(188))}if(i.return!==n.return)i=r,n=s;else{for(var o=!1,l=r.child;l;){if(l===i){o=!0,i=r,n=s;break}if(l===n){o=!0,n=r,i=s;break}l=l.sibling}if(!o){for(l=s.child;l;){if(l===i){o=!0,i=s,n=r;break}if(l===n){o=!0,n=s,i=r;break}l=l.sibling}if(!o)throw Error(a(189))}}if(i.alternate!==n)throw Error(a(190))}if(3!==i.tag)throw Error(a(188));return i.stateNode.current===i?t:e}(e),t=null===(t=null!==t?U(t):null)?null:t.stateNode};var bd={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:D,findFiberByHostInstance:Yt,reconcilerVersion:"19.0.0"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var xd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!xd.isDisabled&&xd.supportsFiber)try{vt=xd.inject(bd),yt=xd}catch(Sd){}}e.createRoot=function(t,e){if(!o(t))throw Error(a(299));var i=!1,n="",r=Oa,s=La,l=Ba;return null!==e&&void 0!==e&&(!0===e.unstable_strictMode&&(i=!0),void 0!==e.identifierPrefix&&(n=e.identifierPrefix),void 0!==e.onUncaughtError&&(r=e.onUncaughtError),void 0!==e.onCaughtError&&(s=e.onCaughtError),void 0!==e.onRecoverableError&&(l=e.onRecoverableError),void 0!==e.unstable_transitionCallbacks&&e.unstable_transitionCallbacks),e=Fu(t,1,!1,null,0,i,n,r,s,l,0,null),t[Ut]=e.current,Ic(8===t.nodeType?t.parentNode:t),new gd(e)},e.hydrateRoot=function(t,e,i){if(!o(t))throw Error(a(299));var n=!1,r="",s=Oa,l=La,h=Ba,c=null;return null!==i&&void 0!==i&&(!0===i.unstable_strictMode&&(n=!0),void 0!==i.identifierPrefix&&(r=i.identifierPrefix),void 0!==i.onUncaughtError&&(s=i.onUncaughtError),void 0!==i.onCaughtError&&(l=i.onCaughtError),void 0!==i.onRecoverableError&&(h=i.onRecoverableError),void 0!==i.unstable_transitionCallbacks&&i.unstable_transitionCallbacks,void 0!==i.formState&&(c=i.formState)),(e=Fu(t,1,!0,e,0,n,r,s,l,h,0,c)).context=Nu(null),i=e.current,(r=ko(n=Dh())).callback=null,Io(i,r,n),e.current.lanes=n,It(e,n),mc(e),t[Ut]=e.current,Ic(t),new vd(e)},e.version="19.0.0"},43:(t,e,i)=>{"use strict";t.exports=i(288)},288:(t,e)=>{"use strict";var i=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function v(t,e,i){this.props=t,this.context=e,this.refs=g,this.updater=i||f}function y(){}function b(t,e,i){this.props=t,this.context=e,this.refs=g,this.updater=i||f}v.prototype.isReactComponent={},v.prototype.setState=function(t,e){if("object"!==typeof t&&"function"!==typeof t&&null!=t)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},v.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")},y.prototype=v.prototype;var x=b.prototype=new y;x.constructor=b,m(x,v.prototype),x.isPureReactComponent=!0;var w=Array.isArray,S={H:null,A:null,T:null,S:null},A=Object.prototype.hasOwnProperty;function E(t,e,n,r,s,a){return n=a.ref,{$$typeof:i,type:t,key:e,ref:void 0!==n?n:null,props:a}}function _(t){return"object"===typeof t&&null!==t&&t.$$typeof===i}var C=/\/+/g;function M(t,e){return"object"===typeof t&&null!==t&&null!=t.key?function(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,(function(t){return e[t]}))}(""+t.key):e.toString(36)}function P(){}function T(t,e,r,s,a){var o=typeof t;"undefined"!==o&&"boolean"!==o||(t=null);var l,h,c=!1;if(null===t)c=!0;else switch(o){case"bigint":case"string":case"number":c=!0;break;case"object":switch(t.$$typeof){case i:case n:c=!0;break;case d:return T((c=t._init)(t._payload),e,r,s,a)}}if(c)return a=a(t),c=""===s?"."+M(t,0):s,w(a)?(r="",null!=c&&(r=c.replace(C,"$&/")+"/"),T(a,e,r,"",(function(t){return t}))):null!=a&&(_(a)&&(l=a,h=r+(null==a.key||t&&t.key===a.key?"":(""+a.key).replace(C,"$&/")+"/")+c,a=E(l.type,h,void 0,0,0,l.props)),e.push(a)),1;c=0;var u,f=""===s?".":s+":";if(w(t))for(var m=0;m<t.length;m++)c+=T(s=t[m],e,r,o=f+M(s,m),a);else if("function"===typeof(m=null===(u=t)||"object"!==typeof u?null:"function"===typeof(u=p&&u[p]||u["@@iterator"])?u:null))for(t=m.call(t),m=0;!(s=t.next()).done;)c+=T(s=s.value,e,r,o=f+M(s,m++),a);else if("object"===o){if("function"===typeof t.then)return T(function(t){switch(t.status){case"fulfilled":return t.value;case"rejected":throw t.reason;default:switch("string"===typeof t.status?t.then(P,P):(t.status="pending",t.then((function(e){"pending"===t.status&&(t.status="fulfilled",t.value=e)}),(function(e){"pending"===t.status&&(t.status="rejected",t.reason=e)}))),t.status){case"fulfilled":return t.value;case"rejected":throw t.reason}}throw t}(t),e,r,s,a);throw e=String(t),Error("Objects are not valid as a React child (found: "+("[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.")}return c}function D(t,e,i){if(null==t)return t;var n=[],r=0;return T(t,n,"","",(function(t){return e.call(i,t,r++)})),n}function k(t){if(-1===t._status){var e=t._result;(e=e()).then((function(e){0!==t._status&&-1!==t._status||(t._status=1,t._result=e)}),(function(e){0!==t._status&&-1!==t._status||(t._status=2,t._result=e)})),-1===t._status&&(t._status=0,t._result=e)}if(1===t._status)return t._result.default;throw t._result}var I="function"===typeof reportError?reportError:function(t){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof t&&null!==t&&"string"===typeof t.message?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",t);console.error(t)};function R(){}e.Children={map:D,forEach:function(t,e,i){D(t,(function(){e.apply(this,arguments)}),i)},count:function(t){var e=0;return D(t,(function(){e++})),e},toArray:function(t){return D(t,(function(t){return t}))||[]},only:function(t){if(!_(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},e.Component=v,e.Fragment=r,e.Profiler=a,e.PureComponent=b,e.StrictMode=s,e.Suspense=c,e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,e.act=function(){throw Error("act(...) is not supported in production builds of React.")},e.cache=function(t){return function(){return t.apply(null,arguments)}},e.cloneElement=function(t,e,i){if(null===t||void 0===t)throw Error("The argument must be a React element, but you passed "+t+".");var n=m({},t.props),r=t.key;if(null!=e)for(s in void 0!==e.ref&&void 0,void 0!==e.key&&(r=""+e.key),e)!A.call(e,s)||"key"===s||"__self"===s||"__source"===s||"ref"===s&&void 0===e.ref||(n[s]=e[s]);var s=arguments.length-2;if(1===s)n.children=i;else if(1<s){for(var a=Array(s),o=0;o<s;o++)a[o]=arguments[o+2];n.children=a}return E(t.type,r,void 0,0,0,n)},e.createContext=function(t){return(t={$$typeof:l,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null}).Provider=t,t.Consumer={$$typeof:o,_context:t},t},e.createElement=function(t,e,i){var n,r={},s=null;if(null!=e)for(n in void 0!==e.key&&(s=""+e.key),e)A.call(e,n)&&"key"!==n&&"__self"!==n&&"__source"!==n&&(r[n]=e[n]);var a=arguments.length-2;if(1===a)r.children=i;else if(1<a){for(var o=Array(a),l=0;l<a;l++)o[l]=arguments[l+2];r.children=o}if(t&&t.defaultProps)for(n in a=t.defaultProps)void 0===r[n]&&(r[n]=a[n]);return E(t,s,void 0,0,0,r)},e.createRef=function(){return{current:null}},e.forwardRef=function(t){return{$$typeof:h,render:t}},e.isValidElement=_,e.lazy=function(t){return{$$typeof:d,_payload:{_status:-1,_result:t},_init:k}},e.memo=function(t,e){return{$$typeof:u,type:t,compare:void 0===e?null:e}},e.startTransition=function(t){var e=S.T,i={};S.T=i;try{var n=t(),r=S.S;null!==r&&r(i,n),"object"===typeof n&&null!==n&&"function"===typeof n.then&&n.then(R,I)}catch(s){I(s)}finally{S.T=e}},e.unstable_useCacheRefresh=function(){return S.H.useCacheRefresh()},e.use=function(t){return S.H.use(t)},e.useActionState=function(t,e,i){return S.H.useActionState(t,e,i)},e.useCallback=function(t,e){return S.H.useCallback(t,e)},e.useContext=function(t){return S.H.useContext(t)},e.useDebugValue=function(){},e.useDeferredValue=function(t,e){return S.H.useDeferredValue(t,e)},e.useEffect=function(t,e){return S.H.useEffect(t,e)},e.useId=function(){return S.H.useId()},e.useImperativeHandle=function(t,e,i){return S.H.useImperativeHandle(t,e,i)},e.useInsertionEffect=function(t,e){return S.H.useInsertionEffect(t,e)},e.useLayoutEffect=function(t,e){return S.H.useLayoutEffect(t,e)},e.useMemo=function(t,e){return S.H.useMemo(t,e)},e.useOptimistic=function(t,e){return S.H.useOptimistic(t,e)},e.useReducer=function(t,e,i){return S.H.useReducer(t,e,i)},e.useRef=function(t){return S.H.useRef(t)},e.useState=function(t){return S.H.useState(t)},e.useSyncExternalStore=function(t,e,i){return S.H.useSyncExternalStore(t,e,i)},e.useTransition=function(){return S.H.useTransition()},e.version="19.0.0"},302:function(module,exports,__webpack_require__){var factory;"undefined"!==typeof navigator&&(factory=function(){"use strict";var svgNS="http://www.w3.org/2000/svg",locationHref="",_useWebWorker=!1,initialDefaultFrame=-999999,setWebWorker=function(t){_useWebWorker=!!t},getWebWorker=function(){return _useWebWorker},setLocationHref=function(t){locationHref=t},getLocationHref=function(){return locationHref};function createTag(t){return document.createElement(t)}function extendPrototype(t,e){var i,n,r=t.length;for(i=0;i<r;i+=1)for(var s in n=t[i].prototype)Object.prototype.hasOwnProperty.call(n,s)&&(e.prototype[s]=n[s])}function getDescriptor(t,e){return Object.getOwnPropertyDescriptor(t,e)}function createProxyFunction(t){function e(){}return e.prototype=t,e}var audioControllerFactory=function(){function t(t){this.audios=[],this.audioFactory=t,this._volume=1,this._isMuted=!1}return t.prototype={addAudio:function(t){this.audios.push(t)},pause:function(){var t,e=this.audios.length;for(t=0;t<e;t+=1)this.audios[t].pause()},resume:function(){var t,e=this.audios.length;for(t=0;t<e;t+=1)this.audios[t].resume()},setRate:function(t){var e,i=this.audios.length;for(e=0;e<i;e+=1)this.audios[e].setRate(t)},createAudio:function(t){return this.audioFactory?this.audioFactory(t):window.Howl?new window.Howl({src:[t]}):{isPlaying:!1,play:function(){this.isPlaying=!0},seek:function(){this.isPlaying=!1},playing:function(){},rate:function(){},setVolume:function(){}}},setAudioFactory:function(t){this.audioFactory=t},setVolume:function(t){this._volume=t,this._updateVolume()},mute:function(){this._isMuted=!0,this._updateVolume()},unmute:function(){this._isMuted=!1,this._updateVolume()},getVolume:function(){return this._volume},_updateVolume:function(){var t,e=this.audios.length;for(t=0;t<e;t+=1)this.audios[t].volume(this._volume*(this._isMuted?0:1))}},function(){return new t}}(),createTypedArray=function(){function t(t,e){var i,n=0,r=[];switch(t){case"int16":case"uint8c":i=1;break;default:i=1.1}for(n=0;n<e;n+=1)r.push(i);return r}return"function"===typeof Uint8ClampedArray&&"function"===typeof Float32Array?function(e,i){return"float32"===e?new Float32Array(i):"int16"===e?new Int16Array(i):"uint8c"===e?new Uint8ClampedArray(i):t(e,i)}:t}();function createSizedArray(t){return Array.apply(null,{length:t})}function _typeof$6(t){return _typeof$6="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof$6(t)}var subframeEnabled=!0,expressionsPlugin=null,expressionsInterfaces=null,idPrefix$1="",isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),_shouldRoundValues=!1,bmPow=Math.pow,bmSqrt=Math.sqrt,bmFloor=Math.floor,bmMax=Math.max,bmMin=Math.min,BMMath={};function ProjectInterface$1(){return{}}!function(){var t,e=["abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","cbrt","expm1","clz32","cos","cosh","exp","floor","fround","hypot","imul","log","log1p","log2","log10","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc","E","LN10","LN2","LOG10E","LOG2E","PI","SQRT1_2","SQRT2"],i=e.length;for(t=0;t<i;t+=1)BMMath[e[t]]=Math[e[t]]}(),BMMath.random=Math.random,BMMath.abs=function(t){if("object"===_typeof$6(t)&&t.length){var e,i=createSizedArray(t.length),n=t.length;for(e=0;e<n;e+=1)i[e]=Math.abs(t[e]);return i}return Math.abs(t)};var defaultCurveSegments=150,degToRads=Math.PI/180,roundCorner=.5519;function roundValues(t){_shouldRoundValues=!!t}function bmRnd(t){return _shouldRoundValues?Math.round(t):t}function styleDiv(t){t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.display="block",t.style.transformOrigin="0 0",t.style.webkitTransformOrigin="0 0",t.style.backfaceVisibility="visible",t.style.webkitBackfaceVisibility="visible",t.style.transformStyle="preserve-3d",t.style.webkitTransformStyle="preserve-3d",t.style.mozTransformStyle="preserve-3d"}function BMEnterFrameEvent(t,e,i,n){this.type=t,this.currentTime=e,this.totalTime=i,this.direction=n<0?-1:1}function BMCompleteEvent(t,e){this.type=t,this.direction=e<0?-1:1}function BMCompleteLoopEvent(t,e,i,n){this.type=t,this.currentLoop=i,this.totalLoops=e,this.direction=n<0?-1:1}function BMSegmentStartEvent(t,e,i){this.type=t,this.firstFrame=e,this.totalFrames=i}function BMDestroyEvent(t,e){this.type=t,this.target=e}function BMRenderFrameErrorEvent(t,e){this.type="renderFrameError",this.nativeError=t,this.currentTime=e}function BMConfigErrorEvent(t){this.type="configError",this.nativeError=t}function BMAnimationConfigErrorEvent(t,e){this.type=t,this.nativeError=e}var createElementID=function(){var t=0;return function(){return idPrefix$1+"__lottie_element_"+(t+=1)}}();function HSVtoRGB(t,e,i){var n,r,s,a,o,l,h,c;switch(l=i*(1-e),h=i*(1-(o=6*t-(a=Math.floor(6*t)))*e),c=i*(1-(1-o)*e),a%6){case 0:n=i,r=c,s=l;break;case 1:n=h,r=i,s=l;break;case 2:n=l,r=i,s=c;break;case 3:n=l,r=h,s=i;break;case 4:n=c,r=l,s=i;break;case 5:n=i,r=l,s=h}return[n,r,s]}function RGBtoHSV(t,e,i){var n,r=Math.max(t,e,i),s=Math.min(t,e,i),a=r-s,o=0===r?0:a/r,l=r/255;switch(r){case s:n=0;break;case t:n=e-i+a*(e<i?6:0),n/=6*a;break;case e:n=i-t+2*a,n/=6*a;break;case i:n=t-e+4*a,n/=6*a}return[n,o,l]}function addSaturationToRGB(t,e){var i=RGBtoHSV(255*t[0],255*t[1],255*t[2]);return i[1]+=e,i[1]>1?i[1]=1:i[1]<=0&&(i[1]=0),HSVtoRGB(i[0],i[1],i[2])}function addBrightnessToRGB(t,e){var i=RGBtoHSV(255*t[0],255*t[1],255*t[2]);return i[2]+=e,i[2]>1?i[2]=1:i[2]<0&&(i[2]=0),HSVtoRGB(i[0],i[1],i[2])}function addHueToRGB(t,e){var i=RGBtoHSV(255*t[0],255*t[1],255*t[2]);return i[0]+=e/360,i[0]>1?i[0]-=1:i[0]<0&&(i[0]+=1),HSVtoRGB(i[0],i[1],i[2])}var rgbToHex=function(){var t,e,i=[];for(t=0;t<256;t+=1)e=t.toString(16),i[t]=1===e.length?"0"+e:e;return function(t,e,n){return t<0&&(t=0),e<0&&(e=0),n<0&&(n=0),"#"+i[t]+i[e]+i[n]}}(),setSubframeEnabled=function(t){subframeEnabled=!!t},getSubframeEnabled=function(){return subframeEnabled},setExpressionsPlugin=function(t){expressionsPlugin=t},getExpressionsPlugin=function(){return expressionsPlugin},setExpressionInterfaces=function(t){expressionsInterfaces=t},getExpressionInterfaces=function(){return expressionsInterfaces},setDefaultCurveSegments=function(t){defaultCurveSegments=t},getDefaultCurveSegments=function(){return defaultCurveSegments},setIdPrefix=function(t){idPrefix$1=t},getIdPrefix=function(){return idPrefix$1};function createNS(t){return document.createElementNS(svgNS,t)}function _typeof$5(t){return _typeof$5="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof$5(t)}var dataManager=function(){var t,e,i=1,n=[],r={onmessage:function(){},postMessage:function(e){t({data:e})}},s={postMessage:function(t){r.onmessage({data:t})}};function a(){e||(e=function(e){if(window.Worker&&window.Blob&&getWebWorker()){var i=new Blob(["var _workerSelf = self; self.onmessage = ",e.toString()],{type:"text/javascript"}),n=URL.createObjectURL(i);return new Worker(n)}return t=e,r}((function(t){if(s.dataManager||(s.dataManager=function(){function t(r,s){var a,o,l,h,u,d,p=r.length;for(o=0;o<p;o+=1)if("ks"in(a=r[o])&&!a.completed){if(a.completed=!0,a.hasMask){var f=a.masksProperties;for(h=f.length,l=0;l<h;l+=1)if(f[l].pt.k.i)n(f[l].pt.k);else for(d=f[l].pt.k.length,u=0;u<d;u+=1)f[l].pt.k[u].s&&n(f[l].pt.k[u].s[0]),f[l].pt.k[u].e&&n(f[l].pt.k[u].e[0])}0===a.ty?(a.layers=e(a.refId,s),t(a.layers,s)):4===a.ty?i(a.shapes):5===a.ty&&c(a)}}function e(t,e){var i=function(t,e){for(var i=0,n=e.length;i<n;){if(e[i].id===t)return e[i];i+=1}return null}(t,e);return i?i.layers.__used?JSON.parse(JSON.stringify(i.layers)):(i.layers.__used=!0,i.layers):null}function i(t){var e,r,s;for(e=t.length-1;e>=0;e-=1)if("sh"===t[e].ty)if(t[e].ks.k.i)n(t[e].ks.k);else for(s=t[e].ks.k.length,r=0;r<s;r+=1)t[e].ks.k[r].s&&n(t[e].ks.k[r].s[0]),t[e].ks.k[r].e&&n(t[e].ks.k[r].e[0]);else"gr"===t[e].ty&&i(t[e].it)}function n(t){var e,i=t.i.length;for(e=0;e<i;e+=1)t.i[e][0]+=t.v[e][0],t.i[e][1]+=t.v[e][1],t.o[e][0]+=t.v[e][0],t.o[e][1]+=t.v[e][1]}function r(t,e){var i=e?e.split("."):[100,100,100];return t[0]>i[0]||!(i[0]>t[0])&&(t[1]>i[1]||!(i[1]>t[1])&&(t[2]>i[2]||!(i[2]>t[2])&&null))}var s=function(){var t=[4,4,14];function e(t){var e=t.t.d;t.t.d={k:[{s:e,t:0}]}}function i(t){var i,n=t.length;for(i=0;i<n;i+=1)5===t[i].ty&&e(t[i])}return function(e){if(r(t,e.v)&&(i(e.layers),e.assets)){var n,s=e.assets.length;for(n=0;n<s;n+=1)e.assets[n].layers&&i(e.assets[n].layers)}}}(),a=function(){var t=[4,7,99];return function(e){if(e.chars&&!r(t,e.v)){var n,s=e.chars.length;for(n=0;n<s;n+=1){var a=e.chars[n];a.data&&a.data.shapes&&(i(a.data.shapes),a.data.ip=0,a.data.op=99999,a.data.st=0,a.data.sr=1,a.data.ks={p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0}},e.chars[n].t||(a.data.shapes.push({ty:"no"}),a.data.shapes[0].it.push({p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0},sk:{k:0,a:0},sa:{k:0,a:0},ty:"tr"})))}}}}(),o=function(){var t=[5,7,15];function e(t){var e=t.t.p;"number"===typeof e.a&&(e.a={a:0,k:e.a}),"number"===typeof e.p&&(e.p={a:0,k:e.p}),"number"===typeof e.r&&(e.r={a:0,k:e.r})}function i(t){var i,n=t.length;for(i=0;i<n;i+=1)5===t[i].ty&&e(t[i])}return function(e){if(r(t,e.v)&&(i(e.layers),e.assets)){var n,s=e.assets.length;for(n=0;n<s;n+=1)e.assets[n].layers&&i(e.assets[n].layers)}}}(),l=function(){var t=[4,1,9];function e(t){var i,n,r,s=t.length;for(i=0;i<s;i+=1)if("gr"===t[i].ty)e(t[i].it);else if("fl"===t[i].ty||"st"===t[i].ty)if(t[i].c.k&&t[i].c.k[0].i)for(r=t[i].c.k.length,n=0;n<r;n+=1)t[i].c.k[n].s&&(t[i].c.k[n].s[0]/=255,t[i].c.k[n].s[1]/=255,t[i].c.k[n].s[2]/=255,t[i].c.k[n].s[3]/=255),t[i].c.k[n].e&&(t[i].c.k[n].e[0]/=255,t[i].c.k[n].e[1]/=255,t[i].c.k[n].e[2]/=255,t[i].c.k[n].e[3]/=255);else t[i].c.k[0]/=255,t[i].c.k[1]/=255,t[i].c.k[2]/=255,t[i].c.k[3]/=255}function i(t){var i,n=t.length;for(i=0;i<n;i+=1)4===t[i].ty&&e(t[i].shapes)}return function(e){if(r(t,e.v)&&(i(e.layers),e.assets)){var n,s=e.assets.length;for(n=0;n<s;n+=1)e.assets[n].layers&&i(e.assets[n].layers)}}}(),h=function(){var t=[4,4,18];function e(t){var i,n,r;for(i=t.length-1;i>=0;i-=1)if("sh"===t[i].ty)if(t[i].ks.k.i)t[i].ks.k.c=t[i].closed;else for(r=t[i].ks.k.length,n=0;n<r;n+=1)t[i].ks.k[n].s&&(t[i].ks.k[n].s[0].c=t[i].closed),t[i].ks.k[n].e&&(t[i].ks.k[n].e[0].c=t[i].closed);else"gr"===t[i].ty&&e(t[i].it)}function i(t){var i,n,r,s,a,o,l=t.length;for(n=0;n<l;n+=1){if((i=t[n]).hasMask){var h=i.masksProperties;for(s=h.length,r=0;r<s;r+=1)if(h[r].pt.k.i)h[r].pt.k.c=h[r].cl;else for(o=h[r].pt.k.length,a=0;a<o;a+=1)h[r].pt.k[a].s&&(h[r].pt.k[a].s[0].c=h[r].cl),h[r].pt.k[a].e&&(h[r].pt.k[a].e[0].c=h[r].cl)}4===i.ty&&e(i.shapes)}}return function(e){if(r(t,e.v)&&(i(e.layers),e.assets)){var n,s=e.assets.length;for(n=0;n<s;n+=1)e.assets[n].layers&&i(e.assets[n].layers)}}}();function c(t){0===t.t.a.length&&t.t.p}var u={completeData:function(i){i.__complete||(l(i),s(i),a(i),o(i),h(i),t(i.layers,i.assets),function(i,n){if(i){var r=0,s=i.length;for(r=0;r<s;r+=1)1===i[r].t&&(i[r].data.layers=e(i[r].data.refId,n),t(i[r].data.layers,n))}}(i.chars,i.assets),i.__complete=!0)}};return u.checkColors=l,u.checkChars=a,u.checkPathProperties=o,u.checkShapes=h,u.completeLayers=t,u}()),s.assetLoader||(s.assetLoader=function(){function t(t){var e=t.getResponseHeader("content-type");return e&&"json"===t.responseType&&-1!==e.indexOf("json")||t.response&&"object"===_typeof$5(t.response)?t.response:t.response&&"string"===typeof t.response?JSON.parse(t.response):t.responseText?JSON.parse(t.responseText):null}return{load:function(e,i,n,r){var s,a=new XMLHttpRequest;try{a.responseType="json"}catch(o){}a.onreadystatechange=function(){if(4===a.readyState)if(200===a.status)s=t(a),n(s);else try{s=t(a),n(s)}catch(o){r&&r(o)}};try{a.open(["G","E","T"].join(""),e,!0)}catch(l){a.open(["G","E","T"].join(""),i+"/"+e,!0)}a.send()}}}()),"loadAnimation"===t.data.type)s.assetLoader.load(t.data.path,t.data.fullPath,(function(e){s.dataManager.completeData(e),s.postMessage({id:t.data.id,payload:e,status:"success"})}),(function(){s.postMessage({id:t.data.id,status:"error"})}));else if("complete"===t.data.type){var e=t.data.animation;s.dataManager.completeData(e),s.postMessage({id:t.data.id,payload:e,status:"success"})}else"loadData"===t.data.type&&s.assetLoader.load(t.data.path,t.data.fullPath,(function(e){s.postMessage({id:t.data.id,payload:e,status:"success"})}),(function(){s.postMessage({id:t.data.id,status:"error"})}))})),e.onmessage=function(t){var e=t.data,i=e.id,r=n[i];n[i]=null,"success"===e.status?r.onComplete(e.payload):r.onError&&r.onError()})}function o(t,e){var r="processId_"+(i+=1);return n[r]={onComplete:t,onError:e},r}return{loadAnimation:function(t,i,n){a();var r=o(i,n);e.postMessage({type:"loadAnimation",path:t,fullPath:window.location.origin+window.location.pathname,id:r})},loadData:function(t,i,n){a();var r=o(i,n);e.postMessage({type:"loadData",path:t,fullPath:window.location.origin+window.location.pathname,id:r})},completeAnimation:function(t,i,n){a();var r=o(i,n);e.postMessage({type:"complete",animation:t,id:r})}}}(),ImagePreloader=function(){var t=function(){var t=createTag("canvas");t.width=1,t.height=1;var e=t.getContext("2d");return e.fillStyle="rgba(0,0,0,0)",e.fillRect(0,0,1,1),t}();function e(){this.loadedAssets+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function i(){this.loadedFootagesCount+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function n(t,e,i){var n="";if(t.e)n=t.p;else if(e){var r=t.p;-1!==r.indexOf("images/")&&(r=r.split("/")[1]),n=e+r}else n=i,n+=t.u?t.u:"",n+=t.p;return n}function r(t){var e=0,i=setInterval(function(){(t.getBBox().width||e>500)&&(this._imageLoaded(),clearInterval(i)),e+=1}.bind(this),50)}function s(t){var e={assetData:t},i=n(t,this.assetsPath,this.path);return dataManager.loadData(i,function(t){e.img=t,this._footageLoaded()}.bind(this),function(){e.img={},this._footageLoaded()}.bind(this)),e}function a(){this._imageLoaded=e.bind(this),this._footageLoaded=i.bind(this),this.testImageLoaded=r.bind(this),this.createFootageData=s.bind(this),this.assetsPath="",this.path="",this.totalImages=0,this.totalFootages=0,this.loadedAssets=0,this.loadedFootagesCount=0,this.imagesLoadedCb=null,this.images=[]}return a.prototype={loadAssets:function(t,e){var i;this.imagesLoadedCb=e;var n=t.length;for(i=0;i<n;i+=1)t[i].layers||(t[i].t&&"seq"!==t[i].t?3===t[i].t&&(this.totalFootages+=1,this.images.push(this.createFootageData(t[i]))):(this.totalImages+=1,this.images.push(this._createImageData(t[i]))))},setAssetsPath:function(t){this.assetsPath=t||""},setPath:function(t){this.path=t||""},loadedImages:function(){return this.totalImages===this.loadedAssets},loadedFootages:function(){return this.totalFootages===this.loadedFootagesCount},destroy:function(){this.imagesLoadedCb=null,this.images.length=0},getAsset:function(t){for(var e=0,i=this.images.length;e<i;){if(this.images[e].assetData===t)return this.images[e].img;e+=1}return null},createImgData:function(e){var i=n(e,this.assetsPath,this.path),r=createTag("img");r.crossOrigin="anonymous",r.addEventListener("load",this._imageLoaded,!1),r.addEventListener("error",function(){s.img=t,this._imageLoaded()}.bind(this),!1),r.src=i;var s={img:r,assetData:e};return s},createImageData:function(e){var i=n(e,this.assetsPath,this.path),r=createNS("image");isSafari?this.testImageLoaded(r):r.addEventListener("load",this._imageLoaded,!1),r.addEventListener("error",function(){s.img=t,this._imageLoaded()}.bind(this),!1),r.setAttributeNS("http://www.w3.org/1999/xlink","href",i),this._elementHelper.append?this._elementHelper.append(r):this._elementHelper.appendChild(r);var s={img:r,assetData:e};return s},imageLoaded:e,footageLoaded:i,setCacheType:function(t,e){"svg"===t?(this._elementHelper=e,this._createImageData=this.createImageData.bind(this)):this._createImageData=this.createImgData.bind(this)}},a}();function BaseEvent(){}BaseEvent.prototype={triggerEvent:function(t,e){if(this._cbs[t])for(var i=this._cbs[t],n=0;n<i.length;n+=1)i[n](e)},addEventListener:function(t,e){return this._cbs[t]||(this._cbs[t]=[]),this._cbs[t].push(e),function(){this.removeEventListener(t,e)}.bind(this)},removeEventListener:function(t,e){if(e){if(this._cbs[t]){for(var i=0,n=this._cbs[t].length;i<n;)this._cbs[t][i]===e&&(this._cbs[t].splice(i,1),i-=1,n-=1),i+=1;this._cbs[t].length||(this._cbs[t]=null)}}else this._cbs[t]=null}};var markerParser=function(){function t(t){for(var e,i=t.split("\r\n"),n={},r=0,s=0;s<i.length;s+=1)2===(e=i[s].split(":")).length&&(n[e[0]]=e[1].trim(),r+=1);if(0===r)throw new Error;return n}return function(e){for(var i=[],n=0;n<e.length;n+=1){var r=e[n],s={time:r.tm,duration:r.dr};try{s.payload=JSON.parse(e[n].cm)}catch(a){try{s.payload=t(e[n].cm)}catch(o){s.payload={name:e[n].cm}}}i.push(s)}return i}}(),ProjectInterface=function(){function t(t){this.compositions.push(t)}return function(){function e(t){for(var e=0,i=this.compositions.length;e<i;){if(this.compositions[e].data&&this.compositions[e].data.nm===t)return this.compositions[e].prepareFrame&&this.compositions[e].data.xt&&this.compositions[e].prepareFrame(this.currentFrame),this.compositions[e].compInterface;e+=1}return null}return e.compositions=[],e.currentFrame=0,e.registerComposition=t,e}}(),renderers={},registerRenderer=function(t,e){renderers[t]=e};function getRenderer(t){return renderers[t]}function getRegisteredRenderer(){if(renderers.canvas)return"canvas";for(var t in renderers)if(renderers[t])return t;return""}function _typeof$4(t){return _typeof$4="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof$4(t)}var AnimationItem=function(){this._cbs=[],this.name="",this.path="",this.isLoaded=!1,this.currentFrame=0,this.currentRawFrame=0,this.firstFrame=0,this.totalFrames=0,this.frameRate=0,this.frameMult=0,this.playSpeed=1,this.playDirection=1,this.playCount=0,this.animationData={},this.assets=[],this.isPaused=!0,this.autoplay=!1,this.loop=!0,this.renderer=null,this.animationID=createElementID(),this.assetsPath="",this.timeCompleted=0,this.segmentPos=0,this.isSubframeEnabled=getSubframeEnabled(),this.segments=[],this._idle=!0,this._completedLoop=!1,this.projectInterface=ProjectInterface(),this.imagePreloader=new ImagePreloader,this.audioController=audioControllerFactory(),this.markers=[],this.configAnimation=this.configAnimation.bind(this),this.onSetupError=this.onSetupError.bind(this),this.onSegmentComplete=this.onSegmentComplete.bind(this),this.drawnFrameEvent=new BMEnterFrameEvent("drawnFrame",0,0,0),this.expressionsPlugin=getExpressionsPlugin()};extendPrototype([BaseEvent],AnimationItem),AnimationItem.prototype.setParams=function(t){(t.wrapper||t.container)&&(this.wrapper=t.wrapper||t.container);var e="svg";t.animType?e=t.animType:t.renderer&&(e=t.renderer);var i=getRenderer(e);this.renderer=new i(this,t.rendererSettings),this.imagePreloader.setCacheType(e,this.renderer.globalData.defs),this.renderer.setProjectInterface(this.projectInterface),this.animType=e,""===t.loop||null===t.loop||void 0===t.loop||!0===t.loop?this.loop=!0:!1===t.loop?this.loop=!1:this.loop=parseInt(t.loop,10),this.autoplay=!("autoplay"in t)||t.autoplay,this.name=t.name?t.name:"",this.autoloadSegments=!Object.prototype.hasOwnProperty.call(t,"autoloadSegments")||t.autoloadSegments,this.assetsPath=t.assetsPath,this.initialSegment=t.initialSegment,t.audioFactory&&this.audioController.setAudioFactory(t.audioFactory),t.animationData?this.setupAnimation(t.animationData):t.path&&(-1!==t.path.lastIndexOf("\\")?this.path=t.path.substr(0,t.path.lastIndexOf("\\")+1):this.path=t.path.substr(0,t.path.lastIndexOf("/")+1),this.fileName=t.path.substr(t.path.lastIndexOf("/")+1),this.fileName=this.fileName.substr(0,this.fileName.lastIndexOf(".json")),dataManager.loadAnimation(t.path,this.configAnimation,this.onSetupError))},AnimationItem.prototype.onSetupError=function(){this.trigger("data_failed")},AnimationItem.prototype.setupAnimation=function(t){dataManager.completeAnimation(t,this.configAnimation)},AnimationItem.prototype.setData=function(t,e){e&&"object"!==_typeof$4(e)&&(e=JSON.parse(e));var i={wrapper:t,animationData:e},n=t.attributes;i.path=n.getNamedItem("data-animation-path")?n.getNamedItem("data-animation-path").value:n.getNamedItem("data-bm-path")?n.getNamedItem("data-bm-path").value:n.getNamedItem("bm-path")?n.getNamedItem("bm-path").value:"",i.animType=n.getNamedItem("data-anim-type")?n.getNamedItem("data-anim-type").value:n.getNamedItem("data-bm-type")?n.getNamedItem("data-bm-type").value:n.getNamedItem("bm-type")?n.getNamedItem("bm-type").value:n.getNamedItem("data-bm-renderer")?n.getNamedItem("data-bm-renderer").value:n.getNamedItem("bm-renderer")?n.getNamedItem("bm-renderer").value:getRegisteredRenderer()||"canvas";var r=n.getNamedItem("data-anim-loop")?n.getNamedItem("data-anim-loop").value:n.getNamedItem("data-bm-loop")?n.getNamedItem("data-bm-loop").value:n.getNamedItem("bm-loop")?n.getNamedItem("bm-loop").value:"";"false"===r?i.loop=!1:"true"===r?i.loop=!0:""!==r&&(i.loop=parseInt(r,10));var s=n.getNamedItem("data-anim-autoplay")?n.getNamedItem("data-anim-autoplay").value:n.getNamedItem("data-bm-autoplay")?n.getNamedItem("data-bm-autoplay").value:!n.getNamedItem("bm-autoplay")||n.getNamedItem("bm-autoplay").value;i.autoplay="false"!==s,i.name=n.getNamedItem("data-name")?n.getNamedItem("data-name").value:n.getNamedItem("data-bm-name")?n.getNamedItem("data-bm-name").value:n.getNamedItem("bm-name")?n.getNamedItem("bm-name").value:"","false"===(n.getNamedItem("data-anim-prerender")?n.getNamedItem("data-anim-prerender").value:n.getNamedItem("data-bm-prerender")?n.getNamedItem("data-bm-prerender").value:n.getNamedItem("bm-prerender")?n.getNamedItem("bm-prerender").value:"")&&(i.prerender=!1),i.path?this.setParams(i):this.trigger("destroy")},AnimationItem.prototype.includeLayers=function(t){t.op>this.animationData.op&&(this.animationData.op=t.op,this.totalFrames=Math.floor(t.op-this.animationData.ip));var e,i,n=this.animationData.layers,r=n.length,s=t.layers,a=s.length;for(i=0;i<a;i+=1)for(e=0;e<r;){if(n[e].id===s[i].id){n[e]=s[i];break}e+=1}if((t.chars||t.fonts)&&(this.renderer.globalData.fontManager.addChars(t.chars),this.renderer.globalData.fontManager.addFonts(t.fonts,this.renderer.globalData.defs)),t.assets)for(r=t.assets.length,e=0;e<r;e+=1)this.animationData.assets.push(t.assets[e]);this.animationData.__complete=!1,dataManager.completeAnimation(this.animationData,this.onSegmentComplete)},AnimationItem.prototype.onSegmentComplete=function(t){this.animationData=t;var e=getExpressionsPlugin();e&&e.initExpressions(this),this.loadNextSegment()},AnimationItem.prototype.loadNextSegment=function(){var t=this.animationData.segments;if(!t||0===t.length||!this.autoloadSegments)return this.trigger("data_ready"),void(this.timeCompleted=this.totalFrames);var e=t.shift();this.timeCompleted=e.time*this.frameRate;var i=this.path+this.fileName+"_"+this.segmentPos+".json";this.segmentPos+=1,dataManager.loadData(i,this.includeLayers.bind(this),function(){this.trigger("data_failed")}.bind(this))},AnimationItem.prototype.loadSegments=function(){this.animationData.segments||(this.timeCompleted=this.totalFrames),this.loadNextSegment()},AnimationItem.prototype.imagesLoaded=function(){this.trigger("loaded_images"),this.checkLoaded()},AnimationItem.prototype.preloadImages=function(){this.imagePreloader.setAssetsPath(this.assetsPath),this.imagePreloader.setPath(this.path),this.imagePreloader.loadAssets(this.animationData.assets,this.imagesLoaded.bind(this))},AnimationItem.prototype.configAnimation=function(t){if(this.renderer)try{this.animationData=t,this.initialSegment?(this.totalFrames=Math.floor(this.initialSegment[1]-this.initialSegment[0]),this.firstFrame=Math.round(this.initialSegment[0])):(this.totalFrames=Math.floor(this.animationData.op-this.animationData.ip),this.firstFrame=Math.round(this.animationData.ip)),this.renderer.configAnimation(t),t.assets||(t.assets=[]),this.assets=this.animationData.assets,this.frameRate=this.animationData.fr,this.frameMult=this.animationData.fr/1e3,this.renderer.searchExtraCompositions(t.assets),this.markers=markerParser(t.markers||[]),this.trigger("config_ready"),this.preloadImages(),this.loadSegments(),this.updaFrameModifier(),this.waitForFontsLoaded(),this.isPaused&&this.audioController.pause()}catch(e){this.triggerConfigError(e)}},AnimationItem.prototype.waitForFontsLoaded=function(){this.renderer&&(this.renderer.globalData.fontManager.isLoaded?this.checkLoaded():setTimeout(this.waitForFontsLoaded.bind(this),20))},AnimationItem.prototype.checkLoaded=function(){if(!this.isLoaded&&this.renderer.globalData.fontManager.isLoaded&&(this.imagePreloader.loadedImages()||"canvas"!==this.renderer.rendererType)&&this.imagePreloader.loadedFootages()){this.isLoaded=!0;var t=getExpressionsPlugin();t&&t.initExpressions(this),this.renderer.initItems(),setTimeout(function(){this.trigger("DOMLoaded")}.bind(this),0),this.gotoFrame(),this.autoplay&&this.play()}},AnimationItem.prototype.resize=function(t,e){var i="number"===typeof t?t:void 0,n="number"===typeof e?e:void 0;this.renderer.updateContainerSize(i,n)},AnimationItem.prototype.setSubframe=function(t){this.isSubframeEnabled=!!t},AnimationItem.prototype.gotoFrame=function(){this.currentFrame=this.isSubframeEnabled?this.currentRawFrame:~~this.currentRawFrame,this.timeCompleted!==this.totalFrames&&this.currentFrame>this.timeCompleted&&(this.currentFrame=this.timeCompleted),this.trigger("enterFrame"),this.renderFrame(),this.trigger("drawnFrame")},AnimationItem.prototype.renderFrame=function(){if(!1!==this.isLoaded&&this.renderer)try{this.expressionsPlugin&&this.expressionsPlugin.resetFrame(),this.renderer.renderFrame(this.currentFrame+this.firstFrame)}catch(t){this.triggerRenderFrameError(t)}},AnimationItem.prototype.play=function(t){t&&this.name!==t||!0===this.isPaused&&(this.isPaused=!1,this.trigger("_play"),this.audioController.resume(),this._idle&&(this._idle=!1,this.trigger("_active")))},AnimationItem.prototype.pause=function(t){t&&this.name!==t||!1===this.isPaused&&(this.isPaused=!0,this.trigger("_pause"),this._idle=!0,this.trigger("_idle"),this.audioController.pause())},AnimationItem.prototype.togglePause=function(t){t&&this.name!==t||(!0===this.isPaused?this.play():this.pause())},AnimationItem.prototype.stop=function(t){t&&this.name!==t||(this.pause(),this.playCount=0,this._completedLoop=!1,this.setCurrentRawFrameValue(0))},AnimationItem.prototype.getMarkerData=function(t){for(var e,i=0;i<this.markers.length;i+=1)if((e=this.markers[i]).payload&&e.payload.name===t)return e;return null},AnimationItem.prototype.goToAndStop=function(t,e,i){if(!i||this.name===i){var n=Number(t);if(isNaN(n)){var r=this.getMarkerData(t);r&&this.goToAndStop(r.time,!0)}else e?this.setCurrentRawFrameValue(t):this.setCurrentRawFrameValue(t*this.frameModifier);this.pause()}},AnimationItem.prototype.goToAndPlay=function(t,e,i){if(!i||this.name===i){var n=Number(t);if(isNaN(n)){var r=this.getMarkerData(t);r&&(r.duration?this.playSegments([r.time,r.time+r.duration],!0):this.goToAndStop(r.time,!0))}else this.goToAndStop(n,e,i);this.play()}},AnimationItem.prototype.advanceTime=function(t){if(!0!==this.isPaused&&!1!==this.isLoaded){var e=this.currentRawFrame+t*this.frameModifier,i=!1;e>=this.totalFrames-1&&this.frameModifier>0?this.loop&&this.playCount!==this.loop?e>=this.totalFrames?(this.playCount+=1,this.checkSegments(e%this.totalFrames)||(this.setCurrentRawFrameValue(e%this.totalFrames),this._completedLoop=!0,this.trigger("loopComplete"))):this.setCurrentRawFrameValue(e):this.checkSegments(e>this.totalFrames?e%this.totalFrames:0)||(i=!0,e=this.totalFrames-1):e<0?this.checkSegments(e%this.totalFrames)||(!this.loop||this.playCount--<=0&&!0!==this.loop?(i=!0,e=0):(this.setCurrentRawFrameValue(this.totalFrames+e%this.totalFrames),this._completedLoop?this.trigger("loopComplete"):this._completedLoop=!0)):this.setCurrentRawFrameValue(e),i&&(this.setCurrentRawFrameValue(e),this.pause(),this.trigger("complete"))}},AnimationItem.prototype.adjustSegment=function(t,e){this.playCount=0,t[1]<t[0]?(this.frameModifier>0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(-1)),this.totalFrames=t[0]-t[1],this.timeCompleted=this.totalFrames,this.firstFrame=t[1],this.setCurrentRawFrameValue(this.totalFrames-.001-e)):t[1]>t[0]&&(this.frameModifier<0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(1)),this.totalFrames=t[1]-t[0],this.timeCompleted=this.totalFrames,this.firstFrame=t[0],this.setCurrentRawFrameValue(.001+e)),this.trigger("segmentStart")},AnimationItem.prototype.setSegment=function(t,e){var i=-1;this.isPaused&&(this.currentRawFrame+this.firstFrame<t?i=t:this.currentRawFrame+this.firstFrame>e&&(i=e-t)),this.firstFrame=t,this.totalFrames=e-t,this.timeCompleted=this.totalFrames,-1!==i&&this.goToAndStop(i,!0)},AnimationItem.prototype.playSegments=function(t,e){if(e&&(this.segments.length=0),"object"===_typeof$4(t[0])){var i,n=t.length;for(i=0;i<n;i+=1)this.segments.push(t[i])}else this.segments.push(t);this.segments.length&&e&&this.adjustSegment(this.segments.shift(),0),this.isPaused&&this.play()},AnimationItem.prototype.resetSegments=function(t){this.segments.length=0,this.segments.push([this.animationData.ip,this.animationData.op]),t&&this.checkSegments(0)},AnimationItem.prototype.checkSegments=function(t){return!!this.segments.length&&(this.adjustSegment(this.segments.shift(),t),!0)},AnimationItem.prototype.destroy=function(t){t&&this.name!==t||!this.renderer||(this.renderer.destroy(),this.imagePreloader.destroy(),this.trigger("destroy"),this._cbs=null,this.onEnterFrame=null,this.onLoopComplete=null,this.onComplete=null,this.onSegmentStart=null,this.onDestroy=null,this.renderer=null,this.expressionsPlugin=null,this.imagePreloader=null,this.projectInterface=null)},AnimationItem.prototype.setCurrentRawFrameValue=function(t){this.currentRawFrame=t,this.gotoFrame()},AnimationItem.prototype.setSpeed=function(t){this.playSpeed=t,this.updaFrameModifier()},AnimationItem.prototype.setDirection=function(t){this.playDirection=t<0?-1:1,this.updaFrameModifier()},AnimationItem.prototype.setLoop=function(t){this.loop=t},AnimationItem.prototype.setVolume=function(t,e){e&&this.name!==e||this.audioController.setVolume(t)},AnimationItem.prototype.getVolume=function(){return this.audioController.getVolume()},AnimationItem.prototype.mute=function(t){t&&this.name!==t||this.audioController.mute()},AnimationItem.prototype.unmute=function(t){t&&this.name!==t||this.audioController.unmute()},AnimationItem.prototype.updaFrameModifier=function(){this.frameModifier=this.frameMult*this.playSpeed*this.playDirection,this.audioController.setRate(this.playSpeed*this.playDirection)},AnimationItem.prototype.getPath=function(){return this.path},AnimationItem.prototype.getAssetsPath=function(t){var e="";if(t.e)e=t.p;else if(this.assetsPath){var i=t.p;-1!==i.indexOf("images/")&&(i=i.split("/")[1]),e=this.assetsPath+i}else e=this.path,e+=t.u?t.u:"",e+=t.p;return e},AnimationItem.prototype.getAssetData=function(t){for(var e=0,i=this.assets.length;e<i;){if(t===this.assets[e].id)return this.assets[e];e+=1}return null},AnimationItem.prototype.hide=function(){this.renderer.hide()},AnimationItem.prototype.show=function(){this.renderer.show()},AnimationItem.prototype.getDuration=function(t){return t?this.totalFrames:this.totalFrames/this.frameRate},AnimationItem.prototype.updateDocumentData=function(t,e,i){try{this.renderer.getElementByPath(t).updateDocumentData(e,i)}catch(n){}},AnimationItem.prototype.trigger=function(t){if(this._cbs&&this._cbs[t])switch(t){case"enterFrame":this.triggerEvent(t,new BMEnterFrameEvent(t,this.currentFrame,this.totalFrames,this.frameModifier));break;case"drawnFrame":this.drawnFrameEvent.currentTime=this.currentFrame,this.drawnFrameEvent.totalTime=this.totalFrames,this.drawnFrameEvent.direction=this.frameModifier,this.triggerEvent(t,this.drawnFrameEvent);break;case"loopComplete":this.triggerEvent(t,new BMCompleteLoopEvent(t,this.loop,this.playCount,this.frameMult));break;case"complete":this.triggerEvent(t,new BMCompleteEvent(t,this.frameMult));break;case"segmentStart":this.triggerEvent(t,new BMSegmentStartEvent(t,this.firstFrame,this.totalFrames));break;case"destroy":this.triggerEvent(t,new BMDestroyEvent(t,this));break;default:this.triggerEvent(t)}"enterFrame"===t&&this.onEnterFrame&&this.onEnterFrame.call(this,new BMEnterFrameEvent(t,this.currentFrame,this.totalFrames,this.frameMult)),"loopComplete"===t&&this.onLoopComplete&&this.onLoopComplete.call(this,new BMCompleteLoopEvent(t,this.loop,this.playCount,this.frameMult)),"complete"===t&&this.onComplete&&this.onComplete.call(this,new BMCompleteEvent(t,this.frameMult)),"segmentStart"===t&&this.onSegmentStart&&this.onSegmentStart.call(this,new BMSegmentStartEvent(t,this.firstFrame,this.totalFrames)),"destroy"===t&&this.onDestroy&&this.onDestroy.call(this,new BMDestroyEvent(t,this))},AnimationItem.prototype.triggerRenderFrameError=function(t){var e=new BMRenderFrameErrorEvent(t,this.currentFrame);this.triggerEvent("error",e),this.onError&&this.onError.call(this,e)},AnimationItem.prototype.triggerConfigError=function(t){var e=new BMConfigErrorEvent(t,this.currentFrame);this.triggerEvent("error",e),this.onError&&this.onError.call(this,e)};var animationManager=function(){var t={},e=[],i=0,n=0,r=0,s=!0,a=!1;function o(t){for(var i=0,r=t.target;i<n;)e[i].animation===r&&(e.splice(i,1),i-=1,n-=1,r.isPaused||c()),i+=1}function l(t,i){if(!t)return null;for(var r=0;r<n;){if(e[r].elem===t&&null!==e[r].elem)return e[r].animation;r+=1}var s=new AnimationItem;return u(s,t),s.setData(t,i),s}function h(){r+=1,f()}function c(){r-=1}function u(t,i){t.addEventListener("destroy",o),t.addEventListener("_active",h),t.addEventListener("_idle",c),e.push({elem:i,animation:t}),n+=1}function d(t){var o,l=t-i;for(o=0;o<n;o+=1)e[o].animation.advanceTime(l);i=t,r&&!a?window.requestAnimationFrame(d):s=!0}function p(t){i=t,window.requestAnimationFrame(d)}function f(){!a&&r&&s&&(window.requestAnimationFrame(p),s=!1)}return t.registerAnimation=l,t.loadAnimation=function(t){var e=new AnimationItem;return u(e,null),e.setParams(t),e},t.setSpeed=function(t,i){var r;for(r=0;r<n;r+=1)e[r].animation.setSpeed(t,i)},t.setDirection=function(t,i){var r;for(r=0;r<n;r+=1)e[r].animation.setDirection(t,i)},t.play=function(t){var i;for(i=0;i<n;i+=1)e[i].animation.play(t)},t.pause=function(t){var i;for(i=0;i<n;i+=1)e[i].animation.pause(t)},t.stop=function(t){var i;for(i=0;i<n;i+=1)e[i].animation.stop(t)},t.togglePause=function(t){var i;for(i=0;i<n;i+=1)e[i].animation.togglePause(t)},t.searchAnimations=function(t,e,i){var n,r=[].concat([].slice.call(document.getElementsByClassName("lottie")),[].slice.call(document.getElementsByClassName("bodymovin"))),s=r.length;for(n=0;n<s;n+=1)i&&r[n].setAttribute("data-bm-type",i),l(r[n],t);if(e&&0===s){i||(i="svg");var a=document.getElementsByTagName("body")[0];a.innerText="";var o=createTag("div");o.style.width="100%",o.style.height="100%",o.setAttribute("data-bm-type",i),a.appendChild(o),l(o,t)}},t.resize=function(){var t;for(t=0;t<n;t+=1)e[t].animation.resize()},t.goToAndStop=function(t,i,r){var s;for(s=0;s<n;s+=1)e[s].animation.goToAndStop(t,i,r)},t.destroy=function(t){var i;for(i=n-1;i>=0;i-=1)e[i].animation.destroy(t)},t.freeze=function(){a=!0},t.unfreeze=function(){a=!1,f()},t.setVolume=function(t,i){var r;for(r=0;r<n;r+=1)e[r].animation.setVolume(t,i)},t.mute=function(t){var i;for(i=0;i<n;i+=1)e[i].animation.mute(t)},t.unmute=function(t){var i;for(i=0;i<n;i+=1)e[i].animation.unmute(t)},t.getRegisteredAnimations=function(){var t,i=e.length,n=[];for(t=0;t<i;t+=1)n.push(e[t].animation);return n},t}(),BezierFactory=function(){var t={getBezierEasing:function(t,i,n,r,s){var a=s||("bez_"+t+"_"+i+"_"+n+"_"+r).replace(/\./g,"p");if(e[a])return e[a];var o=new c([t,i,n,r]);return e[a]=o,o}},e={},i=11,n=1/(i-1),r="function"===typeof Float32Array;function s(t,e){return 1-3*e+3*t}function a(t,e){return 3*e-6*t}function o(t){return 3*t}function l(t,e,i){return((s(e,i)*t+a(e,i))*t+o(e))*t}function h(t,e,i){return 3*s(e,i)*t*t+2*a(e,i)*t+o(e)}function c(t){this._p=t,this._mSampleValues=r?new Float32Array(i):new Array(i),this._precomputed=!1,this.get=this.get.bind(this)}return c.prototype={get:function(t){var e=this._p[0],i=this._p[1],n=this._p[2],r=this._p[3];return this._precomputed||this._precompute(),e===i&&n===r?t:0===t?0:1===t?1:l(this._getTForX(t),i,r)},_precompute:function(){var t=this._p[0],e=this._p[1],i=this._p[2],n=this._p[3];this._precomputed=!0,t===e&&i===n||this._calcSampleValues()},_calcSampleValues:function(){for(var t=this._p[0],e=this._p[2],r=0;r<i;++r)this._mSampleValues[r]=l(r*n,t,e)},_getTForX:function(t){for(var e=this._p[0],r=this._p[2],s=this._mSampleValues,a=0,o=1,c=i-1;o!==c&&s[o]<=t;++o)a+=n;var u=a+(t-s[--o])/(s[o+1]-s[o])*n,d=h(u,e,r);return d>=.001?function(t,e,i,n){for(var r=0;r<4;++r){var s=h(e,i,n);if(0===s)return e;e-=(l(e,i,n)-t)/s}return e}(t,u,e,r):0===d?u:function(t,e,i,n,r){var s,a,o=0;do{(s=l(a=e+(i-e)/2,n,r)-t)>0?i=a:e=a}while(Math.abs(s)>1e-7&&++o<10);return a}(t,a,a+n,e,r)}},t}(),pooling={double:function(t){return t.concat(createSizedArray(t.length))}},poolFactory=function(t,e,i){var n=0,r=t,s=createSizedArray(r);return{newElement:function(){return n?s[n-=1]:e()},release:function(t){n===r&&(s=pooling.double(s),r*=2),i&&i(t),s[n]=t,n+=1}}},bezierLengthPool=poolFactory(8,(function(){return{addedLength:0,percents:createTypedArray("float32",getDefaultCurveSegments()),lengths:createTypedArray("float32",getDefaultCurveSegments())}})),segmentsLengthPool=poolFactory(8,(function(){return{lengths:[],totalLength:0}}),(function(t){var e,i=t.lengths.length;for(e=0;e<i;e+=1)bezierLengthPool.release(t.lengths[e]);t.lengths.length=0}));function bezFunction(){var t=Math;function e(t,e,i,n,r,s){var a=t*n+e*r+i*s-r*n-s*t-i*e;return a>-.001&&a<.001}var i=function(t,e,i,n){var r,s,a,o,l,h,c=getDefaultCurveSegments(),u=0,d=[],p=[],f=bezierLengthPool.newElement();for(a=i.length,r=0;r<c;r+=1){for(l=r/(c-1),h=0,s=0;s<a;s+=1)o=bmPow(1-l,3)*t[s]+3*bmPow(1-l,2)*l*i[s]+3*(1-l)*bmPow(l,2)*n[s]+bmPow(l,3)*e[s],d[s]=o,null!==p[s]&&(h+=bmPow(d[s]-p[s],2)),p[s]=d[s];h&&(u+=h=bmSqrt(h)),f.percents[r]=l,f.lengths[r]=u}return f.addedLength=u,f};function n(t){this.segmentLength=0,this.points=new Array(t)}function r(t,e){this.partialLength=t,this.point=e}var s=function(){var t={};return function(i,s,a,o){var l=(i[0]+"_"+i[1]+"_"+s[0]+"_"+s[1]+"_"+a[0]+"_"+a[1]+"_"+o[0]+"_"+o[1]).replace(/\./g,"p");if(!t[l]){var h,c,u,d,p,f,m,g=getDefaultCurveSegments(),v=0,y=null;2===i.length&&(i[0]!==s[0]||i[1]!==s[1])&&e(i[0],i[1],s[0],s[1],i[0]+a[0],i[1]+a[1])&&e(i[0],i[1],s[0],s[1],s[0]+o[0],s[1]+o[1])&&(g=2);var b=new n(g);for(u=a.length,h=0;h<g;h+=1){for(m=createSizedArray(u),p=h/(g-1),f=0,c=0;c<u;c+=1)d=bmPow(1-p,3)*i[c]+3*bmPow(1-p,2)*p*(i[c]+a[c])+3*(1-p)*bmPow(p,2)*(s[c]+o[c])+bmPow(p,3)*s[c],m[c]=d,null!==y&&(f+=bmPow(m[c]-y[c],2));v+=f=bmSqrt(f),b.points[h]=new r(f,m),y=m}b.segmentLength=v,t[l]=b}return t[l]}}();function a(t,e){var i=e.percents,n=e.lengths,r=i.length,s=bmFloor((r-1)*t),a=t*e.addedLength,o=0;if(s===r-1||0===s||a===n[s])return i[s];for(var l=n[s]>a?-1:1,h=!0;h;)if(n[s]<=a&&n[s+1]>a?(o=(a-n[s])/(n[s+1]-n[s]),h=!1):s+=l,s<0||s>=r-1){if(s===r-1)return i[s];h=!1}return i[s]+(i[s+1]-i[s])*o}var o=createTypedArray("float32",8);return{getSegmentsLength:function(t){var e,n=segmentsLengthPool.newElement(),r=t.c,s=t.v,a=t.o,o=t.i,l=t._length,h=n.lengths,c=0;for(e=0;e<l-1;e+=1)h[e]=i(s[e],s[e+1],a[e],o[e+1]),c+=h[e].addedLength;return r&&l&&(h[e]=i(s[e],s[0],a[e],o[0]),c+=h[e].addedLength),n.totalLength=c,n},getNewSegment:function(e,i,n,r,s,l,h){s<0?s=0:s>1&&(s=1);var c,u=a(s,h),d=a(l=l>1?1:l,h),p=e.length,f=1-u,m=1-d,g=f*f*f,v=u*f*f*3,y=u*u*f*3,b=u*u*u,x=f*f*m,w=u*f*m+f*u*m+f*f*d,S=u*u*m+f*u*d+u*f*d,A=u*u*d,E=f*m*m,_=u*m*m+f*d*m+f*m*d,C=u*d*m+f*d*d+u*m*d,M=u*d*d,P=m*m*m,T=d*m*m+m*d*m+m*m*d,D=d*d*m+m*d*d+d*m*d,k=d*d*d;for(c=0;c<p;c+=1)o[4*c]=t.round(1e3*(g*e[c]+v*n[c]+y*r[c]+b*i[c]))/1e3,o[4*c+1]=t.round(1e3*(x*e[c]+w*n[c]+S*r[c]+A*i[c]))/1e3,o[4*c+2]=t.round(1e3*(E*e[c]+_*n[c]+C*r[c]+M*i[c]))/1e3,o[4*c+3]=t.round(1e3*(P*e[c]+T*n[c]+D*r[c]+k*i[c]))/1e3;return o},getPointInSegment:function(e,i,n,r,s,o){var l=a(s,o),h=1-l;return[t.round(1e3*(h*h*h*e[0]+(l*h*h+h*l*h+h*h*l)*n[0]+(l*l*h+h*l*l+l*h*l)*r[0]+l*l*l*i[0]))/1e3,t.round(1e3*(h*h*h*e[1]+(l*h*h+h*l*h+h*h*l)*n[1]+(l*l*h+h*l*l+l*h*l)*r[1]+l*l*l*i[1]))/1e3]},buildBezierData:s,pointOnLine2D:e,pointOnLine3D:function(i,n,r,s,a,o,l,h,c){if(0===r&&0===o&&0===c)return e(i,n,s,a,l,h);var u,d=t.sqrt(t.pow(s-i,2)+t.pow(a-n,2)+t.pow(o-r,2)),p=t.sqrt(t.pow(l-i,2)+t.pow(h-n,2)+t.pow(c-r,2)),f=t.sqrt(t.pow(l-s,2)+t.pow(h-a,2)+t.pow(c-o,2));return(u=d>p?d>f?d-p-f:f-p-d:f>p?f-p-d:p-d-f)>-1e-4&&u<1e-4}}}var bez=bezFunction(),initFrame=initialDefaultFrame,mathAbs=Math.abs;function interpolateValue(t,e){var i,n=this.offsetTime;"multidimensional"===this.propType&&(i=createTypedArray("float32",this.pv.length));for(var r,s,a,o,l,h,c,u,d,p=e.lastIndex,f=p,m=this.keyframes.length-1,g=!0;g;){if(r=this.keyframes[f],s=this.keyframes[f+1],f===m-1&&t>=s.t-n){r.h&&(r=s),p=0;break}if(s.t-n>t){p=f;break}f<m-1?f+=1:(p=0,g=!1)}a=this.keyframesMetadata[f]||{};var v,y=s.t-n,b=r.t-n;if(r.to){a.bezierData||(a.bezierData=bez.buildBezierData(r.s,s.s||r.e,r.to,r.ti));var x=a.bezierData;if(t>=y||t<b){var w=t>=y?x.points.length-1:0;for(l=x.points[w].point.length,o=0;o<l;o+=1)i[o]=x.points[w].point[o]}else{a.__fnct?d=a.__fnct:(d=BezierFactory.getBezierEasing(r.o.x,r.o.y,r.i.x,r.i.y,r.n).get,a.__fnct=d),h=d((t-b)/(y-b));var S,A=x.segmentLength*h,E=e.lastFrame<t&&e._lastKeyframeIndex===f?e._lastAddedLength:0;for(u=e.lastFrame<t&&e._lastKeyframeIndex===f?e._lastPoint:0,g=!0,c=x.points.length;g;){if(E+=x.points[u].partialLength,0===A||0===h||u===x.points.length-1){for(l=x.points[u].point.length,o=0;o<l;o+=1)i[o]=x.points[u].point[o];break}if(A>=E&&A<E+x.points[u+1].partialLength){for(S=(A-E)/x.points[u+1].partialLength,l=x.points[u].point.length,o=0;o<l;o+=1)i[o]=x.points[u].point[o]+(x.points[u+1].point[o]-x.points[u].point[o])*S;break}u<c-1?u+=1:g=!1}e._lastPoint=u,e._lastAddedLength=E-x.points[u].partialLength,e._lastKeyframeIndex=f}}else{var _,C,M,P,T;if(m=r.s.length,v=s.s||r.e,this.sh&&1!==r.h)t>=y?(i[0]=v[0],i[1]=v[1],i[2]=v[2]):t<=b?(i[0]=r.s[0],i[1]=r.s[1],i[2]=r.s[2]):quaternionToEuler(i,slerp(createQuaternion(r.s),createQuaternion(v),(t-b)/(y-b)));else for(f=0;f<m;f+=1)1!==r.h&&(t>=y?h=1:t<b?h=0:(r.o.x.constructor===Array?(a.__fnct||(a.__fnct=[]),a.__fnct[f]?d=a.__fnct[f]:(_=void 0===r.o.x[f]?r.o.x[0]:r.o.x[f],C=void 0===r.o.y[f]?r.o.y[0]:r.o.y[f],M=void 0===r.i.x[f]?r.i.x[0]:r.i.x[f],P=void 0===r.i.y[f]?r.i.y[0]:r.i.y[f],d=BezierFactory.getBezierEasing(_,C,M,P).get,a.__fnct[f]=d)):a.__fnct?d=a.__fnct:(_=r.o.x,C=r.o.y,M=r.i.x,P=r.i.y,d=BezierFactory.getBezierEasing(_,C,M,P).get,r.keyframeMetadata=d),h=d((t-b)/(y-b)))),v=s.s||r.e,T=1===r.h?r.s[f]:r.s[f]+(v[f]-r.s[f])*h,"multidimensional"===this.propType?i[f]=T:i=T}return e.lastIndex=p,i}function slerp(t,e,i){var n,r,s,a,o,l=[],h=t[0],c=t[1],u=t[2],d=t[3],p=e[0],f=e[1],m=e[2],g=e[3];return(r=h*p+c*f+u*m+d*g)<0&&(r=-r,p=-p,f=-f,m=-m,g=-g),1-r>1e-6?(n=Math.acos(r),s=Math.sin(n),a=Math.sin((1-i)*n)/s,o=Math.sin(i*n)/s):(a=1-i,o=i),l[0]=a*h+o*p,l[1]=a*c+o*f,l[2]=a*u+o*m,l[3]=a*d+o*g,l}function quaternionToEuler(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],a=Math.atan2(2*n*s-2*i*r,1-2*n*n-2*r*r),o=Math.asin(2*i*n+2*r*s),l=Math.atan2(2*i*s-2*n*r,1-2*i*i-2*r*r);t[0]=a/degToRads,t[1]=o/degToRads,t[2]=l/degToRads}function createQuaternion(t){var e=t[0]*degToRads,i=t[1]*degToRads,n=t[2]*degToRads,r=Math.cos(e/2),s=Math.cos(i/2),a=Math.cos(n/2),o=Math.sin(e/2),l=Math.sin(i/2),h=Math.sin(n/2);return[o*l*a+r*s*h,o*s*a+r*l*h,r*l*a-o*s*h,r*s*a-o*l*h]}function getValueAtCurrentTime(){var t=this.comp.renderedFrame-this.offsetTime,e=this.keyframes[0].t-this.offsetTime,i=this.keyframes[this.keyframes.length-1].t-this.offsetTime;if(!(t===this._caching.lastFrame||this._caching.lastFrame!==initFrame&&(this._caching.lastFrame>=i&&t>=i||this._caching.lastFrame<e&&t<e))){this._caching.lastFrame>=t&&(this._caching._lastKeyframeIndex=-1,this._caching.lastIndex=0);var n=this.interpolateValue(t,this._caching);this.pv=n}return this._caching.lastFrame=t,this.pv}function setVValue(t){var e;if("unidimensional"===this.propType)e=t*this.mult,mathAbs(this.v-e)>1e-5&&(this.v=e,this._mdf=!0);else for(var i=0,n=this.v.length;i<n;)e=t[i]*this.mult,mathAbs(this.v[i]-e)>1e-5&&(this.v[i]=e,this._mdf=!0),i+=1}function processEffectsSequence(){if(this.elem.globalData.frameId!==this.frameId&&this.effectsSequence.length)if(this.lock)this.setVValue(this.pv);else{var t;this.lock=!0,this._mdf=this._isFirstFrame;var e=this.effectsSequence.length,i=this.kf?this.pv:this.data.k;for(t=0;t<e;t+=1)i=this.effectsSequence[t](i);this.setVValue(i),this._isFirstFrame=!1,this.lock=!1,this.frameId=this.elem.globalData.frameId}}function addEffect(t){this.effectsSequence.push(t),this.container.addDynamicProperty(this)}function ValueProperty(t,e,i,n){this.propType="unidimensional",this.mult=i||1,this.data=e,this.v=i?e.k*i:e.k,this.pv=e.k,this._mdf=!1,this.elem=t,this.container=n,this.comp=t.comp,this.k=!1,this.kf=!1,this.vel=0,this.effectsSequence=[],this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function MultiDimensionalProperty(t,e,i,n){var r;this.propType="multidimensional",this.mult=i||1,this.data=e,this._mdf=!1,this.elem=t,this.container=n,this.comp=t.comp,this.k=!1,this.kf=!1,this.frameId=-1;var s=e.k.length;for(this.v=createTypedArray("float32",s),this.pv=createTypedArray("float32",s),this.vel=createTypedArray("float32",s),r=0;r<s;r+=1)this.v[r]=e.k[r]*this.mult,this.pv[r]=e.k[r];this._isFirstFrame=!0,this.effectsSequence=[],this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function KeyframedValueProperty(t,e,i,n){this.propType="unidimensional",this.keyframes=e.k,this.keyframesMetadata=[],this.offsetTime=t.data.st,this.frameId=-1,this._caching={lastFrame:initFrame,lastIndex:0,value:0,_lastKeyframeIndex:-1},this.k=!0,this.kf=!0,this.data=e,this.mult=i||1,this.elem=t,this.container=n,this.comp=t.comp,this.v=initFrame,this.pv=initFrame,this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.addEffect=addEffect}function KeyframedMultidimensionalProperty(t,e,i,n){var r;this.propType="multidimensional";var s,a,o,l,h=e.k.length;for(r=0;r<h-1;r+=1)e.k[r].to&&e.k[r].s&&e.k[r+1]&&e.k[r+1].s&&(s=e.k[r].s,a=e.k[r+1].s,o=e.k[r].to,l=e.k[r].ti,(2===s.length&&(s[0]!==a[0]||s[1]!==a[1])&&bez.pointOnLine2D(s[0],s[1],a[0],a[1],s[0]+o[0],s[1]+o[1])&&bez.pointOnLine2D(s[0],s[1],a[0],a[1],a[0]+l[0],a[1]+l[1])||3===s.length&&(s[0]!==a[0]||s[1]!==a[1]||s[2]!==a[2])&&bez.pointOnLine3D(s[0],s[1],s[2],a[0],a[1],a[2],s[0]+o[0],s[1]+o[1],s[2]+o[2])&&bez.pointOnLine3D(s[0],s[1],s[2],a[0],a[1],a[2],a[0]+l[0],a[1]+l[1],a[2]+l[2]))&&(e.k[r].to=null,e.k[r].ti=null),s[0]===a[0]&&s[1]===a[1]&&0===o[0]&&0===o[1]&&0===l[0]&&0===l[1]&&(2===s.length||s[2]===a[2]&&0===o[2]&&0===l[2])&&(e.k[r].to=null,e.k[r].ti=null));this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.data=e,this.keyframes=e.k,this.keyframesMetadata=[],this.offsetTime=t.data.st,this.k=!0,this.kf=!0,this._isFirstFrame=!0,this.mult=i||1,this.elem=t,this.container=n,this.comp=t.comp,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.frameId=-1;var c=e.k[0].s.length;for(this.v=createTypedArray("float32",c),this.pv=createTypedArray("float32",c),r=0;r<c;r+=1)this.v[r]=initFrame,this.pv[r]=initFrame;this._caching={lastFrame:initFrame,lastIndex:0,value:createTypedArray("float32",c)},this.addEffect=addEffect}var PropertyFactory={getProp:function(t,e,i,n,r){var s;if(e.sid&&(e=t.globalData.slotManager.getProp(e)),e.k.length)if("number"===typeof e.k[0])s=new MultiDimensionalProperty(t,e,n,r);else switch(i){case 0:s=new KeyframedValueProperty(t,e,n,r);break;case 1:s=new KeyframedMultidimensionalProperty(t,e,n,r)}else s=new ValueProperty(t,e,n,r);return s.effectsSequence.length&&r.addDynamicProperty(s),s}};function DynamicPropertyContainer(){}DynamicPropertyContainer.prototype={addDynamicProperty:function(t){-1===this.dynamicProperties.indexOf(t)&&(this.dynamicProperties.push(t),this.container.addDynamicProperty(this),this._isAnimated=!0)},iterateDynamicProperties:function(){var t;this._mdf=!1;var e=this.dynamicProperties.length;for(t=0;t<e;t+=1)this.dynamicProperties[t].getValue(),this.dynamicProperties[t]._mdf&&(this._mdf=!0)},initDynamicPropertyContainer:function(t){this.container=t,this.dynamicProperties=[],this._mdf=!1,this._isAnimated=!1}};var pointPool=poolFactory(8,(function(){return createTypedArray("float32",2)}));function ShapePath(){this.c=!1,this._length=0,this._maxLength=8,this.v=createSizedArray(this._maxLength),this.o=createSizedArray(this._maxLength),this.i=createSizedArray(this._maxLength)}ShapePath.prototype.setPathData=function(t,e){this.c=t,this.setLength(e);for(var i=0;i<e;)this.v[i]=pointPool.newElement(),this.o[i]=pointPool.newElement(),this.i[i]=pointPool.newElement(),i+=1},ShapePath.prototype.setLength=function(t){for(;this._maxLength<t;)this.doubleArrayLength();this._length=t},ShapePath.prototype.doubleArrayLength=function(){this.v=this.v.concat(createSizedArray(this._maxLength)),this.i=this.i.concat(createSizedArray(this._maxLength)),this.o=this.o.concat(createSizedArray(this._maxLength)),this._maxLength*=2},ShapePath.prototype.setXYAt=function(t,e,i,n,r){var s;switch(this._length=Math.max(this._length,n+1),this._length>=this._maxLength&&this.doubleArrayLength(),i){case"v":s=this.v;break;case"i":s=this.i;break;case"o":s=this.o;break;default:s=[]}(!s[n]||s[n]&&!r)&&(s[n]=pointPool.newElement()),s[n][0]=t,s[n][1]=e},ShapePath.prototype.setTripleAt=function(t,e,i,n,r,s,a,o){this.setXYAt(t,e,"v",a,o),this.setXYAt(i,n,"o",a,o),this.setXYAt(r,s,"i",a,o)},ShapePath.prototype.reverse=function(){var t=new ShapePath;t.setPathData(this.c,this._length);var e=this.v,i=this.o,n=this.i,r=0;this.c&&(t.setTripleAt(e[0][0],e[0][1],n[0][0],n[0][1],i[0][0],i[0][1],0,!1),r=1);var s,a=this._length-1,o=this._length;for(s=r;s<o;s+=1)t.setTripleAt(e[a][0],e[a][1],n[a][0],n[a][1],i[a][0],i[a][1],s,!1),a-=1;return t},ShapePath.prototype.length=function(){return this._length};var shapePool=function(){var t=poolFactory(4,(function(){return new ShapePath}),(function(t){var e,i=t._length;for(e=0;e<i;e+=1)pointPool.release(t.v[e]),pointPool.release(t.i[e]),pointPool.release(t.o[e]),t.v[e]=null,t.i[e]=null,t.o[e]=null;t._length=0,t.c=!1}));return t.clone=function(e){var i,n=t.newElement(),r=void 0===e._length?e.v.length:e._length;for(n.setLength(r),n.c=e.c,i=0;i<r;i+=1)n.setTripleAt(e.v[i][0],e.v[i][1],e.o[i][0],e.o[i][1],e.i[i][0],e.i[i][1],i);return n},t}();function ShapeCollection(){this._length=0,this._maxLength=4,this.shapes=createSizedArray(this._maxLength)}ShapeCollection.prototype.addShape=function(t){this._length===this._maxLength&&(this.shapes=this.shapes.concat(createSizedArray(this._maxLength)),this._maxLength*=2),this.shapes[this._length]=t,this._length+=1},ShapeCollection.prototype.releaseShapes=function(){var t;for(t=0;t<this._length;t+=1)shapePool.release(this.shapes[t]);this._length=0};var shapeCollectionPool=function(){var t={newShapeCollection:function(){return e?n[e-=1]:new ShapeCollection},release:function(t){var r,s=t._length;for(r=0;r<s;r+=1)shapePool.release(t.shapes[r]);t._length=0,e===i&&(n=pooling.double(n),i*=2),n[e]=t,e+=1}},e=0,i=4,n=createSizedArray(i);return t}(),ShapePropertyFactory=function(){var t=-999999;function e(t,e,i){var n,r,s,a,o,l,h,c,u,d=i.lastIndex,p=this.keyframes;if(t<p[0].t-this.offsetTime)n=p[0].s[0],s=!0,d=0;else if(t>=p[p.length-1].t-this.offsetTime)n=p[p.length-1].s?p[p.length-1].s[0]:p[p.length-2].e[0],s=!0;else{for(var f,m,g,v=d,y=p.length-1,b=!0;b&&(f=p[v],!((m=p[v+1]).t-this.offsetTime>t));)v<y-1?v+=1:b=!1;if(g=this.keyframesMetadata[v]||{},d=v,!(s=1===f.h)){if(t>=m.t-this.offsetTime)c=1;else if(t<f.t-this.offsetTime)c=0;else{var x;g.__fnct?x=g.__fnct:(x=BezierFactory.getBezierEasing(f.o.x,f.o.y,f.i.x,f.i.y).get,g.__fnct=x),c=x((t-(f.t-this.offsetTime))/(m.t-this.offsetTime-(f.t-this.offsetTime)))}r=m.s?m.s[0]:f.e[0]}n=f.s[0]}for(l=e._length,h=n.i[0].length,i.lastIndex=d,a=0;a<l;a+=1)for(o=0;o<h;o+=1)u=s?n.i[a][o]:n.i[a][o]+(r.i[a][o]-n.i[a][o])*c,e.i[a][o]=u,u=s?n.o[a][o]:n.o[a][o]+(r.o[a][o]-n.o[a][o])*c,e.o[a][o]=u,u=s?n.v[a][o]:n.v[a][o]+(r.v[a][o]-n.v[a][o])*c,e.v[a][o]=u}function i(){var e=this.comp.renderedFrame-this.offsetTime,i=this.keyframes[0].t-this.offsetTime,n=this.keyframes[this.keyframes.length-1].t-this.offsetTime,r=this._caching.lastFrame;return r!==t&&(r<i&&e<i||r>n&&e>n)||(this._caching.lastIndex=r<e?this._caching.lastIndex:0,this.interpolateShape(e,this.pv,this._caching)),this._caching.lastFrame=e,this.pv}function n(){this.paths=this.localShapeCollection}function r(t){(function(t,e){if(t._length!==e._length||t.c!==e.c)return!1;var i,n=t._length;for(i=0;i<n;i+=1)if(t.v[i][0]!==e.v[i][0]||t.v[i][1]!==e.v[i][1]||t.o[i][0]!==e.o[i][0]||t.o[i][1]!==e.o[i][1]||t.i[i][0]!==e.i[i][0]||t.i[i][1]!==e.i[i][1])return!1;return!0})(this.v,t)||(this.v=shapePool.clone(t),this.localShapeCollection.releaseShapes(),this.localShapeCollection.addShape(this.v),this._mdf=!0,this.paths=this.localShapeCollection)}function s(){if(this.elem.globalData.frameId!==this.frameId)if(this.effectsSequence.length)if(this.lock)this.setVValue(this.pv);else{var t,e;this.lock=!0,this._mdf=!1,t=this.kf?this.pv:this.data.ks?this.data.ks.k:this.data.pt.k;var i=this.effectsSequence.length;for(e=0;e<i;e+=1)t=this.effectsSequence[e](t);this.setVValue(t),this.lock=!1,this.frameId=this.elem.globalData.frameId}else this._mdf=!1}function a(t,e,i){this.propType="shape",this.comp=t.comp,this.container=t,this.elem=t,this.data=e,this.k=!1,this.kf=!1,this._mdf=!1;var r=3===i?e.pt.k:e.ks.k;this.v=shapePool.clone(r),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.reset=n,this.effectsSequence=[]}function o(t){this.effectsSequence.push(t),this.container.addDynamicProperty(this)}function l(e,r,s){this.propType="shape",this.comp=e.comp,this.elem=e,this.container=e,this.offsetTime=e.data.st,this.keyframes=3===s?r.pt.k:r.ks.k,this.keyframesMetadata=[],this.k=!0,this.kf=!0;var a=this.keyframes[0].s[0].i.length;this.v=shapePool.newElement(),this.v.setPathData(this.keyframes[0].s[0].c,a),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.lastFrame=t,this.reset=n,this._caching={lastFrame:t,lastIndex:0},this.effectsSequence=[i.bind(this)]}a.prototype.interpolateShape=e,a.prototype.getValue=s,a.prototype.setVValue=r,a.prototype.addEffect=o,l.prototype.getValue=s,l.prototype.interpolateShape=e,l.prototype.setVValue=r,l.prototype.addEffect=o;var h=function(){var t=roundCorner;function e(t,e){this.v=shapePool.newElement(),this.v.setPathData(!0,4),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.localShapeCollection.addShape(this.v),this.d=e.d,this.elem=t,this.comp=t.comp,this.frameId=-1,this.initDynamicPropertyContainer(t),this.p=PropertyFactory.getProp(t,e.p,1,0,this),this.s=PropertyFactory.getProp(t,e.s,1,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertEllToPath())}return e.prototype={reset:n,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertEllToPath())},convertEllToPath:function(){var e=this.p.v[0],i=this.p.v[1],n=this.s.v[0]/2,r=this.s.v[1]/2,s=3!==this.d,a=this.v;a.v[0][0]=e,a.v[0][1]=i-r,a.v[1][0]=s?e+n:e-n,a.v[1][1]=i,a.v[2][0]=e,a.v[2][1]=i+r,a.v[3][0]=s?e-n:e+n,a.v[3][1]=i,a.i[0][0]=s?e-n*t:e+n*t,a.i[0][1]=i-r,a.i[1][0]=s?e+n:e-n,a.i[1][1]=i-r*t,a.i[2][0]=s?e+n*t:e-n*t,a.i[2][1]=i+r,a.i[3][0]=s?e-n:e+n,a.i[3][1]=i+r*t,a.o[0][0]=s?e+n*t:e-n*t,a.o[0][1]=i-r,a.o[1][0]=s?e+n:e-n,a.o[1][1]=i+r*t,a.o[2][0]=s?e-n*t:e+n*t,a.o[2][1]=i+r,a.o[3][0]=s?e-n:e+n,a.o[3][1]=i-r*t}},extendPrototype([DynamicPropertyContainer],e),e}(),c=function(){function t(t,e){this.v=shapePool.newElement(),this.v.setPathData(!0,0),this.elem=t,this.comp=t.comp,this.data=e,this.frameId=-1,this.d=e.d,this.initDynamicPropertyContainer(t),1===e.sy?(this.ir=PropertyFactory.getProp(t,e.ir,0,0,this),this.is=PropertyFactory.getProp(t,e.is,0,.01,this),this.convertToPath=this.convertStarToPath):this.convertToPath=this.convertPolygonToPath,this.pt=PropertyFactory.getProp(t,e.pt,0,0,this),this.p=PropertyFactory.getProp(t,e.p,1,0,this),this.r=PropertyFactory.getProp(t,e.r,0,degToRads,this),this.or=PropertyFactory.getProp(t,e.or,0,0,this),this.os=PropertyFactory.getProp(t,e.os,0,.01,this),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertToPath())}return t.prototype={reset:n,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertToPath())},convertStarToPath:function(){var t,e,i,n,r=2*Math.floor(this.pt.v),s=2*Math.PI/r,a=!0,o=this.or.v,l=this.ir.v,h=this.os.v,c=this.is.v,u=2*Math.PI*o/(2*r),d=2*Math.PI*l/(2*r),p=-Math.PI/2;p+=this.r.v;var f=3===this.data.d?-1:1;for(this.v._length=0,t=0;t<r;t+=1){i=a?h:c,n=a?u:d;var m=(e=a?o:l)*Math.cos(p),g=e*Math.sin(p),v=0===m&&0===g?0:g/Math.sqrt(m*m+g*g),y=0===m&&0===g?0:-m/Math.sqrt(m*m+g*g);m+=+this.p.v[0],g+=+this.p.v[1],this.v.setTripleAt(m,g,m-v*n*i*f,g-y*n*i*f,m+v*n*i*f,g+y*n*i*f,t,!0),a=!a,p+=s*f}},convertPolygonToPath:function(){var t,e=Math.floor(this.pt.v),i=2*Math.PI/e,n=this.or.v,r=this.os.v,s=2*Math.PI*n/(4*e),a=.5*-Math.PI,o=3===this.data.d?-1:1;for(a+=this.r.v,this.v._length=0,t=0;t<e;t+=1){var l=n*Math.cos(a),h=n*Math.sin(a),c=0===l&&0===h?0:h/Math.sqrt(l*l+h*h),u=0===l&&0===h?0:-l/Math.sqrt(l*l+h*h);l+=+this.p.v[0],h+=+this.p.v[1],this.v.setTripleAt(l,h,l-c*s*r*o,h-u*s*r*o,l+c*s*r*o,h+u*s*r*o,t,!0),a+=i*o}this.paths.length=0,this.paths[0]=this.v}},extendPrototype([DynamicPropertyContainer],t),t}(),u=function(){function t(t,e){this.v=shapePool.newElement(),this.v.c=!0,this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.elem=t,this.comp=t.comp,this.frameId=-1,this.d=e.d,this.initDynamicPropertyContainer(t),this.p=PropertyFactory.getProp(t,e.p,1,0,this),this.s=PropertyFactory.getProp(t,e.s,1,0,this),this.r=PropertyFactory.getProp(t,e.r,0,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertRectToPath())}return t.prototype={convertRectToPath:function(){var t=this.p.v[0],e=this.p.v[1],i=this.s.v[0]/2,n=this.s.v[1]/2,r=bmMin(i,n,this.r.v),s=r*(1-roundCorner);this.v._length=0,2===this.d||1===this.d?(this.v.setTripleAt(t+i,e-n+r,t+i,e-n+r,t+i,e-n+s,0,!0),this.v.setTripleAt(t+i,e+n-r,t+i,e+n-s,t+i,e+n-r,1,!0),0!==r?(this.v.setTripleAt(t+i-r,e+n,t+i-r,e+n,t+i-s,e+n,2,!0),this.v.setTripleAt(t-i+r,e+n,t-i+s,e+n,t-i+r,e+n,3,!0),this.v.setTripleAt(t-i,e+n-r,t-i,e+n-r,t-i,e+n-s,4,!0),this.v.setTripleAt(t-i,e-n+r,t-i,e-n+s,t-i,e-n+r,5,!0),this.v.setTripleAt(t-i+r,e-n,t-i+r,e-n,t-i+s,e-n,6,!0),this.v.setTripleAt(t+i-r,e-n,t+i-s,e-n,t+i-r,e-n,7,!0)):(this.v.setTripleAt(t-i,e+n,t-i+s,e+n,t-i,e+n,2),this.v.setTripleAt(t-i,e-n,t-i,e-n+s,t-i,e-n,3))):(this.v.setTripleAt(t+i,e-n+r,t+i,e-n+s,t+i,e-n+r,0,!0),0!==r?(this.v.setTripleAt(t+i-r,e-n,t+i-r,e-n,t+i-s,e-n,1,!0),this.v.setTripleAt(t-i+r,e-n,t-i+s,e-n,t-i+r,e-n,2,!0),this.v.setTripleAt(t-i,e-n+r,t-i,e-n+r,t-i,e-n+s,3,!0),this.v.setTripleAt(t-i,e+n-r,t-i,e+n-s,t-i,e+n-r,4,!0),this.v.setTripleAt(t-i+r,e+n,t-i+r,e+n,t-i+s,e+n,5,!0),this.v.setTripleAt(t+i-r,e+n,t+i-s,e+n,t+i-r,e+n,6,!0),this.v.setTripleAt(t+i,e+n-r,t+i,e+n-r,t+i,e+n-s,7,!0)):(this.v.setTripleAt(t-i,e-n,t-i+s,e-n,t-i,e-n,1,!0),this.v.setTripleAt(t-i,e+n,t-i,e+n-s,t-i,e+n,2,!0),this.v.setTripleAt(t+i,e+n,t+i-s,e+n,t+i,e+n,3,!0)))},getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertRectToPath())},reset:n},extendPrototype([DynamicPropertyContainer],t),t}(),d={getShapeProp:function(t,e,i){var n;return 3===i||4===i?n=(3===i?e.pt:e.ks).k.length?new l(t,e,i):new a(t,e,i):5===i?n=new u(t,e):6===i?n=new h(t,e):7===i&&(n=new c(t,e)),n.k&&t.addDynamicProperty(n),n},getConstructorFunction:function(){return a},getKeyframedConstructorFunction:function(){return l}};return d}(),Matrix=function(){var t=Math.cos,e=Math.sin,i=Math.tan,n=Math.round;function r(){return this.props[0]=1,this.props[1]=0,this.props[2]=0,this.props[3]=0,this.props[4]=0,this.props[5]=1,this.props[6]=0,this.props[7]=0,this.props[8]=0,this.props[9]=0,this.props[10]=1,this.props[11]=0,this.props[12]=0,this.props[13]=0,this.props[14]=0,this.props[15]=1,this}function s(i){if(0===i)return this;var n=t(i),r=e(i);return this._t(n,-r,0,0,r,n,0,0,0,0,1,0,0,0,0,1)}function a(i){if(0===i)return this;var n=t(i),r=e(i);return this._t(1,0,0,0,0,n,-r,0,0,r,n,0,0,0,0,1)}function o(i){if(0===i)return this;var n=t(i),r=e(i);return this._t(n,0,r,0,0,1,0,0,-r,0,n,0,0,0,0,1)}function l(i){if(0===i)return this;var n=t(i),r=e(i);return this._t(n,-r,0,0,r,n,0,0,0,0,1,0,0,0,0,1)}function h(t,e){return this._t(1,e,t,1,0,0)}function c(t,e){return this.shear(i(t),i(e))}function u(n,r){var s=t(r),a=e(r);return this._t(s,a,0,0,-a,s,0,0,0,0,1,0,0,0,0,1)._t(1,0,0,0,i(n),1,0,0,0,0,1,0,0,0,0,1)._t(s,-a,0,0,a,s,0,0,0,0,1,0,0,0,0,1)}function d(t,e,i){return i||0===i||(i=1),1===t&&1===e&&1===i?this:this._t(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1)}function p(t,e,i,n,r,s,a,o,l,h,c,u,d,p,f,m){return this.props[0]=t,this.props[1]=e,this.props[2]=i,this.props[3]=n,this.props[4]=r,this.props[5]=s,this.props[6]=a,this.props[7]=o,this.props[8]=l,this.props[9]=h,this.props[10]=c,this.props[11]=u,this.props[12]=d,this.props[13]=p,this.props[14]=f,this.props[15]=m,this}function f(t,e,i){return i=i||0,0!==t||0!==e||0!==i?this._t(1,0,0,0,0,1,0,0,0,0,1,0,t,e,i,1):this}function m(t,e,i,n,r,s,a,o,l,h,c,u,d,p,f,m){var g=this.props;if(1===t&&0===e&&0===i&&0===n&&0===r&&1===s&&0===a&&0===o&&0===l&&0===h&&1===c&&0===u)return g[12]=g[12]*t+g[15]*d,g[13]=g[13]*s+g[15]*p,g[14]=g[14]*c+g[15]*f,g[15]*=m,this._identityCalculated=!1,this;var v=g[0],y=g[1],b=g[2],x=g[3],w=g[4],S=g[5],A=g[6],E=g[7],_=g[8],C=g[9],M=g[10],P=g[11],T=g[12],D=g[13],k=g[14],I=g[15];return g[0]=v*t+y*r+b*l+x*d,g[1]=v*e+y*s+b*h+x*p,g[2]=v*i+y*a+b*c+x*f,g[3]=v*n+y*o+b*u+x*m,g[4]=w*t+S*r+A*l+E*d,g[5]=w*e+S*s+A*h+E*p,g[6]=w*i+S*a+A*c+E*f,g[7]=w*n+S*o+A*u+E*m,g[8]=_*t+C*r+M*l+P*d,g[9]=_*e+C*s+M*h+P*p,g[10]=_*i+C*a+M*c+P*f,g[11]=_*n+C*o+M*u+P*m,g[12]=T*t+D*r+k*l+I*d,g[13]=T*e+D*s+k*h+I*p,g[14]=T*i+D*a+k*c+I*f,g[15]=T*n+D*o+k*u+I*m,this._identityCalculated=!1,this}function g(t){var e=t.props;return this.transform(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function v(){return this._identityCalculated||(this._identity=!(1!==this.props[0]||0!==this.props[1]||0!==this.props[2]||0!==this.props[3]||0!==this.props[4]||1!==this.props[5]||0!==this.props[6]||0!==this.props[7]||0!==this.props[8]||0!==this.props[9]||1!==this.props[10]||0!==this.props[11]||0!==this.props[12]||0!==this.props[13]||0!==this.props[14]||1!==this.props[15]),this._identityCalculated=!0),this._identity}function y(t){for(var e=0;e<16;){if(t.props[e]!==this.props[e])return!1;e+=1}return!0}function b(t){var e;for(e=0;e<16;e+=1)t.props[e]=this.props[e];return t}function x(t){var e;for(e=0;e<16;e+=1)this.props[e]=t[e]}function w(t,e,i){return{x:t*this.props[0]+e*this.props[4]+i*this.props[8]+this.props[12],y:t*this.props[1]+e*this.props[5]+i*this.props[9]+this.props[13],z:t*this.props[2]+e*this.props[6]+i*this.props[10]+this.props[14]}}function S(t,e,i){return t*this.props[0]+e*this.props[4]+i*this.props[8]+this.props[12]}function A(t,e,i){return t*this.props[1]+e*this.props[5]+i*this.props[9]+this.props[13]}function E(t,e,i){return t*this.props[2]+e*this.props[6]+i*this.props[10]+this.props[14]}function _(){var t=this.props[0]*this.props[5]-this.props[1]*this.props[4],e=this.props[5]/t,i=-this.props[1]/t,n=-this.props[4]/t,r=this.props[0]/t,s=(this.props[4]*this.props[13]-this.props[5]*this.props[12])/t,a=-(this.props[0]*this.props[13]-this.props[1]*this.props[12])/t,o=new Matrix;return o.props[0]=e,o.props[1]=i,o.props[4]=n,o.props[5]=r,o.props[12]=s,o.props[13]=a,o}function C(t){return this.getInverseMatrix().applyToPointArray(t[0],t[1],t[2]||0)}function M(t){var e,i=t.length,n=[];for(e=0;e<i;e+=1)n[e]=C(t[e]);return n}function P(t,e,i){var n=createTypedArray("float32",6);if(this.isIdentity())n[0]=t[0],n[1]=t[1],n[2]=e[0],n[3]=e[1],n[4]=i[0],n[5]=i[1];else{var r=this.props[0],s=this.props[1],a=this.props[4],o=this.props[5],l=this.props[12],h=this.props[13];n[0]=t[0]*r+t[1]*a+l,n[1]=t[0]*s+t[1]*o+h,n[2]=e[0]*r+e[1]*a+l,n[3]=e[0]*s+e[1]*o+h,n[4]=i[0]*r+i[1]*a+l,n[5]=i[0]*s+i[1]*o+h}return n}function T(t,e,i){return this.isIdentity()?[t,e,i]:[t*this.props[0]+e*this.props[4]+i*this.props[8]+this.props[12],t*this.props[1]+e*this.props[5]+i*this.props[9]+this.props[13],t*this.props[2]+e*this.props[6]+i*this.props[10]+this.props[14]]}function D(t,e){if(this.isIdentity())return t+","+e;var i=this.props;return Math.round(100*(t*i[0]+e*i[4]+i[12]))/100+","+Math.round(100*(t*i[1]+e*i[5]+i[13]))/100}function k(){for(var t=0,e=this.props,i="matrix3d(";t<16;)i+=n(1e4*e[t])/1e4,i+=15===t?")":",",t+=1;return i}function I(t){return t<1e-6&&t>0||t>-1e-6&&t<0?n(1e4*t)/1e4:t}function R(){var t=this.props;return"matrix("+I(t[0])+","+I(t[1])+","+I(t[4])+","+I(t[5])+","+I(t[12])+","+I(t[13])+")"}return function(){this.reset=r,this.rotate=s,this.rotateX=a,this.rotateY=o,this.rotateZ=l,this.skew=c,this.skewFromAxis=u,this.shear=h,this.scale=d,this.setTransform=p,this.translate=f,this.transform=m,this.multiply=g,this.applyToPoint=w,this.applyToX=S,this.applyToY=A,this.applyToZ=E,this.applyToPointArray=T,this.applyToTriplePoints=P,this.applyToPointStringified=D,this.toCSS=k,this.to2dCSS=R,this.clone=b,this.cloneFromProps=x,this.equals=y,this.inversePoints=M,this.inversePoint=C,this.getInverseMatrix=_,this._t=this.transform,this.isIdentity=v,this._identity=!0,this._identityCalculated=!1,this.props=createTypedArray("float32",16),this.reset()}}();function _typeof$3(t){return _typeof$3="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof$3(t)}var lottie={},standalone="__[STANDALONE]__",animationData="__[ANIMATIONDATA]__",renderer="";function setLocation(t){setLocationHref(t)}function searchAnimations(){!0===standalone?animationManager.searchAnimations(animationData,standalone,renderer):animationManager.searchAnimations()}function setSubframeRendering(t){setSubframeEnabled(t)}function setPrefix(t){setIdPrefix(t)}function loadAnimation(t){return!0===standalone&&(t.animationData=JSON.parse(animationData)),animationManager.loadAnimation(t)}function setQuality(t){if("string"===typeof t)switch(t){case"high":setDefaultCurveSegments(200);break;default:case"medium":setDefaultCurveSegments(50);break;case"low":setDefaultCurveSegments(10)}else!isNaN(t)&&t>1&&setDefaultCurveSegments(t);getDefaultCurveSegments()>=50?roundValues(!1):roundValues(!0)}function inBrowser(){return"undefined"!==typeof navigator}function installPlugin(t,e){"expressions"===t&&setExpressionsPlugin(e)}function getFactory(t){switch(t){case"propertyFactory":return PropertyFactory;case"shapePropertyFactory":return ShapePropertyFactory;case"matrix":return Matrix;default:return null}}function checkReady(){"complete"===document.readyState&&(clearInterval(readyStateCheckInterval),searchAnimations())}function getQueryVariable(t){for(var e=queryString.split("&"),i=0;i<e.length;i+=1){var n=e[i].split("=");if(decodeURIComponent(n[0])==t)return decodeURIComponent(n[1])}return null}lottie.play=animationManager.play,lottie.pause=animationManager.pause,lottie.setLocationHref=setLocation,lottie.togglePause=animationManager.togglePause,lottie.setSpeed=animationManager.setSpeed,lottie.setDirection=animationManager.setDirection,lottie.stop=animationManager.stop,lottie.searchAnimations=searchAnimations,lottie.registerAnimation=animationManager.registerAnimation,lottie.loadAnimation=loadAnimation,lottie.setSubframeRendering=setSubframeRendering,lottie.resize=animationManager.resize,lottie.goToAndStop=animationManager.goToAndStop,lottie.destroy=animationManager.destroy,lottie.setQuality=setQuality,lottie.inBrowser=inBrowser,lottie.installPlugin=installPlugin,lottie.freeze=animationManager.freeze,lottie.unfreeze=animationManager.unfreeze,lottie.setVolume=animationManager.setVolume,lottie.mute=animationManager.mute,lottie.unmute=animationManager.unmute,lottie.getRegisteredAnimations=animationManager.getRegisteredAnimations,lottie.useWebWorker=setWebWorker,lottie.setIDPrefix=setPrefix,lottie.__getFactory=getFactory,lottie.version="5.12.2";var queryString="";if(standalone){var scripts=document.getElementsByTagName("script"),index=scripts.length-1,myScript=scripts[index]||{src:""};queryString=myScript.src?myScript.src.replace(/^[^\?]+\??/,""):"",renderer=getQueryVariable("renderer")}var readyStateCheckInterval=setInterval(checkReady,100);try{"object"!==_typeof$3(exports)&&__webpack_require__.amdO}catch(err){}var ShapeModifiers=function(){var t={},e={};return t.registerModifier=function(t,i){e[t]||(e[t]=i)},t.getModifier=function(t,i,n){return new e[t](i,n)},t}();function ShapeModifier(){}function TrimModifier(){}function PuckerAndBloatModifier(){}ShapeModifier.prototype.initModifierProperties=function(){},ShapeModifier.prototype.addShapeToModifier=function(){},ShapeModifier.prototype.addShape=function(t){if(!this.closed){t.sh.container.addDynamicProperty(t.sh);var e={shape:t.sh,data:t,localShapeCollection:shapeCollectionPool.newShapeCollection()};this.shapes.push(e),this.addShapeToModifier(e),this._isAnimated&&t.setAsAnimated()}},ShapeModifier.prototype.init=function(t,e){this.shapes=[],this.elem=t,this.initDynamicPropertyContainer(t),this.initModifierProperties(t,e),this.frameId=initialDefaultFrame,this.closed=!1,this.k=!1,this.dynamicProperties.length?this.k=!0:this.getValue(!0)},ShapeModifier.prototype.processKeys=function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties())},extendPrototype([DynamicPropertyContainer],ShapeModifier),extendPrototype([ShapeModifier],TrimModifier),TrimModifier.prototype.initModifierProperties=function(t,e){this.s=PropertyFactory.getProp(t,e.s,0,.01,this),this.e=PropertyFactory.getProp(t,e.e,0,.01,this),this.o=PropertyFactory.getProp(t,e.o,0,0,this),this.sValue=0,this.eValue=0,this.getValue=this.processKeys,this.m=e.m,this._isAnimated=!!this.s.effectsSequence.length||!!this.e.effectsSequence.length||!!this.o.effectsSequence.length},TrimModifier.prototype.addShapeToModifier=function(t){t.pathsData=[]},TrimModifier.prototype.calculateShapeEdges=function(t,e,i,n,r){var s=[];e<=1?s.push({s:t,e:e}):t>=1?s.push({s:t-1,e:e-1}):(s.push({s:t,e:1}),s.push({s:0,e:e-1}));var a,o,l=[],h=s.length;for(a=0;a<h;a+=1){var c,u;(o=s[a]).e*r<n||o.s*r>n+i||(c=o.s*r<=n?0:(o.s*r-n)/i,u=o.e*r>=n+i?1:(o.e*r-n)/i,l.push([c,u]))}return l.length||l.push([0,0]),l},TrimModifier.prototype.releasePathsData=function(t){var e,i=t.length;for(e=0;e<i;e+=1)segmentsLengthPool.release(t[e]);return t.length=0,t},TrimModifier.prototype.processShapes=function(t){var e,i,n,r;if(this._mdf||t){var s=this.o.v%360/360;if(s<0&&(s+=1),(e=this.s.v>1?1+s:this.s.v<0?0+s:this.s.v+s)>(i=this.e.v>1?1+s:this.e.v<0?0+s:this.e.v+s)){var a=e;e=i,i=a}e=1e-4*Math.round(1e4*e),i=1e-4*Math.round(1e4*i),this.sValue=e,this.eValue=i}else e=this.sValue,i=this.eValue;var o,l,h,c,u,d=this.shapes.length,p=0;if(i===e)for(r=0;r<d;r+=1)this.shapes[r].localShapeCollection.releaseShapes(),this.shapes[r].shape._mdf=!0,this.shapes[r].shape.paths=this.shapes[r].localShapeCollection,this._mdf&&(this.shapes[r].pathsData.length=0);else if(1===i&&0===e||0===i&&1===e){if(this._mdf)for(r=0;r<d;r+=1)this.shapes[r].pathsData.length=0,this.shapes[r].shape._mdf=!0}else{var f,m,g=[];for(r=0;r<d;r+=1)if((f=this.shapes[r]).shape._mdf||this._mdf||t||2===this.m){if(l=(n=f.shape.paths)._length,u=0,!f.shape._mdf&&f.pathsData.length)u=f.totalShapeLength;else{for(h=this.releasePathsData(f.pathsData),o=0;o<l;o+=1)c=bez.getSegmentsLength(n.shapes[o]),h.push(c),u+=c.totalLength;f.totalShapeLength=u,f.pathsData=h}p+=u,f.shape._mdf=!0}else f.shape.paths=f.localShapeCollection;var v,y=e,b=i,x=0;for(r=d-1;r>=0;r-=1)if((f=this.shapes[r]).shape._mdf){for((m=f.localShapeCollection).releaseShapes(),2===this.m&&d>1?(v=this.calculateShapeEdges(e,i,f.totalShapeLength,x,p),x+=f.totalShapeLength):v=[[y,b]],l=v.length,o=0;o<l;o+=1){y=v[o][0],b=v[o][1],g.length=0,b<=1?g.push({s:f.totalShapeLength*y,e:f.totalShapeLength*b}):y>=1?g.push({s:f.totalShapeLength*(y-1),e:f.totalShapeLength*(b-1)}):(g.push({s:f.totalShapeLength*y,e:f.totalShapeLength}),g.push({s:0,e:f.totalShapeLength*(b-1)}));var w=this.addShapes(f,g[0]);if(g[0].s!==g[0].e){if(g.length>1)if(f.shape.paths.shapes[f.shape.paths._length-1].c){var S=w.pop();this.addPaths(w,m),w=this.addShapes(f,g[1],S)}else this.addPaths(w,m),w=this.addShapes(f,g[1]);this.addPaths(w,m)}}f.shape.paths=m}}},TrimModifier.prototype.addPaths=function(t,e){var i,n=t.length;for(i=0;i<n;i+=1)e.addShape(t[i])},TrimModifier.prototype.addSegment=function(t,e,i,n,r,s,a){r.setXYAt(e[0],e[1],"o",s),r.setXYAt(i[0],i[1],"i",s+1),a&&r.setXYAt(t[0],t[1],"v",s),r.setXYAt(n[0],n[1],"v",s+1)},TrimModifier.prototype.addSegmentFromArray=function(t,e,i,n){e.setXYAt(t[1],t[5],"o",i),e.setXYAt(t[2],t[6],"i",i+1),n&&e.setXYAt(t[0],t[4],"v",i),e.setXYAt(t[3],t[7],"v",i+1)},TrimModifier.prototype.addShapes=function(t,e,i){var n,r,s,a,o,l,h,c,u=t.pathsData,d=t.shape.paths.shapes,p=t.shape.paths._length,f=0,m=[],g=!0;for(i?(o=i._length,c=i._length):(i=shapePool.newElement(),o=0,c=0),m.push(i),n=0;n<p;n+=1){for(l=u[n].lengths,i.c=d[n].c,s=d[n].c?l.length:l.length+1,r=1;r<s;r+=1)if(f+(a=l[r-1]).addedLength<e.s)f+=a.addedLength,i.c=!1;else{if(f>e.e){i.c=!1;break}e.s<=f&&e.e>=f+a.addedLength?(this.addSegment(d[n].v[r-1],d[n].o[r-1],d[n].i[r],d[n].v[r],i,o,g),g=!1):(h=bez.getNewSegment(d[n].v[r-1],d[n].v[r],d[n].o[r-1],d[n].i[r],(e.s-f)/a.addedLength,(e.e-f)/a.addedLength,l[r-1]),this.addSegmentFromArray(h,i,o,g),g=!1,i.c=!1),f+=a.addedLength,o+=1}if(d[n].c&&l.length){if(a=l[r-1],f<=e.e){var v=l[r-1].addedLength;e.s<=f&&e.e>=f+v?(this.addSegment(d[n].v[r-1],d[n].o[r-1],d[n].i[0],d[n].v[0],i,o,g),g=!1):(h=bez.getNewSegment(d[n].v[r-1],d[n].v[0],d[n].o[r-1],d[n].i[0],(e.s-f)/v,(e.e-f)/v,l[r-1]),this.addSegmentFromArray(h,i,o,g),g=!1,i.c=!1)}else i.c=!1;f+=a.addedLength,o+=1}if(i._length&&(i.setXYAt(i.v[c][0],i.v[c][1],"i",c),i.setXYAt(i.v[i._length-1][0],i.v[i._length-1][1],"o",i._length-1)),f>e.e)break;n<p-1&&(i=shapePool.newElement(),g=!0,m.push(i),o=0)}return m},extendPrototype([ShapeModifier],PuckerAndBloatModifier),PuckerAndBloatModifier.prototype.initModifierProperties=function(t,e){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(t,e.a,0,null,this),this._isAnimated=!!this.amount.effectsSequence.length},PuckerAndBloatModifier.prototype.processPath=function(t,e){var i=e/100,n=[0,0],r=t._length,s=0;for(s=0;s<r;s+=1)n[0]+=t.v[s][0],n[1]+=t.v[s][1];n[0]/=r,n[1]/=r;var a,o,l,h,c,u,d=shapePool.newElement();for(d.c=t.c,s=0;s<r;s+=1)a=t.v[s][0]+(n[0]-t.v[s][0])*i,o=t.v[s][1]+(n[1]-t.v[s][1])*i,l=t.o[s][0]+(n[0]-t.o[s][0])*-i,h=t.o[s][1]+(n[1]-t.o[s][1])*-i,c=t.i[s][0]+(n[0]-t.i[s][0])*-i,u=t.i[s][1]+(n[1]-t.i[s][1])*-i,d.setTripleAt(a,o,l,h,c,u,s);return d},PuckerAndBloatModifier.prototype.processShapes=function(t){var e,i,n,r,s,a,o=this.shapes.length,l=this.amount.v;if(0!==l)for(i=0;i<o;i+=1){if(a=(s=this.shapes[i]).localShapeCollection,s.shape._mdf||this._mdf||t)for(a.releaseShapes(),s.shape._mdf=!0,e=s.shape.paths.shapes,r=s.shape.paths._length,n=0;n<r;n+=1)a.addShape(this.processPath(e[n],l));s.shape.paths=s.localShapeCollection}this.dynamicProperties.length||(this._mdf=!1)};var TransformPropertyFactory=function(){var t=[0,0];function e(t,e,i){if(this.elem=t,this.frameId=-1,this.propType="transform",this.data=e,this.v=new Matrix,this.pre=new Matrix,this.appliedTransformations=0,this.initDynamicPropertyContainer(i||t),e.p&&e.p.s?(this.px=PropertyFactory.getProp(t,e.p.x,0,0,this),this.py=PropertyFactory.getProp(t,e.p.y,0,0,this),e.p.z&&(this.pz=PropertyFactory.getProp(t,e.p.z,0,0,this))):this.p=PropertyFactory.getProp(t,e.p||{k:[0,0,0]},1,0,this),e.rx){if(this.rx=PropertyFactory.getProp(t,e.rx,0,degToRads,this),this.ry=PropertyFactory.getProp(t,e.ry,0,degToRads,this),this.rz=PropertyFactory.getProp(t,e.rz,0,degToRads,this),e.or.k[0].ti){var n,r=e.or.k.length;for(n=0;n<r;n+=1)e.or.k[n].to=null,e.or.k[n].ti=null}this.or=PropertyFactory.getProp(t,e.or,1,degToRads,this),this.or.sh=!0}else this.r=PropertyFactory.getProp(t,e.r||{k:0},0,degToRads,this);e.sk&&(this.sk=PropertyFactory.getProp(t,e.sk,0,degToRads,this),this.sa=PropertyFactory.getProp(t,e.sa,0,degToRads,this)),this.a=PropertyFactory.getProp(t,e.a||{k:[0,0,0]},1,0,this),this.s=PropertyFactory.getProp(t,e.s||{k:[100,100,100]},1,.01,this),e.o?this.o=PropertyFactory.getProp(t,e.o,0,.01,t):this.o={_mdf:!1,v:1},this._isDirty=!0,this.dynamicProperties.length||this.getValue(!0)}return e.prototype={applyToMatrix:function(t){var e=this._mdf;this.iterateDynamicProperties(),this._mdf=this._mdf||e,this.a&&t.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.s&&t.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&t.skewFromAxis(-this.sk.v,this.sa.v),this.r?t.rotate(-this.r.v):t.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.data.p.s?this.data.p.z?t.translate(this.px.v,this.py.v,-this.pz.v):t.translate(this.px.v,this.py.v,0):t.translate(this.p.v[0],this.p.v[1],-this.p.v[2])},getValue:function(e){if(this.elem.globalData.frameId!==this.frameId){if(this._isDirty&&(this.precalculateMatrix(),this._isDirty=!1),this.iterateDynamicProperties(),this._mdf||e){var i;if(this.v.cloneFromProps(this.pre.props),this.appliedTransformations<1&&this.v.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations<2&&this.v.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&this.appliedTransformations<3&&this.v.skewFromAxis(-this.sk.v,this.sa.v),this.r&&this.appliedTransformations<4?this.v.rotate(-this.r.v):!this.r&&this.appliedTransformations<4&&this.v.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.autoOriented){var n,r;if(i=this.elem.globalData.frameRate,this.p&&this.p.keyframes&&this.p.getValueAtTime)this.p._caching.lastFrame+this.p.offsetTime<=this.p.keyframes[0].t?(n=this.p.getValueAtTime((this.p.keyframes[0].t+.01)/i,0),r=this.p.getValueAtTime(this.p.keyframes[0].t/i,0)):this.p._caching.lastFrame+this.p.offsetTime>=this.p.keyframes[this.p.keyframes.length-1].t?(n=this.p.getValueAtTime(this.p.keyframes[this.p.keyframes.length-1].t/i,0),r=this.p.getValueAtTime((this.p.keyframes[this.p.keyframes.length-1].t-.05)/i,0)):(n=this.p.pv,r=this.p.getValueAtTime((this.p._caching.lastFrame+this.p.offsetTime-.01)/i,this.p.offsetTime));else if(this.px&&this.px.keyframes&&this.py.keyframes&&this.px.getValueAtTime&&this.py.getValueAtTime){n=[],r=[];var s=this.px,a=this.py;s._caching.lastFrame+s.offsetTime<=s.keyframes[0].t?(n[0]=s.getValueAtTime((s.keyframes[0].t+.01)/i,0),n[1]=a.getValueAtTime((a.keyframes[0].t+.01)/i,0),r[0]=s.getValueAtTime(s.keyframes[0].t/i,0),r[1]=a.getValueAtTime(a.keyframes[0].t/i,0)):s._caching.lastFrame+s.offsetTime>=s.keyframes[s.keyframes.length-1].t?(n[0]=s.getValueAtTime(s.keyframes[s.keyframes.length-1].t/i,0),n[1]=a.getValueAtTime(a.keyframes[a.keyframes.length-1].t/i,0),r[0]=s.getValueAtTime((s.keyframes[s.keyframes.length-1].t-.01)/i,0),r[1]=a.getValueAtTime((a.keyframes[a.keyframes.length-1].t-.01)/i,0)):(n=[s.pv,a.pv],r[0]=s.getValueAtTime((s._caching.lastFrame+s.offsetTime-.01)/i,s.offsetTime),r[1]=a.getValueAtTime((a._caching.lastFrame+a.offsetTime-.01)/i,a.offsetTime))}else n=r=t;this.v.rotate(-Math.atan2(n[1]-r[1],n[0]-r[0]))}this.data.p&&this.data.p.s?this.data.p.z?this.v.translate(this.px.v,this.py.v,-this.pz.v):this.v.translate(this.px.v,this.py.v,0):this.v.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}this.frameId=this.elem.globalData.frameId}},precalculateMatrix:function(){if(this.appliedTransformations=0,this.pre.reset(),!this.a.effectsSequence.length&&(this.pre.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations=1,!this.s.effectsSequence.length)){if(this.pre.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.appliedTransformations=2,this.sk){if(this.sk.effectsSequence.length||this.sa.effectsSequence.length)return;this.pre.skewFromAxis(-this.sk.v,this.sa.v),this.appliedTransformations=3}this.r?this.r.effectsSequence.length||(this.pre.rotate(-this.r.v),this.appliedTransformations=4):this.rz.effectsSequence.length||this.ry.effectsSequence.length||this.rx.effectsSequence.length||this.or.effectsSequence.length||(this.pre.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.appliedTransformations=4)}},autoOrient:function(){}},extendPrototype([DynamicPropertyContainer],e),e.prototype.addDynamicProperty=function(t){this._addDynamicProperty(t),this.elem.addDynamicProperty(t),this._isDirty=!0},e.prototype._addDynamicProperty=DynamicPropertyContainer.prototype.addDynamicProperty,{getTransformProperty:function(t,i,n){return new e(t,i,n)}}}();function RepeaterModifier(){}function RoundCornersModifier(){}function floatEqual(t,e){return 1e5*Math.abs(t-e)<=Math.min(Math.abs(t),Math.abs(e))}function floatZero(t){return Math.abs(t)<=1e-5}function lerp(t,e,i){return t*(1-i)+e*i}function lerpPoint(t,e,i){return[lerp(t[0],e[0],i),lerp(t[1],e[1],i)]}function quadRoots(t,e,i){if(0===t)return[];var n=e*e-4*t*i;if(n<0)return[];var r=-e/(2*t);if(0===n)return[r];var s=Math.sqrt(n)/(2*t);return[r-s,r+s]}function polynomialCoefficients(t,e,i,n){return[3*e-t-3*i+n,3*t-6*e+3*i,-3*t+3*e,t]}function singlePoint(t){return new PolynomialBezier(t,t,t,t,!1)}function PolynomialBezier(t,e,i,n,r){r&&pointEqual(t,e)&&(e=lerpPoint(t,n,1/3)),r&&pointEqual(i,n)&&(i=lerpPoint(t,n,2/3));var s=polynomialCoefficients(t[0],e[0],i[0],n[0]),a=polynomialCoefficients(t[1],e[1],i[1],n[1]);this.a=[s[0],a[0]],this.b=[s[1],a[1]],this.c=[s[2],a[2]],this.d=[s[3],a[3]],this.points=[t,e,i,n]}function extrema(t,e){var i=t.points[0][e],n=t.points[t.points.length-1][e];if(i>n){var r=n;n=i,i=r}for(var s=quadRoots(3*t.a[e],2*t.b[e],t.c[e]),a=0;a<s.length;a+=1)if(s[a]>0&&s[a]<1){var o=t.point(s[a])[e];o<i?i=o:o>n&&(n=o)}return{min:i,max:n}}function intersectData(t,e,i){var n=t.boundingBox();return{cx:n.cx,cy:n.cy,width:n.width,height:n.height,bez:t,t:(e+i)/2,t1:e,t2:i}}function splitData(t){var e=t.bez.split(.5);return[intersectData(e[0],t.t1,t.t),intersectData(e[1],t.t,t.t2)]}function boxIntersect(t,e){return 2*Math.abs(t.cx-e.cx)<t.width+e.width&&2*Math.abs(t.cy-e.cy)<t.height+e.height}function intersectsImpl(t,e,i,n,r,s){if(boxIntersect(t,e))if(i>=s||t.width<=n&&t.height<=n&&e.width<=n&&e.height<=n)r.push([t.t,e.t]);else{var a=splitData(t),o=splitData(e);intersectsImpl(a[0],o[0],i+1,n,r,s),intersectsImpl(a[0],o[1],i+1,n,r,s),intersectsImpl(a[1],o[0],i+1,n,r,s),intersectsImpl(a[1],o[1],i+1,n,r,s)}}function crossProduct(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function lineIntersection(t,e,i,n){var r=[t[0],t[1],1],s=[e[0],e[1],1],a=[i[0],i[1],1],o=[n[0],n[1],1],l=crossProduct(crossProduct(r,s),crossProduct(a,o));return floatZero(l[2])?null:[l[0]/l[2],l[1]/l[2]]}function polarOffset(t,e,i){return[t[0]+Math.cos(e)*i,t[1]-Math.sin(e)*i]}function pointDistance(t,e){return Math.hypot(t[0]-e[0],t[1]-e[1])}function pointEqual(t,e){return floatEqual(t[0],e[0])&&floatEqual(t[1],e[1])}function ZigZagModifier(){}function setPoint(t,e,i,n,r,s,a){var o=i-Math.PI/2,l=i+Math.PI/2,h=e[0]+Math.cos(i)*n*r,c=e[1]-Math.sin(i)*n*r;t.setTripleAt(h,c,h+Math.cos(o)*s,c-Math.sin(o)*s,h+Math.cos(l)*a,c-Math.sin(l)*a,t.length())}function getPerpendicularVector(t,e){var i=[e[0]-t[0],e[1]-t[1]],n=.5*-Math.PI;return[Math.cos(n)*i[0]-Math.sin(n)*i[1],Math.sin(n)*i[0]+Math.cos(n)*i[1]]}function getProjectingAngle(t,e){var i=0===e?t.length()-1:e-1,n=(e+1)%t.length(),r=getPerpendicularVector(t.v[i],t.v[n]);return Math.atan2(0,1)-Math.atan2(r[1],r[0])}function zigZagCorner(t,e,i,n,r,s,a){var o=getProjectingAngle(e,i),l=e.v[i%e._length],h=e.v[0===i?e._length-1:i-1],c=e.v[(i+1)%e._length],u=2===s?Math.sqrt(Math.pow(l[0]-h[0],2)+Math.pow(l[1]-h[1],2)):0,d=2===s?Math.sqrt(Math.pow(l[0]-c[0],2)+Math.pow(l[1]-c[1],2)):0;setPoint(t,e.v[i%e._length],o,a,n,d/(2*(r+1)),u/(2*(r+1)),s)}function zigZagSegment(t,e,i,n,r,s){for(var a=0;a<n;a+=1){var o=(a+1)/(n+1),l=2===r?Math.sqrt(Math.pow(e.points[3][0]-e.points[0][0],2)+Math.pow(e.points[3][1]-e.points[0][1],2)):0,h=e.normalAngle(o);setPoint(t,e.point(o),h,s,i,l/(2*(n+1)),l/(2*(n+1)),r),s=-s}return s}function linearOffset(t,e,i){var n=Math.atan2(e[0]-t[0],e[1]-t[1]);return[polarOffset(t,n,i),polarOffset(e,n,i)]}function offsetSegment(t,e){var i,n,r,s,a,o,l;i=(l=linearOffset(t.points[0],t.points[1],e))[0],n=l[1],r=(l=linearOffset(t.points[1],t.points[2],e))[0],s=l[1],a=(l=linearOffset(t.points[2],t.points[3],e))[0],o=l[1];var h=lineIntersection(i,n,r,s);null===h&&(h=n);var c=lineIntersection(a,o,r,s);return null===c&&(c=a),new PolynomialBezier(i,h,c,o)}function joinLines(t,e,i,n,r){var s=e.points[3],a=i.points[0];if(3===n)return s;if(pointEqual(s,a))return s;if(2===n){var o=-e.tangentAngle(1),l=-i.tangentAngle(0)+Math.PI,h=lineIntersection(s,polarOffset(s,o+Math.PI/2,100),a,polarOffset(a,o+Math.PI/2,100)),c=h?pointDistance(h,s):pointDistance(s,a)/2,u=polarOffset(s,o,2*c*roundCorner);return t.setXYAt(u[0],u[1],"o",t.length()-1),u=polarOffset(a,l,2*c*roundCorner),t.setTripleAt(a[0],a[1],a[0],a[1],u[0],u[1],t.length()),a}var d=lineIntersection(pointEqual(s,e.points[2])?e.points[0]:e.points[2],s,a,pointEqual(a,i.points[1])?i.points[3]:i.points[1]);return d&&pointDistance(d,s)<r?(t.setTripleAt(d[0],d[1],d[0],d[1],d[0],d[1],t.length()),d):s}function getIntersection(t,e){var i=t.intersections(e);return i.length&&floatEqual(i[0][0],1)&&i.shift(),i.length?i[0]:null}function pruneSegmentIntersection(t,e){var i=t.slice(),n=e.slice(),r=getIntersection(t[t.length-1],e[0]);return r&&(i[t.length-1]=t[t.length-1].split(r[0])[0],n[0]=e[0].split(r[1])[1]),t.length>1&&e.length>1&&(r=getIntersection(t[0],e[e.length-1]))?[[t[0].split(r[0])[0]],[e[e.length-1].split(r[1])[1]]]:[i,n]}function pruneIntersections(t){for(var e,i=1;i<t.length;i+=1)e=pruneSegmentIntersection(t[i-1],t[i]),t[i-1]=e[0],t[i]=e[1];return t.length>1&&(e=pruneSegmentIntersection(t[t.length-1],t[0]),t[t.length-1]=e[0],t[0]=e[1]),t}function offsetSegmentSplit(t,e){var i,n,r,s,a=t.inflectionPoints();if(0===a.length)return[offsetSegment(t,e)];if(1===a.length||floatEqual(a[1],1))return i=(r=t.split(a[0]))[0],n=r[1],[offsetSegment(i,e),offsetSegment(n,e)];i=(r=t.split(a[0]))[0];var o=(a[1]-a[0])/(1-a[0]);return s=(r=r[1].split(o))[0],n=r[1],[offsetSegment(i,e),offsetSegment(s,e),offsetSegment(n,e)]}function OffsetPathModifier(){}function getFontProperties(t){for(var e=t.fStyle?t.fStyle.split(" "):[],i="normal",n="normal",r=e.length,s=0;s<r;s+=1)switch(e[s].toLowerCase()){case"italic":n="italic";break;case"bold":i="700";break;case"black":i="900";break;case"medium":i="500";break;case"regular":case"normal":i="400";break;case"light":case"thin":i="200"}return{style:n,weight:t.fWeight||i}}extendPrototype([ShapeModifier],RepeaterModifier),RepeaterModifier.prototype.initModifierProperties=function(t,e){this.getValue=this.processKeys,this.c=PropertyFactory.getProp(t,e.c,0,null,this),this.o=PropertyFactory.getProp(t,e.o,0,null,this),this.tr=TransformPropertyFactory.getTransformProperty(t,e.tr,this),this.so=PropertyFactory.getProp(t,e.tr.so,0,.01,this),this.eo=PropertyFactory.getProp(t,e.tr.eo,0,.01,this),this.data=e,this.dynamicProperties.length||this.getValue(!0),this._isAnimated=!!this.dynamicProperties.length,this.pMatrix=new Matrix,this.rMatrix=new Matrix,this.sMatrix=new Matrix,this.tMatrix=new Matrix,this.matrix=new Matrix},RepeaterModifier.prototype.applyTransforms=function(t,e,i,n,r,s){var a=s?-1:1,o=n.s.v[0]+(1-n.s.v[0])*(1-r),l=n.s.v[1]+(1-n.s.v[1])*(1-r);t.translate(n.p.v[0]*a*r,n.p.v[1]*a*r,n.p.v[2]),e.translate(-n.a.v[0],-n.a.v[1],n.a.v[2]),e.rotate(-n.r.v*a*r),e.translate(n.a.v[0],n.a.v[1],n.a.v[2]),i.translate(-n.a.v[0],-n.a.v[1],n.a.v[2]),i.scale(s?1/o:o,s?1/l:l),i.translate(n.a.v[0],n.a.v[1],n.a.v[2])},RepeaterModifier.prototype.init=function(t,e,i,n){for(this.elem=t,this.arr=e,this.pos=i,this.elemsData=n,this._currentCopies=0,this._elements=[],this._groups=[],this.frameId=-1,this.initDynamicPropertyContainer(t),this.initModifierProperties(t,e[i]);i>0;)i-=1,this._elements.unshift(e[i]);this.dynamicProperties.length?this.k=!0:this.getValue(!0)},RepeaterModifier.prototype.resetElements=function(t){var e,i=t.length;for(e=0;e<i;e+=1)t[e]._processed=!1,"gr"===t[e].ty&&this.resetElements(t[e].it)},RepeaterModifier.prototype.cloneElements=function(t){var e=JSON.parse(JSON.stringify(t));return this.resetElements(e),e},RepeaterModifier.prototype.changeGroupRender=function(t,e){var i,n=t.length;for(i=0;i<n;i+=1)t[i]._render=e,"gr"===t[i].ty&&this.changeGroupRender(t[i].it,e)},RepeaterModifier.prototype.processShapes=function(t){var e,i,n,r,s,a=!1;if(this._mdf||t){var o,l=Math.ceil(this.c.v);if(this._groups.length<l){for(;this._groups.length<l;){var h={it:this.cloneElements(this._elements),ty:"gr"};h.it.push({a:{a:0,ix:1,k:[0,0]},nm:"Transform",o:{a:0,ix:7,k:100},p:{a:0,ix:2,k:[0,0]},r:{a:1,ix:6,k:[{s:0,e:0,t:0},{s:0,e:0,t:1}]},s:{a:0,ix:3,k:[100,100]},sa:{a:0,ix:5,k:0},sk:{a:0,ix:4,k:0},ty:"tr"}),this.arr.splice(0,0,h),this._groups.splice(0,0,h),this._currentCopies+=1}this.elem.reloadShapes(),a=!0}for(s=0,n=0;n<=this._groups.length-1;n+=1){if(o=s<l,this._groups[n]._render=o,this.changeGroupRender(this._groups[n].it,o),!o){var c=this.elemsData[n].it,u=c[c.length-1];0!==u.transform.op.v?(u.transform.op._mdf=!0,u.transform.op.v=0):u.transform.op._mdf=!1}s+=1}this._currentCopies=l;var d=this.o.v,p=d%1,f=d>0?Math.floor(d):Math.ceil(d),m=this.pMatrix.props,g=this.rMatrix.props,v=this.sMatrix.props;this.pMatrix.reset(),this.rMatrix.reset(),this.sMatrix.reset(),this.tMatrix.reset(),this.matrix.reset();var y,b,x=0;if(d>0){for(;x<f;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),x+=1;p&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,p,!1),x+=p)}else if(d<0){for(;x>f;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!0),x-=1;p&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,-p,!0),x-=p)}for(n=1===this.data.m?0:this._currentCopies-1,r=1===this.data.m?1:-1,s=this._currentCopies;s;){if(b=(i=(e=this.elemsData[n].it)[e.length-1].transform.mProps.v.props).length,e[e.length-1].transform.mProps._mdf=!0,e[e.length-1].transform.op._mdf=!0,e[e.length-1].transform.op.v=1===this._currentCopies?this.so.v:this.so.v+(this.eo.v-this.so.v)*(n/(this._currentCopies-1)),0!==x){for((0!==n&&1===r||n!==this._currentCopies-1&&-1===r)&&this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),this.matrix.transform(g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],g[8],g[9],g[10],g[11],g[12],g[13],g[14],g[15]),this.matrix.transform(v[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7],v[8],v[9],v[10],v[11],v[12],v[13],v[14],v[15]),this.matrix.transform(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],m[8],m[9],m[10],m[11],m[12],m[13],m[14],m[15]),y=0;y<b;y+=1)i[y]=this.matrix.props[y];this.matrix.reset()}else for(this.matrix.reset(),y=0;y<b;y+=1)i[y]=this.matrix.props[y];x+=1,s-=1,n+=r}}else for(s=this._currentCopies,n=0,r=1;s;)i=(e=this.elemsData[n].it)[e.length-1].transform.mProps.v.props,e[e.length-1].transform.mProps._mdf=!1,e[e.length-1].transform.op._mdf=!1,s-=1,n+=r;return a},RepeaterModifier.prototype.addShape=function(){},extendPrototype([ShapeModifier],RoundCornersModifier),RoundCornersModifier.prototype.initModifierProperties=function(t,e){this.getValue=this.processKeys,this.rd=PropertyFactory.getProp(t,e.r,0,null,this),this._isAnimated=!!this.rd.effectsSequence.length},RoundCornersModifier.prototype.processPath=function(t,e){var i,n=shapePool.newElement();n.c=t.c;var r,s,a,o,l,h,c,u,d,p,f,m,g=t._length,v=0;for(i=0;i<g;i+=1)r=t.v[i],a=t.o[i],s=t.i[i],r[0]===a[0]&&r[1]===a[1]&&r[0]===s[0]&&r[1]===s[1]?0!==i&&i!==g-1||t.c?(o=0===i?t.v[g-1]:t.v[i-1],h=(l=Math.sqrt(Math.pow(r[0]-o[0],2)+Math.pow(r[1]-o[1],2)))?Math.min(l/2,e)/l:0,c=f=r[0]+(o[0]-r[0])*h,u=m=r[1]-(r[1]-o[1])*h,d=c-(c-r[0])*roundCorner,p=u-(u-r[1])*roundCorner,n.setTripleAt(c,u,d,p,f,m,v),v+=1,o=i===g-1?t.v[0]:t.v[i+1],h=(l=Math.sqrt(Math.pow(r[0]-o[0],2)+Math.pow(r[1]-o[1],2)))?Math.min(l/2,e)/l:0,c=d=r[0]+(o[0]-r[0])*h,u=p=r[1]+(o[1]-r[1])*h,f=c-(c-r[0])*roundCorner,m=u-(u-r[1])*roundCorner,n.setTripleAt(c,u,d,p,f,m,v),v+=1):(n.setTripleAt(r[0],r[1],a[0],a[1],s[0],s[1],v),v+=1):(n.setTripleAt(t.v[i][0],t.v[i][1],t.o[i][0],t.o[i][1],t.i[i][0],t.i[i][1],v),v+=1);return n},RoundCornersModifier.prototype.processShapes=function(t){var e,i,n,r,s,a,o=this.shapes.length,l=this.rd.v;if(0!==l)for(i=0;i<o;i+=1){if(a=(s=this.shapes[i]).localShapeCollection,s.shape._mdf||this._mdf||t)for(a.releaseShapes(),s.shape._mdf=!0,e=s.shape.paths.shapes,r=s.shape.paths._length,n=0;n<r;n+=1)a.addShape(this.processPath(e[n],l));s.shape.paths=s.localShapeCollection}this.dynamicProperties.length||(this._mdf=!1)},PolynomialBezier.prototype.point=function(t){return[((this.a[0]*t+this.b[0])*t+this.c[0])*t+this.d[0],((this.a[1]*t+this.b[1])*t+this.c[1])*t+this.d[1]]},PolynomialBezier.prototype.derivative=function(t){return[(3*t*this.a[0]+2*this.b[0])*t+this.c[0],(3*t*this.a[1]+2*this.b[1])*t+this.c[1]]},PolynomialBezier.prototype.tangentAngle=function(t){var e=this.derivative(t);return Math.atan2(e[1],e[0])},PolynomialBezier.prototype.normalAngle=function(t){var e=this.derivative(t);return Math.atan2(e[0],e[1])},PolynomialBezier.prototype.inflectionPoints=function(){var t=this.a[1]*this.b[0]-this.a[0]*this.b[1];if(floatZero(t))return[];var e=-.5*(this.a[1]*this.c[0]-this.a[0]*this.c[1])/t,i=e*e-1/3*(this.b[1]*this.c[0]-this.b[0]*this.c[1])/t;if(i<0)return[];var n=Math.sqrt(i);return floatZero(n)?n>0&&n<1?[e]:[]:[e-n,e+n].filter((function(t){return t>0&&t<1}))},PolynomialBezier.prototype.split=function(t){if(t<=0)return[singlePoint(this.points[0]),this];if(t>=1)return[this,singlePoint(this.points[this.points.length-1])];var e=lerpPoint(this.points[0],this.points[1],t),i=lerpPoint(this.points[1],this.points[2],t),n=lerpPoint(this.points[2],this.points[3],t),r=lerpPoint(e,i,t),s=lerpPoint(i,n,t),a=lerpPoint(r,s,t);return[new PolynomialBezier(this.points[0],e,r,a,!0),new PolynomialBezier(a,s,n,this.points[3],!0)]},PolynomialBezier.prototype.bounds=function(){return{x:extrema(this,0),y:extrema(this,1)}},PolynomialBezier.prototype.boundingBox=function(){var t=this.bounds();return{left:t.x.min,right:t.x.max,top:t.y.min,bottom:t.y.max,width:t.x.max-t.x.min,height:t.y.max-t.y.min,cx:(t.x.max+t.x.min)/2,cy:(t.y.max+t.y.min)/2}},PolynomialBezier.prototype.intersections=function(t,e,i){void 0===e&&(e=2),void 0===i&&(i=7);var n=[];return intersectsImpl(intersectData(this,0,1),intersectData(t,0,1),0,e,n,i),n},PolynomialBezier.shapeSegment=function(t,e){var i=(e+1)%t.length();return new PolynomialBezier(t.v[e],t.o[e],t.i[i],t.v[i],!0)},PolynomialBezier.shapeSegmentInverted=function(t,e){var i=(e+1)%t.length();return new PolynomialBezier(t.v[i],t.i[i],t.o[e],t.v[e],!0)},extendPrototype([ShapeModifier],ZigZagModifier),ZigZagModifier.prototype.initModifierProperties=function(t,e){this.getValue=this.processKeys,this.amplitude=PropertyFactory.getProp(t,e.s,0,null,this),this.frequency=PropertyFactory.getProp(t,e.r,0,null,this),this.pointsType=PropertyFactory.getProp(t,e.pt,0,null,this),this._isAnimated=0!==this.amplitude.effectsSequence.length||0!==this.frequency.effectsSequence.length||0!==this.pointsType.effectsSequence.length},ZigZagModifier.prototype.processPath=function(t,e,i,n){var r=t._length,s=shapePool.newElement();if(s.c=t.c,t.c||(r-=1),0===r)return s;var a=-1,o=PolynomialBezier.shapeSegment(t,0);zigZagCorner(s,t,0,e,i,n,a);for(var l=0;l<r;l+=1)a=zigZagSegment(s,o,e,i,n,-a),o=l!==r-1||t.c?PolynomialBezier.shapeSegment(t,(l+1)%r):null,zigZagCorner(s,t,l+1,e,i,n,a);return s},ZigZagModifier.prototype.processShapes=function(t){var e,i,n,r,s,a,o=this.shapes.length,l=this.amplitude.v,h=Math.max(0,Math.round(this.frequency.v)),c=this.pointsType.v;if(0!==l)for(i=0;i<o;i+=1){if(a=(s=this.shapes[i]).localShapeCollection,s.shape._mdf||this._mdf||t)for(a.releaseShapes(),s.shape._mdf=!0,e=s.shape.paths.shapes,r=s.shape.paths._length,n=0;n<r;n+=1)a.addShape(this.processPath(e[n],l,h,c));s.shape.paths=s.localShapeCollection}this.dynamicProperties.length||(this._mdf=!1)},extendPrototype([ShapeModifier],OffsetPathModifier),OffsetPathModifier.prototype.initModifierProperties=function(t,e){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(t,e.a,0,null,this),this.miterLimit=PropertyFactory.getProp(t,e.ml,0,null,this),this.lineJoin=e.lj,this._isAnimated=0!==this.amount.effectsSequence.length},OffsetPathModifier.prototype.processPath=function(t,e,i,n){var r=shapePool.newElement();r.c=t.c;var s,a,o,l=t.length();t.c||(l-=1);var h=[];for(s=0;s<l;s+=1)o=PolynomialBezier.shapeSegment(t,s),h.push(offsetSegmentSplit(o,e));if(!t.c)for(s=l-1;s>=0;s-=1)o=PolynomialBezier.shapeSegmentInverted(t,s),h.push(offsetSegmentSplit(o,e));h=pruneIntersections(h);var c=null,u=null;for(s=0;s<h.length;s+=1){var d=h[s];for(u&&(c=joinLines(r,u,d[0],i,n)),u=d[d.length-1],a=0;a<d.length;a+=1)o=d[a],c&&pointEqual(o.points[0],c)?r.setXYAt(o.points[1][0],o.points[1][1],"o",r.length()-1):r.setTripleAt(o.points[0][0],o.points[0][1],o.points[1][0],o.points[1][1],o.points[0][0],o.points[0][1],r.length()),r.setTripleAt(o.points[3][0],o.points[3][1],o.points[3][0],o.points[3][1],o.points[2][0],o.points[2][1],r.length()),c=o.points[3]}return h.length&&joinLines(r,u,h[0][0],i,n),r},OffsetPathModifier.prototype.processShapes=function(t){var e,i,n,r,s,a,o=this.shapes.length,l=this.amount.v,h=this.miterLimit.v,c=this.lineJoin;if(0!==l)for(i=0;i<o;i+=1){if(a=(s=this.shapes[i]).localShapeCollection,s.shape._mdf||this._mdf||t)for(a.releaseShapes(),s.shape._mdf=!0,e=s.shape.paths.shapes,r=s.shape.paths._length,n=0;n<r;n+=1)a.addShape(this.processPath(e[n],l,c,h));s.shape.paths=s.localShapeCollection}this.dynamicProperties.length||(this._mdf=!1)};var FontManager=function(){var t={w:0,size:0,shapes:[],data:{shapes:[]}},e=[];e=e.concat([2304,2305,2306,2307,2362,2363,2364,2364,2366,2367,2368,2369,2370,2371,2372,2373,2374,2375,2376,2377,2378,2379,2380,2381,2382,2383,2387,2388,2389,2390,2391,2402,2403]);var i=127988,n=["d83cdffb","d83cdffc","d83cdffd","d83cdffe","d83cdfff"];function r(t,e){var i=createTag("span");i.setAttribute("aria-hidden",!0),i.style.fontFamily=e;var n=createTag("span");n.innerText="giItT1WQy@!-/#",i.style.position="absolute",i.style.left="-10000px",i.style.top="-10000px",i.style.fontSize="300px",i.style.fontVariant="normal",i.style.fontStyle="normal",i.style.fontWeight="normal",i.style.letterSpacing="0",i.appendChild(n),document.body.appendChild(i);var r=n.offsetWidth;return n.style.fontFamily=function(t){var e,i=t.split(","),n=i.length,r=[];for(e=0;e<n;e+=1)"sans-serif"!==i[e]&&"monospace"!==i[e]&&r.push(i[e]);return r.join(",")}(t)+", "+e,{node:n,w:r,parent:i}}function s(t,e){var i,n=document.body&&e?"svg":"canvas",r=getFontProperties(t);if("svg"===n){var s=createNS("text");s.style.fontSize="100px",s.setAttribute("font-family",t.fFamily),s.setAttribute("font-style",r.style),s.setAttribute("font-weight",r.weight),s.textContent="1",t.fClass?(s.style.fontFamily="inherit",s.setAttribute("class",t.fClass)):s.style.fontFamily=t.fFamily,e.appendChild(s),i=s}else{var a=new OffscreenCanvas(500,500).getContext("2d");a.font=r.style+" "+r.weight+" 100px "+t.fFamily,i=a}return{measureText:function(t){return"svg"===n?(i.textContent=t,i.getComputedTextLength()):i.measureText(t).width}}}function a(t){var e=0,i=t.charCodeAt(0);if(i>=55296&&i<=56319){var n=t.charCodeAt(1);n>=56320&&n<=57343&&(e=1024*(i-55296)+n-56320+65536)}return e}function o(t){var e=a(t);return e>=127462&&e<=127487}var l=function(){this.fonts=[],this.chars=null,this.typekitLoaded=0,this.isLoaded=!1,this._warned=!1,this.initTime=Date.now(),this.setIsLoadedBinded=this.setIsLoaded.bind(this),this.checkLoadedFontsBinded=this.checkLoadedFonts.bind(this)};l.isModifier=function(t,e){var i=t.toString(16)+e.toString(16);return-1!==n.indexOf(i)},l.isZeroWidthJoiner=function(t){return 8205===t},l.isFlagEmoji=function(t){return o(t.substr(0,2))&&o(t.substr(2,2))},l.isRegionalCode=o,l.isCombinedCharacter=function(t){return-1!==e.indexOf(t)},l.isRegionalFlag=function(t,e){var n=a(t.substr(e,2));if(n!==i)return!1;var r=0;for(e+=2;r<5;){if((n=a(t.substr(e,2)))<917601||n>917626)return!1;r+=1,e+=2}return 917631===a(t.substr(e,2))},l.isVariationSelector=function(t){return 65039===t},l.BLACK_FLAG_CODE_POINT=i;var h={addChars:function(t){if(t){var e;this.chars||(this.chars=[]);var i,n,r=t.length,s=this.chars.length;for(e=0;e<r;e+=1){for(i=0,n=!1;i<s;)this.chars[i].style===t[e].style&&this.chars[i].fFamily===t[e].fFamily&&this.chars[i].ch===t[e].ch&&(n=!0),i+=1;n||(this.chars.push(t[e]),s+=1)}}},addFonts:function(t,e){if(t){if(this.chars)return this.isLoaded=!0,void(this.fonts=t.list);if(!document.body)return this.isLoaded=!0,t.list.forEach((function(t){t.helper=s(t),t.cache={}})),void(this.fonts=t.list);var i,n=t.list,a=n.length,o=a;for(i=0;i<a;i+=1){var l,h,c=!0;if(n[i].loaded=!1,n[i].monoCase=r(n[i].fFamily,"monospace"),n[i].sansCase=r(n[i].fFamily,"sans-serif"),n[i].fPath){if("p"===n[i].fOrigin||3===n[i].origin){if((l=document.querySelectorAll('style[f-forigin="p"][f-family="'+n[i].fFamily+'"], style[f-origin="3"][f-family="'+n[i].fFamily+'"]')).length>0&&(c=!1),c){var u=createTag("style");u.setAttribute("f-forigin",n[i].fOrigin),u.setAttribute("f-origin",n[i].origin),u.setAttribute("f-family",n[i].fFamily),u.type="text/css",u.innerText="@font-face {font-family: "+n[i].fFamily+"; font-style: normal; src: url('"+n[i].fPath+"');}",e.appendChild(u)}}else if("g"===n[i].fOrigin||1===n[i].origin){for(l=document.querySelectorAll('link[f-forigin="g"], link[f-origin="1"]'),h=0;h<l.length;h+=1)-1!==l[h].href.indexOf(n[i].fPath)&&(c=!1);if(c){var d=createTag("link");d.setAttribute("f-forigin",n[i].fOrigin),d.setAttribute("f-origin",n[i].origin),d.type="text/css",d.rel="stylesheet",d.href=n[i].fPath,document.body.appendChild(d)}}else if("t"===n[i].fOrigin||2===n[i].origin){for(l=document.querySelectorAll('script[f-forigin="t"], script[f-origin="2"]'),h=0;h<l.length;h+=1)n[i].fPath===l[h].src&&(c=!1);if(c){var p=createTag("link");p.setAttribute("f-forigin",n[i].fOrigin),p.setAttribute("f-origin",n[i].origin),p.setAttribute("rel","stylesheet"),p.setAttribute("href",n[i].fPath),e.appendChild(p)}}}else n[i].loaded=!0,o-=1;n[i].helper=s(n[i],e),n[i].cache={},this.fonts.push(n[i])}0===o?this.isLoaded=!0:setTimeout(this.checkLoadedFonts.bind(this),100)}else this.isLoaded=!0},getCharData:function(e,i,n){for(var r=0,s=this.chars.length;r<s;){if(this.chars[r].ch===e&&this.chars[r].style===i&&this.chars[r].fFamily===n)return this.chars[r];r+=1}return("string"===typeof e&&13!==e.charCodeAt(0)||!e)&&console&&console.warn&&!this._warned&&(this._warned=!0,console.warn("Missing character from exported characters list: ",e,i,n)),t},getFontByName:function(t){for(var e=0,i=this.fonts.length;e<i;){if(this.fonts[e].fName===t)return this.fonts[e];e+=1}return this.fonts[0]},measureText:function(t,e,i){var n=this.getFontByName(e),r=t;if(!n.cache[r]){var s=n.helper;if(" "===t){var a=s.measureText("|"+t+"|"),o=s.measureText("||");n.cache[r]=(a-o)/100}else n.cache[r]=s.measureText(t)/100}return n.cache[r]*i},checkLoadedFonts:function(){var t,e,i,n=this.fonts.length,r=n;for(t=0;t<n;t+=1)this.fonts[t].loaded?r-=1:"n"===this.fonts[t].fOrigin||0===this.fonts[t].origin?this.fonts[t].loaded=!0:(e=this.fonts[t].monoCase.node,i=this.fonts[t].monoCase.w,e.offsetWidth!==i?(r-=1,this.fonts[t].loaded=!0):(e=this.fonts[t].sansCase.node,i=this.fonts[t].sansCase.w,e.offsetWidth!==i&&(r-=1,this.fonts[t].loaded=!0)),this.fonts[t].loaded&&(this.fonts[t].sansCase.parent.parentNode.removeChild(this.fonts[t].sansCase.parent),this.fonts[t].monoCase.parent.parentNode.removeChild(this.fonts[t].monoCase.parent)));0!==r&&Date.now()-this.initTime<5e3?setTimeout(this.checkLoadedFontsBinded,20):setTimeout(this.setIsLoadedBinded,10)},setIsLoaded:function(){this.isLoaded=!0}};return l.prototype=h,l}();function SlotManager(t){this.animationData=t}function slotFactory(t){return new SlotManager(t)}function RenderableElement(){}SlotManager.prototype.getProp=function(t){return this.animationData.slots&&this.animationData.slots[t.sid]?Object.assign(t,this.animationData.slots[t.sid].p):t},RenderableElement.prototype={initRenderable:function(){this.isInRange=!1,this.hidden=!1,this.isTransparent=!1,this.renderableComponents=[]},addRenderableComponent:function(t){-1===this.renderableComponents.indexOf(t)&&this.renderableComponents.push(t)},removeRenderableComponent:function(t){-1!==this.renderableComponents.indexOf(t)&&this.renderableComponents.splice(this.renderableComponents.indexOf(t),1)},prepareRenderableFrame:function(t){this.checkLayerLimits(t)},checkTransparency:function(){this.finalTransform.mProp.o.v<=0?!this.isTransparent&&this.globalData.renderConfig.hideOnTransparent&&(this.isTransparent=!0,this.hide()):this.isTransparent&&(this.isTransparent=!1,this.show())},checkLayerLimits:function(t){this.data.ip-this.data.st<=t&&this.data.op-this.data.st>t?!0!==this.isInRange&&(this.globalData._mdf=!0,this._mdf=!0,this.isInRange=!0,this.show()):!1!==this.isInRange&&(this.globalData._mdf=!0,this.isInRange=!1,this.hide())},renderRenderable:function(){var t,e=this.renderableComponents.length;for(t=0;t<e;t+=1)this.renderableComponents[t].renderFrame(this._isFirstFrame)},sourceRectAtTime:function(){return{top:0,left:0,width:100,height:100}},getLayerSize:function(){return 5===this.data.ty?{w:this.data.textData.width,h:this.data.textData.height}:{w:this.data.width,h:this.data.height}}};var getBlendMode=function(){var t={0:"source-over",1:"multiply",2:"screen",3:"overlay",4:"darken",5:"lighten",6:"color-dodge",7:"color-burn",8:"hard-light",9:"soft-light",10:"difference",11:"exclusion",12:"hue",13:"saturation",14:"color",15:"luminosity"};return function(e){return t[e]||""}}();function SliderEffect(t,e,i){this.p=PropertyFactory.getProp(e,t.v,0,0,i)}function AngleEffect(t,e,i){this.p=PropertyFactory.getProp(e,t.v,0,0,i)}function ColorEffect(t,e,i){this.p=PropertyFactory.getProp(e,t.v,1,0,i)}function PointEffect(t,e,i){this.p=PropertyFactory.getProp(e,t.v,1,0,i)}function LayerIndexEffect(t,e,i){this.p=PropertyFactory.getProp(e,t.v,0,0,i)}function MaskIndexEffect(t,e,i){this.p=PropertyFactory.getProp(e,t.v,0,0,i)}function CheckboxEffect(t,e,i){this.p=PropertyFactory.getProp(e,t.v,0,0,i)}function NoValueEffect(){this.p={}}function EffectsManager(t,e){var i,n=t.ef||[];this.effectElements=[];var r,s=n.length;for(i=0;i<s;i+=1)r=new GroupEffect(n[i],e),this.effectElements.push(r)}function GroupEffect(t,e){this.init(t,e)}function BaseElement(){}function FrameElement(){}function FootageElement(t,e,i){this.initFrame(),this.initRenderable(),this.assetData=e.getAssetData(t.refId),this.footageData=e.imageLoader.getAsset(this.assetData),this.initBaseData(t,e,i)}function AudioElement(t,e,i){this.initFrame(),this.initRenderable(),this.assetData=e.getAssetData(t.refId),this.initBaseData(t,e,i),this._isPlaying=!1,this._canPlay=!1;var n=this.globalData.getAssetsPath(this.assetData);this.audio=this.globalData.audioController.createAudio(n),this._currentTime=0,this.globalData.audioController.addAudio(this),this._volumeMultiplier=1,this._volume=1,this._previousVolume=null,this.tm=t.tm?PropertyFactory.getProp(this,t.tm,0,e.frameRate,this):{_placeholder:!0},this.lv=PropertyFactory.getProp(this,t.au&&t.au.lv?t.au.lv:{k:[100]},1,.01,this)}function BaseRenderer(){}extendPrototype([DynamicPropertyContainer],GroupEffect),GroupEffect.prototype.getValue=GroupEffect.prototype.iterateDynamicProperties,GroupEffect.prototype.init=function(t,e){var i;this.data=t,this.effectElements=[],this.initDynamicPropertyContainer(e);var n,r=this.data.ef.length,s=this.data.ef;for(i=0;i<r;i+=1){switch(n=null,s[i].ty){case 0:n=new SliderEffect(s[i],e,this);break;case 1:n=new AngleEffect(s[i],e,this);break;case 2:n=new ColorEffect(s[i],e,this);break;case 3:n=new PointEffect(s[i],e,this);break;case 4:case 7:n=new CheckboxEffect(s[i],e,this);break;case 10:n=new LayerIndexEffect(s[i],e,this);break;case 11:n=new MaskIndexEffect(s[i],e,this);break;case 5:n=new EffectsManager(s[i],e,this);break;default:n=new NoValueEffect(s[i],e,this)}n&&this.effectElements.push(n)}},BaseElement.prototype={checkMasks:function(){if(!this.data.hasMask)return!1;for(var t=0,e=this.data.masksProperties.length;t<e;){if("n"!==this.data.masksProperties[t].mode&&!1!==this.data.masksProperties[t].cl)return!0;t+=1}return!1},initExpressions:function(){var t=getExpressionInterfaces();if(t){var e=t("layer"),i=t("effects"),n=t("shape"),r=t("text"),s=t("comp");this.layerInterface=e(this),this.data.hasMask&&this.maskManager&&this.layerInterface.registerMaskInterface(this.maskManager);var a=i.createEffectsInterface(this,this.layerInterface);this.layerInterface.registerEffectsInterface(a),0===this.data.ty||this.data.xt?this.compInterface=s(this):4===this.data.ty?(this.layerInterface.shapeInterface=n(this.shapesData,this.itemsData,this.layerInterface),this.layerInterface.content=this.layerInterface.shapeInterface):5===this.data.ty&&(this.layerInterface.textInterface=r(this),this.layerInterface.text=this.layerInterface.textInterface)}},setBlendMode:function(){var t=getBlendMode(this.data.bm);(this.baseElement||this.layerElement).style["mix-blend-mode"]=t},initBaseData:function(t,e,i){this.globalData=e,this.comp=i,this.data=t,this.layerId=createElementID(),this.data.sr||(this.data.sr=1),this.effectsManager=new EffectsManager(this.data,this,this.dynamicProperties)},getType:function(){return this.type},sourceRectAtTime:function(){}},FrameElement.prototype={initFrame:function(){this._isFirstFrame=!1,this.dynamicProperties=[],this._mdf=!1},prepareProperties:function(t,e){var i,n=this.dynamicProperties.length;for(i=0;i<n;i+=1)(e||this._isParent&&"transform"===this.dynamicProperties[i].propType)&&(this.dynamicProperties[i].getValue(),this.dynamicProperties[i]._mdf&&(this.globalData._mdf=!0,this._mdf=!0))},addDynamicProperty:function(t){-1===this.dynamicProperties.indexOf(t)&&this.dynamicProperties.push(t)}},FootageElement.prototype.prepareFrame=function(){},extendPrototype([RenderableElement,BaseElement,FrameElement],FootageElement),FootageElement.prototype.getBaseElement=function(){return null},FootageElement.prototype.renderFrame=function(){},FootageElement.prototype.destroy=function(){},FootageElement.prototype.initExpressions=function(){var t=getExpressionInterfaces();if(t){var e=t("footage");this.layerInterface=e(this)}},FootageElement.prototype.getFootageData=function(){return this.footageData},AudioElement.prototype.prepareFrame=function(t){if(this.prepareRenderableFrame(t,!0),this.prepareProperties(t,!0),this.tm._placeholder)this._currentTime=t/this.data.sr;else{var e=this.tm.v;this._currentTime=e}this._volume=this.lv.v[0];var i=this._volume*this._volumeMultiplier;this._previousVolume!==i&&(this._previousVolume=i,this.audio.volume(i))},extendPrototype([RenderableElement,BaseElement,FrameElement],AudioElement),AudioElement.prototype.renderFrame=function(){this.isInRange&&this._canPlay&&(this._isPlaying?(!this.audio.playing()||Math.abs(this._currentTime/this.globalData.frameRate-this.audio.seek())>.1)&&this.audio.seek(this._currentTime/this.globalData.frameRate):(this.audio.play(),this.audio.seek(this._currentTime/this.globalData.frameRate),this._isPlaying=!0))},AudioElement.prototype.show=function(){},AudioElement.prototype.hide=function(){this.audio.pause(),this._isPlaying=!1},AudioElement.prototype.pause=function(){this.audio.pause(),this._isPlaying=!1,this._canPlay=!1},AudioElement.prototype.resume=function(){this._canPlay=!0},AudioElement.prototype.setRate=function(t){this.audio.rate(t)},AudioElement.prototype.volume=function(t){this._volumeMultiplier=t,this._previousVolume=t*this._volume,this.audio.volume(this._previousVolume)},AudioElement.prototype.getBaseElement=function(){return null},AudioElement.prototype.destroy=function(){},AudioElement.prototype.sourceRectAtTime=function(){},AudioElement.prototype.initExpressions=function(){},BaseRenderer.prototype.checkLayers=function(t){var e,i,n=this.layers.length;for(this.completeLayers=!0,e=n-1;e>=0;e-=1)this.elements[e]||(i=this.layers[e]).ip-i.st<=t-this.layers[e].st&&i.op-i.st>t-this.layers[e].st&&this.buildItem(e),this.completeLayers=!!this.elements[e]&&this.completeLayers;this.checkPendingElements()},BaseRenderer.prototype.createItem=function(t){switch(t.ty){case 2:return this.createImage(t);case 0:return this.createComp(t);case 1:return this.createSolid(t);case 3:default:return this.createNull(t);case 4:return this.createShape(t);case 5:return this.createText(t);case 6:return this.createAudio(t);case 13:return this.createCamera(t);case 15:return this.createFootage(t)}},BaseRenderer.prototype.createCamera=function(){throw new Error("You're using a 3d camera. Try the html renderer.")},BaseRenderer.prototype.createAudio=function(t){return new AudioElement(t,this.globalData,this)},BaseRenderer.prototype.createFootage=function(t){return new FootageElement(t,this.globalData,this)},BaseRenderer.prototype.buildAllItems=function(){var t,e=this.layers.length;for(t=0;t<e;t+=1)this.buildItem(t);this.checkPendingElements()},BaseRenderer.prototype.includeLayers=function(t){var e;this.completeLayers=!1;var i,n=t.length,r=this.layers.length;for(e=0;e<n;e+=1)for(i=0;i<r;){if(this.layers[i].id===t[e].id){this.layers[i]=t[e];break}i+=1}},BaseRenderer.prototype.setProjectInterface=function(t){this.globalData.projectInterface=t},BaseRenderer.prototype.initItems=function(){this.globalData.progressiveLoad||this.buildAllItems()},BaseRenderer.prototype.buildElementParenting=function(t,e,i){for(var n=this.elements,r=this.layers,s=0,a=r.length;s<a;)r[s].ind==e&&(n[s]&&!0!==n[s]?(i.push(n[s]),n[s].setAsParent(),void 0!==r[s].parent?this.buildElementParenting(t,r[s].parent,i):t.setHierarchy(i)):(this.buildItem(s),this.addPendingElement(t))),s+=1},BaseRenderer.prototype.addPendingElement=function(t){this.pendingElements.push(t)},BaseRenderer.prototype.searchExtraCompositions=function(t){var e,i=t.length;for(e=0;e<i;e+=1)if(t[e].xt){var n=this.createComp(t[e]);n.initExpressions(),this.globalData.projectInterface.registerComposition(n)}},BaseRenderer.prototype.getElementById=function(t){var e,i=this.elements.length;for(e=0;e<i;e+=1)if(this.elements[e].data.ind===t)return this.elements[e];return null},BaseRenderer.prototype.getElementByPath=function(t){var e,i=t.shift();if("number"===typeof i)e=this.elements[i];else{var n,r=this.elements.length;for(n=0;n<r;n+=1)if(this.elements[n].data.nm===i){e=this.elements[n];break}}return 0===t.length?e:e.getElementByPath(t)},BaseRenderer.prototype.setupGlobalData=function(t,e){this.globalData.fontManager=new FontManager,this.globalData.slotManager=slotFactory(t),this.globalData.fontManager.addChars(t.chars),this.globalData.fontManager.addFonts(t.fonts,e),this.globalData.getAssetData=this.animationItem.getAssetData.bind(this.animationItem),this.globalData.getAssetsPath=this.animationItem.getAssetsPath.bind(this.animationItem),this.globalData.imageLoader=this.animationItem.imagePreloader,this.globalData.audioController=this.animationItem.audioController,this.globalData.frameId=0,this.globalData.frameRate=t.fr,this.globalData.nm=t.nm,this.globalData.compSize={w:t.w,h:t.h}};var effectTypes={TRANSFORM_EFFECT:"transformEFfect"};function TransformElement(){}function MaskElement(t,e,i){this.data=t,this.element=e,this.globalData=i,this.storedData=[],this.masksProperties=this.data.masksProperties||[],this.maskElement=null;var n,r,s=this.globalData.defs,a=this.masksProperties?this.masksProperties.length:0;this.viewData=createSizedArray(a),this.solidPath="";var o,l,h,c,u,d,p=this.masksProperties,f=0,m=[],g=createElementID(),v="clipPath",y="clip-path";for(n=0;n<a;n+=1)if(("a"!==p[n].mode&&"n"!==p[n].mode||p[n].inv||100!==p[n].o.k||p[n].o.x)&&(v="mask",y="mask"),"s"!==p[n].mode&&"i"!==p[n].mode||0!==f?h=null:((h=createNS("rect")).setAttribute("fill","#ffffff"),h.setAttribute("width",this.element.comp.data.w||0),h.setAttribute("height",this.element.comp.data.h||0),m.push(h)),r=createNS("path"),"n"===p[n].mode)this.viewData[n]={op:PropertyFactory.getProp(this.element,p[n].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,p[n],3),elem:r,lastPath:""},s.appendChild(r);else{var b;if(f+=1,r.setAttribute("fill","s"===p[n].mode?"#000000":"#ffffff"),r.setAttribute("clip-rule","nonzero"),0!==p[n].x.k?(v="mask",y="mask",d=PropertyFactory.getProp(this.element,p[n].x,0,null,this.element),b=createElementID(),(c=createNS("filter")).setAttribute("id",b),(u=createNS("feMorphology")).setAttribute("operator","erode"),u.setAttribute("in","SourceGraphic"),u.setAttribute("radius","0"),c.appendChild(u),s.appendChild(c),r.setAttribute("stroke","s"===p[n].mode?"#000000":"#ffffff")):(u=null,d=null),this.storedData[n]={elem:r,x:d,expan:u,lastPath:"",lastOperator:"",filterId:b,lastRadius:0},"i"===p[n].mode){l=m.length;var x=createNS("g");for(o=0;o<l;o+=1)x.appendChild(m[o]);var w=createNS("mask");w.setAttribute("mask-type","alpha"),w.setAttribute("id",g+"_"+f),w.appendChild(r),s.appendChild(w),x.setAttribute("mask","url("+getLocationHref()+"#"+g+"_"+f+")"),m.length=0,m.push(x)}else m.push(r);p[n].inv&&!this.solidPath&&(this.solidPath=this.createLayerSolidPath()),this.viewData[n]={elem:r,lastPath:"",op:PropertyFactory.getProp(this.element,p[n].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,p[n],3),invRect:h},this.viewData[n].prop.k||this.drawPath(p[n],this.viewData[n].prop.v,this.viewData[n])}for(this.maskElement=createNS(v),a=m.length,n=0;n<a;n+=1)this.maskElement.appendChild(m[n]);f>0&&(this.maskElement.setAttribute("id",g),this.element.maskedElement.setAttribute(y,"url("+getLocationHref()+"#"+g+")"),s.appendChild(this.maskElement)),this.viewData.length&&this.element.addRenderableComponent(this)}TransformElement.prototype={initTransform:function(){var t=new Matrix;this.finalTransform={mProp:this.data.ks?TransformPropertyFactory.getTransformProperty(this,this.data.ks,this):{o:0},_matMdf:!1,_localMatMdf:!1,_opMdf:!1,mat:t,localMat:t,localOpacity:1},this.data.ao&&(this.finalTransform.mProp.autoOriented=!0),this.data.ty},renderTransform:function(){if(this.finalTransform._opMdf=this.finalTransform.mProp.o._mdf||this._isFirstFrame,this.finalTransform._matMdf=this.finalTransform.mProp._mdf||this._isFirstFrame,this.hierarchy){var t,e=this.finalTransform.mat,i=0,n=this.hierarchy.length;if(!this.finalTransform._matMdf)for(;i<n;){if(this.hierarchy[i].finalTransform.mProp._mdf){this.finalTransform._matMdf=!0;break}i+=1}if(this.finalTransform._matMdf)for(t=this.finalTransform.mProp.v.props,e.cloneFromProps(t),i=0;i<n;i+=1)e.multiply(this.hierarchy[i].finalTransform.mProp.v)}this.finalTransform._matMdf&&(this.finalTransform._localMatMdf=this.finalTransform._matMdf),this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v)},renderLocalTransform:function(){if(this.localTransforms){var t=0,e=this.localTransforms.length;if(this.finalTransform._localMatMdf=this.finalTransform._matMdf,!this.finalTransform._localMatMdf||!this.finalTransform._opMdf)for(;t<e;)this.localTransforms[t]._mdf&&(this.finalTransform._localMatMdf=!0),this.localTransforms[t]._opMdf&&!this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v,this.finalTransform._opMdf=!0),t+=1;if(this.finalTransform._localMatMdf){var i=this.finalTransform.localMat;for(this.localTransforms[0].matrix.clone(i),t=1;t<e;t+=1){var n=this.localTransforms[t].matrix;i.multiply(n)}i.multiply(this.finalTransform.mat)}if(this.finalTransform._opMdf){var r=this.finalTransform.localOpacity;for(t=0;t<e;t+=1)r*=.01*this.localTransforms[t].opacity;this.finalTransform.localOpacity=r}}},searchEffectTransforms:function(){if(this.renderableEffectsManager){var t=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT);if(t.length){this.localTransforms=[],this.finalTransform.localMat=new Matrix;var e=0,i=t.length;for(e=0;e<i;e+=1)this.localTransforms.push(t[e])}}},globalToLocal:function(t){var e=[];e.push(this.finalTransform);for(var i,n=!0,r=this.comp;n;)r.finalTransform?(r.data.hasMask&&e.splice(0,0,r.finalTransform),r=r.comp):n=!1;var s,a=e.length;for(i=0;i<a;i+=1)s=e[i].mat.applyToPointArray(0,0,0),t=[t[0]-s[0],t[1]-s[1],0];return t},mHelper:new Matrix},MaskElement.prototype.getMaskProperty=function(t){return this.viewData[t].prop},MaskElement.prototype.renderFrame=function(t){var e,i=this.element.finalTransform.mat,n=this.masksProperties.length;for(e=0;e<n;e+=1)if((this.viewData[e].prop._mdf||t)&&this.drawPath(this.masksProperties[e],this.viewData[e].prop.v,this.viewData[e]),(this.viewData[e].op._mdf||t)&&this.viewData[e].elem.setAttribute("fill-opacity",this.viewData[e].op.v),"n"!==this.masksProperties[e].mode&&(this.viewData[e].invRect&&(this.element.finalTransform.mProp._mdf||t)&&this.viewData[e].invRect.setAttribute("transform",i.getInverseMatrix().to2dCSS()),this.storedData[e].x&&(this.storedData[e].x._mdf||t))){var r=this.storedData[e].expan;this.storedData[e].x.v<0?("erode"!==this.storedData[e].lastOperator&&(this.storedData[e].lastOperator="erode",this.storedData[e].elem.setAttribute("filter","url("+getLocationHref()+"#"+this.storedData[e].filterId+")")),r.setAttribute("radius",-this.storedData[e].x.v)):("dilate"!==this.storedData[e].lastOperator&&(this.storedData[e].lastOperator="dilate",this.storedData[e].elem.setAttribute("filter",null)),this.storedData[e].elem.setAttribute("stroke-width",2*this.storedData[e].x.v))}},MaskElement.prototype.getMaskelement=function(){return this.maskElement},MaskElement.prototype.createLayerSolidPath=function(){var t="M0,0 ";return t+=" h"+this.globalData.compSize.w,t+=" v"+this.globalData.compSize.h,t+=" h-"+this.globalData.compSize.w,t+=" v-"+this.globalData.compSize.h+" "},MaskElement.prototype.drawPath=function(t,e,i){var n,r,s=" M"+e.v[0][0]+","+e.v[0][1];for(r=e._length,n=1;n<r;n+=1)s+=" C"+e.o[n-1][0]+","+e.o[n-1][1]+" "+e.i[n][0]+","+e.i[n][1]+" "+e.v[n][0]+","+e.v[n][1];if(e.c&&r>1&&(s+=" C"+e.o[n-1][0]+","+e.o[n-1][1]+" "+e.i[0][0]+","+e.i[0][1]+" "+e.v[0][0]+","+e.v[0][1]),i.lastPath!==s){var a="";i.elem&&(e.c&&(a=t.inv?this.solidPath+s:s),i.elem.setAttribute("d",a)),i.lastPath=s}},MaskElement.prototype.destroy=function(){this.element=null,this.globalData=null,this.maskElement=null,this.data=null,this.masksProperties=null};var filtersFactory=function(){var t={createFilter:function(t,e){var i=createNS("filter");return i.setAttribute("id",t),!0!==e&&(i.setAttribute("filterUnits","objectBoundingBox"),i.setAttribute("x","0%"),i.setAttribute("y","0%"),i.setAttribute("width","100%"),i.setAttribute("height","100%")),i},createAlphaToLuminanceFilter:function(){var t=createNS("feColorMatrix");return t.setAttribute("type","matrix"),t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("values","0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 1"),t}};return t}(),featureSupport=function(){var t={maskType:!0,svgLumaHidden:!0,offscreenCanvas:"undefined"!==typeof OffscreenCanvas};return(/MSIE 10/i.test(navigator.userAgent)||/MSIE 9/i.test(navigator.userAgent)||/rv:11.0/i.test(navigator.userAgent)||/Edge\/\d./i.test(navigator.userAgent))&&(t.maskType=!1),/firefox/i.test(navigator.userAgent)&&(t.svgLumaHidden=!1),t}(),registeredEffects$1={},idPrefix="filter_result_";function SVGEffects(t){var e,i,n="SourceGraphic",r=t.data.ef?t.data.ef.length:0,s=createElementID(),a=filtersFactory.createFilter(s,!0),o=0;for(this.filters=[],e=0;e<r;e+=1){i=null;var l=t.data.ef[e].ty;registeredEffects$1[l]&&(i=new(0,registeredEffects$1[l].effect)(a,t.effectsManager.effectElements[e],t,idPrefix+o,n),n=idPrefix+o,registeredEffects$1[l].countsAsEffect&&(o+=1)),i&&this.filters.push(i)}o&&(t.globalData.defs.appendChild(a),t.layerElement.setAttribute("filter","url("+getLocationHref()+"#"+s+")")),this.filters.length&&t.addRenderableComponent(this)}function registerEffect$1(t,e,i){registeredEffects$1[t]={effect:e,countsAsEffect:i}}function SVGBaseElement(){}function HierarchyElement(){}function RenderableDOMElement(){}function IImageElement(t,e,i){this.assetData=e.getAssetData(t.refId),this.assetData&&this.assetData.sid&&(this.assetData=e.slotManager.getProp(this.assetData)),this.initElement(t,e,i),this.sourceRect={top:0,left:0,width:this.assetData.w,height:this.assetData.h}}function ProcessedElement(t,e){this.elem=t,this.pos=e}function IShapeElement(){}SVGEffects.prototype.renderFrame=function(t){var e,i=this.filters.length;for(e=0;e<i;e+=1)this.filters[e].renderFrame(t)},SVGEffects.prototype.getEffects=function(t){var e,i=this.filters.length,n=[];for(e=0;e<i;e+=1)this.filters[e].type===t&&n.push(this.filters[e]);return n},SVGBaseElement.prototype={initRendererElement:function(){this.layerElement=createNS("g")},createContainerElements:function(){this.matteElement=createNS("g"),this.transformedElement=this.layerElement,this.maskedElement=this.layerElement,this._sizeChanged=!1;var t=null;if(this.data.td){this.matteMasks={};var e=createNS("g");e.setAttribute("id",this.layerId),e.appendChild(this.layerElement),t=e,this.globalData.defs.appendChild(e)}else this.data.tt?(this.matteElement.appendChild(this.layerElement),t=this.matteElement,this.baseElement=this.matteElement):this.baseElement=this.layerElement;if(this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),0===this.data.ty&&!this.data.hd){var i=createNS("clipPath"),n=createNS("path");n.setAttribute("d","M0,0 L"+this.data.w+",0 L"+this.data.w+","+this.data.h+" L0,"+this.data.h+"z");var r=createElementID();if(i.setAttribute("id",r),i.appendChild(n),this.globalData.defs.appendChild(i),this.checkMasks()){var s=createNS("g");s.setAttribute("clip-path","url("+getLocationHref()+"#"+r+")"),s.appendChild(this.layerElement),this.transformedElement=s,t?t.appendChild(this.transformedElement):this.baseElement=this.transformedElement}else this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+r+")")}0!==this.data.bm&&this.setBlendMode()},renderElement:function(){this.finalTransform._localMatMdf&&this.transformedElement.setAttribute("transform",this.finalTransform.localMat.to2dCSS()),this.finalTransform._opMdf&&this.transformedElement.setAttribute("opacity",this.finalTransform.localOpacity)},destroyBaseElement:function(){this.layerElement=null,this.matteElement=null,this.maskManager.destroy()},getBaseElement:function(){return this.data.hd?null:this.baseElement},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData),this.renderableEffectsManager=new SVGEffects(this),this.searchEffectTransforms()},getMatte:function(t){if(this.matteMasks||(this.matteMasks={}),!this.matteMasks[t]){var e,i,n,r,s=this.layerId+"_"+t;if(1===t||3===t){var a=createNS("mask");a.setAttribute("id",s),a.setAttribute("mask-type",3===t?"luminance":"alpha"),(n=createNS("use")).setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),a.appendChild(n),this.globalData.defs.appendChild(a),featureSupport.maskType||1!==t||(a.setAttribute("mask-type","luminance"),e=createElementID(),i=filtersFactory.createFilter(e),this.globalData.defs.appendChild(i),i.appendChild(filtersFactory.createAlphaToLuminanceFilter()),(r=createNS("g")).appendChild(n),a.appendChild(r),r.setAttribute("filter","url("+getLocationHref()+"#"+e+")"))}else if(2===t){var o=createNS("mask");o.setAttribute("id",s),o.setAttribute("mask-type","alpha");var l=createNS("g");o.appendChild(l),e=createElementID(),i=filtersFactory.createFilter(e);var h=createNS("feComponentTransfer");h.setAttribute("in","SourceGraphic"),i.appendChild(h);var c=createNS("feFuncA");c.setAttribute("type","table"),c.setAttribute("tableValues","1.0 0.0"),h.appendChild(c),this.globalData.defs.appendChild(i);var u=createNS("rect");u.setAttribute("width",this.comp.data.w),u.setAttribute("height",this.comp.data.h),u.setAttribute("x","0"),u.setAttribute("y","0"),u.setAttribute("fill","#ffffff"),u.setAttribute("opacity","0"),l.setAttribute("filter","url("+getLocationHref()+"#"+e+")"),l.appendChild(u),(n=createNS("use")).setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),l.appendChild(n),featureSupport.maskType||(o.setAttribute("mask-type","luminance"),i.appendChild(filtersFactory.createAlphaToLuminanceFilter()),r=createNS("g"),l.appendChild(u),r.appendChild(this.layerElement),l.appendChild(r)),this.globalData.defs.appendChild(o)}this.matteMasks[t]=s}return this.matteMasks[t]},setMatte:function(t){this.matteElement&&this.matteElement.setAttribute("mask","url("+getLocationHref()+"#"+t+")")}},HierarchyElement.prototype={initHierarchy:function(){this.hierarchy=[],this._isParent=!1,this.checkParenting()},setHierarchy:function(t){this.hierarchy=t},setAsParent:function(){this._isParent=!0},checkParenting:function(){void 0!==this.data.parent&&this.comp.buildElementParenting(this,this.data.parent,[])}},extendPrototype([RenderableElement,createProxyFunction({initElement:function(t,e,i){this.initFrame(),this.initBaseData(t,e,i),this.initTransform(t,e,i),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide()},hide:function(){this.hidden||this.isInRange&&!this.isTransparent||((this.baseElement||this.layerElement).style.display="none",this.hidden=!0)},show:function(){this.isInRange&&!this.isTransparent&&(this.data.hd||((this.baseElement||this.layerElement).style.display="block"),this.hidden=!1,this._isFirstFrame=!0)},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},renderInnerContent:function(){},prepareFrame:function(t){this._mdf=!1,this.prepareRenderableFrame(t),this.prepareProperties(t,this.isInRange),this.checkTransparency()},destroy:function(){this.innerElem=null,this.destroyBaseElement()}})],RenderableDOMElement),extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],IImageElement),IImageElement.prototype.createContent=function(){var t=this.globalData.getAssetsPath(this.assetData);this.innerElem=createNS("image"),this.innerElem.setAttribute("width",this.assetData.w+"px"),this.innerElem.setAttribute("height",this.assetData.h+"px"),this.innerElem.setAttribute("preserveAspectRatio",this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio),this.innerElem.setAttributeNS("http://www.w3.org/1999/xlink","href",t),this.layerElement.appendChild(this.innerElem)},IImageElement.prototype.sourceRectAtTime=function(){return this.sourceRect},IShapeElement.prototype={addShapeToModifiers:function(t){var e,i=this.shapeModifiers.length;for(e=0;e<i;e+=1)this.shapeModifiers[e].addShape(t)},isShapeInAnimatedModifiers:function(t){for(var e=this.shapeModifiers.length;0<e;)if(this.shapeModifiers[0].isAnimatedWithShape(t))return!0;return!1},renderModifiers:function(){if(this.shapeModifiers.length){var t,e=this.shapes.length;for(t=0;t<e;t+=1)this.shapes[t].sh.reset();for(t=(e=this.shapeModifiers.length)-1;t>=0&&!this.shapeModifiers[t].processShapes(this._isFirstFrame);t-=1);}},searchProcessedElement:function(t){for(var e=this.processedElements,i=0,n=e.length;i<n;){if(e[i].elem===t)return e[i].pos;i+=1}return 0},addProcessedElement:function(t,e){for(var i=this.processedElements,n=i.length;n;)if(i[n-=1].elem===t)return void(i[n].pos=e);i.push(new ProcessedElement(t,e))},prepareFrame:function(t){this.prepareRenderableFrame(t),this.prepareProperties(t,this.isInRange)}};var lineCapEnum={1:"butt",2:"round",3:"square"},lineJoinEnum={1:"miter",2:"round",3:"bevel"};function SVGShapeData(t,e,i){this.caches=[],this.styles=[],this.transformers=t,this.lStr="",this.sh=i,this.lvl=e,this._isAnimated=!!i.k;for(var n=0,r=t.length;n<r;){if(t[n].mProps.dynamicProperties.length){this._isAnimated=!0;break}n+=1}}function SVGStyleData(t,e){this.data=t,this.type=t.ty,this.d="",this.lvl=e,this._mdf=!1,this.closed=!0===t.hd,this.pElem=createNS("path"),this.msElem=null}function DashProperty(t,e,i,n){var r;this.elem=t,this.frameId=-1,this.dataProps=createSizedArray(e.length),this.renderer=i,this.k=!1,this.dashStr="",this.dashArray=createTypedArray("float32",e.length?e.length-1:0),this.dashoffset=createTypedArray("float32",1),this.initDynamicPropertyContainer(n);var s,a=e.length||0;for(r=0;r<a;r+=1)s=PropertyFactory.getProp(t,e[r].v,0,0,this),this.k=s.k||this.k,this.dataProps[r]={n:e[r].n,p:s};this.k||this.getValue(!0),this._isAnimated=this.k}function SVGStrokeStyleData(t,e,i){this.initDynamicPropertyContainer(t),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(t,e.o,0,.01,this),this.w=PropertyFactory.getProp(t,e.w,0,null,this),this.d=new DashProperty(t,e.d||{},"svg",this),this.c=PropertyFactory.getProp(t,e.c,1,255,this),this.style=i,this._isAnimated=!!this._isAnimated}function SVGFillStyleData(t,e,i){this.initDynamicPropertyContainer(t),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(t,e.o,0,.01,this),this.c=PropertyFactory.getProp(t,e.c,1,255,this),this.style=i}function SVGNoStyleData(t,e,i){this.initDynamicPropertyContainer(t),this.getValue=this.iterateDynamicProperties,this.style=i}function GradientProperty(t,e,i){this.data=e,this.c=createTypedArray("uint8c",4*e.p);var n=e.k.k[0].s?e.k.k[0].s.length-4*e.p:e.k.k.length-4*e.p;this.o=createTypedArray("float32",n),this._cmdf=!1,this._omdf=!1,this._collapsable=this.checkCollapsable(),this._hasOpacity=n,this.initDynamicPropertyContainer(i),this.prop=PropertyFactory.getProp(t,e.k,1,null,this),this.k=this.prop.k,this.getValue(!0)}function SVGGradientFillStyleData(t,e,i){this.initDynamicPropertyContainer(t),this.getValue=this.iterateDynamicProperties,this.initGradientData(t,e,i)}function SVGGradientStrokeStyleData(t,e,i){this.initDynamicPropertyContainer(t),this.getValue=this.iterateDynamicProperties,this.w=PropertyFactory.getProp(t,e.w,0,null,this),this.d=new DashProperty(t,e.d||{},"svg",this),this.initGradientData(t,e,i),this._isAnimated=!!this._isAnimated}function ShapeGroupData(){this.it=[],this.prevViewData=[],this.gr=createNS("g")}function SVGTransformData(t,e,i){this.transform={mProps:t,op:e,container:i},this.elements=[],this._isAnimated=this.transform.mProps.dynamicProperties.length||this.transform.op.effectsSequence.length}SVGShapeData.prototype.setAsAnimated=function(){this._isAnimated=!0},SVGStyleData.prototype.reset=function(){this.d="",this._mdf=!1},DashProperty.prototype.getValue=function(t){if((this.elem.globalData.frameId!==this.frameId||t)&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf=this._mdf||t,this._mdf)){var e=0,i=this.dataProps.length;for("svg"===this.renderer&&(this.dashStr=""),e=0;e<i;e+=1)"o"!==this.dataProps[e].n?"svg"===this.renderer?this.dashStr+=" "+this.dataProps[e].p.v:this.dashArray[e]=this.dataProps[e].p.v:this.dashoffset[0]=this.dataProps[e].p.v}},extendPrototype([DynamicPropertyContainer],DashProperty),extendPrototype([DynamicPropertyContainer],SVGStrokeStyleData),extendPrototype([DynamicPropertyContainer],SVGFillStyleData),extendPrototype([DynamicPropertyContainer],SVGNoStyleData),GradientProperty.prototype.comparePoints=function(t,e){for(var i=0,n=this.o.length/2;i<n;){if(Math.abs(t[4*i]-t[4*e+2*i])>.01)return!1;i+=1}return!0},GradientProperty.prototype.checkCollapsable=function(){if(this.o.length/2!==this.c.length/4)return!1;if(this.data.k.k[0].s)for(var t=0,e=this.data.k.k.length;t<e;){if(!this.comparePoints(this.data.k.k[t].s,this.data.p))return!1;t+=1}else if(!this.comparePoints(this.data.k.k,this.data.p))return!1;return!0},GradientProperty.prototype.getValue=function(t){if(this.prop.getValue(),this._mdf=!1,this._cmdf=!1,this._omdf=!1,this.prop._mdf||t){var e,i,n,r=4*this.data.p;for(e=0;e<r;e+=1)i=e%4===0?100:255,n=Math.round(this.prop.v[e]*i),this.c[e]!==n&&(this.c[e]=n,this._cmdf=!t);if(this.o.length)for(r=this.prop.v.length,e=4*this.data.p;e<r;e+=1)i=e%2===0?100:1,n=e%2===0?Math.round(100*this.prop.v[e]):this.prop.v[e],this.o[e-4*this.data.p]!==n&&(this.o[e-4*this.data.p]=n,this._omdf=!t);this._mdf=!t}},extendPrototype([DynamicPropertyContainer],GradientProperty),SVGGradientFillStyleData.prototype.initGradientData=function(t,e,i){this.o=PropertyFactory.getProp(t,e.o,0,.01,this),this.s=PropertyFactory.getProp(t,e.s,1,null,this),this.e=PropertyFactory.getProp(t,e.e,1,null,this),this.h=PropertyFactory.getProp(t,e.h||{k:0},0,.01,this),this.a=PropertyFactory.getProp(t,e.a||{k:0},0,degToRads,this),this.g=new GradientProperty(t,e.g,this),this.style=i,this.stops=[],this.setGradientData(i.pElem,e),this.setGradientOpacity(e,i),this._isAnimated=!!this._isAnimated},SVGGradientFillStyleData.prototype.setGradientData=function(t,e){var i=createElementID(),n=createNS(1===e.t?"linearGradient":"radialGradient");n.setAttribute("id",i),n.setAttribute("spreadMethod","pad"),n.setAttribute("gradientUnits","userSpaceOnUse");var r,s,a,o=[];for(a=4*e.g.p,s=0;s<a;s+=4)r=createNS("stop"),n.appendChild(r),o.push(r);t.setAttribute("gf"===e.ty?"fill":"stroke","url("+getLocationHref()+"#"+i+")"),this.gf=n,this.cst=o},SVGGradientFillStyleData.prototype.setGradientOpacity=function(t,e){if(this.g._hasOpacity&&!this.g._collapsable){var i,n,r,s=createNS("mask"),a=createNS("path");s.appendChild(a);var o=createElementID(),l=createElementID();s.setAttribute("id",l);var h=createNS(1===t.t?"linearGradient":"radialGradient");h.setAttribute("id",o),h.setAttribute("spreadMethod","pad"),h.setAttribute("gradientUnits","userSpaceOnUse"),r=t.g.k.k[0].s?t.g.k.k[0].s.length:t.g.k.k.length;var c=this.stops;for(n=4*t.g.p;n<r;n+=2)(i=createNS("stop")).setAttribute("stop-color","rgb(255,255,255)"),h.appendChild(i),c.push(i);a.setAttribute("gf"===t.ty?"fill":"stroke","url("+getLocationHref()+"#"+o+")"),"gs"===t.ty&&(a.setAttribute("stroke-linecap",lineCapEnum[t.lc||2]),a.setAttribute("stroke-linejoin",lineJoinEnum[t.lj||2]),1===t.lj&&a.setAttribute("stroke-miterlimit",t.ml)),this.of=h,this.ms=s,this.ost=c,this.maskId=l,e.msElem=a}},extendPrototype([DynamicPropertyContainer],SVGGradientFillStyleData),extendPrototype([SVGGradientFillStyleData,DynamicPropertyContainer],SVGGradientStrokeStyleData);var buildShapeString=function(t,e,i,n){if(0===e)return"";var r,s=t.o,a=t.i,o=t.v,l=" M"+n.applyToPointStringified(o[0][0],o[0][1]);for(r=1;r<e;r+=1)l+=" C"+n.applyToPointStringified(s[r-1][0],s[r-1][1])+" "+n.applyToPointStringified(a[r][0],a[r][1])+" "+n.applyToPointStringified(o[r][0],o[r][1]);return i&&e&&(l+=" C"+n.applyToPointStringified(s[r-1][0],s[r-1][1])+" "+n.applyToPointStringified(a[0][0],a[0][1])+" "+n.applyToPointStringified(o[0][0],o[0][1]),l+="z"),l},SVGElementsRenderer=function(){var t=new Matrix,e=new Matrix;function i(t,e,i){(i||e.transform.op._mdf)&&e.transform.container.setAttribute("opacity",e.transform.op.v),(i||e.transform.mProps._mdf)&&e.transform.container.setAttribute("transform",e.transform.mProps.v.to2dCSS())}function n(){}function r(i,n,r){var s,a,o,l,h,c,u,d,p,f,m=n.styles.length,g=n.lvl;for(c=0;c<m;c+=1){if(l=n.sh._mdf||r,n.styles[c].lvl<g){for(d=e.reset(),p=g-n.styles[c].lvl,f=n.transformers.length-1;!l&&p>0;)l=n.transformers[f].mProps._mdf||l,p-=1,f-=1;if(l)for(p=g-n.styles[c].lvl,f=n.transformers.length-1;p>0;)d.multiply(n.transformers[f].mProps.v),p-=1,f-=1}else d=t;if(a=(u=n.sh.paths)._length,l){for(o="",s=0;s<a;s+=1)(h=u.shapes[s])&&h._length&&(o+=buildShapeString(h,h._length,h.c,d));n.caches[c]=o}else o=n.caches[c];n.styles[c].d+=!0===i.hd?"":o,n.styles[c]._mdf=l||n.styles[c]._mdf}}function s(t,e,i){var n=e.style;(e.c._mdf||i)&&n.pElem.setAttribute("fill","rgb("+bmFloor(e.c.v[0])+","+bmFloor(e.c.v[1])+","+bmFloor(e.c.v[2])+")"),(e.o._mdf||i)&&n.pElem.setAttribute("fill-opacity",e.o.v)}function a(t,e,i){o(t,e,i),l(0,e,i)}function o(t,e,i){var n,r,s,a,o,l=e.gf,h=e.g._hasOpacity,c=e.s.v,u=e.e.v;if(e.o._mdf||i){var d="gf"===t.ty?"fill-opacity":"stroke-opacity";e.style.pElem.setAttribute(d,e.o.v)}if(e.s._mdf||i){var p=1===t.t?"x1":"cx",f="x1"===p?"y1":"cy";l.setAttribute(p,c[0]),l.setAttribute(f,c[1]),h&&!e.g._collapsable&&(e.of.setAttribute(p,c[0]),e.of.setAttribute(f,c[1]))}if(e.g._cmdf||i){n=e.cst;var m=e.g.c;for(s=n.length,r=0;r<s;r+=1)(a=n[r]).setAttribute("offset",m[4*r]+"%"),a.setAttribute("stop-color","rgb("+m[4*r+1]+","+m[4*r+2]+","+m[4*r+3]+")")}if(h&&(e.g._omdf||i)){var g=e.g.o;for(s=(n=e.g._collapsable?e.cst:e.ost).length,r=0;r<s;r+=1)a=n[r],e.g._collapsable||a.setAttribute("offset",g[2*r]+"%"),a.setAttribute("stop-opacity",g[2*r+1])}if(1===t.t)(e.e._mdf||i)&&(l.setAttribute("x2",u[0]),l.setAttribute("y2",u[1]),h&&!e.g._collapsable&&(e.of.setAttribute("x2",u[0]),e.of.setAttribute("y2",u[1])));else if((e.s._mdf||e.e._mdf||i)&&(o=Math.sqrt(Math.pow(c[0]-u[0],2)+Math.pow(c[1]-u[1],2)),l.setAttribute("r",o),h&&!e.g._collapsable&&e.of.setAttribute("r",o)),e.e._mdf||e.h._mdf||e.a._mdf||i){o||(o=Math.sqrt(Math.pow(c[0]-u[0],2)+Math.pow(c[1]-u[1],2)));var v=Math.atan2(u[1]-c[1],u[0]-c[0]),y=e.h.v;y>=1?y=.99:y<=-1&&(y=-.99);var b=o*y,x=Math.cos(v+e.a.v)*b+c[0],w=Math.sin(v+e.a.v)*b+c[1];l.setAttribute("fx",x),l.setAttribute("fy",w),h&&!e.g._collapsable&&(e.of.setAttribute("fx",x),e.of.setAttribute("fy",w))}}function l(t,e,i){var n=e.style,r=e.d;r&&(r._mdf||i)&&r.dashStr&&(n.pElem.setAttribute("stroke-dasharray",r.dashStr),n.pElem.setAttribute("stroke-dashoffset",r.dashoffset[0])),e.c&&(e.c._mdf||i)&&n.pElem.setAttribute("stroke","rgb("+bmFloor(e.c.v[0])+","+bmFloor(e.c.v[1])+","+bmFloor(e.c.v[2])+")"),(e.o._mdf||i)&&n.pElem.setAttribute("stroke-opacity",e.o.v),(e.w._mdf||i)&&(n.pElem.setAttribute("stroke-width",e.w.v),n.msElem&&n.msElem.setAttribute("stroke-width",e.w.v))}return{createRenderFunction:function(t){switch(t.ty){case"fl":return s;case"gf":return o;case"gs":return a;case"st":return l;case"sh":case"el":case"rc":case"sr":return r;case"tr":return i;case"no":return n;default:return null}}}}();function SVGShapeElement(t,e,i){this.shapes=[],this.shapesData=t.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.initElement(t,e,i),this.prevViewData=[]}function LetterProps(t,e,i,n,r,s){this.o=t,this.sw=e,this.sc=i,this.fc=n,this.m=r,this.p=s,this._mdf={o:!0,sw:!!e,sc:!!i,fc:!!n,m:!0,p:!0}}function TextProperty(t,e){this._frameId=initialDefaultFrame,this.pv="",this.v="",this.kf=!1,this._isFirstFrame=!0,this._mdf=!1,e.d&&e.d.sid&&(e.d=t.globalData.slotManager.getProp(e.d)),this.data=e,this.elem=t,this.comp=this.elem.comp,this.keysIndex=0,this.canResize=!1,this.minimumFontSize=1,this.effectsSequence=[],this.currentData={ascent:0,boxWidth:this.defaultBoxWidth,f:"",fStyle:"",fWeight:"",fc:"",j:"",justifyOffset:"",l:[],lh:0,lineWidths:[],ls:"",of:"",s:"",sc:"",sw:0,t:0,tr:0,sz:0,ps:null,fillColorAnim:!1,strokeColorAnim:!1,strokeWidthAnim:!1,yOffset:0,finalSize:0,finalText:[],finalLineHeight:0,__complete:!1},this.copyData(this.currentData,this.data.d.k[0].s),this.searchProperty()||this.completeTextData(this.currentData)}extendPrototype([BaseElement,TransformElement,SVGBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableDOMElement],SVGShapeElement),SVGShapeElement.prototype.initSecondaryElement=function(){},SVGShapeElement.prototype.identityMatrix=new Matrix,SVGShapeElement.prototype.buildExpressionInterface=function(){},SVGShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes()},SVGShapeElement.prototype.filterUniqueShapes=function(){var t,e,i,n,r=this.shapes.length,s=this.stylesList.length,a=[],o=!1;for(i=0;i<s;i+=1){for(n=this.stylesList[i],o=!1,a.length=0,t=0;t<r;t+=1)-1!==(e=this.shapes[t]).styles.indexOf(n)&&(a.push(e),o=e._isAnimated||o);a.length>1&&o&&this.setShapesAsAnimated(a)}},SVGShapeElement.prototype.setShapesAsAnimated=function(t){var e,i=t.length;for(e=0;e<i;e+=1)t[e].setAsAnimated()},SVGShapeElement.prototype.createStyleElement=function(t,e){var i,n=new SVGStyleData(t,e),r=n.pElem;return"st"===t.ty?i=new SVGStrokeStyleData(this,t,n):"fl"===t.ty?i=new SVGFillStyleData(this,t,n):"gf"===t.ty||"gs"===t.ty?(i=new("gf"===t.ty?SVGGradientFillStyleData:SVGGradientStrokeStyleData)(this,t,n),this.globalData.defs.appendChild(i.gf),i.maskId&&(this.globalData.defs.appendChild(i.ms),this.globalData.defs.appendChild(i.of),r.setAttribute("mask","url("+getLocationHref()+"#"+i.maskId+")"))):"no"===t.ty&&(i=new SVGNoStyleData(this,t,n)),"st"!==t.ty&&"gs"!==t.ty||(r.setAttribute("stroke-linecap",lineCapEnum[t.lc||2]),r.setAttribute("stroke-linejoin",lineJoinEnum[t.lj||2]),r.setAttribute("fill-opacity","0"),1===t.lj&&r.setAttribute("stroke-miterlimit",t.ml)),2===t.r&&r.setAttribute("fill-rule","evenodd"),t.ln&&r.setAttribute("id",t.ln),t.cl&&r.setAttribute("class",t.cl),t.bm&&(r.style["mix-blend-mode"]=getBlendMode(t.bm)),this.stylesList.push(n),this.addToAnimatedContents(t,i),i},SVGShapeElement.prototype.createGroupElement=function(t){var e=new ShapeGroupData;return t.ln&&e.gr.setAttribute("id",t.ln),t.cl&&e.gr.setAttribute("class",t.cl),t.bm&&(e.gr.style["mix-blend-mode"]=getBlendMode(t.bm)),e},SVGShapeElement.prototype.createTransformElement=function(t,e){var i=TransformPropertyFactory.getTransformProperty(this,t,this),n=new SVGTransformData(i,i.o,e);return this.addToAnimatedContents(t,n),n},SVGShapeElement.prototype.createShapeElement=function(t,e,i){var n=4;"rc"===t.ty?n=5:"el"===t.ty?n=6:"sr"===t.ty&&(n=7);var r=new SVGShapeData(e,i,ShapePropertyFactory.getShapeProp(this,t,n,this));return this.shapes.push(r),this.addShapeToModifiers(r),this.addToAnimatedContents(t,r),r},SVGShapeElement.prototype.addToAnimatedContents=function(t,e){for(var i=0,n=this.animatedContents.length;i<n;){if(this.animatedContents[i].element===e)return;i+=1}this.animatedContents.push({fn:SVGElementsRenderer.createRenderFunction(t),element:e,data:t})},SVGShapeElement.prototype.setElementStyles=function(t){var e,i=t.styles,n=this.stylesList.length;for(e=0;e<n;e+=1)this.stylesList[e].closed||i.push(this.stylesList[e])},SVGShapeElement.prototype.reloadShapes=function(){var t;this._isFirstFrame=!0;var e=this.itemsData.length;for(t=0;t<e;t+=1)this.prevViewData[t]=this.itemsData[t];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes(),e=this.dynamicProperties.length,t=0;t<e;t+=1)this.dynamicProperties[t].getValue();this.renderModifiers()},SVGShapeElement.prototype.searchShapes=function(t,e,i,n,r,s,a){var o,l,h,c,u,d,p=[].concat(s),f=t.length-1,m=[],g=[];for(o=f;o>=0;o-=1){if((d=this.searchProcessedElement(t[o]))?e[o]=i[d-1]:t[o]._render=a,"fl"===t[o].ty||"st"===t[o].ty||"gf"===t[o].ty||"gs"===t[o].ty||"no"===t[o].ty)d?e[o].style.closed=!1:e[o]=this.createStyleElement(t[o],r),t[o]._render&&e[o].style.pElem.parentNode!==n&&n.appendChild(e[o].style.pElem),m.push(e[o].style);else if("gr"===t[o].ty){if(d)for(h=e[o].it.length,l=0;l<h;l+=1)e[o].prevViewData[l]=e[o].it[l];else e[o]=this.createGroupElement(t[o]);this.searchShapes(t[o].it,e[o].it,e[o].prevViewData,e[o].gr,r+1,p,a),t[o]._render&&e[o].gr.parentNode!==n&&n.appendChild(e[o].gr)}else"tr"===t[o].ty?(d||(e[o]=this.createTransformElement(t[o],n)),c=e[o].transform,p.push(c)):"sh"===t[o].ty||"rc"===t[o].ty||"el"===t[o].ty||"sr"===t[o].ty?(d||(e[o]=this.createShapeElement(t[o],p,r)),this.setElementStyles(e[o])):"tm"===t[o].ty||"rd"===t[o].ty||"ms"===t[o].ty||"pb"===t[o].ty||"zz"===t[o].ty||"op"===t[o].ty?(d?(u=e[o]).closed=!1:((u=ShapeModifiers.getModifier(t[o].ty)).init(this,t[o]),e[o]=u,this.shapeModifiers.push(u)),g.push(u)):"rp"===t[o].ty&&(d?(u=e[o]).closed=!0:(u=ShapeModifiers.getModifier(t[o].ty),e[o]=u,u.init(this,t,o,e),this.shapeModifiers.push(u),a=!1),g.push(u));this.addProcessedElement(t[o],o+1)}for(f=m.length,o=0;o<f;o+=1)m[o].closed=!0;for(f=g.length,o=0;o<f;o+=1)g[o].closed=!0},SVGShapeElement.prototype.renderInnerContent=function(){var t;this.renderModifiers();var e=this.stylesList.length;for(t=0;t<e;t+=1)this.stylesList[t].reset();for(this.renderShape(),t=0;t<e;t+=1)(this.stylesList[t]._mdf||this._isFirstFrame)&&(this.stylesList[t].msElem&&(this.stylesList[t].msElem.setAttribute("d",this.stylesList[t].d),this.stylesList[t].d="M0 0"+this.stylesList[t].d),this.stylesList[t].pElem.setAttribute("d",this.stylesList[t].d||"M0 0"))},SVGShapeElement.prototype.renderShape=function(){var t,e,i=this.animatedContents.length;for(t=0;t<i;t+=1)e=this.animatedContents[t],(this._isFirstFrame||e.element._isAnimated)&&!0!==e.data&&e.fn(e.data,e.element,this._isFirstFrame)},SVGShapeElement.prototype.destroy=function(){this.destroyBaseElement(),this.shapesData=null,this.itemsData=null},LetterProps.prototype.update=function(t,e,i,n,r,s){this._mdf.o=!1,this._mdf.sw=!1,this._mdf.sc=!1,this._mdf.fc=!1,this._mdf.m=!1,this._mdf.p=!1;var a=!1;return this.o!==t&&(this.o=t,this._mdf.o=!0,a=!0),this.sw!==e&&(this.sw=e,this._mdf.sw=!0,a=!0),this.sc!==i&&(this.sc=i,this._mdf.sc=!0,a=!0),this.fc!==n&&(this.fc=n,this._mdf.fc=!0,a=!0),this.m!==r&&(this.m=r,this._mdf.m=!0,a=!0),!s.length||this.p[0]===s[0]&&this.p[1]===s[1]&&this.p[4]===s[4]&&this.p[5]===s[5]&&this.p[12]===s[12]&&this.p[13]===s[13]||(this.p=s,this._mdf.p=!0,a=!0),a},TextProperty.prototype.defaultBoxWidth=[0,0],TextProperty.prototype.copyData=function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},TextProperty.prototype.setCurrentData=function(t){t.__complete||this.completeTextData(t),this.currentData=t,this.currentData.boxWidth=this.currentData.boxWidth||this.defaultBoxWidth,this._mdf=!0},TextProperty.prototype.searchProperty=function(){return this.searchKeyframes()},TextProperty.prototype.searchKeyframes=function(){return this.kf=this.data.d.k.length>1,this.kf&&this.addEffect(this.getKeyframeValue.bind(this)),this.kf},TextProperty.prototype.addEffect=function(t){this.effectsSequence.push(t),this.elem.addDynamicProperty(this)},TextProperty.prototype.getValue=function(t){if(this.elem.globalData.frameId!==this.frameId&&this.effectsSequence.length||t){this.currentData.t=this.data.d.k[this.keysIndex].s.t;var e=this.currentData,i=this.keysIndex;if(this.lock)this.setCurrentData(this.currentData);else{var n;this.lock=!0,this._mdf=!1;var r=this.effectsSequence.length,s=t||this.data.d.k[this.keysIndex].s;for(n=0;n<r;n+=1)s=i!==this.keysIndex?this.effectsSequence[n](s,s.t):this.effectsSequence[n](this.currentData,s.t);e!==s&&this.setCurrentData(s),this.v=this.currentData,this.pv=this.v,this.lock=!1,this.frameId=this.elem.globalData.frameId}}},TextProperty.prototype.getKeyframeValue=function(){for(var t=this.data.d.k,e=this.elem.comp.renderedFrame,i=0,n=t.length;i<=n-1&&!(i===n-1||t[i+1].t>e);)i+=1;return this.keysIndex!==i&&(this.keysIndex=i),this.data.d.k[this.keysIndex].s},TextProperty.prototype.buildFinalText=function(t){for(var e,i,n=[],r=0,s=t.length,a=!1,o=!1,l="";r<s;)a=o,o=!1,e=t.charCodeAt(r),l=t.charAt(r),FontManager.isCombinedCharacter(e)?a=!0:e>=55296&&e<=56319?FontManager.isRegionalFlag(t,r)?l=t.substr(r,14):(i=t.charCodeAt(r+1))>=56320&&i<=57343&&(FontManager.isModifier(e,i)?(l=t.substr(r,2),a=!0):l=FontManager.isFlagEmoji(t.substr(r,4))?t.substr(r,4):t.substr(r,2)):e>56319?(i=t.charCodeAt(r+1),FontManager.isVariationSelector(e)&&(a=!0)):FontManager.isZeroWidthJoiner(e)&&(a=!0,o=!0),a?(n[n.length-1]+=l,a=!1):n.push(l),r+=l.length;return n},TextProperty.prototype.completeTextData=function(t){t.__complete=!0;var e,i,n,r,s,a,o,l=this.elem.globalData.fontManager,h=this.data,c=[],u=0,d=h.m.g,p=0,f=0,m=0,g=[],v=0,y=0,b=l.getFontByName(t.f),x=0,w=getFontProperties(b);t.fWeight=w.weight,t.fStyle=w.style,t.finalSize=t.s,t.finalText=this.buildFinalText(t.t),i=t.finalText.length,t.finalLineHeight=t.lh;var S,A=t.tr/1e3*t.finalSize;if(t.sz)for(var E,_,C=!0,M=t.sz[0],P=t.sz[1];C;){E=0,v=0,i=(_=this.buildFinalText(t.t)).length,A=t.tr/1e3*t.finalSize;var T=-1;for(e=0;e<i;e+=1)S=_[e].charCodeAt(0),n=!1," "===_[e]?T=e:13!==S&&3!==S||(v=0,n=!0,E+=t.finalLineHeight||1.2*t.finalSize),l.chars?(o=l.getCharData(_[e],b.fStyle,b.fFamily),x=n?0:o.w*t.finalSize/100):x=l.measureText(_[e],t.f,t.finalSize),v+x>M&&" "!==_[e]?(-1===T?i+=1:e=T,E+=t.finalLineHeight||1.2*t.finalSize,_.splice(e,T===e?1:0,"\r"),T=-1,v=0):(v+=x,v+=A);E+=b.ascent*t.finalSize/100,this.canResize&&t.finalSize>this.minimumFontSize&&P<E?(t.finalSize-=1,t.finalLineHeight=t.finalSize*t.lh/t.s):(t.finalText=_,i=t.finalText.length,C=!1)}v=-A,x=0;var D,k=0;for(e=0;e<i;e+=1)if(n=!1,13===(S=(D=t.finalText[e]).charCodeAt(0))||3===S?(k=0,g.push(v),y=v>y?v:y,v=-2*A,r="",n=!0,m+=1):r=D,l.chars?(o=l.getCharData(D,b.fStyle,l.getFontByName(t.f).fFamily),x=n?0:o.w*t.finalSize/100):x=l.measureText(r,t.f,t.finalSize)," "===D?k+=x+A:(v+=x+A+k,k=0),c.push({l:x,an:x,add:p,n:n,anIndexes:[],val:r,line:m,animatorJustifyOffset:0}),2==d){if(p+=x,""===r||" "===r||e===i-1){for(""!==r&&" "!==r||(p-=x);f<=e;)c[f].an=p,c[f].ind=u,c[f].extra=x,f+=1;u+=1,p=0}}else if(3==d){if(p+=x,""===r||e===i-1){for(""===r&&(p-=x);f<=e;)c[f].an=p,c[f].ind=u,c[f].extra=x,f+=1;p=0,u+=1}}else c[u].ind=u,c[u].extra=0,u+=1;if(t.l=c,y=v>y?v:y,g.push(v),t.sz)t.boxWidth=t.sz[0],t.justifyOffset=0;else switch(t.boxWidth=y,t.j){case 1:t.justifyOffset=-t.boxWidth;break;case 2:t.justifyOffset=-t.boxWidth/2;break;default:t.justifyOffset=0}t.lineWidths=g;var I,R,O,L,B=h.a;a=B.length;var z=[];for(s=0;s<a;s+=1){for((I=B[s]).a.sc&&(t.strokeColorAnim=!0),I.a.sw&&(t.strokeWidthAnim=!0),(I.a.fc||I.a.fh||I.a.fs||I.a.fb)&&(t.fillColorAnim=!0),L=0,O=I.s.b,e=0;e<i;e+=1)(R=c[e]).anIndexes[s]=L,(1==O&&""!==R.val||2==O&&""!==R.val&&" "!==R.val||3==O&&(R.n||" "==R.val||e==i-1)||4==O&&(R.n||e==i-1))&&(1===I.s.rn&&z.push(L),L+=1);h.a[s].s.totalChars=L;var F,N=-1;if(1===I.s.rn)for(e=0;e<i;e+=1)N!=(R=c[e]).anIndexes[s]&&(N=R.anIndexes[s],F=z.splice(Math.floor(Math.random()*z.length),1)[0]),R.anIndexes[s]=F}t.yOffset=t.finalLineHeight||1.2*t.finalSize,t.ls=t.ls||0,t.ascent=b.ascent*t.finalSize/100},TextProperty.prototype.updateDocumentData=function(t,e){e=void 0===e?this.keysIndex:e;var i=this.copyData({},this.data.d.k[e].s);i=this.copyData(i,t),this.data.d.k[e].s=i,this.recalculate(e),this.setCurrentData(i),this.elem.addDynamicProperty(this)},TextProperty.prototype.recalculate=function(t){var e=this.data.d.k[t].s;e.__complete=!1,this.keysIndex=0,this._isFirstFrame=!0,this.getValue(e)},TextProperty.prototype.canResizeFont=function(t){this.canResize=t,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)},TextProperty.prototype.setMinimumFontSize=function(t){this.minimumFontSize=Math.floor(t)||1,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)};var TextSelectorProp=function(){var t=Math.max,e=Math.min,i=Math.floor;function n(t,e){this._currentTextLength=-1,this.k=!1,this.data=e,this.elem=t,this.comp=t.comp,this.finalS=0,this.finalE=0,this.initDynamicPropertyContainer(t),this.s=PropertyFactory.getProp(t,e.s||{k:0},0,0,this),this.e="e"in e?PropertyFactory.getProp(t,e.e,0,0,this):{v:100},this.o=PropertyFactory.getProp(t,e.o||{k:0},0,0,this),this.xe=PropertyFactory.getProp(t,e.xe||{k:0},0,0,this),this.ne=PropertyFactory.getProp(t,e.ne||{k:0},0,0,this),this.sm=PropertyFactory.getProp(t,e.sm||{k:100},0,0,this),this.a=PropertyFactory.getProp(t,e.a,0,.01,this),this.dynamicProperties.length||this.getValue()}return n.prototype={getMult:function(n){this._currentTextLength!==this.elem.textProperty.currentData.l.length&&this.getValue();var r=0,s=0,a=1,o=1;this.ne.v>0?r=this.ne.v/100:s=-this.ne.v/100,this.xe.v>0?a=1-this.xe.v/100:o=1+this.xe.v/100;var l=BezierFactory.getBezierEasing(r,s,a,o).get,h=0,c=this.finalS,u=this.finalE,d=this.data.sh;if(2===d)h=l(h=u===c?n>=u?1:0:t(0,e(.5/(u-c)+(n-c)/(u-c),1)));else if(3===d)h=l(h=u===c?n>=u?0:1:1-t(0,e(.5/(u-c)+(n-c)/(u-c),1)));else if(4===d)u===c?h=0:(h=t(0,e(.5/(u-c)+(n-c)/(u-c),1)))<.5?h*=2:h=1-2*(h-.5),h=l(h);else if(5===d){if(u===c)h=0;else{var p=u-c,f=-p/2+(n=e(t(0,n+.5-c),u-c)),m=p/2;h=Math.sqrt(1-f*f/(m*m))}h=l(h)}else 6===d?(u===c?h=0:(n=e(t(0,n+.5-c),u-c),h=(1+Math.cos(Math.PI+2*Math.PI*n/(u-c)))/2),h=l(h)):(n>=i(c)&&(h=t(0,e(n-c<0?e(u,1)-(c-n):u-n,1))),h=l(h));if(100!==this.sm.v){var g=.01*this.sm.v;0===g&&(g=1e-8);var v=.5-.5*g;h<v?h=0:(h=(h-v)/g)>1&&(h=1)}return h*this.a.v},getValue:function(t){this.iterateDynamicProperties(),this._mdf=t||this._mdf,this._currentTextLength=this.elem.textProperty.currentData.l.length||0,t&&2===this.data.r&&(this.e.v=this._currentTextLength);var e=2===this.data.r?1:100/this.data.totalChars,i=this.o.v/e,n=this.s.v/e+i,r=this.e.v/e+i;if(n>r){var s=n;n=r,r=s}this.finalS=n,this.finalE=r}},extendPrototype([DynamicPropertyContainer],n),{getTextSelectorProp:function(t,e,i){return new n(t,e,i)}}}();function TextAnimatorDataProperty(t,e,i){var n={propType:!1},r=PropertyFactory.getProp,s=e.a;this.a={r:s.r?r(t,s.r,0,degToRads,i):n,rx:s.rx?r(t,s.rx,0,degToRads,i):n,ry:s.ry?r(t,s.ry,0,degToRads,i):n,sk:s.sk?r(t,s.sk,0,degToRads,i):n,sa:s.sa?r(t,s.sa,0,degToRads,i):n,s:s.s?r(t,s.s,1,.01,i):n,a:s.a?r(t,s.a,1,0,i):n,o:s.o?r(t,s.o,0,.01,i):n,p:s.p?r(t,s.p,1,0,i):n,sw:s.sw?r(t,s.sw,0,0,i):n,sc:s.sc?r(t,s.sc,1,0,i):n,fc:s.fc?r(t,s.fc,1,0,i):n,fh:s.fh?r(t,s.fh,0,0,i):n,fs:s.fs?r(t,s.fs,0,.01,i):n,fb:s.fb?r(t,s.fb,0,.01,i):n,t:s.t?r(t,s.t,0,0,i):n},this.s=TextSelectorProp.getTextSelectorProp(t,e.s,i),this.s.t=e.s.t}function TextAnimatorProperty(t,e,i){this._isFirstFrame=!0,this._hasMaskedPath=!1,this._frameId=-1,this._textData=t,this._renderType=e,this._elem=i,this._animatorsData=createSizedArray(this._textData.a.length),this._pathData={},this._moreOptions={alignment:{}},this.renderedLetters=[],this.lettersChangedFlag=!1,this.initDynamicPropertyContainer(i)}function ITextElement(){}TextAnimatorProperty.prototype.searchProperties=function(){var t,e,i=this._textData.a.length,n=PropertyFactory.getProp;for(t=0;t<i;t+=1)e=this._textData.a[t],this._animatorsData[t]=new TextAnimatorDataProperty(this._elem,e,this);this._textData.p&&"m"in this._textData.p?(this._pathData={a:n(this._elem,this._textData.p.a,0,0,this),f:n(this._elem,this._textData.p.f,0,0,this),l:n(this._elem,this._textData.p.l,0,0,this),r:n(this._elem,this._textData.p.r,0,0,this),p:n(this._elem,this._textData.p.p,0,0,this),m:this._elem.maskManager.getMaskProperty(this._textData.p.m)},this._hasMaskedPath=!0):this._hasMaskedPath=!1,this._moreOptions.alignment=n(this._elem,this._textData.m.a,1,0,this)},TextAnimatorProperty.prototype.getMeasures=function(t,e){if(this.lettersChangedFlag=e,this._mdf||this._isFirstFrame||e||this._hasMaskedPath&&this._pathData.m._mdf){this._isFirstFrame=!1;var i,n,r,s,a,o,l,h,c,u,d,p,f,m,g,v,y,b,x,w=this._moreOptions.alignment.v,S=this._animatorsData,A=this._textData,E=this.mHelper,_=this._renderType,C=this.renderedLetters.length,M=t.l;if(this._hasMaskedPath){if(x=this._pathData.m,!this._pathData.n||this._pathData._mdf){var P,T=x.v;for(this._pathData.r.v&&(T=T.reverse()),a={tLength:0,segments:[]},s=T._length-1,v=0,r=0;r<s;r+=1)P=bez.buildBezierData(T.v[r],T.v[r+1],[T.o[r][0]-T.v[r][0],T.o[r][1]-T.v[r][1]],[T.i[r+1][0]-T.v[r+1][0],T.i[r+1][1]-T.v[r+1][1]]),a.tLength+=P.segmentLength,a.segments.push(P),v+=P.segmentLength;r=s,x.v.c&&(P=bez.buildBezierData(T.v[r],T.v[0],[T.o[r][0]-T.v[r][0],T.o[r][1]-T.v[r][1]],[T.i[0][0]-T.v[0][0],T.i[0][1]-T.v[0][1]]),a.tLength+=P.segmentLength,a.segments.push(P),v+=P.segmentLength),this._pathData.pi=a}if(a=this._pathData.pi,o=this._pathData.f.v,d=0,u=1,h=0,c=!0,m=a.segments,o<0&&x.v.c)for(a.tLength<Math.abs(o)&&(o=-Math.abs(o)%a.tLength),u=(f=m[d=m.length-1].points).length-1;o<0;)o+=f[u].partialLength,(u-=1)<0&&(u=(f=m[d-=1].points).length-1);p=(f=m[d].points)[u-1],g=(l=f[u]).partialLength}s=M.length,i=0,n=0;var D,k,I,R,O,L=1.2*t.finalSize*.714,B=!0;I=S.length;var z,F,N,U,V,j,G,H,W,q,Y,X,Q=-1,K=o,Z=d,J=u,$=-1,tt="",et=this.defaultPropsArray;if(2===t.j||1===t.j){var it=0,nt=0,rt=2===t.j?-.5:-1,st=0,at=!0;for(r=0;r<s;r+=1)if(M[r].n){for(it&&(it+=nt);st<r;)M[st].animatorJustifyOffset=it,st+=1;it=0,at=!0}else{for(k=0;k<I;k+=1)(D=S[k].a).t.propType&&(at&&2===t.j&&(nt+=D.t.v*rt),(O=S[k].s.getMult(M[r].anIndexes[k],A.a[k].s.totalChars)).length?it+=D.t.v*O[0]*rt:it+=D.t.v*O*rt);at=!1}for(it&&(it+=nt);st<r;)M[st].animatorJustifyOffset=it,st+=1}for(r=0;r<s;r+=1){if(E.reset(),U=1,M[r].n)i=0,n+=t.yOffset,n+=B?1:0,o=K,B=!1,this._hasMaskedPath&&(u=J,p=(f=m[d=Z].points)[u-1],g=(l=f[u]).partialLength,h=0),tt="",Y="",W="",X="",et=this.defaultPropsArray;else{if(this._hasMaskedPath){if($!==M[r].line){switch(t.j){case 1:o+=v-t.lineWidths[M[r].line];break;case 2:o+=(v-t.lineWidths[M[r].line])/2}$=M[r].line}Q!==M[r].ind&&(M[Q]&&(o+=M[Q].extra),o+=M[r].an/2,Q=M[r].ind),o+=w[0]*M[r].an*.005;var ot=0;for(k=0;k<I;k+=1)(D=S[k].a).p.propType&&((O=S[k].s.getMult(M[r].anIndexes[k],A.a[k].s.totalChars)).length?ot+=D.p.v[0]*O[0]:ot+=D.p.v[0]*O),D.a.propType&&((O=S[k].s.getMult(M[r].anIndexes[k],A.a[k].s.totalChars)).length?ot+=D.a.v[0]*O[0]:ot+=D.a.v[0]*O);for(c=!0,this._pathData.a.v&&(o=.5*M[0].an+(v-this._pathData.f.v-.5*M[0].an-.5*M[M.length-1].an)*Q/(s-1),o+=this._pathData.f.v);c;)h+g>=o+ot||!f?(y=(o+ot-h)/l.partialLength,F=p.point[0]+(l.point[0]-p.point[0])*y,N=p.point[1]+(l.point[1]-p.point[1])*y,E.translate(-w[0]*M[r].an*.005,-w[1]*L*.01),c=!1):f&&(h+=l.partialLength,(u+=1)>=f.length&&(u=0,m[d+=1]?f=m[d].points:x.v.c?(u=0,f=m[d=0].points):(h-=l.partialLength,f=null)),f&&(p=l,g=(l=f[u]).partialLength));z=M[r].an/2-M[r].add,E.translate(-z,0,0)}else z=M[r].an/2-M[r].add,E.translate(-z,0,0),E.translate(-w[0]*M[r].an*.005,-w[1]*L*.01,0);for(k=0;k<I;k+=1)(D=S[k].a).t.propType&&(O=S[k].s.getMult(M[r].anIndexes[k],A.a[k].s.totalChars),0===i&&0===t.j||(this._hasMaskedPath?O.length?o+=D.t.v*O[0]:o+=D.t.v*O:O.length?i+=D.t.v*O[0]:i+=D.t.v*O));for(t.strokeWidthAnim&&(j=t.sw||0),t.strokeColorAnim&&(V=t.sc?[t.sc[0],t.sc[1],t.sc[2]]:[0,0,0]),t.fillColorAnim&&t.fc&&(G=[t.fc[0],t.fc[1],t.fc[2]]),k=0;k<I;k+=1)(D=S[k].a).a.propType&&((O=S[k].s.getMult(M[r].anIndexes[k],A.a[k].s.totalChars)).length?E.translate(-D.a.v[0]*O[0],-D.a.v[1]*O[1],D.a.v[2]*O[2]):E.translate(-D.a.v[0]*O,-D.a.v[1]*O,D.a.v[2]*O));for(k=0;k<I;k+=1)(D=S[k].a).s.propType&&((O=S[k].s.getMult(M[r].anIndexes[k],A.a[k].s.totalChars)).length?E.scale(1+(D.s.v[0]-1)*O[0],1+(D.s.v[1]-1)*O[1],1):E.scale(1+(D.s.v[0]-1)*O,1+(D.s.v[1]-1)*O,1));for(k=0;k<I;k+=1){if(D=S[k].a,O=S[k].s.getMult(M[r].anIndexes[k],A.a[k].s.totalChars),D.sk.propType&&(O.length?E.skewFromAxis(-D.sk.v*O[0],D.sa.v*O[1]):E.skewFromAxis(-D.sk.v*O,D.sa.v*O)),D.r.propType&&(O.length?E.rotateZ(-D.r.v*O[2]):E.rotateZ(-D.r.v*O)),D.ry.propType&&(O.length?E.rotateY(D.ry.v*O[1]):E.rotateY(D.ry.v*O)),D.rx.propType&&(O.length?E.rotateX(D.rx.v*O[0]):E.rotateX(D.rx.v*O)),D.o.propType&&(O.length?U+=(D.o.v*O[0]-U)*O[0]:U+=(D.o.v*O-U)*O),t.strokeWidthAnim&&D.sw.propType&&(O.length?j+=D.sw.v*O[0]:j+=D.sw.v*O),t.strokeColorAnim&&D.sc.propType)for(H=0;H<3;H+=1)O.length?V[H]+=(D.sc.v[H]-V[H])*O[0]:V[H]+=(D.sc.v[H]-V[H])*O;if(t.fillColorAnim&&t.fc){if(D.fc.propType)for(H=0;H<3;H+=1)O.length?G[H]+=(D.fc.v[H]-G[H])*O[0]:G[H]+=(D.fc.v[H]-G[H])*O;D.fh.propType&&(G=O.length?addHueToRGB(G,D.fh.v*O[0]):addHueToRGB(G,D.fh.v*O)),D.fs.propType&&(G=O.length?addSaturationToRGB(G,D.fs.v*O[0]):addSaturationToRGB(G,D.fs.v*O)),D.fb.propType&&(G=O.length?addBrightnessToRGB(G,D.fb.v*O[0]):addBrightnessToRGB(G,D.fb.v*O))}}for(k=0;k<I;k+=1)(D=S[k].a).p.propType&&(O=S[k].s.getMult(M[r].anIndexes[k],A.a[k].s.totalChars),this._hasMaskedPath?O.length?E.translate(0,D.p.v[1]*O[0],-D.p.v[2]*O[1]):E.translate(0,D.p.v[1]*O,-D.p.v[2]*O):O.length?E.translate(D.p.v[0]*O[0],D.p.v[1]*O[1],-D.p.v[2]*O[2]):E.translate(D.p.v[0]*O,D.p.v[1]*O,-D.p.v[2]*O));if(t.strokeWidthAnim&&(W=j<0?0:j),t.strokeColorAnim&&(q="rgb("+Math.round(255*V[0])+","+Math.round(255*V[1])+","+Math.round(255*V[2])+")"),t.fillColorAnim&&t.fc&&(Y="rgb("+Math.round(255*G[0])+","+Math.round(255*G[1])+","+Math.round(255*G[2])+")"),this._hasMaskedPath){if(E.translate(0,-t.ls),E.translate(0,w[1]*L*.01+n,0),this._pathData.p.v){b=(l.point[1]-p.point[1])/(l.point[0]-p.point[0]);var lt=180*Math.atan(b)/Math.PI;l.point[0]<p.point[0]&&(lt+=180),E.rotate(-lt*Math.PI/180)}E.translate(F,N,0),o-=w[0]*M[r].an*.005,M[r+1]&&Q!==M[r+1].ind&&(o+=M[r].an/2,o+=.001*t.tr*t.finalSize)}else{switch(E.translate(i,n,0),t.ps&&E.translate(t.ps[0],t.ps[1]+t.ascent,0),t.j){case 1:E.translate(M[r].animatorJustifyOffset+t.justifyOffset+(t.boxWidth-t.lineWidths[M[r].line]),0,0);break;case 2:E.translate(M[r].animatorJustifyOffset+t.justifyOffset+(t.boxWidth-t.lineWidths[M[r].line])/2,0,0)}E.translate(0,-t.ls),E.translate(z,0,0),E.translate(w[0]*M[r].an*.005,w[1]*L*.01,0),i+=M[r].l+.001*t.tr*t.finalSize}"html"===_?tt=E.toCSS():"svg"===_?tt=E.to2dCSS():et=[E.props[0],E.props[1],E.props[2],E.props[3],E.props[4],E.props[5],E.props[6],E.props[7],E.props[8],E.props[9],E.props[10],E.props[11],E.props[12],E.props[13],E.props[14],E.props[15]],X=U}C<=r?(R=new LetterProps(X,W,q,Y,tt,et),this.renderedLetters.push(R),C+=1,this.lettersChangedFlag=!0):(R=this.renderedLetters[r],this.lettersChangedFlag=R.update(X,W,q,Y,tt,et)||this.lettersChangedFlag)}}},TextAnimatorProperty.prototype.getValue=function(){this._elem.globalData.frameId!==this._frameId&&(this._frameId=this._elem.globalData.frameId,this.iterateDynamicProperties())},TextAnimatorProperty.prototype.mHelper=new Matrix,TextAnimatorProperty.prototype.defaultPropsArray=[],extendPrototype([DynamicPropertyContainer],TextAnimatorProperty),ITextElement.prototype.initElement=function(t,e,i){this.lettersChangedFlag=!0,this.initFrame(),this.initBaseData(t,e,i),this.textProperty=new TextProperty(this,t.t,this.dynamicProperties),this.textAnimator=new TextAnimatorProperty(t.t,this.renderType,this),this.initTransform(t,e,i),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide(),this.textAnimator.searchProperties(this.dynamicProperties)},ITextElement.prototype.prepareFrame=function(t){this._mdf=!1,this.prepareRenderableFrame(t),this.prepareProperties(t,this.isInRange)},ITextElement.prototype.createPathShape=function(t,e){var i,n,r=e.length,s="";for(i=0;i<r;i+=1)"sh"===e[i].ty&&(n=e[i].ks.k,s+=buildShapeString(n,n.i.length,!0,t));return s},ITextElement.prototype.updateDocumentData=function(t,e){this.textProperty.updateDocumentData(t,e)},ITextElement.prototype.canResizeFont=function(t){this.textProperty.canResizeFont(t)},ITextElement.prototype.setMinimumFontSize=function(t){this.textProperty.setMinimumFontSize(t)},ITextElement.prototype.applyTextPropertiesToMatrix=function(t,e,i,n,r){switch(t.ps&&e.translate(t.ps[0],t.ps[1]+t.ascent,0),e.translate(0,-t.ls,0),t.j){case 1:e.translate(t.justifyOffset+(t.boxWidth-t.lineWidths[i]),0,0);break;case 2:e.translate(t.justifyOffset+(t.boxWidth-t.lineWidths[i])/2,0,0)}e.translate(n,r,0)},ITextElement.prototype.buildColor=function(t){return"rgb("+Math.round(255*t[0])+","+Math.round(255*t[1])+","+Math.round(255*t[2])+")"},ITextElement.prototype.emptyProp=new LetterProps,ITextElement.prototype.destroy=function(){},ITextElement.prototype.validateText=function(){(this.textProperty._mdf||this.textProperty._isFirstFrame)&&(this.buildNewText(),this.textProperty._isFirstFrame=!1,this.textProperty._mdf=!1)};var emptyShapeData={shapes:[]};function SVGTextLottieElement(t,e,i){this.textSpans=[],this.renderType="svg",this.initElement(t,e,i)}function ISolidElement(t,e,i){this.initElement(t,e,i)}function NullElement(t,e,i){this.initFrame(),this.initBaseData(t,e,i),this.initFrame(),this.initTransform(t,e,i),this.initHierarchy()}function SVGRendererBase(){}function ICompElement(){}function SVGCompElement(t,e,i){this.layers=t.layers,this.supports3d=!0,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(t,e,i),this.tm=t.tm?PropertyFactory.getProp(this,t.tm,0,e.frameRate,this):{_placeholder:!0}}function SVGRenderer(t,e){this.animationItem=t,this.layers=null,this.renderedFrame=-1,this.svgElement=createNS("svg");var i="";if(e&&e.title){var n=createNS("title"),r=createElementID();n.setAttribute("id",r),n.textContent=e.title,this.svgElement.appendChild(n),i+=r}if(e&&e.description){var s=createNS("desc"),a=createElementID();s.setAttribute("id",a),s.textContent=e.description,this.svgElement.appendChild(s),i+=" "+a}i&&this.svgElement.setAttribute("aria-labelledby",i);var o=createNS("defs");this.svgElement.appendChild(o);var l=createNS("g");this.svgElement.appendChild(l),this.layerElement=l,this.renderConfig={preserveAspectRatio:e&&e.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:e&&e.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:e&&e.contentVisibility||"visible",progressiveLoad:e&&e.progressiveLoad||!1,hideOnTransparent:!(e&&!1===e.hideOnTransparent),viewBoxOnly:e&&e.viewBoxOnly||!1,viewBoxSize:e&&e.viewBoxSize||!1,className:e&&e.className||"",id:e&&e.id||"",focusable:e&&e.focusable,filterSize:{width:e&&e.filterSize&&e.filterSize.width||"100%",height:e&&e.filterSize&&e.filterSize.height||"100%",x:e&&e.filterSize&&e.filterSize.x||"0%",y:e&&e.filterSize&&e.filterSize.y||"0%"},width:e&&e.width,height:e&&e.height,runExpressions:!e||void 0===e.runExpressions||e.runExpressions},this.globalData={_mdf:!1,frameNum:-1,defs:o,renderConfig:this.renderConfig},this.elements=[],this.pendingElements=[],this.destroyed=!1,this.rendererType="svg"}function ShapeTransformManager(){this.sequences={},this.sequenceList=[],this.transform_key_count=0}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],SVGTextLottieElement),SVGTextLottieElement.prototype.createContent=function(){this.data.singleShape&&!this.globalData.fontManager.chars&&(this.textContainer=createNS("text"))},SVGTextLottieElement.prototype.buildTextContents=function(t){for(var e=0,i=t.length,n=[],r="";e<i;)t[e]===String.fromCharCode(13)||t[e]===String.fromCharCode(3)?(n.push(r),r=""):r+=t[e],e+=1;return n.push(r),n},SVGTextLottieElement.prototype.buildShapeData=function(t,e){if(t.shapes&&t.shapes.length){var i=t.shapes[0];if(i.it){var n=i.it[i.it.length-1];n.s&&(n.s.k[0]=e,n.s.k[1]=e)}}return t},SVGTextLottieElement.prototype.buildNewText=function(){var t,e;this.addDynamicProperty(this);var i=this.textProperty.currentData;this.renderedLetters=createSizedArray(i?i.l.length:0),i.fc?this.layerElement.setAttribute("fill",this.buildColor(i.fc)):this.layerElement.setAttribute("fill","rgba(0,0,0,0)"),i.sc&&(this.layerElement.setAttribute("stroke",this.buildColor(i.sc)),this.layerElement.setAttribute("stroke-width",i.sw)),this.layerElement.setAttribute("font-size",i.finalSize);var n=this.globalData.fontManager.getFontByName(i.f);if(n.fClass)this.layerElement.setAttribute("class",n.fClass);else{this.layerElement.setAttribute("font-family",n.fFamily);var r=i.fWeight,s=i.fStyle;this.layerElement.setAttribute("font-style",s),this.layerElement.setAttribute("font-weight",r)}this.layerElement.setAttribute("aria-label",i.t);var a,o=i.l||[],l=!!this.globalData.fontManager.chars;e=o.length;var h=this.mHelper,c=this.data.singleShape,u=0,d=0,p=!0,f=.001*i.tr*i.finalSize;if(!c||l||i.sz){var m,g=this.textSpans.length;for(t=0;t<e;t+=1){if(this.textSpans[t]||(this.textSpans[t]={span:null,childSpan:null,glyph:null}),!l||!c||0===t){if(a=g>t?this.textSpans[t].span:createNS(l?"g":"text"),g<=t){if(a.setAttribute("stroke-linecap","butt"),a.setAttribute("stroke-linejoin","round"),a.setAttribute("stroke-miterlimit","4"),this.textSpans[t].span=a,l){var v=createNS("g");a.appendChild(v),this.textSpans[t].childSpan=v}this.textSpans[t].span=a,this.layerElement.appendChild(a)}a.style.display="inherit"}if(h.reset(),c&&(o[t].n&&(u=-f,d+=i.yOffset,d+=p?1:0,p=!1),this.applyTextPropertiesToMatrix(i,h,o[t].line,u,d),u+=o[t].l||0,u+=f),l){var y;if(1===(m=this.globalData.fontManager.getCharData(i.finalText[t],n.fStyle,this.globalData.fontManager.getFontByName(i.f).fFamily)).t)y=new SVGCompElement(m.data,this.globalData,this);else{var b=emptyShapeData;m.data&&m.data.shapes&&(b=this.buildShapeData(m.data,i.finalSize)),y=new SVGShapeElement(b,this.globalData,this)}if(this.textSpans[t].glyph){var x=this.textSpans[t].glyph;this.textSpans[t].childSpan.removeChild(x.layerElement),x.destroy()}this.textSpans[t].glyph=y,y._debug=!0,y.prepareFrame(0),y.renderFrame(),this.textSpans[t].childSpan.appendChild(y.layerElement),1===m.t&&this.textSpans[t].childSpan.setAttribute("transform","scale("+i.finalSize/100+","+i.finalSize/100+")")}else c&&a.setAttribute("transform","translate("+h.props[12]+","+h.props[13]+")"),a.textContent=o[t].val,a.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve")}c&&a&&a.setAttribute("d","")}else{var w=this.textContainer,S="start";switch(i.j){case 1:S="end";break;case 2:S="middle";break;default:S="start"}w.setAttribute("text-anchor",S),w.setAttribute("letter-spacing",f);var A=this.buildTextContents(i.finalText);for(e=A.length,d=i.ps?i.ps[1]+i.ascent:0,t=0;t<e;t+=1)(a=this.textSpans[t].span||createNS("tspan")).textContent=A[t],a.setAttribute("x",0),a.setAttribute("y",d),a.style.display="inherit",w.appendChild(a),this.textSpans[t]||(this.textSpans[t]={span:null,glyph:null}),this.textSpans[t].span=a,d+=i.finalLineHeight;this.layerElement.appendChild(w)}for(;t<this.textSpans.length;)this.textSpans[t].span.style.display="none",t+=1;this._sizeChanged=!0},SVGTextLottieElement.prototype.sourceRectAtTime=function(){if(this.prepareFrame(this.comp.renderedFrame-this.data.st),this.renderInnerContent(),this._sizeChanged){this._sizeChanged=!1;var t=this.layerElement.getBBox();this.bbox={top:t.y,left:t.x,width:t.width,height:t.height}}return this.bbox},SVGTextLottieElement.prototype.getValue=function(){var t,e,i=this.textSpans.length;for(this.renderedFrame=this.comp.renderedFrame,t=0;t<i;t+=1)(e=this.textSpans[t].glyph)&&(e.prepareFrame(this.comp.renderedFrame-this.data.st),e._mdf&&(this._mdf=!0))},SVGTextLottieElement.prototype.renderInnerContent=function(){if(this.validateText(),(!this.data.singleShape||this._mdf)&&(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),this.lettersChangedFlag||this.textAnimator.lettersChangedFlag)){var t,e;this._sizeChanged=!0;var i,n,r,s=this.textAnimator.renderedLetters,a=this.textProperty.currentData.l;for(e=a.length,t=0;t<e;t+=1)a[t].n||(i=s[t],n=this.textSpans[t].span,(r=this.textSpans[t].glyph)&&r.renderFrame(),i._mdf.m&&n.setAttribute("transform",i.m),i._mdf.o&&n.setAttribute("opacity",i.o),i._mdf.sw&&n.setAttribute("stroke-width",i.sw),i._mdf.sc&&n.setAttribute("stroke",i.sc),i._mdf.fc&&n.setAttribute("fill",i.fc))}},extendPrototype([IImageElement],ISolidElement),ISolidElement.prototype.createContent=function(){var t=createNS("rect");t.setAttribute("width",this.data.sw),t.setAttribute("height",this.data.sh),t.setAttribute("fill",this.data.sc),this.layerElement.appendChild(t)},NullElement.prototype.prepareFrame=function(t){this.prepareProperties(t,!0)},NullElement.prototype.renderFrame=function(){},NullElement.prototype.getBaseElement=function(){return null},NullElement.prototype.destroy=function(){},NullElement.prototype.sourceRectAtTime=function(){},NullElement.prototype.hide=function(){},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement],NullElement),extendPrototype([BaseRenderer],SVGRendererBase),SVGRendererBase.prototype.createNull=function(t){return new NullElement(t,this.globalData,this)},SVGRendererBase.prototype.createShape=function(t){return new SVGShapeElement(t,this.globalData,this)},SVGRendererBase.prototype.createText=function(t){return new SVGTextLottieElement(t,this.globalData,this)},SVGRendererBase.prototype.createImage=function(t){return new IImageElement(t,this.globalData,this)},SVGRendererBase.prototype.createSolid=function(t){return new ISolidElement(t,this.globalData,this)},SVGRendererBase.prototype.configAnimation=function(t){this.svgElement.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.svgElement.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),this.renderConfig.viewBoxSize?this.svgElement.setAttribute("viewBox",this.renderConfig.viewBoxSize):this.svgElement.setAttribute("viewBox","0 0 "+t.w+" "+t.h),this.renderConfig.viewBoxOnly||(this.svgElement.setAttribute("width",t.w),this.svgElement.setAttribute("height",t.h),this.svgElement.style.width="100%",this.svgElement.style.height="100%",this.svgElement.style.transform="translate3d(0,0,0)",this.svgElement.style.contentVisibility=this.renderConfig.contentVisibility),this.renderConfig.width&&this.svgElement.setAttribute("width",this.renderConfig.width),this.renderConfig.height&&this.svgElement.setAttribute("height",this.renderConfig.height),this.renderConfig.className&&this.svgElement.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.svgElement.setAttribute("id",this.renderConfig.id),void 0!==this.renderConfig.focusable&&this.svgElement.setAttribute("focusable",this.renderConfig.focusable),this.svgElement.setAttribute("preserveAspectRatio",this.renderConfig.preserveAspectRatio),this.animationItem.wrapper.appendChild(this.svgElement);var e=this.globalData.defs;this.setupGlobalData(t,e),this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.data=t;var i=createNS("clipPath"),n=createNS("rect");n.setAttribute("width",t.w),n.setAttribute("height",t.h),n.setAttribute("x",0),n.setAttribute("y",0);var r=createElementID();i.setAttribute("id",r),i.appendChild(n),this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+r+")"),e.appendChild(i),this.layers=t.layers,this.elements=createSizedArray(t.layers.length)},SVGRendererBase.prototype.destroy=function(){var t;this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.layerElement=null,this.globalData.defs=null;var e=this.layers?this.layers.length:0;for(t=0;t<e;t+=1)this.elements[t]&&this.elements[t].destroy&&this.elements[t].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},SVGRendererBase.prototype.updateContainerSize=function(){},SVGRendererBase.prototype.findIndexByInd=function(t){var e=0,i=this.layers.length;for(e=0;e<i;e+=1)if(this.layers[e].ind===t)return e;return-1},SVGRendererBase.prototype.buildItem=function(t){var e=this.elements;if(!e[t]&&99!==this.layers[t].ty){e[t]=!0;var i=this.createItem(this.layers[t]);if(e[t]=i,getExpressionsPlugin()&&(0===this.layers[t].ty&&this.globalData.projectInterface.registerComposition(i),i.initExpressions()),this.appendElementInPos(i,t),this.layers[t].tt){var n="tp"in this.layers[t]?this.findIndexByInd(this.layers[t].tp):t-1;if(-1===n)return;if(this.elements[n]&&!0!==this.elements[n]){var r=e[n].getMatte(this.layers[t].tt);i.setMatte(r)}else this.buildItem(n),this.addPendingElement(i)}}},SVGRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var t=this.pendingElements.pop();if(t.checkParenting(),t.data.tt)for(var e=0,i=this.elements.length;e<i;){if(this.elements[e]===t){var n="tp"in t.data?this.findIndexByInd(t.data.tp):e-1,r=this.elements[n].getMatte(this.layers[e].tt);t.setMatte(r);break}e+=1}}},SVGRendererBase.prototype.renderFrame=function(t){if(this.renderedFrame!==t&&!this.destroyed){var e;null===t?t=this.renderedFrame:this.renderedFrame=t,this.globalData.frameNum=t,this.globalData.frameId+=1,this.globalData.projectInterface.currentFrame=t,this.globalData._mdf=!1;var i=this.layers.length;for(this.completeLayers||this.checkLayers(t),e=i-1;e>=0;e-=1)(this.completeLayers||this.elements[e])&&this.elements[e].prepareFrame(t-this.layers[e].st);if(this.globalData._mdf)for(e=0;e<i;e+=1)(this.completeLayers||this.elements[e])&&this.elements[e].renderFrame()}},SVGRendererBase.prototype.appendElementInPos=function(t,e){var i=t.getBaseElement();if(i){for(var n,r=0;r<e;)this.elements[r]&&!0!==this.elements[r]&&this.elements[r].getBaseElement()&&(n=this.elements[r].getBaseElement()),r+=1;n?this.layerElement.insertBefore(i,n):this.layerElement.appendChild(i)}},SVGRendererBase.prototype.hide=function(){this.layerElement.style.display="none"},SVGRendererBase.prototype.show=function(){this.layerElement.style.display="block"},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement,RenderableDOMElement],ICompElement),ICompElement.prototype.initElement=function(t,e,i){this.initFrame(),this.initBaseData(t,e,i),this.initTransform(t,e,i),this.initRenderable(),this.initHierarchy(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),!this.data.xt&&e.progressiveLoad||this.buildAllItems(),this.hide()},ICompElement.prototype.prepareFrame=function(t){if(this._mdf=!1,this.prepareRenderableFrame(t),this.prepareProperties(t,this.isInRange),this.isInRange||this.data.xt){if(this.tm._placeholder)this.renderedFrame=t/this.data.sr;else{var e=this.tm.v;e===this.data.op&&(e=this.data.op-1),this.renderedFrame=e}var i,n=this.elements.length;for(this.completeLayers||this.checkLayers(this.renderedFrame),i=n-1;i>=0;i-=1)(this.completeLayers||this.elements[i])&&(this.elements[i].prepareFrame(this.renderedFrame-this.layers[i].st),this.elements[i]._mdf&&(this._mdf=!0))}},ICompElement.prototype.renderInnerContent=function(){var t,e=this.layers.length;for(t=0;t<e;t+=1)(this.completeLayers||this.elements[t])&&this.elements[t].renderFrame()},ICompElement.prototype.setElements=function(t){this.elements=t},ICompElement.prototype.getElements=function(){return this.elements},ICompElement.prototype.destroyElements=function(){var t,e=this.layers.length;for(t=0;t<e;t+=1)this.elements[t]&&this.elements[t].destroy()},ICompElement.prototype.destroy=function(){this.destroyElements(),this.destroyBaseElement()},extendPrototype([SVGRendererBase,ICompElement,SVGBaseElement],SVGCompElement),SVGCompElement.prototype.createComp=function(t){return new SVGCompElement(t,this.globalData,this)},extendPrototype([SVGRendererBase],SVGRenderer),SVGRenderer.prototype.createComp=function(t){return new SVGCompElement(t,this.globalData,this)},ShapeTransformManager.prototype={addTransformSequence:function(t){var e,i=t.length,n="_";for(e=0;e<i;e+=1)n+=t[e].transform.key+"_";var r=this.sequences[n];return r||(r={transforms:[].concat(t),finalTransform:new Matrix,_mdf:!1},this.sequences[n]=r,this.sequenceList.push(r)),r},processSequence:function(t,e){for(var i=0,n=t.transforms.length,r=e;i<n&&!e;){if(t.transforms[i].transform.mProps._mdf){r=!0;break}i+=1}if(r)for(t.finalTransform.reset(),i=n-1;i>=0;i-=1)t.finalTransform.multiply(t.transforms[i].transform.mProps.v);t._mdf=r},processSequences:function(t){var e,i=this.sequenceList.length;for(e=0;e<i;e+=1)this.processSequence(this.sequenceList[e],t)},getNewKey:function(){return this.transform_key_count+=1,"_"+this.transform_key_count}};var lumaLoader=function(){var t="__lottie_element_luma_buffer",e=null,i=null,n=null;function r(){e||(n=function(){var e=createNS("svg"),i=createNS("filter"),n=createNS("feColorMatrix");return i.setAttribute("id",t),n.setAttribute("type","matrix"),n.setAttribute("color-interpolation-filters","sRGB"),n.setAttribute("values","0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0"),i.appendChild(n),e.appendChild(i),e.setAttribute("id",t+"_svg"),featureSupport.svgLumaHidden&&(e.style.display="none"),e}(),document.body.appendChild(n),e=createTag("canvas"),(i=e.getContext("2d")).filter="url(#"+t+")",i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,1,1))}return{load:r,get:function(n){return e||r(),e.width=n.width,e.height=n.height,i.filter="url(#"+t+")",e}}};function createCanvas(t,e){if(featureSupport.offscreenCanvas)return new OffscreenCanvas(t,e);var i=createTag("canvas");return i.width=t,i.height=e,i}var assetLoader={loadLumaCanvas:lumaLoader.load,getLumaCanvas:lumaLoader.get,createCanvas:createCanvas},registeredEffects={};function CVEffects(t){var e,i,n=t.data.ef?t.data.ef.length:0;for(this.filters=[],e=0;e<n;e+=1){i=null;var r=t.data.ef[e].ty;registeredEffects[r]&&(i=new(0,registeredEffects[r].effect)(t.effectsManager.effectElements[e],t)),i&&this.filters.push(i)}this.filters.length&&t.addRenderableComponent(this)}function registerEffect(t,e){registeredEffects[t]={effect:e}}function CVMaskElement(t,e){var i;this.data=t,this.element=e,this.masksProperties=this.data.masksProperties||[],this.viewData=createSizedArray(this.masksProperties.length);var n=this.masksProperties.length,r=!1;for(i=0;i<n;i+=1)"n"!==this.masksProperties[i].mode&&(r=!0),this.viewData[i]=ShapePropertyFactory.getShapeProp(this.element,this.masksProperties[i],3);this.hasMasks=r,r&&this.element.addRenderableComponent(this)}function CVBaseElement(){}CVEffects.prototype.renderFrame=function(t){var e,i=this.filters.length;for(e=0;e<i;e+=1)this.filters[e].renderFrame(t)},CVEffects.prototype.getEffects=function(t){var e,i=this.filters.length,n=[];for(e=0;e<i;e+=1)this.filters[e].type===t&&n.push(this.filters[e]);return n},CVMaskElement.prototype.renderFrame=function(){if(this.hasMasks){var t,e,i,n,r=this.element.finalTransform.mat,s=this.element.canvasContext,a=this.masksProperties.length;for(s.beginPath(),t=0;t<a;t+=1)if("n"!==this.masksProperties[t].mode){var o;this.masksProperties[t].inv&&(s.moveTo(0,0),s.lineTo(this.element.globalData.compSize.w,0),s.lineTo(this.element.globalData.compSize.w,this.element.globalData.compSize.h),s.lineTo(0,this.element.globalData.compSize.h),s.lineTo(0,0)),n=this.viewData[t].v,e=r.applyToPointArray(n.v[0][0],n.v[0][1],0),s.moveTo(e[0],e[1]);var l=n._length;for(o=1;o<l;o+=1)i=r.applyToTriplePoints(n.o[o-1],n.i[o],n.v[o]),s.bezierCurveTo(i[0],i[1],i[2],i[3],i[4],i[5]);i=r.applyToTriplePoints(n.o[o-1],n.i[0],n.v[0]),s.bezierCurveTo(i[0],i[1],i[2],i[3],i[4],i[5])}this.element.globalData.renderer.save(!0),s.clip()}},CVMaskElement.prototype.getMaskProperty=MaskElement.prototype.getMaskProperty,CVMaskElement.prototype.destroy=function(){this.element=null};var operationsMap={1:"source-in",2:"source-out",3:"source-in",4:"source-out"};function CVShapeData(t,e,i,n){this.styledShapes=[],this.tr=[0,0,0,0,0,0];var r,s=4;"rc"===e.ty?s=5:"el"===e.ty?s=6:"sr"===e.ty&&(s=7),this.sh=ShapePropertyFactory.getShapeProp(t,e,s,t);var a,o=i.length;for(r=0;r<o;r+=1)i[r].closed||(a={transforms:n.addTransformSequence(i[r].transforms),trNodes:[]},this.styledShapes.push(a),i[r].elements.push(a))}function CVShapeElement(t,e,i){this.shapes=[],this.shapesData=t.shapes,this.stylesList=[],this.itemsData=[],this.prevViewData=[],this.shapeModifiers=[],this.processedElements=[],this.transformsManager=new ShapeTransformManager,this.initElement(t,e,i)}function CVTextElement(t,e,i){this.textSpans=[],this.yOffset=0,this.fillColorAnim=!1,this.strokeColorAnim=!1,this.strokeWidthAnim=!1,this.stroke=!1,this.fill=!1,this.justifyOffset=0,this.currentRender=null,this.renderType="canvas",this.values={fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,0)",sWidth:0,fValue:""},this.initElement(t,e,i)}function CVImageElement(t,e,i){this.assetData=e.getAssetData(t.refId),this.img=e.imageLoader.getAsset(this.assetData),this.initElement(t,e,i)}function CVSolidElement(t,e,i){this.initElement(t,e,i)}function CanvasRendererBase(){}function CanvasContext(){this.opacity=-1,this.transform=createTypedArray("float32",16),this.fillStyle="",this.strokeStyle="",this.lineWidth="",this.lineCap="",this.lineJoin="",this.miterLimit="",this.id=Math.random()}function CVContextData(){var t;for(this.stack=[],this.cArrPos=0,this.cTr=new Matrix,t=0;t<15;t+=1){var e=new CanvasContext;this.stack[t]=e}this._length=15,this.nativeContext=null,this.transformMat=new Matrix,this.currentOpacity=1,this.currentFillStyle="",this.appliedFillStyle="",this.currentStrokeStyle="",this.appliedStrokeStyle="",this.currentLineWidth="",this.appliedLineWidth="",this.currentLineCap="",this.appliedLineCap="",this.currentLineJoin="",this.appliedLineJoin="",this.appliedMiterLimit="",this.currentMiterLimit=""}function CVCompElement(t,e,i){this.completeLayers=!1,this.layers=t.layers,this.pendingElements=[],this.elements=createSizedArray(this.layers.length),this.initElement(t,e,i),this.tm=t.tm?PropertyFactory.getProp(this,t.tm,0,e.frameRate,this):{_placeholder:!0}}function CanvasRenderer(t,e){this.animationItem=t,this.renderConfig={clearCanvas:!e||void 0===e.clearCanvas||e.clearCanvas,context:e&&e.context||null,progressiveLoad:e&&e.progressiveLoad||!1,preserveAspectRatio:e&&e.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:e&&e.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:e&&e.contentVisibility||"visible",className:e&&e.className||"",id:e&&e.id||"",runExpressions:!e||void 0===e.runExpressions||e.runExpressions},this.renderConfig.dpr=e&&e.dpr||1,this.animationItem.wrapper&&(this.renderConfig.dpr=e&&e.dpr||window.devicePixelRatio||1),this.renderedFrame=-1,this.globalData={frameNum:-1,_mdf:!1,renderConfig:this.renderConfig,currentGlobalAlpha:-1},this.contextData=new CVContextData,this.elements=[],this.pendingElements=[],this.transformMat=new Matrix,this.completeLayers=!1,this.rendererType="canvas",this.renderConfig.clearCanvas&&(this.ctxTransform=this.contextData.transform.bind(this.contextData),this.ctxOpacity=this.contextData.opacity.bind(this.contextData),this.ctxFillStyle=this.contextData.fillStyle.bind(this.contextData),this.ctxStrokeStyle=this.contextData.strokeStyle.bind(this.contextData),this.ctxLineWidth=this.contextData.lineWidth.bind(this.contextData),this.ctxLineCap=this.contextData.lineCap.bind(this.contextData),this.ctxLineJoin=this.contextData.lineJoin.bind(this.contextData),this.ctxMiterLimit=this.contextData.miterLimit.bind(this.contextData),this.ctxFill=this.contextData.fill.bind(this.contextData),this.ctxFillRect=this.contextData.fillRect.bind(this.contextData),this.ctxStroke=this.contextData.stroke.bind(this.contextData),this.save=this.contextData.save.bind(this.contextData))}function HBaseElement(){}function HSolidElement(t,e,i){this.initElement(t,e,i)}function HShapeElement(t,e,i){this.shapes=[],this.shapesData=t.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.shapesContainer=createNS("g"),this.initElement(t,e,i),this.prevViewData=[],this.currentBBox={x:999999,y:-999999,h:0,w:0}}function HTextElement(t,e,i){this.textSpans=[],this.textPaths=[],this.currentBBox={x:999999,y:-999999,h:0,w:0},this.renderType="svg",this.isMasked=!1,this.initElement(t,e,i)}function HCameraElement(t,e,i){this.initFrame(),this.initBaseData(t,e,i),this.initHierarchy();var n=PropertyFactory.getProp;if(this.pe=n(this,t.pe,0,0,this),t.ks.p.s?(this.px=n(this,t.ks.p.x,1,0,this),this.py=n(this,t.ks.p.y,1,0,this),this.pz=n(this,t.ks.p.z,1,0,this)):this.p=n(this,t.ks.p,1,0,this),t.ks.a&&(this.a=n(this,t.ks.a,1,0,this)),t.ks.or.k.length&&t.ks.or.k[0].to){var r,s=t.ks.or.k.length;for(r=0;r<s;r+=1)t.ks.or.k[r].to=null,t.ks.or.k[r].ti=null}this.or=n(this,t.ks.or,1,degToRads,this),this.or.sh=!0,this.rx=n(this,t.ks.rx,0,degToRads,this),this.ry=n(this,t.ks.ry,0,degToRads,this),this.rz=n(this,t.ks.rz,0,degToRads,this),this.mat=new Matrix,this._prevMat=new Matrix,this._isFirstFrame=!0,this.finalTransform={mProp:this}}function HImageElement(t,e,i){this.assetData=e.getAssetData(t.refId),this.initElement(t,e,i)}function HybridRendererBase(t,e){this.animationItem=t,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:e&&e.className||"",imagePreserveAspectRatio:e&&e.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(e&&!1===e.hideOnTransparent),filterSize:{width:e&&e.filterSize&&e.filterSize.width||"400%",height:e&&e.filterSize&&e.filterSize.height||"400%",x:e&&e.filterSize&&e.filterSize.x||"-100%",y:e&&e.filterSize&&e.filterSize.y||"-100%"}},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}function HCompElement(t,e,i){this.layers=t.layers,this.supports3d=!t.hasMask,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(t,e,i),this.tm=t.tm?PropertyFactory.getProp(this,t.tm,0,e.frameRate,this):{_placeholder:!0}}function HybridRenderer(t,e){this.animationItem=t,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:e&&e.className||"",imagePreserveAspectRatio:e&&e.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(e&&!1===e.hideOnTransparent),filterSize:{width:e&&e.filterSize&&e.filterSize.width||"400%",height:e&&e.filterSize&&e.filterSize.height||"400%",x:e&&e.filterSize&&e.filterSize.x||"-100%",y:e&&e.filterSize&&e.filterSize.y||"-100%"},runExpressions:!e||void 0===e.runExpressions||e.runExpressions},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}CVBaseElement.prototype={createElements:function(){},initRendererElement:function(){},createContainerElements:function(){if(this.data.tt>=1){this.buffers=[];var t=this.globalData.canvasContext,e=assetLoader.createCanvas(t.canvas.width,t.canvas.height);this.buffers.push(e);var i=assetLoader.createCanvas(t.canvas.width,t.canvas.height);this.buffers.push(i),this.data.tt>=3&&!document._isProxy&&assetLoader.loadLumaCanvas()}this.canvasContext=this.globalData.canvasContext,this.transformCanvas=this.globalData.transformCanvas,this.renderableEffectsManager=new CVEffects(this),this.searchEffectTransforms()},createContent:function(){},setBlendMode:function(){var t=this.globalData;if(t.blendMode!==this.data.bm){t.blendMode=this.data.bm;var e=getBlendMode(this.data.bm);t.canvasContext.globalCompositeOperation=e}},createRenderableComponents:function(){this.maskManager=new CVMaskElement(this.data,this),this.transformEffects=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT)},hideElement:function(){this.hidden||this.isInRange&&!this.isTransparent||(this.hidden=!0)},showElement:function(){this.isInRange&&!this.isTransparent&&(this.hidden=!1,this._isFirstFrame=!0,this.maskManager._isFirstFrame=!0)},clearCanvas:function(t){t.clearRect(this.transformCanvas.tx,this.transformCanvas.ty,this.transformCanvas.w*this.transformCanvas.sx,this.transformCanvas.h*this.transformCanvas.sy)},prepareLayer:function(){if(this.data.tt>=1){var t=this.buffers[0].getContext("2d");this.clearCanvas(t),t.drawImage(this.canvasContext.canvas,0,0),this.currentTransform=this.canvasContext.getTransform(),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform)}},exitLayer:function(){if(this.data.tt>=1){var t=this.buffers[1],e=t.getContext("2d");if(this.clearCanvas(e),e.drawImage(this.canvasContext.canvas,0,0),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform),this.comp.getElementById("tp"in this.data?this.data.tp:this.data.ind-1).renderFrame(!0),this.canvasContext.setTransform(1,0,0,1,0,0),this.data.tt>=3&&!document._isProxy){var i=assetLoader.getLumaCanvas(this.canvasContext.canvas);i.getContext("2d").drawImage(this.canvasContext.canvas,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.drawImage(i,0,0)}this.canvasContext.globalCompositeOperation=operationsMap[this.data.tt],this.canvasContext.drawImage(t,0,0),this.canvasContext.globalCompositeOperation="destination-over",this.canvasContext.drawImage(this.buffers[0],0,0),this.canvasContext.setTransform(this.currentTransform),this.canvasContext.globalCompositeOperation="source-over"}},renderFrame:function(t){if(!this.hidden&&!this.data.hd&&(1!==this.data.td||t)){this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.setBlendMode();var e=0===this.data.ty;this.prepareLayer(),this.globalData.renderer.save(e),this.globalData.renderer.ctxTransform(this.finalTransform.localMat.props),this.globalData.renderer.ctxOpacity(this.finalTransform.localOpacity),this.renderInnerContent(),this.globalData.renderer.restore(e),this.exitLayer(),this.maskManager.hasMasks&&this.globalData.renderer.restore(!0),this._isFirstFrame&&(this._isFirstFrame=!1)}},destroy:function(){this.canvasContext=null,this.data=null,this.globalData=null,this.maskManager.destroy()},mHelper:new Matrix},CVBaseElement.prototype.hide=CVBaseElement.prototype.hideElement,CVBaseElement.prototype.show=CVBaseElement.prototype.showElement,CVShapeData.prototype.setAsAnimated=SVGShapeData.prototype.setAsAnimated,extendPrototype([BaseElement,TransformElement,CVBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableElement],CVShapeElement),CVShapeElement.prototype.initElement=RenderableDOMElement.prototype.initElement,CVShapeElement.prototype.transformHelper={opacity:1,_opMdf:!1},CVShapeElement.prototype.dashResetter=[],CVShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[])},CVShapeElement.prototype.createStyleElement=function(t,e){var i={data:t,type:t.ty,preTransforms:this.transformsManager.addTransformSequence(e),transforms:[],elements:[],closed:!0===t.hd},n={};if("fl"===t.ty||"st"===t.ty?(n.c=PropertyFactory.getProp(this,t.c,1,255,this),n.c.k||(i.co="rgb("+bmFloor(n.c.v[0])+","+bmFloor(n.c.v[1])+","+bmFloor(n.c.v[2])+")")):"gf"!==t.ty&&"gs"!==t.ty||(n.s=PropertyFactory.getProp(this,t.s,1,null,this),n.e=PropertyFactory.getProp(this,t.e,1,null,this),n.h=PropertyFactory.getProp(this,t.h||{k:0},0,.01,this),n.a=PropertyFactory.getProp(this,t.a||{k:0},0,degToRads,this),n.g=new GradientProperty(this,t.g,this)),n.o=PropertyFactory.getProp(this,t.o,0,.01,this),"st"===t.ty||"gs"===t.ty){if(i.lc=lineCapEnum[t.lc||2],i.lj=lineJoinEnum[t.lj||2],1==t.lj&&(i.ml=t.ml),n.w=PropertyFactory.getProp(this,t.w,0,null,this),n.w.k||(i.wi=n.w.v),t.d){var r=new DashProperty(this,t.d,"canvas",this);n.d=r,n.d.k||(i.da=n.d.dashArray,i.do=n.d.dashoffset[0])}}else i.r=2===t.r?"evenodd":"nonzero";return this.stylesList.push(i),n.style=i,n},CVShapeElement.prototype.createGroupElement=function(){return{it:[],prevViewData:[]}},CVShapeElement.prototype.createTransformElement=function(t){return{transform:{opacity:1,_opMdf:!1,key:this.transformsManager.getNewKey(),op:PropertyFactory.getProp(this,t.o,0,.01,this),mProps:TransformPropertyFactory.getTransformProperty(this,t,this)}}},CVShapeElement.prototype.createShapeElement=function(t){var e=new CVShapeData(this,t,this.stylesList,this.transformsManager);return this.shapes.push(e),this.addShapeToModifiers(e),e},CVShapeElement.prototype.reloadShapes=function(){var t;this._isFirstFrame=!0;var e=this.itemsData.length;for(t=0;t<e;t+=1)this.prevViewData[t]=this.itemsData[t];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[]),e=this.dynamicProperties.length,t=0;t<e;t+=1)this.dynamicProperties[t].getValue();this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame)},CVShapeElement.prototype.addTransformToStyleList=function(t){var e,i=this.stylesList.length;for(e=0;e<i;e+=1)this.stylesList[e].closed||this.stylesList[e].transforms.push(t)},CVShapeElement.prototype.removeTransformFromStyleList=function(){var t,e=this.stylesList.length;for(t=0;t<e;t+=1)this.stylesList[t].closed||this.stylesList[t].transforms.pop()},CVShapeElement.prototype.closeStyles=function(t){var e,i=t.length;for(e=0;e<i;e+=1)t[e].closed=!0},CVShapeElement.prototype.searchShapes=function(t,e,i,n,r){var s,a,o,l,h,c,u=t.length-1,d=[],p=[],f=[].concat(r);for(s=u;s>=0;s-=1){if((l=this.searchProcessedElement(t[s]))?e[s]=i[l-1]:t[s]._shouldRender=n,"fl"===t[s].ty||"st"===t[s].ty||"gf"===t[s].ty||"gs"===t[s].ty)l?e[s].style.closed=!1:e[s]=this.createStyleElement(t[s],f),d.push(e[s].style);else if("gr"===t[s].ty){if(l)for(o=e[s].it.length,a=0;a<o;a+=1)e[s].prevViewData[a]=e[s].it[a];else e[s]=this.createGroupElement(t[s]);this.searchShapes(t[s].it,e[s].it,e[s].prevViewData,n,f)}else"tr"===t[s].ty?(l||(c=this.createTransformElement(t[s]),e[s]=c),f.push(e[s]),this.addTransformToStyleList(e[s])):"sh"===t[s].ty||"rc"===t[s].ty||"el"===t[s].ty||"sr"===t[s].ty?l||(e[s]=this.createShapeElement(t[s])):"tm"===t[s].ty||"rd"===t[s].ty||"pb"===t[s].ty||"zz"===t[s].ty||"op"===t[s].ty?(l?(h=e[s]).closed=!1:((h=ShapeModifiers.getModifier(t[s].ty)).init(this,t[s]),e[s]=h,this.shapeModifiers.push(h)),p.push(h)):"rp"===t[s].ty&&(l?(h=e[s]).closed=!0:(h=ShapeModifiers.getModifier(t[s].ty),e[s]=h,h.init(this,t,s,e),this.shapeModifiers.push(h),n=!1),p.push(h));this.addProcessedElement(t[s],s+1)}for(this.removeTransformFromStyleList(),this.closeStyles(d),u=p.length,s=0;s<u;s+=1)p[s].closed=!0},CVShapeElement.prototype.renderInnerContent=function(){this.transformHelper.opacity=1,this.transformHelper._opMdf=!1,this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame),this.renderShape(this.transformHelper,this.shapesData,this.itemsData,!0)},CVShapeElement.prototype.renderShapeTransform=function(t,e){(t._opMdf||e.op._mdf||this._isFirstFrame)&&(e.opacity=t.opacity,e.opacity*=e.op.v,e._opMdf=!0)},CVShapeElement.prototype.drawLayer=function(){var t,e,i,n,r,s,a,o,l,h=this.stylesList.length,c=this.globalData.renderer,u=this.globalData.canvasContext;for(t=0;t<h;t+=1)if(("st"!==(o=(l=this.stylesList[t]).type)&&"gs"!==o||0!==l.wi)&&l.data._shouldRender&&0!==l.coOp&&0!==this.globalData.currentGlobalAlpha){for(c.save(),s=l.elements,"st"===o||"gs"===o?(c.ctxStrokeStyle("st"===o?l.co:l.grd),c.ctxLineWidth(l.wi),c.ctxLineCap(l.lc),c.ctxLineJoin(l.lj),c.ctxMiterLimit(l.ml||0)):c.ctxFillStyle("fl"===o?l.co:l.grd),c.ctxOpacity(l.coOp),"st"!==o&&"gs"!==o&&u.beginPath(),c.ctxTransform(l.preTransforms.finalTransform.props),i=s.length,e=0;e<i;e+=1){for("st"!==o&&"gs"!==o||(u.beginPath(),l.da&&(u.setLineDash(l.da),u.lineDashOffset=l.do)),r=(a=s[e].trNodes).length,n=0;n<r;n+=1)"m"===a[n].t?u.moveTo(a[n].p[0],a[n].p[1]):"c"===a[n].t?u.bezierCurveTo(a[n].pts[0],a[n].pts[1],a[n].pts[2],a[n].pts[3],a[n].pts[4],a[n].pts[5]):u.closePath();"st"!==o&&"gs"!==o||(c.ctxStroke(),l.da&&u.setLineDash(this.dashResetter))}"st"!==o&&"gs"!==o&&this.globalData.renderer.ctxFill(l.r),c.restore()}},CVShapeElement.prototype.renderShape=function(t,e,i,n){var r,s;for(s=t,r=e.length-1;r>=0;r-=1)"tr"===e[r].ty?(s=i[r].transform,this.renderShapeTransform(t,s)):"sh"===e[r].ty||"el"===e[r].ty||"rc"===e[r].ty||"sr"===e[r].ty?this.renderPath(e[r],i[r]):"fl"===e[r].ty?this.renderFill(e[r],i[r],s):"st"===e[r].ty?this.renderStroke(e[r],i[r],s):"gf"===e[r].ty||"gs"===e[r].ty?this.renderGradientFill(e[r],i[r],s):"gr"===e[r].ty?this.renderShape(s,e[r].it,i[r].it):e[r].ty;n&&this.drawLayer()},CVShapeElement.prototype.renderStyledShape=function(t,e){if(this._isFirstFrame||e._mdf||t.transforms._mdf){var i,n,r,s=t.trNodes,a=e.paths,o=a._length;s.length=0;var l=t.transforms.finalTransform;for(r=0;r<o;r+=1){var h=a.shapes[r];if(h&&h.v){for(n=h._length,i=1;i<n;i+=1)1===i&&s.push({t:"m",p:l.applyToPointArray(h.v[0][0],h.v[0][1],0)}),s.push({t:"c",pts:l.applyToTriplePoints(h.o[i-1],h.i[i],h.v[i])});1===n&&s.push({t:"m",p:l.applyToPointArray(h.v[0][0],h.v[0][1],0)}),h.c&&n&&(s.push({t:"c",pts:l.applyToTriplePoints(h.o[i-1],h.i[0],h.v[0])}),s.push({t:"z"}))}}t.trNodes=s}},CVShapeElement.prototype.renderPath=function(t,e){if(!0!==t.hd&&t._shouldRender){var i,n=e.styledShapes.length;for(i=0;i<n;i+=1)this.renderStyledShape(e.styledShapes[i],e.sh)}},CVShapeElement.prototype.renderFill=function(t,e,i){var n=e.style;(e.c._mdf||this._isFirstFrame)&&(n.co="rgb("+bmFloor(e.c.v[0])+","+bmFloor(e.c.v[1])+","+bmFloor(e.c.v[2])+")"),(e.o._mdf||i._opMdf||this._isFirstFrame)&&(n.coOp=e.o.v*i.opacity)},CVShapeElement.prototype.renderGradientFill=function(t,e,i){var n,r=e.style;if(!r.grd||e.g._mdf||e.s._mdf||e.e._mdf||1!==t.t&&(e.h._mdf||e.a._mdf)){var s,a=this.globalData.canvasContext,o=e.s.v,l=e.e.v;if(1===t.t)n=a.createLinearGradient(o[0],o[1],l[0],l[1]);else{var h=Math.sqrt(Math.pow(o[0]-l[0],2)+Math.pow(o[1]-l[1],2)),c=Math.atan2(l[1]-o[1],l[0]-o[0]),u=e.h.v;u>=1?u=.99:u<=-1&&(u=-.99);var d=h*u,p=Math.cos(c+e.a.v)*d+o[0],f=Math.sin(c+e.a.v)*d+o[1];n=a.createRadialGradient(p,f,0,o[0],o[1],h)}var m=t.g.p,g=e.g.c,v=1;for(s=0;s<m;s+=1)e.g._hasOpacity&&e.g._collapsable&&(v=e.g.o[2*s+1]),n.addColorStop(g[4*s]/100,"rgba("+g[4*s+1]+","+g[4*s+2]+","+g[4*s+3]+","+v+")");r.grd=n}r.coOp=e.o.v*i.opacity},CVShapeElement.prototype.renderStroke=function(t,e,i){var n=e.style,r=e.d;r&&(r._mdf||this._isFirstFrame)&&(n.da=r.dashArray,n.do=r.dashoffset[0]),(e.c._mdf||this._isFirstFrame)&&(n.co="rgb("+bmFloor(e.c.v[0])+","+bmFloor(e.c.v[1])+","+bmFloor(e.c.v[2])+")"),(e.o._mdf||i._opMdf||this._isFirstFrame)&&(n.coOp=e.o.v*i.opacity),(e.w._mdf||this._isFirstFrame)&&(n.wi=e.w.v)},CVShapeElement.prototype.destroy=function(){this.shapesData=null,this.globalData=null,this.canvasContext=null,this.stylesList.length=0,this.itemsData.length=0},extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement,ITextElement],CVTextElement),CVTextElement.prototype.tHelper=createTag("canvas").getContext("2d"),CVTextElement.prototype.buildNewText=function(){var t=this.textProperty.currentData;this.renderedLetters=createSizedArray(t.l?t.l.length:0);var e=!1;t.fc?(e=!0,this.values.fill=this.buildColor(t.fc)):this.values.fill="rgba(0,0,0,0)",this.fill=e;var i=!1;t.sc&&(i=!0,this.values.stroke=this.buildColor(t.sc),this.values.sWidth=t.sw);var n,r,s,a,o,l,h,c,u,d,p,f,m=this.globalData.fontManager.getFontByName(t.f),g=t.l,v=this.mHelper;this.stroke=i,this.values.fValue=t.finalSize+"px "+this.globalData.fontManager.getFontByName(t.f).fFamily,r=t.finalText.length;var y=this.data.singleShape,b=.001*t.tr*t.finalSize,x=0,w=0,S=!0,A=0;for(n=0;n<r;n+=1){a=(s=this.globalData.fontManager.getCharData(t.finalText[n],m.fStyle,this.globalData.fontManager.getFontByName(t.f).fFamily))&&s.data||{},v.reset(),y&&g[n].n&&(x=-b,w+=t.yOffset,w+=S?1:0,S=!1),u=(h=a.shapes?a.shapes[0].it:[]).length,v.scale(t.finalSize/100,t.finalSize/100),y&&this.applyTextPropertiesToMatrix(t,v,g[n].line,x,w),p=createSizedArray(u-1);var E=0;for(c=0;c<u;c+=1)if("sh"===h[c].ty){for(l=h[c].ks.k.i.length,d=h[c].ks.k,f=[],o=1;o<l;o+=1)1===o&&f.push(v.applyToX(d.v[0][0],d.v[0][1],0),v.applyToY(d.v[0][0],d.v[0][1],0)),f.push(v.applyToX(d.o[o-1][0],d.o[o-1][1],0),v.applyToY(d.o[o-1][0],d.o[o-1][1],0),v.applyToX(d.i[o][0],d.i[o][1],0),v.applyToY(d.i[o][0],d.i[o][1],0),v.applyToX(d.v[o][0],d.v[o][1],0),v.applyToY(d.v[o][0],d.v[o][1],0));f.push(v.applyToX(d.o[o-1][0],d.o[o-1][1],0),v.applyToY(d.o[o-1][0],d.o[o-1][1],0),v.applyToX(d.i[0][0],d.i[0][1],0),v.applyToY(d.i[0][0],d.i[0][1],0),v.applyToX(d.v[0][0],d.v[0][1],0),v.applyToY(d.v[0][0],d.v[0][1],0)),p[E]=f,E+=1}y&&(x+=g[n].l,x+=b),this.textSpans[A]?this.textSpans[A].elem=p:this.textSpans[A]={elem:p},A+=1}},CVTextElement.prototype.renderInnerContent=function(){var t,e,i,n,r,s;this.validateText(),this.canvasContext.font=this.values.fValue,this.globalData.renderer.ctxLineCap("butt"),this.globalData.renderer.ctxLineJoin("miter"),this.globalData.renderer.ctxMiterLimit(4),this.data.singleShape||this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag);var a,o=this.textAnimator.renderedLetters,l=this.textProperty.currentData.l;e=l.length;var h,c,u=null,d=null,p=null,f=this.globalData.renderer;for(t=0;t<e;t+=1)if(!l[t].n){if((a=o[t])&&(f.save(),f.ctxTransform(a.p),f.ctxOpacity(a.o)),this.fill){for(a&&a.fc?u!==a.fc&&(f.ctxFillStyle(a.fc),u=a.fc):u!==this.values.fill&&(u=this.values.fill,f.ctxFillStyle(this.values.fill)),n=(h=this.textSpans[t].elem).length,this.globalData.canvasContext.beginPath(),i=0;i<n;i+=1)for(s=(c=h[i]).length,this.globalData.canvasContext.moveTo(c[0],c[1]),r=2;r<s;r+=6)this.globalData.canvasContext.bezierCurveTo(c[r],c[r+1],c[r+2],c[r+3],c[r+4],c[r+5]);this.globalData.canvasContext.closePath(),f.ctxFill()}if(this.stroke){for(a&&a.sw?p!==a.sw&&(p=a.sw,f.ctxLineWidth(a.sw)):p!==this.values.sWidth&&(p=this.values.sWidth,f.ctxLineWidth(this.values.sWidth)),a&&a.sc?d!==a.sc&&(d=a.sc,f.ctxStrokeStyle(a.sc)):d!==this.values.stroke&&(d=this.values.stroke,f.ctxStrokeStyle(this.values.stroke)),n=(h=this.textSpans[t].elem).length,this.globalData.canvasContext.beginPath(),i=0;i<n;i+=1)for(s=(c=h[i]).length,this.globalData.canvasContext.moveTo(c[0],c[1]),r=2;r<s;r+=6)this.globalData.canvasContext.bezierCurveTo(c[r],c[r+1],c[r+2],c[r+3],c[r+4],c[r+5]);this.globalData.canvasContext.closePath(),f.ctxStroke()}a&&this.globalData.renderer.restore()}},extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVImageElement),CVImageElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVImageElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVImageElement.prototype.createContent=function(){if(this.img.width&&(this.assetData.w!==this.img.width||this.assetData.h!==this.img.height)){var t=createTag("canvas");t.width=this.assetData.w,t.height=this.assetData.h;var e,i,n=t.getContext("2d"),r=this.img.width,s=this.img.height,a=r/s,o=this.assetData.w/this.assetData.h,l=this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio;a>o&&"xMidYMid slice"===l||a<o&&"xMidYMid slice"!==l?e=(i=s)*o:i=(e=r)/o,n.drawImage(this.img,(r-e)/2,(s-i)/2,e,i,0,0,this.assetData.w,this.assetData.h),this.img=t}},CVImageElement.prototype.renderInnerContent=function(){this.canvasContext.drawImage(this.img,0,0)},CVImageElement.prototype.destroy=function(){this.img=null},extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVSolidElement),CVSolidElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVSolidElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVSolidElement.prototype.renderInnerContent=function(){this.globalData.renderer.ctxFillStyle(this.data.sc),this.globalData.renderer.ctxFillRect(0,0,this.data.sw,this.data.sh)},extendPrototype([BaseRenderer],CanvasRendererBase),CanvasRendererBase.prototype.createShape=function(t){return new CVShapeElement(t,this.globalData,this)},CanvasRendererBase.prototype.createText=function(t){return new CVTextElement(t,this.globalData,this)},CanvasRendererBase.prototype.createImage=function(t){return new CVImageElement(t,this.globalData,this)},CanvasRendererBase.prototype.createSolid=function(t){return new CVSolidElement(t,this.globalData,this)},CanvasRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,CanvasRendererBase.prototype.ctxTransform=function(t){1===t[0]&&0===t[1]&&0===t[4]&&1===t[5]&&0===t[12]&&0===t[13]||this.canvasContext.transform(t[0],t[1],t[4],t[5],t[12],t[13])},CanvasRendererBase.prototype.ctxOpacity=function(t){this.canvasContext.globalAlpha*=t<0?0:t},CanvasRendererBase.prototype.ctxFillStyle=function(t){this.canvasContext.fillStyle=t},CanvasRendererBase.prototype.ctxStrokeStyle=function(t){this.canvasContext.strokeStyle=t},CanvasRendererBase.prototype.ctxLineWidth=function(t){this.canvasContext.lineWidth=t},CanvasRendererBase.prototype.ctxLineCap=function(t){this.canvasContext.lineCap=t},CanvasRendererBase.prototype.ctxLineJoin=function(t){this.canvasContext.lineJoin=t},CanvasRendererBase.prototype.ctxMiterLimit=function(t){this.canvasContext.miterLimit=t},CanvasRendererBase.prototype.ctxFill=function(t){this.canvasContext.fill(t)},CanvasRendererBase.prototype.ctxFillRect=function(t,e,i,n){this.canvasContext.fillRect(t,e,i,n)},CanvasRendererBase.prototype.ctxStroke=function(){this.canvasContext.stroke()},CanvasRendererBase.prototype.reset=function(){this.renderConfig.clearCanvas?this.contextData.reset():this.canvasContext.restore()},CanvasRendererBase.prototype.save=function(){this.canvasContext.save()},CanvasRendererBase.prototype.restore=function(t){this.renderConfig.clearCanvas?(t&&(this.globalData.blendMode="source-over"),this.contextData.restore(t)):this.canvasContext.restore()},CanvasRendererBase.prototype.configAnimation=function(t){if(this.animationItem.wrapper){this.animationItem.container=createTag("canvas");var e=this.animationItem.container.style;e.width="100%",e.height="100%";var i="0px 0px 0px";e.transformOrigin=i,e.mozTransformOrigin=i,e.webkitTransformOrigin=i,e["-webkit-transform"]=i,e.contentVisibility=this.renderConfig.contentVisibility,this.animationItem.wrapper.appendChild(this.animationItem.container),this.canvasContext=this.animationItem.container.getContext("2d"),this.renderConfig.className&&this.animationItem.container.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.animationItem.container.setAttribute("id",this.renderConfig.id)}else this.canvasContext=this.renderConfig.context;this.contextData.setContext(this.canvasContext),this.data=t,this.layers=t.layers,this.transformCanvas={w:t.w,h:t.h,sx:0,sy:0,tx:0,ty:0},this.setupGlobalData(t,document.body),this.globalData.canvasContext=this.canvasContext,this.globalData.renderer=this,this.globalData.isDashed=!1,this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.globalData.transformCanvas=this.transformCanvas,this.elements=createSizedArray(t.layers.length),this.updateContainerSize()},CanvasRendererBase.prototype.updateContainerSize=function(t,e){var i,n,r,s;if(this.reset(),t?(i=t,n=e,this.canvasContext.canvas.width=i,this.canvasContext.canvas.height=n):(this.animationItem.wrapper&&this.animationItem.container?(i=this.animationItem.wrapper.offsetWidth,n=this.animationItem.wrapper.offsetHeight):(i=this.canvasContext.canvas.width,n=this.canvasContext.canvas.height),this.canvasContext.canvas.width=i*this.renderConfig.dpr,this.canvasContext.canvas.height=n*this.renderConfig.dpr),-1!==this.renderConfig.preserveAspectRatio.indexOf("meet")||-1!==this.renderConfig.preserveAspectRatio.indexOf("slice")){var a=this.renderConfig.preserveAspectRatio.split(" "),o=a[1]||"meet",l=a[0]||"xMidYMid",h=l.substr(0,4),c=l.substr(4);r=i/n,(s=this.transformCanvas.w/this.transformCanvas.h)>r&&"meet"===o||s<r&&"slice"===o?(this.transformCanvas.sx=i/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=i/(this.transformCanvas.w/this.renderConfig.dpr)):(this.transformCanvas.sx=n/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.sy=n/(this.transformCanvas.h/this.renderConfig.dpr)),this.transformCanvas.tx="xMid"===h&&(s<r&&"meet"===o||s>r&&"slice"===o)?(i-this.transformCanvas.w*(n/this.transformCanvas.h))/2*this.renderConfig.dpr:"xMax"===h&&(s<r&&"meet"===o||s>r&&"slice"===o)?(i-this.transformCanvas.w*(n/this.transformCanvas.h))*this.renderConfig.dpr:0,this.transformCanvas.ty="YMid"===c&&(s>r&&"meet"===o||s<r&&"slice"===o)?(n-this.transformCanvas.h*(i/this.transformCanvas.w))/2*this.renderConfig.dpr:"YMax"===c&&(s>r&&"meet"===o||s<r&&"slice"===o)?(n-this.transformCanvas.h*(i/this.transformCanvas.w))*this.renderConfig.dpr:0}else"none"===this.renderConfig.preserveAspectRatio?(this.transformCanvas.sx=i/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=n/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.tx=0,this.transformCanvas.ty=0):(this.transformCanvas.sx=this.renderConfig.dpr,this.transformCanvas.sy=this.renderConfig.dpr,this.transformCanvas.tx=0,this.transformCanvas.ty=0);this.transformCanvas.props=[this.transformCanvas.sx,0,0,0,0,this.transformCanvas.sy,0,0,0,0,1,0,this.transformCanvas.tx,this.transformCanvas.ty,0,1],this.ctxTransform(this.transformCanvas.props),this.canvasContext.beginPath(),this.canvasContext.rect(0,0,this.transformCanvas.w,this.transformCanvas.h),this.canvasContext.closePath(),this.canvasContext.clip(),this.renderFrame(this.renderedFrame,!0)},CanvasRendererBase.prototype.destroy=function(){var t;for(this.renderConfig.clearCanvas&&this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),t=(this.layers?this.layers.length:0)-1;t>=0;t-=1)this.elements[t]&&this.elements[t].destroy&&this.elements[t].destroy();this.elements.length=0,this.globalData.canvasContext=null,this.animationItem.container=null,this.destroyed=!0},CanvasRendererBase.prototype.renderFrame=function(t,e){if((this.renderedFrame!==t||!0!==this.renderConfig.clearCanvas||e)&&!this.destroyed&&-1!==t){var i;this.renderedFrame=t,this.globalData.frameNum=t-this.animationItem._isFirstFrame,this.globalData.frameId+=1,this.globalData._mdf=!this.renderConfig.clearCanvas||e,this.globalData.projectInterface.currentFrame=t;var n=this.layers.length;for(this.completeLayers||this.checkLayers(t),i=n-1;i>=0;i-=1)(this.completeLayers||this.elements[i])&&this.elements[i].prepareFrame(t-this.layers[i].st);if(this.globalData._mdf){for(!0===this.renderConfig.clearCanvas?this.canvasContext.clearRect(0,0,this.transformCanvas.w,this.transformCanvas.h):this.save(),i=n-1;i>=0;i-=1)(this.completeLayers||this.elements[i])&&this.elements[i].renderFrame();!0!==this.renderConfig.clearCanvas&&this.restore()}}},CanvasRendererBase.prototype.buildItem=function(t){var e=this.elements;if(!e[t]&&99!==this.layers[t].ty){var i=this.createItem(this.layers[t],this,this.globalData);e[t]=i,i.initExpressions()}},CanvasRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;)this.pendingElements.pop().checkParenting()},CanvasRendererBase.prototype.hide=function(){this.animationItem.container.style.display="none"},CanvasRendererBase.prototype.show=function(){this.animationItem.container.style.display="block"},CVContextData.prototype.duplicate=function(){var t=2*this._length,e=0;for(e=this._length;e<t;e+=1)this.stack[e]=new CanvasContext;this._length=t},CVContextData.prototype.reset=function(){this.cArrPos=0,this.cTr.reset(),this.stack[this.cArrPos].opacity=1},CVContextData.prototype.restore=function(t){this.cArrPos-=1;var e,i=this.stack[this.cArrPos],n=i.transform,r=this.cTr.props;for(e=0;e<16;e+=1)r[e]=n[e];if(t){this.nativeContext.restore();var s=this.stack[this.cArrPos+1];this.appliedFillStyle=s.fillStyle,this.appliedStrokeStyle=s.strokeStyle,this.appliedLineWidth=s.lineWidth,this.appliedLineCap=s.lineCap,this.appliedLineJoin=s.lineJoin,this.appliedMiterLimit=s.miterLimit}this.nativeContext.setTransform(n[0],n[1],n[4],n[5],n[12],n[13]),(t||-1!==i.opacity&&this.currentOpacity!==i.opacity)&&(this.nativeContext.globalAlpha=i.opacity,this.currentOpacity=i.opacity),this.currentFillStyle=i.fillStyle,this.currentStrokeStyle=i.strokeStyle,this.currentLineWidth=i.lineWidth,this.currentLineCap=i.lineCap,this.currentLineJoin=i.lineJoin,this.currentMiterLimit=i.miterLimit},CVContextData.prototype.save=function(t){t&&this.nativeContext.save();var e=this.cTr.props;this._length<=this.cArrPos&&this.duplicate();var i,n=this.stack[this.cArrPos];for(i=0;i<16;i+=1)n.transform[i]=e[i];this.cArrPos+=1;var r=this.stack[this.cArrPos];r.opacity=n.opacity,r.fillStyle=n.fillStyle,r.strokeStyle=n.strokeStyle,r.lineWidth=n.lineWidth,r.lineCap=n.lineCap,r.lineJoin=n.lineJoin,r.miterLimit=n.miterLimit},CVContextData.prototype.setOpacity=function(t){this.stack[this.cArrPos].opacity=t},CVContextData.prototype.setContext=function(t){this.nativeContext=t},CVContextData.prototype.fillStyle=function(t){this.stack[this.cArrPos].fillStyle!==t&&(this.currentFillStyle=t,this.stack[this.cArrPos].fillStyle=t)},CVContextData.prototype.strokeStyle=function(t){this.stack[this.cArrPos].strokeStyle!==t&&(this.currentStrokeStyle=t,this.stack[this.cArrPos].strokeStyle=t)},CVContextData.prototype.lineWidth=function(t){this.stack[this.cArrPos].lineWidth!==t&&(this.currentLineWidth=t,this.stack[this.cArrPos].lineWidth=t)},CVContextData.prototype.lineCap=function(t){this.stack[this.cArrPos].lineCap!==t&&(this.currentLineCap=t,this.stack[this.cArrPos].lineCap=t)},CVContextData.prototype.lineJoin=function(t){this.stack[this.cArrPos].lineJoin!==t&&(this.currentLineJoin=t,this.stack[this.cArrPos].lineJoin=t)},CVContextData.prototype.miterLimit=function(t){this.stack[this.cArrPos].miterLimit!==t&&(this.currentMiterLimit=t,this.stack[this.cArrPos].miterLimit=t)},CVContextData.prototype.transform=function(t){this.transformMat.cloneFromProps(t);var e=this.cTr;this.transformMat.multiply(e),e.cloneFromProps(this.transformMat.props);var i=e.props;this.nativeContext.setTransform(i[0],i[1],i[4],i[5],i[12],i[13])},CVContextData.prototype.opacity=function(t){var e=this.stack[this.cArrPos].opacity;e*=t<0?0:t,this.stack[this.cArrPos].opacity!==e&&(this.currentOpacity!==t&&(this.nativeContext.globalAlpha=t,this.currentOpacity=t),this.stack[this.cArrPos].opacity=e)},CVContextData.prototype.fill=function(t){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fill(t)},CVContextData.prototype.fillRect=function(t,e,i,n){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fillRect(t,e,i,n)},CVContextData.prototype.stroke=function(){this.appliedStrokeStyle!==this.currentStrokeStyle&&(this.appliedStrokeStyle=this.currentStrokeStyle,this.nativeContext.strokeStyle=this.appliedStrokeStyle),this.appliedLineWidth!==this.currentLineWidth&&(this.appliedLineWidth=this.currentLineWidth,this.nativeContext.lineWidth=this.appliedLineWidth),this.appliedLineCap!==this.currentLineCap&&(this.appliedLineCap=this.currentLineCap,this.nativeContext.lineCap=this.appliedLineCap),this.appliedLineJoin!==this.currentLineJoin&&(this.appliedLineJoin=this.currentLineJoin,this.nativeContext.lineJoin=this.appliedLineJoin),this.appliedMiterLimit!==this.currentMiterLimit&&(this.appliedMiterLimit=this.currentMiterLimit,this.nativeContext.miterLimit=this.appliedMiterLimit),this.nativeContext.stroke()},extendPrototype([CanvasRendererBase,ICompElement,CVBaseElement],CVCompElement),CVCompElement.prototype.renderInnerContent=function(){var t,e=this.canvasContext;for(e.beginPath(),e.moveTo(0,0),e.lineTo(this.data.w,0),e.lineTo(this.data.w,this.data.h),e.lineTo(0,this.data.h),e.lineTo(0,0),e.clip(),t=this.layers.length-1;t>=0;t-=1)(this.completeLayers||this.elements[t])&&this.elements[t].renderFrame()},CVCompElement.prototype.destroy=function(){var t;for(t=this.layers.length-1;t>=0;t-=1)this.elements[t]&&this.elements[t].destroy();this.layers=null,this.elements=null},CVCompElement.prototype.createComp=function(t){return new CVCompElement(t,this.globalData,this)},extendPrototype([CanvasRendererBase],CanvasRenderer),CanvasRenderer.prototype.createComp=function(t){return new CVCompElement(t,this.globalData,this)},HBaseElement.prototype={checkBlendMode:function(){},initRendererElement:function(){this.baseElement=createTag(this.data.tg||"div"),this.data.hasMask?(this.svgElement=createNS("svg"),this.layerElement=createNS("g"),this.maskedElement=this.layerElement,this.svgElement.appendChild(this.layerElement),this.baseElement.appendChild(this.svgElement)):this.layerElement=this.baseElement,styleDiv(this.baseElement)},createContainerElements:function(){this.renderableEffectsManager=new CVEffects(this),this.transformedElement=this.baseElement,this.maskedElement=this.layerElement,this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),0!==this.data.bm&&this.setBlendMode()},renderElement:function(){var t=this.transformedElement?this.transformedElement.style:{};if(this.finalTransform._matMdf){var e=this.finalTransform.mat.toCSS();t.transform=e,t.webkitTransform=e}this.finalTransform._opMdf&&(t.opacity=this.finalTransform.mProp.o.v)},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},destroy:function(){this.layerElement=null,this.transformedElement=null,this.matteElement&&(this.matteElement=null),this.maskManager&&(this.maskManager.destroy(),this.maskManager=null)},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData)},addEffects:function(){},setMatte:function(){}},HBaseElement.prototype.getBaseElement=SVGBaseElement.prototype.getBaseElement,HBaseElement.prototype.destroyBaseElement=HBaseElement.prototype.destroy,HBaseElement.prototype.buildElementParenting=BaseRenderer.prototype.buildElementParenting,extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],HSolidElement),HSolidElement.prototype.createContent=function(){var t;this.data.hasMask?((t=createNS("rect")).setAttribute("width",this.data.sw),t.setAttribute("height",this.data.sh),t.setAttribute("fill",this.data.sc),this.svgElement.setAttribute("width",this.data.sw),this.svgElement.setAttribute("height",this.data.sh)):((t=createTag("div")).style.width=this.data.sw+"px",t.style.height=this.data.sh+"px",t.style.backgroundColor=this.data.sc),this.layerElement.appendChild(t)},extendPrototype([BaseElement,TransformElement,HSolidElement,SVGShapeElement,HBaseElement,HierarchyElement,FrameElement,RenderableElement],HShapeElement),HShapeElement.prototype._renderShapeFrame=HShapeElement.prototype.renderInnerContent,HShapeElement.prototype.createContent=function(){var t;if(this.baseElement.style.fontSize=0,this.data.hasMask)this.layerElement.appendChild(this.shapesContainer),t=this.svgElement;else{t=createNS("svg");var e=this.comp.data?this.comp.data:this.globalData.compSize;t.setAttribute("width",e.w),t.setAttribute("height",e.h),t.appendChild(this.shapesContainer),this.layerElement.appendChild(t)}this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.shapesContainer,0,[],!0),this.filterUniqueShapes(),this.shapeCont=t},HShapeElement.prototype.getTransformedPoint=function(t,e){var i,n=t.length;for(i=0;i<n;i+=1)e=t[i].mProps.v.applyToPointArray(e[0],e[1],0);return e},HShapeElement.prototype.calculateShapeBoundingBox=function(t,e){var i,n,r,s,a,o=t.sh.v,l=t.transformers,h=o._length;if(!(h<=1)){for(i=0;i<h-1;i+=1)n=this.getTransformedPoint(l,o.v[i]),r=this.getTransformedPoint(l,o.o[i]),s=this.getTransformedPoint(l,o.i[i+1]),a=this.getTransformedPoint(l,o.v[i+1]),this.checkBounds(n,r,s,a,e);o.c&&(n=this.getTransformedPoint(l,o.v[i]),r=this.getTransformedPoint(l,o.o[i]),s=this.getTransformedPoint(l,o.i[0]),a=this.getTransformedPoint(l,o.v[0]),this.checkBounds(n,r,s,a,e))}},HShapeElement.prototype.checkBounds=function(t,e,i,n,r){this.getBoundsOfCurve(t,e,i,n);var s=this.shapeBoundingBox;r.x=bmMin(s.left,r.x),r.xMax=bmMax(s.right,r.xMax),r.y=bmMin(s.top,r.y),r.yMax=bmMax(s.bottom,r.yMax)},HShapeElement.prototype.shapeBoundingBox={left:0,right:0,top:0,bottom:0},HShapeElement.prototype.tempBoundingBox={x:0,xMax:0,y:0,yMax:0,width:0,height:0},HShapeElement.prototype.getBoundsOfCurve=function(t,e,i,n){for(var r,s,a,o,l,h,c,u=[[t[0],n[0]],[t[1],n[1]]],d=0;d<2;++d)s=6*t[d]-12*e[d]+6*i[d],r=-3*t[d]+9*e[d]-9*i[d]+3*n[d],a=3*e[d]-3*t[d],s|=0,a|=0,0===(r|=0)&&0===s||(0===r?(o=-a/s)>0&&o<1&&u[d].push(this.calculateF(o,t,e,i,n,d)):(l=s*s-4*a*r)>=0&&((h=(-s+bmSqrt(l))/(2*r))>0&&h<1&&u[d].push(this.calculateF(h,t,e,i,n,d)),(c=(-s-bmSqrt(l))/(2*r))>0&&c<1&&u[d].push(this.calculateF(c,t,e,i,n,d))));this.shapeBoundingBox.left=bmMin.apply(null,u[0]),this.shapeBoundingBox.top=bmMin.apply(null,u[1]),this.shapeBoundingBox.right=bmMax.apply(null,u[0]),this.shapeBoundingBox.bottom=bmMax.apply(null,u[1])},HShapeElement.prototype.calculateF=function(t,e,i,n,r,s){return bmPow(1-t,3)*e[s]+3*bmPow(1-t,2)*t*i[s]+3*(1-t)*bmPow(t,2)*n[s]+bmPow(t,3)*r[s]},HShapeElement.prototype.calculateBoundingBox=function(t,e){var i,n=t.length;for(i=0;i<n;i+=1)t[i]&&t[i].sh?this.calculateShapeBoundingBox(t[i],e):t[i]&&t[i].it?this.calculateBoundingBox(t[i].it,e):t[i]&&t[i].style&&t[i].w&&this.expandStrokeBoundingBox(t[i].w,e)},HShapeElement.prototype.expandStrokeBoundingBox=function(t,e){var i=0;if(t.keyframes){for(var n=0;n<t.keyframes.length;n+=1){var r=t.keyframes[n].s;r>i&&(i=r)}i*=t.mult}else i=t.v*t.mult;e.x-=i,e.xMax+=i,e.y-=i,e.yMax+=i},HShapeElement.prototype.currentBoxContains=function(t){return this.currentBBox.x<=t.x&&this.currentBBox.y<=t.y&&this.currentBBox.width+this.currentBBox.x>=t.x+t.width&&this.currentBBox.height+this.currentBBox.y>=t.y+t.height},HShapeElement.prototype.renderInnerContent=function(){if(this._renderShapeFrame(),!this.hidden&&(this._isFirstFrame||this._mdf)){var t=this.tempBoundingBox,e=999999;if(t.x=e,t.xMax=-e,t.y=e,t.yMax=-e,this.calculateBoundingBox(this.itemsData,t),t.width=t.xMax<t.x?0:t.xMax-t.x,t.height=t.yMax<t.y?0:t.yMax-t.y,this.currentBoxContains(t))return;var i=!1;if(this.currentBBox.w!==t.width&&(this.currentBBox.w=t.width,this.shapeCont.setAttribute("width",t.width),i=!0),this.currentBBox.h!==t.height&&(this.currentBBox.h=t.height,this.shapeCont.setAttribute("height",t.height),i=!0),i||this.currentBBox.x!==t.x||this.currentBBox.y!==t.y){this.currentBBox.w=t.width,this.currentBBox.h=t.height,this.currentBBox.x=t.x,this.currentBBox.y=t.y,this.shapeCont.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h);var n=this.shapeCont.style,r="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";n.transform=r,n.webkitTransform=r}}},extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],HTextElement),HTextElement.prototype.createContent=function(){if(this.isMasked=this.checkMasks(),this.isMasked){this.renderType="svg",this.compW=this.comp.data.w,this.compH=this.comp.data.h,this.svgElement.setAttribute("width",this.compW),this.svgElement.setAttribute("height",this.compH);var t=createNS("g");this.maskedElement.appendChild(t),this.innerElem=t}else this.renderType="html",this.innerElem=this.layerElement;this.checkParenting()},HTextElement.prototype.buildNewText=function(){var t=this.textProperty.currentData;this.renderedLetters=createSizedArray(t.l?t.l.length:0);var e=this.innerElem.style,i=t.fc?this.buildColor(t.fc):"rgba(0,0,0,0)";e.fill=i,e.color=i,t.sc&&(e.stroke=this.buildColor(t.sc),e.strokeWidth=t.sw+"px");var n,r,s=this.globalData.fontManager.getFontByName(t.f);if(!this.globalData.fontManager.chars)if(e.fontSize=t.finalSize+"px",e.lineHeight=t.finalSize+"px",s.fClass)this.innerElem.className=s.fClass;else{e.fontFamily=s.fFamily;var a=t.fWeight,o=t.fStyle;e.fontStyle=o,e.fontWeight=a}var l,h,c,u=t.l;r=u.length;var d,p=this.mHelper,f="",m=0;for(n=0;n<r;n+=1){if(this.globalData.fontManager.chars?(this.textPaths[m]?l=this.textPaths[m]:((l=createNS("path")).setAttribute("stroke-linecap",lineCapEnum[1]),l.setAttribute("stroke-linejoin",lineJoinEnum[2]),l.setAttribute("stroke-miterlimit","4")),this.isMasked||(this.textSpans[m]?c=(h=this.textSpans[m]).children[0]:((h=createTag("div")).style.lineHeight=0,(c=createNS("svg")).appendChild(l),styleDiv(h)))):this.isMasked?l=this.textPaths[m]?this.textPaths[m]:createNS("text"):this.textSpans[m]?(h=this.textSpans[m],l=this.textPaths[m]):(styleDiv(h=createTag("span")),styleDiv(l=createTag("span")),h.appendChild(l)),this.globalData.fontManager.chars){var g,v=this.globalData.fontManager.getCharData(t.finalText[n],s.fStyle,this.globalData.fontManager.getFontByName(t.f).fFamily);if(g=v?v.data:null,p.reset(),g&&g.shapes&&g.shapes.length&&(d=g.shapes[0].it,p.scale(t.finalSize/100,t.finalSize/100),f=this.createPathShape(p,d),l.setAttribute("d",f)),this.isMasked)this.innerElem.appendChild(l);else{if(this.innerElem.appendChild(h),g&&g.shapes){document.body.appendChild(c);var y=c.getBBox();c.setAttribute("width",y.width+2),c.setAttribute("height",y.height+2),c.setAttribute("viewBox",y.x-1+" "+(y.y-1)+" "+(y.width+2)+" "+(y.height+2));var b=c.style,x="translate("+(y.x-1)+"px,"+(y.y-1)+"px)";b.transform=x,b.webkitTransform=x,u[n].yOffset=y.y-1}else c.setAttribute("width",1),c.setAttribute("height",1);h.appendChild(c)}}else if(l.textContent=u[n].val,l.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),this.isMasked)this.innerElem.appendChild(l);else{this.innerElem.appendChild(h);var w=l.style,S="translate3d(0,"+-t.finalSize/1.2+"px,0)";w.transform=S,w.webkitTransform=S}this.isMasked?this.textSpans[m]=l:this.textSpans[m]=h,this.textSpans[m].style.display="block",this.textPaths[m]=l,m+=1}for(;m<this.textSpans.length;)this.textSpans[m].style.display="none",m+=1},HTextElement.prototype.renderInnerContent=function(){var t;if(this.validateText(),this.data.singleShape){if(!this._isFirstFrame&&!this.lettersChangedFlag)return;if(this.isMasked&&this.finalTransform._matMdf){this.svgElement.setAttribute("viewBox",-this.finalTransform.mProp.p.v[0]+" "+-this.finalTransform.mProp.p.v[1]+" "+this.compW+" "+this.compH),t=this.svgElement.style;var e="translate("+-this.finalTransform.mProp.p.v[0]+"px,"+-this.finalTransform.mProp.p.v[1]+"px)";t.transform=e,t.webkitTransform=e}}if(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),this.lettersChangedFlag||this.textAnimator.lettersChangedFlag){var i,n,r,s,a,o=0,l=this.textAnimator.renderedLetters,h=this.textProperty.currentData.l;for(n=h.length,i=0;i<n;i+=1)h[i].n?o+=1:(s=this.textSpans[i],a=this.textPaths[i],r=l[o],o+=1,r._mdf.m&&(this.isMasked?s.setAttribute("transform",r.m):(s.style.webkitTransform=r.m,s.style.transform=r.m)),s.style.opacity=r.o,r.sw&&r._mdf.sw&&a.setAttribute("stroke-width",r.sw),r.sc&&r._mdf.sc&&a.setAttribute("stroke",r.sc),r.fc&&r._mdf.fc&&(a.setAttribute("fill",r.fc),a.style.color=r.fc));if(this.innerElem.getBBox&&!this.hidden&&(this._isFirstFrame||this._mdf)){var c=this.innerElem.getBBox();if(this.currentBBox.w!==c.width&&(this.currentBBox.w=c.width,this.svgElement.setAttribute("width",c.width)),this.currentBBox.h!==c.height&&(this.currentBBox.h=c.height,this.svgElement.setAttribute("height",c.height)),this.currentBBox.w!==c.width+2||this.currentBBox.h!==c.height+2||this.currentBBox.x!==c.x-1||this.currentBBox.y!==c.y-1){this.currentBBox.w=c.width+2,this.currentBBox.h=c.height+2,this.currentBBox.x=c.x-1,this.currentBBox.y=c.y-1,this.svgElement.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h),t=this.svgElement.style;var u="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";t.transform=u,t.webkitTransform=u}}}},extendPrototype([BaseElement,FrameElement,HierarchyElement],HCameraElement),HCameraElement.prototype.setup=function(){var t,e,i,n,r=this.comp.threeDElements.length;for(t=0;t<r;t+=1)if("3d"===(e=this.comp.threeDElements[t]).type){i=e.perspectiveElem.style,n=e.container.style;var s=this.pe.v+"px",a="0px 0px 0px",o="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";i.perspective=s,i.webkitPerspective=s,n.transformOrigin=a,n.mozTransformOrigin=a,n.webkitTransformOrigin=a,i.transform=o,i.webkitTransform=o}},HCameraElement.prototype.createElements=function(){},HCameraElement.prototype.hide=function(){},HCameraElement.prototype.renderFrame=function(){var t,e,i=this._isFirstFrame;if(this.hierarchy)for(e=this.hierarchy.length,t=0;t<e;t+=1)i=this.hierarchy[t].finalTransform.mProp._mdf||i;if(i||this.pe._mdf||this.p&&this.p._mdf||this.px&&(this.px._mdf||this.py._mdf||this.pz._mdf)||this.rx._mdf||this.ry._mdf||this.rz._mdf||this.or._mdf||this.a&&this.a._mdf){if(this.mat.reset(),this.hierarchy)for(t=e=this.hierarchy.length-1;t>=0;t-=1){var n=this.hierarchy[t].finalTransform.mProp;this.mat.translate(-n.p.v[0],-n.p.v[1],n.p.v[2]),this.mat.rotateX(-n.or.v[0]).rotateY(-n.or.v[1]).rotateZ(n.or.v[2]),this.mat.rotateX(-n.rx.v).rotateY(-n.ry.v).rotateZ(n.rz.v),this.mat.scale(1/n.s.v[0],1/n.s.v[1],1/n.s.v[2]),this.mat.translate(n.a.v[0],n.a.v[1],n.a.v[2])}if(this.p?this.mat.translate(-this.p.v[0],-this.p.v[1],this.p.v[2]):this.mat.translate(-this.px.v,-this.py.v,this.pz.v),this.a){var r;r=this.p?[this.p.v[0]-this.a.v[0],this.p.v[1]-this.a.v[1],this.p.v[2]-this.a.v[2]]:[this.px.v-this.a.v[0],this.py.v-this.a.v[1],this.pz.v-this.a.v[2]];var s=Math.sqrt(Math.pow(r[0],2)+Math.pow(r[1],2)+Math.pow(r[2],2)),a=[r[0]/s,r[1]/s,r[2]/s],o=Math.sqrt(a[2]*a[2]+a[0]*a[0]),l=Math.atan2(a[1],o),h=Math.atan2(a[0],-a[2]);this.mat.rotateY(h).rotateX(-l)}this.mat.rotateX(-this.rx.v).rotateY(-this.ry.v).rotateZ(this.rz.v),this.mat.rotateX(-this.or.v[0]).rotateY(-this.or.v[1]).rotateZ(this.or.v[2]),this.mat.translate(this.globalData.compSize.w/2,this.globalData.compSize.h/2,0),this.mat.translate(0,0,this.pe.v);var c=!this._prevMat.equals(this.mat);if((c||this.pe._mdf)&&this.comp.threeDElements){var u,d,p;for(e=this.comp.threeDElements.length,t=0;t<e;t+=1)if("3d"===(u=this.comp.threeDElements[t]).type){if(c){var f=this.mat.toCSS();(p=u.container.style).transform=f,p.webkitTransform=f}this.pe._mdf&&((d=u.perspectiveElem.style).perspective=this.pe.v+"px",d.webkitPerspective=this.pe.v+"px")}this.mat.clone(this._prevMat)}}this._isFirstFrame=!1},HCameraElement.prototype.prepareFrame=function(t){this.prepareProperties(t,!0)},HCameraElement.prototype.destroy=function(){},HCameraElement.prototype.getBaseElement=function(){return null},extendPrototype([BaseElement,TransformElement,HBaseElement,HSolidElement,HierarchyElement,FrameElement,RenderableElement],HImageElement),HImageElement.prototype.createContent=function(){var t=this.globalData.getAssetsPath(this.assetData),e=new Image;this.data.hasMask?(this.imageElem=createNS("image"),this.imageElem.setAttribute("width",this.assetData.w+"px"),this.imageElem.setAttribute("height",this.assetData.h+"px"),this.imageElem.setAttributeNS("http://www.w3.org/1999/xlink","href",t),this.layerElement.appendChild(this.imageElem),this.baseElement.setAttribute("width",this.assetData.w),this.baseElement.setAttribute("height",this.assetData.h)):this.layerElement.appendChild(e),e.crossOrigin="anonymous",e.src=t,this.data.ln&&this.baseElement.setAttribute("id",this.data.ln)},extendPrototype([BaseRenderer],HybridRendererBase),HybridRendererBase.prototype.buildItem=SVGRenderer.prototype.buildItem,HybridRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;)this.pendingElements.pop().checkParenting()},HybridRendererBase.prototype.appendElementInPos=function(t,e){var i=t.getBaseElement();if(i){var n=this.layers[e];if(n.ddd&&this.supports3d)this.addTo3dContainer(i,e);else if(this.threeDElements)this.addTo3dContainer(i,e);else{for(var r,s,a=0;a<e;)this.elements[a]&&!0!==this.elements[a]&&this.elements[a].getBaseElement&&(s=this.elements[a],r=(this.layers[a].ddd?this.getThreeDContainerByPos(a):s.getBaseElement())||r),a+=1;r?n.ddd&&this.supports3d||this.layerElement.insertBefore(i,r):n.ddd&&this.supports3d||this.layerElement.appendChild(i)}}},HybridRendererBase.prototype.createShape=function(t){return this.supports3d?new HShapeElement(t,this.globalData,this):new SVGShapeElement(t,this.globalData,this)},HybridRendererBase.prototype.createText=function(t){return this.supports3d?new HTextElement(t,this.globalData,this):new SVGTextLottieElement(t,this.globalData,this)},HybridRendererBase.prototype.createCamera=function(t){return this.camera=new HCameraElement(t,this.globalData,this),this.camera},HybridRendererBase.prototype.createImage=function(t){return this.supports3d?new HImageElement(t,this.globalData,this):new IImageElement(t,this.globalData,this)},HybridRendererBase.prototype.createSolid=function(t){return this.supports3d?new HSolidElement(t,this.globalData,this):new ISolidElement(t,this.globalData,this)},HybridRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,HybridRendererBase.prototype.getThreeDContainerByPos=function(t){for(var e=0,i=this.threeDElements.length;e<i;){if(this.threeDElements[e].startPos<=t&&this.threeDElements[e].endPos>=t)return this.threeDElements[e].perspectiveElem;e+=1}return null},HybridRendererBase.prototype.createThreeDContainer=function(t,e){var i,n,r=createTag("div");styleDiv(r);var s=createTag("div");if(styleDiv(s),"3d"===e){(i=r.style).width=this.globalData.compSize.w+"px",i.height=this.globalData.compSize.h+"px";var a="50% 50%";i.webkitTransformOrigin=a,i.mozTransformOrigin=a,i.transformOrigin=a;var o="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";(n=s.style).transform=o,n.webkitTransform=o}r.appendChild(s);var l={container:s,perspectiveElem:r,startPos:t,endPos:t,type:e};return this.threeDElements.push(l),l},HybridRendererBase.prototype.build3dContainers=function(){var t,e,i=this.layers.length,n="";for(t=0;t<i;t+=1)this.layers[t].ddd&&3!==this.layers[t].ty?("3d"!==n&&(n="3d",e=this.createThreeDContainer(t,"3d")),e.endPos=Math.max(e.endPos,t)):("2d"!==n&&(n="2d",e=this.createThreeDContainer(t,"2d")),e.endPos=Math.max(e.endPos,t));for(t=(i=this.threeDElements.length)-1;t>=0;t-=1)this.resizerElem.appendChild(this.threeDElements[t].perspectiveElem)},HybridRendererBase.prototype.addTo3dContainer=function(t,e){for(var i=0,n=this.threeDElements.length;i<n;){if(e<=this.threeDElements[i].endPos){for(var r,s=this.threeDElements[i].startPos;s<e;)this.elements[s]&&this.elements[s].getBaseElement&&(r=this.elements[s].getBaseElement()),s+=1;r?this.threeDElements[i].container.insertBefore(t,r):this.threeDElements[i].container.appendChild(t);break}i+=1}},HybridRendererBase.prototype.configAnimation=function(t){var e=createTag("div"),i=this.animationItem.wrapper,n=e.style;n.width=t.w+"px",n.height=t.h+"px",this.resizerElem=e,styleDiv(e),n.transformStyle="flat",n.mozTransformStyle="flat",n.webkitTransformStyle="flat",this.renderConfig.className&&e.setAttribute("class",this.renderConfig.className),i.appendChild(e),n.overflow="hidden";var r=createNS("svg");r.setAttribute("width","1"),r.setAttribute("height","1"),styleDiv(r),this.resizerElem.appendChild(r);var s=createNS("defs");r.appendChild(s),this.data=t,this.setupGlobalData(t,r),this.globalData.defs=s,this.layers=t.layers,this.layerElement=this.resizerElem,this.build3dContainers(),this.updateContainerSize()},HybridRendererBase.prototype.destroy=function(){var t;this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.animationItem.container=null,this.globalData.defs=null;var e=this.layers?this.layers.length:0;for(t=0;t<e;t+=1)this.elements[t]&&this.elements[t].destroy&&this.elements[t].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},HybridRendererBase.prototype.updateContainerSize=function(){var t,e,i,n,r=this.animationItem.wrapper.offsetWidth,s=this.animationItem.wrapper.offsetHeight,a=r/s;this.globalData.compSize.w/this.globalData.compSize.h>a?(t=r/this.globalData.compSize.w,e=r/this.globalData.compSize.w,i=0,n=(s-this.globalData.compSize.h*(r/this.globalData.compSize.w))/2):(t=s/this.globalData.compSize.h,e=s/this.globalData.compSize.h,i=(r-this.globalData.compSize.w*(s/this.globalData.compSize.h))/2,n=0);var o=this.resizerElem.style;o.webkitTransform="matrix3d("+t+",0,0,0,0,"+e+",0,0,0,0,1,0,"+i+","+n+",0,1)",o.transform=o.webkitTransform},HybridRendererBase.prototype.renderFrame=SVGRenderer.prototype.renderFrame,HybridRendererBase.prototype.hide=function(){this.resizerElem.style.display="none"},HybridRendererBase.prototype.show=function(){this.resizerElem.style.display="block"},HybridRendererBase.prototype.initItems=function(){if(this.buildAllItems(),this.camera)this.camera.setup();else{var t,e=this.globalData.compSize.w,i=this.globalData.compSize.h,n=this.threeDElements.length;for(t=0;t<n;t+=1){var r=this.threeDElements[t].perspectiveElem.style;r.webkitPerspective=Math.sqrt(Math.pow(e,2)+Math.pow(i,2))+"px",r.perspective=r.webkitPerspective}}},HybridRendererBase.prototype.searchExtraCompositions=function(t){var e,i=t.length,n=createTag("div");for(e=0;e<i;e+=1)if(t[e].xt){var r=this.createComp(t[e],n,this.globalData.comp,null);r.initExpressions(),this.globalData.projectInterface.registerComposition(r)}},extendPrototype([HybridRendererBase,ICompElement,HBaseElement],HCompElement),HCompElement.prototype._createBaseContainerElements=HCompElement.prototype.createContainerElements,HCompElement.prototype.createContainerElements=function(){this._createBaseContainerElements(),this.data.hasMask?(this.svgElement.setAttribute("width",this.data.w),this.svgElement.setAttribute("height",this.data.h),this.transformedElement=this.baseElement):this.transformedElement=this.layerElement},HCompElement.prototype.addTo3dContainer=function(t,e){for(var i,n=0;n<e;)this.elements[n]&&this.elements[n].getBaseElement&&(i=this.elements[n].getBaseElement()),n+=1;i?this.layerElement.insertBefore(t,i):this.layerElement.appendChild(t)},HCompElement.prototype.createComp=function(t){return this.supports3d?new HCompElement(t,this.globalData,this):new SVGCompElement(t,this.globalData,this)},extendPrototype([HybridRendererBase],HybridRenderer),HybridRenderer.prototype.createComp=function(t){return this.supports3d?new HCompElement(t,this.globalData,this):new SVGCompElement(t,this.globalData,this)};var CompExpressionInterface=function(t){function e(e){for(var i=0,n=t.layers.length;i<n;){if(t.layers[i].nm===e||t.layers[i].ind===e)return t.elements[i].layerInterface;i+=1}return null}return Object.defineProperty(e,"_name",{value:t.data.nm}),e.layer=e,e.pixelAspect=1,e.height=t.data.h||t.globalData.compSize.h,e.width=t.data.w||t.globalData.compSize.w,e.pixelAspect=1,e.frameDuration=1/t.globalData.frameRate,e.displayStartTime=0,e.numLayers=t.layers.length,e};function _typeof$2(t){return _typeof$2="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof$2(t)}function seedRandom(t,e){var i=this,n=256,r="random",s=e.pow(n,6),a=e.pow(2,52),o=2*a,l=255;function h(t){var e,i=t.length,r=this,s=0,a=r.i=r.j=0,o=r.S=[];for(i||(t=[i++]);s<n;)o[s]=s++;for(s=0;s<n;s++)o[s]=o[a=l&a+t[s%i]+(e=o[s])],o[a]=e;r.g=function(t){for(var e,i=0,s=r.i,a=r.j,o=r.S;t--;)e=o[s=l&s+1],i=i*n+o[l&(o[s]=o[a=l&a+e])+(o[a]=e)];return r.i=s,r.j=a,i}}function c(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function u(t,e){var i,n=[],r=_typeof$2(t);if(e&&"object"==r)for(i in t)try{n.push(u(t[i],e-1))}catch(s){}return n.length?n:"string"==r?t:t+"\0"}function d(t,e){for(var i,n=t+"",r=0;r<n.length;)e[l&r]=l&(i^=19*e[l&r])+n.charCodeAt(r++);return p(e)}function p(t){return String.fromCharCode.apply(0,t)}e["seed"+r]=function(l,f,m){var g=[],v=d(u((f=!0===f?{entropy:!0}:f||{}).entropy?[l,p(t)]:null===l?function(){try{var e=new Uint8Array(n);return(i.crypto||i.msCrypto).getRandomValues(e),p(e)}catch(a){var r=i.navigator,s=r&&r.plugins;return[+new Date,i,s,i.screen,p(t)]}}():l,3),g),y=new h(g),b=function(){for(var t=y.g(6),e=s,i=0;t<a;)t=(t+i)*n,e*=n,i=y.g(1);for(;t>=o;)t/=2,e/=2,i>>>=1;return(t+i)/e};return b.int32=function(){return 0|y.g(4)},b.quick=function(){return y.g(4)/4294967296},b.double=b,d(p(y.S),t),(f.pass||m||function(t,i,n,s){return s&&(s.S&&c(s,y),t.state=function(){return c(y,{})}),n?(e[r]=t,i):t})(b,v,"global"in f?f.global:this==e,f.state)},d(e.random(),t)}function initialize$2(t){seedRandom([],t)}var propTypes={SHAPE:"shape"};function _typeof$1(t){return _typeof$1="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof$1(t)}var ExpressionManager=function(){var ob={},Math=BMMath,window=null,document=null,XMLHttpRequest=null,fetch=null,frames=null,_lottieGlobal={};function resetFrame(){_lottieGlobal={}}function $bm_isInstanceOfArray(t){return t.constructor===Array||t.constructor===Float32Array}function isNumerable(t,e){return"number"===t||e instanceof Number||"boolean"===t||"string"===t}function $bm_neg(t){var e=_typeof$1(t);if("number"===e||t instanceof Number||"boolean"===e)return-t;if($bm_isInstanceOfArray(t)){var i,n=t.length,r=[];for(i=0;i<n;i+=1)r[i]=-t[i];return r}return t.propType?t.v:-t}initialize$2(BMMath);var easeInBez=BezierFactory.getBezierEasing(.333,0,.833,.833,"easeIn").get,easeOutBez=BezierFactory.getBezierEasing(.167,.167,.667,1,"easeOut").get,easeInOutBez=BezierFactory.getBezierEasing(.33,0,.667,1,"easeInOut").get;function sum(t,e){var i=_typeof$1(t),n=_typeof$1(e);if(isNumerable(i,t)&&isNumerable(n,e)||"string"===i||"string"===n)return t+e;if($bm_isInstanceOfArray(t)&&isNumerable(n,e))return(t=t.slice(0))[0]+=e,t;if(isNumerable(i,t)&&$bm_isInstanceOfArray(e))return(e=e.slice(0))[0]=t+e[0],e;if($bm_isInstanceOfArray(t)&&$bm_isInstanceOfArray(e)){for(var r=0,s=t.length,a=e.length,o=[];r<s||r<a;)("number"===typeof t[r]||t[r]instanceof Number)&&("number"===typeof e[r]||e[r]instanceof Number)?o[r]=t[r]+e[r]:o[r]=void 0===e[r]?t[r]:t[r]||e[r],r+=1;return o}return 0}var add=sum;function sub(t,e){var i=_typeof$1(t),n=_typeof$1(e);if(isNumerable(i,t)&&isNumerable(n,e))return"string"===i&&(t=parseInt(t,10)),"string"===n&&(e=parseInt(e,10)),t-e;if($bm_isInstanceOfArray(t)&&isNumerable(n,e))return(t=t.slice(0))[0]-=e,t;if(isNumerable(i,t)&&$bm_isInstanceOfArray(e))return(e=e.slice(0))[0]=t-e[0],e;if($bm_isInstanceOfArray(t)&&$bm_isInstanceOfArray(e)){for(var r=0,s=t.length,a=e.length,o=[];r<s||r<a;)("number"===typeof t[r]||t[r]instanceof Number)&&("number"===typeof e[r]||e[r]instanceof Number)?o[r]=t[r]-e[r]:o[r]=void 0===e[r]?t[r]:t[r]||e[r],r+=1;return o}return 0}function mul(t,e){var i,n,r,s=_typeof$1(t),a=_typeof$1(e);if(isNumerable(s,t)&&isNumerable(a,e))return t*e;if($bm_isInstanceOfArray(t)&&isNumerable(a,e)){for(r=t.length,i=createTypedArray("float32",r),n=0;n<r;n+=1)i[n]=t[n]*e;return i}if(isNumerable(s,t)&&$bm_isInstanceOfArray(e)){for(r=e.length,i=createTypedArray("float32",r),n=0;n<r;n+=1)i[n]=t*e[n];return i}return 0}function div(t,e){var i,n,r,s=_typeof$1(t),a=_typeof$1(e);if(isNumerable(s,t)&&isNumerable(a,e))return t/e;if($bm_isInstanceOfArray(t)&&isNumerable(a,e)){for(r=t.length,i=createTypedArray("float32",r),n=0;n<r;n+=1)i[n]=t[n]/e;return i}if(isNumerable(s,t)&&$bm_isInstanceOfArray(e)){for(r=e.length,i=createTypedArray("float32",r),n=0;n<r;n+=1)i[n]=t/e[n];return i}return 0}function mod(t,e){return"string"===typeof t&&(t=parseInt(t,10)),"string"===typeof e&&(e=parseInt(e,10)),t%e}var $bm_sum=sum,$bm_sub=sub,$bm_mul=mul,$bm_div=div,$bm_mod=mod;function clamp(t,e,i){if(e>i){var n=i;i=e,e=n}return Math.min(Math.max(t,e),i)}function radiansToDegrees(t){return t/degToRads}var radians_to_degrees=radiansToDegrees;function degreesToRadians(t){return t*degToRads}var degrees_to_radians=radiansToDegrees,helperLengthArray=[0,0,0,0,0,0];function length(t,e){if("number"===typeof t||t instanceof Number)return e=e||0,Math.abs(t-e);var i;e||(e=helperLengthArray);var n=Math.min(t.length,e.length),r=0;for(i=0;i<n;i+=1)r+=Math.pow(e[i]-t[i],2);return Math.sqrt(r)}function normalize(t){return div(t,length(t))}function rgbToHsl(t){var e,i,n=t[0],r=t[1],s=t[2],a=Math.max(n,r,s),o=Math.min(n,r,s),l=(a+o)/2;if(a===o)e=0,i=0;else{var h=a-o;switch(i=l>.5?h/(2-a-o):h/(a+o),a){case n:e=(r-s)/h+(r<s?6:0);break;case r:e=(s-n)/h+2;break;case s:e=(n-r)/h+4}e/=6}return[e,i,l,t[3]]}function hue2rgb(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}function hslToRgb(t){var e,i,n,r=t[0],s=t[1],a=t[2];if(0===s)e=a,n=a,i=a;else{var o=a<.5?a*(1+s):a+s-a*s,l=2*a-o;e=hue2rgb(l,o,r+1/3),i=hue2rgb(l,o,r),n=hue2rgb(l,o,r-1/3)}return[e,i,n,t[3]]}function linear(t,e,i,n,r){if(void 0!==n&&void 0!==r||(n=e,r=i,e=0,i=1),i<e){var s=i;i=e,e=s}if(t<=e)return n;if(t>=i)return r;var a,o=i===e?0:(t-e)/(i-e);if(!n.length)return n+(r-n)*o;var l=n.length,h=createTypedArray("float32",l);for(a=0;a<l;a+=1)h[a]=n[a]+(r[a]-n[a])*o;return h}function random(t,e){if(void 0===e&&(void 0===t?(t=0,e=1):(e=t,t=void 0)),e.length){var i,n=e.length;t||(t=createTypedArray("float32",n));var r=createTypedArray("float32",n),s=BMMath.random();for(i=0;i<n;i+=1)r[i]=t[i]+s*(e[i]-t[i]);return r}return void 0===t&&(t=0),t+BMMath.random()*(e-t)}function createPath(t,e,i,n){var r,s=t.length,a=shapePool.newElement();a.setPathData(!!n,s);var o,l,h=[0,0];for(r=0;r<s;r+=1)o=e&&e[r]?e[r]:h,l=i&&i[r]?i[r]:h,a.setTripleAt(t[r][0],t[r][1],l[0]+t[r][0],l[1]+t[r][1],o[0]+t[r][0],o[1]+t[r][1],r,!0);return a}function initiateExpression(elem,data,property){function noOp(t){return t}if(!elem.globalData.renderConfig.runExpressions)return noOp;var val=data.x,needsVelocity=/velocity(?![\w\d])/.test(val),_needsRandom=-1!==val.indexOf("random"),elemType=elem.data.ty,transform,$bm_transform,content,effect,thisProperty=property;thisProperty.valueAtTime=thisProperty.getValueAtTime,Object.defineProperty(thisProperty,"value",{get:function(){return thisProperty.v}}),elem.comp.frameDuration=1/elem.comp.globalData.frameRate,elem.comp.displayStartTime=0;var inPoint=elem.data.ip/elem.comp.globalData.frameRate,outPoint=elem.data.op/elem.comp.globalData.frameRate,width=elem.data.sw?elem.data.sw:0,height=elem.data.sh?elem.data.sh:0,name=elem.data.nm,loopIn,loop_in,loopOut,loop_out,smooth,toWorld,fromWorld,fromComp,toComp,fromCompToSurface,position,rotation,anchorPoint,scale,thisLayer,thisComp,mask,valueAtTime,velocityAtTime,scoped_bm_rt,expression_function=eval("[function _expression_function(){"+val+";scoped_bm_rt=$bm_rt}]")[0],numKeys=property.kf?data.k.length:0,active=!this.data||!0!==this.data.hd,wiggle=function(t,e){var i,n,r=this.pv.length?this.pv.length:1,s=createTypedArray("float32",r),a=Math.floor(5*time);for(i=0,n=0;i<a;){for(n=0;n<r;n+=1)s[n]+=-e+2*e*BMMath.random();i+=1}var o=5*time,l=o-Math.floor(o),h=createTypedArray("float32",r);if(r>1){for(n=0;n<r;n+=1)h[n]=this.pv[n]+s[n]+(-e+2*e*BMMath.random())*l;return h}return this.pv+s[0]+(-e+2*e*BMMath.random())*l}.bind(this);function loopInDuration(t,e){return loopIn(t,e,!0)}function loopOutDuration(t,e){return loopOut(t,e,!0)}thisProperty.loopIn&&(loopIn=thisProperty.loopIn.bind(thisProperty),loop_in=loopIn),thisProperty.loopOut&&(loopOut=thisProperty.loopOut.bind(thisProperty),loop_out=loopOut),thisProperty.smooth&&(smooth=thisProperty.smooth.bind(thisProperty)),this.getValueAtTime&&(valueAtTime=this.getValueAtTime.bind(this)),this.getVelocityAtTime&&(velocityAtTime=this.getVelocityAtTime.bind(this));var comp=elem.comp.globalData.projectInterface.bind(elem.comp.globalData.projectInterface),time,velocity,value,text,textIndex,textTotal,selectorValue;function lookAt(t,e){var i=[e[0]-t[0],e[1]-t[1],e[2]-t[2]],n=Math.atan2(i[0],Math.sqrt(i[1]*i[1]+i[2]*i[2]))/degToRads;return[-Math.atan2(i[1],i[2])/degToRads,n,0]}function easeOut(t,e,i,n,r){return applyEase(easeOutBez,t,e,i,n,r)}function easeIn(t,e,i,n,r){return applyEase(easeInBez,t,e,i,n,r)}function ease(t,e,i,n,r){return applyEase(easeInOutBez,t,e,i,n,r)}function applyEase(t,e,i,n,r,s){void 0===r?(r=i,s=n):e=(e-i)/(n-i),e>1?e=1:e<0&&(e=0);var a=t(e);if($bm_isInstanceOfArray(r)){var o,l=r.length,h=createTypedArray("float32",l);for(o=0;o<l;o+=1)h[o]=(s[o]-r[o])*a+r[o];return h}return(s-r)*a+r}function nearestKey(t){var e,i,n,r=data.k.length;if(data.k.length&&"number"!==typeof data.k[0])if(i=-1,(t*=elem.comp.globalData.frameRate)<data.k[0].t)i=1,n=data.k[0].t;else{for(e=0;e<r-1;e+=1){if(t===data.k[e].t){i=e+1,n=data.k[e].t;break}if(t>data.k[e].t&&t<data.k[e+1].t){t-data.k[e].t>data.k[e+1].t-t?(i=e+2,n=data.k[e+1].t):(i=e+1,n=data.k[e].t);break}}-1===i&&(i=e+1,n=data.k[e].t)}else i=0,n=0;var s={};return s.index=i,s.time=n/elem.comp.globalData.frameRate,s}function key(t){var e,i,n;if(!data.k.length||"number"===typeof data.k[0])throw new Error("The property has no keyframe at index "+t);t-=1,e={time:data.k[t].t/elem.comp.globalData.frameRate,value:[]};var r=Object.prototype.hasOwnProperty.call(data.k[t],"s")?data.k[t].s:data.k[t-1].e;for(n=r.length,i=0;i<n;i+=1)e[i]=r[i],e.value[i]=r[i];return e}function framesToTime(t,e){return e||(e=elem.comp.globalData.frameRate),t/e}function timeToFrames(t,e){return t||0===t||(t=time),e||(e=elem.comp.globalData.frameRate),t*e}function seedRandom(t){BMMath.seedrandom(randSeed+t)}function sourceRectAtTime(){return elem.sourceRectAtTime()}function substring(t,e){return"string"===typeof value?void 0===e?value.substring(t):value.substring(t,e):""}function substr(t,e){return"string"===typeof value?void 0===e?value.substr(t):value.substr(t,e):""}function posterizeTime(t){time=0===t?0:Math.floor(time*t)/t,value=valueAtTime(time)}var index=elem.data.ind,hasParent=!(!elem.hierarchy||!elem.hierarchy.length),parent,randSeed=Math.floor(1e6*Math.random()),globalData=elem.globalData;function executeExpression(t){return value=t,this.frameExpressionId===elem.globalData.frameId&&"textSelector"!==this.propType?value:("textSelector"===this.propType&&(textIndex=this.textIndex,textTotal=this.textTotal,selectorValue=this.selectorValue),thisLayer||(text=elem.layerInterface.text,thisLayer=elem.layerInterface,thisComp=elem.comp.compInterface,toWorld=thisLayer.toWorld.bind(thisLayer),fromWorld=thisLayer.fromWorld.bind(thisLayer),fromComp=thisLayer.fromComp.bind(thisLayer),toComp=thisLayer.toComp.bind(thisLayer),mask=thisLayer.mask?thisLayer.mask.bind(thisLayer):null,fromCompToSurface=fromComp),transform||(transform=elem.layerInterface("ADBE Transform Group"),$bm_transform=transform,transform&&(anchorPoint=transform.anchorPoint)),4!==elemType||content||(content=thisLayer("ADBE Root Vectors Group")),effect||(effect=thisLayer(4)),(hasParent=!(!elem.hierarchy||!elem.hierarchy.length))&&!parent&&(parent=elem.hierarchy[0].layerInterface),time=this.comp.renderedFrame/this.comp.globalData.frameRate,_needsRandom&&seedRandom(randSeed+time),needsVelocity&&(velocity=velocityAtTime(time)),expression_function(),this.frameExpressionId=elem.globalData.frameId,scoped_bm_rt=scoped_bm_rt.propType===propTypes.SHAPE?scoped_bm_rt.v:scoped_bm_rt)}return executeExpression.__preventDeadCodeRemoval=[$bm_transform,anchorPoint,time,velocity,inPoint,outPoint,width,height,name,loop_in,loop_out,smooth,toComp,fromCompToSurface,toWorld,fromWorld,mask,position,rotation,scale,thisComp,numKeys,active,wiggle,loopInDuration,loopOutDuration,comp,lookAt,easeOut,easeIn,ease,nearestKey,key,text,textIndex,textTotal,selectorValue,framesToTime,timeToFrames,sourceRectAtTime,substring,substr,posterizeTime,index,globalData],executeExpression}return ob.initiateExpression=initiateExpression,ob.__preventDeadCodeRemoval=[window,document,XMLHttpRequest,fetch,frames,$bm_neg,add,$bm_sum,$bm_sub,$bm_mul,$bm_div,$bm_mod,clamp,radians_to_degrees,degreesToRadians,degrees_to_radians,normalize,rgbToHsl,hslToRgb,linear,random,createPath,_lottieGlobal],ob.resetFrame=resetFrame,ob}(),Expressions=function(){var t={initExpressions:function(t){var e=0,i=[];t.renderer.compInterface=CompExpressionInterface(t.renderer),t.renderer.globalData.projectInterface.registerComposition(t.renderer),t.renderer.globalData.pushExpression=function(){e+=1},t.renderer.globalData.popExpression=function(){0===(e-=1)&&function(){var t,e=i.length;for(t=0;t<e;t+=1)i[t].release();i.length=0}()},t.renderer.globalData.registerExpressionProperty=function(t){-1===i.indexOf(t)&&i.push(t)}}};return t.resetFrame=ExpressionManager.resetFrame,t}(),MaskManagerInterface=function(){function t(t,e){this._mask=t,this._data=e}return Object.defineProperty(t.prototype,"maskPath",{get:function(){return this._mask.prop.k&&this._mask.prop.getValue(),this._mask.prop}}),Object.defineProperty(t.prototype,"maskOpacity",{get:function(){return this._mask.op.k&&this._mask.op.getValue(),100*this._mask.op.v}}),function(e){var i,n=createSizedArray(e.viewData.length),r=e.viewData.length;for(i=0;i<r;i+=1)n[i]=new t(e.viewData[i],e.masksProperties[i]);return function(t){for(i=0;i<r;){if(e.masksProperties[i].nm===t)return n[i];i+=1}return null}}}(),ExpressionPropertyInterface=function(){var t={pv:0,v:0,mult:1},e={pv:[0,0,0],v:[0,0,0],mult:1};function i(t,e,i){Object.defineProperty(t,"velocity",{get:function(){return e.getVelocityAtTime(e.comp.currentFrame)}}),t.numKeys=e.keyframes?e.keyframes.length:0,t.key=function(n){if(!t.numKeys)return 0;var r="";r="s"in e.keyframes[n-1]?e.keyframes[n-1].s:"e"in e.keyframes[n-2]?e.keyframes[n-2].e:e.keyframes[n-2].s;var s="unidimensional"===i?new Number(r):Object.assign({},r);return s.time=e.keyframes[n-1].t/e.elem.comp.globalData.frameRate,s.value="unidimensional"===i?r[0]:r,s},t.valueAtTime=e.getValueAtTime,t.speedAtTime=e.getSpeedAtTime,t.velocityAtTime=e.getVelocityAtTime,t.propertyGroup=e.propertyGroup}function n(){return t}return function(r){return r?"unidimensional"===r.propType?function(e){e&&"pv"in e||(e=t);var n=1/e.mult,r=e.pv*n,s=new Number(r);return s.value=r,i(s,e,"unidimensional"),function(){return e.k&&e.getValue(),r=e.v*n,s.value!==r&&((s=new Number(r)).value=r,i(s,e,"unidimensional")),s}}(r):function(t){t&&"pv"in t||(t=e);var n=1/t.mult,r=t.data&&t.data.l||t.pv.length,s=createTypedArray("float32",r),a=createTypedArray("float32",r);return s.value=a,i(s,t,"multidimensional"),function(){t.k&&t.getValue();for(var e=0;e<r;e+=1)a[e]=t.v[e]*n,s[e]=a[e];return s}}(r):n}}(),TransformExpressionInterface=function(t){function e(t){switch(t){case"scale":case"Scale":case"ADBE Scale":case 6:return e.scale;case"rotation":case"Rotation":case"ADBE Rotation":case"ADBE Rotate Z":case 10:return e.rotation;case"ADBE Rotate X":return e.xRotation;case"ADBE Rotate Y":return e.yRotation;case"position":case"Position":case"ADBE Position":case 2:return e.position;case"ADBE Position_0":return e.xPosition;case"ADBE Position_1":return e.yPosition;case"ADBE Position_2":return e.zPosition;case"anchorPoint":case"AnchorPoint":case"Anchor Point":case"ADBE AnchorPoint":case 1:return e.anchorPoint;case"opacity":case"Opacity":case 11:return e.opacity;default:return null}}var i,n,r,s;return Object.defineProperty(e,"rotation",{get:ExpressionPropertyInterface(t.r||t.rz)}),Object.defineProperty(e,"zRotation",{get:ExpressionPropertyInterface(t.rz||t.r)}),Object.defineProperty(e,"xRotation",{get:ExpressionPropertyInterface(t.rx)}),Object.defineProperty(e,"yRotation",{get:ExpressionPropertyInterface(t.ry)}),Object.defineProperty(e,"scale",{get:ExpressionPropertyInterface(t.s)}),t.p?s=ExpressionPropertyInterface(t.p):(i=ExpressionPropertyInterface(t.px),n=ExpressionPropertyInterface(t.py),t.pz&&(r=ExpressionPropertyInterface(t.pz))),Object.defineProperty(e,"position",{get:function(){return t.p?s():[i(),n(),r?r():0]}}),Object.defineProperty(e,"xPosition",{get:ExpressionPropertyInterface(t.px)}),Object.defineProperty(e,"yPosition",{get:ExpressionPropertyInterface(t.py)}),Object.defineProperty(e,"zPosition",{get:ExpressionPropertyInterface(t.pz)}),Object.defineProperty(e,"anchorPoint",{get:ExpressionPropertyInterface(t.a)}),Object.defineProperty(e,"opacity",{get:ExpressionPropertyInterface(t.o)}),Object.defineProperty(e,"skew",{get:ExpressionPropertyInterface(t.sk)}),Object.defineProperty(e,"skewAxis",{get:ExpressionPropertyInterface(t.sa)}),Object.defineProperty(e,"orientation",{get:ExpressionPropertyInterface(t.or)}),e},LayerExpressionInterface=function(){function t(t){var e=new Matrix;return void 0!==t?this._elem.finalTransform.mProp.getValueAtTime(t).clone(e):this._elem.finalTransform.mProp.applyToMatrix(e),e}function e(t,e){var i=this.getMatrix(e);return i.props[12]=0,i.props[13]=0,i.props[14]=0,this.applyPoint(i,t)}function i(t,e){var i=this.getMatrix(e);return this.applyPoint(i,t)}function n(t,e){var i=this.getMatrix(e);return i.props[12]=0,i.props[13]=0,i.props[14]=0,this.invertPoint(i,t)}function r(t,e){var i=this.getMatrix(e);return this.invertPoint(i,t)}function s(t,e){if(this._elem.hierarchy&&this._elem.hierarchy.length){var i,n=this._elem.hierarchy.length;for(i=0;i<n;i+=1)this._elem.hierarchy[i].finalTransform.mProp.applyToMatrix(t)}return t.applyToPointArray(e[0],e[1],e[2]||0)}function a(t,e){if(this._elem.hierarchy&&this._elem.hierarchy.length){var i,n=this._elem.hierarchy.length;for(i=0;i<n;i+=1)this._elem.hierarchy[i].finalTransform.mProp.applyToMatrix(t)}return t.inversePoint(e)}function o(t){var e=new Matrix;if(e.reset(),this._elem.finalTransform.mProp.applyToMatrix(e),this._elem.hierarchy&&this._elem.hierarchy.length){var i,n=this._elem.hierarchy.length;for(i=0;i<n;i+=1)this._elem.hierarchy[i].finalTransform.mProp.applyToMatrix(e);return e.inversePoint(t)}return e.inversePoint(t)}function l(){return[1,1,1,1]}return function(h){var c;function u(t){switch(t){case"ADBE Root Vectors Group":case"Contents":case 2:return u.shapeInterface;case 1:case 6:case"Transform":case"transform":case"ADBE Transform Group":return c;case 4:case"ADBE Effect Parade":case"effects":case"Effects":return u.effect;case"ADBE Text Properties":return u.textInterface;default:return null}}u.getMatrix=t,u.invertPoint=a,u.applyPoint=s,u.toWorld=i,u.toWorldVec=e,u.fromWorld=r,u.fromWorldVec=n,u.toComp=i,u.fromComp=o,u.sampleImage=l,u.sourceRectAtTime=h.sourceRectAtTime.bind(h),u._elem=h;var d=getDescriptor(c=TransformExpressionInterface(h.finalTransform.mProp),"anchorPoint");return Object.defineProperties(u,{hasParent:{get:function(){return h.hierarchy.length}},parent:{get:function(){return h.hierarchy[0].layerInterface}},rotation:getDescriptor(c,"rotation"),scale:getDescriptor(c,"scale"),position:getDescriptor(c,"position"),opacity:getDescriptor(c,"opacity"),anchorPoint:d,anchor_point:d,transform:{get:function(){return c}},active:{get:function(){return h.isInRange}}}),u.startTime=h.data.st,u.index=h.data.ind,u.source=h.data.refId,u.height=0===h.data.ty?h.data.h:100,u.width=0===h.data.ty?h.data.w:100,u.inPoint=h.data.ip/h.comp.globalData.frameRate,u.outPoint=h.data.op/h.comp.globalData.frameRate,u._name=h.data.nm,u.registerMaskInterface=function(t){u.mask=new MaskManagerInterface(t,h)},u.registerEffectsInterface=function(t){u.effect=t},u}}(),propertyGroupFactory=function(t,e){return function(i){return(i=void 0===i?1:i)<=0?t:e(i-1)}},PropertyInterface=function(t,e){var i={_name:t};return function(t){return(t=void 0===t?1:t)<=0?i:e(t-1)}},EffectsExpressionInterface=function(){function t(i,n,r,s){function a(t){for(var e=i.ef,n=0,r=e.length;n<r;){if(t===e[n].nm||t===e[n].mn||t===e[n].ix)return 5===e[n].ty?h[n]:h[n]();n+=1}throw new Error}var o,l=propertyGroupFactory(a,r),h=[],c=i.ef.length;for(o=0;o<c;o+=1)5===i.ef[o].ty?h.push(t(i.ef[o],n.effectElements[o],n.effectElements[o].propertyGroup,s)):h.push(e(n.effectElements[o],i.ef[o].ty,s,l));return"ADBE Color Control"===i.mn&&Object.defineProperty(a,"color",{get:function(){return h[0]()}}),Object.defineProperties(a,{numProperties:{get:function(){return i.np}},_name:{value:i.nm},propertyGroup:{value:l}}),a.enabled=0!==i.en,a.active=a.enabled,a}function e(t,e,i,n){var r=ExpressionPropertyInterface(t.p);return t.p.setGroupProperty&&t.p.setGroupProperty(PropertyInterface("",n)),function(){return 10===e?i.comp.compInterface(t.p.v):r()}}return{createEffectsInterface:function(e,i){if(e.effectsManager){var n,r=[],s=e.data.ef,a=e.effectsManager.effectElements.length;for(n=0;n<a;n+=1)r.push(t(s[n],e.effectsManager.effectElements[n],i,e));var o=e.data.ef||[],l=function(t){for(n=0,a=o.length;n<a;){if(t===o[n].nm||t===o[n].mn||t===o[n].ix)return r[n];n+=1}return null};return Object.defineProperty(l,"numProperties",{get:function(){return o.length}}),l}return null}}}(),ShapePathInterface=function(t,e,i){var n=e.sh;function r(t){return"Shape"===t||"shape"===t||"Path"===t||"path"===t||"ADBE Vector Shape"===t||2===t?r.path:null}var s=propertyGroupFactory(r,i);return n.setGroupProperty(PropertyInterface("Path",s)),Object.defineProperties(r,{path:{get:function(){return n.k&&n.getValue(),n}},shape:{get:function(){return n.k&&n.getValue(),n}},_name:{value:t.nm},ix:{value:t.ix},propertyIndex:{value:t.ix},mn:{value:t.mn},propertyGroup:{value:i}}),r},ShapeExpressionInterface=function(){function t(t,a,d){var p,f=[],m=t?t.length:0;for(p=0;p<m;p+=1)"gr"===t[p].ty?f.push(e(t[p],a[p],d)):"fl"===t[p].ty?f.push(i(t[p],a[p],d)):"st"===t[p].ty?f.push(r(t[p],a[p],d)):"tm"===t[p].ty?f.push(s(t[p],a[p],d)):"tr"===t[p].ty||("el"===t[p].ty?f.push(o(t[p],a[p],d)):"sr"===t[p].ty?f.push(l(t[p],a[p],d)):"sh"===t[p].ty?f.push(ShapePathInterface(t[p],a[p],d)):"rc"===t[p].ty?f.push(h(t[p],a[p],d)):"rd"===t[p].ty?f.push(c(t[p],a[p],d)):"rp"===t[p].ty?f.push(u(t[p],a[p],d)):"gf"===t[p].ty?f.push(n(t[p],a[p],d)):f.push((t[p],a[p],function(){return null})));return f}function e(e,i,n){var r=function(t){switch(t){case"ADBE Vectors Group":case"Contents":case 2:return r.content;default:return r.transform}};r.propertyGroup=propertyGroupFactory(r,n);var s=function(e,i,n){var r,s=function(t){for(var e=0,i=r.length;e<i;){if(r[e]._name===t||r[e].mn===t||r[e].propertyIndex===t||r[e].ix===t||r[e].ind===t)return r[e];e+=1}return"number"===typeof t?r[t-1]:null};s.propertyGroup=propertyGroupFactory(s,n),r=t(e.it,i.it,s.propertyGroup),s.numProperties=r.length;var o=a(e.it[e.it.length-1],i.it[i.it.length-1],s.propertyGroup);return s.transform=o,s.propertyIndex=e.cix,s._name=e.nm,s}(e,i,r.propertyGroup),o=a(e.it[e.it.length-1],i.it[i.it.length-1],r.propertyGroup);return r.content=s,r.transform=o,Object.defineProperty(r,"_name",{get:function(){return e.nm}}),r.numProperties=e.np,r.propertyIndex=e.ix,r.nm=e.nm,r.mn=e.mn,r}function i(t,e,i){function n(t){return"Color"===t||"color"===t?n.color:"Opacity"===t||"opacity"===t?n.opacity:null}return Object.defineProperties(n,{color:{get:ExpressionPropertyInterface(e.c)},opacity:{get:ExpressionPropertyInterface(e.o)},_name:{value:t.nm},mn:{value:t.mn}}),e.c.setGroupProperty(PropertyInterface("Color",i)),e.o.setGroupProperty(PropertyInterface("Opacity",i)),n}function n(t,e,i){function n(t){return"Start Point"===t||"start point"===t?n.startPoint:"End Point"===t||"end point"===t?n.endPoint:"Opacity"===t||"opacity"===t?n.opacity:null}return Object.defineProperties(n,{startPoint:{get:ExpressionPropertyInterface(e.s)},endPoint:{get:ExpressionPropertyInterface(e.e)},opacity:{get:ExpressionPropertyInterface(e.o)},type:{get:function(){return"a"}},_name:{value:t.nm},mn:{value:t.mn}}),e.s.setGroupProperty(PropertyInterface("Start Point",i)),e.e.setGroupProperty(PropertyInterface("End Point",i)),e.o.setGroupProperty(PropertyInterface("Opacity",i)),n}function r(t,e,i){var n,r=propertyGroupFactory(h,i),s=propertyGroupFactory(l,r);function a(i){Object.defineProperty(l,t.d[i].nm,{get:ExpressionPropertyInterface(e.d.dataProps[i].p)})}var o=t.d?t.d.length:0,l={};for(n=0;n<o;n+=1)a(n),e.d.dataProps[n].p.setGroupProperty(s);function h(t){return"Color"===t||"color"===t?h.color:"Opacity"===t||"opacity"===t?h.opacity:"Stroke Width"===t||"stroke width"===t?h.strokeWidth:null}return Object.defineProperties(h,{color:{get:ExpressionPropertyInterface(e.c)},opacity:{get:ExpressionPropertyInterface(e.o)},strokeWidth:{get:ExpressionPropertyInterface(e.w)},dash:{get:function(){return l}},_name:{value:t.nm},mn:{value:t.mn}}),e.c.setGroupProperty(PropertyInterface("Color",r)),e.o.setGroupProperty(PropertyInterface("Opacity",r)),e.w.setGroupProperty(PropertyInterface("Stroke Width",r)),h}function s(t,e,i){function n(e){return e===t.e.ix||"End"===e||"end"===e?n.end:e===t.s.ix?n.start:e===t.o.ix?n.offset:null}var r=propertyGroupFactory(n,i);return n.propertyIndex=t.ix,e.s.setGroupProperty(PropertyInterface("Start",r)),e.e.setGroupProperty(PropertyInterface("End",r)),e.o.setGroupProperty(PropertyInterface("Offset",r)),n.propertyIndex=t.ix,n.propertyGroup=i,Object.defineProperties(n,{start:{get:ExpressionPropertyInterface(e.s)},end:{get:ExpressionPropertyInterface(e.e)},offset:{get:ExpressionPropertyInterface(e.o)},_name:{value:t.nm}}),n.mn=t.mn,n}function a(t,e,i){function n(e){return t.a.ix===e||"Anchor Point"===e?n.anchorPoint:t.o.ix===e||"Opacity"===e?n.opacity:t.p.ix===e||"Position"===e?n.position:t.r.ix===e||"Rotation"===e||"ADBE Vector Rotation"===e?n.rotation:t.s.ix===e||"Scale"===e?n.scale:t.sk&&t.sk.ix===e||"Skew"===e?n.skew:t.sa&&t.sa.ix===e||"Skew Axis"===e?n.skewAxis:null}var r=propertyGroupFactory(n,i);return e.transform.mProps.o.setGroupProperty(PropertyInterface("Opacity",r)),e.transform.mProps.p.setGroupProperty(PropertyInterface("Position",r)),e.transform.mProps.a.setGroupProperty(PropertyInterface("Anchor Point",r)),e.transform.mProps.s.setGroupProperty(PropertyInterface("Scale",r)),e.transform.mProps.r.setGroupProperty(PropertyInterface("Rotation",r)),e.transform.mProps.sk&&(e.transform.mProps.sk.setGroupProperty(PropertyInterface("Skew",r)),e.transform.mProps.sa.setGroupProperty(PropertyInterface("Skew Angle",r))),e.transform.op.setGroupProperty(PropertyInterface("Opacity",r)),Object.defineProperties(n,{opacity:{get:ExpressionPropertyInterface(e.transform.mProps.o)},position:{get:ExpressionPropertyInterface(e.transform.mProps.p)},anchorPoint:{get:ExpressionPropertyInterface(e.transform.mProps.a)},scale:{get:ExpressionPropertyInterface(e.transform.mProps.s)},rotation:{get:ExpressionPropertyInterface(e.transform.mProps.r)},skew:{get:ExpressionPropertyInterface(e.transform.mProps.sk)},skewAxis:{get:ExpressionPropertyInterface(e.transform.mProps.sa)},_name:{value:t.nm}}),n.ty="tr",n.mn=t.mn,n.propertyGroup=i,n}function o(t,e,i){function n(e){return t.p.ix===e?n.position:t.s.ix===e?n.size:null}var r=propertyGroupFactory(n,i);n.propertyIndex=t.ix;var s="tm"===e.sh.ty?e.sh.prop:e.sh;return s.s.setGroupProperty(PropertyInterface("Size",r)),s.p.setGroupProperty(PropertyInterface("Position",r)),Object.defineProperties(n,{size:{get:ExpressionPropertyInterface(s.s)},position:{get:ExpressionPropertyInterface(s.p)},_name:{value:t.nm}}),n.mn=t.mn,n}function l(t,e,i){function n(e){return t.p.ix===e?n.position:t.r.ix===e?n.rotation:t.pt.ix===e?n.points:t.or.ix===e||"ADBE Vector Star Outer Radius"===e?n.outerRadius:t.os.ix===e?n.outerRoundness:!t.ir||t.ir.ix!==e&&"ADBE Vector Star Inner Radius"!==e?t.is&&t.is.ix===e?n.innerRoundness:null:n.innerRadius}var r=propertyGroupFactory(n,i),s="tm"===e.sh.ty?e.sh.prop:e.sh;return n.propertyIndex=t.ix,s.or.setGroupProperty(PropertyInterface("Outer Radius",r)),s.os.setGroupProperty(PropertyInterface("Outer Roundness",r)),s.pt.setGroupProperty(PropertyInterface("Points",r)),s.p.setGroupProperty(PropertyInterface("Position",r)),s.r.setGroupProperty(PropertyInterface("Rotation",r)),t.ir&&(s.ir.setGroupProperty(PropertyInterface("Inner Radius",r)),s.is.setGroupProperty(PropertyInterface("Inner Roundness",r))),Object.defineProperties(n,{position:{get:ExpressionPropertyInterface(s.p)},rotation:{get:ExpressionPropertyInterface(s.r)},points:{get:ExpressionPropertyInterface(s.pt)},outerRadius:{get:ExpressionPropertyInterface(s.or)},outerRoundness:{get:ExpressionPropertyInterface(s.os)},innerRadius:{get:ExpressionPropertyInterface(s.ir)},innerRoundness:{get:ExpressionPropertyInterface(s.is)},_name:{value:t.nm}}),n.mn=t.mn,n}function h(t,e,i){function n(e){return t.p.ix===e?n.position:t.r.ix===e?n.roundness:t.s.ix===e||"Size"===e||"ADBE Vector Rect Size"===e?n.size:null}var r=propertyGroupFactory(n,i),s="tm"===e.sh.ty?e.sh.prop:e.sh;return n.propertyIndex=t.ix,s.p.setGroupProperty(PropertyInterface("Position",r)),s.s.setGroupProperty(PropertyInterface("Size",r)),s.r.setGroupProperty(PropertyInterface("Rotation",r)),Object.defineProperties(n,{position:{get:ExpressionPropertyInterface(s.p)},roundness:{get:ExpressionPropertyInterface(s.r)},size:{get:ExpressionPropertyInterface(s.s)},_name:{value:t.nm}}),n.mn=t.mn,n}function c(t,e,i){function n(e){return t.r.ix===e||"Round Corners 1"===e?n.radius:null}var r=propertyGroupFactory(n,i),s=e;return n.propertyIndex=t.ix,s.rd.setGroupProperty(PropertyInterface("Radius",r)),Object.defineProperties(n,{radius:{get:ExpressionPropertyInterface(s.rd)},_name:{value:t.nm}}),n.mn=t.mn,n}function u(t,e,i){function n(e){return t.c.ix===e||"Copies"===e?n.copies:t.o.ix===e||"Offset"===e?n.offset:null}var r=propertyGroupFactory(n,i),s=e;return n.propertyIndex=t.ix,s.c.setGroupProperty(PropertyInterface("Copies",r)),s.o.setGroupProperty(PropertyInterface("Offset",r)),Object.defineProperties(n,{copies:{get:ExpressionPropertyInterface(s.c)},offset:{get:ExpressionPropertyInterface(s.o)},_name:{value:t.nm}}),n.mn=t.mn,n}return function(e,i,n){var r;function s(t){if("number"===typeof t)return 0===(t=void 0===t?1:t)?n:r[t-1];for(var e=0,i=r.length;e<i;){if(r[e]._name===t)return r[e];e+=1}return null}return s.propertyGroup=propertyGroupFactory(s,(function(){return n})),r=t(e,i,s.propertyGroup),s.numProperties=r.length,s._name="Contents",s}}(),TextExpressionInterface=function(t){var e;function i(t){return"ADBE Text Document"===t?i.sourceText:null}return Object.defineProperty(i,"sourceText",{get:function(){t.textProperty.getValue();var i=t.textProperty.currentData.t;return e&&i===e.value||((e=new String(i)).value=i||new String(i),Object.defineProperty(e,"style",{get:function(){return{fillColor:t.textProperty.currentData.fc}}})),e}}),i};function _typeof(t){return _typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}var FootageInterface=function(){var t=function(t){function e(t){return"Outline"===t?e.outlineInterface():null}return e._name="Outline",e.outlineInterface=function(t){var e="",i=t.getFootageData();function n(t){if(i[t])return e=t,"object"===_typeof(i=i[t])?n:i;var r=t.indexOf(e);if(-1!==r){var s=parseInt(t.substr(r+e.length),10);return"object"===_typeof(i=i[s])?n:i}return""}return function(){return e="",i=t.getFootageData(),n}}(t),e};return function(e){function i(t){return"Data"===t?i.dataInterface:null}return i._name="Data",i.dataInterface=t(e),i}}(),interfaces={layer:LayerExpressionInterface,effects:EffectsExpressionInterface,comp:CompExpressionInterface,shape:ShapeExpressionInterface,text:TextExpressionInterface,footage:FootageInterface};function getInterface(t){return interfaces[t]||null}var expressionHelpers={searchExpressions:function(t,e,i){e.x&&(i.k=!0,i.x=!0,i.initiateExpression=ExpressionManager.initiateExpression,i.effectsSequence.push(i.initiateExpression(t,e,i).bind(i)))},getSpeedAtTime:function(t){var e=this.getValueAtTime(t),i=this.getValueAtTime(t+-.01),n=0;if(e.length){var r;for(r=0;r<e.length;r+=1)n+=Math.pow(i[r]-e[r],2);n=100*Math.sqrt(n)}else n=0;return n},getVelocityAtTime:function(t){if(void 0!==this.vel)return this.vel;var e,i,n=-.001,r=this.getValueAtTime(t),s=this.getValueAtTime(t+n);if(r.length)for(e=createTypedArray("float32",r.length),i=0;i<r.length;i+=1)e[i]=(s[i]-r[i])/n;else e=(s-r)/n;return e},getValueAtTime:function(t){return t*=this.elem.globalData.frameRate,(t-=this.offsetTime)!==this._cachingAtTime.lastFrame&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastFrame<t?this._cachingAtTime.lastIndex:0,this._cachingAtTime.value=this.interpolateValue(t,this._cachingAtTime),this._cachingAtTime.lastFrame=t),this._cachingAtTime.value},getStaticValueAtTime:function(){return this.pv},setGroupProperty:function(t){this.propertyGroup=t}};function addPropertyDecorator(){function t(t,e,i){if(!this.k||!this.keyframes)return this.pv;t=t?t.toLowerCase():"";var n,r,s,a,o,l=this.comp.renderedFrame,h=this.keyframes,c=h[h.length-1].t;if(l<=c)return this.pv;if(i?r=c-(n=e?Math.abs(c-this.elem.comp.globalData.frameRate*e):Math.max(0,c-this.elem.data.ip)):((!e||e>h.length-1)&&(e=h.length-1),n=c-(r=h[h.length-1-e].t)),"pingpong"===t){if(Math.floor((l-r)/n)%2!==0)return this.getValueAtTime((n-(l-r)%n+r)/this.comp.globalData.frameRate,0)}else{if("offset"===t){var u=this.getValueAtTime(r/this.comp.globalData.frameRate,0),d=this.getValueAtTime(c/this.comp.globalData.frameRate,0),p=this.getValueAtTime(((l-r)%n+r)/this.comp.globalData.frameRate,0),f=Math.floor((l-r)/n);if(this.pv.length){for(a=(o=new Array(u.length)).length,s=0;s<a;s+=1)o[s]=(d[s]-u[s])*f+p[s];return o}return(d-u)*f+p}if("continue"===t){var m=this.getValueAtTime(c/this.comp.globalData.frameRate,0),g=this.getValueAtTime((c-.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(a=(o=new Array(m.length)).length,s=0;s<a;s+=1)o[s]=m[s]+(m[s]-g[s])*((l-c)/this.comp.globalData.frameRate)/5e-4;return o}return m+(l-c)/.001*(m-g)}}return this.getValueAtTime(((l-r)%n+r)/this.comp.globalData.frameRate,0)}function e(t,e,i){if(!this.k)return this.pv;t=t?t.toLowerCase():"";var n,r,s,a,o,l=this.comp.renderedFrame,h=this.keyframes,c=h[0].t;if(l>=c)return this.pv;if(i?r=c+(n=e?Math.abs(this.elem.comp.globalData.frameRate*e):Math.max(0,this.elem.data.op-c)):((!e||e>h.length-1)&&(e=h.length-1),n=(r=h[e].t)-c),"pingpong"===t){if(Math.floor((c-l)/n)%2===0)return this.getValueAtTime(((c-l)%n+c)/this.comp.globalData.frameRate,0)}else{if("offset"===t){var u=this.getValueAtTime(c/this.comp.globalData.frameRate,0),d=this.getValueAtTime(r/this.comp.globalData.frameRate,0),p=this.getValueAtTime((n-(c-l)%n+c)/this.comp.globalData.frameRate,0),f=Math.floor((c-l)/n)+1;if(this.pv.length){for(a=(o=new Array(u.length)).length,s=0;s<a;s+=1)o[s]=p[s]-(d[s]-u[s])*f;return o}return p-(d-u)*f}if("continue"===t){var m=this.getValueAtTime(c/this.comp.globalData.frameRate,0),g=this.getValueAtTime((c+.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(a=(o=new Array(m.length)).length,s=0;s<a;s+=1)o[s]=m[s]+(m[s]-g[s])*(c-l)/.001;return o}return m+(m-g)*(c-l)/.001}}return this.getValueAtTime((n-((c-l)%n+c))/this.comp.globalData.frameRate,0)}function i(t,e){if(!this.k)return this.pv;if(t=.5*(t||.4),(e=Math.floor(e||5))<=1)return this.pv;var i,n,r=this.comp.renderedFrame/this.comp.globalData.frameRate,s=r-t,a=e>1?(r+t-s)/(e-1):1,o=0,l=0;for(i=this.pv.length?createTypedArray("float32",this.pv.length):0;o<e;){if(n=this.getValueAtTime(s+o*a),this.pv.length)for(l=0;l<this.pv.length;l+=1)i[l]+=n[l];else i+=n;o+=1}if(this.pv.length)for(l=0;l<this.pv.length;l+=1)i[l]/=e;else i/=e;return i}function n(t){this._transformCachingAtTime||(this._transformCachingAtTime={v:new Matrix});var e=this._transformCachingAtTime.v;if(e.cloneFromProps(this.pre.props),this.appliedTransformations<1){var i=this.a.getValueAtTime(t);e.translate(-i[0]*this.a.mult,-i[1]*this.a.mult,i[2]*this.a.mult)}if(this.appliedTransformations<2){var n=this.s.getValueAtTime(t);e.scale(n[0]*this.s.mult,n[1]*this.s.mult,n[2]*this.s.mult)}if(this.sk&&this.appliedTransformations<3){var r=this.sk.getValueAtTime(t),s=this.sa.getValueAtTime(t);e.skewFromAxis(-r*this.sk.mult,s*this.sa.mult)}if(this.r&&this.appliedTransformations<4){var a=this.r.getValueAtTime(t);e.rotate(-a*this.r.mult)}else if(!this.r&&this.appliedTransformations<4){var o=this.rz.getValueAtTime(t),l=this.ry.getValueAtTime(t),h=this.rx.getValueAtTime(t),c=this.or.getValueAtTime(t);e.rotateZ(-o*this.rz.mult).rotateY(l*this.ry.mult).rotateX(h*this.rx.mult).rotateZ(-c[2]*this.or.mult).rotateY(c[1]*this.or.mult).rotateX(c[0]*this.or.mult)}if(this.data.p&&this.data.p.s){var u=this.px.getValueAtTime(t),d=this.py.getValueAtTime(t);if(this.data.p.z){var p=this.pz.getValueAtTime(t);e.translate(u*this.px.mult,d*this.py.mult,-p*this.pz.mult)}else e.translate(u*this.px.mult,d*this.py.mult,0)}else{var f=this.p.getValueAtTime(t);e.translate(f[0]*this.p.mult,f[1]*this.p.mult,-f[2]*this.p.mult)}return e}function r(){return this.v.clone(new Matrix)}var s=TransformPropertyFactory.getTransformProperty;TransformPropertyFactory.getTransformProperty=function(t,e,i){var a=s(t,e,i);return a.dynamicProperties.length?a.getValueAtTime=n.bind(a):a.getValueAtTime=r.bind(a),a.setGroupProperty=expressionHelpers.setGroupProperty,a};var a=PropertyFactory.getProp;PropertyFactory.getProp=function(n,r,s,o,l){var h=a(n,r,s,o,l);h.kf?h.getValueAtTime=expressionHelpers.getValueAtTime.bind(h):h.getValueAtTime=expressionHelpers.getStaticValueAtTime.bind(h),h.setGroupProperty=expressionHelpers.setGroupProperty,h.loopOut=t,h.loopIn=e,h.smooth=i,h.getVelocityAtTime=expressionHelpers.getVelocityAtTime.bind(h),h.getSpeedAtTime=expressionHelpers.getSpeedAtTime.bind(h),h.numKeys=1===r.a?r.k.length:0,h.propertyIndex=r.ix;var c=0;return 0!==s&&(c=createTypedArray("float32",1===r.a?r.k[0].s.length:r.k.length)),h._cachingAtTime={lastFrame:initialDefaultFrame,lastIndex:0,value:c},expressionHelpers.searchExpressions(n,r,h),h.k&&l.addDynamicProperty(h),h};var o=ShapePropertyFactory.getConstructorFunction(),l=ShapePropertyFactory.getKeyframedConstructorFunction();function h(){}h.prototype={vertices:function(t,e){this.k&&this.getValue();var i,n=this.v;void 0!==e&&(n=this.getValueAtTime(e,0));var r=n._length,s=n[t],a=n.v,o=createSizedArray(r);for(i=0;i<r;i+=1)o[i]="i"===t||"o"===t?[s[i][0]-a[i][0],s[i][1]-a[i][1]]:[s[i][0],s[i][1]];return o},points:function(t){return this.vertices("v",t)},inTangents:function(t){return this.vertices("i",t)},outTangents:function(t){return this.vertices("o",t)},isClosed:function(){return this.v.c},pointOnPath:function(t,e){var i=this.v;void 0!==e&&(i=this.getValueAtTime(e,0)),this._segmentsLength||(this._segmentsLength=bez.getSegmentsLength(i));for(var n,r=this._segmentsLength,s=r.lengths,a=r.totalLength*t,o=0,l=s.length,h=0;o<l;){if(h+s[o].addedLength>a){var c=o,u=i.c&&o===l-1?0:o+1,d=(a-h)/s[o].addedLength;n=bez.getPointInSegment(i.v[c],i.v[u],i.o[c],i.i[u],d,s[o]);break}h+=s[o].addedLength,o+=1}return n||(n=i.c?[i.v[0][0],i.v[0][1]]:[i.v[i._length-1][0],i.v[i._length-1][1]]),n},vectorOnPath:function(t,e,i){1==t?t=this.v.c:0==t&&(t=.999);var n=this.pointOnPath(t,e),r=this.pointOnPath(t+.001,e),s=r[0]-n[0],a=r[1]-n[1],o=Math.sqrt(Math.pow(s,2)+Math.pow(a,2));return 0===o?[0,0]:"tangent"===i?[s/o,a/o]:[-a/o,s/o]},tangentOnPath:function(t,e){return this.vectorOnPath(t,e,"tangent")},normalOnPath:function(t,e){return this.vectorOnPath(t,e,"normal")},setGroupProperty:expressionHelpers.setGroupProperty,getValueAtTime:expressionHelpers.getStaticValueAtTime},extendPrototype([h],o),extendPrototype([h],l),l.prototype.getValueAtTime=function(t){return this._cachingAtTime||(this._cachingAtTime={shapeValue:shapePool.clone(this.pv),lastIndex:0,lastTime:initialDefaultFrame}),t*=this.elem.globalData.frameRate,(t-=this.offsetTime)!==this._cachingAtTime.lastTime&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastTime<t?this._caching.lastIndex:0,this._cachingAtTime.lastTime=t,this.interpolateShape(t,this._cachingAtTime.shapeValue,this._cachingAtTime)),this._cachingAtTime.shapeValue},l.prototype.initiateExpression=ExpressionManager.initiateExpression;var c=ShapePropertyFactory.getShapeProp;ShapePropertyFactory.getShapeProp=function(t,e,i,n,r){var s=c(t,e,i,n,r);return s.propertyIndex=e.ix,s.lock=!1,3===i?expressionHelpers.searchExpressions(t,e.pt,s):4===i&&expressionHelpers.searchExpressions(t,e.ks,s),s.k&&t.addDynamicProperty(s),s}}function initialize$1(){addPropertyDecorator()}function addDecorator(){TextProperty.prototype.getExpressionValue=function(t,e){var i=this.calculateExpression(e);if(t.t!==i){var n={};return this.copyData(n,t),n.t=i.toString(),n.__complete=!1,n}return t},TextProperty.prototype.searchProperty=function(){var t=this.searchKeyframes(),e=this.searchExpressions();return this.kf=t||e,this.kf},TextProperty.prototype.searchExpressions=function(){return this.data.d.x?(this.calculateExpression=ExpressionManager.initiateExpression.bind(this)(this.elem,this.data.d,this),this.addEffect(this.getExpressionValue.bind(this)),!0):null}}function initialize(){addDecorator()}function SVGComposableEffect(){}SVGComposableEffect.prototype={createMergeNode:function(t,e){var i,n,r=createNS("feMerge");for(r.setAttribute("result",t),n=0;n<e.length;n+=1)(i=createNS("feMergeNode")).setAttribute("in",e[n]),r.appendChild(i),r.appendChild(i);return r}};var linearFilterValue="0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0";function SVGTintFilter(t,e,i,n,r){this.filterManager=e;var s=createNS("feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("color-interpolation-filters","linearRGB"),s.setAttribute("values",linearFilterValue+" 1 0"),this.linearFilter=s,s.setAttribute("result",n+"_tint_1"),t.appendChild(s),(s=createNS("feColorMatrix")).setAttribute("type","matrix"),s.setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),s.setAttribute("result",n+"_tint_2"),t.appendChild(s),this.matrixFilter=s;var a=this.createMergeNode(n,[r,n+"_tint_1",n+"_tint_2"]);t.appendChild(a)}function SVGFillFilter(t,e,i,n){this.filterManager=e;var r=createNS("feColorMatrix");r.setAttribute("type","matrix"),r.setAttribute("color-interpolation-filters","sRGB"),r.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),r.setAttribute("result",n),t.appendChild(r),this.matrixFilter=r}function SVGStrokeEffect(t,e,i){this.initialized=!1,this.filterManager=e,this.elem=i,this.paths=[]}function SVGTritoneFilter(t,e,i,n){this.filterManager=e;var r=createNS("feColorMatrix");r.setAttribute("type","matrix"),r.setAttribute("color-interpolation-filters","linearRGB"),r.setAttribute("values","0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0"),t.appendChild(r);var s=createNS("feComponentTransfer");s.setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("result",n),this.matrixFilter=s;var a=createNS("feFuncR");a.setAttribute("type","table"),s.appendChild(a),this.feFuncR=a;var o=createNS("feFuncG");o.setAttribute("type","table"),s.appendChild(o),this.feFuncG=o;var l=createNS("feFuncB");l.setAttribute("type","table"),s.appendChild(l),this.feFuncB=l,t.appendChild(s)}function SVGProLevelsFilter(t,e,i,n){this.filterManager=e;var r=this.filterManager.effectElements,s=createNS("feComponentTransfer");(r[10].p.k||0!==r[10].p.v||r[11].p.k||1!==r[11].p.v||r[12].p.k||1!==r[12].p.v||r[13].p.k||0!==r[13].p.v||r[14].p.k||1!==r[14].p.v)&&(this.feFuncR=this.createFeFunc("feFuncR",s)),(r[17].p.k||0!==r[17].p.v||r[18].p.k||1!==r[18].p.v||r[19].p.k||1!==r[19].p.v||r[20].p.k||0!==r[20].p.v||r[21].p.k||1!==r[21].p.v)&&(this.feFuncG=this.createFeFunc("feFuncG",s)),(r[24].p.k||0!==r[24].p.v||r[25].p.k||1!==r[25].p.v||r[26].p.k||1!==r[26].p.v||r[27].p.k||0!==r[27].p.v||r[28].p.k||1!==r[28].p.v)&&(this.feFuncB=this.createFeFunc("feFuncB",s)),(r[31].p.k||0!==r[31].p.v||r[32].p.k||1!==r[32].p.v||r[33].p.k||1!==r[33].p.v||r[34].p.k||0!==r[34].p.v||r[35].p.k||1!==r[35].p.v)&&(this.feFuncA=this.createFeFunc("feFuncA",s)),(this.feFuncR||this.feFuncG||this.feFuncB||this.feFuncA)&&(s.setAttribute("color-interpolation-filters","sRGB"),t.appendChild(s)),(r[3].p.k||0!==r[3].p.v||r[4].p.k||1!==r[4].p.v||r[5].p.k||1!==r[5].p.v||r[6].p.k||0!==r[6].p.v||r[7].p.k||1!==r[7].p.v)&&((s=createNS("feComponentTransfer")).setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("result",n),t.appendChild(s),this.feFuncRComposed=this.createFeFunc("feFuncR",s),this.feFuncGComposed=this.createFeFunc("feFuncG",s),this.feFuncBComposed=this.createFeFunc("feFuncB",s))}function SVGDropShadowEffect(t,e,i,n,r){var s=e.container.globalData.renderConfig.filterSize,a=e.data.fs||s;t.setAttribute("x",a.x||s.x),t.setAttribute("y",a.y||s.y),t.setAttribute("width",a.width||s.width),t.setAttribute("height",a.height||s.height),this.filterManager=e;var o=createNS("feGaussianBlur");o.setAttribute("in","SourceAlpha"),o.setAttribute("result",n+"_drop_shadow_1"),o.setAttribute("stdDeviation","0"),this.feGaussianBlur=o,t.appendChild(o);var l=createNS("feOffset");l.setAttribute("dx","25"),l.setAttribute("dy","0"),l.setAttribute("in",n+"_drop_shadow_1"),l.setAttribute("result",n+"_drop_shadow_2"),this.feOffset=l,t.appendChild(l);var h=createNS("feFlood");h.setAttribute("flood-color","#00ff00"),h.setAttribute("flood-opacity","1"),h.setAttribute("result",n+"_drop_shadow_3"),this.feFlood=h,t.appendChild(h);var c=createNS("feComposite");c.setAttribute("in",n+"_drop_shadow_3"),c.setAttribute("in2",n+"_drop_shadow_2"),c.setAttribute("operator","in"),c.setAttribute("result",n+"_drop_shadow_4"),t.appendChild(c);var u=this.createMergeNode(n,[n+"_drop_shadow_4",r]);t.appendChild(u)}extendPrototype([SVGComposableEffect],SVGTintFilter),SVGTintFilter.prototype.renderFrame=function(t){if(t||this.filterManager._mdf){var e=this.filterManager.effectElements[0].p.v,i=this.filterManager.effectElements[1].p.v,n=this.filterManager.effectElements[2].p.v/100;this.linearFilter.setAttribute("values",linearFilterValue+" "+n+" 0"),this.matrixFilter.setAttribute("values",i[0]-e[0]+" 0 0 0 "+e[0]+" "+(i[1]-e[1])+" 0 0 0 "+e[1]+" "+(i[2]-e[2])+" 0 0 0 "+e[2]+" 0 0 0 1 0")}},SVGFillFilter.prototype.renderFrame=function(t){if(t||this.filterManager._mdf){var e=this.filterManager.effectElements[2].p.v,i=this.filterManager.effectElements[6].p.v;this.matrixFilter.setAttribute("values","0 0 0 0 "+e[0]+" 0 0 0 0 "+e[1]+" 0 0 0 0 "+e[2]+" 0 0 0 "+i+" 0")}},SVGStrokeEffect.prototype.initialize=function(){var t,e,i,n,r=this.elem.layerElement.children||this.elem.layerElement.childNodes;for(1===this.filterManager.effectElements[1].p.v?(n=this.elem.maskManager.masksProperties.length,i=0):n=1+(i=this.filterManager.effectElements[0].p.v-1),(e=createNS("g")).setAttribute("fill","none"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-dashoffset",1);i<n;i+=1)t=createNS("path"),e.appendChild(t),this.paths.push({p:t,m:i});if(3===this.filterManager.effectElements[10].p.v){var s=createNS("mask"),a=createElementID();s.setAttribute("id",a),s.setAttribute("mask-type","alpha"),s.appendChild(e),this.elem.globalData.defs.appendChild(s);var o=createNS("g");for(o.setAttribute("mask","url("+getLocationHref()+"#"+a+")");r[0];)o.appendChild(r[0]);this.elem.layerElement.appendChild(o),this.masker=s,e.setAttribute("stroke","#fff")}else if(1===this.filterManager.effectElements[10].p.v||2===this.filterManager.effectElements[10].p.v){if(2===this.filterManager.effectElements[10].p.v)for(r=this.elem.layerElement.children||this.elem.layerElement.childNodes;r.length;)this.elem.layerElement.removeChild(r[0]);this.elem.layerElement.appendChild(e),this.elem.layerElement.removeAttribute("mask"),e.setAttribute("stroke","#fff")}this.initialized=!0,this.pathMasker=e},SVGStrokeEffect.prototype.renderFrame=function(t){var e;this.initialized||this.initialize();var i,n,r=this.paths.length;for(e=0;e<r;e+=1)if(-1!==this.paths[e].m&&(i=this.elem.maskManager.viewData[this.paths[e].m],n=this.paths[e].p,(t||this.filterManager._mdf||i.prop._mdf)&&n.setAttribute("d",i.lastPath),t||this.filterManager.effectElements[9].p._mdf||this.filterManager.effectElements[4].p._mdf||this.filterManager.effectElements[7].p._mdf||this.filterManager.effectElements[8].p._mdf||i.prop._mdf)){var s;if(0!==this.filterManager.effectElements[7].p.v||100!==this.filterManager.effectElements[8].p.v){var a=.01*Math.min(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v),o=.01*Math.max(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v),l=n.getTotalLength();s="0 0 0 "+l*a+" ";var h,c=l*(o-a),u=1+2*this.filterManager.effectElements[4].p.v*this.filterManager.effectElements[9].p.v*.01,d=Math.floor(c/u);for(h=0;h<d;h+=1)s+="1 "+2*this.filterManager.effectElements[4].p.v*this.filterManager.effectElements[9].p.v*.01+" ";s+="0 "+10*l+" 0 0"}else s="1 "+2*this.filterManager.effectElements[4].p.v*this.filterManager.effectElements[9].p.v*.01;n.setAttribute("stroke-dasharray",s)}if((t||this.filterManager.effectElements[4].p._mdf)&&this.pathMasker.setAttribute("stroke-width",2*this.filterManager.effectElements[4].p.v),(t||this.filterManager.effectElements[6].p._mdf)&&this.pathMasker.setAttribute("opacity",this.filterManager.effectElements[6].p.v),(1===this.filterManager.effectElements[10].p.v||2===this.filterManager.effectElements[10].p.v)&&(t||this.filterManager.effectElements[3].p._mdf)){var p=this.filterManager.effectElements[3].p.v;this.pathMasker.setAttribute("stroke","rgb("+bmFloor(255*p[0])+","+bmFloor(255*p[1])+","+bmFloor(255*p[2])+")")}},SVGTritoneFilter.prototype.renderFrame=function(t){if(t||this.filterManager._mdf){var e=this.filterManager.effectElements[0].p.v,i=this.filterManager.effectElements[1].p.v,n=this.filterManager.effectElements[2].p.v,r=n[0]+" "+i[0]+" "+e[0],s=n[1]+" "+i[1]+" "+e[1],a=n[2]+" "+i[2]+" "+e[2];this.feFuncR.setAttribute("tableValues",r),this.feFuncG.setAttribute("tableValues",s),this.feFuncB.setAttribute("tableValues",a)}},SVGProLevelsFilter.prototype.createFeFunc=function(t,e){var i=createNS(t);return i.setAttribute("type","table"),e.appendChild(i),i},SVGProLevelsFilter.prototype.getTableValue=function(t,e,i,n,r){for(var s,a,o=0,l=Math.min(t,e),h=Math.max(t,e),c=Array.call(null,{length:256}),u=0,d=r-n,p=e-t;o<=256;)a=(s=o/256)<=l?p<0?r:n:s>=h?p<0?n:r:n+d*Math.pow((s-t)/p,1/i),c[u]=a,u+=1,o+=256/255;return c.join(" ")},SVGProLevelsFilter.prototype.renderFrame=function(t){if(t||this.filterManager._mdf){var e,i=this.filterManager.effectElements;this.feFuncRComposed&&(t||i[3].p._mdf||i[4].p._mdf||i[5].p._mdf||i[6].p._mdf||i[7].p._mdf)&&(e=this.getTableValue(i[3].p.v,i[4].p.v,i[5].p.v,i[6].p.v,i[7].p.v),this.feFuncRComposed.setAttribute("tableValues",e),this.feFuncGComposed.setAttribute("tableValues",e),this.feFuncBComposed.setAttribute("tableValues",e)),this.feFuncR&&(t||i[10].p._mdf||i[11].p._mdf||i[12].p._mdf||i[13].p._mdf||i[14].p._mdf)&&(e=this.getTableValue(i[10].p.v,i[11].p.v,i[12].p.v,i[13].p.v,i[14].p.v),this.feFuncR.setAttribute("tableValues",e)),this.feFuncG&&(t||i[17].p._mdf||i[18].p._mdf||i[19].p._mdf||i[20].p._mdf||i[21].p._mdf)&&(e=this.getTableValue(i[17].p.v,i[18].p.v,i[19].p.v,i[20].p.v,i[21].p.v),this.feFuncG.setAttribute("tableValues",e)),this.feFuncB&&(t||i[24].p._mdf||i[25].p._mdf||i[26].p._mdf||i[27].p._mdf||i[28].p._mdf)&&(e=this.getTableValue(i[24].p.v,i[25].p.v,i[26].p.v,i[27].p.v,i[28].p.v),this.feFuncB.setAttribute("tableValues",e)),this.feFuncA&&(t||i[31].p._mdf||i[32].p._mdf||i[33].p._mdf||i[34].p._mdf||i[35].p._mdf)&&(e=this.getTableValue(i[31].p.v,i[32].p.v,i[33].p.v,i[34].p.v,i[35].p.v),this.feFuncA.setAttribute("tableValues",e))}},extendPrototype([SVGComposableEffect],SVGDropShadowEffect),SVGDropShadowEffect.prototype.renderFrame=function(t){if(t||this.filterManager._mdf){if((t||this.filterManager.effectElements[4].p._mdf)&&this.feGaussianBlur.setAttribute("stdDeviation",this.filterManager.effectElements[4].p.v/4),t||this.filterManager.effectElements[0].p._mdf){var e=this.filterManager.effectElements[0].p.v;this.feFlood.setAttribute("flood-color",rgbToHex(Math.round(255*e[0]),Math.round(255*e[1]),Math.round(255*e[2])))}if((t||this.filterManager.effectElements[1].p._mdf)&&this.feFlood.setAttribute("flood-opacity",this.filterManager.effectElements[1].p.v/255),t||this.filterManager.effectElements[2].p._mdf||this.filterManager.effectElements[3].p._mdf){var i=this.filterManager.effectElements[3].p.v,n=(this.filterManager.effectElements[2].p.v-90)*degToRads,r=i*Math.cos(n),s=i*Math.sin(n);this.feOffset.setAttribute("dx",r),this.feOffset.setAttribute("dy",s)}}};var _svgMatteSymbols=[];function SVGMatte3Effect(t,e,i){this.initialized=!1,this.filterManager=e,this.filterElem=t,this.elem=i,i.matteElement=createNS("g"),i.matteElement.appendChild(i.layerElement),i.matteElement.appendChild(i.transformedElement),i.baseElement=i.matteElement}function SVGGaussianBlurEffect(t,e,i,n){t.setAttribute("x","-100%"),t.setAttribute("y","-100%"),t.setAttribute("width","300%"),t.setAttribute("height","300%"),this.filterManager=e;var r=createNS("feGaussianBlur");r.setAttribute("result",n),t.appendChild(r),this.feGaussianBlur=r}function TransformEffect(){}function SVGTransformEffect(t,e){this.init(e)}function CVTransformEffect(t){this.init(t)}return SVGMatte3Effect.prototype.findSymbol=function(t){for(var e=0,i=_svgMatteSymbols.length;e<i;){if(_svgMatteSymbols[e]===t)return _svgMatteSymbols[e];e+=1}return null},SVGMatte3Effect.prototype.replaceInParent=function(t,e){var i=t.layerElement.parentNode;if(i){for(var n,r=i.children,s=0,a=r.length;s<a&&r[s]!==t.layerElement;)s+=1;s<=a-2&&(n=r[s+1]);var o=createNS("use");o.setAttribute("href","#"+e),n?i.insertBefore(o,n):i.appendChild(o)}},SVGMatte3Effect.prototype.setElementAsMask=function(t,e){if(!this.findSymbol(e)){var i=createElementID(),n=createNS("mask");n.setAttribute("id",e.layerId),n.setAttribute("mask-type","alpha"),_svgMatteSymbols.push(e);var r=t.globalData.defs;r.appendChild(n);var s=createNS("symbol");s.setAttribute("id",i),this.replaceInParent(e,i),s.appendChild(e.layerElement),r.appendChild(s);var a=createNS("use");a.setAttribute("href","#"+i),n.appendChild(a),e.data.hd=!1,e.show()}t.setMatte(e.layerId)},SVGMatte3Effect.prototype.initialize=function(){for(var t=this.filterManager.effectElements[0].p.v,e=this.elem.comp.elements,i=0,n=e.length;i<n;)e[i]&&e[i].data.ind===t&&this.setElementAsMask(this.elem,e[i]),i+=1;this.initialized=!0},SVGMatte3Effect.prototype.renderFrame=function(){this.initialized||this.initialize()},SVGGaussianBlurEffect.prototype.renderFrame=function(t){if(t||this.filterManager._mdf){var e=.3*this.filterManager.effectElements[0].p.v,i=this.filterManager.effectElements[1].p.v,n=3==i?0:e,r=2==i?0:e;this.feGaussianBlur.setAttribute("stdDeviation",n+" "+r);var s=1==this.filterManager.effectElements[2].p.v?"wrap":"duplicate";this.feGaussianBlur.setAttribute("edgeMode",s)}},TransformEffect.prototype.init=function(t){this.effectsManager=t,this.type=effectTypes.TRANSFORM_EFFECT,this.matrix=new Matrix,this.opacity=-1,this._mdf=!1,this._opMdf=!1},TransformEffect.prototype.renderFrame=function(t){if(this._opMdf=!1,this._mdf=!1,t||this.effectsManager._mdf){var e=this.effectsManager.effectElements,i=e[0].p.v,n=e[1].p.v,r=1===e[2].p.v,s=e[3].p.v,a=r?s:e[4].p.v,o=e[5].p.v,l=e[6].p.v,h=e[7].p.v;this.matrix.reset(),this.matrix.translate(-i[0],-i[1],i[2]),this.matrix.scale(.01*a,.01*s,1),this.matrix.rotate(-h*degToRads),this.matrix.skewFromAxis(-o*degToRads,(l+90)*degToRads),this.matrix.translate(n[0],n[1],0),this._mdf=!0,this.opacity!==e[8].p.v&&(this.opacity=e[8].p.v,this._opMdf=!0)}},extendPrototype([TransformEffect],SVGTransformEffect),extendPrototype([TransformEffect],CVTransformEffect),registerRenderer("canvas",CanvasRenderer),registerRenderer("html",HybridRenderer),registerRenderer("svg",SVGRenderer),ShapeModifiers.registerModifier("tm",TrimModifier),ShapeModifiers.registerModifier("pb",PuckerAndBloatModifier),ShapeModifiers.registerModifier("rp",RepeaterModifier),ShapeModifiers.registerModifier("rd",RoundCornersModifier),ShapeModifiers.registerModifier("zz",ZigZagModifier),ShapeModifiers.registerModifier("op",OffsetPathModifier),setExpressionsPlugin(Expressions),setExpressionInterfaces(getInterface),initialize$1(),initialize(),registerEffect$1(20,SVGTintFilter,!0),registerEffect$1(21,SVGFillFilter,!0),registerEffect$1(22,SVGStrokeEffect,!1),registerEffect$1(23,SVGTritoneFilter,!0),registerEffect$1(24,SVGProLevelsFilter,!0),registerEffect$1(25,SVGDropShadowEffect,!0),registerEffect$1(28,SVGMatte3Effect,!1),registerEffect$1(29,SVGGaussianBlurEffect,!0),registerEffect$1(35,SVGTransformEffect,!1),registerEffect(35,CVTransformEffect),lottie},module.exports=factory())},391:(t,e,i)=>{"use strict";!function t(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}(),t.exports=i(4)},446:(t,e,i)=>{var n=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,a=/^0o[0-7]+$/i,o=parseInt,l="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g,h="object"==typeof self&&self&&self.Object===Object&&self,c=l||h||Function("return this")(),u=Object.prototype.toString,d=Math.max,p=Math.min,f=function(){return c.Date.now()};function m(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function g(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&"[object Symbol]"==u.call(t)}(t))return NaN;if(m(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=m(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(n,"");var i=s.test(t);return i||a.test(t)?o(t.slice(2),i?2:8):r.test(t)?NaN:+t}t.exports=function(t,e,i){var n,r,s,a,o,l,h=0,c=!1,u=!1,v=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function y(e){var i=n,s=r;return n=r=void 0,h=e,a=t.apply(s,i)}function b(t){var i=t-l;return void 0===l||i>=e||i<0||u&&t-h>=s}function x(){var t=f();if(b(t))return w(t);o=setTimeout(x,function(t){var i=e-(t-l);return u?p(i,s-(t-h)):i}(t))}function w(t){return o=void 0,v&&n?y(t):(n=r=void 0,a)}function S(){var t=f(),i=b(t);if(n=arguments,r=this,l=t,i){if(void 0===o)return function(t){return h=t,o=setTimeout(x,e),c?y(t):a}(l);if(u)return o=setTimeout(x,e),y(l)}return void 0===o&&(o=setTimeout(x,e)),a}return e=g(e)||0,m(i)&&(c=!!i.leading,s=(u="maxWait"in i)?d(g(i.maxWait)||0,e):s,v="trailing"in i?!!i.trailing:v),S.cancel=function(){void 0!==o&&clearTimeout(o),h=0,n=l=r=o=void 0},S.flush=function(){return void 0===o?a:w(f())},S}},579:(t,e,i)=>{"use strict";t.exports=i(799)},672:(t,e,i)=>{"use strict";var n=i(43);function r(t){var e="https://react.dev/errors/"+t;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var i=2;i<arguments.length;i++)e+="&args[]="+encodeURIComponent(arguments[i])}return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var a={d:{f:s,r:function(){throw Error(r(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},o=Symbol.for("react.portal");var l=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(t,e){return"font"===t?"":"string"===typeof e?"use-credentials"===e?e:"":void 0}e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,e.createPortal=function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)throw Error(r(299));return function(t,e,i){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:o,key:null==n?null:""+n,children:t,containerInfo:e,implementation:i}}(t,e,null,i)},e.flushSync=function(t){var e=l.T,i=a.p;try{if(l.T=null,a.p=2,t)return t()}finally{l.T=e,a.p=i,a.d.f()}},e.preconnect=function(t,e){"string"===typeof t&&(e?e="string"===typeof(e=e.crossOrigin)?"use-credentials"===e?e:"":void 0:e=null,a.d.C(t,e))},e.prefetchDNS=function(t){"string"===typeof t&&a.d.D(t)},e.preinit=function(t,e){if("string"===typeof t&&e&&"string"===typeof e.as){var i=e.as,n=h(i,e.crossOrigin),r="string"===typeof e.integrity?e.integrity:void 0,s="string"===typeof e.fetchPriority?e.fetchPriority:void 0;"style"===i?a.d.S(t,"string"===typeof e.precedence?e.precedence:void 0,{crossOrigin:n,integrity:r,fetchPriority:s}):"script"===i&&a.d.X(t,{crossOrigin:n,integrity:r,fetchPriority:s,nonce:"string"===typeof e.nonce?e.nonce:void 0})}},e.preinitModule=function(t,e){if("string"===typeof t)if("object"===typeof e&&null!==e){if(null==e.as||"script"===e.as){var i=h(e.as,e.crossOrigin);a.d.M(t,{crossOrigin:i,integrity:"string"===typeof e.integrity?e.integrity:void 0,nonce:"string"===typeof e.nonce?e.nonce:void 0})}}else null==e&&a.d.M(t)},e.preload=function(t,e){if("string"===typeof t&&"object"===typeof e&&null!==e&&"string"===typeof e.as){var i=e.as,n=h(i,e.crossOrigin);a.d.L(t,i,{crossOrigin:n,integrity:"string"===typeof e.integrity?e.integrity:void 0,nonce:"string"===typeof e.nonce?e.nonce:void 0,type:"string"===typeof e.type?e.type:void 0,fetchPriority:"string"===typeof e.fetchPriority?e.fetchPriority:void 0,referrerPolicy:"string"===typeof e.referrerPolicy?e.referrerPolicy:void 0,imageSrcSet:"string"===typeof e.imageSrcSet?e.imageSrcSet:void 0,imageSizes:"string"===typeof e.imageSizes?e.imageSizes:void 0,media:"string"===typeof e.media?e.media:void 0})}},e.preloadModule=function(t,e){if("string"===typeof t)if(e){var i=h(e.as,e.crossOrigin);a.d.m(t,{as:"string"===typeof e.as&&"script"!==e.as?e.as:void 0,crossOrigin:i,integrity:"string"===typeof e.integrity?e.integrity:void 0})}else a.d.m(t)},e.requestFormReset=function(t){a.d.r(t)},e.unstable_batchedUpdates=function(t,e){return t(e)},e.useFormState=function(t,e,i){return l.H.useFormState(t,e,i)},e.useFormStatus=function(){return l.H.useHostTransitionStatus()},e.version="19.0.0"},750:function(t,e,i){!function(t,e,i){"use strict";function n(t){return t&&"object"===typeof t&&"default"in t?t:{default:t}}var r=n(e),s=n(i);function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function o(t){if(Array.isArray(t))return t}function l(t,e,i){return(e=v(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function h(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var n,r,s,a,o=[],l=!0,h=!1;try{if(s=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;l=!1}else for(;!(l=(n=s.call(i)).done)&&(o.push(n.value),o.length!==e);l=!0);}catch(t){h=!0,r=t}finally{try{if(!l&&null!=i.return&&(a=i.return(),Object(a)!==a))return}finally{if(h)throw r}}return o}}function c(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function d(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?u(Object(i),!0).forEach((function(e){l(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function p(t,e){if(null==t)return{};var i,n,r=f(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(n=0;n<s.length;n++)i=s[n],e.includes(i)||{}.propertyIsEnumerable.call(t,i)&&(r[i]=t[i])}return r}function f(t,e){if(null==t)return{};var i={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.includes(n))continue;i[n]=t[n]}return i}function m(t,e){return o(t)||h(t,e)||y(t,e)||c()}function g(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function v(t){var e=g(t,"string");return"symbol"==typeof e?e:e+""}function y(t,e){if(t){if("string"==typeof t)return a(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?a(t,e):void 0}}var b=["animationData","loop","autoplay","initialSegment","onComplete","onLoopComplete","onEnterFrame","onSegmentStart","onConfigReady","onDataReady","onDataFailed","onLoadedImages","onDOMLoaded","onDestroy","lottieRef","renderer","name","assetsPath","rendererSettings"],x=function(t,e){var n=t.animationData,a=t.loop,o=t.autoplay,l=t.initialSegment,h=t.onComplete,c=t.onLoopComplete,u=t.onEnterFrame,f=t.onSegmentStart,g=t.onConfigReady,v=t.onDataReady,y=t.onDataFailed,x=t.onLoadedImages,w=t.onDOMLoaded,S=t.onDestroy;t.lottieRef,t.renderer,t.name,t.assetsPath,t.rendererSettings;var A=p(t,b),E=m(i.useState(!1),2),_=E[0],C=E[1],M=i.useRef(),P=i.useRef(null),T=function(){var t;null===(t=M.current)||void 0===t||t.play()},D=function(){var t;null===(t=M.current)||void 0===t||t.stop()},k=function(){var t;null===(t=M.current)||void 0===t||t.pause()},I=function(t){var e;null===(e=M.current)||void 0===e||e.setSpeed(t)},R=function(t,e){var i;null===(i=M.current)||void 0===i||i.goToAndPlay(t,e)},O=function(t,e){var i;null===(i=M.current)||void 0===i||i.goToAndStop(t,e)},L=function(t){var e;null===(e=M.current)||void 0===e||e.setDirection(t)},B=function(t,e){var i;null===(i=M.current)||void 0===i||i.playSegments(t,e)},z=function(t){var e;null===(e=M.current)||void 0===e||e.setSubframe(t)},F=function(t){var e;return null===(e=M.current)||void 0===e?void 0:e.getDuration(t)},N=function(){var t;null===(t=M.current)||void 0===t||t.destroy(),M.current=void 0},U=function(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(P.current){null===(e=M.current)||void 0===e||e.destroy();var n=d(d(d({},t),i),{},{container:P.current});return M.current=r.default.loadAnimation(n),C(!!M.current),function(){var t;null===(t=M.current)||void 0===t||t.destroy(),M.current=void 0}}};return i.useEffect((function(){var t=U();return function(){return null===t||void 0===t?void 0:t()}}),[n,a]),i.useEffect((function(){M.current&&(M.current.autoplay=!!o)}),[o]),i.useEffect((function(){M.current&&(l?Array.isArray(l)&&l.length&&((M.current.currentRawFrame<l[0]||M.current.currentRawFrame>l[1])&&(M.current.currentRawFrame=l[0]),M.current.setSegment(l[0],l[1])):M.current.resetSegments(!0))}),[l]),i.useEffect((function(){var t=[{name:"complete",handler:h},{name:"loopComplete",handler:c},{name:"enterFrame",handler:u},{name:"segmentStart",handler:f},{name:"config_ready",handler:g},{name:"data_ready",handler:v},{name:"data_failed",handler:y},{name:"loaded_images",handler:x},{name:"DOMLoaded",handler:w},{name:"destroy",handler:S}].filter((function(t){return null!=t.handler}));if(t.length){var e=t.map((function(t){var e;return null===(e=M.current)||void 0===e||e.addEventListener(t.name,t.handler),function(){var e;null===(e=M.current)||void 0===e||e.removeEventListener(t.name,t.handler)}}));return function(){e.forEach((function(t){return t()}))}}}),[h,c,u,f,g,v,y,x,w,S]),{View:s.default.createElement("div",d({style:e,ref:P},A)),play:T,stop:D,pause:k,setSpeed:I,goToAndStop:O,goToAndPlay:R,setDirection:L,playSegments:B,setSubframe:z,getDuration:F,destroy:N,animationContainerRef:P,animationLoaded:_,animationItem:M.current}};function w(t){var e=t.getBoundingClientRect(),i=e.top,n=e.height;return(window.innerHeight-i)/(window.innerHeight+n)}function S(t,e,i){var n=t.getBoundingClientRect(),r=n.top;return{x:(e-n.left)/n.width,y:(i-r)/n.height}}var A=function(t){var e=t.wrapperRef,n=t.animationItem,r=t.mode,s=t.actions;i.useEffect((function(){var t=e.current;if(t&&n&&s.length){n.stop();var i=function(){var e=null,i=function(){var i=w(t),r=s.find((function(t){var e=t.visibility;return e&&i>=e[0]&&i<=e[1]}));if(r){if("seek"===r.type&&r.visibility&&2===r.frames.length){var a=r.frames[0]+Math.ceil((i-r.visibility[0])/(r.visibility[1]-r.visibility[0])*r.frames[1]);n.goToAndStop(a-n.firstFrame-1,!0)}"loop"===r.type&&(null===e||e!==r.frames||n.isPaused)&&(n.playSegments(r.frames,!0),e=r.frames),"play"===r.type&&n.isPaused&&(n.resetSegments(!0),n.play()),"stop"===r.type&&n.goToAndStop(r.frames[0]-n.firstFrame-1,!0)}};return document.addEventListener("scroll",i),function(){document.removeEventListener("scroll",i)}},a=function(){var e=function(e,i){var r=e,a=i;if(-1!==r&&-1!==a){var o=S(t,r,a);r=o.x,a=o.y}var l=s.find((function(t){var e=t.position;return e&&Array.isArray(e.x)&&Array.isArray(e.y)?r>=e.x[0]&&r<=e.x[1]&&a>=e.y[0]&&a<=e.y[1]:!(!e||Number.isNaN(e.x)||Number.isNaN(e.y))&&r===e.x&&a===e.y}));if(l){if("seek"===l.type&&l.position&&Array.isArray(l.position.x)&&Array.isArray(l.position.y)&&2===l.frames.length){var h=(r-l.position.x[0])/(l.position.x[1]-l.position.x[0]),c=(a-l.position.y[0])/(l.position.y[1]-l.position.y[0]);n.playSegments(l.frames,!0),n.goToAndStop(Math.ceil((h+c)/2*(l.frames[1]-l.frames[0])),!0)}"loop"===l.type&&n.playSegments(l.frames,!0),"play"===l.type&&(n.isPaused&&n.resetSegments(!1),n.playSegments(l.frames)),"stop"===l.type&&n.goToAndStop(l.frames[0],!0)}},i=function(t){e(t.clientX,t.clientY)},r=function(){e(-1,-1)};return t.addEventListener("mousemove",i),t.addEventListener("mouseout",r),function(){t.removeEventListener("mousemove",i),t.removeEventListener("mouseout",r)}};switch(r){case"scroll":return i();case"cursor":return a()}}}),[r,n])},E=function(t){var e=t.actions,i=t.mode,n=t.lottieObj,r=n.animationItem,s=n.View,a=n.animationContainerRef;return A({actions:e,animationItem:r,mode:i,wrapperRef:a}),s},_=["style","interactivity"],C=function(t){var e,n,r,s=t.style,a=t.interactivity,o=p(t,_),l=x(o,s),h=l.View,c=l.play,u=l.stop,d=l.pause,f=l.setSpeed,m=l.goToAndStop,g=l.goToAndPlay,v=l.setDirection,y=l.playSegments,b=l.setSubframe,w=l.getDuration,S=l.destroy,A=l.animationContainerRef,C=l.animationLoaded,M=l.animationItem;return i.useEffect((function(){t.lottieRef&&(t.lottieRef.current={play:c,stop:u,pause:d,setSpeed:f,goToAndPlay:g,goToAndStop:m,setDirection:v,playSegments:y,setSubframe:b,getDuration:w,destroy:S,animationContainerRef:A,animationLoaded:C,animationItem:M})}),[null===(e=t.lottieRef)||void 0===e?void 0:e.current]),E({lottieObj:{View:h,play:c,stop:u,pause:d,setSpeed:f,goToAndStop:m,goToAndPlay:g,setDirection:v,playSegments:y,setSubframe:b,getDuration:w,destroy:S,animationContainerRef:A,animationLoaded:C,animationItem:M},actions:null!==(n=null===a||void 0===a?void 0:a.actions)&&void 0!==n?n:[],mode:null!==(r=null===a||void 0===a?void 0:a.mode)&&void 0!==r?r:"scroll"})};Object.defineProperty(t,"LottiePlayer",{enumerable:!0,get:function(){return r.default}}),t.default=C,t.useLottie=x,t.useLottieInteractivity=E,Object.defineProperty(t,"__esModule",{value:!0})}(e,i(302),i(43))},799:(t,e)=>{"use strict";var i=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function r(t,e,n){var r=null;if(void 0!==n&&(r=""+n),void 0!==e.key&&(r=""+e.key),"key"in e)for(var s in n={},e)"key"!==s&&(n[s]=e[s]);else n=e;return e=n.ref,{$$typeof:i,type:t,key:r,ref:void 0!==e?e:null,props:n}}e.Fragment=n,e.jsx=r,e.jsxs=r},853:(t,e,i)=>{"use strict";t.exports=i(896)},896:(t,e)=>{"use strict";function i(t,e){var i=t.length;t.push(e);t:for(;0<i;){var n=i-1>>>1,r=t[n];if(!(0<s(r,e)))break t;t[n]=e,t[i]=r,i=n}}function n(t){return 0===t.length?null:t[0]}function r(t){if(0===t.length)return null;var e=t[0],i=t.pop();if(i!==e){t[0]=i;t:for(var n=0,r=t.length,a=r>>>1;n<a;){var o=2*(n+1)-1,l=t[o],h=o+1,c=t[h];if(0>s(l,i))h<r&&0>s(c,l)?(t[n]=c,t[h]=i,n=h):(t[n]=l,t[o]=i,n=o);else{if(!(h<r&&0>s(c,i)))break t;t[n]=c,t[h]=i,n=h}}}return e}function s(t,e){var i=t.sortIndex-e.sortIndex;return 0!==i?i:t.id-e.id}if(e.unstable_now=void 0,"object"===typeof performance&&"function"===typeof performance.now){var a=performance;e.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();e.unstable_now=function(){return o.now()-l}}var h=[],c=[],u=1,d=null,p=3,f=!1,m=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function x(t){for(var e=n(c);null!==e;){if(null===e.callback)r(c);else{if(!(e.startTime<=t))break;r(c),e.sortIndex=e.expirationTime,i(h,e)}e=n(c)}}function w(t){if(g=!1,x(t),!m)if(null!==n(h))m=!0,k();else{var e=n(c);null!==e&&I(w,e.startTime-t)}}var S,A=!1,E=-1,_=5,C=-1;function M(){return!(e.unstable_now()-C<_)}function P(){if(A){var t=e.unstable_now();C=t;var i=!0;try{t:{m=!1,g&&(g=!1,y(E),E=-1),f=!0;var s=p;try{e:{for(x(t),d=n(h);null!==d&&!(d.expirationTime>t&&M());){var a=d.callback;if("function"===typeof a){d.callback=null,p=d.priorityLevel;var o=a(d.expirationTime<=t);if(t=e.unstable_now(),"function"===typeof o){d.callback=o,x(t),i=!0;break e}d===n(h)&&r(h),x(t)}else r(h);d=n(h)}if(null!==d)i=!0;else{var l=n(c);null!==l&&I(w,l.startTime-t),i=!1}}break t}finally{d=null,p=s,f=!1}i=void 0}}finally{i?S():A=!1}}}if("function"===typeof b)S=function(){b(P)};else if("undefined"!==typeof MessageChannel){var T=new MessageChannel,D=T.port2;T.port1.onmessage=P,S=function(){D.postMessage(null)}}else S=function(){v(P,0)};function k(){A||(A=!0,S())}function I(t,i){E=v((function(){t(e.unstable_now())}),i)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(t){t.callback=null},e.unstable_continueExecution=function(){m||f||(m=!0,k())},e.unstable_forceFrameRate=function(t){0>t||125<t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_=0<t?Math.floor(1e3/t):5},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_getFirstCallbackNode=function(){return n(h)},e.unstable_next=function(t){switch(p){case 1:case 2:case 3:var e=3;break;default:e=p}var i=p;p=e;try{return t()}finally{p=i}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var i=p;p=t;try{return e()}finally{p=i}},e.unstable_scheduleCallback=function(t,r,s){var a=e.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?a+s:a:s=a,t){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return t={id:u++,callback:r,priorityLevel:t,startTime:s,expirationTime:o=s+o,sortIndex:-1},s>a?(t.sortIndex=s,i(c,t),null===n(h)&&t===n(c)&&(g?(y(E),E=-1):g=!0,I(w,s-a))):(t.sortIndex=o,i(h,t),m||f||(m=!0,k())),t},e.unstable_shouldYield=M,e.unstable_wrapCallback=function(t){var e=p;return function(){var i=p;p=e;try{return t.apply(this,arguments)}finally{p=i}}}},950:(t,e,i)=>{"use strict";!function t(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}(),t.exports=i(672)}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var i=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t].call(i.exports,i,i.exports,__webpack_require__),i.exports}__webpack_require__.m=__webpack_modules__,__webpack_require__.amdO={},__webpack_require__.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return __webpack_require__.d(e,{a:e}),e},__webpack_require__.d=(t,e)=>{for(var i in e)__webpack_require__.o(e,i)&&!__webpack_require__.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},__webpack_require__.f={},__webpack_require__.e=t=>Promise.all(Object.keys(__webpack_require__.f).reduce(((e,i)=>(__webpack_require__.f[i](t,e),e)),[])),__webpack_require__.u=t=>"static/js/"+t+"."+{23:"172634e7",160:"9d60b9a8",208:"3164a21d",293:"dc3012ca",516:"4a1010b8",519:"3cc88d63",917:"35a25a43",946:"aa3efd67"}[t]+".chunk.js",__webpack_require__.miniCssF=t=>{},__webpack_require__.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}(),__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={},e="portfolio:";__webpack_require__.l=(i,n,r,s)=>{if(t[i])t[i].push(n);else{var a,o;if(void 0!==r)for(var l=document.getElementsByTagName("script"),h=0;h<l.length;h++){var c=l[h];if(c.getAttribute("src")==i||c.getAttribute("data-webpack")==e+r){a=c;break}}a||(o=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,__webpack_require__.nc&&a.setAttribute("nonce",__webpack_require__.nc),a.setAttribute("data-webpack",e+r),a.src=i),t[i]=[n];var u=(e,n)=>{a.onerror=a.onload=null,clearTimeout(d);var r=t[i];if(delete t[i],a.parentNode&&a.parentNode.removeChild(a),r&&r.forEach((t=>t(n))),e)return e(n)},d=setTimeout(u.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=u.bind(null,a.onerror),a.onload=u.bind(null,a.onload),o&&document.head.appendChild(a)}}})(),__webpack_require__.r=t=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.p="/my-port-folio/",(()=>{var t={792:0};__webpack_require__.f.j=(e,i)=>{var n=__webpack_require__.o(t,e)?t[e]:void 0;if(0!==n)if(n)i.push(n[2]);else{var r=new Promise(((i,r)=>n=t[e]=[i,r]));i.push(n[2]=r);var s=__webpack_require__.p+__webpack_require__.u(e),a=new Error;__webpack_require__.l(s,(i=>{if(__webpack_require__.o(t,e)&&(0!==(n=t[e])&&(t[e]=void 0),n)){var r=i&&("load"===i.type?"missing":i.type),s=i&&i.target&&i.target.src;a.message="Loading chunk "+e+" failed.\n("+r+": "+s+")",a.name="ChunkLoadError",a.type=r,a.request=s,n[1](a)}}),"chunk-"+e,e)}};var e=(e,i)=>{var n,r,s=i[0],a=i[1],o=i[2],l=0;if(s.some((e=>0!==t[e]))){for(n in a)__webpack_require__.o(a,n)&&(__webpack_require__.m[n]=a[n]);if(o)o(__webpack_require__)}for(e&&e(i);l<s.length;l++)r=s[l],__webpack_require__.o(t,r)&&t[r]&&t[r][0](),t[r]=0},i=self.webpackChunkportfolio=self.webpackChunkportfolio||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var __webpack_exports__={};(()=>{"use strict";var t=__webpack_require__(43),e=__webpack_require__(391),i=__webpack_require__(579);const n=e=>{var n;let{aboutMeRef:r,skillsRef:s,educationRef:a,projectsRef:o,contactRef:l}=e;const[h,c]=(0,t.useState)(!1),[u,d]=(0,t.useState)(null!==(n=localStorage.getItem("currentMode"))&&void 0!==n?n:"dark");(0,t.useEffect)((()=>{"light"===u?(document.body.classList.remove("dark"),document.body.classList.add("light")):(document.body.classList.remove("light"),document.body.classList.add("dark"))}),[u]);const p=t=>{t&&t.current&&t.current.scrollIntoView({behavior:"smooth"})};return(0,i.jsxs)("header",{className:"flex ",children:[(0,i.jsx)("button",{onClick:()=>{c(!0)},className:"menu icon-menu flex"}),(0,i.jsx)("div",{className:"logo",children:(0,i.jsxs)("div",{className:"firstlogo ",children:["Mery",(0,i.jsx)("span",{className:"secondlogo",children:"Em"})]})}),(0,i.jsx)("nav",{children:(0,i.jsxs)("ul",{className:"flex",children:[(0,i.jsx)("li",{children:(0,i.jsx)("a",{href:"#",onClick:t=>{t.preventDefault(),p(r)},children:"About"})}),(0,i.jsx)("li",{children:(0,i.jsx)("a",{href:"#",onClick:t=>{t.preventDefault(),p(s)},children:"Skills"})}),(0,i.jsx)("li",{children:(0,i.jsx)("a",{href:"#",onClick:t=>{t.preventDefault(),p(a)},children:"Education"})}),(0,i.jsx)("li",{children:(0,i.jsx)("a",{href:"#",onClick:t=>{t.preventDefault(),p(o)},children:"Projects"})})]})}),(0,i.jsx)("button",{onClick:()=>{localStorage.setItem("currentMode","dark"===u?"light":"dark"),d(localStorage.getItem("currentMode"))},className:"mode flex",children:"dark"===u?(0,i.jsx)("span",{className:"icon-moon-o",children:" "}):(0,i.jsx)("span",{className:"icon-sun",children:" "})}),h&&(0,i.jsx)("div",{className:"fixed",children:(0,i.jsxs)("ul",{className:"modal",children:[(0,i.jsx)("li",{children:(0,i.jsx)("button",{className:"icon-close",onClick:()=>{c(!1)}})}),(0,i.jsx)("li",{children:(0,i.jsx)("a",{href:"#",onClick:t=>{t.preventDefault(),p(r)},children:"About"})}),(0,i.jsx)("li",{children:(0,i.jsx)("a",{href:"#",onClick:t=>{t.preventDefault(),p(s)},children:"Skills"})}),(0,i.jsx)("li",{children:(0,i.jsx)("a",{href:"#",onClick:t=>{t.preventDefault(),p(a)},children:"Education"})}),(0,i.jsx)("li",{children:(0,i.jsx)("a",{href:"#",onClick:t=>{t.preventDefault(),p(o)},children:"Projects"})})]})})]})};var r=__webpack_require__(750),s=__webpack_require__.n(r);const a=JSON.parse('{"v":"5.5.7","meta":{"g":"LottieFiles AE 0.1.20","a":"","k":"","d":"","tc":""},"fr":29.9700012207031,"ip":0,"op":120.0000048877,"w":600,"h":450,"nm":"971 [Converted]g","ddd":1,"assets":[{"id":"image_0","w":65,"h":115,"u":"","p":"data:image/png;base64,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","e":1},{"id":"image_1","w":27,"h":17,"u":"","p":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAARCAYAAAAsT9czAAABGklEQVRIS7WUwU3DQBREZxCCI+kAd0C4II50gKkAUwEpISWkA6cDoIPQAVSQ0AGcUBAwaNAPWgwRdlh/ydd9nnl/l5JKACcAxiQf0eNQ0gTAJYAnABOS4754hg0ATAGcBuQBwIjkdW4oVwdKcpVOeRApi9y1fsESaBUOnS6rwx+wZnWSDLdH+3TyjacNzNt6lfisSM42If4J86Hh00u0H5BbknbcaVrBEp+jqHQPwCHJuy60TrBI6atSknTSz5E0bAPuDFuzQDWA+7ifa33mgDmp61z5vAnoovlj/4Yl1dqnP/v00+dqvwGzwBJ3RSzQOYCz5pOXFfbbZmpYD5bb79Xu69a0d9jzcV3wTXNBF73DnHZ5VJc7L5h9AM+/YPcpkIXXAAAAAElFTkSuQmCC","e":1},{"id":"image_2","w":77,"h":65,"u":"","p":"data:image/png;base64,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","e":1},{"id":"image_3","w":135,"h":134,"u":"","p":"data:image/png;base64,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","e":1},{"id":"image_4","w":291,"h":284,"u":"","p":"data:image/png;base64,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","e":1}],"layers":[{"ddd":1,"ind":1,"ty":4,"nm":"Shape Layer 1","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"rx":{"a":0,"k":11,"ix":8},"ry":{"a":0,"k":0,"ix":9},"rz":{"a":0,"k":45,"ix":10},"or":{"a":0,"k":[292,0,353],"ix":7},"p":{"a":0,"k":[102.435,279.494,0],"ix":2},"a":{"a":0,"k":[0,0,0],"ix":1},"s":{"a":0,"k":[43,37.523,43],"ix":6}},"ao":0,"shapes":[{"ty":"rc","d":1,"s":{"a":0,"k":[100,100],"ix":2},"p":{"a":0,"k":[0,0],"ix":3},"r":{"a":0,"k":22,"ix":4},"nm":"Rectangle Path 1","mn":"ADBE Vector Shape - Rect","hd":false},{"ty":"gs","o":{"a":0,"k":100,"ix":9},"w":{"a":0,"k":4,"ix":10},"g":{"p":3,"k":{"a":0,"k":[0,0.949,0.43,0.249,0.5,0.945,0.319,0.289,1,0.941,0.207,0.328],"ix":8}},"s":{"a":0,"k":[0,0],"ix":4},"e":{"a":0,"k":[100,0],"ix":5},"t":1,"lc":1,"lj":1,"ml":4,"ml2":{"a":0,"k":4,"ix":13},"bm":0,"nm":"Gradient Stroke 1","mn":"ADBE Vector Graphic - G-Stroke","hd":false},{"ty":"tm","s":{"a":0,"k":0,"ix":1},"e":{"a":0,"k":80,"ix":2},"o":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"t":0,"s":[0]},{"t":119.000004846969,"s":[720]}],"ix":3},"m":1,"ix":3,"nm":"Trim Paths 1","mn":"ADBE Vector Filter - Trim","hd":false}],"ip":0,"op":120.0000048877,"st":0,"bm":0},{"ddd":1,"ind":2,"ty":2,"nm":"Layer 11","refId":"image_0","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"rx":{"a":0,"k":0,"ix":8},"ry":{"a":0,"k":0,"ix":9},"rz":{"a":0,"k":0,"ix":10},"or":{"a":0,"k":[0,0,0],"ix":7},"p":{"a":1,"k":[{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":0,"s":[182.796,144.545,0],"to":[0,-1.667,0],"ti":[0,0,0]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":31,"s":[182.796,134.545,0],"to":[0,0,0],"ti":[0,0,0]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":60,"s":[182.796,144.545,0],"to":[0,0,0],"ti":[0,0,0]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":91,"s":[182.796,134.545,0],"to":[0,0,0],"ti":[0,-1.667,0]},{"t":119.000004846969,"s":[182.796,144.545,0]}],"ix":2},"a":{"a":0,"k":[32.334,57.477,0],"ix":1},"s":{"a":0,"k":[100,100,100],"ix":6}},"ao":0,"ip":0,"op":120.0000048877,"st":0,"bm":0},{"ddd":1,"ind":3,"ty":2,"nm":"Layer 9","parent":5,"refId":"image_1","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"rx":{"a":0,"k":0,"ix":8},"ry":{"a":0,"k":0,"ix":9},"rz":{"a":0,"k":0,"ix":10},"or":{"a":0,"k":[0,0,0],"ix":7},"p":{"a":0,"k":[99.575,54.653,0],"ix":2},"a":{"a":0,"k":[13.379,8.382,0],"ix":1},"s":{"a":0,"k":[100,100,100],"ix":6}},"ao":0,"ip":0,"op":120.0000048877,"st":0,"bm":0},{"ddd":1,"ind":4,"ty":2,"nm":"Layer 8","parent":5,"refId":"image_2","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"rx":{"a":0,"k":0,"ix":8},"ry":{"a":0,"k":0,"ix":9},"rz":{"a":0,"k":0,"ix":10},"or":{"a":0,"k":[0,0,0],"ix":7},"p":{"a":0,"k":[52.384,56.472,0],"ix":2},"a":{"a":0,"k":[38.333,32.236,0],"ix":1},"s":{"a":0,"k":[100,100,100],"ix":6}},"ao":0,"ip":0,"op":120.0000048877,"st":0,"bm":0},{"ddd":1,"ind":5,"ty":2,"nm":"Layer 7","parent":6,"refId":"image_3","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"rx":{"a":0,"k":0,"ix":8},"ry":{"a":0,"k":0,"ix":9},"rz":{"a":0,"k":0,"ix":10},"or":{"a":0,"k":[0,0,0],"ix":7},"p":{"a":0,"k":[197.62,101.429,0],"ix":2},"a":{"a":0,"k":[67.454,66.635,0],"ix":1},"s":{"a":1,"k":[{"i":{"x":[0.667,0.667,0.667],"y":[1,1,1]},"o":{"x":[0.333,0.333,0.333],"y":[0,0,0]},"t":18,"s":[0,0,100]},{"i":{"x":[0.667,0.667,0.667],"y":[1,1,1]},"o":{"x":[0.333,0.333,0.333],"y":[0,0,0]},"t":22,"s":[120,120,100]},{"i":{"x":[0.667,0.667,0.667],"y":[1,1,1]},"o":{"x":[0.333,0.333,0.333],"y":[0,0,0]},"t":26,"s":[70,70,100]},{"i":{"x":[0.667,0.667,0.667],"y":[1,1,1]},"o":{"x":[0.167,0.167,0.167],"y":[0,0,0]},"t":30,"s":[100,100,100]},{"i":{"x":[0.667,0.667,0.667],"y":[1,1,1]},"o":{"x":[0.333,0.333,0.333],"y":[0,0,0]},"t":90,"s":[100,100,100]},{"i":{"x":[0.667,0.667,0.667],"y":[1,1,1]},"o":{"x":[0.333,0.333,0.333],"y":[0,0,0]},"t":94,"s":[70,70,100]},{"i":{"x":[0.667,0.667,0.667],"y":[1,1,1]},"o":{"x":[0.333,0.333,0.333],"y":[0,0,0]},"t":98,"s":[120,120,100]},{"t":102.000004154545,"s":[0,0,100]}],"ix":6}},"ao":0,"ip":0,"op":120.0000048877,"st":0,"bm":0},{"ddd":1,"ind":6,"ty":2,"nm":"Layer 6","refId":"image_4","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"rx":{"a":0,"k":0,"ix":8},"ry":{"a":0,"k":0,"ix":9},"rz":{"a":0,"k":0,"ix":10},"or":{"a":0,"k":[0,0,0],"ix":7},"p":{"a":1,"k":[{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":0,"s":[305.331,196.543,0],"to":[0,1.667,0],"ti":[0,0,0]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":31,"s":[305.331,206.543,0],"to":[0,0,0],"ti":[0,0,0]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":61,"s":[305.331,196.543,0],"to":[0,0,0],"ti":[0,0,0]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":93,"s":[305.331,206.543,0],"to":[0,0,0],"ti":[0,1.667,0]},{"t":119.000004846969,"s":[305.331,196.543,0]}],"ix":2},"a":{"a":0,"k":[145.174,141.543,0],"ix":1},"s":{"a":0,"k":[100,100,100],"ix":6}},"ao":0,"ip":0,"op":120.0000048877,"st":0,"bm":0},{"ddd":1,"ind":7,"ty":4,"nm":"Shape Layer 5","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"rx":{"a":0,"k":0,"ix":8},"ry":{"a":0,"k":0,"ix":9},"rz":{"a":0,"k":0,"ix":10},"or":{"a":0,"k":[0,0,0],"ix":7},"p":{"a":0,"k":[300,225,0],"ix":2},"a":{"a":0,"k":[0,0,0],"ix":1},"s":{"a":0,"k":[100,100,100],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[0,0],[0,0],[0,0]],"o":[[0,0],[0,0],[0,0],[0,0]],"v":[[-61,-32],[-162,38],[9,136],[129,65]],"c":true},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"rd","nm":"Round Corners 1","r":{"a":0,"k":12,"ix":1},"ix":2,"mn":"ADBE Vector Filter - RC","hd":false},{"ty":"gs","o":{"a":0,"k":100,"ix":9},"w":{"a":0,"k":4,"ix":10},"g":{"p":3,"k":{"a":0,"k":[0,0.949,0.43,0.249,0.5,0.945,0.319,0.289,1,0.941,0.207,0.328],"ix":8}},"s":{"a":0,"k":[0,0],"ix":4},"e":{"a":0,"k":[100,0],"ix":5},"t":1,"lc":1,"lj":1,"ml":4,"ml2":{"a":0,"k":4,"ix":13},"bm":0,"nm":"Gradient Stroke 1","mn":"ADBE Vector Graphic - G-Stroke","hd":false},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Shape 1","np":4,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false},{"ty":"tm","s":{"a":0,"k":0,"ix":1},"e":{"a":0,"k":80,"ix":2},"o":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"t":0,"s":[0]},{"t":119.000004846969,"s":[-360]}],"ix":3},"m":1,"ix":2,"nm":"Trim Paths 1","mn":"ADBE Vector Filter - Trim","hd":false}],"ip":0,"op":120.0000048877,"st":0,"bm":0},{"ddd":1,"ind":8,"ty":4,"nm":"Shape Layer 4","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"rx":{"a":0,"k":11,"ix":8},"ry":{"a":0,"k":0,"ix":9},"rz":{"a":0,"k":45,"ix":10},"or":{"a":0,"k":[292,0,358],"ix":7},"p":{"a":0,"k":[162.346,182.675,145.803],"ix":2},"a":{"a":0,"k":[0,0,0],"ix":1},"s":{"a":0,"k":[68.055,69.168,78],"ix":6}},"ao":0,"shapes":[{"ty":"rc","d":1,"s":{"a":0,"k":[100,100],"ix":2},"p":{"a":0,"k":[0,0],"ix":3},"r":{"a":0,"k":22,"ix":4},"nm":"Rectangle Path 1","mn":"ADBE Vector Shape - Rect","hd":false},{"ty":"gs","o":{"a":0,"k":100,"ix":9},"w":{"a":0,"k":4,"ix":10},"g":{"p":3,"k":{"a":0,"k":[0,0.949,0.43,0.249,0.5,0.945,0.319,0.289,1,0.941,0.207,0.328],"ix":8}},"s":{"a":0,"k":[0,0],"ix":4},"e":{"a":0,"k":[100,0],"ix":5},"t":1,"lc":1,"lj":1,"ml":4,"ml2":{"a":0,"k":4,"ix":13},"bm":0,"nm":"Gradient Stroke 1","mn":"ADBE Vector Graphic - G-Stroke","hd":false},{"ty":"tm","s":{"a":0,"k":0,"ix":1},"e":{"a":0,"k":80,"ix":2},"o":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"t":0,"s":[0]},{"t":119.000004846969,"s":[-720]}],"ix":3},"m":1,"ix":3,"nm":"Trim Paths 1","mn":"ADBE Vector Filter - Trim","hd":false}],"ip":0,"op":120.0000048877,"st":0,"bm":0}],"markers":[]}');function o(t){if("undefined"===typeof Proxy)return t;const e=new Map;return new Proxy((function(){return t(...arguments)}),{get:(i,n)=>"create"===n?t:(e.has(n)||e.set(n,t(n)),e.get(n))})}function l(t){return null!==t&&"object"===typeof t&&"function"===typeof t.start}function h(t){const e=[{},{}];return null===t||void 0===t||t.values.forEach(((t,i)=>{e[0][i]=t.get(),e[1][i]=t.getVelocity()})),e}function c(t,e,i,n){if("function"===typeof e){const[r,s]=h(n);e=e(void 0!==i?i:t.custom,r,s)}if("string"===typeof e&&(e=t.variants&&t.variants[e]),"function"===typeof e){const[r,s]=h(n);e=e(void 0!==i?i:t.custom,r,s)}return e}function u(t,e,i){const n=t.getProps();return c(n,e,void 0!==i?i:n.custom,t)}function d(t){let e;return()=>(void 0===e&&(e=t()),e)}const p=d((()=>void 0!==window.ScrollTimeline));class f{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map((t=>"finished"in t?t.finished:t)))}getAll(t){return this.animations[0][t]}setAll(t,e){for(let i=0;i<this.animations.length;i++)this.animations[i][t]=e}attachTimeline(t,e){const i=this.animations.map((i=>p()&&i.attachTimeline?i.attachTimeline(t):"function"===typeof e?e(i):void 0));return()=>{i.forEach(((t,e)=>{t&&t(),this.animations[e].stop()}))}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let e=0;e<this.animations.length;e++)t=Math.max(t,this.animations[e].duration);return t}runAll(t){this.animations.forEach((e=>e[t]()))}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class m extends f{then(t,e){return Promise.all(this.animations).then(t).catch(e)}}function g(t,e){return t?t[e]||t.default||t:void 0}const v=2e4;function y(t){let e=0;let i=t.next(e);for(;!i.done&&e<v;)e+=50,i=t.next(e);return e>=v?1/0:e}function b(t){return"function"===typeof t}function x(t,e){t.timeline=e,t.onfinish=null}const w=t=>Array.isArray(t)&&"number"===typeof t[0],S={linearEasing:void 0};function A(t,e){const i=d(t);return()=>{var t;return null!==(t=S[e])&&void 0!==t?t:i()}}const E=A((()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(Wk){return!1}return!0}),"linearEasing"),_=(t,e,i)=>{const n=e-t;return 0===n?1:(i-t)/n},C=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,n="";const r=Math.max(Math.round(e/i),2);for(let s=0;s<r;s++)n+=t(_(0,r-1,s))+", ";return`linear(${n.substring(0,n.length-2)})`};function M(t){return Boolean("function"===typeof t&&E()||!t||"string"===typeof t&&(t in T||E())||w(t)||Array.isArray(t)&&t.every(M))}const P=t=>{let[e,i,n,r]=t;return`cubic-bezier(${e}, ${i}, ${n}, ${r})`},T={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:P([0,.65,.55,1]),circOut:P([.55,0,1,.45]),backIn:P([.31,.01,.66,-.59]),backOut:P([.33,1.53,.69,.99])};function D(t,e){return t?"function"===typeof t&&E()?C(t,e):w(t)?P(t):Array.isArray(t)?t.map((t=>D(t,e)||T.easeOut)):T[t]:void 0}const k={x:!1,y:!1};function I(){return k.x||k.y}function R(t,e){const i=function(t,e,i){var n;if(t instanceof Element)return[t];if("string"===typeof t){let r=document;e&&(r=e.current);const s=null!==(n=null===i||void 0===i?void 0:i[t])&&void 0!==n?n:r.querySelectorAll(t);return s?Array.from(s):[]}return Array.from(t)}(t),n=new AbortController;return[i,{passive:!0,...e,signal:n.signal},()=>n.abort()]}function O(t){return!("touch"===t.pointerType||I())}const L=(t,e)=>!!e&&(t===e||L(t,e.parentElement)),B=t=>"mouse"===t.pointerType?"number"!==typeof t.button||t.button<=0:!1!==t.isPrimary,z=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);const F=new WeakSet;function N(t){return e=>{"Enter"===e.key&&t(e)}}function U(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}function V(t){return B(t)&&!I()}function j(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const[n,r,s]=R(t,i),a=t=>{const n=t.currentTarget;if(!V(t)||F.has(n))return;F.add(n);const s=e(n,t),a=(t,e)=>{window.removeEventListener("pointerup",o),window.removeEventListener("pointercancel",l),V(t)&&F.has(n)&&(F.delete(n),"function"===typeof s&&s(t,{success:e}))},o=t=>{a(t,i.useGlobalTarget||L(n,t.target))},l=t=>{a(t,!1)};window.addEventListener("pointerup",o,r),window.addEventListener("pointercancel",l,r)};return n.forEach((t=>{(function(t){return z.has(t.tagName)||-1!==t.tabIndex})(t)||null!==t.getAttribute("tabindex")||(t.tabIndex=0);(i.useGlobalTarget?window:t).addEventListener("pointerdown",a,r),t.addEventListener("focus",(t=>((t,e)=>{const i=t.currentTarget;if(!i)return;const n=N((()=>{if(F.has(i))return;U(i,"down");const t=N((()=>{U(i,"up")}));i.addEventListener("keyup",t,e),i.addEventListener("blur",(()=>U(i,"cancel")),e)}));i.addEventListener("keydown",n,e),i.addEventListener("blur",(()=>i.removeEventListener("keydown",n)),e)})(t,r)),r)})),s}const G=t=>1e3*t,H=t=>t/1e3,W=t=>t;const q=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Y=new Set(q),X=new Set(["width","height","top","left","right","bottom",...q]),Q=t=>Array.isArray(t),K=!1,Z=!1,J=["read","resolveKeyframes","update","preRender","render","postRender"],$={value:null,addProjectionMetrics:null};function tt(t,e){let i=!1,n=!0;const r={delta:0,timestamp:0,isProcessing:!1},s=()=>i=!0,a=J.reduce(((t,i)=>(t[i]=function(t,e){let i=new Set,n=new Set,r=!1,s=!1;const a=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1},l=0;function h(e){a.has(e)&&(c.schedule(e),t()),l++,e(o)}const c={schedule:function(t){const e=arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&r?i:n;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&a.add(t),e.has(t)||e.add(t),t},cancel:t=>{n.delete(t),a.delete(t)},process:t=>{o=t,r?s=!0:(r=!0,[i,n]=[n,i],i.forEach(h),e&&$.value&&$.value.frameloop[e].push(l),l=0,i.clear(),r=!1,s&&(s=!1,c.process(t)))}};return c}(s,e?i:void 0),t)),{}),{read:o,resolveKeyframes:l,update:h,preRender:c,render:u,postRender:d}=a,p=()=>{const s=Z?r.timestamp:performance.now();i=!1,Z||(r.delta=n?1e3/60:Math.max(Math.min(s-r.timestamp,40),1)),r.timestamp=s,r.isProcessing=!0,o.process(r),l.process(r),h.process(r),c.process(r),u.process(r),d.process(r),r.isProcessing=!1,i&&e&&(n=!1,t(p))},f=J.reduce(((e,s)=>{const o=a[s];return e[s]=function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return i||(i=!0,n=!0,r.isProcessing||t(p)),o.schedule(e,s,a)},e}),{});return{schedule:f,cancel:t=>{for(let e=0;e<J.length;e++)a[J[e]].cancel(t)},state:r,steps:a}}const{schedule:et,cancel:it,state:nt,steps:rt}=tt("undefined"!==typeof requestAnimationFrame?requestAnimationFrame:W,!0);let st;function at(){st=void 0}const ot={now:()=>(void 0===st&&ot.set(nt.isProcessing||Z?nt.timestamp:performance.now()),st),set:t=>{st=t,queueMicrotask(at)}};function lt(t,e){-1===t.indexOf(e)&&t.push(e)}function ht(t,e){const i=t.indexOf(e);i>-1&&t.splice(i,1)}class ct{constructor(){this.subscriptions=[]}add(t){return lt(this.subscriptions,t),()=>ht(this.subscriptions,t)}notify(t,e,i){const n=this.subscriptions.length;if(n)if(1===n)this.subscriptions[0](t,e,i);else for(let r=0;r<n;r++){const n=this.subscriptions[r];n&&n(t,e,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function ut(t,e){return e?t*(1e3/e):0}const dt={current:void 0};class pt{constructor(t){var e=this;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.version="12.4.3",this.canTrackVelocity=null,this.events={},this.updateAndNotify=function(t){let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=ot.now();e.updatedAt!==n&&e.setPrevFrameValue(),e.prev=e.current,e.setCurrent(t),e.current!==e.prev&&e.events.change&&e.events.change.notify(e.current),i&&e.events.renderRequest&&e.events.renderRequest.notify(e.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=i.owner}setCurrent(t){var e;this.current=t,this.updatedAt=ot.now(),null===this.canTrackVelocity&&void 0!==t&&(this.canTrackVelocity=(e=this.current,!isNaN(parseFloat(e))))}setPrevFrameValue(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.current;this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,e){this.events[t]||(this.events[t]=new ct);const i=this.events[t].add(e);return"change"===t?()=>{i(),et.read((()=>{this.events.change.getSize()||this.stop()}))}:i}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,e){this.passiveEffect=t,this.stopPassiveEffect=e}set(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e&&this.passiveEffect?this.passiveEffect(t,this.updateAndNotify):this.updateAndNotify(t,e)}setWithVelocity(t,e,i){this.set(e),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-i}jump(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,e&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return dt.current&&dt.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const t=ot.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||t-this.updatedAt>30)return 0;const e=Math.min(this.updatedAt-this.prevUpdatedAt,30);return ut(parseFloat(this.current)-parseFloat(this.prevFrameValue),e)}start(t){return this.stop(),new Promise((e=>{this.hasAnimated=!0,this.animation=t(e),this.events.animationStart&&this.events.animationStart.notify()})).then((()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()}))}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function ft(t,e){return new pt(t,e)}function mt(t,e,i){t.hasValue(e)?t.getValue(e).set(i):t.addValue(e,ft(i))}function gt(t,e){const i=u(t,e);let{transitionEnd:n={},transition:r={},...s}=i||{};s={...s,...n};for(const o in s){mt(t,o,(a=s[o],Q(a)?a[a.length-1]||0:a))}var a}const vt=t=>Boolean(t&&t.getVelocity);function yt(t,e){const i=t.getValue("willChange");if(n=i,Boolean(vt(n)&&n.add))return i.add(e);var n}const bt=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),xt="data-"+bt("framerAppearId");function wt(t){return t.props[xt]}const St=!1,At=(t,e,i)=>(((1-3*i+3*e)*t+(3*i-6*e))*t+3*e)*t;function Et(t,e,i,n){if(t===e&&i===n)return W;const r=e=>function(t,e,i,n,r){let s,a,o=0;do{a=e+(i-e)/2,s=At(a,n,r)-t,s>0?i=a:e=a}while(Math.abs(s)>1e-7&&++o<12);return a}(e,0,1,t,i);return t=>0===t||1===t?t:At(r(t),e,n)}const _t=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,Ct=t=>e=>1-t(1-e),Mt=Et(.33,1.53,.69,.99),Pt=Ct(Mt),Tt=_t(Pt),Dt=t=>(t*=2)<1?.5*Pt(t):.5*(2-Math.pow(2,-10*(t-1))),kt=t=>1-Math.sin(Math.acos(t)),It=Ct(kt),Rt=_t(kt),Ot=t=>/^0[^.\s]+$/u.test(t);const Lt=(t,e,i)=>i>e?e:i<t?t:i,Bt={test:t=>"number"===typeof t,parse:parseFloat,transform:t=>t},zt={...Bt,transform:t=>Lt(0,1,t)},Ft={...Bt,default:1},Nt=t=>Math.round(1e5*t)/1e5,Ut=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;const Vt=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,jt=(t,e)=>i=>Boolean("string"===typeof i&&Vt.test(i)&&i.startsWith(t)||e&&!function(t){return null==t}(i)&&Object.prototype.hasOwnProperty.call(i,e)),Gt=(t,e,i)=>n=>{if("string"!==typeof n)return n;const[r,s,a,o]=n.match(Ut);return{[t]:parseFloat(r),[e]:parseFloat(s),[i]:parseFloat(a),alpha:void 0!==o?parseFloat(o):1}},Ht={...Bt,transform:t=>Math.round((t=>Lt(0,255,t))(t))},Wt={test:jt("rgb","red"),parse:Gt("red","green","blue"),transform:t=>{let{red:e,green:i,blue:n,alpha:r=1}=t;return"rgba("+Ht.transform(e)+", "+Ht.transform(i)+", "+Ht.transform(n)+", "+Nt(zt.transform(r))+")"}};const qt={test:jt("#"),parse:function(t){let e="",i="",n="",r="";return t.length>5?(e=t.substring(1,3),i=t.substring(3,5),n=t.substring(5,7),r=t.substring(7,9)):(e=t.substring(1,2),i=t.substring(2,3),n=t.substring(3,4),r=t.substring(4,5),e+=e,i+=i,n+=n,r+=r),{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(n,16),alpha:r?parseInt(r,16)/255:1}},transform:Wt.transform},Yt=t=>({test:e=>"string"===typeof e&&e.endsWith(t)&&1===e.split(" ").length,parse:parseFloat,transform:e=>`${e}${t}`}),Xt=Yt("deg"),Qt=Yt("%"),Kt=Yt("px"),Zt=Yt("vh"),Jt=Yt("vw"),$t={...Qt,parse:t=>Qt.parse(t)/100,transform:t=>Qt.transform(100*t)},te={test:jt("hsl","hue"),parse:Gt("hue","saturation","lightness"),transform:t=>{let{hue:e,saturation:i,lightness:n,alpha:r=1}=t;return"hsla("+Math.round(e)+", "+Qt.transform(Nt(i))+", "+Qt.transform(Nt(n))+", "+Nt(zt.transform(r))+")"}},ee={test:t=>Wt.test(t)||qt.test(t)||te.test(t),parse:t=>Wt.test(t)?Wt.parse(t):te.test(t)?te.parse(t):qt.parse(t),transform:t=>"string"===typeof t?t:t.hasOwnProperty("red")?Wt.transform(t):te.transform(t)},ie=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;const ne="number",re="color",se=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function ae(t){const e=t.toString(),i=[],n={color:[],number:[],var:[]},r=[];let s=0;const a=e.replace(se,(t=>(ee.test(t)?(n.color.push(s),r.push(re),i.push(ee.parse(t))):t.startsWith("var(")?(n.var.push(s),r.push("var"),i.push(t)):(n.number.push(s),r.push(ne),i.push(parseFloat(t))),++s,"${}"))).split("${}");return{values:i,split:a,indexes:n,types:r}}function oe(t){return ae(t).values}function le(t){const{split:e,types:i}=ae(t),n=e.length;return t=>{let r="";for(let s=0;s<n;s++)if(r+=e[s],void 0!==t[s]){const e=i[s];r+=e===ne?Nt(t[s]):e===re?ee.transform(t[s]):t[s]}return r}}const he=t=>"number"===typeof t?0:t;const ce={test:function(t){var e,i;return isNaN(t)&&"string"===typeof t&&((null===(e=t.match(Ut))||void 0===e?void 0:e.length)||0)+((null===(i=t.match(ie))||void 0===i?void 0:i.length)||0)>0},parse:oe,createTransformer:le,getAnimatableNone:function(t){const e=oe(t);return le(t)(e.map(he))}},ue=new Set(["brightness","contrast","saturate","opacity"]);function de(t){const[e,i]=t.slice(0,-1).split("(");if("drop-shadow"===e)return t;const[n]=i.match(Ut)||[];if(!n)return t;const r=i.replace(n,"");let s=ue.has(e)?1:0;return n!==i&&(s*=100),e+"("+s+r+")"}const pe=/\b([a-z-]*)\(.*?\)/gu,fe={...ce,getAnimatableNone:t=>{const e=t.match(pe);return e?e.map(de).join(" "):t}},me={borderWidth:Kt,borderTopWidth:Kt,borderRightWidth:Kt,borderBottomWidth:Kt,borderLeftWidth:Kt,borderRadius:Kt,radius:Kt,borderTopLeftRadius:Kt,borderTopRightRadius:Kt,borderBottomRightRadius:Kt,borderBottomLeftRadius:Kt,width:Kt,maxWidth:Kt,height:Kt,maxHeight:Kt,top:Kt,right:Kt,bottom:Kt,left:Kt,padding:Kt,paddingTop:Kt,paddingRight:Kt,paddingBottom:Kt,paddingLeft:Kt,margin:Kt,marginTop:Kt,marginRight:Kt,marginBottom:Kt,marginLeft:Kt,backgroundPositionX:Kt,backgroundPositionY:Kt},ge={rotate:Xt,rotateX:Xt,rotateY:Xt,rotateZ:Xt,scale:Ft,scaleX:Ft,scaleY:Ft,scaleZ:Ft,skew:Xt,skewX:Xt,skewY:Xt,distance:Kt,translateX:Kt,translateY:Kt,translateZ:Kt,x:Kt,y:Kt,z:Kt,perspective:Kt,transformPerspective:Kt,opacity:zt,originX:$t,originY:$t,originZ:Kt},ve={...Bt,transform:Math.round},ye={...me,...ge,zIndex:ve,size:Kt,fillOpacity:zt,strokeOpacity:zt,numOctaves:ve},be={...ye,color:ee,backgroundColor:ee,outlineColor:ee,fill:ee,stroke:ee,borderColor:ee,borderTopColor:ee,borderRightColor:ee,borderBottomColor:ee,borderLeftColor:ee,filter:fe,WebkitFilter:fe},xe=t=>be[t];function we(t,e){let i=xe(t);return i!==fe&&(i=ce),i.getAnimatableNone?i.getAnimatableNone(e):void 0}const Se=new Set(["auto","none","0"]);const Ae=t=>t===Bt||t===Kt,Ee=(t,e)=>parseFloat(t.split(", ")[e]),_e=(t,e)=>(i,n)=>{let{transform:r}=n;if("none"===r||!r)return 0;const s=r.match(/^matrix3d\((.+)\)$/u);if(s)return Ee(s[1],e);{const e=r.match(/^matrix\((.+)\)$/u);return e?Ee(e[1],t):0}},Ce=new Set(["x","y","z"]),Me=q.filter((t=>!Ce.has(t)));const Pe={width:(t,e)=>{let{x:i}=t,{paddingLeft:n="0",paddingRight:r="0"}=e;return i.max-i.min-parseFloat(n)-parseFloat(r)},height:(t,e)=>{let{y:i}=t,{paddingTop:n="0",paddingBottom:r="0"}=e;return i.max-i.min-parseFloat(n)-parseFloat(r)},top:(t,e)=>{let{top:i}=e;return parseFloat(i)},left:(t,e)=>{let{left:i}=e;return parseFloat(i)},bottom:(t,e)=>{let{y:i}=t,{top:n}=e;return parseFloat(n)+(i.max-i.min)},right:(t,e)=>{let{x:i}=t,{left:n}=e;return parseFloat(n)+(i.max-i.min)},x:_e(4,13),y:_e(5,14)};Pe.translateX=Pe.x,Pe.translateY=Pe.y;const Te=new Set;let De=!1,ke=!1;function Ie(){if(ke){const t=Array.from(Te).filter((t=>t.needsMeasurement)),e=new Set(t.map((t=>t.element))),i=new Map;e.forEach((t=>{const e=function(t){const e=[];return Me.forEach((i=>{const n=t.getValue(i);void 0!==n&&(e.push([i,n.get()]),n.set(i.startsWith("scale")?1:0))})),e}(t);e.length&&(i.set(t,e),t.render())})),t.forEach((t=>t.measureInitialState())),e.forEach((t=>{t.render();const e=i.get(t);e&&e.forEach((e=>{let[i,n]=e;var r;null===(r=t.getValue(i))||void 0===r||r.set(n)}))})),t.forEach((t=>t.measureEndState())),t.forEach((t=>{void 0!==t.suspendedScrollY&&window.scrollTo(0,t.suspendedScrollY)}))}ke=!1,De=!1,Te.forEach((t=>t.complete())),Te.clear()}function Re(){Te.forEach((t=>{t.readKeyframes(),t.needsMeasurement&&(ke=!0)}))}class Oe{constructor(t,e,i,n,r){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=e,this.name=i,this.motionValue=n,this.element=r,this.isAsync=s}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Te.add(this),De||(De=!0,et.read(Re),et.resolveKeyframes(Ie))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:e,element:i,motionValue:n}=this;for(let r=0;r<t.length;r++)if(null===t[r])if(0===r){const r=null===n||void 0===n?void 0:n.get(),s=t[t.length-1];if(void 0!==r)t[0]=r;else if(i&&e){const n=i.readValue(e,s);void 0!==n&&null!==n&&(t[0]=n)}void 0===t[0]&&(t[0]=s),n&&void 0===r&&n.set(t[0])}else t[r]=t[r-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Te.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Te.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}let Le=W,Be=W;const ze=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t),Fe=t=>e=>"string"===typeof e&&e.startsWith(t),Ne=Fe("--"),Ue=Fe("var(--"),Ve=t=>!!Ue(t)&&je.test(t.split("/*")[0].trim()),je=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Ge=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function He(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;Be(i<=4,`Max CSS variable fallback depth detected in property "${t}". This may indicate a circular fallback dependency.`);const[n,r]=function(t){const e=Ge.exec(t);if(!e)return[,];const[,i,n,r]=e;return[`--${null!==i&&void 0!==i?i:n}`,r]}(t);if(!n)return;const s=window.getComputedStyle(e).getPropertyValue(n);if(s){const t=s.trim();return ze(t)?parseFloat(t):t}return Ve(r)?He(r,e,i+1):r}const We=t=>e=>e.test(t),qe=[Bt,Kt,Qt,Xt,Jt,Zt,{test:t=>"auto"===t,parse:t=>t}],Ye=t=>qe.find(We(t));class Xe extends Oe{constructor(t,e,i,n,r){super(t,e,i,n,r,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:e,name:i}=this;if(!e||!e.current)return;super.readKeyframes();for(let o=0;o<t.length;o++){let i=t[o];if("string"===typeof i&&(i=i.trim(),Ve(i))){const n=He(i,e.current);void 0!==n&&(t[o]=n),o===t.length-1&&(this.finalKeyframe=i)}}if(this.resolveNoneKeyframes(),!X.has(i)||2!==t.length)return;const[n,r]=t,s=Ye(n),a=Ye(r);if(s!==a)if(Ae(s)&&Ae(a))for(let o=0;o<t.length;o++){const e=t[o];"string"===typeof e&&(t[o]=parseFloat(e))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:e}=this,i=[];for(let r=0;r<t.length;r++)("number"===typeof(n=t[r])?0===n:null===n||"none"===n||"0"===n||Ot(n))&&i.push(r);var n;i.length&&function(t,e,i){let n,r=0;for(;r<t.length&&!n;){const e=t[r];"string"===typeof e&&!Se.has(e)&&ae(e).values.length&&(n=t[r]),r++}if(n&&i)for(const s of e)t[s]=we(i,n)}(t,i,e)}measureInitialState(){const{element:t,unresolvedKeyframes:e,name:i}=this;if(!t||!t.current)return;"height"===i&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Pe[i](t.measureViewportBox(),window.getComputedStyle(t.current)),e[0]=this.measuredOrigin;const n=e[e.length-1];void 0!==n&&t.getValue(i,n).jump(n,!1)}measureEndState(){var t;const{element:e,name:i,unresolvedKeyframes:n}=this;if(!e||!e.current)return;const r=e.getValue(i);r&&r.jump(this.measuredOrigin,!1);const s=n.length-1,a=n[s];n[s]=Pe[i](e.measureViewportBox(),window.getComputedStyle(e.current)),null!==a&&void 0===this.finalKeyframe&&(this.finalKeyframe=a),(null===(t=this.removedTransforms)||void 0===t?void 0:t.length)&&this.removedTransforms.forEach((t=>{let[i,n]=t;e.getValue(i).set(n)})),this.resolveNoneKeyframes()}}const Qe=(t,e)=>"zIndex"!==e&&(!("number"!==typeof t&&!Array.isArray(t))||!("string"!==typeof t||!ce.test(t)&&"0"!==t||t.startsWith("url(")));function Ke(t,e,i,n){const r=t[0];if(null===r)return!1;if("display"===e||"visibility"===e)return!0;const s=t[t.length-1],a=Qe(r,e),o=Qe(s,e);return Le(a===o,`You are trying to animate ${e} from "${r}" to "${s}". ${r} is not an animatable value - to enable this animation set ${r} to a value animatable to ${s} via the \`style\` property.`),!(!a||!o)&&(function(t){const e=t[0];if(1===t.length)return!0;for(let i=0;i<t.length;i++)if(t[i]!==e)return!0}(t)||("spring"===i||b(i))&&n)}const Ze=t=>null!==t;function Je(t,e,i){let{repeat:n,repeatType:r="loop"}=e;const s=t.filter(Ze),a=n&&"loop"!==r&&n%2===1?0:s.length-1;return a&&void 0!==i?i:s[a]}class $e{constructor(t){let{autoplay:e=!0,delay:i=0,type:n="keyframes",repeat:r=0,repeatDelay:s=0,repeatType:a="loop",...o}=t;this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=ot.now(),this.options={autoplay:e,delay:i,type:n,repeat:r,repeatDelay:s,repeatType:a,...o},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt}get resolved(){return this._resolved||this.hasAttemptedResolve||(Re(),Ie()),this._resolved}onKeyframesResolved(t,e){this.resolvedAt=ot.now(),this.hasAttemptedResolve=!0;const{name:i,type:n,velocity:r,delay:s,onComplete:a,onUpdate:o,isGenerator:l}=this.options;if(!l&&!Ke(t,i,n,r)){if(St||!s)return o&&o(Je(t,this.options,e)),a&&a(),void this.resolveFinishedPromise();this.options.duration=0}const h=this.initPlayback(t,e);!1!==h&&(this._resolved={keyframes:t,finalKeyframe:e,...h},this.onPostResolved())}onPostResolved(){}then(t,e){return this.currentFinishedPromise.then(t,e)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise((t=>{this.resolveFinishedPromise=t}))}}const ti={layout:0,mainThread:0,waapi:0},ei=(t,e,i)=>t+(e-t)*i;function ii(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}function ni(t,e){return i=>i>0?e:t}const ri=(t,e,i)=>{const n=t*t,r=i*(e*e-n)+n;return r<0?0:Math.sqrt(r)},si=[qt,Wt,te];function ai(t){const e=(i=t,si.find((t=>t.test(i))));var i;if(Le(Boolean(e),`'${t}' is not an animatable color. Use the equivalent color code instead.`),!Boolean(e))return!1;let n=e.parse(t);return e===te&&(n=function(t){let{hue:e,saturation:i,lightness:n,alpha:r}=t;e/=360,i/=100,n/=100;let s=0,a=0,o=0;if(i){const t=n<.5?n*(1+i):n+i-n*i,r=2*n-t;s=ii(r,t,e+1/3),a=ii(r,t,e),o=ii(r,t,e-1/3)}else s=a=o=n;return{red:Math.round(255*s),green:Math.round(255*a),blue:Math.round(255*o),alpha:r}}(n)),n}const oi=(t,e)=>{const i=ai(t),n=ai(e);if(!i||!n)return ni(t,e);const r={...i};return t=>(r.red=ri(i.red,n.red,t),r.green=ri(i.green,n.green,t),r.blue=ri(i.blue,n.blue,t),r.alpha=ei(i.alpha,n.alpha,t),Wt.transform(r))},li=(t,e)=>i=>e(t(i)),hi=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return e.reduce(li)},ci=new Set(["none","hidden"]);function ui(t,e){return i=>ei(t,e,i)}function di(t){return"number"===typeof t?ui:"string"===typeof t?Ve(t)?ni:ee.test(t)?oi:mi:Array.isArray(t)?pi:"object"===typeof t?ee.test(t)?oi:fi:ni}function pi(t,e){const i=[...t],n=i.length,r=t.map(((t,i)=>di(t)(t,e[i])));return t=>{for(let e=0;e<n;e++)i[e]=r[e](t);return i}}function fi(t,e){const i={...t,...e},n={};for(const r in i)void 0!==t[r]&&void 0!==e[r]&&(n[r]=di(t[r])(t[r],e[r]));return t=>{for(const e in n)i[e]=n[e](t);return i}}const mi=(t,e)=>{const i=ce.createTransformer(e),n=ae(t),r=ae(e);return n.indexes.var.length===r.indexes.var.length&&n.indexes.color.length===r.indexes.color.length&&n.indexes.number.length>=r.indexes.number.length?ci.has(t)&&!r.values.length||ci.has(e)&&!n.values.length?function(t,e){return ci.has(t)?i=>i<=0?t:e:i=>i>=1?e:t}(t,e):hi(pi(function(t,e){var i;const n=[],r={color:0,var:0,number:0};for(let s=0;s<e.values.length;s++){const a=e.types[s],o=t.indexes[a][r[a]],l=null!==(i=t.values[o])&&void 0!==i?i:0;n[s]=l,r[a]++}return n}(n,r),r.values),i):(Le(!0,`Complex values '${t}' and '${e}' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.`),ni(t,e))};function gi(t,e,i){if("number"===typeof t&&"number"===typeof e&&"number"===typeof i)return ei(t,e,i);return di(t)(t,e)}function vi(t,e,i){const n=Math.max(e-5,0);return ut(i-t(n),e-n)}const yi={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},bi=.001;function xi(t){let e,i,{duration:n=yi.duration,bounce:r=yi.bounce,velocity:s=yi.velocity,mass:a=yi.mass}=t;Le(n<=G(yi.maxDuration),"Spring duration must be 10 seconds or less");let o=1-r;o=Lt(yi.minDamping,yi.maxDamping,o),n=Lt(yi.minDuration,yi.maxDuration,H(n)),o<1?(e=t=>{const e=t*o,i=e*n,r=e-s,a=Si(t,o),l=Math.exp(-i);return bi-r/a*l},i=t=>{const i=t*o*n,r=i*s+s,a=Math.pow(o,2)*Math.pow(t,2)*n,l=Math.exp(-i),h=Si(Math.pow(t,2),o);return(-e(t)+bi>0?-1:1)*((r-a)*l)/h}):(e=t=>Math.exp(-t*n)*((t-s)*n+1)-.001,i=t=>Math.exp(-t*n)*(n*n*(s-t)));const l=function(t,e,i){let n=i;for(let r=1;r<wi;r++)n-=t(n)/e(n);return n}(e,i,5/n);if(n=G(n),isNaN(l))return{stiffness:yi.stiffness,damping:yi.damping,duration:n};{const t=Math.pow(l,2)*a;return{stiffness:t,damping:2*o*Math.sqrt(a*t),duration:n}}}const wi=12;function Si(t,e){return t*Math.sqrt(1-e*e)}const Ai=["duration","bounce"],Ei=["stiffness","damping","mass"];function _i(t,e){return e.some((e=>void 0!==t[e]))}function Ci(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yi.visualDuration,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yi.bounce;const i="object"!==typeof t?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:n,restDelta:r}=i;const s=i.keyframes[0],a=i.keyframes[i.keyframes.length-1],o={done:!1,value:s},{stiffness:l,damping:h,mass:c,duration:u,velocity:d,isResolvedFromDuration:p}=function(t){let e={velocity:yi.velocity,stiffness:yi.stiffness,damping:yi.damping,mass:yi.mass,isResolvedFromDuration:!1,...t};if(!_i(t,Ei)&&_i(t,Ai))if(t.visualDuration){const i=t.visualDuration,n=2*Math.PI/(1.2*i),r=n*n,s=2*Lt(.05,1,1-(t.bounce||0))*Math.sqrt(r);e={...e,mass:yi.mass,stiffness:r,damping:s}}else{const i=xi(t);e={...e,...i,mass:yi.mass},e.isResolvedFromDuration=!0}return e}({...i,velocity:-H(i.velocity||0)}),f=d||0,m=h/(2*Math.sqrt(l*c)),g=a-s,b=H(Math.sqrt(l/c)),x=Math.abs(g)<5;let w;if(n||(n=x?yi.restSpeed.granular:yi.restSpeed.default),r||(r=x?yi.restDelta.granular:yi.restDelta.default),m<1){const t=Si(b,m);w=e=>{const i=Math.exp(-m*b*e);return a-i*((f+m*b*g)/t*Math.sin(t*e)+g*Math.cos(t*e))}}else if(1===m)w=t=>a-Math.exp(-b*t)*(g+(f+b*g)*t);else{const t=b*Math.sqrt(m*m-1);w=e=>{const i=Math.exp(-m*b*e),n=Math.min(t*e,300);return a-i*((f+m*b*g)*Math.sinh(n)+t*g*Math.cosh(n))/t}}const S={calculatedDuration:p&&u||null,next:t=>{const e=w(t);if(p)o.done=t>=u;else{let i=0;m<1&&(i=0===t?G(f):vi(w,t,e));const s=Math.abs(i)<=n,l=Math.abs(a-e)<=r;o.done=s&&l}return o.value=o.done?a:e,o},toString:()=>{const t=Math.min(y(S),v),e=C((e=>S.next(t*e).value),t,30);return t+"ms "+e}};return S}function Mi(t){let{keyframes:e,velocity:i=0,power:n=.8,timeConstant:r=325,bounceDamping:s=10,bounceStiffness:a=500,modifyTarget:o,min:l,max:h,restDelta:c=.5,restSpeed:u}=t;const d=e[0],p={done:!1,value:d},f=t=>void 0===l?h:void 0===h||Math.abs(l-t)<Math.abs(h-t)?l:h;let m=n*i;const g=d+m,v=void 0===o?g:o(g);v!==g&&(m=v-d);const y=t=>-m*Math.exp(-t/r),b=t=>v+y(t),x=t=>{const e=y(t),i=b(t);p.done=Math.abs(e)<=c,p.value=p.done?v:i};let w,S;const A=t=>{var e;(e=p.value,void 0!==l&&e<l||void 0!==h&&e>h)&&(w=t,S=Ci({keyframes:[p.value,f(p.value)],velocity:vi(b,t,p.value),damping:s,stiffness:a,restDelta:c,restSpeed:u}))};return A(0),{calculatedDuration:null,next:t=>{let e=!1;return S||void 0!==w||(e=!0,x(t),A(t)),void 0!==w&&t>=w?S.next(t-w):(!e&&x(t),p)}}}const Pi=Et(.42,0,1,1),Ti=Et(0,0,.58,1),Di=Et(.42,0,.58,1),ki={linear:W,easeIn:Pi,easeInOut:Di,easeOut:Ti,circIn:kt,circInOut:Rt,circOut:It,backIn:Pt,backInOut:Tt,backOut:Mt,anticipate:Dt},Ii=t=>{if(w(t)){Be(4===t.length,"Cubic bezier arrays must contain four numerical values.");const[e,i,n,r]=t;return Et(e,i,n,r)}return"string"===typeof t?(Be(void 0!==ki[t],`Invalid easing type '${t}'`),ki[t]):t};function Ri(t,e){let{clamp:i=!0,ease:n,mixer:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=t.length;if(Be(s===e.length,"Both input and output ranges must be the same length"),1===s)return()=>e[0];if(2===s&&e[0]===e[1])return()=>e[1];const a=t[0]===t[1];t[0]>t[s-1]&&(t=[...t].reverse(),e=[...e].reverse());const o=function(t,e,i){const n=[],r=i||gi,s=t.length-1;for(let a=0;a<s;a++){let i=r(t[a],t[a+1]);if(e){const t=Array.isArray(e)?e[a]||W:e;i=hi(t,i)}n.push(i)}return n}(e,n,r),l=o.length,h=i=>{if(a&&i<t[0])return e[0];let n=0;if(l>1)for(;n<t.length-2&&!(i<t[n+1]);n++);const r=_(t[n],t[n+1],i);return o[n](r)};return i?e=>h(Lt(t[0],t[s-1],e)):h}function Oi(t){const e=[0];return function(t,e){const i=t[t.length-1];for(let n=1;n<=e;n++){const r=_(0,e,n);t.push(ei(i,1,r))}}(e,t.length-1),e}function Li(t){let{duration:e=300,keyframes:i,times:n,ease:r="easeInOut"}=t;const s=(t=>Array.isArray(t)&&"number"!==typeof t[0])(r)?r.map(Ii):Ii(r),a={done:!1,value:i[0]},o=function(t,e){return t.map((t=>t*e))}(n&&n.length===i.length?n:Oi(i),e),l=Ri(o,i,{ease:Array.isArray(s)?s:(h=i,c=s,h.map((()=>c||Di)).splice(0,h.length-1))});var h,c;return{calculatedDuration:e,next:t=>(a.value=l(t),a.done=t>=e,a)}}const Bi=t=>{const e=e=>{let{timestamp:i}=e;return t(i)};return{start:()=>et.update(e,!0),stop:()=>it(e),now:()=>nt.isProcessing?nt.timestamp:ot.now()}},zi={decay:Mi,inertia:Mi,tween:Li,keyframes:Li,spring:Ci},Fi=t=>t/100;class Ni extends $e{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.teardown();const{onStop:t}=this.options;t&&t()};const{name:e,motionValue:i,element:n,keyframes:r}=this.options,s=(null===n||void 0===n?void 0:n.KeyframeResolver)||Oe;this.resolver=new s(r,((t,e)=>this.onKeyframesResolved(t,e)),e,i,n),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(t){const{type:e="keyframes",repeat:i=0,repeatDelay:n=0,repeatType:r,velocity:s=0}=this.options,a=b(e)?e:zi[e]||Li;let o,l;a!==Li&&"number"!==typeof t[0]&&(o=hi(Fi,gi(t[0],t[1])),t=[0,100]);const h=a({...this.options,keyframes:t});"mirror"===r&&(l=a({...this.options,keyframes:[...t].reverse(),velocity:-s})),null===h.calculatedDuration&&(h.calculatedDuration=y(h));const{calculatedDuration:c}=h,u=c+n;return{generator:h,mirroredGenerator:l,mapPercentToKeyframes:o,calculatedDuration:c,resolvedDuration:u,totalDuration:u*(i+1)-n}}onPostResolved(){const{autoplay:t=!0}=this.options;ti.mainThread++,this.play(),"paused"!==this.pendingPlayState&&t?this.state=this.pendingPlayState:this.pause()}tick(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{resolved:i}=this;if(!i){const{keyframes:t}=this.options;return{done:!0,value:t[t.length-1]}}const{finalKeyframe:n,generator:r,mirroredGenerator:s,mapPercentToKeyframes:a,keyframes:o,calculatedDuration:l,totalDuration:h,resolvedDuration:c}=i;if(null===this.startTime)return r.next(0);const{delay:u,repeat:d,repeatType:p,repeatDelay:f,onUpdate:m}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-h/this.speed,this.startTime)),e?this.currentTime=t:null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const g=this.currentTime-u*(this.speed>=0?1:-1),v=this.speed>=0?g<0:g>h;this.currentTime=Math.max(g,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=h);let y=this.currentTime,b=r;if(d){const t=Math.min(this.currentTime,h)/c;let e=Math.floor(t),i=t%1;!i&&t>=1&&(i=1),1===i&&e--,e=Math.min(e,d+1);Boolean(e%2)&&("reverse"===p?(i=1-i,f&&(i-=f/c)):"mirror"===p&&(b=s)),y=Lt(0,1,i)*c}const x=v?{done:!1,value:o[0]}:b.next(y);a&&(x.value=a(x.value));let{done:w}=x;v||null===l||(w=this.speed>=0?this.currentTime>=h:this.currentTime<=0);const S=null===this.holdTime&&("finished"===this.state||"running"===this.state&&w);return S&&void 0!==n&&(x.value=Je(o,this.options,n)),m&&m(x.value),S&&this.finish(),x}get duration(){const{resolved:t}=this;return t?H(t.calculatedDuration):0}get time(){return H(this.currentTime)}set time(t){t=G(t),this.currentTime=t,null!==this.holdTime||0===this.speed?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const e=this.playbackSpeed!==t;this.playbackSpeed=t,e&&(this.time=H(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved)return void(this.pendingPlayState="running");if(this.isStopped)return;const{driver:t=Bi,onPlay:e,startTime:i}=this.options;this.driver||(this.driver=t((t=>this.tick(t)))),e&&e();const n=this.driver.now();null!==this.holdTime?this.startTime=n-this.holdTime:this.startTime?"finished"===this.state&&(this.startTime=n):this.startTime=null!==i&&void 0!==i?i:this.calcStartTime(),"finished"===this.state&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;this._resolved?(this.state="paused",this.holdTime=null!==(t=this.currentTime)&&void 0!==t?t:0):this.pendingPlayState="paused"}complete(){"running"!==this.state&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){null!==this.cancelTime&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel(),ti.mainThread--}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const Ui=new Set(["opacity","clipPath","filter","transform"]);const Vi=d((()=>Object.hasOwnProperty.call(Element.prototype,"animate")));const ji={anticipate:Dt,backInOut:Tt,circInOut:Rt};class Gi extends $e{constructor(t){super(t);const{name:e,motionValue:i,element:n,keyframes:r}=this.options;this.resolver=new Xe(r,((t,e)=>this.onKeyframesResolved(t,e)),e,i,n),this.resolver.scheduleResolve()}initPlayback(t,e){let{duration:i=300,times:n,ease:r,type:s,motionValue:a,name:o,startTime:l}=this.options;if(!a.owner||!a.owner.current)return!1;var h;if("string"===typeof r&&E()&&r in ji&&(r=ji[r]),b((h=this.options).type)||"spring"===h.type||!M(h.ease)){const{onComplete:e,onUpdate:a,motionValue:o,element:l,...h}=this.options,c=function(t,e){const i=new Ni({...e,keyframes:t,repeat:0,delay:0,isGenerator:!0});let n={done:!1,value:t[0]};const r=[];let s=0;for(;!n.done&&s<2e4;)n=i.sample(s),r.push(n.value),s+=10;return{times:void 0,keyframes:r,duration:s-10,ease:"linear"}}(t,h);1===(t=c.keyframes).length&&(t[1]=t[0]),i=c.duration,n=c.times,r=c.ease,s="keyframes"}const c=function(t,e,i){let{delay:n=0,duration:r=300,repeat:s=0,repeatType:a="loop",ease:o="easeInOut",times:l}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const h={[e]:i};l&&(h.offset=l);const c=D(o,r);Array.isArray(c)&&(h.easing=c),$.value&&ti.waapi++;const u=t.animate(h,{delay:n,duration:r,easing:Array.isArray(c)?"linear":c,fill:"both",iterations:s+1,direction:"reverse"===a?"alternate":"normal"});return $.value&&u.finished.finally((()=>{ti.waapi--})),u}(a.owner.current,o,t,{...this.options,duration:i,times:n,ease:r});return c.startTime=null!==l&&void 0!==l?l:this.calcStartTime(),this.pendingTimeline?(x(c,this.pendingTimeline),this.pendingTimeline=void 0):c.onfinish=()=>{const{onComplete:i}=this.options;a.set(Je(t,this.options,e)),i&&i(),this.cancel(),this.resolveFinishedPromise()},{animation:c,duration:i,times:n,type:s,ease:r,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:e}=t;return H(e)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:e}=t;return H(e.currentTime||0)}set time(t){const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.currentTime=G(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:e}=t;return e.playbackRate}set speed(t){const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:e}=t;return e.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:e}=t;return e.startTime}attachTimeline(t){if(this._resolved){const{resolved:e}=this;if(!e)return W;const{animation:i}=e;x(i,t)}else this.pendingTimeline=t;return W}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:e}=t;"finished"===e.playState&&this.updateFinishedPromise(),e.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:e}=t;e.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:e,keyframes:i,duration:n,type:r,ease:s,times:a}=t;if("idle"===e.playState||"finished"===e.playState)return;if(this.time){const{motionValue:t,onUpdate:e,onComplete:o,element:l,...h}=this.options,c=new Ni({...h,keyframes:i,duration:n,type:r,ease:s,times:a,isGenerator:!0}),u=G(this.time);t.setWithVelocity(c.sample(u-10).value,c.sample(u).value,10)}const{onStop:o}=this.options;o&&o(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:e,name:i,repeatDelay:n,repeatType:r,damping:s,type:a}=t;if(!e||!e.owner||!(e.owner.current instanceof HTMLElement))return!1;const{onUpdate:o,transformTemplate:l}=e.owner.getProps();return Vi()&&i&&Ui.has(i)&&!o&&!l&&!n&&"mirror"!==r&&0!==s&&"inertia"!==a}}const Hi={type:"spring",stiffness:500,damping:25,restSpeed:10},Wi={type:"keyframes",duration:.8},qi={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Yi=(t,e)=>{let{keyframes:i}=e;return i.length>2?Wi:Y.has(t)?t.startsWith("scale")?{type:"spring",stiffness:550,damping:0===i[1]?2*Math.sqrt(550):30,restSpeed:10}:Hi:qi};const Xi=function(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0;return a=>{const o=g(n,t)||{},l=o.delay||n.delay||0;let{elapsed:h=0}=n;h-=G(l);let c={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:e.getVelocity(),...o,delay:-h,onUpdate:t=>{e.set(t),o.onUpdate&&o.onUpdate(t)},onComplete:()=>{a(),o.onComplete&&o.onComplete()},name:t,motionValue:e,element:s?void 0:r};(function(t){let{when:e,delay:i,delayChildren:n,staggerChildren:r,staggerDirection:s,repeat:a,repeatType:o,repeatDelay:l,from:h,elapsed:c,...u}=t;return!!Object.keys(u).length})(o)||(c={...c,...Yi(t,c)}),c.duration&&(c.duration=G(c.duration)),c.repeatDelay&&(c.repeatDelay=G(c.repeatDelay)),void 0!==c.from&&(c.keyframes[0]=c.from);let u=!1;if((!1===c.type||0===c.duration&&!c.repeatDelay)&&(c.duration=0,0===c.delay&&(u=!0)),(St||K)&&(u=!0,c.duration=0,c.delay=0),u&&!s&&void 0!==e.get()){const t=Je(c.keyframes,o);if(void 0!==t)return et.update((()=>{c.onUpdate(t),c.onComplete()})),new m([])}return!s&&Gi.supports(c)?new Gi(c):new Ni(c)}};function Qi(t,e){let{protectedKeys:i,needsAnimating:n}=t;const r=i.hasOwnProperty(e)&&!0!==n[e];return n[e]=!1,r}function Ki(t,e){let{delay:i=0,transitionOverride:n,type:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var s;let{transition:a=t.getDefaultTransition(),transitionEnd:o,...l}=e;n&&(a=n);const h=[],c=r&&t.animationState&&t.animationState.getState()[r];for(const u in l){const e=t.getValue(u,null!==(s=t.latestValues[u])&&void 0!==s?s:null),n=l[u];if(void 0===n||c&&Qi(c,u))continue;const r={delay:i,...g(a||{},u)};let o=!1;if(window.MotionHandoffAnimation){const e=wt(t);if(e){const t=window.MotionHandoffAnimation(e,u,et);null!==t&&(r.startTime=t,o=!0)}}yt(t,u),e.start(Xi(u,e,n,t.shouldReduceMotion&&X.has(u)?{type:!1}:r,t,o));const d=e.animation;d&&h.push(d)}return o&&Promise.all(h).then((()=>{et.update((()=>{o&&gt(t,o)}))})),h}function Zi(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var n;const r=u(t,e,"exit"===i.type?null===(n=t.presenceContext)||void 0===n?void 0:n.custom:void 0);let{transition:s=t.getDefaultTransition()||{}}=r||{};i.transitionOverride&&(s=i.transitionOverride);const a=r?()=>Promise.all(Ki(t,r,i)):()=>Promise.resolve(),o=t.variantChildren&&t.variantChildren.size?function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const{delayChildren:r=0,staggerChildren:a,staggerDirection:o}=s;return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5?arguments[5]:void 0;const a=[],o=(t.variantChildren.size-1)*n,l=1===r?function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)*n}:function(){return o-(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)*n};return Array.from(t.variantChildren).sort(Ji).forEach(((t,n)=>{t.notify("AnimationStart",e),a.push(Zi(t,e,{...s,delay:i+l(n)}).then((()=>t.notify("AnimationComplete",e))))})),Promise.all(a)}(t,e,r+n,a,o,i)}:()=>Promise.resolve(),{when:l}=s;if(l){const[t,e]="beforeChildren"===l?[a,o]:[o,a];return t().then((()=>e()))}return Promise.all([a(),o(i.delay)])}function Ji(t,e){return t.sortNodePosition(e)}function $i(t,e){let i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t.notify("AnimationStart",e),Array.isArray(e)){const r=e.map((e=>Zi(t,e,n)));i=Promise.all(r)}else if("string"===typeof e)i=Zi(t,e,n);else{const r="function"===typeof e?u(t,e,n.custom):e;i=Promise.all(Ki(t,r,n))}return i.then((()=>{t.notify("AnimationComplete",e)}))}function tn(t,e){if(!Array.isArray(e))return!1;const i=e.length;if(i!==t.length)return!1;for(let n=0;n<i;n++)if(e[n]!==t[n])return!1;return!0}function en(t){return"string"===typeof t||Array.isArray(t)}const nn=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],rn=["initial",...nn],sn=rn.length;function an(t){if(!t)return;if(!t.isControllingVariants){const e=t.parent&&an(t.parent)||{};return void 0!==t.props.initial&&(e.initial=t.props.initial),e}const e={};for(let i=0;i<sn;i++){const n=rn[i],r=t.props[n];(en(r)||!1===r)&&(e[n]=r)}return e}const on=[...nn].reverse(),ln=nn.length;function hn(t){let e=function(t){return e=>Promise.all(e.map((e=>{let{animation:i,options:n}=e;return $i(t,i,n)})))}(t),i=dn(),n=!0;const r=e=>(i,n)=>{var r;const s=u(t,n,"exit"===e?null===(r=t.presenceContext)||void 0===r?void 0:r.custom:void 0);if(s){const{transition:t,transitionEnd:e,...n}=s;i={...i,...n,...e}}return i};function s(s){const{props:a}=t,o=an(t.parent)||{},h=[],c=new Set;let d={},p=1/0;for(let e=0;e<ln;e++){const u=on[e],f=i[u],m=void 0!==a[u]?a[u]:o[u],g=en(m),v=u===s?f.isActive:null;!1===v&&(p=e);let y=m===o[u]&&m!==a[u]&&g;if(y&&n&&t.manuallyAnimateOnMount&&(y=!1),f.protectedKeys={...d},!f.isActive&&null===v||!m&&!f.prevProp||l(m)||"boolean"===typeof m)continue;const b=cn(f.prevProp,m);let x=b||u===s&&f.isActive&&!y&&g||e>p&&g,w=!1;const S=Array.isArray(m)?m:[m];let A=S.reduce(r(u),{});!1===v&&(A={});const{prevResolvedValues:E={}}=f,_={...E,...A},C=e=>{x=!0,c.has(e)&&(w=!0,c.delete(e)),f.needsAnimating[e]=!0;const i=t.getValue(e);i&&(i.liveStyle=!1)};for(const t in _){const e=A[t],i=E[t];if(d.hasOwnProperty(t))continue;let n=!1;n=Q(e)&&Q(i)?!tn(e,i):e!==i,n?void 0!==e&&null!==e?C(t):c.add(t):void 0!==e&&c.has(t)?C(t):f.protectedKeys[t]=!0}f.prevProp=m,f.prevResolvedValues=A,f.isActive&&(d={...d,...A}),n&&t.blockInitialAnimation&&(x=!1);x&&(!(y&&b)||w)&&h.push(...S.map((t=>({animation:t,options:{type:u}}))))}if(c.size){const e={};if("boolean"!==typeof a.initial){const i=u(t,Array.isArray(a.initial)?a.initial[0]:a.initial);i&&i.transition&&(e.transition=i.transition)}c.forEach((i=>{const n=t.getBaseTarget(i),r=t.getValue(i);r&&(r.liveStyle=!0),e[i]=null!==n&&void 0!==n?n:null})),h.push({animation:e})}let f=Boolean(h.length);return!n||!1!==a.initial&&a.initial!==a.animate||t.manuallyAnimateOnMount||(f=!1),n=!1,f?e(h):Promise.resolve()}return{animateChanges:s,setActive:function(e,n){var r;if(i[e].isActive===n)return Promise.resolve();null===(r=t.variantChildren)||void 0===r||r.forEach((t=>{var i;return null===(i=t.animationState)||void 0===i?void 0:i.setActive(e,n)})),i[e].isActive=n;const a=s(e);for(const t in i)i[t].protectedKeys={};return a},setAnimateFunction:function(i){e=i(t)},getState:()=>i,reset:()=>{i=dn(),n=!0}}}function cn(t,e){return"string"===typeof e?e!==t:!!Array.isArray(e)&&!tn(e,t)}function un(){return{isActive:arguments.length>0&&void 0!==arguments[0]&&arguments[0],protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function dn(){return{animate:un(!0),whileInView:un(),whileHover:un(),whileTap:un(),whileDrag:un(),whileFocus:un(),exit:un()}}class pn{constructor(t){this.isMounted=!1,this.node=t}update(){}}let fn=0;const mn={animation:{Feature:class extends pn{constructor(t){super(t),t.animationState||(t.animationState=hn(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();l(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:e}=this.node.prevProps||{};t!==e&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),null===(t=this.unmountControls)||void 0===t||t.call(this)}}},exit:{Feature:class extends pn{constructor(){super(...arguments),this.id=fn++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:e}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===i)return;const n=this.node.animationState.setActive("exit",!t);e&&!t&&n.then((()=>{e(this.id)}))}mount(){const{register:t,onExitComplete:e}=this.node.presenceContext||{};e&&e(this.id),t&&(this.unmount=t(this.id))}unmount(){}}}};function gn(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{passive:!0};return t.addEventListener(e,i,n),()=>t.removeEventListener(e,i)}function vn(t){return{point:{x:t.pageX,y:t.pageY}}}function yn(t,e,i,n){return gn(t,e,(t=>e=>B(e)&&t(e,vn(e)))(i),n)}const bn=(t,e)=>Math.abs(t-e);class xn{constructor(t,e){let{transformPagePoint:i,contextWindow:n,dragSnapToOrigin:r=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const t=An(this.lastMoveEventInfo,this.history),e=null!==this.startEvent,i=function(t,e){const i=bn(t.x,e.x),n=bn(t.y,e.y);return Math.sqrt(i**2+n**2)}(t.offset,{x:0,y:0})>=3;if(!e&&!i)return;const{point:n}=t,{timestamp:r}=nt;this.history.push({...n,timestamp:r});const{onStart:s,onMove:a}=this.handlers;e||(s&&s(this.lastMoveEvent,t),this.startEvent=this.lastMoveEvent),a&&a(this.lastMoveEvent,t)},this.handlePointerMove=(t,e)=>{this.lastMoveEvent=t,this.lastMoveEventInfo=wn(e,this.transformPagePoint),et.update(this.updatePoint,!0)},this.handlePointerUp=(t,e)=>{this.end();const{onEnd:i,onSessionEnd:n,resumeAnimation:r}=this.handlers;if(this.dragSnapToOrigin&&r&&r(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const s=An("pointercancel"===t.type?this.lastMoveEventInfo:wn(e,this.transformPagePoint),this.history);this.startEvent&&i&&i(t,s),n&&n(t,s)},!B(t))return;this.dragSnapToOrigin=r,this.handlers=e,this.transformPagePoint=i,this.contextWindow=n||window;const s=wn(vn(t),this.transformPagePoint),{point:a}=s,{timestamp:o}=nt;this.history=[{...a,timestamp:o}];const{onSessionStart:l}=e;l&&l(t,An(s,this.history)),this.removeListeners=hi(yn(this.contextWindow,"pointermove",this.handlePointerMove),yn(this.contextWindow,"pointerup",this.handlePointerUp),yn(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),it(this.updatePoint)}}function wn(t,e){return e?{point:e(t.point)}:t}function Sn(t,e){return{x:t.x-e.x,y:t.y-e.y}}function An(t,e){let{point:i}=t;return{point:i,delta:Sn(i,_n(e)),offset:Sn(i,En(e)),velocity:Cn(e,.1)}}function En(t){return t[0]}function _n(t){return t[t.length-1]}function Cn(t,e){if(t.length<2)return{x:0,y:0};let i=t.length-1,n=null;const r=_n(t);for(;i>=0&&(n=t[i],!(r.timestamp-n.timestamp>G(e)));)i--;if(!n)return{x:0,y:0};const s=H(r.timestamp-n.timestamp);if(0===s)return{x:0,y:0};const a={x:(r.x-n.x)/s,y:(r.y-n.y)/s};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function Mn(t){return t&&"object"===typeof t&&Object.prototype.hasOwnProperty.call(t,"current")}function Pn(t){return t.max-t.min}function Tn(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;t.origin=n,t.originPoint=ei(e.min,e.max,t.origin),t.scale=Pn(i)/Pn(e),t.translate=ei(i.min,i.max,t.origin)-t.originPoint,(t.scale>=.9999&&t.scale<=1.0001||isNaN(t.scale))&&(t.scale=1),(t.translate>=-.01&&t.translate<=.01||isNaN(t.translate))&&(t.translate=0)}function Dn(t,e,i,n){Tn(t.x,e.x,i.x,n?n.originX:void 0),Tn(t.y,e.y,i.y,n?n.originY:void 0)}function kn(t,e,i){t.min=i.min+e.min,t.max=t.min+Pn(e)}function In(t,e,i){t.min=e.min-i.min,t.max=t.min+Pn(e)}function Rn(t,e,i){In(t.x,e.x,i.x),In(t.y,e.y,i.y)}function On(t,e,i){return{min:void 0!==e?t.min+e:void 0,max:void 0!==i?t.max+i-(t.max-t.min):void 0}}function Ln(t,e){let i=e.min-t.min,n=e.max-t.max;return e.max-e.min<t.max-t.min&&([i,n]=[n,i]),{min:i,max:n}}const Bn=.35;function zn(t,e,i){return{min:Fn(t,e),max:Fn(t,i)}}function Fn(t,e){return"number"===typeof t?t:t[e]||0}const Nn=()=>({x:{min:0,max:0},y:{min:0,max:0}});function Un(t){return[t("x"),t("y")]}function Vn(t){let{top:e,left:i,right:n,bottom:r}=t;return{x:{min:i,max:n},y:{min:e,max:r}}}function jn(t){return void 0===t||1===t}function Gn(t){let{scale:e,scaleX:i,scaleY:n}=t;return!jn(e)||!jn(i)||!jn(n)}function Hn(t){return Gn(t)||Wn(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function Wn(t){return qn(t.x)||qn(t.y)}function qn(t){return t&&"0%"!==t}function Yn(t,e,i){return i+e*(t-i)}function Xn(t,e,i,n,r){return void 0!==r&&(t=Yn(t,r,n)),Yn(t,i,n)+e}function Qn(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;t.min=Xn(t.min,e,i,n,r),t.max=Xn(t.max,e,i,n,r)}function Kn(t,e){let{x:i,y:n}=e;Qn(t.x,i.translate,i.scale,i.originPoint),Qn(t.y,n.translate,n.scale,n.originPoint)}const Zn=.999999999999,Jn=1.0000000000001;function $n(t,e){t.min=t.min+e,t.max=t.max+e}function tr(t,e,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;Qn(t,e,i,ei(t.min,t.max,r),n)}function er(t,e){tr(t.x,e.x,e.scaleX,e.scale,e.originX),tr(t.y,e.y,e.scaleY,e.scale,e.originY)}function ir(t,e){return Vn(function(t,e){if(!e)return t;const i=e({x:t.left,y:t.top}),n=e({x:t.right,y:t.bottom});return{top:i.y,left:i.x,bottom:n.y,right:n.x}}(t.getBoundingClientRect(),e))}const nr=t=>{let{current:e}=t;return e?e.ownerDocument.defaultView:null},rr=new WeakMap;class sr{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.visualElement=t}start(t){let{snapToCursor:e=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{presenceContext:i}=this.visualElement;if(i&&!1===i.isPresent)return;const{dragSnapToOrigin:n}=this.getProps();this.panSession=new xn(t,{onSessionStart:t=>{const{dragSnapToOrigin:i}=this.getProps();i?this.pauseAnimation():this.stopAnimation(),e&&this.snapToCursor(vn(t).point)},onStart:(t,e)=>{const{drag:i,dragPropagation:n,onDragStart:r}=this.getProps();if(i&&!n&&(this.openDragLock&&this.openDragLock(),this.openDragLock="x"===(s=i)||"y"===s?k[s]?null:(k[s]=!0,()=>{k[s]=!1}):k.x||k.y?null:(k.x=k.y=!0,()=>{k.x=k.y=!1}),!this.openDragLock))return;var s;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Un((t=>{let e=this.getAxisMotionValue(t).get()||0;if(Qt.test(e)){const{projection:i}=this.visualElement;if(i&&i.layout){const n=i.layout.layoutBox[t];if(n){e=Pn(n)*(parseFloat(e)/100)}}}this.originPoint[t]=e})),r&&et.postRender((()=>r(t,e))),yt(this.visualElement,"transform");const{animationState:a}=this.visualElement;a&&a.setActive("whileDrag",!0)},onMove:(t,e)=>{const{dragPropagation:i,dragDirectionLock:n,onDirectionLock:r,onDrag:s}=this.getProps();if(!i&&!this.openDragLock)return;const{offset:a}=e;if(n&&null===this.currentDirection)return this.currentDirection=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,i=null;Math.abs(t.y)>e?i="y":Math.abs(t.x)>e&&(i="x");return i}(a),void(null!==this.currentDirection&&r&&r(this.currentDirection));this.updateAxis("x",e.point,a),this.updateAxis("y",e.point,a),this.visualElement.render(),s&&s(t,e)},onSessionEnd:(t,e)=>this.stop(t,e),resumeAnimation:()=>Un((t=>{var e;return"paused"===this.getAnimationState(t)&&(null===(e=this.getAxisMotionValue(t).animation)||void 0===e?void 0:e.play())}))},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:n,contextWindow:nr(this.visualElement)})}stop(t,e){const i=this.isDragging;if(this.cancel(),!i)return;const{velocity:n}=e;this.startAnimation(n);const{onDragEnd:r}=this.getProps();r&&et.postRender((()=>r(t,e)))}cancel(){this.isDragging=!1;const{projection:t,animationState:e}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:i}=this.getProps();!i&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),e&&e.setActive("whileDrag",!1)}updateAxis(t,e,i){const{drag:n}=this.getProps();if(!i||!ar(t,n,this.currentDirection))return;const r=this.getAxisMotionValue(t);let s=this.originPoint[t]+i[t];this.constraints&&this.constraints[t]&&(s=function(t,e,i){let{min:n,max:r}=e;return void 0!==n&&t<n?t=i?ei(n,t,i.min):Math.max(t,n):void 0!==r&&t>r&&(t=i?ei(r,t,i.max):Math.min(t,r)),t}(s,this.constraints[t],this.elastic[t])),r.set(s)}resolveConstraints(){var t;const{dragConstraints:e,dragElastic:i}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):null===(t=this.visualElement.projection)||void 0===t?void 0:t.layout,r=this.constraints;e&&Mn(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!e||!n)&&function(t,e){let{top:i,left:n,bottom:r,right:s}=e;return{x:On(t.x,n,s),y:On(t.y,i,r)}}(n.layoutBox,e),this.elastic=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Bn;return!1===t?t=0:!0===t&&(t=Bn),{x:zn(t,"left","right"),y:zn(t,"top","bottom")}}(i),r!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&Un((t=>{!1!==this.constraints&&this.getAxisMotionValue(t)&&(this.constraints[t]=function(t,e){const i={};return void 0!==e.min&&(i.min=e.min-t.min),void 0!==e.max&&(i.max=e.max-t.min),i}(n.layoutBox[t],this.constraints[t]))}))}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:e}=this.getProps();if(!t||!Mn(t))return!1;const i=t.current;Be(null!==i,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop.");const{projection:n}=this.visualElement;if(!n||!n.layout)return!1;const r=function(t,e,i){const n=ir(t,i),{scroll:r}=e;return r&&($n(n.x,r.offset.x),$n(n.y,r.offset.y)),n}(i,n.root,this.visualElement.getTransformPagePoint());let s=function(t,e){return{x:Ln(t.x,e.x),y:Ln(t.y,e.y)}}(n.layout.layoutBox,r);if(e){const t=e(function(t){let{x:e,y:i}=t;return{top:i.min,right:e.max,bottom:i.max,left:e.min}}(s));this.hasMutatedConstraints=!!t,t&&(s=Vn(t))}return s}startAnimation(t){const{drag:e,dragMomentum:i,dragElastic:n,dragTransition:r,dragSnapToOrigin:s,onDragTransitionEnd:a}=this.getProps(),o=this.constraints||{},l=Un((a=>{if(!ar(a,e,this.currentDirection))return;let l=o&&o[a]||{};s&&(l={min:0,max:0});const h=n?200:1e6,c=n?40:1e7,u={type:"inertia",velocity:i?t[a]:0,bounceStiffness:h,bounceDamping:c,timeConstant:750,restDelta:1,restSpeed:10,...r,...l};return this.startAxisValueAnimation(a,u)}));return Promise.all(l).then(a)}startAxisValueAnimation(t,e){const i=this.getAxisMotionValue(t);return yt(this.visualElement,t),i.start(Xi(t,i,0,e,this.visualElement,!1))}stopAnimation(){Un((t=>this.getAxisMotionValue(t).stop()))}pauseAnimation(){Un((t=>{var e;return null===(e=this.getAxisMotionValue(t).animation)||void 0===e?void 0:e.pause()}))}getAnimationState(t){var e;return null===(e=this.getAxisMotionValue(t).animation)||void 0===e?void 0:e.state}getAxisMotionValue(t){const e=`_drag${t.toUpperCase()}`,i=this.visualElement.getProps(),n=i[e];return n||this.visualElement.getValue(t,(i.initial?i.initial[t]:void 0)||0)}snapToCursor(t){Un((e=>{const{drag:i}=this.getProps();if(!ar(e,i,this.currentDirection))return;const{projection:n}=this.visualElement,r=this.getAxisMotionValue(e);if(n&&n.layout){const{min:i,max:s}=n.layout.layoutBox[e];r.set(t[e]-ei(i,s,.5))}}))}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:e}=this.getProps(),{projection:i}=this.visualElement;if(!Mn(e)||!i||!this.constraints)return;this.stopAnimation();const n={x:0,y:0};Un((t=>{const e=this.getAxisMotionValue(t);if(e&&!1!==this.constraints){const i=e.get();n[t]=function(t,e){let i=.5;const n=Pn(t),r=Pn(e);return r>n?i=_(e.min,e.max-n,t.min):n>r&&(i=_(t.min,t.max-r,e.min)),Lt(0,1,i)}({min:i,max:i},this.constraints[t])}}));const{transformTemplate:r}=this.visualElement.getProps();this.visualElement.current.style.transform=r?r({},""):"none",i.root&&i.root.updateScroll(),i.updateLayout(),this.resolveConstraints(),Un((e=>{if(!ar(e,t,null))return;const i=this.getAxisMotionValue(e),{min:r,max:s}=this.constraints[e];i.set(ei(r,s,n[e]))}))}addListeners(){if(!this.visualElement.current)return;rr.set(this.visualElement,this);const t=yn(this.visualElement.current,"pointerdown",(t=>{const{drag:e,dragListener:i=!0}=this.getProps();e&&i&&this.start(t)})),e=()=>{const{dragConstraints:t}=this.getProps();Mn(t)&&t.current&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,n=i.addEventListener("measure",e);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),et.read(e);const r=gn(window,"resize",(()=>this.scalePositionWithinConstraints())),s=i.addEventListener("didUpdate",(t=>{let{delta:e,hasLayoutChanged:i}=t;this.isDragging&&i&&(Un((t=>{const i=this.getAxisMotionValue(t);i&&(this.originPoint[t]+=e[t].translate,i.set(i.get()+e[t].translate))})),this.visualElement.render())}));return()=>{r(),t(),n(),s&&s()}}getProps(){const t=this.visualElement.getProps(),{drag:e=!1,dragDirectionLock:i=!1,dragPropagation:n=!1,dragConstraints:r=!1,dragElastic:s=Bn,dragMomentum:a=!0}=t;return{...t,drag:e,dragDirectionLock:i,dragPropagation:n,dragConstraints:r,dragElastic:s,dragMomentum:a}}}function ar(t,e,i){return(!0===e||e===t)&&(null===i||i===t)}const or=t=>(e,i)=>{t&&et.postRender((()=>t(e,i)))};const lr=(0,t.createContext)(null);function hr(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const i=(0,t.useContext)(lr);if(null===i)return[!0,null];const{isPresent:n,onExitComplete:r,register:s}=i,a=(0,t.useId)();(0,t.useEffect)((()=>{e&&s(a)}),[e]);const o=(0,t.useCallback)((()=>e&&r&&r(a)),[a,r,e]);return!n&&r?[!1,o]:[!0]}const cr=(0,t.createContext)({}),ur=(0,t.createContext)({}),dr={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function pr(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const fr={correct:(t,e)=>{if(!e.target)return t;if("string"===typeof t){if(!Kt.test(t))return t;t=parseFloat(t)}return`${pr(t,e.target.x)}% ${pr(t,e.target.y)}%`}},mr={correct:(t,e)=>{let{treeScale:i,projectionDelta:n}=e;const r=t,s=ce.parse(t);if(s.length>5)return r;const a=ce.createTransformer(t),o="number"!==typeof s[0]?1:0,l=n.x.scale*i.x,h=n.y.scale*i.y;s[0+o]/=l,s[1+o]/=h;const c=ei(l,h,.5);return"number"===typeof s[2+o]&&(s[2+o]/=c),"number"===typeof s[3+o]&&(s[3+o]/=c),a(s)}},gr={};const{schedule:vr,cancel:yr}=tt(queueMicrotask,!1);class br extends t.Component{componentDidMount(){const{visualElement:t,layoutGroup:e,switchLayoutGroup:i,layoutId:n}=this.props,{projection:r}=t;!function(t){for(const e in t)gr[e]=t[e],Ne(e)&&(gr[e].isCSSVariable=!0)}(wr),r&&(e.group&&e.group.add(r),i&&i.register&&n&&i.register(r),r.root.didUpdate(),r.addEventListener("animationComplete",(()=>{this.safeToRemove()})),r.setOptions({...r.options,onExitComplete:()=>this.safeToRemove()})),dr.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:e,visualElement:i,drag:n,isPresent:r}=this.props,s=i.projection;return s?(s.isPresent=r,n||t.layoutDependency!==e||void 0===e?s.willUpdate():this.safeToRemove(),t.isPresent!==r&&(r?s.promote():s.relegate()||et.postRender((()=>{const t=s.getStack();t&&t.members.length||this.safeToRemove()}))),null):null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),vr.postRender((()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()})))}componentWillUnmount(){const{visualElement:t,layoutGroup:e,switchLayoutGroup:i}=this.props,{projection:n}=t;n&&(n.scheduleCheckAfterUnmount(),e&&e.group&&e.group.remove(n),i&&i.deregister&&i.deregister(n))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function xr(e){const[n,r]=hr(),s=(0,t.useContext)(cr);return(0,i.jsx)(br,{...e,layoutGroup:s,switchLayoutGroup:(0,t.useContext)(ur),isPresent:n,safeToRemove:r})}const wr={borderRadius:{...fr,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:fr,borderTopRightRadius:fr,borderBottomLeftRadius:fr,borderBottomRightRadius:fr,boxShadow:mr};const Sr=(t,e)=>t.depth-e.depth;class Ar{constructor(){this.children=[],this.isDirty=!1}add(t){lt(this.children,t),this.isDirty=!0}remove(t){ht(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(Sr),this.isDirty=!1,this.children.forEach(t)}}function Er(t,e){const i=ot.now(),n=r=>{let{timestamp:s}=r;const a=s-i;a>=e&&(it(n),t(a-e))};return et.read(n,!0),()=>it(n)}function _r(t){const e=vt(t)?t.get():t;return i=e,Boolean(i&&"object"===typeof i&&i.mix&&i.toValue)?e.toValue():e;var i}const Cr=["TopLeft","TopRight","BottomLeft","BottomRight"],Mr=Cr.length,Pr=t=>"string"===typeof t?parseFloat(t):t,Tr=t=>"number"===typeof t||Kt.test(t);function Dr(t,e){return void 0!==t[e]?t[e]:t.borderRadius}const kr=Rr(0,.5,It),Ir=Rr(.5,.95,W);function Rr(t,e,i){return n=>n<t?0:n>e?1:i(_(t,e,n))}function Or(t,e){t.min=e.min,t.max=e.max}function Lr(t,e){Or(t.x,e.x),Or(t.y,e.y)}function Br(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function zr(t,e,i,n,r){return t=Yn(t-=e,1/i,n),void 0!==r&&(t=Yn(t,1/r,n)),t}function Fr(t,e,i,n,r){let[s,a,o]=i;!function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,r=arguments.length>4?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t;Qt.test(e)&&(e=parseFloat(e),e=ei(a.min,a.max,e/100)-a.min);if("number"!==typeof e)return;let o=ei(s.min,s.max,n);t===s&&(o-=e),t.min=zr(t.min,e,i,o,r),t.max=zr(t.max,e,i,o,r)}(t,e[s],e[a],e[o],e.scale,n,r)}const Nr=["x","scaleX","originX"],Ur=["y","scaleY","originY"];function Vr(t,e,i,n){Fr(t.x,e,Nr,i?i.x:void 0,n?n.x:void 0),Fr(t.y,e,Ur,i?i.y:void 0,n?n.y:void 0)}function jr(t){return 0===t.translate&&1===t.scale}function Gr(t){return jr(t.x)&&jr(t.y)}function Hr(t,e){return t.min===e.min&&t.max===e.max}function Wr(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function qr(t,e){return Wr(t.x,e.x)&&Wr(t.y,e.y)}function Yr(t){return Pn(t.x)/Pn(t.y)}function Xr(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class Qr{constructor(){this.members=[]}add(t){lt(this.members,t),t.scheduleRender()}remove(t){if(ht(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(t){const e=this.members.findIndex((e=>t===e));if(0===e)return!1;let i;for(let n=e;n>=0;n--){const t=this.members[n];if(!1!==t.isPresent){i=t;break}}return!!i&&(this.promote(i),!0)}promote(t,e){const i=this.lead;if(t!==i&&(this.prevLead=i,this.lead=t,t.show(),i)){i.instance&&i.scheduleRender(),t.scheduleRender(),t.resumeFrom=i,e&&(t.resumeFrom.preserveOpacity=!0),i.snapshot&&(t.snapshot=i.snapshot,t.snapshot.latestValues=i.animationValues||i.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:n}=t.options;!1===n&&i.hide()}}exitAnimationComplete(){this.members.forEach((t=>{const{options:e,resumingFrom:i}=t;e.onExitComplete&&e.onExitComplete(),i&&i.options.onExitComplete&&i.options.onExitComplete()}))}scheduleRender(){this.members.forEach((t=>{t.instance&&t.scheduleRender(!1)}))}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const Kr={nodes:0,calculatedTargetDeltas:0,calculatedProjections:0},Zr=["","X","Y","Z"],Jr={visibility:"hidden"};let $r=0;function ts(t,e,i,n){const{latestValues:r}=e;r[t]&&(i[t]=r[t],e.setStaticValue(t,0),n&&(n[t]=0))}function es(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const i=wt(e);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:e,layoutId:n}=t.options;window.MotionCancelOptimisedAnimation(i,"transform",et,!(e||n))}const{parent:n}=t;n&&!n.hasCheckedOptimisedAppear&&es(n)}function is(t){let{attachResizeListener:e,defaultParent:i,measureScroll:n,checkIsScrollRoot:r,resetTransform:s}=t;return class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null===i||void 0===i?void 0:i();this.id=$r++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,$.value&&(Kr.nodes=Kr.calculatedTargetDeltas=Kr.calculatedProjections=0),this.nodes.forEach(ss),this.nodes.forEach(ds),this.nodes.forEach(ps),this.nodes.forEach(as),$.addProjectionMetrics&&$.addProjectionMetrics(Kr)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=t,this.root=e?e.root||e:this,this.path=e?[...e.path,e]:[],this.parent=e,this.depth=e?e.depth+1:0;for(let i=0;i<this.path.length;i++)this.path[i].shouldResetTransform=!0;this.root===this&&(this.nodes=new Ar)}addEventListener(t,e){return this.eventHandlers.has(t)||this.eventHandlers.set(t,new ct),this.eventHandlers.get(t).add(e)}notifyListeners(t){const e=this.eventHandlers.get(t);for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];e&&e.notify(...n)}hasListeners(t){return this.eventHandlers.has(t)}mount(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.root.hasTreeAnimated;if(this.instance)return;var n;this.isSVG=(n=t)instanceof SVGElement&&"svg"!==n.tagName,this.instance=t;const{layoutId:r,layout:s,visualElement:a}=this.options;if(a&&!a.current&&a.mount(t),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),i&&(s||r)&&(this.isLayoutDirty=!0),e){let i;const n=()=>this.root.updateBlockedByResize=!1;e(t,(()=>{this.root.updateBlockedByResize=!0,i&&i(),i=Er(n,250),dr.hasAnimatedSinceResize&&(dr.hasAnimatedSinceResize=!1,this.nodes.forEach(us))}))}r&&this.root.registerSharedNode(r,this),!1!==this.options.animate&&a&&(r||s)&&this.addEventListener("didUpdate",(t=>{let{delta:e,hasLayoutChanged:i,hasRelativeLayoutChanged:n,layout:r}=t;if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const s=this.options.transition||a.getDefaultTransition()||bs,{onLayoutAnimationStart:o,onLayoutAnimationComplete:l}=a.getProps(),h=!this.targetLayout||!qr(this.targetLayout,r),c=!i&&n;if(this.options.layoutRoot||this.resumeFrom||c||i&&(h||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(e,c);const t={...g(s,"layout"),onPlay:o,onComplete:l};(a.shouldReduceMotion||this.options.layoutRoot)&&(t.delay=0,t.type=!1),this.startAnimation(t)}else i||us(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=r}))}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const t=this.getStack();t&&t.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,it(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(fs),this.animationId++)}getTransformTemplate(){const{visualElement:t}=this.options;return t&&t.getProps().transformTemplate}willUpdate(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&es(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let r=0;r<this.path.length;r++){const t=this.path[r];t.shouldResetTransform=!0,t.updateScroll("snapshot"),t.options.layoutRoot&&t.willUpdate(!1)}const{layoutId:e,layout:i}=this.options;if(void 0===e&&!i)return;const n=this.getTransformTemplate();this.prevTransformTemplateValue=n?n(this.latestValues,""):void 0,this.updateSnapshot(),t&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(ls);this.isUpdating||this.nodes.forEach(hs),this.isUpdating=!1,this.nodes.forEach(cs),this.nodes.forEach(ns),this.nodes.forEach(rs),this.clearAllSnapshots();const t=ot.now();nt.delta=Lt(0,1e3/60,t-nt.timestamp),nt.timestamp=t,nt.isProcessing=!0,rt.update.process(nt),rt.preRender.process(nt),rt.render.process(nt),nt.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,vr.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(os),this.sharedNodes.forEach(ms)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,et.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){et.postRender((()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()}))}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure(),!this.snapshot||Pn(this.snapshot.measuredBox.x)||Pn(this.snapshot.measuredBox.y)||(this.snapshot=void 0))}updateLayout(){if(!this.instance)return;if(this.updateScroll(),(!this.options.alwaysMeasureLayout||!this.isLead())&&!this.isLayoutDirty)return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let i=0;i<this.path.length;i++){this.path[i].updateScroll()}const t=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:e}=this.options;e&&e.notify("LayoutMeasure",this.layout.layoutBox,t?t.layoutBox:void 0)}updateScroll(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"measure",e=Boolean(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===t&&(e=!1),e){const e=r(this.instance);this.scroll={animationId:this.root.animationId,phase:t,isRoot:e,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:e}}}resetTransform(){if(!s)return;const t=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,e=this.projectionDelta&&!Gr(this.projectionDelta),i=this.getTransformTemplate(),n=i?i(this.latestValues,""):void 0,r=n!==this.prevTransformTemplateValue;t&&(e||Hn(this.latestValues)||r)&&(s(this.instance,n),this.shouldResetTransform=!1,this.scheduleRender())}measure(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const e=this.measurePageBox();let i=this.removeElementScroll(e);var n;return t&&(i=this.removeTransform(i)),Ss((n=i).x),Ss(n.y),{animationId:this.root.animationId,measuredBox:e,layoutBox:i,latestValues:{},source:this.id}}measurePageBox(){var t;const{visualElement:e}=this.options;if(!e)return{x:{min:0,max:0},y:{min:0,max:0}};const i=e.measureViewportBox();if(!((null===(t=this.scroll)||void 0===t?void 0:t.wasRoot)||this.path.some(Es))){const{scroll:t}=this.root;t&&($n(i.x,t.offset.x),$n(i.y,t.offset.y))}return i}removeElementScroll(t){var e;const i={x:{min:0,max:0},y:{min:0,max:0}};if(Lr(i,t),null===(e=this.scroll)||void 0===e?void 0:e.wasRoot)return i;for(let n=0;n<this.path.length;n++){const e=this.path[n],{scroll:r,options:s}=e;e!==this.root&&r&&s.layoutScroll&&(r.wasRoot&&Lr(i,t),$n(i.x,r.offset.x),$n(i.y,r.offset.y))}return i}applyTransform(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i={x:{min:0,max:0},y:{min:0,max:0}};Lr(i,t);for(let n=0;n<this.path.length;n++){const t=this.path[n];!e&&t.options.layoutScroll&&t.scroll&&t!==t.root&&er(i,{x:-t.scroll.offset.x,y:-t.scroll.offset.y}),Hn(t.latestValues)&&er(i,t.latestValues)}return Hn(this.latestValues)&&er(i,this.latestValues),i}removeTransform(t){const e={x:{min:0,max:0},y:{min:0,max:0}};Lr(e,t);for(let i=0;i<this.path.length;i++){const t=this.path[i];if(!t.instance)continue;if(!Hn(t.latestValues))continue;Gn(t.latestValues)&&t.updateSnapshot();const n={x:{min:0,max:0},y:{min:0,max:0}};Lr(n,t.measurePageBox()),Vr(e,t.latestValues,t.snapshot?t.snapshot.layoutBox:void 0,n)}return Hn(this.latestValues)&&Vr(e,this.latestValues),e}setTargetDelta(t){this.targetDelta=t,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(t){this.options={...this.options,...t,crossfade:void 0===t.crossfade||t.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==nt.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e;const i=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=i.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=i.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=i.isSharedProjectionDirty);const n=Boolean(this.resumingFrom)||this!==i;if(!(t||n&&this.isSharedProjectionDirty||this.isProjectionDirty||(null===(e=this.parent)||void 0===e?void 0:e.isProjectionDirty)||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:r,layoutId:s}=this.options;if(this.layout&&(r||s)){if(this.resolvedRelativeTargetAt=nt.timestamp,!this.targetDelta&&!this.relativeTarget){const t=this.getClosestProjectingParent();t&&t.layout&&1!==this.animationProgress?(this.relativeParent=t,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Rn(this.relativeTargetOrigin,this.layout.layoutBox,t.layout.layoutBox),Lr(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(this.relativeTarget||this.targetDelta){var a,o,l;if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),a=this.target,o=this.relativeTarget,l=this.relativeParent.target,kn(a.x,o.x,l.x),kn(a.y,o.y,l.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):Lr(this.target,this.layout.layoutBox),Kn(this.target,this.targetDelta)):Lr(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const t=this.getClosestProjectingParent();t&&Boolean(t.resumingFrom)===Boolean(this.resumingFrom)&&!t.options.layoutScroll&&t.target&&1!==this.animationProgress?(this.relativeParent=t,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Rn(this.relativeTargetOrigin,this.target,t.target),Lr(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}$.value&&Kr.calculatedTargetDeltas++}}}getClosestProjectingParent(){if(this.parent&&!Gn(this.parent.latestValues)&&!Wn(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var t;const e=this.getLead(),i=Boolean(this.resumingFrom)||this!==e;let n=!0;if((this.isProjectionDirty||(null===(t=this.parent)||void 0===t?void 0:t.isProjectionDirty))&&(n=!1),i&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(n=!1),this.resolvedRelativeTargetAt===nt.timestamp&&(n=!1),n)return;const{layout:r,layoutId:s}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!r&&!s)return;Lr(this.layoutCorrected,this.layout.layoutBox);const a=this.treeScale.x,o=this.treeScale.y;!function(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=i.length;if(!r)return;let s,a;e.x=e.y=1;for(let o=0;o<r;o++){s=i[o],a=s.projectionDelta;const{visualElement:r}=s.options;r&&r.props.style&&"contents"===r.props.style.display||(n&&s.options.layoutScroll&&s.scroll&&s!==s.root&&er(t,{x:-s.scroll.offset.x,y:-s.scroll.offset.y}),a&&(e.x*=a.x.scale,e.y*=a.y.scale,Kn(t,a)),n&&Hn(s.latestValues)&&er(t,s.latestValues))}e.x<Jn&&e.x>Zn&&(e.x=1),e.y<Jn&&e.y>Zn&&(e.y=1)}(this.layoutCorrected,this.treeScale,this.path,i),!e.layout||e.target||1===this.treeScale.x&&1===this.treeScale.y||(e.target=e.layout.layoutBox,e.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}});const{target:l}=e;l?(this.projectionDelta&&this.prevProjectionDelta?(Br(this.prevProjectionDelta.x,this.projectionDelta.x),Br(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),Dn(this.projectionDelta,this.layoutCorrected,l,this.latestValues),this.treeScale.x===a&&this.treeScale.y===o&&Xr(this.projectionDelta.x,this.prevProjectionDelta.x)&&Xr(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",l)),$.value&&Kr.calculatedProjections++):this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender())}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var e;if(null===(e=this.options.visualElement)||void 0===e||e.scheduleRender(),t){const t=this.getStack();t&&t.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}}}setAnimationOrigin(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this.snapshot,n=i?i.latestValues:{},r={...this.latestValues},s={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!e;const a={x:{min:0,max:0},y:{min:0,max:0}},o=(i?i.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),h=!l||l.members.length<=1,c=Boolean(o&&!h&&!0===this.options.crossfade&&!this.path.some(ys));let u;this.animationProgress=0,this.mixTargetDelta=e=>{const i=e/1e3;var l,d;gs(s.x,t.x,i),gs(s.y,t.y,i),this.setTargetDelta(s),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Rn(a,this.layout.layoutBox,this.relativeParent.layout.layoutBox),function(t,e,i,n){vs(t.x,e.x,i.x,n),vs(t.y,e.y,i.y,n)}(this.relativeTarget,this.relativeTargetOrigin,a,i),u&&(l=this.relativeTarget,d=u,Hr(l.x,d.x)&&Hr(l.y,d.y))&&(this.isProjectionDirty=!1),u||(u={x:{min:0,max:0},y:{min:0,max:0}}),Lr(u,this.relativeTarget)),o&&(this.animationValues=r,function(t,e,i,n,r,s){r?(t.opacity=ei(0,void 0!==i.opacity?i.opacity:1,kr(n)),t.opacityExit=ei(void 0!==e.opacity?e.opacity:1,0,Ir(n))):s&&(t.opacity=ei(void 0!==e.opacity?e.opacity:1,void 0!==i.opacity?i.opacity:1,n));for(let a=0;a<Mr;a++){const r=`border${Cr[a]}Radius`;let s=Dr(e,r),o=Dr(i,r);void 0===s&&void 0===o||(s||(s=0),o||(o=0),0===s||0===o||Tr(s)===Tr(o)?(t[r]=Math.max(ei(Pr(s),Pr(o),n),0),(Qt.test(o)||Qt.test(s))&&(t[r]+="%")):t[r]=o)}(e.rotate||i.rotate)&&(t.rotate=ei(e.rotate||0,i.rotate||0,n))}(r,n,this.latestValues,i,c,h)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=i},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(t){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(it(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=et.update((()=>{dr.hasAnimatedSinceResize=!0,ti.layout++,this.currentAnimation=function(t,e,i){const n=vt(t)?t:ft(t);return n.start(Xi("",n,e,i)),n.animation}(0,1e3,{...t,onUpdate:e=>{this.mixTargetDelta(e),t.onUpdate&&t.onUpdate(e)},onStop:()=>{ti.layout--},onComplete:()=>{ti.layout--,t.onComplete&&t.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0}))}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const t=this.getStack();t&&t.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const t=this.getLead();let{targetWithTransforms:e,target:i,layout:n,latestValues:r}=t;if(e&&i&&n){if(this!==t&&this.layout&&n&&As(this.options.animationType,this.layout.layoutBox,n.layoutBox)){i=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const e=Pn(this.layout.layoutBox.x);i.x.min=t.target.x.min,i.x.max=i.x.min+e;const n=Pn(this.layout.layoutBox.y);i.y.min=t.target.y.min,i.y.max=i.y.min+n}Lr(e,i),er(e,r),Dn(this.projectionDeltaWithTransform,this.layoutCorrected,e,r)}}registerSharedNode(t,e){this.sharedNodes.has(t)||this.sharedNodes.set(t,new Qr);this.sharedNodes.get(t).add(e);const i=e.options.initialPromotionConfig;e.promote({transition:i?i.transition:void 0,preserveFollowOpacity:i&&i.shouldPreserveFollowOpacity?i.shouldPreserveFollowOpacity(e):void 0})}isLead(){const t=this.getStack();return!t||t.lead===this}getLead(){var t;const{layoutId:e}=this.options;return e&&(null===(t=this.getStack())||void 0===t?void 0:t.lead)||this}getPrevLead(){var t;const{layoutId:e}=this.options;return e?null===(t=this.getStack())||void 0===t?void 0:t.prevLead:void 0}getStack(){const{layoutId:t}=this.options;if(t)return this.root.sharedNodes.get(t)}promote(){let{needsReset:t,transition:e,preserveFollowOpacity:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=this.getStack();n&&n.promote(this,i),t&&(this.projectionDelta=void 0,this.needsReset=!0),e&&this.setOptions({transition:e})}relegate(){const t=this.getStack();return!!t&&t.relegate(this)}resetSkewAndRotation(){const{visualElement:t}=this.options;if(!t)return;let e=!1;const{latestValues:i}=t;if((i.z||i.rotate||i.rotateX||i.rotateY||i.rotateZ||i.skewX||i.skewY)&&(e=!0),!e)return;const n={};i.z&&ts("z",t,n,this.animationValues);for(let r=0;r<Zr.length;r++)ts(`rotate${Zr[r]}`,t,n,this.animationValues),ts(`skew${Zr[r]}`,t,n,this.animationValues);t.render();for(const r in n)t.setStaticValue(r,n[r]),this.animationValues&&(this.animationValues[r]=n[r]);t.scheduleRender()}getProjectionStyles(t){var e,i;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Jr;const n={visibility:""},r=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,n.opacity="",n.pointerEvents=_r(null===t||void 0===t?void 0:t.pointerEvents)||"",n.transform=r?r(this.latestValues,""):"none",n;const s=this.getLead();if(!this.projectionDelta||!this.layout||!s.target){const e={};return this.options.layoutId&&(e.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,e.pointerEvents=_r(null===t||void 0===t?void 0:t.pointerEvents)||""),this.hasProjected&&!Hn(this.latestValues)&&(e.transform=r?r({},""):"none",this.hasProjected=!1),e}const a=s.animationValues||s.latestValues;this.applyTransformsToTarget(),n.transform=function(t,e,i){let n="";const r=t.x.translate/e.x,s=t.y.translate/e.y,a=(null===i||void 0===i?void 0:i.z)||0;if((r||s||a)&&(n=`translate3d(${r}px, ${s}px, ${a}px) `),1===e.x&&1===e.y||(n+=`scale(${1/e.x}, ${1/e.y}) `),i){const{transformPerspective:t,rotate:e,rotateX:r,rotateY:s,skewX:a,skewY:o}=i;t&&(n=`perspective(${t}px) ${n}`),e&&(n+=`rotate(${e}deg) `),r&&(n+=`rotateX(${r}deg) `),s&&(n+=`rotateY(${s}deg) `),a&&(n+=`skewX(${a}deg) `),o&&(n+=`skewY(${o}deg) `)}const o=t.x.scale*e.x,l=t.y.scale*e.y;return 1===o&&1===l||(n+=`scale(${o}, ${l})`),n||"none"}(this.projectionDeltaWithTransform,this.treeScale,a),r&&(n.transform=r(a,n.transform));const{x:o,y:l}=this.projectionDelta;n.transformOrigin=`${100*o.origin}% ${100*l.origin}% 0`,s.animationValues?n.opacity=s===this?null!==(i=null!==(e=a.opacity)&&void 0!==e?e:this.latestValues.opacity)&&void 0!==i?i:1:this.preserveOpacity?this.latestValues.opacity:a.opacityExit:n.opacity=s===this?void 0!==a.opacity?a.opacity:"":void 0!==a.opacityExit?a.opacityExit:0;for(const h in gr){if(void 0===a[h])continue;const{correct:t,applyTo:e,isCSSVariable:i}=gr[h],r="none"===n.transform?a[h]:t(a[h],s);if(e){const t=e.length;for(let i=0;i<t;i++)n[e[i]]=r}else i?this.options.visualElement.renderState.vars[h]=r:n[h]=r}return this.options.layoutId&&(n.pointerEvents=s===this?_r(null===t||void 0===t?void 0:t.pointerEvents)||"":"none"),n}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach((t=>{var e;return null===(e=t.currentAnimation)||void 0===e?void 0:e.stop()})),this.root.nodes.forEach(ls),this.root.sharedNodes.clear()}}}function ns(t){t.updateLayout()}function rs(t){var e;const i=(null===(e=t.resumeFrom)||void 0===e?void 0:e.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&i&&t.hasListeners("didUpdate")){const{layoutBox:e,measuredBox:n}=t.layout,{animationType:r}=t.options,s=i.source!==t.layout.source;"size"===r?Un((t=>{const n=s?i.measuredBox[t]:i.layoutBox[t],r=Pn(n);n.min=e[t].min,n.max=n.min+r})):As(r,i.layoutBox,e)&&Un((n=>{const r=s?i.measuredBox[n]:i.layoutBox[n],a=Pn(e[n]);r.max=r.min+a,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[n].max=t.relativeTarget[n].min+a)}));const a={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};Dn(a,e,i.layoutBox);const o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};s?Dn(o,t.applyTransform(n,!0),i.measuredBox):Dn(o,e,i.layoutBox);const l=!Gr(a);let h=!1;if(!t.resumeFrom){const n=t.getClosestProjectingParent();if(n&&!n.resumeFrom){const{snapshot:r,layout:s}=n;if(r&&s){const a={x:{min:0,max:0},y:{min:0,max:0}};Rn(a,i.layoutBox,r.layoutBox);const o={x:{min:0,max:0},y:{min:0,max:0}};Rn(o,e,s.layoutBox),qr(a,o)||(h=!0),n.options.layoutRoot&&(t.relativeTarget=o,t.relativeTargetOrigin=a,t.relativeParent=n)}}}t.notifyListeners("didUpdate",{layout:e,snapshot:i,delta:o,layoutDelta:a,hasLayoutChanged:l,hasRelativeLayoutChanged:h})}else if(t.isLead()){const{onExitComplete:e}=t.options;e&&e()}t.options.transition=void 0}function ss(t){$.value&&Kr.nodes++,t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=Boolean(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function as(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function os(t){t.clearSnapshot()}function ls(t){t.clearMeasurements()}function hs(t){t.isLayoutDirty=!1}function cs(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function us(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function ds(t){t.resolveTargetDelta()}function ps(t){t.calcProjection()}function fs(t){t.resetSkewAndRotation()}function ms(t){t.removeLeadSnapshot()}function gs(t,e,i){t.translate=ei(e.translate,0,i),t.scale=ei(e.scale,1,i),t.origin=e.origin,t.originPoint=e.originPoint}function vs(t,e,i,n){t.min=ei(e.min,i.min,n),t.max=ei(e.max,i.max,n)}function ys(t){return t.animationValues&&void 0!==t.animationValues.opacityExit}const bs={duration:.45,ease:[.4,0,.1,1]},xs=t=>"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),ws=xs("applewebkit/")&&!xs("chrome/")?Math.round:W;function Ss(t){t.min=ws(t.min),t.max=ws(t.max)}function As(t,e,i){return"position"===t||"preserve-aspect"===t&&(n=Yr(e),r=Yr(i),s=.2,!(Math.abs(n-r)<=s));var n,r,s}function Es(t){var e;return t!==t.root&&(null===(e=t.scroll)||void 0===e?void 0:e.wasRoot)}const _s=is({attachResizeListener:(t,e)=>gn(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Cs={current:void 0},Ms=is({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!Cs.current){const t=new _s({});t.mount(window),t.setOptions({layoutScroll:!0}),Cs.current=t}return Cs.current},resetTransform:(t,e)=>{t.style.transform=void 0!==e?e:"none"},checkIsScrollRoot:t=>Boolean("fixed"===window.getComputedStyle(t).position)}),Ps={pan:{Feature:class extends pn{constructor(){super(...arguments),this.removePointerDownListener=W}onPointerDown(t){this.session=new xn(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:nr(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:e,onPan:i,onPanEnd:n}=this.node.getProps();return{onSessionStart:or(t),onStart:or(e),onMove:i,onEnd:(t,e)=>{delete this.session,n&&et.postRender((()=>n(t,e)))}}}mount(){this.removePointerDownListener=yn(this.node.current,"pointerdown",(t=>this.onPointerDown(t)))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends pn{constructor(t){super(t),this.removeGroupControls=W,this.removeListeners=W,this.controls=new sr(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||W}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:Ms,MeasureLayout:xr}};function Ts(t,e,i){const{props:n}=t;t.animationState&&n.whileHover&&t.animationState.setActive("whileHover","Start"===i);const r=n["onHover"+i];r&&et.postRender((()=>r(e,vn(e))))}function Ds(t,e,i){const{props:n}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&n.whileTap&&t.animationState.setActive("whileTap","Start"===i);const r=n["onTap"+("End"===i?"":i)];r&&et.postRender((()=>r(e,vn(e))))}const ks=new WeakMap,Is=new WeakMap,Rs=t=>{const e=ks.get(t.target);e&&e(t)},Os=t=>{t.forEach(Rs)};function Ls(t,e,i){const n=function(t){let{root:e,...i}=t;const n=e||document;Is.has(n)||Is.set(n,{});const r=Is.get(n),s=JSON.stringify(i);return r[s]||(r[s]=new IntersectionObserver(Os,{root:e,...i})),r[s]}(e);return ks.set(t,i),n.observe(t),()=>{ks.delete(t),n.unobserve(t)}}const Bs={some:0,all:1};const zs={inView:{Feature:class extends pn{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:e,margin:i,amount:n="some",once:r}=t,s={root:e?e.current:void 0,rootMargin:i,threshold:"number"===typeof n?n:Bs[n]};return Ls(this.node.current,s,(t=>{const{isIntersecting:e}=t;if(this.isInView===e)return;if(this.isInView=e,r&&!e&&this.hasEnteredView)return;e&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",e);const{onViewportEnter:i,onViewportLeave:n}=this.node.getProps(),s=e?i:n;s&&s(t)}))}mount(){this.startObserver()}update(){if("undefined"===typeof IntersectionObserver)return;const{props:t,prevProps:e}=this.node,i=["amount","margin","root"].some(function(t){let{viewport:e={}}=t,{viewport:i={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t=>e[t]!==i[t]}(t,e));i&&this.startObserver()}unmount(){}}},tap:{Feature:class extends pn{mount(){const{current:t}=this.node;t&&(this.unmount=j(t,((t,e)=>(Ds(this.node,e,"Start"),(t,e)=>{let{success:i}=e;return Ds(this.node,t,i?"End":"Cancel")})),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}},focus:{Feature:class extends pn{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch(Wk){t=!0}t&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=hi(gn(this.node.current,"focus",(()=>this.onFocus())),gn(this.node.current,"blur",(()=>this.onBlur())))}unmount(){}}},hover:{Feature:class extends pn{mount(){const{current:t}=this.node;t&&(this.unmount=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const[n,r,s]=R(t,i),a=t=>{if(!O(t))return;const{target:i}=t,n=e(i,t);if("function"!==typeof n||!i)return;const s=t=>{O(t)&&(n(t),i.removeEventListener("pointerleave",s))};i.addEventListener("pointerleave",s,r)};return n.forEach((t=>{t.addEventListener("pointerenter",a,r)})),s}(t,((t,e)=>(Ts(this.node,e,"Start"),t=>Ts(this.node,t,"End")))))}unmount(){}}}},Fs={layout:{ProjectionNode:Ms,MeasureLayout:xr}},Ns=(0,t.createContext)({strict:!1}),Us=(0,t.createContext)({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"}),Vs=(0,t.createContext)({});function js(t){return l(t.animate)||rn.some((e=>en(t[e])))}function Gs(t){return Boolean(js(t)||t.variants)}function Hs(e){const{initial:i,animate:n}=function(t,e){if(js(t)){const{initial:e,animate:i}=t;return{initial:!1===e||en(e)?e:void 0,animate:en(i)?i:void 0}}return!1!==t.inherit?e:{}}(e,(0,t.useContext)(Vs));return(0,t.useMemo)((()=>({initial:i,animate:n})),[Ws(i),Ws(n)])}function Ws(t){return Array.isArray(t)?t.join(" "):t}const qs="undefined"!==typeof window,Ys={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Xs={};for(const $2 in Ys)Xs[$2]={isEnabled:t=>Ys[$2].some((e=>!!t[e]))};const Qs=Symbol.for("motionComponentSymbol");function Ks(e,i,n){return(0,t.useCallback)((t=>{t&&e.onMount&&e.onMount(t),i&&(t?i.mount(t):i.unmount()),n&&("function"===typeof n?n(t):Mn(n)&&(n.current=t))}),[i])}const Zs=qs?t.useLayoutEffect:t.useEffect;function Js(e,i,n,r,s){var a,o;const{visualElement:l}=(0,t.useContext)(Vs),h=(0,t.useContext)(Ns),c=(0,t.useContext)(lr),u=(0,t.useContext)(Us).reducedMotion,d=(0,t.useRef)(null);r=r||h.renderer,!d.current&&r&&(d.current=r(e,{visualState:i,parent:l,props:n,presenceContext:c,blockInitialAnimation:!!c&&!1===c.initial,reducedMotionConfig:u}));const p=d.current,f=(0,t.useContext)(ur);!p||p.projection||!s||"html"!==p.type&&"svg"!==p.type||function(t,e,i,n){const{layoutId:r,layout:s,drag:a,dragConstraints:o,layoutScroll:l,layoutRoot:h}=e;t.projection=new i(t.latestValues,e["data-framer-portal-id"]?void 0:$s(t.parent)),t.projection.setOptions({layoutId:r,layout:s,alwaysMeasureLayout:Boolean(a)||o&&Mn(o),visualElement:t,animationType:"string"===typeof s?s:"both",initialPromotionConfig:n,layoutScroll:l,layoutRoot:h})}(d.current,n,s,f);const m=(0,t.useRef)(!1);(0,t.useInsertionEffect)((()=>{p&&m.current&&p.update(n,c)}));const g=n[xt],v=(0,t.useRef)(Boolean(g)&&!(null===(a=window.MotionHandoffIsComplete)||void 0===a?void 0:a.call(window,g))&&(null===(o=window.MotionHasOptimisedAnimation)||void 0===o?void 0:o.call(window,g)));return Zs((()=>{p&&(m.current=!0,window.MotionIsMounted=!0,p.updateFeatures(),vr.render(p.render),v.current&&p.animationState&&p.animationState.animateChanges())})),(0,t.useEffect)((()=>{p&&(!v.current&&p.animationState&&p.animationState.animateChanges(),v.current&&(queueMicrotask((()=>{var t;null===(t=window.MotionHandoffMarkAsComplete)||void 0===t||t.call(window,g)})),v.current=!1))})),p}function $s(t){if(t)return!1!==t.options.allowProjection?t.projection:$s(t.parent)}function ta(e){let{preloadedFeatures:n,createVisualElement:r,useRender:s,useVisualState:a,Component:o}=e;var l,h;function c(e,n){let l;const h={...(0,t.useContext)(Us),...e,layoutId:ea(e)},{isStatic:c}=h,u=Hs(e),d=a(e,c);if(!c&&qs){!function(){(0,t.useContext)(Ns).strict;0}();const e=function(t){const{drag:e,layout:i}=Xs;if(!e&&!i)return{};const n={...e,...i};return{MeasureLayout:(null===e||void 0===e?void 0:e.isEnabled(t))||(null===i||void 0===i?void 0:i.isEnabled(t))?n.MeasureLayout:void 0,ProjectionNode:n.ProjectionNode}}(h);l=e.MeasureLayout,u.visualElement=Js(o,d,h,r,e.ProjectionNode)}return(0,i.jsxs)(Vs.Provider,{value:u,children:[l&&u.visualElement?(0,i.jsx)(l,{visualElement:u.visualElement,...h}):null,s(o,e,Ks(d,u.visualElement,n),d,c,u.visualElement)]})}n&&function(t){for(const e in t)Xs[e]={...Xs[e],...t[e]}}(n),c.displayName=`motion.${"string"===typeof o?o:`create(${null!==(h=null!==(l=o.displayName)&&void 0!==l?l:o.name)&&void 0!==h?h:""})`}`;const u=(0,t.forwardRef)(c);return u[Qs]=o,u}function ea(e){let{layoutId:i}=e;const n=(0,t.useContext)(cr).id;return n&&void 0!==i?n+"-"+i:i}function ia(t,e){let{layout:i,layoutId:n}=e;return Y.has(t)||t.startsWith("origin")||(i||void 0!==n)&&(!!gr[t]||"opacity"===t)}const na=(t,e)=>e&&"number"===typeof t?e.transform(t):t,ra={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},sa=q.length;function aa(t,e,i){const{style:n,vars:r,transformOrigin:s}=t;let a=!1,o=!1;for(const l in e){const t=e[l];if(Y.has(l))a=!0;else if(Ne(l))r[l]=t;else{const e=na(t,ye[l]);l.startsWith("origin")?(o=!0,s[l]=e):n[l]=e}}if(e.transform||(a||i?n.transform=function(t,e,i){let n="",r=!0;for(let s=0;s<sa;s++){const a=q[s],o=t[a];if(void 0===o)continue;let l=!0;if(l="number"===typeof o?o===(a.startsWith("scale")?1:0):0===parseFloat(o),!l||i){const t=na(o,ye[a]);l||(r=!1,n+=`${ra[a]||a}(${t}) `),i&&(e[a]=t)}}return n=n.trim(),i?n=i(e,r?"":n):r&&(n="none"),n}(e,t.transform,i):n.transform&&(n.transform="none")),o){const{originX:t="50%",originY:e="50%",originZ:i=0}=s;n.transformOrigin=`${t} ${e} ${i}`}}const oa=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function la(t,e,i){for(const n in e)vt(e[n])||ia(n,i)||(t[n]=e[n])}function ha(e,i){const n={};return la(n,e.style||{},e),Object.assign(n,function(e,i){let{transformTemplate:n}=e;return(0,t.useMemo)((()=>{const t={style:{},transform:{},transformOrigin:{},vars:{}};return aa(t,i,n),Object.assign({},t.vars,t.style)}),[i])}(e,i)),n}function ca(t,e){const i={},n=ha(t,e);return t.drag&&!1!==t.dragListener&&(i.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=!0===t.drag?"none":"pan-"+("x"===t.drag?"y":"x")),void 0===t.tabIndex&&(t.onTap||t.onTapStart||t.whileTap)&&(i.tabIndex=0),i.style=n,i}const ua=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function da(t){return t.startsWith("while")||t.startsWith("drag")&&"draggable"!==t||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||ua.has(t)}let pa=t=>!da(t);try{(fa=require("@emotion/is-prop-valid").default)&&(pa=t=>t.startsWith("on")?!da(t):fa(t))}catch(pO){}var fa;const ma=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function ga(t){return"string"===typeof t&&!t.includes("-")&&!!(ma.indexOf(t)>-1||/[A-Z]/u.test(t))}const va={offset:"stroke-dashoffset",array:"stroke-dasharray"},ya={offset:"strokeDashoffset",array:"strokeDasharray"};function ba(t,e,i){return"string"===typeof t?t:Kt.transform(e+i*t)}function xa(t,e,i,n){let{attrX:r,attrY:s,attrScale:a,originX:o,originY:l,pathLength:h,pathSpacing:c=1,pathOffset:u=0,...d}=e;if(aa(t,d,n),i)return void(t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox));t.attrs=t.style,t.style={};const{attrs:p,style:f,dimensions:m}=t;p.transform&&(m&&(f.transform=p.transform),delete p.transform),m&&(void 0!==o||void 0!==l||f.transform)&&(f.transformOrigin=function(t,e,i){return`${ba(e,t.x,t.width)} ${ba(i,t.y,t.height)}`}(m,void 0!==o?o:.5,void 0!==l?l:.5)),void 0!==r&&(p.x=r),void 0!==s&&(p.y=s),void 0!==a&&(p.scale=a),void 0!==h&&function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];t.pathLength=1;const s=r?va:ya;t[s.offset]=Kt.transform(-n);const a=Kt.transform(e),o=Kt.transform(i);t[s.array]=`${a} ${o}`}(p,h,c,u,!1)}const wa=()=>({style:{},transform:{},transformOrigin:{},vars:{},attrs:{}}),Sa=t=>"string"===typeof t&&"svg"===t.toLowerCase();function Aa(e,i,n,r){const s=(0,t.useMemo)((()=>{const t={style:{},transform:{},transformOrigin:{},vars:{},attrs:{}};return xa(t,i,Sa(r),e.transformTemplate),{...t.attrs,style:{...t.style}}}),[i]);if(e.style){const t={};la(t,e.style,e),s.style={...t,...s.style}}return s}function Ea(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(i,n,r,s,a)=>{let{latestValues:o}=s;const l=(ga(i)?Aa:ca)(n,o,a,i),h=function(t,e,i){const n={};for(const r in t)"values"===r&&"object"===typeof t.values||(pa(r)||!0===i&&da(r)||!e&&!da(r)||t.draggable&&r.startsWith("onDrag"))&&(n[r]=t[r]);return n}(n,"string"===typeof i,e),c=i!==t.Fragment?{...h,...l,ref:r}:{},{children:u}=n,d=(0,t.useMemo)((()=>vt(u)?u.get():u),[u]);return(0,t.createElement)(i,{...c,children:d})}}function _a(e){const i=(0,t.useRef)(null);return null===i.current&&(i.current=e()),i.current}const Ca=e=>(i,n)=>{const r=(0,t.useContext)(Vs),s=(0,t.useContext)(lr),a=()=>function(t,e,i,n){let{scrapeMotionValuesFromProps:r,createRenderState:s,onUpdate:a}=t;const o={latestValues:Ma(e,i,n,r),renderState:s()};return a&&(o.onMount=t=>a({props:e,current:t,...o}),o.onUpdate=t=>a(t)),o}(e,i,r,s);return n?a():_a(a)};function Ma(t,e,i,n){const r={},s=n(t,{});for(const l in s)r[l]=_r(s[l]);let{initial:a,animate:o}=t;const h=js(t),u=Gs(t);e&&u&&!h&&!1!==t.inherit&&(void 0===a&&(a=e.initial),void 0===o&&(o=e.animate));let d=!!i&&!1===i.initial;d=d||!1===a;const p=d?o:a;if(p&&"boolean"!==typeof p&&!l(p)){const e=Array.isArray(p)?p:[p];for(let i=0;i<e.length;i++){const n=c(t,e[i]);if(n){const{transitionEnd:t,transition:e,...i}=n;for(const n in i){let t=i[n];if(Array.isArray(t)){t=t[d?t.length-1:0]}null!==t&&(r[n]=t)}for(const n in t)r[n]=t[n]}}}return r}function Pa(t,e,i){var n;const{style:r}=t,s={};for(const a in r)(vt(r[a])||e.style&&vt(e.style[a])||ia(a,t)||void 0!==(null===(n=null===i||void 0===i?void 0:i.getValue(a))||void 0===n?void 0:n.liveStyle))&&(s[a]=r[a]);return s}const Ta={useVisualState:Ca({scrapeMotionValuesFromProps:Pa,createRenderState:oa})};function Da(t,e){try{e.dimensions="function"===typeof t.getBBox?t.getBBox():t.getBoundingClientRect()}catch(Wk){e.dimensions={x:0,y:0,width:0,height:0}}}function ka(t,e,i,n){let{style:r,vars:s}=e;Object.assign(t.style,r,n&&n.getProjectionStyles(i));for(const a in s)t.style.setProperty(a,s[a])}const Ia=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Ra(t,e,i,n){ka(t,e,void 0,n);for(const r in e.attrs)t.setAttribute(Ia.has(r)?r:bt(r),e.attrs[r])}function Oa(t,e,i){const n=Pa(t,e,i);for(const r in t)if(vt(t[r])||vt(e[r])){n[-1!==q.indexOf(r)?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r]=t[r]}return n}const La=["x","y","width","height","cx","cy","r"],Ba={useVisualState:Ca({scrapeMotionValuesFromProps:Oa,createRenderState:wa,onUpdate:t=>{let{props:e,prevProps:i,current:n,renderState:r,latestValues:s}=t;if(!n)return;let a=!!e.drag;if(!a)for(const l in s)if(Y.has(l)){a=!0;break}if(!a)return;let o=!i;if(i)for(let l=0;l<La.length;l++){const t=La[l];e[t]!==i[t]&&(o=!0)}o&&et.read((()=>{Da(n,r),et.render((()=>{xa(r,s,Sa(n.tagName),e.transformTemplate),Ra(n,r)}))}))}})};function za(t,e){return function(i){let{forwardMotionProps:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{forwardMotionProps:!1};return ta({...ga(i)?Ba:Ta,preloadedFeatures:t,useRender:Ea(n),createVisualElement:e,Component:i})}}const Fa={current:null},Na={current:!1};const Ua=[...qe,ee,ce],Va=new WeakMap;const ja=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Ga{scrapeMotionValuesFromProps(t,e,i){return{}}constructor(t){let{parent:e,props:i,presenceContext:n,reducedMotionConfig:r,blockInitialAnimation:s,visualState:a}=t,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Oe,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const t=ot.now();this.renderScheduledAt<t&&(this.renderScheduledAt=t,et.render(this.render,!1,!0))};const{latestValues:l,renderState:h,onUpdate:c}=a;this.onUpdate=c,this.latestValues=l,this.baseTarget={...l},this.initialValues=i.initial?{...l}:{},this.renderState=h,this.parent=e,this.props=i,this.presenceContext=n,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=o,this.blockInitialAnimation=Boolean(s),this.isControllingVariants=js(i),this.isVariantNode=Gs(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(e&&e.current);const{willChange:u,...d}=this.scrapeMotionValuesFromProps(i,{},this);for(const p in d){const t=d[p];void 0!==l[p]&&vt(t)&&t.set(l[p],!1)}}mount(t){this.current=t,Va.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach(((t,e)=>this.bindToMotionValue(e,t))),Na.current||function(){if(Na.current=!0,qs)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>Fa.current=t.matches;t.addListener(e),e()}else Fa.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||Fa.current),this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),it(this.notifyUpdate),it(this.render),this.valueSubscriptions.forEach((t=>t())),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const e=this.features[t];e&&(e.unmount(),e.isMounted=!1)}this.current=null}bindToMotionValue(t,e){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const i=Y.has(t);i&&this.onBindTransform&&this.onBindTransform();const n=e.on("change",(e=>{this.latestValues[t]=e,this.props.onUpdate&&et.preRender(this.notifyUpdate),i&&this.projection&&(this.projection.isTransformDirty=!0)})),r=e.on("renderRequest",this.scheduleRender);let s;window.MotionCheckAppearSync&&(s=window.MotionCheckAppearSync(this,t,e)),this.valueSubscriptions.set(t,(()=>{n(),r(),s&&s(),e.owner&&e.stop()}))}sortNodePosition(t){return this.current&&this.sortInstanceNodePosition&&this.type===t.type?this.sortInstanceNodePosition(this.current,t.current):0}updateFeatures(){let t="animation";for(t in Xs){const e=Xs[t];if(!e)continue;const{isEnabled:i,Feature:n}=e;if(!this.features[t]&&n&&i(this.props)&&(this.features[t]=new n(this)),this.features[t]){const e=this.features[t];e.isMounted?e.update():(e.mount(),e.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,e){this.latestValues[t]=e}update(t,e){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=e;for(let i=0;i<ja.length;i++){const e=ja[i];this.propEventSubscriptions[e]&&(this.propEventSubscriptions[e](),delete this.propEventSubscriptions[e]);const n=t["on"+e];n&&(this.propEventSubscriptions[e]=this.on(e,n))}this.prevMotionValues=function(t,e,i){for(const n in e){const r=e[n],s=i[n];if(vt(r))t.addValue(n,r);else if(vt(s))t.addValue(n,ft(r,{owner:t}));else if(s!==r)if(t.hasValue(n)){const e=t.getValue(n);!0===e.liveStyle?e.jump(r):e.hasAnimated||e.set(r)}else{const e=t.getStaticValue(n);t.addValue(n,ft(void 0!==e?e:r,{owner:t}))}}for(const n in i)void 0===e[n]&&t.removeValue(n);return e}(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const e=this.getClosestVariantNode();if(e)return e.variantChildren&&e.variantChildren.add(t),()=>e.variantChildren.delete(t)}addValue(t,e){const i=this.values.get(t);e!==i&&(i&&this.removeValue(t),this.bindToMotionValue(t,e),this.values.set(t,e),this.latestValues[t]=e.get())}removeValue(t){this.values.delete(t);const e=this.valueSubscriptions.get(t);e&&(e(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,e){if(this.props.values&&this.props.values[t])return this.props.values[t];let i=this.values.get(t);return void 0===i&&void 0!==e&&(i=ft(null===e?void 0:e,{owner:this}),this.addValue(t,i)),i}readValue(t,e){var i;let n=void 0===this.latestValues[t]&&this.current?null!==(i=this.getBaseTargetFromProps(this.props,t))&&void 0!==i?i:this.readValueFromInstance(this.current,t,this.options):this.latestValues[t];var r;return void 0!==n&&null!==n&&("string"===typeof n&&(ze(n)||Ot(n))?n=parseFloat(n):(r=n,!Ua.find(We(r))&&ce.test(e)&&(n=we(t,e))),this.setBaseTarget(t,vt(n)?n.get():n)),vt(n)?n.get():n}setBaseTarget(t,e){this.baseTarget[t]=e}getBaseTarget(t){var e;const{initial:i}=this.props;let n;if("string"===typeof i||"object"===typeof i){const r=c(this.props,i,null===(e=this.presenceContext)||void 0===e?void 0:e.custom);r&&(n=r[t])}if(i&&void 0!==n)return n;const r=this.getBaseTargetFromProps(this.props,t);return void 0===r||vt(r)?void 0!==this.initialValues[t]&&void 0===n?void 0:this.baseTarget[t]:r}on(t,e){return this.events[t]||(this.events[t]=new ct),this.events[t].add(e)}notify(t){if(this.events[t]){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];this.events[t].notify(...i)}}}class Ha extends Ga{constructor(){super(...arguments),this.KeyframeResolver=Xe}sortInstanceNodePosition(t,e){return 2&t.compareDocumentPosition(e)?1:-1}getBaseTargetFromProps(t,e){return t.style?t.style[e]:void 0}removeValueFromRenderState(t,e){let{vars:i,style:n}=e;delete i[t],delete n[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;vt(t)&&(this.childSubscription=t.on("change",(t=>{this.current&&(this.current.textContent=`${t}`)})))}}class Wa extends Ha{constructor(){super(...arguments),this.type="html",this.renderInstance=ka}readValueFromInstance(t,e){if(Y.has(e)){const t=xe(e);return t&&t.default||0}{const n=(i=t,window.getComputedStyle(i)),r=(Ne(e)?n.getPropertyValue(e):n[e])||0;return"string"===typeof r?r.trim():r}var i}measureInstanceViewportBox(t,e){let{transformPagePoint:i}=e;return ir(t,i)}build(t,e,i){aa(t,e,i.transformTemplate)}scrapeMotionValuesFromProps(t,e,i){return Pa(t,e,i)}}class qa extends Ha{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Nn,this.updateDimensions=()=>{this.current&&!this.renderState.dimensions&&Da(this.current,this.renderState)}}getBaseTargetFromProps(t,e){return t[e]}readValueFromInstance(t,e){if(Y.has(e)){const t=xe(e);return t&&t.default||0}return e=Ia.has(e)?e:bt(e),t.getAttribute(e)}scrapeMotionValuesFromProps(t,e,i){return Oa(t,e,i)}onBindTransform(){this.current&&!this.renderState.dimensions&&et.postRender(this.updateDimensions)}build(t,e,i){xa(t,e,this.isSVGTag,i.transformTemplate)}renderInstance(t,e,i,n){Ra(t,e,0,n)}mount(t){this.isSVGTag=Sa(t.tagName),super.mount(t)}}const Ya=o(za({...mn,...zs,...Ps,...Fs},((e,i)=>ga(e)?new qa(i):new Wa(i,{allowProjection:e!==t.Fragment})))),Xa=e=>{let{contactRef:n}=e;const r=(0,t.useRef)(),[o,l]=(0,t.useState)(0),[h,c]=(0,t.useState)(!1),[u,d]=(0,t.useState)(""),[p,f]=(0,t.useState)(200-100*Math.random()),m=["Meryem Khayati"," a Computing Student"," a Web Developer"];(0,t.useEffect)((()=>{let t=setInterval((()=>{g()}),p);return()=>clearInterval(t)}),[u]);const g=()=>{let t=m[o%m.length],e=h?t.substring(0,u.length-1):t.substring(0,u.length+1);d(e),h&&f((t=>t/2)),h||e!==t?h&&""===e&&(c(!1),l(o+1),f(500)):(c(!0),f(2e3))};return(0,i.jsxs)("section",{className:"hero flex ",children:[(0,i.jsxs)("div",{className:"left-section",children:[(0,i.jsx)(Ya.h1,{initial:{opacity:0},animate:{opacity:1},transition:{duration:2},className:"title",children:"Hello! I'm"}),(0,i.jsx)(Ya.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:2},className:"typewriter-container",children:(0,i.jsx)("strong",{className:"typewriter title",children:u})}),(0,i.jsx)("p",{className:"sub-title specific",children:"Passionate about crafting intuitive, efficient, and modern digital solutions. Constantly learning and innovating to transform ideas into impactful experiences."}),(0,i.jsx)("div",{className:"all-icons flex",children:(0,i.jsx)("a",{href:"#",className:"contact-button",onClick:t=>{var e;t.preventDefault(),(e=n)&&e.current&&e.current.scrollIntoView({behavior:"smooth"})},children:"Contact Me"})})]}),(0,i.jsx)("div",{className:"right-section animation",children:(0,i.jsx)(s(),{lottieRef:r,onLoadedImages:()=>{r.current.setSpeed(.5)},animationData:a})})]})};class Qa extends t.Component{getSnapshotBeforeUpdate(t){const e=this.props.childRef.current;if(e&&t.isPresent&&!this.props.isPresent){const t=e.offsetParent,i=t instanceof HTMLElement&&t.offsetWidth||0,n=this.props.sizeRef.current;n.height=e.offsetHeight||0,n.width=e.offsetWidth||0,n.top=e.offsetTop,n.left=e.offsetLeft,n.right=i-n.width-n.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Ka(e){let{children:n,isPresent:r,anchorX:s}=e;const a=(0,t.useId)(),o=(0,t.useRef)(null),l=(0,t.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:h}=(0,t.useContext)(Us);return(0,t.useInsertionEffect)((()=>{const{width:t,height:e,top:i,left:n,right:c}=l.current;if(r||!o.current||!t||!e)return;const u="left"===s?`left: ${n}`:`right: ${c}`;o.current.dataset.motionPopId=a;const d=document.createElement("style");return h&&(d.nonce=h),document.head.appendChild(d),d.sheet&&d.sheet.insertRule(`\n          [data-motion-pop-id="${a}"] {\n            position: absolute !important;\n            width: ${t}px !important;\n            height: ${e}px !important;\n            ${u}px !important;\n            top: ${i}px !important;\n          }\n        `),()=>{document.head.removeChild(d)}}),[r]),(0,i.jsx)(Qa,{isPresent:r,childRef:o,sizeRef:l,children:t.cloneElement(n,{ref:o})})}const Za=e=>{let{children:n,initial:r,isPresent:s,onExitComplete:a,custom:o,presenceAffectsLayout:l,mode:h,anchorX:c}=e;const u=_a(Ja),d=(0,t.useId)(),p=(0,t.useCallback)((t=>{u.set(t,!0);for(const e of u.values())if(!e)return;a&&a()}),[u,a]),f=(0,t.useMemo)((()=>({id:d,initial:r,isPresent:s,custom:o,onExitComplete:p,register:t=>(u.set(t,!1),()=>u.delete(t))})),l?[Math.random(),p]:[s,p]);return(0,t.useMemo)((()=>{u.forEach(((t,e)=>u.set(e,!1)))}),[s]),t.useEffect((()=>{!s&&!u.size&&a&&a()}),[s]),"popLayout"===h&&(n=(0,i.jsx)(Ka,{isPresent:s,anchorX:c,children:n})),(0,i.jsx)(lr.Provider,{value:f,children:n})};function Ja(){return new Map}const $a=t=>t.key||"";function to(e){const i=[];return t.Children.forEach(e,(e=>{(0,t.isValidElement)(e)&&i.push(e)})),i}const eo=e=>{let{children:n,custom:r,initial:s=!0,onExitComplete:a,presenceAffectsLayout:o=!0,mode:l="sync",propagate:h=!1,anchorX:c="left"}=e;const[u,d]=hr(h),p=(0,t.useMemo)((()=>to(n)),[n]),f=h&&!u?[]:p.map($a),m=(0,t.useRef)(!0),g=(0,t.useRef)(p),v=_a((()=>new Map)),[y,b]=(0,t.useState)(p),[x,w]=(0,t.useState)(p);Zs((()=>{m.current=!1,g.current=p;for(let t=0;t<x.length;t++){const e=$a(x[t]);f.includes(e)?v.delete(e):!0!==v.get(e)&&v.set(e,!1)}}),[x,f.length,f.join("-")]);const S=[];if(p!==y){let t=[...p];for(let e=0;e<x.length;e++){const i=x[e],n=$a(i);f.includes(n)||(t.splice(e,0,i),S.push(i))}return"wait"===l&&S.length&&(t=S),w(to(t)),b(p),null}const{forceRender:A}=(0,t.useContext)(cr);return(0,i.jsx)(i.Fragment,{children:x.map((t=>{const e=$a(t),n=!(h&&!u)&&(p===x||f.includes(e));return(0,i.jsx)(Za,{isPresent:n,initial:!(m.current&&!s)&&void 0,custom:r,presenceAffectsLayout:o,mode:l,onExitComplete:n?void 0:()=>{if(!v.has(e))return;v.set(e,!0);let t=!0;v.forEach((e=>{e||(t=!1)})),t&&(null===A||void 0===A||A(),w(g.current),h&&(null===d||void 0===d||d()),a&&a())},anchorX:c,children:t},e)}))})};var io={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},no=t.createContext&&t.createContext(io),ro=["attr","size","title"];function so(t,e){if(null==t)return{};var i,n,r=function(t,e){if(null==t)return{};var i={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;i[n]=t[n]}return i}(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(n=0;n<s.length;n++)i=s[n],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(r[i]=t[i])}return r}function ao(){return ao=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},ao.apply(this,arguments)}function oo(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function lo(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?oo(Object(i),!0).forEach((function(e){ho(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):oo(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function ho(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function co(e){return e&&e.map(((e,i)=>t.createElement(e.tag,lo({key:i},e.attr),co(e.child))))}function uo(e){return i=>t.createElement(po,ao({attr:lo({},e.attr)},i),co(e.child))}function po(e){var i=i=>{var n,{attr:r,size:s,title:a}=e,o=so(e,ro),l=s||i.size||"1em";return i.className&&(n=i.className),e.className&&(n=(n?n+" ":"")+e.className),t.createElement("svg",ao({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},i.attr,r,o,{className:n,style:lo(lo({color:e.color||i.color},i.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),a&&t.createElement("title",null,a),e.children)};return void 0!==no?t.createElement(no.Consumer,null,(t=>i(t))):i(io)}function fo(t){return uo({tag:"svg",attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"},child:[]}]})(t)}function mo(t){return uo({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"},child:[]}]})(t)}function go(t){return uo({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"},child:[]}]})(t)}function vo(t){return uo({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M497.39 361.8l-112-48a24 24 0 0 0-28 6.9l-49.6 60.6A370.66 370.66 0 0 1 130.6 204.11l60.6-49.6a23.94 23.94 0 0 0 6.9-28l-48-112A24.16 24.16 0 0 0 122.6.61l-104 24A24 24 0 0 0 0 48c0 256.5 207.9 464 464 464a24 24 0 0 0 23.4-18.6l24-104a24.29 24.29 0 0 0-14.01-27.6z"},child:[]}]})(t)}const yo=[{title:"Web Application for Institution Management:",description:"A web application built with React and Spring Boot for managing educational institution data.",images:[__webpack_require__.p+"static/media/p11.969e004f040ea61ac46c.jpg",__webpack_require__.p+"static/media/p12.fbe55c4fe65eda6dd388.jpg",__webpack_require__.p+"static/media/p13.bd32c56c954aef9b0a64.jpg",__webpack_require__.p+"static/media/p14.7afc2db452c237b12b51.jpg",__webpack_require__.p+"static/media/p15.11b03fd1709d1f4ce005.jpg"],github:"https://github.com/Meryem-Khayati/Web-Application-for-Institution-Management"},{title:"Web Application for Managing Electronic Correspondence",description:"A web application built with Spring Boot and React to manage electronic correspondence",images:[__webpack_require__.p+"static/media/AA.70adf81bd9dcf885d184.mp4"],github:"https://github.com/Meryem-Khayati/Web-Application-for-Managing-Electronic-Correspondence-"},{title:"Website for Managing Student Document Requests",description:"A website built with WordPress for managing student document requests with the administration.",images:[__webpack_require__.p+"static/media/p21.340fdedbcb26ef86d4f1.jpg",__webpack_require__.p+"static/media/p22.df89435275161c27df8f.jpg",__webpack_require__.p+"static/media/p23.71aa91ebb6a335d83159.jpg",__webpack_require__.p+"static/media/p24.664108c501c58cb40aef.jpg",__webpack_require__.p+"static/media/p25.82120a4c73a3537a4489.jpg",__webpack_require__.p+"static/media/p26.76ed8b6e7a2ac97c945b.jpg"],github:"https://github.com/Meryem-Khayati/Website-for-Managing-Student-Document-Requests"},{title:"UserCityManager",description:"A web application built with JEE for simplified management of user and city data, allowing administrators to add, edit, and delete records efficiently.",images:[__webpack_require__.p+"static/media/p31.f5540a72bbd366b1ec6c.jpg",__webpack_require__.p+"static/media/p32.0ea8472bd93b49d328a0.jpg",__webpack_require__.p+"static/media/p33.bdf5f76ab5e6b724cf18.jpg",__webpack_require__.p+"static/media/p34.7b1f8743716a6bdb9356.jpg"],github:"https://github.com/Meryem-Khayati/UserCityManager"}];function bo(){const[e,n]=(0,t.useState)(null),[r,s]=(0,t.useState)(0);return(0,i.jsxs)("div",{className:"text-white p-6 rounded-lg w-full max-w-5xl mx-auto mb-8",children:[(0,i.jsx)("h2",{className:"font-bold text-center mb-14",children:"My Projects"}),(0,i.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-10",children:yo.map(((t,e)=>(0,i.jsxs)(Ya.div,{className:"border-2 border-indigo-900 p-4 rounded-xl shadow-lg flex flex-col items-center",whileHover:{scale:1.05},children:[(0,i.jsx)("h3",{className:"text-xl text-gray-400 font-semibold m-5 text-center",children:t.title}),(0,i.jsx)("p",{className:"text-xm text-gray-400 text-center",children:t.description}),(0,i.jsxs)("div",{className:"flex items-center gap-4 mt-4",children:[(0,i.jsx)("button",{className:"px-4 py-2 text-purple-400 hover:bg-purple-900 border-2 border-purple-900 p-4 rounded-xl",onClick:()=>{n(t),s(0)},children:"View More"}),(0,i.jsx)("a",{href:t.github,target:"_blank",rel:"noopener noreferrer",className:"text-purple-400 hover:text-purple-950 text-4xl",children:(0,i.jsx)(fo,{})})]})]},e)))}),e&&(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center",children:(0,i.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg shadow-lg max-w-md relative",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-center",children:e.title}),(0,i.jsxs)("div",{className:"mt-4 flex justify-center items-center relative",children:[(0,i.jsx)("button",{className:"absolute left-0 bg-gray-700 p-2 rounded-full",onClick:()=>{s((t=>0===t?e.images.length-1:t-1))},children:"\u25c0"}),(0,i.jsx)(eo,{mode:"wait",children:(0,i.jsx)(eo,{mode:"wait",children:e.images[r].endsWith(".mp4")?(0,i.jsx)(Ya.video,{src:e.images[r],controls:!0,className:"rounded-lg w-full",initial:{opacity:0,x:100},animate:{opacity:1,x:0},exit:{opacity:0,x:-100},transition:{duration:.5}},e.images[r]):(0,i.jsx)(Ya.img,{src:e.images[r],alt:"Project",className:"rounded-lg w-full",initial:{opacity:0,x:100},animate:{opacity:1,x:0},exit:{opacity:0,x:-100},transition:{duration:.5}},e.images[r])})}),(0,i.jsx)("button",{className:"absolute right-0 bg-gray-700 p-2 rounded-full",onClick:()=>{s((t=>t===e.images.length-1?0:t+1))},children:"\u25b6"})]}),(0,i.jsx)("button",{className:"mt-4 w-full px-4 py-2 bg-blue-950 text-white rounded-lg hover:bg-blue-900",onClick:()=>n(null),children:"Close"})]})})]})}function xo(t){return uo({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"},child:[]},{tag:"polyline",attr:{points:"7 10 12 15 17 10"},child:[]},{tag:"line",attr:{x1:"12",y1:"15",x2:"12",y2:"3"},child:[]}]})(t)}function wo(t){return uo({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"22",y1:"2",x2:"11",y2:"13"},child:[]},{tag:"polygon",attr:{points:"22 2 15 22 11 13 2 9 22 2"},child:[]}]})(t)}const So=__webpack_require__.p+"static/media/CV_MeryemKhayati.4a9e1f37537fcf766e30.pdf";function Ao(){const[e,n]=(0,t.useState)(!1),[r,s]=(0,t.useState)(null),a=So;return(0,t.useEffect)((()=>{fetch(a).then((t=>t.blob())).then((t=>{console.log("Blob Info:",t);const e=(t.size/1048576).toFixed(2);s(e)})).catch((t=>console.error("Erreur de r\xe9cup\xe9ration du fichier :",t)))}),[]),(0,i.jsx)("section",{className:"skill",id:"skills",children:(0,i.jsxs)(Ya.div,{className:"skill-bx wow zoomIn",whileInView:{opacity:1,x:0},initial:{opacity:0,x:-100},transition:{duration:1,ease:"easeOut"},viewport:{once:!1,amount:.2},children:[(0,i.jsx)("h2",{children:"About Me"}),(0,i.jsxs)("p",{children:["I'm a Computer Engineering student passionate about web technologies and AI.",(0,i.jsx)("br",{}),"I love creating intuitive, efficient, and modern digital experiences. Always ",(0,i.jsx)("br",{}),"learning, building, and exploring new ways to turn ideas ",(0,i.jsx)("br",{}),"into impactful digital solutions. ",(0,i.jsx)("br",{})]}),(0,i.jsxs)("div",{className:"download-container",onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),children:[e&&r&&(0,i.jsxs)("div",{className:"tooltip",children:["Size: ",r," MB"]}),(0,i.jsx)(Ya.a,{href:a,download:!0,className:"download-btn "+(e?"hovered":""),whileHover:{scale:1.1},whileTap:{scale:.9},children:e?(0,i.jsx)(xo,{size:24}):"Download CV"})]})]})})}const Eo="generated",_o="pointerleave",Co="pointermove",Mo="touchend",Po="tsParticles - Error";class To{constructor(t,e,i){if(this._updateFromAngle=(t,e)=>{this.x=Math.cos(t)*e,this.y=Math.sin(t)*e},!bl(t)&&t){this.x=t.x,this.y=t.y;const e=t;this.z=e.z?e.z:0}else{if(void 0===t||void 0===e)throw new Error(`${Po} Vector3d not initialized correctly`);this.x=t,this.y=e,this.z=i??0}}static get origin(){return To.create(0,0,0)}get angle(){return Math.atan2(this.y,this.x)}set angle(t){this._updateFromAngle(t,this.length)}get length(){return Math.sqrt(this.getLengthSq())}set length(t){this._updateFromAngle(this.angle,t)}static clone(t){return To.create(t.x,t.y,t.z)}static create(t,e,i){return new To(t,e,i)}add(t){return To.create(this.x+t.x,this.y+t.y,this.z+t.z)}addTo(t){this.x+=t.x,this.y+=t.y,this.z+=t.z}copy(){return To.clone(this)}distanceTo(t){return this.sub(t).length}distanceToSq(t){return this.sub(t).getLengthSq()}div(t){return To.create(this.x/t,this.y/t,this.z/t)}divTo(t){this.x/=t,this.y/=t,this.z/=t}getLengthSq(){return this.x**2+this.y**2}mult(t){return To.create(this.x*t,this.y*t,this.z*t)}multTo(t){this.x*=t,this.y*=t,this.z*=t}normalize(){const t=this.length;0!=t&&this.multTo(1/t)}rotate(t){return To.create(this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t),0)}setTo(t){this.x=t.x,this.y=t.y;const e=t;this.z=e.z?e.z:0}sub(t){return To.create(this.x-t.x,this.y-t.y,this.z-t.z)}subFrom(t){this.x-=t.x,this.y-=t.y,this.z-=t.z}}class Do extends To{constructor(t,e){super(t,e,0)}static get origin(){return Do.create(0,0)}static clone(t){return Do.create(t.x,t.y)}static create(t,e){return new Do(t,e)}}let ko=Math.random;const Io=new Map;function Ro(t,e){Io.get(t)||Io.set(t,e)}function Oo(t){return Io.get(t)||(t=>t)}function Lo(){return Bo(ko(),0,1-1e-16)}function Bo(t,e,i){return Math.min(Math.max(t,e),i)}function zo(t,e,i,n){return Math.floor((t*i+e*n)/(i+n))}function Fo(t){const e=Vo(t);let i=Uo(t);return e===i&&(i=0),Lo()*(e-i)+i}function No(t){return bl(t)?t:Fo(t)}function Uo(t){return bl(t)?t:t.min}function Vo(t){return bl(t)?t:t.max}function jo(t,e){if(t===e||void 0===e&&bl(t))return t;const i=Uo(t),n=Vo(t);return void 0!==e?{min:Math.min(i,e),max:Math.max(n,e)}:jo(i,n)}function Go(t){const e=t.random,{enable:i,minimumValue:n}=vl(e)?{enable:e,minimumValue:0}:e;return No(i?jo(t.value,n):t.value)}function Ho(t,e){const i=t.x-e.x,n=t.y-e.y;return{dx:i,dy:n,distance:Math.sqrt(i**2+n**2)}}function Wo(t,e){return Ho(t,e).distance}function qo(t,e,i,n){return Do.create(t.x*(i-n)/(i+n)+2*e.x*n/(i+n),t.y)}function Yo(t){return{x:t.position?.x??Lo()*t.size.width,y:t.position?.y??Lo()*t.size.height}}function Xo(t){return t?t.endsWith("%")?parseFloat(t)/100:parseFloat(t):1}const Qo={debug:console.debug,error:console.error,info:console.info,log:console.log,verbose:console.log,warning:console.warn};function Ko(){return Qo}function Zo(t){const e={bounced:!1},{pSide:i,pOtherSide:n,rectSide:r,rectOtherSide:s,velocity:a,factor:o}=t;return n.min<s.min||n.min>s.max||n.max<s.min||n.max>s.max||(i.max>=r.min&&i.max<=(r.max+r.min)/2&&a>0||i.min<=r.max&&i.min>(r.max+r.min)/2&&a<0)&&(e.velocity=a*-o,e.bounced=!0),e}function Jo(){return"undefined"===typeof window||!window||"undefined"===typeof window.document||!window.document}function $o(t){if(!Jo()&&"undefined"!==typeof matchMedia)return matchMedia(t)}function tl(t,e){return t===e||Sl(e)&&e.indexOf(t)>-1}function el(t,e){return t[void 0!==e&&(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])?e%t.length:function(t){return Math.floor(Lo()*t.length)}(t)]}function il(t,e,i,n,r){return function(t,e,i,n){let r=!0;n&&"bottom"!==n||(r=t.top<e.height+i.x);!r||n&&"left"!==n||(r=t.right>i.x);!r||n&&"right"!==n||(r=t.left<e.width+i.y);!r||n&&"top"!==n||(r=t.bottom>i.y);return r}(nl(t,n??0),e,i,r)}function nl(t,e){return{bottom:t.y+e,left:t.x-e,right:t.x+e,top:t.y-e}}function rl(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(const r of i){if(void 0===r||null===r)continue;if(!wl(r)){t=r;continue}const e=Array.isArray(r);!e||!wl(t)&&t&&Array.isArray(t)?e||!wl(t)&&t&&!Array.isArray(t)||(t={}):t=[];for(const i in r){if("__proto__"===i)continue;const e=r[i],n=t;n[i]=wl(e)&&Array.isArray(e)?e.map((t=>rl(n[i],t))):rl(n[i],e)}}return t}function sl(t,e){return!!pl(e,(e=>e.enable&&tl(t,e.mode)))}function al(t,e,i){ul(e,(e=>{const n=e.mode;e.enable&&tl(t,n)&&function(t,e){const i=t.selectors;ul(i,(i=>{e(i,t)}))}(e,i)}))}function ol(t,e){if(e&&t)return pl(t,(t=>function(t,e){const i=ul(e,(e=>t.matches(e)));return Sl(i)?i.some((t=>t)):i}(e,t.selectors)))}function ll(t){return{position:t.getPosition(),radius:t.getRadius(),mass:t.getMass(),velocity:t.velocity,factor:Do.create(Go(t.options.bounce.horizontal),Go(t.options.bounce.vertical))}}function hl(t,e){const{x:i,y:n}=t.velocity.sub(e.velocity),[r,s]=[t.position,e.position],{dx:a,dy:o}=Ho(s,r);if(i*a+n*o<0)return;const l=-Math.atan2(o,a),h=t.mass,c=e.mass,u=t.velocity.rotate(l),d=e.velocity.rotate(l),p=qo(u,d,h,c),f=qo(d,u,h,c),m=p.rotate(-l),g=f.rotate(-l);t.velocity.x=m.x*t.factor.x,t.velocity.y=m.y*t.factor.y,e.velocity.x=g.x*e.factor.x,e.velocity.y=g.y*e.factor.y}function cl(t,e){const i=nl(t.getPosition(),t.getRadius()),n=Zo({pSide:{min:i.left,max:i.right},pOtherSide:{min:i.top,max:i.bottom},rectSide:{min:e.left,max:e.right},rectOtherSide:{min:e.top,max:e.bottom},velocity:t.velocity.x,factor:Go(t.options.bounce.horizontal)});n.bounced&&(void 0!==n.velocity&&(t.velocity.x=n.velocity),void 0!==n.position&&(t.position.x=n.position));const r=Zo({pSide:{min:i.top,max:i.bottom},pOtherSide:{min:i.left,max:i.right},rectSide:{min:e.top,max:e.bottom},rectOtherSide:{min:e.left,max:e.right},velocity:t.velocity.y,factor:Go(t.options.bounce.vertical)});r.bounced&&(void 0!==r.velocity&&(t.velocity.y=r.velocity),void 0!==r.position&&(t.position.y=r.position))}function ul(t,e){return Sl(t)?t.map(((t,i)=>e(t,i))):e(t,0)}function dl(t,e,i){return Sl(t)?el(t,e,i):t}function pl(t,e){return Sl(t)?t.find(((t,i)=>e(t,i))):e(t,0)?t:void 0}function fl(t,e){const i=t.value,n=t.animation,r={delayTime:1e3*No(n.delay),enable:n.enable,value:No(t.value)*e,max:Vo(i)*e,min:Uo(i)*e,loops:0,maxLoops:No(n.count),time:0};if(n.enable){switch(r.decay=1-No(n.decay),n.mode){case"increase":r.status="increasing";break;case"decrease":r.status="decreasing";break;case"random":r.status=Lo()>=.5?"increasing":"decreasing"}const t="auto"===n.mode;switch(n.startValue){case"min":r.value=r.min,t&&(r.status="increasing");break;case"max":r.value=r.max,t&&(r.status="decreasing");break;default:r.value=Fo(r),t&&(r.status=Lo()>=.5?"increasing":"decreasing")}}return r.initialValue=r.value,r}function ml(t,e){if(!("percent"===t.mode)){const{mode:e,...i}=t;return i}return"x"in t?{x:t.x/100*e.width,y:t.y/100*e.height}:{width:t.width/100*e.width,height:t.height/100*e.height}}function gl(t,e){return ml(t,e)}function vl(t){return"boolean"===typeof t}function yl(t){return"string"===typeof t}function bl(t){return"number"===typeof t}function xl(t){return"function"===typeof t}function wl(t){return"object"===typeof t&&null!==t}function Sl(t){return Array.isArray(t)}const Al="random",El="mid",_l=new Map;function Cl(t){_l.set(t.key,t)}function Ml(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}function Pl(t){for(const[,n]of _l)if(t.startsWith(n.stringPrefix))return n.parseString(t);const e=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])([a-f\d])?$/i,((t,e,i,n,r)=>e+e+i+i+n+n+(void 0!==r?r+r:""))),i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(e);return i?{a:void 0!==i[4]?parseInt(i[4],16)/255:1,b:parseInt(i[3],16),g:parseInt(i[2],16),r:parseInt(i[1],16)}:void 0}function Tl(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t)return;const n=yl(t)?{value:t}:t;if(yl(n.value))return Dl(n.value,e,i);if(Sl(n.value))return Tl({value:el(n.value,e,i)});for(const[,r]of _l){const t=r.handleRangeColor(n);if(t)return t}}function Dl(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t)return;const n=yl(t)?{value:t}:t;if(yl(n.value))return n.value===Al?Ol():function(t){return Pl(t)}(n.value);if(Sl(n.value))return Dl({value:el(n.value,e,i)});for(const[,r]of _l){const t=r.handleColor(n);if(t)return t}}function kl(t,e){const i=Tl(t,e,!(arguments.length>2&&void 0!==arguments[2])||arguments[2]);return i?Il(i):void 0}function Il(t){const e=t.r/255,i=t.g/255,n=t.b/255,r=Math.max(e,i,n),s=Math.min(e,i,n),a={h:0,l:(r+s)/2,s:0};return r!==s&&(a.s=a.l<.5?(r-s)/(r+s):(r-s)/(2-r-s),a.h=e===r?(i-n)/(r-s):a.h=i===r?2+(n-e)/(r-s):4+(e-i)/(r-s)),a.l*=100,a.s*=100,a.h*=60,a.h<0&&(a.h+=360),a.h>=360&&(a.h-=360),a}function Rl(t){const e={b:0,g:0,r:0},i={h:t.h/360,l:t.l/100,s:t.s/100};if(i.s){const t=i.l<.5?i.l*(1+i.s):i.l+i.s-i.l*i.s,n=2*i.l-t;e.r=Ml(n,t,i.h+1/3),e.g=Ml(n,t,i.h),e.b=Ml(n,t,i.h-1/3)}else e.r=e.g=e.b=i.l;return e.r=Math.floor(255*e.r),e.g=Math.floor(255*e.g),e.b=Math.floor(255*e.b),e}function Ol(t){const e=t??0;return{b:Math.floor(Fo(jo(e,256))),g:Math.floor(Fo(jo(e,256))),r:Math.floor(Fo(jo(e,256)))}}function Ll(t,e){return`rgba(${t.r}, ${t.g}, ${t.b}, ${e??1})`}function Bl(t,e){return`hsla(${t.h}, ${t.s}%, ${t.l}%, ${e??1})`}function zl(t,e,i,n){let r=t,s=e;return void 0===r.r&&(r=Rl(t)),void 0===s.r&&(s=Rl(e)),{b:zo(r.b,s.b,i,n),g:zo(r.g,s.g,i,n),r:zo(r.r,s.r,i,n)}}function Fl(t,e,i){if(i===Al)return Ol();if(i!==El)return i;{const i=t.getFillColor()??t.getStrokeColor(),n=e?.getFillColor()??e?.getStrokeColor();if(i&&n&&e)return zl(i,n,t.getRadius(),e.getRadius());{const t=i??n;if(t)return Rl(t)}}}function Nl(t,e,i){const n=yl(t)?t:t.value;return n===Al?i?Tl({value:n}):e?Al:El:n===El?El:Tl({value:n})}function Ul(t){return void 0!==t?{h:t.h.value,s:t.s.value,l:t.l.value}:void 0}function Vl(t,e,i){const n={h:{enable:!1,value:t.h},s:{enable:!1,value:t.s},l:{enable:!1,value:t.l}};return e&&(jl(n.h,e.h,i),jl(n.s,e.s,i),jl(n.l,e.l,i)),n}function jl(t,e,i){t.enable=e.enable,t.enable?(t.velocity=No(e.speed)/100*i,t.decay=1-No(e.decay),t.status="increasing",t.loops=0,t.maxLoops=No(e.count),t.time=0,t.delayTime=1e3*No(e.delay),e.sync||(t.velocity*=Lo(),t.value*=Lo()),t.initialValue=t.value):t.velocity=0}function Gl(t,e,i){t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(i.x,i.y),t.closePath()}function Hl(t,e){t.clearRect(0,0,e.width,e.height)}function Wl(t,e,i){const n=e[i];void 0!==n&&(t[i]=(t[i]??1)*n)}class ql{constructor(t){this.container=t,this._applyPostDrawUpdaters=t=>{for(const e of this._postDrawUpdaters)e.afterDraw&&e.afterDraw(t)},this._applyPreDrawUpdaters=(t,e,i,n,r,s)=>{for(const a of this._preDrawUpdaters){if(a.getColorStyles){const{fill:s,stroke:o}=a.getColorStyles(e,t,i,n);s&&(r.fill=s),o&&(r.stroke=o)}if(a.getTransformValues){const t=a.getTransformValues(e);for(const e in t)Wl(s,t,e)}a.beforeDraw&&a.beforeDraw(e)}},this._applyResizePlugins=()=>{for(const t of this._resizePlugins)t.resize&&t.resize()},this._getPluginParticleColors=t=>{let e,i;for(const n of this._colorPlugins)if(!e&&n.particleFillColor&&(e=kl(n.particleFillColor(t))),!i&&n.particleStrokeColor&&(i=kl(n.particleStrokeColor(t))),e&&i)break;return[e,i]},this._initCover=()=>{const t=this.container.actualOptions.backgroundMask.cover,e=Tl(t.color);if(e){const i={...e,a:t.opacity};this._coverColorStyle=Ll(i,i.a)}},this._initStyle=()=>{const t=this.element,e=this.container.actualOptions;if(t){this._fullScreen?(this._originalStyle=rl({},t.style),this._setFullScreenStyle()):this._resetOriginalStyle();for(const i in e.style){if(!i||!e.style)continue;const n=e.style[i];n&&t.style.setProperty(i,n,"important")}}},this._initTrail=async()=>{const t=this.container.actualOptions,e=t.particles.move.trail,i=e.fill;if(e.enable)if(i.color){const e=Tl(i.color);if(!e)return;const n=t.particles.move.trail;this._trailFill={color:{...e},opacity:1/n.length}}else await new Promise(((t,n)=>{if(!i.image)return;const r=document.createElement("img");r.addEventListener("load",(()=>{this._trailFill={image:r,opacity:1/e.length},t()})),r.addEventListener("error",(t=>{n(t.error)})),r.src=i.image}))},this._paintBase=t=>{this.draw((e=>function(t,e,i){t.fillStyle=i??"rgba(0,0,0,0)",t.fillRect(0,0,e.width,e.height)}(e,this.size,t)))},this._paintImage=(t,e)=>{this.draw((i=>function(t,e,i,n){i&&(t.globalAlpha=n,t.drawImage(i,0,0,e.width,e.height),t.globalAlpha=1)}(i,this.size,t,e)))},this._repairStyle=()=>{const t=this.element;t&&(this._safeMutationObserver((t=>t.disconnect())),this._initStyle(),this.initBackground(),this._safeMutationObserver((e=>e.observe(t,{attributes:!0}))))},this._resetOriginalStyle=()=>{const t=this.element,e=this._originalStyle;if(!t||!e)return;const i=t.style;i.position=e.position,i.zIndex=e.zIndex,i.top=e.top,i.left=e.left,i.width=e.width,i.height=e.height},this._safeMutationObserver=t=>{this._mutationObserver&&t(this._mutationObserver)},this._setFullScreenStyle=()=>{const t=this.element;if(!t)return;const e="important",i=t.style;i.setProperty("position","fixed",e),i.setProperty("z-index",this.container.actualOptions.fullScreen.zIndex.toString(10),e),i.setProperty("top","0",e),i.setProperty("left","0",e),i.setProperty("width","100%",e),i.setProperty("height","100%",e)},this.size={height:0,width:0},this._context=null,this._generated=!1,this._preDrawUpdaters=[],this._postDrawUpdaters=[],this._resizePlugins=[],this._colorPlugins=[]}get _fullScreen(){return this.container.actualOptions.fullScreen.enable}clear(){const t=this.container.actualOptions,e=t.particles.move.trail,i=this._trailFill;t.backgroundMask.enable?this.paint():e.enable&&e.length>0&&i?i.color?this._paintBase(Ll(i.color,i.opacity)):i.image&&this._paintImage(i.image,i.opacity):this.draw((t=>{Hl(t,this.size)}))}destroy(){if(this.stop(),this._generated){const t=this.element;t&&t.remove()}else this._resetOriginalStyle();this._preDrawUpdaters=[],this._postDrawUpdaters=[],this._resizePlugins=[],this._colorPlugins=[]}draw(t){const e=this._context;if(e)return t(e)}drawParticle(t,e){if(t.spawning||t.destroyed)return;const i=t.getRadius();if(i<=0)return;const n=t.getFillColor(),r=t.getStrokeColor()??n;let[s,a]=this._getPluginParticleColors(t);s||(s=n),a||(a=r),(s||a)&&this.draw((n=>{const r=this.container,o=r.actualOptions,l=t.options.zIndex,h=(1-t.zIndexFactor)**l.opacityRate,c=t.bubble.opacity??t.opacity?.value??1,u=c*h,d=(t.strokeOpacity??c)*h,p={},f={fill:s?Bl(s,u):void 0};f.stroke=a?Bl(a,d):f.fill,this._applyPreDrawUpdaters(n,t,i,u,f,p),function(t){const{container:e,context:i,particle:n,delta:r,colorStyles:s,backgroundMask:a,composite:o,radius:l,opacity:h,shadow:c,transform:u}=t,d=n.getPosition(),p=n.rotation+(n.pathRotation?n.velocity.angle:0),f=Math.sin(p),m=Math.cos(p),g={a:m*(u.a??1),b:f*(u.b??1),c:-f*(u.c??1),d:m*(u.d??1)};i.setTransform(g.a,g.b,g.c,g.d,d.x,d.y),i.beginPath(),a&&(i.globalCompositeOperation=o);const v=n.shadowColor;c.enable&&v&&(i.shadowBlur=c.blur,i.shadowColor=Ll(v),i.shadowOffsetX=c.offset.x,i.shadowOffsetY=c.offset.y),s.fill&&(i.fillStyle=s.fill);const y=n.strokeWidth??0;i.lineWidth=y,s.stroke&&(i.strokeStyle=s.stroke),function(t,e,i,n,r,s){if(!i.shape)return;const a=t.drawers.get(i.shape);a&&a.draw(e,i,n,r,s,t.retina.pixelRatio)}(e,i,n,l,h,r),y>0&&i.stroke(),n.close&&i.closePath(),n.fill&&i.fill(),function(t,e,i,n,r,s){if(!i.shape)return;const a=t.drawers.get(i.shape);a&&a.afterEffect&&a.afterEffect(e,i,n,r,s,t.retina.pixelRatio)}(e,i,n,l,h,r),i.globalCompositeOperation="source-over",i.setTransform(1,0,0,1,0,0)}({container:r,context:n,particle:t,delta:e,colorStyles:f,backgroundMask:o.backgroundMask.enable,composite:o.backgroundMask.composite,radius:i*(1-t.zIndexFactor)**l.sizeRate,opacity:u,shadow:t.options.shadow,transform:p}),this._applyPostDrawUpdaters(t)}))}drawParticlePlugin(t,e,i){this.draw((n=>function(t,e,i,n){e.drawParticle&&e.drawParticle(t,i,n)}(n,t,e,i)))}drawPlugin(t,e){this.draw((i=>function(t,e,i){e.draw&&e.draw(t,i)}(i,t,e)))}async init(){this._safeMutationObserver((t=>t.disconnect())),this._mutationObserver=function(t){if(!Jo()&&"undefined"!==typeof MutationObserver)return new MutationObserver(t)}((t=>{for(const e of t)"attributes"===e.type&&"style"===e.attributeName&&this._repairStyle()})),this.resize(),this._initStyle(),this._initCover();try{await this._initTrail()}catch(Wk){Ko().error(Wk)}this.initBackground(),this._safeMutationObserver((t=>{this.element&&t.observe(this.element,{attributes:!0})})),this.initUpdaters(),this.initPlugins(),this.paint()}initBackground(){const t=this.container.actualOptions.background,e=this.element;if(!e)return;const i=e.style;if(i){if(t.color){const e=Tl(t.color);i.backgroundColor=e?Ll(e,t.opacity):""}else i.backgroundColor="";i.backgroundImage=t.image||"",i.backgroundPosition=t.position||"",i.backgroundRepeat=t.repeat||"",i.backgroundSize=t.size||""}}initPlugins(){this._resizePlugins=[];for(const[,t]of this.container.plugins)t.resize&&this._resizePlugins.push(t),(t.particleFillColor||t.particleStrokeColor)&&this._colorPlugins.push(t)}initUpdaters(){this._preDrawUpdaters=[],this._postDrawUpdaters=[];for(const t of this.container.particles.updaters)t.afterDraw&&this._postDrawUpdaters.push(t),(t.getColorStyles||t.getTransformValues||t.beforeDraw)&&this._preDrawUpdaters.push(t)}loadCanvas(t){this._generated&&this.element&&this.element.remove(),this._generated=t.dataset&&Eo in t.dataset?"true"===t.dataset[Eo]:this._generated,this.element=t,this.element.ariaHidden="true",this._originalStyle=rl({},this.element.style),this.size.height=t.offsetHeight,this.size.width=t.offsetWidth,this._context=this.element.getContext("2d"),this._safeMutationObserver((t=>{this.element&&t.observe(this.element,{attributes:!0})})),this.container.retina.init(),this.initBackground()}paint(){const t=this.container.actualOptions;this.draw((e=>{t.backgroundMask.enable&&t.backgroundMask.cover?(Hl(e,this.size),this._paintBase(this._coverColorStyle)):this._paintBase()}))}resize(){if(!this.element)return!1;const t=this.container,e=t.retina.pixelRatio,i=t.canvas.size,n=this.element.offsetWidth*e,r=this.element.offsetHeight*e;if(r===i.height&&n===i.width&&r===this.element.height&&n===this.element.width)return!1;const s={...i};return this.element.width=i.width=this.element.offsetWidth*e,this.element.height=i.height=this.element.offsetHeight*e,this.container.started&&(this.resizeFactor={width:i.width/s.width,height:i.height/s.height}),!0}stop(){this._safeMutationObserver((t=>t.disconnect())),this._mutationObserver=void 0,this.draw((t=>Hl(t,this.size)))}async windowResize(){if(!this.element||!this.resize())return;const t=this.container,e=t.updateActualOptions();t.particles.setDensity(),this._applyResizePlugins(),e&&await t.refresh()}}function Yl(t,e,i,n,r){if(n){let n={passive:!0};vl(r)?n.capture=r:void 0!==r&&(n=r),t.addEventListener(e,i,n)}else{const n=r;t.removeEventListener(e,i,n)}}class Xl{constructor(t){this.container=t,this._doMouseTouchClick=t=>{const e=this.container,i=e.actualOptions;if(this._canPush){const t=e.interactivity.mouse,n=t.position;if(!n)return;t.clickPosition={...n},t.clickTime=(new Date).getTime();ul(i.interactivity.events.onClick.mode,(t=>this.container.handleClickMode(t)))}"touchend"===t.type&&setTimeout((()=>this._mouseTouchFinish()),500)},this._handleThemeChange=t=>{const e=t,i=this.container,n=i.options,r=n.defaultThemes,s=e.matches?r.dark:r.light,a=n.themes.find((t=>t.name===s));a&&a.default.auto&&i.loadTheme(s)},this._handleVisibilityChange=()=>{const t=this.container,e=t.actualOptions;this._mouseTouchFinish(),e.pauseOnBlur&&(document&&document.hidden?(t.pageHidden=!0,t.pause()):(t.pageHidden=!1,t.getAnimationStatus()?t.play(!0):t.draw(!0)))},this._handleWindowResize=async()=>{this._resizeTimeout&&(clearTimeout(this._resizeTimeout),delete this._resizeTimeout),this._resizeTimeout=setTimeout((async()=>{const t=this.container.canvas;t&&await t.windowResize()}),1e3*this.container.actualOptions.interactivity.events.resize.delay)},this._manageInteractivityListeners=(t,e)=>{const i=this._handlers,n=this.container,r=n.actualOptions,s=n.interactivity.element;if(!s)return;const a=s,o=n.canvas.element;o&&(o.style.pointerEvents=a===o?"initial":"none"),(r.interactivity.events.onHover.enable||r.interactivity.events.onClick.enable)&&(Yl(s,Co,i.mouseMove,e),Yl(s,"touchstart",i.touchStart,e),Yl(s,"touchmove",i.touchMove,e),r.interactivity.events.onClick.enable?(Yl(s,Mo,i.touchEndClick,e),Yl(s,"pointerup",i.mouseUp,e),Yl(s,"pointerdown",i.mouseDown,e)):Yl(s,Mo,i.touchEnd,e),Yl(s,t,i.mouseLeave,e),Yl(s,"touchcancel",i.touchCancel,e))},this._manageListeners=t=>{const e=this._handlers,i=this.container,n=i.actualOptions.interactivity.detectsOn,r=i.canvas.element;let s=_o;"window"===n?(i.interactivity.element=window,s="pointerout"):i.interactivity.element="parent"===n&&r?r.parentElement??r.parentNode:r,this._manageMediaMatch(t),this._manageResize(t),this._manageInteractivityListeners(s,t),document&&Yl(document,"visibilitychange",e.visibilityChange,t,!1)},this._manageMediaMatch=t=>{const e=this._handlers,i=$o("(prefers-color-scheme: dark)");i&&(void 0===i.addEventListener?void 0!==i.addListener&&(t?i.addListener(e.oldThemeChange):i.removeListener(e.oldThemeChange)):Yl(i,"change",e.themeChange,t))},this._manageResize=t=>{const e=this._handlers,i=this.container;if(!i.actualOptions.interactivity.events.resize)return;if("undefined"===typeof ResizeObserver)return void Yl(window,"resize",e.resize,t);const n=i.canvas.element;this._resizeObserver&&!t?(n&&this._resizeObserver.unobserve(n),this._resizeObserver.disconnect(),delete this._resizeObserver):!this._resizeObserver&&t&&n&&(this._resizeObserver=new ResizeObserver((async t=>{t.find((t=>t.target===n))&&await this._handleWindowResize()})),this._resizeObserver.observe(n))},this._mouseDown=()=>{const{interactivity:t}=this.container;if(!t)return;const{mouse:e}=t;e.clicking=!0,e.downPosition=e.position},this._mouseTouchClick=t=>{const e=this.container,i=e.actualOptions,{mouse:n}=e.interactivity;n.inside=!0;let r=!1;const s=n.position;if(s&&i.interactivity.events.onClick.enable){for(const[,t]of e.plugins)if(t.clickPositionValid&&(r=t.clickPositionValid(s),r))break;r||this._doMouseTouchClick(t),n.clicking=!1}},this._mouseTouchFinish=()=>{const t=this.container.interactivity;if(!t)return;const e=t.mouse;delete e.position,delete e.clickPosition,delete e.downPosition,t.status=_o,e.inside=!1,e.clicking=!1},this._mouseTouchMove=t=>{const e=this.container,i=e.actualOptions,n=e.interactivity,r=e.canvas.element;if(!n||!n.element)return;let s;if(n.mouse.inside=!0,t.type.startsWith("pointer")){this._canPush=!0;const e=t;if(n.element===window){if(r){const t=r.getBoundingClientRect();s={x:e.clientX-t.left,y:e.clientY-t.top}}}else if("parent"===i.interactivity.detectsOn){const t=e.target,i=e.currentTarget;if(t&&i&&r){const n=t.getBoundingClientRect(),a=i.getBoundingClientRect(),o=r.getBoundingClientRect();s={x:e.offsetX+2*n.left-(a.left+o.left),y:e.offsetY+2*n.top-(a.top+o.top)}}else s={x:e.offsetX??e.clientX,y:e.offsetY??e.clientY}}else e.target===r&&(s={x:e.offsetX??e.clientX,y:e.offsetY??e.clientY})}else if(this._canPush="touchmove"!==t.type,r){const e=t,i=e.touches[e.touches.length-1],n=r.getBoundingClientRect();s={x:i.clientX-(n.left??0),y:i.clientY-(n.top??0)}}const a=e.retina.pixelRatio;s&&(s.x*=a,s.y*=a),n.mouse.position=s,n.status=Co},this._touchEnd=t=>{const e=t,i=Array.from(e.changedTouches);for(const n of i)this._touches.delete(n.identifier);this._mouseTouchFinish()},this._touchEndClick=t=>{const e=t,i=Array.from(e.changedTouches);for(const n of i)this._touches.delete(n.identifier);this._mouseTouchClick(t)},this._touchStart=t=>{const e=t,i=Array.from(e.changedTouches);for(const n of i)this._touches.set(n.identifier,performance.now());this._mouseTouchMove(t)},this._canPush=!0,this._touches=new Map,this._handlers={mouseDown:()=>this._mouseDown(),mouseLeave:()=>this._mouseTouchFinish(),mouseMove:t=>this._mouseTouchMove(t),mouseUp:t=>this._mouseTouchClick(t),touchStart:t=>this._touchStart(t),touchMove:t=>this._mouseTouchMove(t),touchEnd:t=>this._touchEnd(t),touchCancel:t=>this._touchEnd(t),touchEndClick:t=>this._touchEndClick(t),visibilityChange:()=>this._handleVisibilityChange(),themeChange:t=>this._handleThemeChange(t),oldThemeChange:t=>this._handleThemeChange(t),resize:()=>{this._handleWindowResize()}}}addListeners(){this._manageListeners(!0)}removeListeners(){this._manageListeners(!1)}}class Ql{constructor(){this.value=""}static create(t,e){const i=new Ql;return i.load(t),void 0!==e&&(yl(e)||Sl(e)?i.load({value:e}):i.load(e)),i}load(t){void 0!==t?.value&&(this.value=t.value)}}class Kl{constructor(){this.color=new Ql,this.color.value="",this.image="",this.position="",this.repeat="",this.size="",this.opacity=1}load(t){t&&(void 0!==t.color&&(this.color=Ql.create(this.color,t.color)),void 0!==t.image&&(this.image=t.image),void 0!==t.position&&(this.position=t.position),void 0!==t.repeat&&(this.repeat=t.repeat),void 0!==t.size&&(this.size=t.size),void 0!==t.opacity&&(this.opacity=t.opacity))}}class Zl{constructor(){this.color=new Ql,this.color.value="#fff",this.opacity=1}load(t){t&&(void 0!==t.color&&(this.color=Ql.create(this.color,t.color)),void 0!==t.opacity&&(this.opacity=t.opacity))}}class Jl{constructor(){this.composite="destination-out",this.cover=new Zl,this.enable=!1}load(t){if(t){if(void 0!==t.composite&&(this.composite=t.composite),void 0!==t.cover){const e=t.cover,i=yl(t.cover)?{color:t.cover}:t.cover;this.cover.load(void 0!==e.color?e:{color:i})}void 0!==t.enable&&(this.enable=t.enable)}}}class $l{constructor(){this.enable=!0,this.zIndex=0}load(t){t&&(void 0!==t.enable&&(this.enable=t.enable),void 0!==t.zIndex&&(this.zIndex=t.zIndex))}}class th{constructor(){this.enable=!1,this.mode=[]}load(t){t&&(void 0!==t.enable&&(this.enable=t.enable),void 0!==t.mode&&(this.mode=t.mode))}}class eh{constructor(){this.selectors=[],this.enable=!1,this.mode=[],this.type="circle"}get el(){return this.elementId}set el(t){this.elementId=t}get elementId(){return this.ids}set elementId(t){this.ids=t}get ids(){return ul(this.selectors,(t=>t.replace("#","")))}set ids(t){this.selectors=ul(t,(t=>`#${t}`))}load(t){if(!t)return;const e=t.ids??t.elementId??t.el;void 0!==e&&(this.ids=e),void 0!==t.selectors&&(this.selectors=t.selectors),void 0!==t.enable&&(this.enable=t.enable),void 0!==t.mode&&(this.mode=t.mode),void 0!==t.type&&(this.type=t.type)}}class ih{constructor(){this.enable=!1,this.force=2,this.smooth=10}load(t){t&&(void 0!==t.enable&&(this.enable=t.enable),void 0!==t.force&&(this.force=t.force),void 0!==t.smooth&&(this.smooth=t.smooth))}}class nh{constructor(){this.enable=!1,this.mode=[],this.parallax=new ih}load(t){t&&(void 0!==t.enable&&(this.enable=t.enable),void 0!==t.mode&&(this.mode=t.mode),this.parallax.load(t.parallax))}}class rh{constructor(){this.delay=.5,this.enable=!0}load(t){void 0!==t&&(void 0!==t.delay&&(this.delay=t.delay),void 0!==t.enable&&(this.enable=t.enable))}}class sh{constructor(){this.onClick=new th,this.onDiv=new eh,this.onHover=new nh,this.resize=new rh}get onclick(){return this.onClick}set onclick(t){this.onClick=t}get ondiv(){return this.onDiv}set ondiv(t){this.onDiv=t}get onhover(){return this.onHover}set onhover(t){this.onHover=t}load(t){if(!t)return;this.onClick.load(t.onClick??t.onclick);const e=t.onDiv??t.ondiv;void 0!==e&&(this.onDiv=ul(e,(t=>{const e=new eh;return e.load(t),e}))),this.onHover.load(t.onHover??t.onhover),vl(t.resize)?this.resize.enable=t.resize:this.resize.load(t.resize)}}class ah{constructor(t,e){this._engine=t,this._container=e}load(t){if(!t)return;if(!this._container)return;const e=this._engine.plugins.interactors.get(this._container);if(e)for(const i of e)i.loadModeOptions&&i.loadModeOptions(this,t)}}class oh{constructor(t,e){this.detectsOn="window",this.events=new sh,this.modes=new ah(t,e)}get detect_on(){return this.detectsOn}set detect_on(t){this.detectsOn=t}load(t){if(!t)return;const e=t.detectsOn??t.detect_on;void 0!==e&&(this.detectsOn=e),this.events.load(t.events),this.modes.load(t.modes)}}class lh{load(t){t&&(t.position&&(this.position={x:t.position.x??50,y:t.position.y??50,mode:t.position.mode??"percent"}),t.options&&(this.options=rl({},t.options)))}}class hh{constructor(){this.maxWidth=1/0,this.options={},this.mode="canvas"}load(t){t&&(void 0!==t.maxWidth&&(this.maxWidth=t.maxWidth),void 0!==t.mode&&("screen"===t.mode?this.mode="screen":this.mode="canvas"),void 0!==t.options&&(this.options=rl({},t.options)))}}class ch{constructor(){this.auto=!1,this.mode="any",this.value=!1}load(t){t&&(void 0!==t.auto&&(this.auto=t.auto),void 0!==t.mode&&(this.mode=t.mode),void 0!==t.value&&(this.value=t.value))}}class uh{constructor(){this.name="",this.default=new ch}load(t){t&&(void 0!==t.name&&(this.name=t.name),this.default.load(t.default),void 0!==t.options&&(this.options=rl({},t.options)))}}class dh{constructor(){this.count=0,this.enable=!1,this.offset=0,this.speed=1,this.delay=0,this.decay=0,this.sync=!0}load(t){t&&(void 0!==t.count&&(this.count=jo(t.count)),void 0!==t.enable&&(this.enable=t.enable),void 0!==t.offset&&(this.offset=jo(t.offset)),void 0!==t.speed&&(this.speed=jo(t.speed)),void 0!==t.decay&&(this.decay=jo(t.decay)),void 0!==t.delay&&(this.delay=jo(t.delay)),void 0!==t.sync&&(this.sync=t.sync))}}class ph{constructor(){this.h=new dh,this.s=new dh,this.l=new dh}load(t){t&&(this.h.load(t.h),this.s.load(t.s),this.l.load(t.l))}}class fh extends Ql{constructor(){super(),this.animation=new ph}static create(t,e){const i=new fh;return i.load(t),void 0!==e&&(yl(e)||Sl(e)?i.load({value:e}):i.load(e)),i}load(t){if(super.load(t),!t)return;const e=t.animation;void 0!==e&&(void 0!==e.enable?this.animation.h.load(e):this.animation.load(t.animation))}}class mh{constructor(){this.speed=2}load(t){t&&void 0!==t.speed&&(this.speed=t.speed)}}class gh{constructor(){this.enable=!0,this.retries=0}load(t){t&&(void 0!==t.enable&&(this.enable=t.enable),void 0!==t.retries&&(this.retries=t.retries))}}class vh{constructor(){this.count=0,this.enable=!1,this.speed=1,this.decay=0,this.delay=0,this.sync=!1}load(t){t&&(void 0!==t.count&&(this.count=jo(t.count)),void 0!==t.enable&&(this.enable=t.enable),void 0!==t.speed&&(this.speed=jo(t.speed)),void 0!==t.decay&&(this.decay=jo(t.decay)),void 0!==t.delay&&(this.delay=jo(t.delay)),void 0!==t.sync&&(this.sync=t.sync))}}class yh extends vh{constructor(){super(),this.mode="auto",this.startValue="random"}load(t){super.load(t),t&&(void 0!==t.minimumValue&&(this.minimumValue=t.minimumValue),void 0!==t.mode&&(this.mode=t.mode),void 0!==t.startValue&&(this.startValue=t.startValue))}}class bh{constructor(){this.enable=!1,this.minimumValue=0}load(t){t&&(void 0!==t.enable&&(this.enable=t.enable),void 0!==t.minimumValue&&(this.minimumValue=t.minimumValue))}}class xh{constructor(){this.random=new bh,this.value=0}load(t){t&&(vl(t.random)?this.random.enable=t.random:this.random.load(t.random),void 0!==t.value&&(this.value=jo(t.value,this.random.enable?this.random.minimumValue:void 0)))}}class wh extends xh{constructor(){super(),this.random.minimumValue=.1,this.value=1}}class Sh{constructor(){this.horizontal=new wh,this.vertical=new wh}load(t){t&&(this.horizontal.load(t.horizontal),this.vertical.load(t.vertical))}}class Ah{constructor(){this.absorb=new mh,this.bounce=new Sh,this.enable=!1,this.maxSpeed=50,this.mode="bounce",this.overlap=new gh}load(t){t&&(this.absorb.load(t.absorb),this.bounce.load(t.bounce),void 0!==t.enable&&(this.enable=t.enable),void 0!==t.maxSpeed&&(this.maxSpeed=jo(t.maxSpeed)),void 0!==t.mode&&(this.mode=t.mode),this.overlap.load(t.overlap))}}class Eh{constructor(){this.offset=0,this.value=90}load(t){t&&(void 0!==t.offset&&(this.offset=jo(t.offset)),void 0!==t.value&&(this.value=jo(t.value)))}}class _h{constructor(){this.distance=200,this.enable=!1,this.rotate={x:3e3,y:3e3}}get rotateX(){return this.rotate.x}set rotateX(t){this.rotate.x=t}get rotateY(){return this.rotate.y}set rotateY(t){this.rotate.y=t}load(t){if(!t)return;void 0!==t.distance&&(this.distance=jo(t.distance)),void 0!==t.enable&&(this.enable=t.enable);const e=t.rotate?.x??t.rotateX;void 0!==e&&(this.rotate.x=e);const i=t.rotate?.y??t.rotateY;void 0!==i&&(this.rotate.y=i)}}class Ch{constructor(){this.x=50,this.y=50,this.mode="percent",this.radius=0}load(t){t&&(void 0!==t.x&&(this.x=t.x),void 0!==t.y&&(this.y=t.y),void 0!==t.mode&&(this.mode=t.mode),void 0!==t.radius&&(this.radius=t.radius))}}class Mh{constructor(){this.acceleration=9.81,this.enable=!1,this.inverse=!1,this.maxSpeed=50}load(t){t&&(void 0!==t.acceleration&&(this.acceleration=jo(t.acceleration)),void 0!==t.enable&&(this.enable=t.enable),void 0!==t.inverse&&(this.inverse=t.inverse),void 0!==t.maxSpeed&&(this.maxSpeed=jo(t.maxSpeed)))}}class Ph{constructor(){this.clamp=!0,this.delay=new xh,this.enable=!1,this.options={}}load(t){t&&(void 0!==t.clamp&&(this.clamp=t.clamp),this.delay.load(t.delay),void 0!==t.enable&&(this.enable=t.enable),this.generator=t.generator,t.options&&(this.options=rl(this.options,t.options)))}}class Th{load(t){t&&(void 0!==t.color&&(this.color=Ql.create(this.color,t.color)),void 0!==t.image&&(this.image=t.image))}}class Dh{constructor(){this.enable=!1,this.length=10,this.fill=new Th}get fillColor(){return this.fill.color}set fillColor(t){this.fill.load({color:t})}load(t){t&&(void 0!==t.enable&&(this.enable=t.enable),void 0===t.fill&&void 0===t.fillColor||this.fill.load(t.fill||{color:t.fillColor}),void 0!==t.length&&(this.length=t.length))}}class kh{constructor(){this.default="out"}load(t){t&&(void 0!==t.default&&(this.default=t.default),this.bottom=t.bottom??t.default,this.left=t.left??t.default,this.right=t.right??t.default,this.top=t.top??t.default)}}class Ih{constructor(){this.acceleration=0,this.enable=!1}load(t){t&&(void 0!==t.acceleration&&(this.acceleration=jo(t.acceleration)),void 0!==t.enable&&(this.enable=t.enable),t.position&&(this.position=rl({},t.position)))}}class Rh{constructor(){this.angle=new Eh,this.attract=new _h,this.center=new Ch,this.decay=0,this.distance={},this.direction="none",this.drift=0,this.enable=!1,this.gravity=new Mh,this.path=new Ph,this.outModes=new kh,this.random=!1,this.size=!1,this.speed=2,this.spin=new Ih,this.straight=!1,this.trail=new Dh,this.vibrate=!1,this.warp=!1}get bounce(){return this.collisions}set bounce(t){this.collisions=t}get collisions(){return!1}set collisions(t){}get noise(){return this.path}set noise(t){this.path=t}get outMode(){return this.outModes.default}set outMode(t){this.outModes.default=t}get out_mode(){return this.outMode}set out_mode(t){this.outMode=t}load(t){if(!t)return;this.angle.load(bl(t.angle)?{value:t.angle}:t.angle),this.attract.load(t.attract),this.center.load(t.center),void 0!==t.decay&&(this.decay=jo(t.decay)),void 0!==t.direction&&(this.direction=t.direction),void 0!==t.distance&&(this.distance=bl(t.distance)?{horizontal:t.distance,vertical:t.distance}:{...t.distance}),void 0!==t.drift&&(this.drift=jo(t.drift)),void 0!==t.enable&&(this.enable=t.enable),this.gravity.load(t.gravity);const e=t.outModes??t.outMode??t.out_mode;void 0!==e&&(wl(e)?this.outModes.load(e):this.outModes.load({default:e})),this.path.load(t.path??t.noise),void 0!==t.random&&(this.random=t.random),void 0!==t.size&&(this.size=t.size),void 0!==t.speed&&(this.speed=jo(t.speed)),this.spin.load(t.spin),void 0!==t.straight&&(this.straight=t.straight),this.trail.load(t.trail),void 0!==t.vibrate&&(this.vibrate=t.vibrate),void 0!==t.warp&&(this.warp=t.warp)}}class Oh extends yh{constructor(){super(),this.destroy="none",this.speed=2}get opacity_min(){return this.minimumValue}set opacity_min(t){this.minimumValue=t}load(t){void 0!==t?.opacity_min&&void 0===t.minimumValue&&(t.minimumValue=t.opacity_min),super.load(t),t&&void 0!==t.destroy&&(this.destroy=t.destroy)}}class Lh extends xh{constructor(){super(),this.animation=new Oh,this.random.minimumValue=.1,this.value=1}get anim(){return this.animation}set anim(t){this.animation=t}load(t){if(!t)return;super.load(t);const e=t.animation??t.anim;void 0!==e&&(this.animation.load(e),this.value=jo(this.value,this.animation.enable?this.animation.minimumValue:void 0))}}class Bh{constructor(){this.enable=!1,this.width=1920,this.height=1080}get area(){return this.width}set area(t){this.width=t}get factor(){return this.height}set factor(t){this.height=t}get value_area(){return this.area}set value_area(t){this.area=t}load(t){if(!t)return;void 0!==t.enable&&(this.enable=t.enable);const e=t.width??t.area??t.value_area;void 0!==e&&(this.width=e);const i=t.height??t.factor;void 0!==i&&(this.height=i)}}class zh{constructor(){this.density=new Bh,this.limit=0,this.value=0}get max(){return this.limit}set max(t){this.limit=t}load(t){if(!t)return;this.density.load(t.density);const e=t.limit??t.max;void 0!==e&&(this.limit=e),void 0!==t.value&&(this.value=t.value)}}class Fh{constructor(){this.blur=0,this.color=new Ql,this.enable=!1,this.offset={x:0,y:0},this.color.value="#000"}load(t){t&&(void 0!==t.blur&&(this.blur=t.blur),this.color=Ql.create(this.color,t.color),void 0!==t.enable&&(this.enable=t.enable),void 0!==t.offset&&(void 0!==t.offset.x&&(this.offset.x=t.offset.x),void 0!==t.offset.y&&(this.offset.y=t.offset.y)))}}const Nh="character",Uh="char",Vh="image",jh="images",Gh="polygon",Hh="star";class Wh{constructor(){this.loadShape=(t,e,i,n)=>{if(!t)return;const r=Sl(t),s=r?[]:{},a=r!==Sl(this.options[e]),o=r!==Sl(this.options[i]);a&&(this.options[e]=s),o&&n&&(this.options[i]=s),this.options[e]=rl(this.options[e]??s,t),this.options[i]&&!n||(this.options[i]=rl(this.options[i]??s,t))},this.close=!0,this.fill=!0,this.options={},this.type="circle"}get character(){return this.options[Nh]??this.options[Uh]}set character(t){this.options[Uh]=this.options[Nh]=t}get custom(){return this.options}set custom(t){this.options=t}get image(){return this.options[Vh]??this.options[jh]}set image(t){this.options[jh]=this.options[Vh]=t}get images(){return this.image}set images(t){this.image=t}get polygon(){return this.options[Gh]??this.options[Hh]}set polygon(t){this.options[Hh]=this.options[Gh]=t}get stroke(){return[]}set stroke(t){}load(t){if(!t)return;const e=t.options??t.custom;if(void 0!==e)for(const i in e){const t=e[i];t&&(this.options[i]=rl(this.options[i]??{},t))}this.loadShape(t.character,Nh,Uh,!0),this.loadShape(t.polygon,Gh,Hh,!1),this.loadShape(t.image??t.images,Vh,jh,!0),void 0!==t.close&&(this.close=t.close),void 0!==t.fill&&(this.fill=t.fill),void 0!==t.type&&(this.type=t.type)}}class qh extends yh{constructor(){super(),this.destroy="none",this.speed=5}get size_min(){return this.minimumValue}set size_min(t){this.minimumValue=t}load(t){void 0!==t?.size_min&&void 0===t.minimumValue&&(t.minimumValue=t.size_min),super.load(t),t&&void 0!==t.destroy&&(this.destroy=t.destroy)}}class Yh extends xh{constructor(){super(),this.animation=new qh,this.random.minimumValue=1,this.value=3}get anim(){return this.animation}set anim(t){this.animation=t}load(t){if(super.load(t),!t)return;const e=t.animation??t.anim;void 0!==e&&(this.animation.load(e),this.value=jo(this.value,this.animation.enable?this.animation.minimumValue:void 0))}}class Xh{constructor(){this.width=0}load(t){t&&(void 0!==t.color&&(this.color=fh.create(this.color,t.color)),void 0!==t.width&&(this.width=jo(t.width)),void 0!==t.opacity&&(this.opacity=jo(t.opacity)))}}class Qh extends xh{constructor(){super(),this.opacityRate=1,this.sizeRate=1,this.velocityRate=1}load(t){super.load(t),t&&(void 0!==t.opacityRate&&(this.opacityRate=t.opacityRate),void 0!==t.sizeRate&&(this.sizeRate=t.sizeRate),void 0!==t.velocityRate&&(this.velocityRate=t.velocityRate))}}class Kh{constructor(t,e){this._engine=t,this._container=e,this.bounce=new Sh,this.collisions=new Ah,this.color=new fh,this.color.value="#fff",this.groups={},this.move=new Rh,this.number=new zh,this.opacity=new Lh,this.reduceDuplicates=!1,this.shadow=new Fh,this.shape=new Wh,this.size=new Yh,this.stroke=new Xh,this.zIndex=new Qh}load(t){if(!t)return;if(this.bounce.load(t.bounce),this.color.load(fh.create(this.color,t.color)),void 0!==t.groups)for(const n in t.groups){const e=t.groups[n];void 0!==e&&(this.groups[n]=rl(this.groups[n]??{},e))}this.move.load(t.move),this.number.load(t.number),this.opacity.load(t.opacity),void 0!==t.reduceDuplicates&&(this.reduceDuplicates=t.reduceDuplicates),this.shape.load(t.shape),this.size.load(t.size),this.shadow.load(t.shadow),this.zIndex.load(t.zIndex);const e=t.move?.collisions??t.move?.bounce;void 0!==e&&(this.collisions.enable=e),this.collisions.load(t.collisions),void 0!==t.interactivity&&(this.interactivity=rl({},t.interactivity));const i=t.stroke??t.shape?.stroke;if(i&&(this.stroke=ul(i,(t=>{const e=new Xh;return e.load(t),e}))),this._container){const e=this._engine.plugins.updaters.get(this._container);if(e)for(const n of e)n.loadOptions&&n.loadOptions(this,t);const i=this._engine.plugins.interactors.get(this._container);if(i)for(const n of i)n.loadParticlesOptions&&n.loadParticlesOptions(this,t)}}}function Zh(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(const r of i)t.load(r)}function Jh(t,e){const i=new Kh(t,e);for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];return Zh(i,...r),i}class $h{constructor(t,e){this._findDefaultTheme=t=>this.themes.find((e=>e.default.value&&e.default.mode===t))??this.themes.find((t=>t.default.value&&"any"===t.default.mode)),this._importPreset=t=>{this.load(this._engine.plugins.getPreset(t))},this._engine=t,this._container=e,this.autoPlay=!0,this.background=new Kl,this.backgroundMask=new Jl,this.defaultThemes={},this.delay=0,this.fullScreen=new $l,this.detectRetina=!0,this.duration=0,this.fpsLimit=120,this.interactivity=new oh(t,e),this.manualParticles=[],this.particles=Jh(this._engine,this._container),this.pauseOnBlur=!0,this.pauseOnOutsideViewport=!0,this.responsive=[],this.smooth=!1,this.style={},this.themes=[],this.zLayers=100}get backgroundMode(){return this.fullScreen}set backgroundMode(t){this.fullScreen.load(t)}get fps_limit(){return this.fpsLimit}set fps_limit(t){this.fpsLimit=t}get retina_detect(){return this.detectRetina}set retina_detect(t){this.detectRetina=t}load(t){if(!t)return;void 0!==t.preset&&ul(t.preset,(t=>this._importPreset(t))),void 0!==t.autoPlay&&(this.autoPlay=t.autoPlay),void 0!==t.delay&&(this.delay=jo(t.delay));const e=t.detectRetina??t.retina_detect;void 0!==e&&(this.detectRetina=e),void 0!==t.duration&&(this.duration=jo(t.duration));const i=t.fpsLimit??t.fps_limit;void 0!==i&&(this.fpsLimit=i),void 0!==t.pauseOnBlur&&(this.pauseOnBlur=t.pauseOnBlur),void 0!==t.pauseOnOutsideViewport&&(this.pauseOnOutsideViewport=t.pauseOnOutsideViewport),void 0!==t.zLayers&&(this.zLayers=t.zLayers),this.background.load(t.background);const n=t.fullScreen??t.backgroundMode;vl(n)?this.fullScreen.enable=n:this.fullScreen.load(n),this.backgroundMask.load(t.backgroundMask),this.interactivity.load(t.interactivity),t.manualParticles&&(this.manualParticles=t.manualParticles.map((t=>{const e=new lh;return e.load(t),e}))),this.particles.load(t.particles),this.style=rl(this.style,t.style),this._engine.plugins.loadOptions(this,t),void 0!==t.smooth&&(this.smooth=t.smooth);const r=this._engine.plugins.interactors.get(this._container);if(r)for(const s of r)s.loadOptions&&s.loadOptions(this,t);if(void 0!==t.responsive)for(const s of t.responsive){const t=new hh;t.load(s),this.responsive.push(t)}if(this.responsive.sort(((t,e)=>t.maxWidth-e.maxWidth)),void 0!==t.themes)for(const s of t.themes){const t=this.themes.find((t=>t.name===s.name));if(t)t.load(s);else{const t=new uh;t.load(s),this.themes.push(t)}}this.defaultThemes.dark=this._findDefaultTheme("dark")?.name,this.defaultThemes.light=this._findDefaultTheme("light")?.name}setResponsive(t,e,i){this.load(i);const n=this.responsive.find((i=>"screen"===i.mode&&screen?i.maxWidth>screen.availWidth:i.maxWidth*e>t));return this.load(n?.options),n?.maxWidth}setTheme(t){if(t){const e=this.themes.find((e=>e.name===t));e&&this.load(e.options)}else{const t=$o("(prefers-color-scheme: dark)"),e=t&&t.matches,i=this._findDefaultTheme(e?"dark":"light");i&&this.load(i.options)}}}class tc{constructor(t,e){this.container=e,this._engine=t,this._interactors=t.plugins.getInteractors(this.container,!0),this._externalInteractors=[],this._particleInteractors=[]}async externalInteract(t){for(const e of this._externalInteractors)e.isEnabled()&&await e.interact(t)}handleClickMode(t){for(const e of this._externalInteractors)e.handleClickMode&&e.handleClickMode(t)}init(){this._externalInteractors=[],this._particleInteractors=[];for(const t of this._interactors){switch(t.type){case"external":this._externalInteractors.push(t);break;case"particles":this._particleInteractors.push(t)}t.init()}}async particlesInteract(t,e){for(const i of this._externalInteractors)i.clear(t,e);for(const i of this._particleInteractors)i.isEnabled(t)&&await i.interact(t,e)}async reset(t){for(const e of this._externalInteractors)e.isEnabled()&&e.reset(t);for(const e of this._particleInteractors)e.isEnabled(t)&&e.reset(t)}}const ec=t=>{if(!tl(t.outMode,t.checkModes))return;const e=2*t.radius;t.coord>t.maxCoord-e?t.setCb(-t.radius):t.coord<e&&t.setCb(t.radius)};class ic{constructor(t,e,i,n,r,s){var a=this;this.container=i,this._calcPosition=function(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;for(const[,u]of t.plugins){const t=void 0!==u.particlePosition?u.particlePosition(e,a):void 0;if(t)return To.create(t.x,t.y,i)}const r=Yo({size:t.canvas.size,position:e}),s=To.create(r.x,r.y,i),o=a.getRadius(),l=a.options.move.outModes,h=e=>{ec({outMode:e,checkModes:["bounce","bounce-horizontal"],coord:s.x,maxCoord:t.canvas.size.width,setCb:t=>s.x+=t,radius:o})},c=e=>{ec({outMode:e,checkModes:["bounce","bounce-vertical"],coord:s.y,maxCoord:t.canvas.size.height,setCb:t=>s.y+=t,radius:o})};return h(l.left??l.default),h(l.right??l.default),c(l.top??l.default),c(l.bottom??l.default),a._checkOverlap(s,n)?a._calcPosition(t,void 0,i,n+1):s},this._calculateVelocity=()=>{const t=function(t){const e=Do.origin;return e.length=1,e.angle=t,e}(this.direction).copy(),e=this.options.move;if("inside"===e.direction||"outside"===e.direction)return t;const i=Math.PI/180*No(e.angle.value),n=Math.PI/180*No(e.angle.offset),r={left:n-i/2,right:n+i/2};return e.straight||(t.angle+=Fo(jo(r.left,r.right))),e.random&&"number"===typeof e.speed&&(t.length*=Lo()),t},this._checkOverlap=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=a.options.collisions,n=a.getRadius();if(!i.enable)return!1;const r=i.overlap;if(r.enable)return!1;const s=r.retries;if(s>=0&&e>s)throw new Error(`${Po} particle is overlapping and can't be placed`);return!!a.container.particles.find((e=>Wo(t,e.position)<n+e.getRadius()))},this._getRollColor=t=>{if(!t||!this.roll||!this.backColor&&!this.roll.alter)return t;const e=this.roll.horizontal&&this.roll.vertical?2:1,i=this.roll.horizontal?Math.PI/2:0;return Math.floor(((this.roll.angle??0)+i)/(Math.PI/e))%2?this.backColor?this.backColor:this.roll.alter?function(t,e,i){return{h:t.h,s:t.s,l:t.l+("darken"===e?-1:1)*i}}(t,this.roll.alter.type,this.roll.alter.value):t:t},this._initPosition=t=>{const e=this.container,i=No(this.options.zIndex.value);this.position=this._calcPosition(e,t,Bo(i,0,e.zLayers)),this.initialPosition=this.position.copy();const n=e.canvas.size;switch(this.moveCenter={...gl(this.options.move.center,n),radius:this.options.move.center.radius??0,mode:this.options.move.center.mode??"percent"},this.direction=function(t,e,i){if(bl(t))return t*Math.PI/180;switch(t){case"top":return-Math.PI/2;case"top-right":return-Math.PI/4;case"right":return 0;case"bottom-right":return Math.PI/4;case"bottom":return Math.PI/2;case"bottom-left":return 3*Math.PI/4;case"left":return Math.PI;case"top-left":return-3*Math.PI/4;case"inside":return Math.atan2(i.y-e.y,i.x-e.x);case"outside":return Math.atan2(e.y-i.y,e.x-i.x);default:return Lo()*Math.PI*2}}(this.options.move.direction,this.position,this.moveCenter),this.options.move.direction){case"inside":this.outType="inside";break;case"outside":this.outType="outside"}this.offset=Do.origin},this._loadShapeData=(t,e)=>{const i=t.options[this.shape];if(i)return rl({close:t.close,fill:t.fill},dl(i,this.id,e))},this._engine=t,this.init(e,n,r,s)}destroy(t){if(this.unbreakable||this.destroyed)return;this.destroyed=!0,this.bubble.inRange=!1,this.slow.inRange=!1;const e=this.container,i=this.pathGenerator;for(const[,n]of e.plugins)n.particleDestroyed&&n.particleDestroyed(this,t);for(const n of e.particles.updaters)n.particleDestroyed&&n.particleDestroyed(this,t);i&&i.reset(this)}draw(t){const e=this.container;for(const[,i]of e.plugins)e.canvas.drawParticlePlugin(i,this,t);e.canvas.drawParticle(this,t)}getFillColor(){return this._getRollColor(this.bubble.color??Ul(this.color))}getMass(){return this.getRadius()**2*Math.PI/2}getPosition(){return{x:this.position.x+this.offset.x,y:this.position.y+this.offset.y,z:this.position.z}}getRadius(){return this.bubble.radius??this.size.value}getStrokeColor(){return this._getRollColor(this.bubble.color??Ul(this.strokeColor))}init(t,e,i,n){const r=this.container,s=this._engine;this.id=t,this.group=n,this.fill=!0,this.pathRotation=!1,this.close=!0,this.lastPathTime=0,this.destroyed=!1,this.unbreakable=!1,this.rotation=0,this.misplaced=!1,this.retina={maxDistance:{}},this.outType="normal",this.ignoresResizeRatio=!0;const a=r.retina.pixelRatio,o=r.actualOptions,l=Jh(this._engine,r,o.particles),h=l.shape.type,{reduceDuplicates:c}=l;this.shape=dl(h,this.id,c);const u=l.shape;if(i&&i.shape&&i.shape.type){const t=dl(i.shape.type,this.id,c);t&&(this.shape=t,u.load(i.shape))}this.shapeData=this._loadShapeData(u,c),l.load(i);const d=this.shapeData;d&&l.load(d.particles);const p=new oh(s,r);p.load(r.actualOptions.interactivity),p.load(l.interactivity),this.interactivity=p,this.fill=d?.fill??l.shape.fill,this.close=d?.close??l.shape.close,this.options=l;const f=this.options.move.path;this.pathDelay=1e3*Go(f.delay),f.generator&&(this.pathGenerator=this._engine.plugins.getPathGenerator(f.generator),this.pathGenerator&&r.addPath(f.generator,this.pathGenerator)&&this.pathGenerator.init(r)),r.retina.initParticle(this),this.size=fl(this.options.size,a),this.bubble={inRange:!1},this.slow={inRange:!1,factor:1},this._initPosition(e),this.initialVelocity=this._calculateVelocity(),this.velocity=this.initialVelocity.copy(),this.moveDecay=1-No(this.options.move.decay);const m=r.particles;m.needsSort=m.needsSort||m.lastZIndex<this.position.z,m.lastZIndex=this.position.z,this.zIndexFactor=this.position.z/r.zLayers,this.sides=24;let g=r.drawers.get(this.shape);g||(g=this._engine.plugins.getShapeDrawer(this.shape),g&&r.drawers.set(this.shape,g)),g&&g.loadShape&&g.loadShape(this);const v=g?.getSidesCount;v&&(this.sides=v(this)),this.spawning=!1,this.shadowColor=Tl(this.options.shadow.color);for(const y of r.particles.updaters)y.init(this);for(const y of r.particles.movers)y.init&&y.init(this);g&&g.particleInit&&g.particleInit(r,this);for(const[,y]of r.plugins)y.particleCreated&&y.particleCreated(this)}isInsideCanvas(){const t=this.getRadius(),e=this.container.canvas.size,i=this.position;return i.x>=-t&&i.y>=-t&&i.y<=e.height+t&&i.x<=e.width+t}isVisible(){return!this.destroyed&&!this.spawning&&this.isInsideCanvas()}reset(){for(const t of this.container.particles.updaters)t.reset&&t.reset(this)}}class nc{constructor(t,e){this.position=t,this.particle=e}}class rc{constructor(t,e){this.position={x:t,y:e}}}class sc extends rc{constructor(t,e,i,n){super(t,e),this.size={height:n,width:i}}contains(t){const e=this.size.width,i=this.size.height,n=this.position;return t.x>=n.x&&t.x<=n.x+e&&t.y>=n.y&&t.y<=n.y+i}intersects(t){t instanceof ac&&t.intersects(this);const e=this.size.width,i=this.size.height,n=this.position,r=t.position,s=t instanceof sc?t.size:{width:0,height:0},a=s.width,o=s.height;return r.x<n.x+e&&r.x+a>n.x&&r.y<n.y+i&&r.y+o>n.y}}class ac extends rc{constructor(t,e,i){super(t,e),this.radius=i}contains(t){return Wo(t,this.position)<=this.radius}intersects(t){const e=this.position,i=t.position,n=Math.abs(i.x-e.x),r=Math.abs(i.y-e.y),s=this.radius;if(t instanceof ac){return s+t.radius>Math.sqrt(n**2+r**2)}if(t instanceof sc){const{width:e,height:i}=t.size;return Math.pow(n-e,2)+Math.pow(r-i,2)<=s**2||n<=s+e&&r<=s+i||n<=e||r<=i}return!1}}class oc{constructor(t,e){this.rectangle=t,this.capacity=e,this._subdivide=()=>{const{x:t,y:e}=this.rectangle.position,{width:i,height:n}=this.rectangle.size,{capacity:r}=this;for(let s=0;s<4;s++)this._subs.push(new oc(new sc(t+i/2*(s%2),e+n/2*(Math.round(s/2)-s%2),i/2,n/2),r));this._divided=!0},this._points=[],this._divided=!1,this._subs=[]}insert(t){return!!this.rectangle.contains(t.position)&&(this._points.length<this.capacity?(this._points.push(t),!0):(this._divided||this._subdivide(),this._subs.some((e=>e.insert(t)))))}query(t,e,i){const n=i||[];if(!t.intersects(this.rectangle))return[];for(const r of this._points)!t.contains(r.position)&&Wo(t.position,r.position)>r.particle.getRadius()&&(!e||e(r.particle))||n.push(r.particle);if(this._divided)for(const r of this._subs)r.query(t,e,n);return n}queryCircle(t,e,i){return this.query(new ac(t.x,t.y,e),i)}queryRectangle(t,e,i){return this.query(new sc(t.x,t.y,e.width,e.height),i)}}const lc=t=>new sc(-t.width/4,-t.height/4,3*t.width/2,3*t.height/2);class hc{constructor(t,e){this._applyDensity=(t,e,i)=>{if(!t.number.density?.enable)return;const n=t.number,r=this._initDensityFactor(n.density),s=n.value,a=n.limit>0?n.limit:s,o=Math.min(s,a)*r+e,l=Math.min(this.count,this.filter((t=>t.group===i)).length);this.limit=n.limit*r,l<o?this.push(Math.abs(o-l),void 0,t,i):l>o&&this.removeQuantity(l-o,i)},this._initDensityFactor=t=>{const e=this._container;if(!e.canvas.element||!t.enable)return 1;const i=e.canvas.element,n=e.retina.pixelRatio;return i.width*i.height/(t.factor*n**2*t.area)},this._pushParticle=(t,e,i,n)=>{try{let r=this.pool.pop();r?r.init(this._nextId,t,e,i):r=new ic(this._engine,this._nextId,this._container,t,e,i);let s=!0;if(n&&(s=n(r)),!s)return;return this._array.push(r),this._zArray.push(r),this._nextId++,this._engine.dispatchEvent("particleAdded",{container:this._container,data:{particle:r}}),r}catch(Wk){return void Ko().warning(`${Po} adding particle: ${Wk}`)}},this._removeParticle=(t,e,i)=>{const n=this._array[t];if(!n||n.group!==e)return!1;n.destroy(i);const r=this._zArray.indexOf(n);return this._array.splice(t,1),this._zArray.splice(r,1),this.pool.push(n),this._engine.dispatchEvent("particleRemoved",{container:this._container,data:{particle:n}}),!0},this._engine=t,this._container=e,this._nextId=0,this._array=[],this._zArray=[],this.pool=[],this.limit=0,this.needsSort=!1,this.lastZIndex=0,this._interactionManager=new tc(t,e);const i=e.canvas.size;this.quadTree=new oc(lc(i),4),this.movers=this._engine.plugins.getMovers(e,!0),this.updaters=this._engine.plugins.getUpdaters(e,!0)}get count(){return this._array.length}addManualParticles(){const t=this._container,e=t.actualOptions;for(const i of e.manualParticles)this.addParticle(i.position?gl(i.position,t.canvas.size):void 0,i.options)}addParticle(t,e,i,n){const r=this._container.actualOptions.particles.number.limit;if(r>0){const t=this.count+1-r;t>0&&this.removeQuantity(t)}return this._pushParticle(t,e,i,n)}clear(){this._array=[],this._zArray=[]}destroy(){this._array=[],this._zArray=[],this.movers=[],this.updaters=[]}async draw(t){const e=this._container;e.canvas.clear(),await this.update(t);for(const[,i]of e.plugins)e.canvas.drawPlugin(i,t);for(const i of this._zArray)i.draw(t)}filter(t){return this._array.filter(t)}find(t){return this._array.find(t)}handleClickMode(t){this._interactionManager.handleClickMode(t)}init(){const t=this._container,e=t.actualOptions;this.lastZIndex=0,this.needsSort=!1;let i=!1;this.updaters=this._engine.plugins.getUpdaters(t,!0),this._interactionManager.init();for(const[,n]of t.plugins)if(void 0!==n.particlesInitialization&&(i=n.particlesInitialization()),i)break;this._interactionManager.init();for(const[,n]of t.pathGenerators)n.init(t);if(this.addManualParticles(),!i){for(const t in e.particles.groups){const i=e.particles.groups[t];for(let n=this.count,r=0;r<i.number?.value&&n<e.particles.number.value;n++,r++)this.addParticle(void 0,i,t)}for(let t=this.count;t<e.particles.number.value;t++)this.addParticle()}}push(t,e,i,n){this.pushing=!0;for(let r=0;r<t;r++)this.addParticle(e?.position,i,n);this.pushing=!1}async redraw(){this.clear(),this.init(),await this.draw({value:0,factor:0})}remove(t,e,i){this.removeAt(this._array.indexOf(t),void 0,e,i)}removeAt(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(t<0||t>this.count)return;let r=0;for(let s=t;r<e&&s<this.count;s++)this._removeParticle(s--,i,n)&&r++}removeQuantity(t,e){this.removeAt(0,t,e)}setDensity(){const t=this._container.actualOptions,e=t.particles.groups;for(const i in e)this._applyDensity(e[i],0,i);this._applyDensity(t.particles,t.manualParticles.length)}async update(t){const e=this._container,i=new Set;this.quadTree=new oc(lc(e.canvas.size),4);for(const[,n]of e.pathGenerators)n.update();for(const[,n]of e.plugins)n.update&&n.update(t);for(const n of this._array){const r=e.canvas.resizeFactor;r&&!n.ignoresResizeRatio&&(n.position.x*=r.width,n.position.y*=r.height,n.initialPosition.x*=r.width,n.initialPosition.y*=r.height),n.ignoresResizeRatio=!1,await this._interactionManager.reset(n);for(const[,e]of this._container.plugins){if(n.destroyed)break;e.particleUpdate&&e.particleUpdate(n,t)}for(const e of this.movers)e.isEnabled(n)&&e.move(n,t);n.destroyed?i.add(n):this.quadTree.insert(new nc(n.getPosition(),n))}if(i.size){const t=t=>!i.has(t);this._array=this.filter(t),this._zArray=this._zArray.filter(t),this.pool.push(...i)}await this._interactionManager.externalInteract(t);for(const n of this._array){for(const e of this.updaters)e.update(n,t);n.destroyed||n.spawning||await this._interactionManager.particlesInteract(n,t)}if(delete e.canvas.resizeFactor,this.needsSort){const t=this._zArray;t.sort(((t,e)=>e.position.z-t.position.z||t.id-e.id)),this.lastZIndex=t[t.length-1].position.z,this.needsSort=!1}}}class cc{constructor(t){this.container=t,this.pixelRatio=1,this.reduceFactor=1}init(){const t=this.container,e=t.actualOptions;this.pixelRatio=!e.detectRetina||Jo()?1:window.devicePixelRatio,this.reduceFactor=1;const i=this.pixelRatio;if(t.canvas.element){const e=t.canvas.element;t.canvas.size.width=e.offsetWidth*i,t.canvas.size.height=e.offsetHeight*i}const n=e.particles,r=n.move;this.attractDistance=No(r.attract.distance)*i,this.maxSpeed=No(r.gravity.maxSpeed)*i,this.sizeAnimationSpeed=No(n.size.animation.speed)*i}initParticle(t){const e=t.options,i=this.pixelRatio,n=e.move,r=n.distance,s=t.retina;s.attractDistance=No(n.attract.distance)*i,s.moveDrift=No(n.drift)*i,s.moveSpeed=No(n.speed)*i,s.sizeAnimationSpeed=No(e.size.animation.speed)*i;const a=s.maxDistance;a.horizontal=void 0!==r.horizontal?r.horizontal*i:void 0,a.vertical=void 0!==r.vertical?r.vertical*i:void 0,s.maxSpeed=No(n.gravity.maxSpeed)*i}}function uc(t){return t&&!t.destroyed}function dc(t,e){const i=new $h(t,e);for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];return Zh(i,...r),i}const pc={generate:t=>t.velocity,init:()=>{},update:()=>{},reset:()=>{}};class fc{constructor(t,e,i){this.id=e,this._intersectionManager=t=>{if(uc(this)&&this.actualOptions.pauseOnOutsideViewport)for(const e of t)e.target===this.interactivity.element&&(e.isIntersecting?this.play:this.pause)()},this._nextFrame=async t=>{try{if(!this.smooth&&void 0!==this.lastFrameTime&&t<this.lastFrameTime+1e3/this.fpsLimit)return void this.draw(!1);this.lastFrameTime??=t;const e=function(t){return{value:t,factor:arguments.length>2&&void 0!==arguments[2]&&arguments[2]?60/(arguments.length>1&&void 0!==arguments[1]?arguments[1]:60):60*t/1e3}}(t-this.lastFrameTime,this.fpsLimit,this.smooth);if(this.addLifeTime(e.value),this.lastFrameTime=t,e.value>1e3)return void this.draw(!1);if(await this.particles.draw(e),!this.alive())return void this.destroy();this.getAnimationStatus()&&this.draw(!1)}catch(Wk){Ko().error(`${Po} in animation loop`,Wk)}},this._engine=t,this.fpsLimit=120,this.smooth=!1,this._delay=0,this._duration=0,this._lifeTime=0,this._firstStart=!0,this.started=!1,this.destroyed=!1,this._paused=!0,this.lastFrameTime=0,this.zLayers=100,this.pageHidden=!1,this._sourceOptions=i,this._initialSourceOptions=i,this.retina=new cc(this),this.canvas=new ql(this),this.particles=new hc(this._engine,this),this.pathGenerators=new Map,this.interactivity={mouse:{clicking:!1,inside:!1}},this.plugins=new Map,this.drawers=new Map,this._options=dc(this._engine,this),this.actualOptions=dc(this._engine,this),this._eventListeners=new Xl(this),"undefined"!==typeof IntersectionObserver&&IntersectionObserver&&(this._intersectionObserver=new IntersectionObserver((t=>this._intersectionManager(t)))),this._engine.dispatchEvent("containerBuilt",{container:this})}get options(){return this._options}get sourceOptions(){return this._sourceOptions}addClickHandler(t){if(!uc(this))return;const e=this.interactivity.element;if(!e)return;const i=(e,i,n)=>{if(!uc(this))return;const r=this.retina.pixelRatio,s={x:i.x*r,y:i.y*r},a=this.particles.quadTree.queryCircle(s,n*r);t(e,a)};let n=!1,r=!1;e.addEventListener("click",(t=>{if(!uc(this))return;const e=t,n={x:e.offsetX||e.clientX,y:e.offsetY||e.clientY};i(t,n,1)})),e.addEventListener("touchstart",(()=>{uc(this)&&(n=!0,r=!1)})),e.addEventListener("touchmove",(()=>{uc(this)&&(r=!0)})),e.addEventListener("touchend",(t=>{if(uc(this)){if(n&&!r){const e=t;let n=e.touches[e.touches.length-1];if(!n&&(n=e.changedTouches[e.changedTouches.length-1],!n))return;const r=this.canvas.element,s=r?r.getBoundingClientRect():void 0,a={x:n.clientX-(s?s.left:0),y:n.clientY-(s?s.top:0)};i(t,a,Math.max(n.radiusX,n.radiusY))}n=!1,r=!1}})),e.addEventListener("touchcancel",(()=>{uc(this)&&(n=!1,r=!1)}))}addLifeTime(t){this._lifeTime+=t}addPath(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!(!uc(this)||!i&&this.pathGenerators.has(t))&&(this.pathGenerators.set(t,e??pc),!0)}alive(){return!this._duration||this._lifeTime<=this._duration}destroy(){if(!uc(this))return;this.stop(),this.particles.destroy(),this.canvas.destroy();for(const[,i]of this.drawers)i.destroy&&i.destroy(this);for(const i of this.drawers.keys())this.drawers.delete(i);this._engine.plugins.destroy(this),this.destroyed=!0;const t=this._engine.dom(),e=t.findIndex((t=>t===this));e>=0&&t.splice(e,1),this._engine.dispatchEvent("containerDestroyed",{container:this})}draw(t){if(!uc(this))return;let e=t;this._drawAnimationFrame=requestAnimationFrame((async t=>{e&&(this.lastFrameTime=void 0,e=!1),await this._nextFrame(t)}))}async export(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(const[,i]of this.plugins){if(!i.export)continue;const n=await i.export(t,e);if(n.supported)return n.blob}Ko().error(`${Po} - Export plugin with type ${t} not found`)}getAnimationStatus(){return!this._paused&&!this.pageHidden&&uc(this)}handleClickMode(t){if(uc(this)){this.particles.handleClickMode(t);for(const[,e]of this.plugins)e.handleClickMode&&e.handleClickMode(t)}}async init(){if(!uc(this))return;const t=this._engine.plugins.getSupportedShapes();for(const i of t){const t=this._engine.plugins.getShapeDrawer(i);t&&this.drawers.set(i,t)}this._options=dc(this._engine,this,this._initialSourceOptions,this.sourceOptions),this.actualOptions=dc(this._engine,this,this._options);const e=this._engine.plugins.getAvailablePlugins(this);for(const[i,n]of e)this.plugins.set(i,n);this.retina.init(),await this.canvas.init(),this.updateActualOptions(),this.canvas.initBackground(),this.canvas.resize(),this.zLayers=this.actualOptions.zLayers,this._duration=1e3*No(this.actualOptions.duration),this._delay=1e3*No(this.actualOptions.delay),this._lifeTime=0,this.fpsLimit=this.actualOptions.fpsLimit>0?this.actualOptions.fpsLimit:120,this.smooth=this.actualOptions.smooth;for(const[,i]of this.drawers)i.init&&await i.init(this);for(const[,i]of this.plugins)i.init&&await i.init();this._engine.dispatchEvent("containerInit",{container:this}),this.particles.init(),this.particles.setDensity();for(const[,i]of this.plugins)i.particlesSetup&&i.particlesSetup();this._engine.dispatchEvent("particlesSetup",{container:this})}async loadTheme(t){uc(this)&&(this._currentTheme=t,await this.refresh())}pause(){if(uc(this)&&(void 0!==this._drawAnimationFrame&&(cancelAnimationFrame(this._drawAnimationFrame),delete this._drawAnimationFrame),!this._paused)){for(const[,t]of this.plugins)t.pause&&t.pause();this.pageHidden||(this._paused=!0),this._engine.dispatchEvent("containerPaused",{container:this})}}play(t){if(!uc(this))return;const e=this._paused||t;if(!this._firstStart||this.actualOptions.autoPlay){if(this._paused&&(this._paused=!1),e)for(const[,t]of this.plugins)t.play&&t.play();this._engine.dispatchEvent("containerPlay",{container:this}),this.draw(e||!1)}else this._firstStart=!1}async refresh(){if(uc(this))return this.stop(),this.start()}async reset(){if(uc(this))return this._initialSourceOptions=void 0,this._options=dc(this._engine,this),this.actualOptions=dc(this._engine,this,this._options),this.refresh()}setNoise(t,e,i){uc(this)&&this.setPath(t,e,i)}setPath(t,e,i){if(!t||!uc(this))return;const n={...pc};if(xl(t))n.generate=t,e&&(n.init=e),i&&(n.update=i);else{const e=n;n.generate=t.generate||e.generate,n.init=t.init||e.init,n.update=t.update||e.update}this.addPath("default",n,!0)}async start(){uc(this)&&!this.started&&(await this.init(),this.started=!0,await new Promise((t=>{this._delayTimeout=setTimeout((async()=>{this._eventListeners.addListeners(),this.interactivity.element instanceof HTMLElement&&this._intersectionObserver&&this._intersectionObserver.observe(this.interactivity.element);for(const[,t]of this.plugins)t.start&&await t.start();this._engine.dispatchEvent("containerStarted",{container:this}),this.play(),t()}),this._delay)})))}stop(){if(uc(this)&&this.started){this._delayTimeout&&(clearTimeout(this._delayTimeout),delete this._delayTimeout),this._firstStart=!0,this.started=!1,this._eventListeners.removeListeners(),this.pause(),this.particles.clear(),this.canvas.stop(),this.interactivity.element instanceof HTMLElement&&this._intersectionObserver&&this._intersectionObserver.unobserve(this.interactivity.element);for(const[,t]of this.plugins)t.stop&&t.stop();for(const t of this.plugins.keys())this.plugins.delete(t);this._sourceOptions=this._options,this._engine.dispatchEvent("containerStopped",{container:this})}}updateActualOptions(){this.actualOptions.responsive=[];const t=this.actualOptions.setResponsive(this.canvas.size.width,this.retina.pixelRatio,this._options);return this.actualOptions.setTheme(this._currentTheme),this.responsiveMaxWidth!==t&&(this.responsiveMaxWidth=t,!0)}}class mc{constructor(){this._listeners=new Map}addEventListener(t,e){this.removeEventListener(t,e);let i=this._listeners.get(t);i||(i=[],this._listeners.set(t,i)),i.push(e)}dispatchEvent(t,e){const i=this._listeners.get(t);i&&i.forEach((t=>t(e)))}hasEventListener(t){return!!this._listeners.get(t)}removeAllEventListeners(t){t?this._listeners.delete(t):this._listeners=new Map}removeEventListener(t,e){const i=this._listeners.get(t);if(!i)return;const n=i.length,r=i.indexOf(e);r<0||(1===n?this._listeners.delete(t):i.splice(r,1))}}function gc(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=e.get(t);return r&&!n||(r=[...i.values()].map((e=>e(t))),e.set(t,r)),r}class vc{constructor(t){this._engine=t,this.plugins=[],this._initializers={interactors:new Map,movers:new Map,updaters:new Map},this.interactors=new Map,this.movers=new Map,this.updaters=new Map,this.presets=new Map,this.drawers=new Map,this.pathGenerators=new Map}addInteractor(t,e){this._initializers.interactors.set(t,e)}addParticleMover(t,e){this._initializers.movers.set(t,e)}addParticleUpdater(t,e){this._initializers.updaters.set(t,e)}addPathGenerator(t,e){!this.getPathGenerator(t)&&this.pathGenerators.set(t,e)}addPlugin(t){!this.getPlugin(t.id)&&this.plugins.push(t)}addPreset(t,e){(arguments.length>2&&void 0!==arguments[2]&&arguments[2]||!this.getPreset(t))&&this.presets.set(t,e)}addShapeDrawer(t,e){ul(t,(t=>{!this.getShapeDrawer(t)&&this.drawers.set(t,e)}))}destroy(t){this.updaters.delete(t),this.movers.delete(t),this.interactors.delete(t)}getAvailablePlugins(t){const e=new Map;for(const i of this.plugins)i.needsPlugin(t.actualOptions)&&e.set(i.id,i.getPlugin(t));return e}getInteractors(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return gc(t,this.interactors,this._initializers.interactors,e)}getMovers(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return gc(t,this.movers,this._initializers.movers,e)}getPathGenerator(t){return this.pathGenerators.get(t)}getPlugin(t){return this.plugins.find((e=>e.id===t))}getPreset(t){return this.presets.get(t)}getShapeDrawer(t){return this.drawers.get(t)}getSupportedShapes(){return this.drawers.keys()}getUpdaters(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return gc(t,this.updaters,this._initializers.updaters,e)}loadOptions(t,e){for(const i of this.plugins)i.loadOptions(t,e)}loadParticlesOptions(t,e){const i=this.updaters.get(t);if(i){for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];for(const t of i)t.loadOptions&&t.loadOptions(e,...r)}}}class yc{constructor(){this._configs=new Map,this._domArray=[],this._eventDispatcher=new mc,this._initialized=!1,this.plugins=new vc(this)}get configs(){const t={};for(const[e,i]of this._configs)t[e]=i;return t}get version(){return"2.12.0"}addConfig(t,e){yl(t)?e&&(e.name=t,this._configs.set(t,e)):this._configs.set(t.name??"default",t)}addEventListener(t,e){this._eventDispatcher.addEventListener(t,e)}async addInteractor(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.plugins.addInteractor(t,e),await this.refresh(i)}async addMover(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.plugins.addParticleMover(t,e),await this.refresh(i)}async addParticleUpdater(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.plugins.addParticleUpdater(t,e),await this.refresh(i)}async addPathGenerator(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.plugins.addPathGenerator(t,e),await this.refresh(i)}async addPlugin(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.plugins.addPlugin(t),await this.refresh(e)}async addPreset(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.plugins.addPreset(t,e,i),await this.refresh(n)}async addShape(t,e,i,n,r){let s,a,o,l,h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];vl(i)?(h=i,a=void 0):a=i,vl(n)?(h=n,o=void 0):o=n,vl(r)?(h=r,l=void 0):l=r,s=xl(e)?{afterEffect:o,destroy:l,draw:e,init:a}:e,this.plugins.addShapeDrawer(t,s),await this.refresh(h)}dispatchEvent(t,e){this._eventDispatcher.dispatchEvent(t,e)}dom(){return this._domArray}domItem(t){const e=this.dom(),i=e[t];if(i&&!i.destroyed)return i;e.splice(t,1)}init(){this._initialized||(this._initialized=!0)}async load(t,e){return this.loadFromArray(t,e)}async loadFromArray(t,e,i){let n;return!function(t){return!(!(e=t).id&&!e.element&&!e.url&&!e.options);var e}(t)?(n={},yl(t)?n.id=t:n.options=t,bl(e)?n.index=e:n.options=e??n.options,n.index=i??n.index):n=t,this._loadParams(n)}async loadJSON(t,e,i){let n,r;return bl(e)||void 0===e?n=t:(r=t,n=e),this._loadParams({id:r,url:n,index:i})}async refresh(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&this.dom().forEach((t=>t.refresh()))}removeEventListener(t,e){this._eventDispatcher.removeEventListener(t,e)}async set(t,e,i,n){const r={index:n};return yl(t)?r.id=t:r.element=t,e instanceof HTMLElement?r.element=e:r.options=e,bl(i)?r.index=i:r.options=i??r.options,this._loadParams(r)}async setJSON(t,e,i,n){const r={};return t instanceof HTMLElement?(r.element=t,r.url=e,r.index=i):(r.id=t,r.element=e,r.url=i,r.index=n),this._loadParams(r)}setOnClickHandler(t){const e=this.dom();if(!e.length)throw new Error(`${Po} can only set click handlers after calling tsParticles.load()`);for(const i of e)i.addClickHandler(t)}async _loadParams(t){const e=t.id??`tsparticles${Math.floor(1e4*Lo())}`,{index:i,url:n}=t,r=n?await async function(t){const e=dl(t.url,t.index);if(!e)return t.fallback;const i=await fetch(e);return i.ok?i.json():(Ko().error(`${Po} ${i.status} while retrieving config file`),t.fallback)}({fallback:t.options,url:n,index:i}):t.options;let s=t.element??document.getElementById(e);s||(s=document.createElement("div"),s.id=e,document.body.append(s));const a=dl(r,i),o=this.dom(),l=o.findIndex((t=>t.id===e));if(l>=0){const t=this.domItem(l);t&&!t.destroyed&&(t.destroy(),o.splice(l,1))}let h;if("canvas"===s.tagName.toLowerCase())h=s,h.dataset[Eo]="false";else{const t=s.getElementsByTagName("canvas");t.length?(h=t[0],h.dataset[Eo]="false"):(h=document.createElement("canvas"),h.dataset[Eo]="true",s.appendChild(h))}h.style.width||(h.style.width="100%"),h.style.height||(h.style.height="100%");const c=new fc(this,e,a);return l>=0?o.splice(l,0,c):o.push(c),c.canvas.loadCanvas(h),await c.start(),c}}class bc{constructor(){this.key="hsl",this.stringPrefix="hsl"}handleColor(t){const e=t.value.hsl??t.value;if(void 0!==e.h&&void 0!==e.s&&void 0!==e.l)return Rl(e)}handleRangeColor(t){const e=t.value.hsl??t.value;if(void 0!==e.h&&void 0!==e.l)return Rl({h:No(e.h),l:No(e.l),s:No(e.s)})}parseString(t){if(!t.startsWith("hsl"))return;const e=/hsla?\(\s*(\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([\d.%]+)\s*)?\)/i.exec(t);return e?function(t){const e=Rl(t);return{a:t.a,b:e.b,g:e.g,r:e.r}}({a:e.length>4?Xo(e[5]):1,h:parseInt(e[1],10),l:parseInt(e[3],10),s:parseInt(e[2],10)}):void 0}}class xc{constructor(){this.key="rgb",this.stringPrefix="rgb"}handleColor(t){const e=t.value.rgb??t.value;if(void 0!==e.r)return e}handleRangeColor(t){const e=t.value.rgb??t.value;if(void 0!==e.r)return{r:No(e.r),g:No(e.g),b:No(e.b)}}parseString(t){if(!t.startsWith(this.stringPrefix))return;const e=/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([\d.%]+)\s*)?\)/i.exec(t);return e?{a:e.length>4?Xo(e[5]):1,b:parseInt(e[3],10),g:parseInt(e[2],10),r:parseInt(e[1],10)}:void 0}}const wc=function(){const t=new xc,e=new bc;Cl(t),Cl(e);const i=new yc;return i.init(),i}();Jo()||(window.tsParticles=wc);const Sc=t=>"object"===typeof t&&null!==t;function Ac(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!1;if(!Sc(t)||!Sc(e))return t===e;const n=Object.keys(t).filter((t=>!i(t))),r=Object.keys(e).filter((t=>!i(t)));if(n.length!==r.length)return!1;for(const s of n){const n=t[s],r=e[s];if(Sc(n)&&Sc(r)){if(n===e&&r===t)continue;if(!Ac(n,r,i))return!1}else if(Array.isArray(n)&&Array.isArray(r)){if(!Ec(n,r,i))return!1}else if(n!==r)return!1}return!0}function Ec(t,e,i){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++){const r=t[n],s=e[n];if(Array.isArray(r)&&Array.isArray(s)){if(!Ec(r,s,i))return!1}else if(Sc(r)&&Sc(s)){if(!Ac(r,s,i))return!1}else if(r!==s)return!1}return!0}const _c="tsparticles";class Cc extends t.Component{constructor(t){super(t),this.state={init:!1,library:void 0}}destroy(){this.state.library&&(this.state.library.destroy(),this.setState({library:void 0}))}shouldComponentUpdate(t){const e=t.options??t.params,i=this.props.options??this.props.params;return t.url!==this.props.url||t.id!==this.props.id||t.canvasClassName!==this.props.canvasClassName||t.className!==this.props.className||t.height!==this.props.height||t.width!==this.props.width||!Ac(t.style,this.props.style)||t.init!==this.props.init||t.loaded!==this.props.loaded||!Ac(e,i,(t=>t.startsWith("_")))}componentDidUpdate(){this.refresh()}forceUpdate(){this.refresh().then((()=>{super.forceUpdate()}))}componentDidMount(){(async()=>{this.props.init&&await this.props.init(wc),this.setState({init:!0},(async()=>{await this.loadParticles()}))})()}componentWillUnmount(){this.destroy()}render(){const{width:e,height:i,className:n,canvasClassName:r,id:s}=this.props;return t.createElement("div",{className:n,id:s},t.createElement("canvas",{className:r,style:{...this.props.style,width:e,height:i}}))}async refresh(){this.destroy(),await this.loadParticles()}async loadParticles(){if(!this.state.init)return;const t=this.props.id??Cc.defaultProps.id??_c,e=await wc.load({url:this.props.url,id:t,options:this.props.options??this.props.params});this.props.container&&(this.props.container.current=e),this.setState({library:e}),this.props.loaded&&await this.props.loaded(e)}}Cc.defaultProps={width:"100%",height:"100%",options:{},style:{},url:void 0,id:_c};const Mc=Cc;class Pc{static init(t){const e=new Pc,i=t.selector;if(!i)throw new Error("No selector provided");const n=document.querySelector(i);if(!n)throw new Error("No element found for selector");return wc.set(i.replace(".","").replace("!",""),n,{fullScreen:{enable:!1},particles:{color:{value:t.color??"!000000"},links:{color:"random",distance:t.minDistance??120,enable:t.connectParticles??!1},move:{enable:!0,speed:t.speed??.5},number:{value:t.maxParticles??100},size:{value:{min:1,max:t.sizeVariations??3}}},responsive:t.responsive?.map((e=>({maxWidth:e.breakpoint,options:{particles:{color:{value:e.options?.color},links:{distance:e.options?.minDistance,enable:e.options?.connectParticles},number:{value:t.maxParticles},move:{enable:!0,speed:e.options?.speed},size:{value:e.options?.sizeVariations}}}})))}).then((t=>{e._container=t})),e}destroy(){const t=this._container;t&&t.destroy()}pauseAnimation(){const t=this._container;t&&t.pause()}resumeAnimation(){const t=this._container;t&&t.play()}}function Tc(t,e,i,n,r,s){!function(t,e){const i=t.options,n=i.move.path;if(!n.enable)return;if(t.lastPathTime<=t.pathDelay)return void(t.lastPathTime+=e.value);const r=t.pathGenerator?.generate(t,e);r&&t.velocity.addTo(r);n.clamp&&(t.velocity.x=Bo(t.velocity.x,-1,1),t.velocity.y=Bo(t.velocity.y,-1,1));t.lastPathTime-=t.pathDelay}(t,s);const a=t.gravity,o=a?.enable&&a.inverse?-1:1;r&&i&&(t.velocity.x+=r*s.factor/(60*i)),a?.enable&&i&&(t.velocity.y+=o*(a.acceleration*s.factor)/(60*i));const l=t.moveDecay;t.velocity.multTo(l);const h=t.velocity.mult(i);a?.enable&&n>0&&(!a.inverse&&h.y>=0&&h.y>=n||a.inverse&&h.y<=0&&h.y<=-n)&&(h.y=o*n,i&&(t.velocity.y=h.y/i));const c=t.options.zIndex,u=(1-t.zIndexFactor)**c.velocityRate;h.multTo(u);const{position:d}=t;d.addTo(h),e.vibrate&&(d.x+=Math.sin(d.x*Math.cos(d.y)),d.y+=Math.cos(d.y*Math.sin(d.x)))}class Dc{constructor(){this._initSpin=t=>{const e=t.container,i=t.options.move.spin;if(!i.enable)return;const n=i.position??{x:50,y:50},r={x:n.x/100*e.canvas.size.width,y:n.y/100*e.canvas.size.height},s=Wo(t.getPosition(),r),a=No(i.acceleration);t.retina.spinAcceleration=a*e.retina.pixelRatio,t.spin={center:r,direction:t.velocity.x>=0?"clockwise":"counter-clockwise",angle:t.velocity.angle,radius:s,acceleration:t.retina.spinAcceleration}}}init(t){const e=t.options.move.gravity;t.gravity={enable:e.enable,acceleration:No(e.acceleration),inverse:e.inverse},this._initSpin(t)}isEnabled(t){return!t.destroyed&&t.options.move.enable}move(t,e){const i=t.options,n=i.move;if(!n.enable)return;const r=t.container,s=r.retina.pixelRatio,a=function(t){return t.slow.inRange?t.slow.factor:1}(t),o=(t.retina.moveSpeed??=No(n.speed)*s)*r.retina.reduceFactor,l=t.retina.moveDrift??=No(t.options.move.drift)*s,h=Vo(i.size.value)*s,c=o*(n.size?t.getRadius()/h:1)*a*(e.factor||1)/2,u=t.retina.maxSpeed??r.retina.maxSpeed;n.spin.enable?function(t,e){const i=t.container;if(!t.spin)return;const n={x:"clockwise"===t.spin.direction?Math.cos:Math.sin,y:"clockwise"===t.spin.direction?Math.sin:Math.cos};t.position.x=t.spin.center.x+t.spin.radius*n.x(t.spin.angle),t.position.y=t.spin.center.y+t.spin.radius*n.y(t.spin.angle),t.spin.radius+=t.spin.acceleration;const r=Math.max(i.canvas.size.width,i.canvas.size.height);t.spin.radius>r/2?(t.spin.radius=r/2,t.spin.acceleration*=-1):t.spin.radius<0&&(t.spin.radius=0,t.spin.acceleration*=-1),t.spin.angle+=e/100*(1-t.spin.radius/r)}(t,c):Tc(t,n,c,u,l,e),function(t){const e=t.initialPosition,{dx:i,dy:n}=Ho(e,t.position),r=Math.abs(i),s=Math.abs(n),{maxDistance:a}=t.retina,o=a.horizontal,l=a.vertical;if(o||l)if((o&&r>=o||l&&s>=l)&&!t.misplaced)t.misplaced=!!o&&r>o||!!l&&s>l,o&&(t.velocity.x=t.velocity.y/2-t.velocity.x),l&&(t.velocity.y=t.velocity.x/2-t.velocity.y);else if((!o||r<o)&&(!l||s<l)&&t.misplaced)t.misplaced=!1;else if(t.misplaced){const i=t.position,n=t.velocity;o&&(i.x<e.x&&n.x<0||i.x>e.x&&n.x>0)&&(n.x*=-Lo()),l&&(i.y<e.y&&n.y<0||i.y>e.y&&n.y>0)&&(n.y*=-Lo())}}(t)}}class kc{draw(t,e,i){e.circleRange||(e.circleRange={min:0,max:2*Math.PI});const n=e.circleRange;t.arc(0,0,i,n.min,n.max,!1)}getSidesCount(){return 12}particleInit(t,e){const i=e.shapeData,n=i?.angle??{max:360,min:0};e.circleRange=wl(n)?{min:n.min*Math.PI/180,max:n.max*Math.PI/180}:{min:0,max:n*Math.PI/180}}}function Ic(t,e,i,n,r){if(!e||!i.enable||(e.maxLoops??0)>0&&(e.loops??0)>(e.maxLoops??0))return;if(e.time||(e.time=0),(e.delayTime??0)>0&&e.time<(e.delayTime??0)&&(e.time+=t.value),(e.delayTime??0)>0&&e.time<(e.delayTime??0))return;const s=Fo(i.offset),a=(e.velocity??0)*t.factor+3.6*s,o=e.decay??1;r&&"increasing"!==e.status?(e.value-=a,e.value<0&&(e.loops||(e.loops=0),e.loops++,e.status="increasing",e.value+=e.value)):(e.value+=a,e.value>n&&(e.loops||(e.loops=0),e.loops++,r&&(e.status="decreasing",e.value-=e.value%n))),e.velocity&&1!==o&&(e.velocity*=o),e.value>n&&(e.value%=n)}class Rc{constructor(t){this.container=t}init(t){const e=kl(t.options.color,t.id,t.options.reduceDuplicates);e&&(t.color=Vl(e,t.options.color.animation,this.container.retina.reduceFactor))}isEnabled(t){const{h:e,s:i,l:n}=t.options.color.animation,{color:r}=t;return!t.destroyed&&!t.spawning&&(void 0!==r?.h.value&&e.enable||void 0!==r?.s.value&&i.enable||void 0!==r?.l.value&&n.enable)}update(t,e){!function(t,e){const{h:i,s:n,l:r}=t.options.color.animation,{color:s}=t;if(!s)return;const{h:a,s:o,l:l}=s;a&&Ic(e,a,i,360,!1),o&&Ic(e,o,n,100,!0),l&&Ic(e,l,r,100,!0)}(t,e)}}class Oc{constructor(t){this.container=t}init(t){const e=t.options.opacity;t.opacity=fl(e,1);const i=e.animation;i.enable&&(t.opacity.velocity=No(i.speed)/100*this.container.retina.reduceFactor,i.sync||(t.opacity.velocity*=Lo()))}isEnabled(t){return!t.destroyed&&!t.spawning&&!!t.opacity&&t.opacity.enable&&((t.opacity.maxLoops??0)<=0||(t.opacity.maxLoops??0)>0&&(t.opacity.loops??0)<(t.opacity.maxLoops??0))}reset(t){t.opacity&&(t.opacity.time=0,t.opacity.loops=0)}update(t,e){this.isEnabled(t)&&function(t,e){const i=t.opacity;if(t.destroyed||!i?.enable||(i.maxLoops??0)>0&&(i.loops??0)>(i.maxLoops??0))return;const n=i.min,r=i.max,s=i.decay??1;if(i.time||(i.time=0),(i.delayTime??0)>0&&i.time<(i.delayTime??0)&&(i.time+=e.value),!((i.delayTime??0)>0&&i.time<(i.delayTime??0))){switch(i.status){case"increasing":i.value>=r?(i.status="decreasing",i.loops||(i.loops=0),i.loops++):i.value+=(i.velocity??0)*e.factor;break;case"decreasing":i.value<=n?(i.status="increasing",i.loops||(i.loops=0),i.loops++):i.value-=(i.velocity??0)*e.factor}i.velocity&&1!==i.decay&&(i.velocity*=s),function(t,e,i,n){switch(t.options.opacity.animation.destroy){case"max":e>=n&&t.destroy();break;case"min":e<=i&&t.destroy()}}(t,i.value,n,r),t.destroyed||(i.value=Bo(i.value,n,r))}}(t,e)}}class Lc{constructor(t){this.container=t,this.modes=["bounce","bounce-vertical","bounce-horizontal","bounceVertical","bounceHorizontal","split"]}update(t,e,i,n){if(!this.modes.includes(n))return;const r=this.container;let s=!1;for(const[,u]of r.plugins)if(void 0!==u.particleBounce&&(s=u.particleBounce(t,i,e)),s)break;if(s)return;const a=t.getPosition(),o=t.offset,l=t.getRadius(),h=nl(a,l),c=r.canvas.size;!function(t){if("bounce"!==t.outMode&&"bounce-horizontal"!==t.outMode&&"bounceHorizontal"!==t.outMode&&"split"!==t.outMode||"left"!==t.direction&&"right"!==t.direction)return;t.bounds.right<0&&"left"===t.direction?t.particle.position.x=t.size+t.offset.x:t.bounds.left>t.canvasSize.width&&"right"===t.direction&&(t.particle.position.x=t.canvasSize.width-t.size-t.offset.x);const e=t.particle.velocity.x;let i=!1;if("right"===t.direction&&t.bounds.right>=t.canvasSize.width&&e>0||"left"===t.direction&&t.bounds.left<=0&&e<0){const e=Go(t.particle.options.bounce.horizontal);t.particle.velocity.x*=-e,i=!0}if(!i)return;const n=t.offset.x+t.size;t.bounds.right>=t.canvasSize.width&&"right"===t.direction?t.particle.position.x=t.canvasSize.width-n:t.bounds.left<=0&&"left"===t.direction&&(t.particle.position.x=n),"split"===t.outMode&&t.particle.destroy()}({particle:t,outMode:n,direction:e,bounds:h,canvasSize:c,offset:o,size:l}),function(t){if("bounce"!==t.outMode&&"bounce-vertical"!==t.outMode&&"bounceVertical"!==t.outMode&&"split"!==t.outMode||"bottom"!==t.direction&&"top"!==t.direction)return;t.bounds.bottom<0&&"top"===t.direction?t.particle.position.y=t.size+t.offset.y:t.bounds.top>t.canvasSize.height&&"bottom"===t.direction&&(t.particle.position.y=t.canvasSize.height-t.size-t.offset.y);const e=t.particle.velocity.y;let i=!1;if("bottom"===t.direction&&t.bounds.bottom>=t.canvasSize.height&&e>0||"top"===t.direction&&t.bounds.top<=0&&e<0){const e=Go(t.particle.options.bounce.vertical);t.particle.velocity.y*=-e,i=!0}if(!i)return;const n=t.offset.y+t.size;t.bounds.bottom>=t.canvasSize.height&&"bottom"===t.direction?t.particle.position.y=t.canvasSize.height-n:t.bounds.top<=0&&"top"===t.direction&&(t.particle.position.y=n),"split"===t.outMode&&t.particle.destroy()}({particle:t,outMode:n,direction:e,bounds:h,canvasSize:c,offset:o,size:l})}}class Bc{constructor(t){this.container=t,this.modes=["destroy"]}update(t,e,i,n){if(!this.modes.includes(n))return;const r=this.container;switch(t.outType){case"normal":case"outside":if(il(t.position,r.canvas.size,Do.origin,t.getRadius(),e))return;break;case"inside":{const{dx:e,dy:i}=Ho(t.position,t.moveCenter),{x:n,y:r}=t.velocity;if(n<0&&e>t.moveCenter.radius||r<0&&i>t.moveCenter.radius||n>=0&&e<-t.moveCenter.radius||r>=0&&i<-t.moveCenter.radius)return;break}}r.particles.remove(t,void 0,!0)}}class zc{constructor(t){this.container=t,this.modes=["none"]}update(t,e,i,n){if(!this.modes.includes(n))return;if(t.options.move.distance.horizontal&&("left"===e||"right"===e)||t.options.move.distance.vertical&&("top"===e||"bottom"===e))return;const r=t.options.move.gravity,s=this.container,a=s.canvas.size,o=t.getRadius();if(r.enable){const i=t.position;(!r.inverse&&i.y>a.height+o&&"bottom"===e||r.inverse&&i.y<-o&&"top"===e)&&s.particles.remove(t)}else{if(t.velocity.y>0&&t.position.y<=a.height+o||t.velocity.y<0&&t.position.y>=-o||t.velocity.x>0&&t.position.x<=a.width+o||t.velocity.x<0&&t.position.x>=-o)return;il(t.position,s.canvas.size,Do.origin,o,e)||s.particles.remove(t)}}}class Fc{constructor(t){this.container=t,this.modes=["out"]}update(t,e,i,n){if(!this.modes.includes(n))return;const r=this.container;switch(t.outType){case"inside":{const{x:e,y:i}=t.velocity,n=Do.origin;n.length=t.moveCenter.radius,n.angle=t.velocity.angle+Math.PI,n.addTo(Do.create(t.moveCenter));const{dx:s,dy:a}=Ho(t.position,n);if(e<=0&&s>=0||i<=0&&a>=0||e>=0&&s<=0||i>=0&&a<=0)return;t.position.x=Math.floor(Fo({min:0,max:r.canvas.size.width})),t.position.y=Math.floor(Fo({min:0,max:r.canvas.size.height}));const{dx:o,dy:l}=Ho(t.position,t.moveCenter);t.direction=Math.atan2(-l,-o),t.velocity.angle=t.direction;break}default:if(il(t.position,r.canvas.size,Do.origin,t.getRadius(),e))return;switch(t.outType){case"outside":{t.position.x=Math.floor(Fo({min:-t.moveCenter.radius,max:t.moveCenter.radius}))+t.moveCenter.x,t.position.y=Math.floor(Fo({min:-t.moveCenter.radius,max:t.moveCenter.radius}))+t.moveCenter.y;const{dx:e,dy:i}=Ho(t.position,t.moveCenter);t.moveCenter.radius&&(t.direction=Math.atan2(i,e),t.velocity.angle=t.direction);break}case"normal":{const i=t.options.move.warp,n=r.canvas.size,s={bottom:n.height+t.getRadius()+t.offset.y,left:-t.getRadius()-t.offset.x,right:n.width+t.getRadius()+t.offset.x,top:-t.getRadius()-t.offset.y},a=t.getRadius(),o=nl(t.position,a);"right"===e&&o.left>n.width+t.offset.x?(t.position.x=s.left,t.initialPosition.x=t.position.x,i||(t.position.y=Lo()*n.height,t.initialPosition.y=t.position.y)):"left"===e&&o.right<-t.offset.x&&(t.position.x=s.right,t.initialPosition.x=t.position.x,i||(t.position.y=Lo()*n.height,t.initialPosition.y=t.position.y)),"bottom"===e&&o.top>n.height+t.offset.y?(i||(t.position.x=Lo()*n.width,t.initialPosition.x=t.position.x),t.position.y=s.top,t.initialPosition.y=t.position.y):"top"===e&&o.bottom<-t.offset.y&&(i||(t.position.x=Lo()*n.width,t.initialPosition.x=t.position.x),t.position.y=s.bottom,t.initialPosition.y=t.position.y);break}}}}}class Nc{constructor(t){this.container=t,this._updateOutMode=(t,e,i,n)=>{for(const r of this.updaters)r.update(t,n,e,i)},this.updaters=[new Lc(t),new Bc(t),new Fc(t),new zc(t)]}init(){}isEnabled(t){return!t.destroyed&&!t.spawning}update(t,e){const i=t.options.move.outModes;this._updateOutMode(t,e,i.bottom??i.default,"bottom"),this._updateOutMode(t,e,i.left??i.default,"left"),this._updateOutMode(t,e,i.right??i.default,"right"),this._updateOutMode(t,e,i.top??i.default,"top")}}class Uc{init(t){const e=t.container,i=t.options.size.animation;i.enable&&(t.size.velocity=(t.retina.sizeAnimationSpeed??e.retina.sizeAnimationSpeed)/100*e.retina.reduceFactor,i.sync||(t.size.velocity*=Lo()))}isEnabled(t){return!t.destroyed&&!t.spawning&&t.size.enable&&((t.size.maxLoops??0)<=0||(t.size.maxLoops??0)>0&&(t.size.loops??0)<(t.size.maxLoops??0))}reset(t){t.size.loops=0}update(t,e){this.isEnabled(t)&&function(t,e){const i=t.size;if(t.destroyed||!i||!i.enable||(i.maxLoops??0)>0&&(i.loops??0)>(i.maxLoops??0))return;const n=(i.velocity??0)*e.factor,r=i.min,s=i.max,a=i.decay??1;if(i.time||(i.time=0),(i.delayTime??0)>0&&i.time<(i.delayTime??0)&&(i.time+=e.value),!((i.delayTime??0)>0&&i.time<(i.delayTime??0))){switch(i.status){case"increasing":i.value>=s?(i.status="decreasing",i.loops||(i.loops=0),i.loops++):i.value+=n;break;case"decreasing":i.value<=r?(i.status="increasing",i.loops||(i.loops=0),i.loops++):i.value-=n}i.velocity&&1!==a&&(i.velocity*=a),function(t,e,i,n){switch(t.options.size.animation.destroy){case"max":e>=n&&t.destroy();break;case"min":e<=i&&t.destroy()}}(t,i.value,r,s),t.destroyed||(i.value=Bo(i.value,r,s))}}(t,e)}}async function Vc(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addMover("base",(()=>new Dc),e)}(t,!1),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addShape("circle",new kc,e)}(t,!1),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addParticleUpdater("color",(t=>new Rc(t)),e)}(t,!1),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addParticleUpdater("opacity",(t=>new Oc(t)),e)}(t,!1),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addParticleUpdater("outModes",(t=>new Nc(t)),e)}(t,!1),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addParticleUpdater("size",(()=>new Uc),e)}(t,!1),await t.refresh(e)}class jc{constructor(t){this.container=t,this.type="external"}}class Gc{constructor(){this.distance=200,this.duration=.4,this.easing="ease-out-quad",this.factor=1,this.maxSpeed=50,this.speed=1}load(t){t&&(void 0!==t.distance&&(this.distance=t.distance),void 0!==t.duration&&(this.duration=t.duration),void 0!==t.easing&&(this.easing=t.easing),void 0!==t.factor&&(this.factor=t.factor),void 0!==t.maxSpeed&&(this.maxSpeed=t.maxSpeed),void 0!==t.speed&&(this.speed=t.speed))}}class Hc extends jc{constructor(t,e){super(e),this._clickAttract=()=>{const t=this.container;t.attract||(t.attract={particles:[]});const{attract:e}=t;if(e.finish||(e.count||(e.count=0),e.count++,e.count===t.particles.count&&(e.finish=!0)),e.clicking){const e=t.interactivity.mouse.clickPosition,i=t.retina.attractModeDistance;if(!i||i<0||!e)return;this._processAttract(e,i,new ac(e.x,e.y,i))}else!1===e.clicking&&(e.particles=[])},this._hoverAttract=()=>{const t=this.container,e=t.interactivity.mouse.position,i=t.retina.attractModeDistance;!i||i<0||!e||this._processAttract(e,i,new ac(e.x,e.y,i))},this._processAttract=(t,e,i)=>{const n=this.container,r=n.actualOptions.interactivity.modes.attract;if(!r)return;const s=n.particles.quadTree.query(i,(t=>this.isEnabled(t)));for(const a of s){const{dx:i,dy:n,distance:s}=Ho(a.position,t),o=r.speed*r.factor,l=Bo(Oo(r.easing)(1-s/e)*o,0,r.maxSpeed),h=Do.create(0===s?o:i/s*l,0===s?o:n/s*l);a.position.subFrom(h)}},this._engine=t,e.attract||(e.attract={particles:[]}),this.handleClickMode=t=>{const i=this.container.actualOptions.interactivity.modes.attract;if(i&&"attract"===t){e.attract||(e.attract={particles:[]}),e.attract.clicking=!0,e.attract.count=0;for(const t of e.attract.particles)this.isEnabled(t)&&t.velocity.setTo(t.initialVelocity);e.attract.particles=[],e.attract.finish=!1,setTimeout((()=>{e.destroyed||(e.attract||(e.attract={particles:[]}),e.attract.clicking=!1)}),1e3*i.duration)}}}clear(){}init(){const t=this.container,e=t.actualOptions.interactivity.modes.attract;e&&(t.retina.attractModeDistance=e.distance*t.retina.pixelRatio)}async interact(){const t=this.container,e=t.actualOptions,i=t.interactivity.status===Co,n=e.interactivity.events,r=n.onHover.enable,s=n.onHover.mode,a=n.onClick.enable,o=n.onClick.mode;i&&r&&tl("attract",s)?this._hoverAttract():a&&tl("attract",o)&&this._clickAttract()}isEnabled(t){const e=this.container,i=e.actualOptions,n=e.interactivity.mouse,r=(t?.interactivity??i.interactivity).events;if((!n.position||!r.onHover.enable)&&(!n.clickPosition||!r.onClick.enable))return!1;const s=r.onHover.mode,a=r.onClick.mode;return tl("attract",s)||tl("attract",a)}loadModeOptions(t){t.attract||(t.attract=new Gc);for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(const r of i)t.attract.load(r?.attract)}reset(){}}class Wc{constructor(){this.distance=200}load(t){t&&void 0!==t.distance&&(this.distance=t.distance)}}class qc extends jc{constructor(t){super(t),this._processBounce=(t,e,i)=>{const n=this.container.particles.quadTree.query(i,(t=>this.isEnabled(t)));for(const r of n)i instanceof ac?hl(ll(r),{position:t,radius:e,mass:e**2*Math.PI/2,velocity:Do.origin,factor:Do.origin}):i instanceof sc&&cl(r,nl(t,e))},this._processMouseBounce=()=>{const t=this.container,e=10*t.retina.pixelRatio,i=t.interactivity.mouse.position,n=t.retina.bounceModeDistance;!n||n<0||!i||this._processBounce(i,n,new ac(i.x,i.y,n+e))},this._singleSelectorBounce=(t,e)=>{const i=this.container,n=document.querySelectorAll(t);n.length&&n.forEach((t=>{const n=t,r=i.retina.pixelRatio,s={x:(n.offsetLeft+n.offsetWidth/2)*r,y:(n.offsetTop+n.offsetHeight/2)*r},a=n.offsetWidth/2*r,o=10*r,l="circle"===e.type?new ac(s.x,s.y,a+o):new sc(n.offsetLeft*r-o,n.offsetTop*r-o,n.offsetWidth*r+2*o,n.offsetHeight*r+2*o);this._processBounce(s,a,l)}))}}clear(){}init(){const t=this.container,e=t.actualOptions.interactivity.modes.bounce;e&&(t.retina.bounceModeDistance=e.distance*t.retina.pixelRatio)}async interact(){const t=this.container,e=t.actualOptions.interactivity.events,i=t.interactivity.status===Co,n=e.onHover.enable,r=e.onHover.mode,s=e.onDiv;i&&n&&tl("bounce",r)?this._processMouseBounce():al("bounce",s,((t,e)=>this._singleSelectorBounce(t,e)))}isEnabled(t){const e=this.container,i=e.actualOptions,n=e.interactivity.mouse,r=(t?.interactivity??i.interactivity).events,s=r.onDiv;return n.position&&r.onHover.enable&&tl("bounce",r.onHover.mode)||sl("bounce",s)}loadModeOptions(t){t.bounce||(t.bounce=new Wc);for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(const r of i)t.bounce.load(r?.bounce)}reset(){}}class Yc{constructor(){this.distance=200,this.duration=.4,this.mix=!1}load(t){if(t){if(void 0!==t.distance&&(this.distance=t.distance),void 0!==t.duration&&(this.duration=t.duration),void 0!==t.mix&&(this.mix=t.mix),void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.color){const e=Sl(this.color)?void 0:this.color;this.color=ul(t.color,(t=>Ql.create(e,t)))}void 0!==t.size&&(this.size=t.size)}}}class Xc extends Yc{constructor(){super(),this.selectors=[]}get ids(){return ul(this.selectors,(t=>t.replace("#","")))}set ids(t){this.selectors=ul(t,(t=>`#${t}`))}load(t){super.load(t),t&&(void 0!==t.ids&&(this.ids=t.ids),void 0!==t.selectors&&(this.selectors=t.selectors))}}class Qc extends Yc{load(t){super.load(t),t&&(this.divs=ul(t.divs,(t=>{const e=new Xc;return e.load(t),e})))}}function Kc(t,e,i,n){if(e>=i){return Bo(t+(e-i)*n,t,e)}if(e<i){return Bo(t-(i-e)*n,e,t)}}class Zc extends jc{constructor(t){super(t),this._clickBubble=()=>{const t=this.container,e=t.actualOptions,i=t.interactivity.mouse.clickPosition,n=e.interactivity.modes.bubble;if(!n||!i)return;t.bubble||(t.bubble={});const r=t.retina.bubbleModeDistance;if(!r||r<0)return;const s=t.particles.quadTree.queryCircle(i,r,(t=>this.isEnabled(t))),{bubble:a}=t;for(const o of s){if(!a.clicking)continue;o.bubble.inRange=!a.durationEnd;const e=Wo(o.getPosition(),i),s=((new Date).getTime()-(t.interactivity.mouse.clickTime||0))/1e3;s>n.duration&&(a.durationEnd=!0),s>2*n.duration&&(a.clicking=!1,a.durationEnd=!1);const l={bubbleObj:{optValue:t.retina.bubbleModeSize,value:o.bubble.radius},particlesObj:{optValue:Vo(o.options.size.value)*t.retina.pixelRatio,value:o.size.value},type:"size"};this._process(o,e,s,l);const h={bubbleObj:{optValue:n.opacity,value:o.bubble.opacity},particlesObj:{optValue:Vo(o.options.opacity.value),value:o.opacity?.value??1},type:"opacity"};this._process(o,e,s,h),!a.durationEnd&&e<=r?this._hoverBubbleColor(o,e):delete o.bubble.color}},this._hoverBubble=()=>{const t=this.container,e=t.interactivity.mouse.position,i=t.retina.bubbleModeDistance;if(!i||i<0||void 0===e)return;const n=t.particles.quadTree.queryCircle(e,i,(t=>this.isEnabled(t)));for(const r of n){r.bubble.inRange=!0;const n=Wo(r.getPosition(),e),s=1-n/i;n<=i?s>=0&&t.interactivity.status===Co&&(this._hoverBubbleSize(r,s),this._hoverBubbleOpacity(r,s),this._hoverBubbleColor(r,s)):this.reset(r),t.interactivity.status===_o&&this.reset(r)}},this._hoverBubbleColor=(t,e,i)=>{const n=this.container.actualOptions,r=i??n.interactivity.modes.bubble;if(r){if(!t.bubble.finalColor){const e=r.color;if(!e)return;const i=dl(e);t.bubble.finalColor=kl(i)}if(t.bubble.finalColor)if(r.mix){t.bubble.color=void 0;const i=t.getFillColor();t.bubble.color=i?Il(zl(i,t.bubble.finalColor,1-e,e)):t.bubble.finalColor}else t.bubble.color=t.bubble.finalColor}},this._hoverBubbleOpacity=(t,e,i)=>{const n=this.container.actualOptions,r=i?.opacity??n.interactivity.modes.bubble?.opacity;if(!r)return;const s=t.options.opacity.value,a=Kc(t.opacity?.value??1,r,Vo(s),e);void 0!==a&&(t.bubble.opacity=a)},this._hoverBubbleSize=(t,e,i)=>{const n=this.container,r=i?.size?i.size*n.retina.pixelRatio:n.retina.bubbleModeSize;if(void 0===r)return;const s=Vo(t.options.size.value)*n.retina.pixelRatio,a=Kc(t.size.value,r,s,e);void 0!==a&&(t.bubble.radius=a)},this._process=(t,e,i,n)=>{const r=this.container,s=n.bubbleObj.optValue,a=r.actualOptions.interactivity.modes.bubble;if(!a||void 0===s)return;const o=a.duration,l=r.retina.bubbleModeDistance,h=n.particlesObj.optValue,c=n.bubbleObj.value,u=n.particlesObj.value||0,d=n.type;if(l&&!(l<0)&&s!==h)if(r.bubble||(r.bubble={}),r.bubble.durationEnd)c&&("size"===d&&delete t.bubble.radius,"opacity"===d&&delete t.bubble.opacity);else if(e<=l){if((c??u)!==s){const e=u-i*(u-s)/o;"size"===d&&(t.bubble.radius=e),"opacity"===d&&(t.bubble.opacity=e)}}else"size"===d&&delete t.bubble.radius,"opacity"===d&&delete t.bubble.opacity},this._singleSelectorHover=(t,e,i)=>{const n=this.container,r=document.querySelectorAll(e),s=n.actualOptions.interactivity.modes.bubble;s&&r.length&&r.forEach((e=>{const r=e,a=n.retina.pixelRatio,o={x:(r.offsetLeft+r.offsetWidth/2)*a,y:(r.offsetTop+r.offsetHeight/2)*a},l=r.offsetWidth/2*a,h="circle"===i.type?new ac(o.x,o.y,l):new sc(r.offsetLeft*a,r.offsetTop*a,r.offsetWidth*a,r.offsetHeight*a),c=n.particles.quadTree.query(h,(t=>this.isEnabled(t)));for(const i of c){if(!h.contains(i.getPosition()))continue;i.bubble.inRange=!0;const e=ol(s.divs,r);i.bubble.div&&i.bubble.div===r||(this.clear(i,t,!0),i.bubble.div=r),this._hoverBubbleSize(i,1,e),this._hoverBubbleOpacity(i,1,e),this._hoverBubbleColor(i,1,e)}}))},t.bubble||(t.bubble={}),this.handleClickMode=e=>{"bubble"===e&&(t.bubble||(t.bubble={}),t.bubble.clicking=!0)}}clear(t,e,i){t.bubble.inRange&&!i||(delete t.bubble.div,delete t.bubble.opacity,delete t.bubble.radius,delete t.bubble.color)}init(){const t=this.container,e=t.actualOptions.interactivity.modes.bubble;e&&(t.retina.bubbleModeDistance=e.distance*t.retina.pixelRatio,void 0!==e.size&&(t.retina.bubbleModeSize=e.size*t.retina.pixelRatio))}async interact(t){const e=this.container.actualOptions.interactivity.events,i=e.onHover,n=e.onClick,r=i.enable,s=i.mode,a=n.enable,o=n.mode,l=e.onDiv;r&&tl("bubble",s)?this._hoverBubble():a&&tl("bubble",o)?this._clickBubble():al("bubble",l,((e,i)=>this._singleSelectorHover(t,e,i)))}isEnabled(t){const e=this.container,i=e.actualOptions,n=e.interactivity.mouse,r=(t?.interactivity??i.interactivity).events,{onClick:s,onDiv:a,onHover:o}=r,l=sl("bubble",a);return!!(l||o.enable&&n.position||s.enable&&n.clickPosition)&&(tl("bubble",o.mode)||tl("bubble",s.mode)||l)}loadModeOptions(t){t.bubble||(t.bubble=new Qc);for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(const r of i)t.bubble.load(r?.bubble)}reset(t){t.bubble.inRange=!1}}class Jc{constructor(){this.opacity=.5}load(t){t&&void 0!==t.opacity&&(this.opacity=t.opacity)}}class $c{constructor(){this.distance=80,this.links=new Jc,this.radius=60}get lineLinked(){return this.links}set lineLinked(t){this.links=t}get line_linked(){return this.links}set line_linked(t){this.links=t}load(t){t&&(void 0!==t.distance&&(this.distance=t.distance),this.links.load(t.links??t.lineLinked??t.line_linked),void 0!==t.radius&&(this.radius=t.radius))}}function tu(t,e,i,n){const r=t.actualOptions.interactivity.modes.connect;if(r)return function(t,e,i,n){const r=Math.floor(i.getRadius()/e.getRadius()),s=e.getFillColor(),a=i.getFillColor();if(!s||!a)return;const o=e.getPosition(),l=i.getPosition(),h=zl(s,a,e.getRadius(),i.getRadius()),c=t.createLinearGradient(o.x,o.y,l.x,l.y);return c.addColorStop(0,Bl(s,n)),c.addColorStop(r>1?1:r,Ll(h,n)),c.addColorStop(1,Bl(a,n)),c}(e,i,n,r.links.opacity)}function eu(t,e,i){t.canvas.draw((n=>{const r=tu(t,n,e,i);if(!r)return;const s=e.getPosition(),a=i.getPosition();!function(t,e,i,n,r){Gl(t,n,r),t.lineWidth=e,t.strokeStyle=i,t.stroke()}(n,e.retina.linksWidth??0,r,s,a)}))}class iu extends jc{constructor(t){super(t)}clear(){}init(){const t=this.container,e=t.actualOptions.interactivity.modes.connect;e&&(t.retina.connectModeDistance=e.distance*t.retina.pixelRatio,t.retina.connectModeRadius=e.radius*t.retina.pixelRatio)}async interact(){const t=this.container;if(t.actualOptions.interactivity.events.onHover.enable&&"pointermove"===t.interactivity.status){const e=t.interactivity.mouse.position;if(!t.retina.connectModeDistance||t.retina.connectModeDistance<0||!t.retina.connectModeRadius||t.retina.connectModeRadius<0||!e)return;const i=Math.abs(t.retina.connectModeRadius),n=t.particles.quadTree.queryCircle(e,i,(t=>this.isEnabled(t)));let r=0;for(const s of n){const e=s.getPosition();for(const i of n.slice(r+1)){const n=i.getPosition(),r=Math.abs(t.retina.connectModeDistance),a=Math.abs(e.x-n.x),o=Math.abs(e.y-n.y);a<r&&o<r&&eu(t,s,i)}++r}}}isEnabled(t){const e=this.container,i=e.interactivity.mouse,n=(t?.interactivity??e.actualOptions.interactivity).events;return!(!n.onHover.enable||!i.position)&&tl("connect",n.onHover.mode)}loadModeOptions(t){t.connect||(t.connect=new $c);for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(const r of i)t.connect.load(r?.connect)}reset(){}}class nu{constructor(){this.blink=!1,this.consent=!1,this.opacity=1}load(t){t&&(void 0!==t.blink&&(this.blink=t.blink),void 0!==t.color&&(this.color=Ql.create(this.color,t.color)),void 0!==t.consent&&(this.consent=t.consent),void 0!==t.opacity&&(this.opacity=t.opacity))}}class ru{constructor(){this.distance=100,this.links=new nu}get lineLinked(){return this.links}set lineLinked(t){this.links=t}get line_linked(){return this.links}set line_linked(t){this.links=t}load(t){t&&(void 0!==t.distance&&(this.distance=t.distance),this.links.load(t.links??t.lineLinked??t.line_linked))}}function su(t,e,i,n,r){t.canvas.draw((t=>{const s=e.getPosition();!function(t,e,i,n,r,s){Gl(t,i,n),t.strokeStyle=Ll(r,s),t.lineWidth=e,t.stroke()}(t,e.retina.linksWidth??0,s,r,i,n)}))}class au extends jc{constructor(t){super(t)}clear(){}init(){const t=this.container,e=t.actualOptions.interactivity.modes.grab;e&&(t.retina.grabModeDistance=e.distance*t.retina.pixelRatio)}async interact(){const t=this.container,e=t.actualOptions.interactivity;if(!e.modes.grab||!e.events.onHover.enable||t.interactivity.status!==Co)return;const i=t.interactivity.mouse.position;if(!i)return;const n=t.retina.grabModeDistance;if(!n||n<0)return;const r=t.particles.quadTree.queryCircle(i,n,(t=>this.isEnabled(t)));for(const s of r){const r=Wo(s.getPosition(),i);if(r>n)continue;const a=e.modes.grab.links,o=a.opacity,l=o-r*o/n;if(l<=0)continue;const h=a.color??s.options.links?.color;if(!t.particles.grabLineColor&&h){const i=e.modes.grab.links;t.particles.grabLineColor=Nl(h,i.blink,i.consent)}const c=Fl(s,void 0,t.particles.grabLineColor);c&&su(t,s,c,l,i)}}isEnabled(t){const e=this.container,i=e.interactivity.mouse,n=(t?.interactivity??e.actualOptions.interactivity).events;return n.onHover.enable&&!!i.position&&tl("grab",n.onHover.mode)}loadModeOptions(t){t.grab||(t.grab=new ru);for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(const r of i)t.grab.load(r?.grab)}reset(){}}class ou extends jc{constructor(t){super(t),this.handleClickMode=t=>{if("pause"!==t)return;const e=this.container;e.getAnimationStatus()?e.pause():e.play()}}clear(){}init(){}async interact(){}isEnabled(){return!0}reset(){}}class lu{constructor(){this.default=!0,this.groups=[],this.quantity=4}get particles_nb(){return this.quantity}set particles_nb(t){this.quantity=jo(t)}load(t){if(!t)return;void 0!==t.default&&(this.default=t.default),void 0!==t.groups&&(this.groups=t.groups.map((t=>t))),this.groups.length||(this.default=!0);const e=t.quantity??t.particles_nb;void 0!==e&&(this.quantity=jo(e))}}class hu extends jc{constructor(t){super(t),this.handleClickMode=t=>{if("push"!==t)return;const e=this.container,i=e.actualOptions.interactivity.modes.push;if(!i)return;const n=No(i.quantity);if(n<=0)return;const r=el([void 0,...i.groups]),s=void 0!==r?e.actualOptions.particles.groups[r]:void 0;e.particles.push(n,e.interactivity.mouse,s,r)}}clear(){}init(){}async interact(){}isEnabled(){return!0}loadModeOptions(t){t.push||(t.push=new lu);for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(const r of i)t.push.load(r?.push)}reset(){}}class cu{constructor(){this.quantity=2}get particles_nb(){return this.quantity}set particles_nb(t){this.quantity=jo(t)}load(t){if(!t)return;const e=t.quantity??t.particles_nb;void 0!==e&&(this.quantity=jo(e))}}class uu extends jc{constructor(t){super(t),this.handleClickMode=t=>{const e=this.container,i=e.actualOptions;if(!i.interactivity.modes.remove||"remove"!==t)return;const n=No(i.interactivity.modes.remove.quantity);e.particles.removeQuantity(n)}}clear(){}init(){}async interact(){}isEnabled(){return!0}loadModeOptions(t){t.remove||(t.remove=new cu);for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(const r of i)t.remove.load(r?.remove)}reset(){}}class du{constructor(){this.distance=200,this.duration=.4,this.factor=100,this.speed=1,this.maxSpeed=50,this.easing="ease-out-quad"}load(t){t&&(void 0!==t.distance&&(this.distance=t.distance),void 0!==t.duration&&(this.duration=t.duration),void 0!==t.easing&&(this.easing=t.easing),void 0!==t.factor&&(this.factor=t.factor),void 0!==t.speed&&(this.speed=t.speed),void 0!==t.maxSpeed&&(this.maxSpeed=t.maxSpeed))}}class pu extends du{constructor(){super(),this.selectors=[]}get ids(){return ul(this.selectors,(t=>t.replace("#","")))}set ids(t){this.selectors=ul(t,(t=>`#${t}`))}load(t){super.load(t),t&&(void 0!==t.ids&&(this.ids=t.ids),void 0!==t.selectors&&(this.selectors=t.selectors))}}class fu extends du{load(t){super.load(t),t&&(this.divs=ul(t.divs,(t=>{const e=new pu;return e.load(t),e})))}}class mu extends jc{constructor(t,e){super(e),this._clickRepulse=()=>{const t=this.container,e=t.actualOptions.interactivity.modes.repulse;if(!e)return;const i=t.repulse||{particles:[]};if(i.finish||(i.count||(i.count=0),i.count++,i.count===t.particles.count&&(i.finish=!0)),i.clicking){const n=t.retina.repulseModeDistance;if(!n||n<0)return;const r=Math.pow(n/6,3),s=t.interactivity.mouse.clickPosition;if(void 0===s)return;const a=new ac(s.x,s.y,r),o=t.particles.quadTree.query(a,(t=>this.isEnabled(t)));for(const t of o){const{dx:n,dy:a,distance:o}=Ho(s,t.position),l=o**2,h=-r*e.speed/l;if(l<=r){i.particles.push(t);const e=Do.create(n,a);e.length=h,t.velocity.setTo(e)}}}else if(!1===i.clicking){for(const t of i.particles)t.velocity.setTo(t.initialVelocity);i.particles=[]}},this._hoverRepulse=()=>{const t=this.container,e=t.interactivity.mouse.position,i=t.retina.repulseModeDistance;!i||i<0||!e||this._processRepulse(e,i,new ac(e.x,e.y,i))},this._processRepulse=(t,e,i,n)=>{const r=this.container,s=r.particles.quadTree.query(i,(t=>this.isEnabled(t))),a=r.actualOptions.interactivity.modes.repulse;if(a)for(const o of s){const{dx:i,dy:r,distance:s}=Ho(o.position,t),l=(n?.speed??a.speed)*a.factor,h=Bo(Oo(a.easing)(1-s/e)*l,0,a.maxSpeed),c=Do.create(0===s?l:i/s*h,0===s?l:r/s*h);o.position.addTo(c)}},this._singleSelectorRepulse=(t,e)=>{const i=this.container,n=i.actualOptions.interactivity.modes.repulse;if(!n)return;const r=document.querySelectorAll(t);r.length&&r.forEach((t=>{const r=t,s=i.retina.pixelRatio,a={x:(r.offsetLeft+r.offsetWidth/2)*s,y:(r.offsetTop+r.offsetHeight/2)*s},o=r.offsetWidth/2*s,l="circle"===e.type?new ac(a.x,a.y,o):new sc(r.offsetLeft*s,r.offsetTop*s,r.offsetWidth*s,r.offsetHeight*s),h=ol(n.divs,r);this._processRepulse(a,o,l,h)}))},this._engine=t,e.repulse||(e.repulse={particles:[]}),this.handleClickMode=t=>{const i=this.container.actualOptions.interactivity.modes.repulse;if(!i||"repulse"!==t)return;e.repulse||(e.repulse={particles:[]});const n=e.repulse;n.clicking=!0,n.count=0;for(const r of e.repulse.particles)this.isEnabled(r)&&r.velocity.setTo(r.initialVelocity);n.particles=[],n.finish=!1,setTimeout((()=>{e.destroyed||(n.clicking=!1)}),1e3*i.duration)}}clear(){}init(){const t=this.container,e=t.actualOptions.interactivity.modes.repulse;e&&(t.retina.repulseModeDistance=e.distance*t.retina.pixelRatio)}async interact(){const t=this.container,e=t.actualOptions,i=t.interactivity.status===Co,n=e.interactivity.events,r=n.onHover,s=r.enable,a=r.mode,o=n.onClick,l=o.enable,h=o.mode,c=n.onDiv;i&&s&&tl("repulse",a)?this._hoverRepulse():l&&tl("repulse",h)?this._clickRepulse():al("repulse",c,((t,e)=>this._singleSelectorRepulse(t,e)))}isEnabled(t){const e=this.container,i=e.actualOptions,n=e.interactivity.mouse,r=(t?.interactivity??i.interactivity).events,s=r.onDiv,a=r.onHover,o=r.onClick,l=sl("repulse",s);if(!(l||a.enable&&n.position||o.enable&&n.clickPosition))return!1;const h=a.mode,c=o.mode;return tl("repulse",h)||tl("repulse",c)||l}loadModeOptions(t){t.repulse||(t.repulse=new fu);for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(const r of i)t.repulse.load(r?.repulse)}reset(){}}class gu{constructor(){this.factor=3,this.radius=200}load(t){t&&(void 0!==t.factor&&(this.factor=t.factor),void 0!==t.radius&&(this.radius=t.radius))}}class vu extends jc{constructor(t){super(t)}clear(t,e,i){t.slow.inRange&&!i||(t.slow.factor=1)}init(){const t=this.container,e=t.actualOptions.interactivity.modes.slow;e&&(t.retina.slowModeRadius=e.radius*t.retina.pixelRatio)}async interact(){}isEnabled(t){const e=this.container,i=e.interactivity.mouse,n=(t?.interactivity??e.actualOptions.interactivity).events;return n.onHover.enable&&!!i.position&&tl("slow",n.onHover.mode)}loadModeOptions(t){t.slow||(t.slow=new gu);for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(const r of i)t.slow.load(r?.slow)}reset(t){t.slow.inRange=!1;const e=this.container,i=e.actualOptions,n=e.interactivity.mouse.position,r=e.retina.slowModeRadius,s=i.interactivity.modes.slow;if(!s||!r||r<0||!n)return;const a=Wo(n,t.getPosition()),o=a/r,l=s.factor,{slow:h}=t;a>r||(h.inRange=!0,h.factor=o/l)}}const yu=[0,4,2,1],bu=[8,8,4,2];class xu{constructor(t){this.pos=0,this.data=new Uint8ClampedArray(t)}getString(t){const e=this.data.slice(this.pos,this.pos+t);return this.pos+=e.length,e.reduce(((t,e)=>t+String.fromCharCode(e)),"")}nextByte(){return this.data[this.pos++]}nextTwoBytes(){return this.pos+=2,this.data[this.pos-2]+(this.data[this.pos-1]<<8)}readSubBlocks(){let t="",e=0;do{e=this.data[this.pos++];for(let i=e;--i>=0;t+=String.fromCharCode(this.data[this.pos++]));}while(0!==e);return t}readSubBlocksBin(){let t=0,e=0;for(let n=0;0!==(t=this.data[this.pos+n]);n+=t+1)e+=t;const i=new Uint8Array(e);for(let n=0;0!==(t=this.data[this.pos++]);)for(let e=t;--e>=0;i[n++]=this.data[this.pos++]);return i}skipSubBlocks(){for(;0!==this.data[this.pos];this.pos+=this.data[this.pos]+1);this.pos++}}function wu(t,e){const i=[];for(let n=0;n<e;n++)i.push({r:t.data[t.pos],g:t.data[t.pos+1],b:t.data[t.pos+2]}),t.pos+=3;return i}async function Su(t,e,i,n,r,s){switch(t.nextByte()){case 59:return!0;case 44:await async function(t,e,i,n,r,s){const a=e.frames[n(!0)];a.left=t.nextTwoBytes(),a.top=t.nextTwoBytes(),a.width=t.nextTwoBytes(),a.height=t.nextTwoBytes();const o=t.nextByte(),l=128===(128&o),h=64===(64&o);a.sortFlag=32===(32&o),a.reserved=(24&o)>>>3;const c=1<<1+(7&o);l&&(a.localColorTable=wu(t,c));const u=t=>{const{r:n,g:s,b:o}=(l?a.localColorTable:e.globalColorTable)[t];return{r:n,g:s,b:o,a:t===r(null)?i?~~((n+s+o)/3):0:255}},d=(()=>{try{return new ImageData(a.width,a.height,{colorSpace:"srgb"})}catch(t){if(t instanceof DOMException&&"IndexSizeError"===t.name)return null;throw t}})();if(null==d)throw new EvalError("GIF frame size is to large");const p=t.nextByte(),f=t.readSubBlocksBin(),m=1<<p,g=(t,e)=>{const i=t>>>3,n=7&t;return(f[i]+(f[i+1]<<8)+(f[i+2]<<16)&(1<<e)-1<<n)>>>n};if(h){for(let i=0,r=p+1,o=0,l=[[0]],h=0;h<4;h++){if(yu[h]<a.height)for(let t=0,e=0;;){const n=i;if(i=g(o,r),o+=r+1,i===m){r=p+1,l.length=m+2;for(let t=0;t<l.length;t++)l[t]=t<m?[t]:[]}else{i>=l.length?l.push(l[n].concat(l[n][0])):n!==m&&l.push(l[n].concat(l[i][0]));for(let n=0;n<l[i].length;n++){const{r:r,g:s,b:o,a:c}=u(l[i][n]);d.data.set([r,s,o,c],yu[h]*a.width+bu[h]*e+t%(4*a.width)),t+=4}l.length===1<<r&&r<12&&r++}if(t===4*a.width*(e+1)&&(e++,yu[h]+bu[h]*e>=a.height))break}s?.(t.pos/(t.data.length-1),n(!1)+1,d,{x:a.left,y:a.top},{width:e.width,height:e.height})}a.image=d,a.bitmap=await createImageBitmap(d)}else{for(let t=0,e=p+1,i=0,n=[[0]],r=-4;;){const s=t;if(t=g(i,e),i+=e,t===m){e=p+1,n.length=m+2;for(let t=0;t<n.length;t++)n[t]=t<m?[t]:[]}else{if(t===m+1)break;t>=n.length?n.push(n[s].concat(n[s][0])):s!==m&&n.push(n[s].concat(n[t][0]));for(let e=0;e<n[t].length;e++){const{r:i,g:s,b:a,a:o}=u(n[t][e]);d.data.set([i,s,a,o],r+=4)}n.length>=1<<e&&e<12&&e++}}a.image=d,a.bitmap=await createImageBitmap(d),s?.((t.pos+1)/t.data.length,n(!1)+1,a.image,{x:a.left,y:a.top},{width:e.width,height:e.height})}}(t,e,i,n,r,s);break;case 33:await async function(t,e,i,n){switch(t.nextByte()){case 249:{const r=e.frames[i(!1)];t.pos++;const s=t.nextByte();r.GCreserved=(224&s)>>>5,r.disposalMethod=(28&s)>>>2,r.userInputDelayFlag=2===(2&s);const a=1===(1&s);r.delayTime=10*t.nextTwoBytes();const o=t.nextByte();a&&n(o),t.pos++;break}case 255:{t.pos++;const i={identifier:t.getString(8),authenticationCode:t.getString(3),data:t.readSubBlocksBin()};e.applicationExtensions.push(i);break}case 254:e.comments.push([i(!1),t.readSubBlocks()]);break;case 1:if(0===e.globalColorTable.length)throw new EvalError("plain text extension without global color table");t.pos++,e.frames[i(!1)].plainTextData={left:t.nextTwoBytes(),top:t.nextTwoBytes(),width:t.nextTwoBytes(),height:t.nextTwoBytes(),charSize:{width:t.nextTwoBytes(),height:t.nextTwoBytes()},foregroundColor:t.nextByte(),backgroundColor:t.nextByte(),text:t.readSubBlocks()};break;default:t.skipSubBlocks()}}(t,e,n,r);break;default:throw new EvalError("undefined block found")}return!1}const Au=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d.]+%?\))|currentcolor/gi;async function Eu(t){return new Promise((e=>{t.loading=!0;const i=new Image;t.element=i,i.addEventListener("load",(()=>{t.loading=!1,e()})),i.addEventListener("error",(()=>{t.element=void 0,t.error=!0,t.loading=!1,Ko().error(`${Po} loading image: ${t.source}`),e()})),i.src=t.source}))}async function _u(t){if("gif"===t.type){t.loading=!0;try{t.gifData=await async function(t,e,i){i||(i=!1);const n=await fetch(t);if(!n.ok&&404===n.status)throw new EvalError("file not found");const r=await n.arrayBuffer(),s={width:0,height:0,totalTime:0,colorRes:0,pixelAspectRatio:0,frames:[],sortFlag:!1,globalColorTable:[],backgroundImage:new ImageData(1,1,{colorSpace:"srgb"}),comments:[],applicationExtensions:[]},a=new xu(new Uint8ClampedArray(r));if("GIF89a"!==a.getString(6))throw new Error("not a supported GIF file");s.width=a.nextTwoBytes(),s.height=a.nextTwoBytes();const o=a.nextByte(),l=128===(128&o);s.colorRes=(112&o)>>>4,s.sortFlag=8===(8&o);const h=1<<1+(7&o),c=a.nextByte();s.pixelAspectRatio=a.nextByte(),0!==s.pixelAspectRatio&&(s.pixelAspectRatio=(s.pixelAspectRatio+15)/64),l&&(s.globalColorTable=wu(a,h));const u=(()=>{try{return new ImageData(s.width,s.height,{colorSpace:"srgb"})}catch(t){if(t instanceof DOMException&&"IndexSizeError"===t.name)return null;throw t}})();if(null==u)throw new Error("GIF frame size is to large");const{r:d,g:p,b:f}=s.globalColorTable[c];u.data.set(l?[d,p,f,255]:[0,0,0,0]);for(let w=4;w<u.data.length;w*=2)u.data.copyWithin(w,0,w);s.backgroundImage=u;let m=-1,g=!0,v=-1;const y=t=>(t&&(g=!0),m),b=t=>(null!=t&&(v=t),v);try{do{g&&(s.frames.push({left:0,top:0,width:0,height:0,disposalMethod:0,image:new ImageData(1,1,{colorSpace:"srgb"}),plainTextData:null,userInputDelayFlag:!1,delayTime:0,sortFlag:!1,localColorTable:[],reserved:0,GCreserved:0}),m++,v=-1,g=!1)}while(!await Su(a,s,i,y,b,e));s.frames.length--;for(const t of s.frames){if(t.userInputDelayFlag&&0===t.delayTime){s.totalTime=1/0;break}s.totalTime+=t.delayTime}return s}catch(x){if(x instanceof EvalError)throw new Error(`error while parsing frame ${m} "${x.message}"`);throw x}}(t.source),t.gifLoopCount=function(t){for(const e of t.applicationExtensions)if(e.identifier+e.authenticationCode==="NETSCAPE2.0")return e.data[1]+(e.data[2]<<8);return NaN}(t.gifData)??0,0===t.gifLoopCount&&(t.gifLoopCount=1/0)}catch{t.error=!0}t.loading=!1}else await Eu(t)}async function Cu(t){if("svg"!==t.type)return void await Eu(t);t.loading=!0;const e=await fetch(t.source);e.ok?t.svgData=await e.text():(Ko().error(`${Po} Image not found`),t.error=!0),t.loading=!1}function Mu(t,e,i,n){const r=function(t,e,i){const{svgData:n}=t;if(!n)return"";const r=Bl(e,i);if(n.includes("fill"))return n.replace(Au,(()=>r));const s=n.indexOf(">");return`${n.substring(0,s)} fill="${r}"${n.substring(s)}`}(t,i,n.opacity?.value??1),s={color:i,gif:e.gif,data:{...t,svgData:r},loaded:!1,ratio:e.width/e.height,replaceColor:e.replaceColor??e.replace_color,source:e.src};return new Promise((e=>{const i=new Blob([r],{type:"image/svg+xml"}),n=URL||window.URL||window.webkitURL||window,a=n.createObjectURL(i),o=new Image;o.addEventListener("load",(()=>{s.loaded=!0,s.element=o,e(s),n.revokeObjectURL(a)})),o.addEventListener("error",(async()=>{n.revokeObjectURL(a);const i={...t,error:!1,loading:!0};await Eu(i),s.loaded=!0,s.element=i.element,e(s)})),o.src=a}))}class Pu{constructor(t){this.loadImageShape=async t=>{if(!this._engine.loadImage)throw new Error(`${Po} image shape not initialized`);await this._engine.loadImage({gif:t.gif,name:t.name,replaceColor:t.replaceColor??t.replace_color??!1,src:t.src})},this._engine=t}addImage(t){this._engine.images||(this._engine.images=[]),this._engine.images.push(t)}draw(t,e,i,n,r){const s=e.image,a=s?.element;if(s){if(t.globalAlpha=n,s.gif&&s.gifData){const n=new OffscreenCanvas(s.gifData.width,s.gifData.height),a=n.getContext("2d");if(!a)throw new Error("could not create offscreen canvas context");a.imageSmoothingQuality="low",a.imageSmoothingEnabled=!1,a.clearRect(0,0,n.width,n.height),void 0===e.gifLoopCount&&(e.gifLoopCount=s.gifLoopCount??0);let o=e.gifFrame??0;const l={x:.5*-s.gifData.width,y:.5*-s.gifData.height},h=s.gifData.frames[o];if(void 0===e.gifTime&&(e.gifTime=0),!h.bitmap)return;switch(t.scale(i/s.gifData.width,i/s.gifData.height),h.disposalMethod){case 4:case 5:case 6:case 7:case 0:a.drawImage(h.bitmap,h.left,h.top),t.drawImage(n,l.x,l.y),a.clearRect(0,0,n.width,n.height);break;case 1:a.drawImage(h.bitmap,h.left,h.top),t.drawImage(n,l.x,l.y);break;case 2:a.drawImage(h.bitmap,h.left,h.top),t.drawImage(n,l.x,l.y),a.clearRect(0,0,n.width,n.height),0===s.gifData.globalColorTable.length?a.putImageData(s.gifData.frames[0].image,l.x+h.left,l.y+h.top):a.putImageData(s.gifData.backgroundImage,l.x,l.y);break;case 3:{const e=a.getImageData(0,0,n.width,n.height);a.drawImage(h.bitmap,h.left,h.top),t.drawImage(n,l.x,l.y),a.clearRect(0,0,n.width,n.height),a.putImageData(e,0,0)}}if(e.gifTime+=r.value,e.gifTime>h.delayTime){if(e.gifTime-=h.delayTime,++o>=s.gifData.frames.length){if(--e.gifLoopCount<=0)return;o=0,a.clearRect(0,0,n.width,n.height)}e.gifFrame=o}t.scale(s.gifData.width/i,s.gifData.height/i)}else if(a){const e=s.ratio,n={x:-i,y:-i};t.drawImage(a,n.x,n.y,2*i,2*i/e)}t.globalAlpha=1}}getSidesCount(){return 12}async init(t){const e=t.actualOptions;if(e.preload&&this._engine.loadImage)for(const i of e.preload)await this._engine.loadImage(i)}loadShape(t){if("image"!==t.shape&&"images"!==t.shape)return;this._engine.images||(this._engine.images=[]);const e=t.shapeData;this._engine.images.find((t=>t.name===e.name||t.source===e.src))||this.loadImageShape(e).then((()=>{this.loadShape(t)}))}particleInit(t,e){if("image"!==e.shape&&"images"!==e.shape)return;this._engine.images||(this._engine.images=[]);const i=this._engine.images,n=e.shapeData,r=e.getFillColor(),s=i.find((t=>t.name===n.name||t.source===n.src));if(!s)return;const a=n.replaceColor??n.replace_color??s.replaceColor;s.loading?setTimeout((()=>{this.particleInit(t,e)})):(async()=>{let t;t=s.svgData&&r?await Mu(s,n,r,e):{color:r,data:s,element:s.element,gif:s.gif,gifData:s.gifData,gifLoopCount:s.gifLoopCount,loaded:!0,ratio:n.width&&n.height?n.width/n.height:s.ratio??1,replaceColor:a,source:n.src},t.ratio||(t.ratio=1);const i={image:t,fill:n.fill??e.fill,close:n.close??e.close};e.image=i.image,e.fill=i.fill,e.close=i.close})()}}class Tu{constructor(){this.src="",this.gif=!1}load(t){t&&(void 0!==t.gif&&(this.gif=t.gif),void 0!==t.height&&(this.height=t.height),void 0!==t.name&&(this.name=t.name),void 0!==t.replaceColor&&(this.replaceColor=t.replaceColor),void 0!==t.src&&(this.src=t.src),void 0!==t.width&&(this.width=t.width))}}class Du{constructor(t){this.id="imagePreloader",this._engine=t}getPlugin(){return{}}loadOptions(t,e){if(!e||!e.preload)return;t.preload||(t.preload=[]);const i=t.preload;for(const n of e.preload){const t=i.find((t=>t.name===n.name||t.src===n.src));if(t)t.load(n);else{const t=new Tu;t.load(n),i.push(t)}}}needsPlugin(){return!0}}async function ku(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(t){t.loadImage||(t.loadImage=async e=>{if(!e.name&&!e.src)throw new Error(`${Po} no image source provided`);if(t.images||(t.images=[]),!t.images.find((t=>t.name===e.name||t.source===e.src)))try{const i={gif:e.gif??!1,name:e.name??e.src,source:e.src,type:e.src.substring(e.src.length-3),error:!1,loading:!0,replaceColor:e.replaceColor,ratio:e.width&&e.height?e.width/e.height:void 0};t.images.push(i);const n=e.gif?_u:e.replaceColor?Cu:Eu;await n(i)}catch{throw new Error(`${Po} ${e.name??e.src} not found`)}})}(t);const i=new Du(t);await t.addPlugin(i,e),await t.addShape(["image","images"],new Pu(t),e)}class Iu extends xh{constructor(){super(),this.sync=!1}load(t){t&&(super.load(t),void 0!==t.sync&&(this.sync=t.sync))}}class Ru extends xh{constructor(){super(),this.random.minimumValue=1e-4,this.sync=!1}load(t){t&&(super.load(t),void 0!==t.sync&&(this.sync=t.sync))}}class Ou{constructor(){this.count=0,this.delay=new Iu,this.duration=new Ru}load(t){t&&(void 0!==t.count&&(this.count=t.count),this.delay.load(t.delay),this.duration.load(t.duration))}}class Lu{constructor(t){this.container=t}init(t){const e=this.container,i=t.options.life;i&&(t.life={delay:e.retina.reduceFactor?No(i.delay.value)*(i.delay.sync?1:Lo())/e.retina.reduceFactor*1e3:0,delayTime:0,duration:e.retina.reduceFactor?No(i.duration.value)*(i.duration.sync?1:Lo())/e.retina.reduceFactor*1e3:0,time:0,count:i.count},t.life.duration<=0&&(t.life.duration=-1),t.life.count<=0&&(t.life.count=-1),t.life&&(t.spawning=t.life.delay>0))}isEnabled(t){return!t.destroyed}loadOptions(t){t.life||(t.life=new Ou);for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(const r of i)t.life.load(r?.life)}update(t,e){if(!this.isEnabled(t)||!t.life)return;const i=t.life;let n=!1;if(t.spawning){if(i.delayTime+=e.value,!(i.delayTime>=t.life.delay))return;n=!0,t.spawning=!1,i.delayTime=0,i.time=0}if(-1===i.duration)return;if(t.spawning)return;if(n?i.time=0:i.time+=e.value,i.time<i.duration)return;if(i.time=0,t.life.count>0&&t.life.count--,0===t.life.count)return void t.destroy();const r=this.container.canvas.size,s=jo(0,r.width),a=jo(0,r.width);t.position.x=Fo(s),t.position.y=Fo(a),t.spawning=!0,i.delayTime=0,i.time=0,t.reset();const o=t.options.life;o&&(i.delay=1e3*No(o.delay.value),i.duration=1e3*No(o.duration.value))}}class Bu{draw(t,e,i){const n=e.shapeData;t.moveTo(-i/2,0),t.lineTo(i/2,0),t.lineCap=n?.cap??"butt"}getSidesCount(){return 1}}class zu{init(){}isEnabled(t){return!Jo()&&!t.destroyed&&t.container.actualOptions.interactivity.events.onHover.parallax.enable}move(t){const e=t.container,i=e.actualOptions.interactivity.events.onHover.parallax;if(Jo()||!i.enable)return;const n=i.force,r=e.interactivity.mouse.position;if(!r)return;const s=e.canvas.size,a=s.width/2,o=s.height/2,l=i.smooth,h=t.getRadius()/n,c=(r.x-a)*h,u=(r.y-o)*h,{offset:d}=t;d.x+=(c-d.x)/l,d.y+=(u-d.y)/l}}class Fu{constructor(t){this.container=t,this.type="particles"}}class Nu extends Fu{constructor(t){super(t)}clear(){}init(){}async interact(t){const e=this.container,i=t.retina.attractDistance??e.retina.attractDistance,n=t.getPosition(),r=e.particles.quadTree.queryCircle(n,i);for(const s of r){if(t===s||!s.options.move.attract.enable||s.destroyed||s.spawning)continue;const e=s.getPosition(),{dx:i,dy:r}=Ho(n,e),a=t.options.move.attract.rotate,o=i/(1e3*a.x),l=r/(1e3*a.y),h=s.size.value/t.size.value,c=1/h;t.velocity.x-=o*h,t.velocity.y-=l*h,s.velocity.x+=o*c,s.velocity.y+=l*c}}isEnabled(t){return t.options.move.attract.enable}reset(){}}function Uu(t,e,i,n,r,s){const a=Bo(t.options.collisions.absorb.speed*r.factor/10,0,n);t.size.value+=a/2,i.size.value-=a,n<=s&&(i.size.value=0,i.destroy())}const Vu=t=>{void 0===t.collisionMaxSpeed&&(t.collisionMaxSpeed=No(t.options.collisions.maxSpeed)),t.velocity.length>t.collisionMaxSpeed&&(t.velocity.length=t.collisionMaxSpeed)};function ju(t,e){hl(ll(t),ll(e)),Vu(t),Vu(e)}function Gu(t,e,i,n){switch(t.options.collisions.mode){case"absorb":!function(t,e,i,n){const r=t.getRadius(),s=e.getRadius();void 0===r&&void 0!==s?t.destroy():void 0!==r&&void 0===s?e.destroy():void 0!==r&&void 0!==s&&(r>=s?Uu(t,0,e,s,i,n):Uu(e,0,t,r,i,n))}(t,e,i,n);break;case"bounce":ju(t,e);break;case"destroy":!function(t,e){t.unbreakable||e.unbreakable||ju(t,e),void 0===t.getRadius()&&void 0!==e.getRadius()?t.destroy():void 0!==t.getRadius()&&void 0===e.getRadius()?e.destroy():void 0!==t.getRadius()&&void 0!==e.getRadius()&&(t.getRadius()>=e.getRadius()?e:t).destroy()}(t,e)}}class Hu extends Fu{constructor(t){super(t)}clear(){}init(){}async interact(t,e){if(t.destroyed||t.spawning)return;const i=this.container,n=t.getPosition(),r=t.getRadius(),s=i.particles.quadTree.queryCircle(n,2*r);for(const a of s){if(t===a||!a.options.collisions.enable||t.options.collisions.mode!==a.options.collisions.mode||a.destroyed||a.spawning)continue;const s=a.getPosition(),o=a.getRadius();if(Math.abs(Math.round(n.z)-Math.round(s.z))>r+o)continue;Wo(n,s)>r+o||Gu(t,a,e,i.retina.pixelRatio)}}isEnabled(t){return t.options.collisions.enable}reset(){}}class Wu extends ac{constructor(t,e,i,n){super(t,e,i),this.canvasSize=n,this.canvasSize={...n}}contains(t){const{width:e,height:i}=this.canvasSize,{x:n,y:r}=t;return super.contains(t)||super.contains({x:n-e,y:r})||super.contains({x:n-e,y:r-i})||super.contains({x:n,y:r-i})}intersects(t){if(super.intersects(t))return!0;const e=t,i=t,n={x:t.position.x-this.canvasSize.width,y:t.position.y-this.canvasSize.height};if(void 0!==i.radius){const t=new ac(n.x,n.y,2*i.radius);return super.intersects(t)}if(void 0!==e.size){const t=new sc(n.x,n.y,2*e.size.width,2*e.size.height);return super.intersects(t)}return!1}}class qu{constructor(){this.blur=5,this.color=new Ql,this.color.value="#000",this.enable=!1}load(t){t&&(void 0!==t.blur&&(this.blur=t.blur),this.color=Ql.create(this.color,t.color),void 0!==t.enable&&(this.enable=t.enable))}}class Yu{constructor(){this.enable=!1,this.frequency=1}load(t){t&&(void 0!==t.color&&(this.color=Ql.create(this.color,t.color)),void 0!==t.enable&&(this.enable=t.enable),void 0!==t.frequency&&(this.frequency=t.frequency),void 0!==t.opacity&&(this.opacity=t.opacity))}}class Xu{constructor(){this.blink=!1,this.color=new Ql,this.color.value="#fff",this.consent=!1,this.distance=100,this.enable=!1,this.frequency=1,this.opacity=1,this.shadow=new qu,this.triangles=new Yu,this.width=1,this.warp=!1}load(t){t&&(void 0!==t.id&&(this.id=t.id),void 0!==t.blink&&(this.blink=t.blink),this.color=Ql.create(this.color,t.color),void 0!==t.consent&&(this.consent=t.consent),void 0!==t.distance&&(this.distance=t.distance),void 0!==t.enable&&(this.enable=t.enable),void 0!==t.frequency&&(this.frequency=t.frequency),void 0!==t.opacity&&(this.opacity=t.opacity),this.shadow.load(t.shadow),this.triangles.load(t.triangles),void 0!==t.width&&(this.width=t.width),void 0!==t.warp&&(this.warp=t.warp))}}function Qu(t,e,i,n,r){const{dx:s,dy:a,distance:o}=Ho(t,e);if(!r||o<=i)return o;const l={x:Math.abs(s),y:Math.abs(a)},h=Math.min(l.x,n.width-l.x),c=Math.min(l.y,n.height-l.y);return Math.sqrt(h**2+c**2)}class Ku extends Fu{constructor(t){super(t),this._setColor=t=>{if(!t.options.links)return;const e=this.linkContainer,i=t.options.links;let n=void 0===i.id?e.particles.linksColor:e.particles.linksColors.get(i.id);if(n)return;n=Nl(i.color,i.blink,i.consent),void 0===i.id?e.particles.linksColor=n:e.particles.linksColors.set(i.id,n)},this.linkContainer=t}clear(){}init(){this.linkContainer.particles.linksColor=void 0,this.linkContainer.particles.linksColors=new Map}async interact(t){if(!t.options.links)return;t.links=[];const e=t.getPosition(),i=this.container,n=i.canvas.size;if(e.x<0||e.y<0||e.x>n.width||e.y>n.height)return;const r=t.options.links,s=r.opacity,a=t.retina.linksDistance??0,o=r.warp,l=o?new Wu(e.x,e.y,a,n):new ac(e.x,e.y,a),h=i.particles.quadTree.query(l);for(const c of h){const i=c.options.links;if(t===c||!i?.enable||r.id!==i.id||c.spawning||c.destroyed||!c.links||t.links.some((t=>t.destination===c))||c.links.some((e=>e.destination===t)))continue;const l=c.getPosition();if(l.x<0||l.y<0||l.x>n.width||l.y>n.height)continue;const h=Qu(e,l,a,n,o&&i.warp);if(h>a)continue;const u=(1-h/a)*s;this._setColor(t),t.links.push({destination:c,opacity:u})}}isEnabled(t){return!!t.options.links?.enable}loadParticlesOptions(t){t.links||(t.links=new Xu);for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(const r of i)t.links.load(r?.links??r?.lineLinked??r?.line_linked)}reset(){}}function Zu(t,e){const i=((n=t.map((t=>t.id))).sort(((t,e)=>t-e)),n.join("_"));var n;let r=e.get(i);return void 0===r&&(r=Lo(),e.set(i,r)),r}class Ju{constructor(t){this.container=t,this._drawLinkLine=(t,e)=>{const i=t.options.links;if(!i?.enable)return;const n=this.container,r=n.actualOptions,s=e.destination,a=t.getPosition(),o=s.getPosition();let l=e.opacity;n.canvas.draw((e=>{let h;const c=t.options.twinkle?.lines;if(c?.enable){const t=c.frequency,e=Tl(c.color);Lo()<t&&e&&(h=e,l=No(c.opacity))}if(!h){const e=void 0!==i.id?n.particles.linksColors.get(i.id):n.particles.linksColor;h=Fl(t,s,e)}if(!h)return;const u=t.retina.linksWidth??0,d=t.retina.linksDistance??0,{backgroundMask:p}=r;!function(t){let e=!1;const{begin:i,end:n,maxDistance:r,context:s,canvasSize:a,width:o,backgroundMask:l,colorLine:h,opacity:c,links:u}=t;if(Wo(i,n)<=r)Gl(s,i,n),e=!0;else if(u.warp){let t,o;const l=Ho(i,{x:n.x-a.width,y:n.y});if(l.distance<=r){const e=i.y-l.dy/l.dx*i.x;t={x:0,y:e},o={x:a.width,y:e}}else{const e=Ho(i,{x:n.x,y:n.y-a.height});if(e.distance<=r){const n=-(i.y-e.dy/e.dx*i.x)/(e.dy/e.dx);t={x:n,y:0},o={x:n,y:a.height}}else{const e=Ho(i,{x:n.x-a.width,y:n.y-a.height});if(e.distance<=r){const n=i.y-e.dy/e.dx*i.x;t={x:-n/(e.dy/e.dx),y:n},o={x:t.x+a.width,y:t.y+a.height}}}}t&&o&&(Gl(s,i,t),Gl(s,n,o),e=!0)}if(!e)return;s.lineWidth=o,l.enable&&(s.globalCompositeOperation=l.composite),s.strokeStyle=Ll(h,c);const{shadow:d}=u;if(d.enable){const t=Tl(d.color);t&&(s.shadowBlur=d.blur,s.shadowColor=Ll(t))}s.stroke()}({context:e,width:u,begin:a,end:o,maxDistance:d,canvasSize:n.canvas.size,links:i,backgroundMask:p,colorLine:h,opacity:l})}))},this._drawLinkTriangle=(t,e,i)=>{const n=t.options.links;if(!n?.enable)return;const r=n.triangles;if(!r.enable)return;const s=this.container,a=s.actualOptions,o=e.destination,l=i.destination,h=r.opacity??(e.opacity+i.opacity)/2;h<=0||s.canvas.draw((e=>{const i=t.getPosition(),c=o.getPosition(),u=l.getPosition(),d=t.retina.linksDistance??0;if(Wo(i,c)>d||Wo(u,c)>d||Wo(u,i)>d)return;let p=Tl(r.color);if(!p){const e=void 0!==n.id?s.particles.linksColors.get(n.id):s.particles.linksColor;p=Fl(t,o,e)}p&&function(t){const{context:e,pos1:i,pos2:n,pos3:r,backgroundMask:s,colorTriangle:a,opacityTriangle:o}=t;!function(t,e,i,n){t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(i.x,i.y),t.lineTo(n.x,n.y),t.closePath()}(e,i,n,r),s.enable&&(e.globalCompositeOperation=s.composite),e.fillStyle=Ll(a,o),e.fill()}({context:e,pos1:i,pos2:c,pos3:u,backgroundMask:a.backgroundMask,colorTriangle:p,opacityTriangle:h})}))},this._drawTriangles=(t,e,i,n)=>{const r=i.destination;if(!t.links?.triangles.enable||!r.options.links?.triangles.enable)return;const s=r.links?.filter((t=>{const e=this._getLinkFrequency(r,t.destination);return r.options.links&&e<=r.options.links.frequency&&n.findIndex((e=>e.destination===t.destination))>=0}));if(s?.length)for(const a of s){const n=a.destination;this._getTriangleFrequency(e,r,n)>t.links.triangles.frequency||this._drawLinkTriangle(e,i,a)}},this._getLinkFrequency=(t,e)=>Zu([t,e],this._freqs.links),this._getTriangleFrequency=(t,e,i)=>Zu([t,e,i],this._freqs.triangles),this._freqs={links:new Map,triangles:new Map}}drawParticle(t,e){const{links:i,options:n}=e;if(!i||i.length<=0)return;const r=i.filter((t=>n.links&&this._getLinkFrequency(e,t.destination)<=n.links.frequency));for(const s of r)this._drawTriangles(n,e,s,r),s.opacity>0&&(e.retina.linksWidth??0)>0&&this._drawLinkLine(e,s)}async init(){this._freqs.links=new Map,this._freqs.triangles=new Map}particleCreated(t){if(t.links=[],!t.options.links)return;const e=this.container.retina.pixelRatio,{retina:i}=t,{distance:n,width:r}=t.options.links;i.linksDistance=n*e,i.linksWidth=r*e}particleDestroyed(t){t.links=[]}}class $u{constructor(){this.id="links"}getPlugin(t){return new Ju(t)}loadOptions(){}needsPlugin(){return!0}}async function td(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addInteractor("particlesLinks",(t=>new Ku(t)),e)}(t,e),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=new $u;await t.addPlugin(i,e)}(t,e)}class ed{draw(t,e,i){const n=this.getCenter(e,i),r=this.getSidesData(e,i),s=r.count.numerator*r.count.denominator,a=r.count.numerator/r.count.denominator,o=180*(a-2)/a,l=Math.PI-Math.PI*o/180;if(t){t.beginPath(),t.translate(n.x,n.y),t.moveTo(0,0);for(let e=0;e<s;e++)t.lineTo(r.length,0),t.translate(r.length,0),t.rotate(l)}}getSidesCount(t){const e=t.shapeData;return Math.round(No(e?.sides??e?.nb_sides??5))}}class id extends ed{getCenter(t,e){return{x:-e/(t.sides/3.5),y:-e/.76}}getSidesData(t,e){const i=t.sides;return{count:{denominator:1,numerator:i},length:2.66*e/(i/3)}}}class nd extends ed{getCenter(t,e){return{x:-e,y:e/1.66}}getSidesCount(){return 3}getSidesData(t,e){return{count:{denominator:2,numerator:3},length:2*e}}}async function rd(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addShape("polygon",new id,e)}(t,e),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addShape("triangle",new nd,e)}(t,e)}class sd{constructor(){this.enable=!1,this.speed=0,this.decay=0,this.sync=!1}load(t){t&&(void 0!==t.enable&&(this.enable=t.enable),void 0!==t.speed&&(this.speed=jo(t.speed)),void 0!==t.decay&&(this.decay=jo(t.decay)),void 0!==t.sync&&(this.sync=t.sync))}}class ad extends xh{constructor(){super(),this.animation=new sd,this.direction="clockwise",this.path=!1,this.value=0}load(t){t&&(super.load(t),void 0!==t.direction&&(this.direction=t.direction),this.animation.load(t.animation),void 0!==t.path&&(this.path=t.path))}}class od{constructor(t){this.container=t}init(t){const e=t.options.rotate;if(!e)return;t.rotate={enable:e.animation.enable,value:No(e.value)*Math.PI/180},t.pathRotation=e.path;let i=e.direction;if("random"===i){i=Math.floor(2*Lo())>0?"counter-clockwise":"clockwise"}switch(i){case"counter-clockwise":case"counterClockwise":t.rotate.status="decreasing";break;case"clockwise":t.rotate.status="increasing"}const n=e.animation;n.enable&&(t.rotate.decay=1-No(n.decay),t.rotate.velocity=No(n.speed)/360*this.container.retina.reduceFactor,n.sync||(t.rotate.velocity*=Lo())),t.rotation=t.rotate.value}isEnabled(t){const e=t.options.rotate;return!!e&&(!t.destroyed&&!t.spawning&&e.animation.enable&&!e.path)}loadOptions(t){t.rotate||(t.rotate=new ad);for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(const r of i)t.rotate.load(r?.rotate)}update(t,e){this.isEnabled(t)&&(!function(t,e){const i=t.rotate,n=t.options.rotate;if(!i||!n)return;const r=n.animation,s=(i.velocity??0)*e.factor,a=2*Math.PI,o=i.decay??1;r.enable&&("increasing"===i.status?(i.value+=s,i.value>a&&(i.value-=a)):(i.value-=s,i.value<0&&(i.value+=a)),i.velocity&&1!==o&&(i.velocity*=o))}(t,e),t.rotation=t.rotate?.value??0)}}const ld=Math.sqrt(2);class hd{draw(t,e,i){const n=i/ld,r=2*n;t.rect(-n,-n,r,r)}getSidesCount(){return 4}}class cd{draw(t,e,i){const n=e.sides,r=e.starInset??2;t.moveTo(0,0-i);for(let s=0;s<n;s++)t.rotate(Math.PI/n),t.lineTo(0,0-i*r),t.rotate(Math.PI/n),t.lineTo(0,0-i)}getSidesCount(t){const e=t.shapeData;return Math.round(No(e?.sides??e?.nb_sides??5))}particleInit(t,e){const i=e.shapeData,n=No(i?.inset??2);e.starInset=n}}function ud(t,e,i,n,r){if(!e||!i.enable||(e.maxLoops??0)>0&&(e.loops??0)>(e.maxLoops??0))return;if(e.time||(e.time=0),(e.delayTime??0)>0&&e.time<(e.delayTime??0)&&(e.time+=t.value),(e.delayTime??0)>0&&e.time<(e.delayTime??0))return;const s=Fo(i.offset),a=(e.velocity??0)*t.factor+3.6*s,o=e.decay??1;r&&"increasing"!==e.status?(e.value-=a,e.value<0&&(e.loops||(e.loops=0),e.loops++,e.status="increasing",e.value+=e.value)):(e.value+=a,e.value>n&&(e.loops||(e.loops=0),e.loops++,r&&(e.status="decreasing",e.value-=e.value%n))),e.velocity&&1!==o&&(e.velocity*=o),e.value>n&&(e.value%=n)}class dd{constructor(t){this.container=t}init(t){const e=this.container,i=t.options,n=dl(i.stroke,t.id,i.reduceDuplicates);t.strokeWidth=No(n.width)*e.retina.pixelRatio,t.strokeOpacity=No(n.opacity??1),t.strokeAnimation=n.color?.animation;const r=kl(n.color)??t.getFillColor();r&&(t.strokeColor=Vl(r,t.strokeAnimation,e.retina.reduceFactor))}isEnabled(t){const e=t.strokeAnimation,{strokeColor:i}=t;return!t.destroyed&&!t.spawning&&!!e&&(void 0!==i?.h.value&&i.h.enable||void 0!==i?.s.value&&i.s.enable||void 0!==i?.l.value&&i.l.enable)}update(t,e){this.isEnabled(t)&&function(t,e){if(!t.strokeColor||!t.strokeAnimation)return;const{h:i,s:n,l:r}=t.strokeColor,{h:s,s:a,l:o}=t.strokeAnimation;i&&ud(e,i,s,360,!1),n&&ud(e,n,a,100,!0),r&&ud(e,r,o,100,!0)}(t,e)}}const pd=["text","character","char"];class fd{draw(t,e,i,n){const r=e.shapeData;if(void 0===r)return;const s=r.value;if(void 0===s)return;void 0===e.text&&(e.text=dl(s,e.randomIndexData));const a=e.text,o=r.style??"",l=r.weight??"400",h=2*Math.round(i),c=r.font??"Verdana",u=e.fill,d=a.length*i/2;t.font=`${o} ${l} ${h}px "${c}"`;const p={x:-d,y:i/2};t.globalAlpha=n,u?t.fillText(a,p.x,p.y):t.strokeText(a,p.x,p.y),t.globalAlpha=1}getSidesCount(){return 12}async init(t){const e=t.actualOptions;if(pd.find((t=>tl(t,e.particles.shape.type)))){const t=pd.map((t=>e.particles.shape.options[t])).find((t=>!!t)),i=[];ul(t,(t=>{i.push(async function(t,e){try{await document.fonts.load(`${e??"400"} 36px '${t??"Verdana"}'`)}catch{}}(t.font,t.weight))})),await Promise.all(i)}}particleInit(t,e){if(!e.shape||!pd.includes(e.shape))return;const i=e.shapeData;if(void 0===i)return;const n=i.value;void 0!==n&&(e.text=dl(n,e.randomIndexData))}}async function md(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(t=>{const{particlesJS:e,pJSDom:i}=(t=>{const e=(e,i)=>t.load(e,i);return e.load=(e,i,n)=>{t.loadJSON(e,i).then((t=>{t&&n(t)})).catch((()=>{n(void 0)}))},e.setOnClickHandler=e=>{t.setOnClickHandler(e)},{particlesJS:e,pJSDom:t.dom()}})(t);window.particlesJS=e,window.pJSDom=i,window.Particles=Pc})(t),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addMover("parallax",(()=>new zu),e)}(t,!1),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addInteractor("externalAttract",(e=>new Hc(t,e)),e)}(t,!1),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addInteractor("externalBounce",(t=>new qc(t)),e)}(t,!1),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addInteractor("externalBubble",(t=>new Zc(t)),e)}(t,!1),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addInteractor("externalConnect",(t=>new iu(t)),e)}(t,!1),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addInteractor("externalGrab",(t=>new au(t)),e)}(t,!1),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addInteractor("externalPause",(t=>new ou(t)),e)}(t,!1),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addInteractor("externalPush",(t=>new hu(t)),e)}(t,!1),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addInteractor("externalRemove",(t=>new uu(t)),e)}(t,!1),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addInteractor("externalRepulse",(e=>new mu(t,e)),e)}(t,!1),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addInteractor("externalSlow",(t=>new vu(t)),e)}(t,!1),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addInteractor("particlesAttract",(t=>new Nu(t)),e)}(t,!1),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addInteractor("particlesCollisions",(t=>new Hu(t)),e)}(t,!1),await td(t,!1),await async function(){Ro("ease-in-quad",(t=>t**2)),Ro("ease-out-quad",(t=>1-(1-t)**2)),Ro("ease-in-out-quad",(t=>t<.5?2*t**2:1-(-2*t+2)**2/2))}(),await ku(t,!1),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addShape("line",new Bu,e)}(t,!1),await rd(t,!1),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addShape(["edge","square"],new hd,e)}(t,!1),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addShape("star",new cd,e)}(t,!1),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addShape(pd,new fd,e)}(t,!1),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addParticleUpdater("life",(t=>new Lu(t)),e)}(t,!1),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addParticleUpdater("rotate",(t=>new od(t)),e)}(t,!1),await async function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];await t.addParticleUpdater("strokeColor",(t=>new dd(t)),e)}(t,!1),await Vc(t,e)}const gd=()=>{const e=(0,t.useCallback)((async t=>{t&&t.interactivity.element.addEventListener("click",(e=>{t.particles&&t.particles.array&&t.particles.array.forEach((t=>{const i=e.clientX-t.position.x,n=e.clientY-t.position.y;Math.sqrt(i*i+n*n)<50&&(t.size.value=10,setTimeout((()=>{t.size.value=3}),500))}))}))}),[]);return(0,i.jsx)("div",{className:"particles-container",children:(0,i.jsx)(Mc,{id:"tsparticles",init:async t=>{await md(t)},loaded:e,options:{background:{color:"transparent"},particles:{number:{value:75,density:{enable:!0,value_area:800}},color:{value:"#8B5DFF"},shape:{type:"circle"},opacity:{value:.5,random:!0},size:{value:3,random:!0},move:{enable:!0,speed:1,direction:"none",out_mode:"out"},links:{enable:!0,distance:150,color:"#8B5DFF",opacity:.4,width:1}},interactivity:{events:{onClick:{enable:!0,mode:"push"},onHover:{enable:!0,mode:"repulse"}},modes:{push:{quantity:1},grab:{distance:200,line_linked:{opacity:.5}}}}}})})};function vd(t,e){[...e].reverse().forEach((i=>{const n=t.getVariant(i);n&&gt(t,n),t.variantChildren&&t.variantChildren.forEach((t=>{vd(t,e)}))}))}function yd(){let t=!1;const e=new Set,i={subscribe:t=>(e.add(t),()=>{e.delete(t)}),start(i,n){Be(t,"controls.start() should only be called after a component has mounted. Consider calling within a useEffect hook.");const r=[];return e.forEach((t=>{r.push($i(t,i,{transitionOverride:n}))})),Promise.all(r)},set:i=>(Be(t,"controls.set() should only be called after a component has mounted. Consider calling within a useEffect hook."),e.forEach((t=>{!function(t,e){Array.isArray(e)?vd(t,e):"string"===typeof e?vd(t,[e]):gt(t,e)}(t,i)}))),stop(){e.forEach((t=>{!function(t){t.values.forEach((t=>t.stop()))}(t)}))},mount:()=>(t=!0,()=>{t=!1,i.stop()})};return i}const bd=function(){const t=_a(yd);return Zs(t.mount,[]),t};var xd=Object.defineProperty,wd=(t,e,i)=>((t,e,i)=>e in t?xd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i)(t,"symbol"!==typeof e?e+"":e,i),Sd=new Map,Ad=new WeakMap,Ed=0,_d=void 0;function Cd(t){return Object.keys(t).sort().filter((e=>void 0!==t[e])).map((e=>`${e}_${"root"===e?function(t){return t?(Ad.has(t)||(Ed+=1,Ad.set(t,Ed.toString())),Ad.get(t)):"0"}(t.root):t[e]}`)).toString()}function Md(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_d;if("undefined"===typeof window.IntersectionObserver&&void 0!==n){const r=t.getBoundingClientRect();return e(n,{isIntersecting:n,target:t,intersectionRatio:"number"===typeof i.threshold?i.threshold:0,time:0,boundingClientRect:r,intersectionRect:r,rootBounds:r}),()=>{}}const{id:r,observer:s,elements:a}=function(t){const e=Cd(t);let i=Sd.get(e);if(!i){const n=new Map;let r;const s=new IntersectionObserver((e=>{e.forEach((e=>{var i;const s=e.isIntersecting&&r.some((t=>e.intersectionRatio>=t));t.trackVisibility&&"undefined"===typeof e.isVisible&&(e.isVisible=s),null==(i=n.get(e.target))||i.forEach((t=>{t(s,e)}))}))}),t);r=s.thresholds||(Array.isArray(t.threshold)?t.threshold:[t.threshold||0]),i={id:e,observer:s,elements:n},Sd.set(e,i)}return i}(i),o=a.get(t)||[];return a.has(t)||a.set(t,o),o.push(e),s.observe(t),function(){o.splice(o.indexOf(e),1),0===o.length&&(a.delete(t),s.unobserve(t)),0===a.size&&(s.disconnect(),Sd.delete(r))}}t.Component;const Pd=[{name:"HTML",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAMAAADDpiTIAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAABBTAAAQUwGKEV3UAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAwBQTFRF/////EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkL/EkLzQNIBgAAAP90Uk5TAAECAwQF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",link:"https://developer.mozilla.org/en-US/docs/Web/HTML"},{name:"CSS",icon:__webpack_require__.p+"static/media/Css.463e319bad8e0edf1ef7.png",link:"https://developer.mozilla.org/en-US/docs/Web/CSS"},{name:"JavaScript",icon:__webpack_require__.p+"static/media/Javascript.19600440c8c62e3de974e2bba991871f.svg",link:"https://developer.mozilla.org/en-US/docs/Web/JavaScript"},{name:"ReactJS",icon:__webpack_require__.p+"static/media/React.6d4dd5dfc6163bdfcfe520bd6bef1a6a.svg",link:"https://react.dev/"},{name:"Tailwind CSS",icon:__webpack_require__.p+"static/media/Tailwind.18899002f0c0d414d0d2.png",link:"https://tailwindcss.com/docs/"},{name:"WordPress",icon:__webpack_require__.p+"static/media/wordpress.086d443d28c39ea3cdac.png",link:"https://developer.wordpress.org/"},{name:"MySQL",icon:__webpack_require__.p+"static/media/mysqll.7d8d571e5629923eaf74.png",link:"https://dev.mysql.com/doc/"},{name:"UML",icon:__webpack_require__.p+"static/media/uml.eb2cfdd831102be7d4e8.png",link:"https://www.uml-diagrams.org/"},{name:"Java",icon:__webpack_require__.p+"static/media/java-icon.1eb26d15c955096cc5ce.png",link:"https://docs.oracle.com/en/java/"},{name:"Spring Boot",icon:__webpack_require__.p+"static/media/springboot.dd1eea21123b57435af2.png",link:"https://docs.spring.io/spring-boot/docs/current/reference/html/"}],Td=()=>{const e=bd(),[n,r]=function(){let{threshold:e,delay:i,trackVisibility:n,rootMargin:r,root:s,triggerOnce:a,skip:o,initialInView:l,fallbackInView:h,onChange:c}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var u;const[d,p]=t.useState(null),f=t.useRef(c),[m,g]=t.useState({inView:!!l,entry:void 0});f.current=c,t.useEffect((()=>{if(o||!d)return;let t;return t=Md(d,((e,i)=>{g({inView:e,entry:i}),f.current&&f.current(e,i),i.isIntersecting&&a&&t&&(t(),t=void 0)}),{root:s,rootMargin:r,threshold:e,trackVisibility:n,delay:i},h),()=>{t&&t()}}),[Array.isArray(e)?e.toString():e,d,s,r,a,o,n,h,i]);const v=null==(u=m.entry)?void 0:u.target,y=t.useRef(void 0);d||!v||a||o||y.current===v||(y.current=v,g({inView:!!l,entry:void 0}));const b=[p,m.inView,m.entry];return b.ref=b[0],b.inView=b[1],b.entry=b[2],b}({triggerOnce:!0,threshold:.1});t.useEffect((()=>{r&&e.start("visible")}),[e,r]);const s={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}};return(0,i.jsxs)("div",{className:"global-skills",ref:n,children:[(0,i.jsx)("h2",{children:"My Skills"}),(0,i.jsx)(Ya.div,{className:"skills-container",initial:"hidden",animate:e,variants:{visible:{transition:{staggerChildren:.1}}},children:Pd.map(((t,e)=>(0,i.jsxs)(Ya.a,{href:t.link,target:"_blank",rel:"noopener noreferrer",className:"skill-item",variants:s,children:[(0,i.jsx)("img",{src:t.icon,alt:t.name,className:"skill-icon"}),(0,i.jsx)("span",{className:"skill-name",children:t.name})]},e)))})]})},Dd=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return e.filter(((t,e,i)=>Boolean(t)&&""!==t.trim()&&i.indexOf(t)===e)).join(" ").trim()};var kd={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Id=(0,t.forwardRef)(((e,i)=>{let{color:n="currentColor",size:r=24,strokeWidth:s=2,absoluteStrokeWidth:a,className:o="",children:l,iconNode:h,...c}=e;return(0,t.createElement)("svg",{ref:i,...kd,width:r,height:r,stroke:n,strokeWidth:a?24*Number(s)/Number(r):s,className:Dd("lucide",o),...c},[...h.map((e=>{let[i,n]=e;return(0,t.createElement)(i,n)})),...Array.isArray(l)?l:[l]])})),Rd=(e,i)=>{const n=(0,t.forwardRef)(((n,r)=>{let{className:s,...a}=n;return(0,t.createElement)(Id,{ref:r,iconNode:i,className:Dd(`lucide-${o=e,o.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,s),...a});var o}));return n.displayName=`${e}`,n},Od=Rd("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]),Ld=Rd("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]),Bd=[{id:1,title:"Bachelor\u2019s Degree in Physical Sciences \u2013 French Option (2021-2022)",description:"El Amria High School, El Kel\xe2a Des Sraghna",side:"left",icon:(0,i.jsx)(Od,{size:24})},{id:2,title:"Diploma of University Technology (DUT) in Computer Engineering (2023-2024)",description:"Higher School of Technology (EST), Fkih Ben Salah",side:"right",icon:(0,i.jsx)(Od,{size:24})},{id:3,title:"Internship at Sultan Moulay Slimane University, Beni Mellal",description:"Website development using WordPress",side:"left",icon:(0,i.jsx)(Ld,{size:24})},{id:4,title:"Internship at the Oum Er-Rbia Hydraulic Basin Agency, Beni Mellal",description:"Development of a Web Application for Email Management with Spring Boot and React Js",side:"left",icon:(0,i.jsx)(Ld,{size:24})},{id:5,title:"First-Year Engineer's Degree in Computer Engineering and AI (2024-2025)",description:"National School of Applied Sciences (ENSA), Safi",side:"right",icon:(0,i.jsx)(Od,{size:24})}],zd=()=>((0,t.useEffect)((()=>{const t=new IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting&&t.target.classList.add("visible")}))}),{rootMargin:"0px",threshold:.5}),e=document.querySelectorAll(".timeline-item .timeline-content");return e.forEach((e=>t.observe(e))),()=>{e.forEach((e=>t.unobserve(e)))}}),[]),(0,i.jsxs)("div",{className:"global-timeline",children:[(0,i.jsx)("h2",{children:"My Career"}),(0,i.jsxs)("div",{className:"timeline",children:[Bd.map((t=>(0,i.jsxs)("div",{className:`timeline-item ${t.side}`,children:[(0,i.jsx)("div",{className:"timeline-icon-container",children:(0,i.jsx)("div",{className:"timeline-icon",children:t.icon})}),(0,i.jsxs)("div",{className:"timeline-content",children:[(0,i.jsx)("h3",{children:t.title}),(0,i.jsx)("p",{children:t.description})]})]},t.id))),(0,i.jsx)("div",{className:"timeline-line"})]})]}));class Fd{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Network Error";this.status=t,this.text=e}}const Nd={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:(()=>{if("undefined"!==typeof localStorage)return{get:t=>Promise.resolve(localStorage.getItem(t)),set:(t,e)=>Promise.resolve(localStorage.setItem(t,e)),remove:t=>Promise.resolve(localStorage.removeItem(t))}})()},Ud=t=>t?"string"===typeof t?{publicKey:t}:"[object Object]"===t.toString()?t:{}:{},Vd=async function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=await fetch(Nd.origin+t,{method:"POST",headers:i,body:e}),r=await n.text(),s=new Fd(n.status,r);if(n.ok)return s;throw s},jd=(t,e,i)=>{if(!t||"string"!==typeof t)throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!e||"string"!==typeof e)throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!i||"string"!==typeof i)throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},Gd=t=>t.webdriver||!t.languages||0===t.languages.length,Hd=()=>new Fd(451,"Unavailable For Headless Browser"),Wd=(t,e)=>{if((t=>!t.list?.length||!t.watchVariable)(t))return!1;((t,e)=>{if(!Array.isArray(t))throw"The BlockList list has to be an array";if("string"!==typeof e)throw"The BlockList watchVariable has to be a string"})(t.list,t.watchVariable);const i=(n=e,r=t.watchVariable,n instanceof FormData?n.get(r):n[r]);var n,r;return"string"===typeof i&&t.list.includes(i)},qd=()=>new Fd(403,"Forbidden"),Yd=async(t,e,i)=>{if(!e.throttle||!i)return!1;((t,e)=>{if("number"!==typeof t||t<0)throw"The LimitRate throttle has to be a positive number";if(e&&"string"!==typeof e)throw"The LimitRate ID has to be a non-empty string"})(e.throttle,e.id);const n=e.id||t,r=await(async(t,e,i)=>{const n=Number(await i.get(t)||0);return e-Date.now()+n})(n,e.throttle,i);return r>0||(await i.set(n,Date.now().toString()),!1)},Xd=()=>new Fd(429,"Too Many Requests"),Qd=async(t,e,i,n)=>{const r=Ud(n),s=r.publicKey||Nd.publicKey,a=r.blockHeadless||Nd.blockHeadless,o=r.storageProvider||Nd.storageProvider,l={...Nd.blockList,...r.blockList},h={...Nd.limitRate,...r.limitRate};if(a&&Gd(navigator))return Promise.reject(Hd());if(jd(s,t,e),(t=>{if(t&&"[object Object]"!==t.toString())throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"})(i),i&&Wd(l,i))return Promise.reject(qd());if(await Yd(location.pathname,h,o))return Promise.reject(Xd());const c={lib_version:"4.4.1",user_id:s,service_id:t,template_id:e,template_params:i};return Vd("/api/v1.0/email/send",JSON.stringify(c),{"Content-type":"application/json"})};var Kd=Object.create,Zd=Object.defineProperty,Jd=Object.getOwnPropertyDescriptor,$d=Object.getOwnPropertyNames,tp=Object.getPrototypeOf,ep=Object.prototype.hasOwnProperty,ip=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),np=(t,e,i)=>(i=null!=t?Kd(tp(t)):{},((t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let r of $d(e))!ep.call(t,r)&&r!==i&&Zd(t,r,{get:()=>e[r],enumerable:!(n=Jd(e,r))||n.enumerable});return t})(!e&&t&&t.__esModule?i:Zd(i,"default",{value:t,enumerable:!0}),t)),rp=(t,e,i)=>(((t,e,i)=>{e in t?Zd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i})(t,"symbol"!=typeof e?e+"":e,i),i),sp=ip(((t,e)=>{var i,n;i=t,n=function(){return t.importState=function(e){var i=new t;return i.importState(e),i},t;function t(){return function(t){var e=0,i=0,n=0,r=1;0==t.length&&(t=[+new Date]);var s=function(){var t=4022871197,e=function(e){e=e.toString();for(var i=0;i<e.length;i++){var n=.02519603282416938*(t+=e.charCodeAt(i));n-=t=n>>>0,t=(n*=t)>>>0,t+=4294967296*(n-=t)}return 2.3283064365386963e-10*(t>>>0)};return e.version="Mash 0.9",e}();e=s(" "),i=s(" "),n=s(" ");for(var a=0;a<t.length;a++)(e-=s(t[a]))<0&&(e+=1),(i-=s(t[a]))<0&&(i+=1),(n-=s(t[a]))<0&&(n+=1);s=null;var o=function(){var t=2091639*e+2.3283064365386963e-10*r;return e=i,i=n,n=t-(r=0|t)};return o.next=o,o.uint32=function(){return 4294967296*o()},o.fract53=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.version="Alea 0.9",o.args=t,o.exportState=function(){return[e,i,n,r]},o.importState=function(t){e=+t[0]||0,i=+t[1]||0,n=+t[2]||0,r=+t[3]||0},o}(Array.prototype.slice.call(arguments))}},"object"==typeof t?e.exports=n():"function"==typeof define&&define.amd?define(n):i.Alea=n()})),ap=ip(((t,e)=>{var i,n;i=t,n=function(t){t.SVD=function(t,e,i,n,r){if(e=void 0===e||e,i=void 0===i||i,r=1e-64/(n=n||Math.pow(2,-52)),!t)throw new TypeError("Matrix a is not defined");var s,a,o,l,h,c,u,d,p,f,m,g,v=t[0].length,y=t.length;if(y<v)throw new TypeError("Invalid matrix: m < n");for(var b=[],x=[],w=[],S="f"===e?y:v,A=f=u=0;A<y;A++)x[A]=new Array(S).fill(0);for(A=0;A<v;A++)w[A]=new Array(v).fill(0);var E,_=new Array(v).fill(0);for(A=0;A<y;A++)for(s=0;s<v;s++)x[A][s]=t[A][s];for(A=0;A<v;A++){for(b[A]=u,p=0,o=A+1,s=A;s<y;s++)p+=Math.pow(x[s][A],2);if(p<r)u=0;else for(d=(c=x[A][A])*(u=c<0?Math.sqrt(p):-Math.sqrt(p))-p,x[A][A]=c-u,s=o;s<v;s++){for(p=0,a=A;a<y;a++)p+=x[a][A]*x[a][s];for(c=p/d,a=A;a<y;a++)x[a][s]=x[a][s]+c*x[a][A]}for(_[A]=u,p=0,s=o;s<v;s++)p+=Math.pow(x[A][s],2);if(p<r)u=0;else{for(d=(c=x[A][A+1])*(u=c<0?Math.sqrt(p):-Math.sqrt(p))-p,x[A][A+1]=c-u,s=o;s<v;s++)b[s]=x[A][s]/d;for(s=o;s<y;s++){for(p=0,a=o;a<v;a++)p+=x[s][a]*x[A][a];for(a=o;a<v;a++)x[s][a]=x[s][a]+p*b[a]}}f<(m=Math.abs(_[A])+Math.abs(b[A]))&&(f=m)}if(i)for(A=v-1;0<=A;A--){if(0!==u){for(d=x[A][A+1]*u,s=o;s<v;s++)w[s][A]=x[A][s]/d;for(s=o;s<v;s++){for(p=0,a=o;a<v;a++)p+=x[A][a]*w[a][s];for(a=o;a<v;a++)w[a][s]=w[a][s]+p*w[a][A]}}for(s=o;s<v;s++)w[A][s]=0,w[s][A]=0;w[A][A]=1,u=b[A],o=A}if(e){if("f"===e)for(A=v;A<y;A++){for(s=v;s<y;s++)x[A][s]=0;x[A][A]=1}for(A=v-1;0<=A;A--){for(o=A+1,u=_[A],s=o;s<S;s++)x[A][s]=0;if(0!==u){for(d=x[A][A]*u,s=o;s<S;s++){for(p=0,a=o;a<y;a++)p+=x[a][A]*x[a][s];for(c=p/d,a=A;a<y;a++)x[a][s]=x[a][s]+c*x[a][A]}for(s=A;s<y;s++)x[s][A]=x[s][A]/u}else for(s=A;s<y;s++)x[s][A]=0;x[A][A]=x[A][A]+1}}for(n*=f,a=v-1;0<=a;a--)for(var C=0;C<50;C++){for(E=!1,o=a;0<=o;o--){if(Math.abs(b[o])<=n){E=!0;break}if(Math.abs(_[o-1])<=n)break}if(!E)for(h=0,l=o-(p=1),A=o;A<a+1&&(c=p*b[A],b[A]=h*b[A],!(Math.abs(c)<=n));A++)if(u=_[A],_[A]=Math.sqrt(c*c+u*u),h=u/(d=_[A]),p=-c/d,e)for(s=0;s<y;s++)m=x[s][l],g=x[s][A],x[s][l]=m*h+g*p,x[s][A]=-m*p+g*h;if(g=_[a],o===a){if(g<0&&(_[a]=-g,i))for(s=0;s<v;s++)w[s][a]=-w[s][a];break}for(f=_[o],c=(((m=_[a-1])-g)*(m+g)+((u=b[a-1])-(d=b[a]))*(u+d))/(2*d*m),u=Math.sqrt(c*c+1),c=((f-g)*(f+g)+d*(m/(c<0?c-u:c+u)-d))/f,A=o+(p=h=1);A<a+1;A++){if(u=b[A],m=_[A],d=p*u,u*=h,g=Math.sqrt(c*c+d*d),c=f*(h=c/(b[A-1]=g))+u*(p=d/g),u=-f*p+u*h,d=m*p,m*=h,i)for(s=0;s<v;s++)f=w[s][A-1],g=w[s][A],w[s][A-1]=f*h+g*p,w[s][A]=-f*p+g*h;if(g=Math.sqrt(c*c+d*d),c=(h=c/(_[A-1]=g))*u+(p=d/g)*m,f=-p*u+h*m,e)for(s=0;s<y;s++)m=x[s][A-1],g=x[s][A],x[s][A-1]=m*h+g*p,x[s][A]=-m*p+g*h}b[o]=0,b[a]=c,_[a]=f}for(A=0;A<v;A++)_[A]<n&&(_[A]=0);return{u:x,q:_,v:w}},t.VERSION="1.1.1",Object.defineProperty(t,"__esModule",{value:!0})},"object"==typeof t&&typeof e<"u"?n(t):"function"==typeof define&&define.amd?define(["exports"],n):n((i=typeof globalThis<"u"?globalThis:i||self).SVDJS={})})),op=ip(((t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t){if(null===t||!0===t||!1===t)return NaN;var e=Number(t);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)},e.exports=t.default})),lp=ip(((t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t){var e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return e.setUTCFullYear(t.getFullYear()),t.getTime()-e.getTime()},e.exports=t.default})),hp=ip(((t,e)=>{function i(t,e,n,r){this.message=t,this.expected=e,this.found=n,this.location=r,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,i)}!function(t,e){function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i}(i,Error),i.buildMessage=function(t,e){var i,n={literal:function(t){return'"'+s(t.text)+'"'},class:function(t){var e,i="";for(e=0;e<t.parts.length;e++)i+=t.parts[e]instanceof Array?a(t.parts[e][0])+"-"+a(t.parts[e][1]):a(t.parts[e]);return"["+(t.inverted?"^":"")+i+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function r(t){return t.charCodeAt(0).toString(16).toUpperCase()}function s(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+r(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+r(t)}))}function a(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+r(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+r(t)}))}function o(t){return n[t.type](t)}return"Expected "+function(t){var e,i,n=new Array(t.length);for(e=0;e<t.length;e++)n[e]=o(t[e]);if(n.sort(),n.length>0){for(e=1,i=1;e<n.length;e++)n[e-1]!==n[e]&&(n[i]=n[e],i++);n.length=i}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(t)+" but "+(((i=e)?'"'+s(i)+'"':"end of input")+" found.")},e.exports={SyntaxError:i,parse:function(t,e){e=void 0!==e?e:{};var n,r={},s={svg_path:gt},a=gt,o=function(t){if(!t)return[];for(var e=[],i=0;i<t.length;i++)e=e.concat.apply(e,t[i]);var n=e[0];return n&&"m"==n.code&&(delete n.relative,n.code="M"),e},l=function(t,e){return function(t,e){if(!e)return[t];for(var i=[t],n=0,r=e.length;n<r;n++)i[n+1]=e[n][1];return i}(t,e)},h=/^[Mm]/,c=ut(["M","m"],!1,!1),u=function(t,e,i){var n=Ft(t,[e]);return i&&(n=n.concat(Ft("M"==t?"L":"l",i[1]))),n},d=/^[Zz]/,p=ut(["Z","z"],!1,!1),f=function(){return Ft("Z")},m=/^[Ll]/,g=ut(["L","l"],!1,!1),v=function(t,e){return Ft(t,e)},y=/^[Hh]/,b=ut(["H","h"],!1,!1),x=function(t,e){return Ft(t,e.map((function(t){return{x:t}})))},w=/^[Vv]/,S=ut(["V","v"],!1,!1),A=function(t,e){return Ft(t,e.map((function(t){return{y:t}})))},E=/^[Cc]/,_=ut(["C","c"],!1,!1),C=function(t,e,i){return{x1:t.x,y1:t.y,x2:e.x,y2:e.y,x:i.x,y:i.y}},M=/^[Ss]/,P=ut(["S","s"],!1,!1),T=function(t,e){return{x2:t.x,y2:t.y,x:e.x,y:e.y}},D=/^[Qq]/,k=ut(["Q","q"],!1,!1),I=function(t,e){return{x1:t.x,y1:t.y,x:e.x,y:e.y}},R=/^[Tt]/,O=ut(["T","t"],!1,!1),L=/^[Aa]/,B=ut(["A","a"],!1,!1),z=function(t,e,i,n,r,s){return{rx:t,ry:e,xAxisRotation:i,largeArc:n,sweep:r,x:s.x,y:s.y}},F=function(t,e){return{x:t,y:e}},N=function(t){return 1*t},U=function(t){return 1*t.join("")},V=/^[01]/,j=ut(["0","1"],!1,!1),G=function(t){return"1"==t},H=function(){return""},W=",",q=ct(",",!1),Y=function(t){return t.join("")},X=".",Q=ct(".",!1),K=/^[eE]/,Z=ut(["e","E"],!1,!1),J=/^[+\-]/,$=ut(["+","-"],!1,!1),tt=/^[0-9]/,et=ut([["0","9"]],!1,!1),it=function(t){return t.join("")},nt=/^[ \t\n\r]/,rt=ut([" ","\t","\n","\r"],!1,!1),st=0,at=[{line:1,column:1}],ot=0,lt=[],ht=0;if("startRule"in e){if(!(e.startRule in s))throw new Error("Can't start parsing from rule \""+e.startRule+'".');a=s[e.startRule]}function ct(t,e){return{type:"literal",text:t,ignoreCase:e}}function ut(t,e,i){return{type:"class",parts:t,inverted:e,ignoreCase:i}}function dt(e){var i,n=at[e];if(n)return n;for(i=e-1;!at[i];)i--;for(n={line:(n=at[i]).line,column:n.column};i<e;)10===t.charCodeAt(i)?(n.line++,n.column=1):n.column++,i++;return at[e]=n,n}function pt(t,e){var i=dt(t),n=dt(e);return{start:{offset:t,line:i.line,column:i.column},end:{offset:e,line:n.line,column:n.column}}}function ft(t){st<ot||(st>ot&&(ot=st,lt=[]),lt.push(t))}function mt(t,e,n){return new i(i.buildMessage(t,e),t,e,n)}function gt(){var t,e,i,n,s;for(t=st,e=[],i=Lt();i!==r;)e.push(i),i=Lt();if(e!==r)if(i=function(){var t,e,i,n,s,a;if(t=st,e=vt(),e!==r){for(i=[],n=st,s=[],a=Lt();a!==r;)s.push(a),a=Lt();for(s!==r?(a=vt())!==r?n=s=[s,a]:(st=n,n=r):(st=n,n=r);n!==r;){for(i.push(n),n=st,s=[],a=Lt();a!==r;)s.push(a),a=Lt();s!==r?(a=vt())!==r?n=s=[s,a]:(st=n,n=r):(st=n,n=r)}i!==r?t=e=l(e,i):(st=t,t=r)}else st=t,t=r;return t}(),i===r&&(i=null),i!==r){for(n=[],s=Lt();s!==r;)n.push(s),s=Lt();n!==r?t=e=o(i):(st=t,t=r)}else st=t,t=r;else st=t,t=r;return t}function vt(){var e,i,n,s,a,o;if(e=st,i=function(){var e,i,n,s,a,o,l;if(e=st,h.test(t.charAt(st))?(i=t.charAt(st),st++):(i=r,0===ht&&ft(c)),i!==r){for(n=[],s=Lt();s!==r;)n.push(s),s=Lt();n!==r?(s=_t())!==r?(a=st,(o=Tt())===r&&(o=null),o!==r?(l=bt())!==r?a=o=[o,l]:(st=a,a=r):(st=a,a=r),a===r&&(a=null),a!==r?e=i=u(i,s,a):(st=e,e=r)):(st=e,e=r):(st=e,e=r)}else st=e,e=r;return e}(),i!==r){for(n=[],s=st,a=[],o=Lt();o!==r;)a.push(o),o=Lt();for(a!==r?(o=yt())!==r?s=a=[a,o]:(st=s,s=r):(st=s,s=r);s!==r;){for(n.push(s),s=st,a=[],o=Lt();o!==r;)a.push(o),o=Lt();a!==r?(o=yt())!==r?s=a=[a,o]:(st=s,s=r):(st=s,s=r)}n!==r?e=i=l(i,n):(st=e,e=r)}else st=e,e=r;return e}function yt(){var e;return(e=function(){var e,i;return e=st,d.test(t.charAt(st))?(i=t.charAt(st),st++):(i=r,0===ht&&ft(p)),i!==r&&(i=f()),e=i,e}())===r&&((e=function(){var e,i,n,s;if(e=st,m.test(t.charAt(st))?(i=t.charAt(st),st++):(i=r,0===ht&&ft(g)),i!==r){for(n=[],s=Lt();s!==r;)n.push(s),s=Lt();n!==r?(s=bt())!==r?e=i=v(i,s):(st=e,e=r):(st=e,e=r)}else st=e,e=r;return e}())===r&&((e=function(){var e,i,n,s;if(e=st,y.test(t.charAt(st))?(i=t.charAt(st),st++):(i=r,0===ht&&ft(b)),i!==r){for(n=[],s=Lt();s!==r;)n.push(s),s=Lt();n!==r?(s=xt())!==r?e=i=x(i,s):(st=e,e=r):(st=e,e=r)}else st=e,e=r;return e}())===r&&((e=function(){var e,i,n,s;if(e=st,w.test(t.charAt(st))?(i=t.charAt(st),st++):(i=r,0===ht&&ft(S)),i!==r){for(n=[],s=Lt();s!==r;)n.push(s),s=Lt();n!==r?(s=xt())!==r?e=i=A(i,s):(st=e,e=r):(st=e,e=r)}else st=e,e=r;return e}())===r&&((e=function(){var e,i,n,s;if(e=st,E.test(t.charAt(st))?(i=t.charAt(st),st++):(i=r,0===ht&&ft(_)),i!==r){for(n=[],s=Lt();s!==r;)n.push(s),s=Lt();n!==r?(s=function(){var t,e,i,n,s,a;if(t=st,e=wt(),e!==r){for(i=[],n=st,(s=Tt())===r&&(s=null),s!==r?(a=wt())!==r?n=s=[s,a]:(st=n,n=r):(st=n,n=r);n!==r;)i.push(n),n=st,(s=Tt())===r&&(s=null),s!==r?(a=wt())!==r?n=s=[s,a]:(st=n,n=r):(st=n,n=r);i!==r?t=e=l(e,i):(st=t,t=r)}else st=t,t=r;return t}(),s!==r?e=i=v(i,s):(st=e,e=r)):(st=e,e=r)}else st=e,e=r;return e}())===r&&((e=function(){var e,i,n,s;if(e=st,M.test(t.charAt(st))?(i=t.charAt(st),st++):(i=r,0===ht&&ft(P)),i!==r){for(n=[],s=Lt();s!==r;)n.push(s),s=Lt();n!==r?(s=function(){var t,e,i,n,s,a;if(t=st,e=St(),e!==r){for(i=[],n=st,(s=Tt())===r&&(s=null),s!==r?(a=St())!==r?n=s=[s,a]:(st=n,n=r):(st=n,n=r);n!==r;)i.push(n),n=st,(s=Tt())===r&&(s=null),s!==r?(a=St())!==r?n=s=[s,a]:(st=n,n=r):(st=n,n=r);i!==r?t=e=l(e,i):(st=t,t=r)}else st=t,t=r;return t}(),s!==r?e=i=v(i,s):(st=e,e=r)):(st=e,e=r)}else st=e,e=r;return e}())===r&&((e=function(){var e,i,n,s;if(e=st,D.test(t.charAt(st))?(i=t.charAt(st),st++):(i=r,0===ht&&ft(k)),i!==r){for(n=[],s=Lt();s!==r;)n.push(s),s=Lt();n!==r?(s=function(){var t,e,i,n,s,a;if(t=st,e=At(),e!==r){for(i=[],n=st,(s=Tt())===r&&(s=null),s!==r?(a=At())!==r?n=s=[s,a]:(st=n,n=r):(st=n,n=r);n!==r;)i.push(n),n=st,(s=Tt())===r&&(s=null),s!==r?(a=At())!==r?n=s=[s,a]:(st=n,n=r):(st=n,n=r);i!==r?t=e=l(e,i):(st=t,t=r)}else st=t,t=r;return t}(),s!==r?e=i=v(i,s):(st=e,e=r)):(st=e,e=r)}else st=e,e=r;return e}())===r&&((e=function(){var e,i,n,s;if(e=st,R.test(t.charAt(st))?(i=t.charAt(st),st++):(i=r,0===ht&&ft(O)),i!==r){for(n=[],s=Lt();s!==r;)n.push(s),s=Lt();n!==r?(s=function(){var t,e,i,n,s,a;if(t=st,e=_t(),e!==r){for(i=[],n=st,(s=Tt())===r&&(s=null),s!==r?(a=_t())!==r?n=s=[s,a]:(st=n,n=r):(st=n,n=r);n!==r;)i.push(n),n=st,(s=Tt())===r&&(s=null),s!==r?(a=_t())!==r?n=s=[s,a]:(st=n,n=r):(st=n,n=r);i!==r?t=e=l(e,i):(st=t,t=r)}else st=t,t=r;return t}(),s!==r?e=i=v(i,s):(st=e,e=r)):(st=e,e=r)}else st=e,e=r;return e}())===r&&(e=function(){var e,i,n,s;if(e=st,L.test(t.charAt(st))?(i=t.charAt(st),st++):(i=r,0===ht&&ft(B)),i!==r){for(n=[],s=Lt();s!==r;)n.push(s),s=Lt();n!==r?(s=function(){var t,e,i,n,s,a;if(t=st,e=Et(),e!==r){for(i=[],n=st,(s=Tt())===r&&(s=null),s!==r?(a=Et())!==r?n=s=[s,a]:(st=n,n=r):(st=n,n=r);n!==r;)i.push(n),n=st,(s=Tt())===r&&(s=null),s!==r?(a=Et())!==r?n=s=[s,a]:(st=n,n=r):(st=n,n=r);i!==r?t=e=l(e,i):(st=t,t=r)}else st=t,t=r;return t}(),s!==r?e=i=v(i,s):(st=e,e=r)):(st=e,e=r)}else st=e,e=r;return e}())))))))),e}function bt(){var t,e,i,n,s,a;if(t=st,(e=_t())!==r){for(i=[],n=st,(s=Tt())===r&&(s=null),s!==r?(a=_t())!==r?n=s=[s,a]:(st=n,n=r):(st=n,n=r);n!==r;)i.push(n),n=st,(s=Tt())===r&&(s=null),s!==r?(a=_t())!==r?n=s=[s,a]:(st=n,n=r):(st=n,n=r);i!==r?t=e=l(e,i):(st=t,t=r)}else st=t,t=r;return t}function xt(){var t,e,i,n,s,a;if(t=st,(e=Mt())!==r){for(i=[],n=st,(s=Tt())===r&&(s=null),s!==r?(a=Mt())!==r?n=s=[s,a]:(st=n,n=r):(st=n,n=r);n!==r;)i.push(n),n=st,(s=Tt())===r&&(s=null),s!==r?(a=Mt())!==r?n=s=[s,a]:(st=n,n=r):(st=n,n=r);i!==r?t=e=l(e,i):(st=t,t=r)}else st=t,t=r;return t}function wt(){var t,e,i,n,s,a;return t=st,(e=_t())!==r?((i=Tt())===r&&(i=null),i!==r?(n=_t())!==r?((s=Tt())===r&&(s=null),s!==r?(a=_t())!==r?t=e=C(e,n,a):(st=t,t=r):(st=t,t=r)):(st=t,t=r):(st=t,t=r)):(st=t,t=r),t}function St(){var t,e,i,n;return t=st,(e=_t())!==r?((i=Tt())===r&&(i=null),i!==r?(n=_t())!==r?t=e=T(e,n):(st=t,t=r):(st=t,t=r)):(st=t,t=r),t}function At(){var t,e,i,n;return t=st,(e=_t())!==r?((i=Tt())===r&&(i=null),i!==r?(n=_t())!==r?t=e=I(e,n):(st=t,t=r):(st=t,t=r)):(st=t,t=r),t}function Et(){var t,e,i,n,s,a,o,l,h,c,u;return t=st,(e=Ct())!==r?((i=Tt())===r&&(i=null),i!==r?(n=Ct())!==r?((s=Tt())===r&&(s=null),s!==r?(a=Mt())!==r?Tt()!==r?(o=Pt())!==r?((l=Tt())===r&&(l=null),l!==r?(h=Pt())!==r?((c=Tt())===r&&(c=null),c!==r?(u=_t())!==r?t=e=z(e,n,a,o,h,u):(st=t,t=r):(st=t,t=r)):(st=t,t=r):(st=t,t=r)):(st=t,t=r):(st=t,t=r):(st=t,t=r):(st=t,t=r)):(st=t,t=r):(st=t,t=r)):(st=t,t=r),t}function _t(){var t,e,i,n;return t=st,(e=Mt())!==r?((i=Tt())===r&&(i=null),i!==r?(n=Mt())!==r?t=e=F(e,n):(st=t,t=r):(st=t,t=r)):(st=t,t=r),t}function Ct(){var t,e;return t=st,(e=kt())===r&&(e=Ot()),e!==r&&(e=N(e)),t=e}function Mt(){var t,e,i,n;return t=st,e=st,(i=Rt())===r&&(i=null),i!==r?(n=kt())!==r?e=i=[i,n]:(st=e,e=r):(st=e,e=r),e===r&&(e=st,(i=Rt())===r&&(i=null),i!==r?(n=Ot())!==r?e=i=[i,n]:(st=e,e=r):(st=e,e=r)),e!==r&&(e=U(e)),t=e}function Pt(){var e,i;return e=st,V.test(t.charAt(st))?(i=t.charAt(st),st++):(i=r,0===ht&&ft(j)),i!==r&&(i=G(i)),e=i}function Tt(){var t,e,i,n,s;if(t=st,e=[],(i=Lt())!==r)for(;i!==r;)e.push(i),i=Lt();else e=r;if(e!==r)if((i=Dt())===r&&(i=null),i!==r){for(n=[],s=Lt();s!==r;)n.push(s),s=Lt();n!==r?t=e=[e,i,n]:(st=t,t=r)}else st=t,t=r;else st=t,t=r;if(t===r){if(t=st,e=st,(i=Dt())!==r){for(n=[],s=Lt();s!==r;)n.push(s),s=Lt();n!==r?e=i=[i,n]:(st=e,e=r)}else st=e,e=r;e!==r&&(e=H()),t=e}return t}function Dt(){var e;return 44===t.charCodeAt(st)?(e=W,st++):(e=r,0===ht&&ft(q)),e}function kt(){var e,i,n,s;return e=st,i=st,n=function(){var e,i,n,s,a;return e=st,i=st,n=Ot(),n===r&&(n=null),n!==r?(46===t.charCodeAt(st)?(s=X,st++):(s=r,0===ht&&ft(Q)),s!==r&&(a=Ot())!==r?(n=[n,s,a],i=n):(st=i,i=r)):(st=i,i=r),i===r&&(i=st,n=Ot(),n!==r?(46===t.charCodeAt(st)?(s=X,st++):(s=r,0===ht&&ft(Q)),s!==r?(n=[n,s],i=n):(st=i,i=r)):(st=i,i=r)),i!==r&&(i=Y(i)),e=i,e}(),n!==r?((s=It())===r&&(s=null),s!==r?i=n=[n,s]:(st=i,i=r)):(st=i,i=r),i===r&&(i=st,(n=Ot())!==r?(s=It())!==r?i=n=[n,s]:(st=i,i=r):(st=i,i=r)),i!==r&&(i=Y(i)),e=i}function It(){var e,i,n,s,a;return e=st,i=st,K.test(t.charAt(st))?(n=t.charAt(st),st++):(n=r,0===ht&&ft(Z)),n!==r?((s=Rt())===r&&(s=null),s!==r?(a=Ot())!==r?i=n=[n,s,a]:(st=i,i=r):(st=i,i=r)):(st=i,i=r),i!==r&&(i=Y(i)),e=i}function Rt(){var e;return J.test(t.charAt(st))?(e=t.charAt(st),st++):(e=r,0===ht&&ft($)),e}function Ot(){var e,i,n;if(e=st,i=[],tt.test(t.charAt(st))?(n=t.charAt(st),st++):(n=r,0===ht&&ft(et)),n!==r)for(;n!==r;)i.push(n),tt.test(t.charAt(st))?(n=t.charAt(st),st++):(n=r,0===ht&&ft(et));else i=r;return i!==r&&(i=it(i)),e=i}function Lt(){var e,i;return e=st,nt.test(t.charAt(st))?(i=t.charAt(st),st++):(i=r,0===ht&&ft(rt)),i!==r&&(i=H()),e=i}var Bt={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var zt in Bt)Bt[zt.toUpperCase()]=Bt[zt];function Ft(t,e){e||(e=[{}]);for(var i=e.length;i--;){var n={code:t,command:Bt[t]};for(var r in t==t.toLowerCase()&&(n.relative=!0),e[i])n[r]=e[i][r];e[i]=n}return e}if((n=a())!==r&&st===t.length)return n;throw n!==r&&st<t.length&&ft({type:"end"}),mt(lt,ot<t.length?t.charAt(ot):null,ot<t.length?pt(ot,ot+1):pt(ot,ot))}}})),cp=ip(((t,e)=>{var i=hp().parse;i.parseSVG=i,i.makeAbsolute=function(t){var e,i={x:0,y:0},n={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return t.forEach((function(t){for(var r in"moveto"===t.command&&(e=t),t.x0=i.x,t.y0=i.y,n)r in t&&(t[r]+=t.relative?t[n[r]]:0);"x"in t||(t.x=i.x),"y"in t||(t.y=i.y),t.relative=!1,t.code=t.code.toUpperCase(),"closepath"==t.command&&(t.x=e.x,t.y=e.y),i=t})),t},e.exports=i})),up=ip(((t,e)=>{e.exports=function(t,e){for(var i=t.split("."),n=e.split("."),r=0;r<3;r++){var s=Number(i[r]),a=Number(n[r]);if(s>a)return 1;if(a>s)return-1;if(!isNaN(s)&&isNaN(a))return 1;if(isNaN(s)&&!isNaN(a))return-1}return 0}})),dp="149",pp=0,fp=1,mp=2,gp=3,vp=0,yp=1,bp=2,xp=100,wp=101,Sp=102,Ap=200,Ep=201,_p=202,Cp=203,Mp=204,Pp=205,Tp=206,Dp=207,kp=208,Ip=209,Rp=210,Op=301,Lp=302,Bp=306,zp=1e3,Fp=1001,Np=1002,Up=1003,Vp=1004,jp=1005,Gp=1006,Hp=1007,Wp=1008,qp=1009,Yp=1014,Xp=1015,Qp=1016,Kp=1020,Zp=1023,Jp=1026,$p=1027,tf=1028,ef=1030,nf=33776,rf=33777,sf=33778,af=33779,of=36492,lf=2202,hf=2300,cf=2301,uf=2302,df=2400,pf=2401,ff=2402,mf=2500,gf=3e3,vf=3001,yf=3200,bf="srgb",xf="srgb-linear",wf=7680,Sf=35044,Af="300 es",Ef=1035,_f=class{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});let i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;let i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;let i=this._listeners[t];if(void 0!==i){let t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;let e=this._listeners[t.type];if(void 0!==e){t.target=this;let i=e.slice(0);for(let e=0,n=i.length;e<n;e++)i[e].call(this,t);t.target=null}}},Cf=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Mf=1234567,Pf=Math.PI/180,Tf=180/Math.PI;function Df(){let t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(Cf[255&t]+Cf[t>>8&255]+Cf[t>>16&255]+Cf[t>>24&255]+"-"+Cf[255&e]+Cf[e>>8&255]+"-"+Cf[e>>16&15|64]+Cf[e>>24&255]+"-"+Cf[63&i|128]+Cf[i>>8&255]+"-"+Cf[i>>16&255]+Cf[i>>24&255]+Cf[255&n]+Cf[n>>8&255]+Cf[n>>16&255]+Cf[n>>24&255]).toLowerCase()}function kf(t,e,i){return Math.max(e,Math.min(i,t))}function If(t,e){return(t%e+e)%e}function Rf(t,e,i){return(1-i)*t+i*e}function Of(t){return 0===(t&t-1)&&0!==t}function Lf(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Bf(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function zf(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Ff(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}var Nf=Object.freeze({__proto__:null,DEG2RAD:Pf,RAD2DEG:Tf,ceilPowerOfTwo:Lf,clamp:kf,damp:function(t,e,i,n){return Rf(t,e,1-Math.exp(-i*n))},degToRad:function(t){return t*Pf},denormalize:zf,euclideanModulo:If,floorPowerOfTwo:Bf,generateUUID:Df,inverseLerp:function(t,e,i){return t!==e?(i-t)/(e-t):0},isPowerOfTwo:Of,lerp:Rf,mapLinear:function(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)},normalize:Ff,pingpong:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e-Math.abs(If(t,2*e)-e)},radToDeg:function(t){return t*Tf},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},seededRandom:function(t){void 0!==t&&(Mf=t);let e=Mf+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},setQuaternionFromProperEuler:function(t,e,i,n,r){let s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),h=s((e+n)/2),c=a((e+n)/2),u=s((e-n)/2),d=a((e-n)/2),p=s((n-e)/2),f=a((n-e)/2);switch(r){case"XYX":t.set(o*c,l*u,l*d,o*h);break;case"YZY":t.set(l*d,o*c,l*u,o*h);break;case"ZXZ":t.set(l*u,l*d,o*c,o*h);break;case"XZX":t.set(o*c,l*f,l*p,o*h);break;case"YXY":t.set(l*p,o*c,l*f,o*h);break;case"ZYZ":t.set(l*f,l*p,o*c,o*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)}}),Uf=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Uf.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){let e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){let i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*i-s*n+t.x,this.y=r*n+s*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Vf=class{constructor(){Vf.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(t,e,i,n,r,s,a,o,l){let h=this.elements;return h[0]=t,h[1]=n,h[2]=a,h[3]=e,h[4]=r,h[5]=o,h[6]=i,h[7]=s,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){let e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){let e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let i=t.elements,n=e.elements,r=this.elements,s=i[0],a=i[3],o=i[6],l=i[1],h=i[4],c=i[7],u=i[2],d=i[5],p=i[8],f=n[0],m=n[3],g=n[6],v=n[1],y=n[4],b=n[7],x=n[2],w=n[5],S=n[8];return r[0]=s*f+a*v+o*x,r[3]=s*m+a*y+o*w,r[6]=s*g+a*b+o*S,r[1]=l*f+h*v+c*x,r[4]=l*m+h*y+c*w,r[7]=l*g+h*b+c*S,r[2]=u*f+d*v+p*x,r[5]=u*m+d*y+p*w,r[8]=u*g+d*b+p*S,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){let t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],h=t[8];return e*s*h-e*a*l-i*r*h+i*a*o+n*r*l-n*s*o}invert(){let t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],h=t[8],c=h*s-a*l,u=a*o-h*r,d=l*r-s*o,p=e*c+i*u+n*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);let f=1/p;return t[0]=c*f,t[1]=(n*l-h*i)*f,t[2]=(a*i-n*s)*f,t[3]=u*f,t[4]=(h*e-n*o)*f,t[5]=(n*r-a*e)*f,t[6]=d*f,t[7]=(i*o-l*e)*f,t[8]=(s*e-i*r)*f,this}transpose(){let t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){let e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,n,r,s,a){let o=Math.cos(r),l=Math.sin(r);return this.set(i*o,i*l,-i*(o*s+l*a)+s+t,-n*l,n*o,-n*(-l*s+o*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(jf.makeScale(t,e)),this}rotate(t){return this.premultiply(jf.makeRotation(-t)),this}translate(t,e){return this.premultiply(jf.makeTranslation(t,e)),this}makeTranslation(t,e){return this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){let e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){let e=this.elements,i=t.elements;for(let n=0;n<9;n++)if(e[n]!==i[n])return!1;return!0}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}},jf=new Vf;function Gf(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}var Hf={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Wf(t,e){return new Hf[t](e)}function qf(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function Yf(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Xf(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}var Qf={[bf]:{[xf]:Yf},[xf]:{[bf]:Xf}},Kf={legacyMode:!0,get workingColorSpace(){return xf},set workingColorSpace(t){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(t,e,i){if(this.legacyMode||e===i||!e||!i)return t;if(Qf[e]&&void 0!==Qf[e][i]){let n=Qf[e][i];return t.r=n(t.r),t.g=n(t.g),t.b=n(t.b),t}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}},Zf={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Jf={r:0,g:0,b:0},$f={h:0,s:0,l:0},tm={h:0,s:0,l:0};function em(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}function im(t,e){return e.r=t.r,e.g=t.g,e.b=t.b,e}var nm=class{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bf;return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Kf.toWorkingColorSpace(this,e),this}setRGB(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Kf.workingColorSpace;return this.r=t,this.g=e,this.b=i,Kf.toWorkingColorSpace(this,n),this}setHSL(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Kf.workingColorSpace;if(t=If(t,1),e=kf(e,0,1),i=kf(i,0,1),0===e)this.r=this.g=this.b=i;else{let n=i<=.5?i*(1+e):i+e-i*e,r=2*i-n;this.r=em(r,n,t+1/3),this.g=em(r,n,t),this.b=em(r,n,t-1/3)}return Kf.toWorkingColorSpace(this,n),this}setStyle(t){let e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bf;function n(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}if(e=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t,r=e[1],s=e[2];switch(r){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,Kf.toWorkingColorSpace(this,i),n(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,Kf.toWorkingColorSpace(this,i),n(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){let e=parseFloat(t[1])/360,r=parseFloat(t[2])/100,s=parseFloat(t[3])/100;return n(t[4]),this.setHSL(e,r,s,i)}}}else if(e=/^\#([A-Fa-f\d]+)$/.exec(t)){let t=e[1],n=t.length;if(3===n)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,Kf.toWorkingColorSpace(this,i),this;if(6===n)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,Kf.toWorkingColorSpace(this,i),this}return t&&t.length>0?this.setColorName(t,i):this}setColorName(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bf,i=Zf[t.toLowerCase()];return void 0!==i?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Yf(t.r),this.g=Yf(t.g),this.b=Yf(t.b),this}copyLinearToSRGB(t){return this.r=Xf(t.r),this.g=Xf(t.g),this.b=Xf(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bf;return Kf.fromWorkingColorSpace(im(this,Jf),t),kf(255*Jf.r,0,255)<<16^kf(255*Jf.g,0,255)<<8^kf(255*Jf.b,0,255)}getHexString(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bf;return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Kf.workingColorSpace;Kf.fromWorkingColorSpace(im(this,Jf),e);let i,n,r=Jf.r,s=Jf.g,a=Jf.b,o=Math.max(r,s,a),l=Math.min(r,s,a),h=(l+o)/2;if(l===o)i=0,n=0;else{let t=o-l;switch(n=h<=.5?t/(o+l):t/(2-o-l),o){case r:i=(s-a)/t+(s<a?6:0);break;case s:i=(a-r)/t+2;break;case a:i=(r-s)/t+4}i/=6}return t.h=i,t.s=n,t.l=h,t}getRGB(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Kf.workingColorSpace;return Kf.fromWorkingColorSpace(im(this,Jf),e),t.r=Jf.r,t.g=Jf.g,t.b=Jf.b,t}getStyle(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bf;return Kf.fromWorkingColorSpace(im(this,Jf),t),t!==bf?`color(${t} ${Jf.r} ${Jf.g} ${Jf.b})`:`rgb(${255*Jf.r|0},${255*Jf.g|0},${255*Jf.b|0})`}offsetHSL(t,e,i){return this.getHSL($f),$f.h+=t,$f.s+=e,$f.l+=i,this.setHSL($f.h,$f.s,$f.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL($f),t.getHSL(tm);let i=Rf($f.h,tm.h,e),n=Rf($f.s,tm.s,e),r=Rf($f.l,tm.l,e);return this.setHSL(i,n,r),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};nm.NAMES=Zf;var rm,sm=class{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===rm&&(rm=qf("canvas")),rm.width=t.width,rm.height=t.height;let i=rm.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=rm}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){let e=qf("canvas");e.width=t.width,e.height=t.height;let i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);let n=i.getImageData(0,0,t.width,t.height),r=n.data;for(let t=0;t<r.length;t++)r[t]=255*Yf(r[t]/255);return i.putImageData(n,0,0),e}if(t.data){let e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*Yf(e[t]/255)):e[t]=Yf(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}},am=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isSource=!0,this.uuid=Df(),this.data=t,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){let e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];let i={uuid:this.uuid,url:""},n=this.data;if(null!==n){let t;if(Array.isArray(n)){t=[];for(let e=0,i=n.length;e<i;e++)n[e].isDataTexture?t.push(om(n[e].image)):t.push(om(n[e]))}else t=om(n);i.url=t}return e||(t.images[this.uuid]=i),i}};function om(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?sm.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var lm=0,hm=class extends _f{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hm.DEFAULT_IMAGE,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:hm.DEFAULT_MAPPING,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Fp,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Fp,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Gp,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Wp,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Zp,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:qp,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:hm.DEFAULT_ANISOTROPY,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:gf;super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:lm++}),this.uuid=Df(),this.name="",this.source=new am(t),this.mipmaps=[],this.mapping=e,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new Uf(0,0),this.repeat=new Uf(1,1),this.center=new Uf(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Vf,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){let e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];let i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case zp:t.x=t.x-Math.floor(t.x);break;case Fp:t.x=t.x<0?0:1;break;case Np:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case zp:t.y=t.y-Math.floor(t.y);break;case Fp:t.y=t.y<0?0:1;break;case Np:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}};hm.DEFAULT_IMAGE=null,hm.DEFAULT_MAPPING=300,hm.DEFAULT_ANISOTROPY=1;var cm=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;cm.prototype.isVector4=!0,this.x=t,this.y=e,this.z=i,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){let e=this.x,i=this.y,n=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n+s[12]*r,this.y=s[1]*e+s[5]*i+s[9]*n+s[13]*r,this.z=s[2]*e+s[6]*i+s[10]*n+s[14]*r,this.w=s[3]*e+s[7]*i+s[11]*n+s[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);let e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,n,r,s=t.elements,a=s[0],o=s[4],l=s[8],h=s[1],c=s[5],u=s[9],d=s[2],p=s[6],f=s[10];if(Math.abs(o-h)<.01&&Math.abs(l-d)<.01&&Math.abs(u-p)<.01){if(Math.abs(o+h)<.1&&Math.abs(l+d)<.1&&Math.abs(u+p)<.1&&Math.abs(a+c+f-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;let t=(a+1)/2,s=(c+1)/2,m=(f+1)/2,g=(o+h)/4,v=(l+d)/4,y=(u+p)/4;return t>s&&t>m?t<.01?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(t),n=g/i,r=v/i):s>m?s<.01?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(s),i=g/n,r=y/n):m<.01?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(m),i=v/r,n=y/r),this.set(i,n,r,e),this}let m=Math.sqrt((p-u)*(p-u)+(l-d)*(l-d)+(h-o)*(h-o));return Math.abs(m)<.001&&(m=1),this.x=(p-u)/m,this.y=(l-d)/m,this.z=(h-o)/m,this.w=Math.acos((a+c+f-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},um=class extends _f{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.isWebGLRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new cm(0,0,t,e),this.scissorTest=!1,this.viewport=new cm(0,0,t,e);let n={width:t,height:e,depth:1};this.texture=new hm(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:Gp,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;(this.width!==t||this.height!==e||this.depth!==i)&&(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;let e=Object.assign({},t.texture.image);return this.texture.source=new am(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},dm=class extends hm{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:i,depth:n},this.magFilter=Up,this.minFilter=Up,this.wrapR=Fp,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},pm=class extends um{constructor(){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}),this.isWebGLMultipleRenderTargets=!0;let e=this.texture;this.texture=[];for(let i=0;i<t;i++)this.texture[i]=e.clone(),this.texture[i].isRenderTargetTexture=!0}setSize(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==t||this.height!==e||this.depth!==i){this.width=t,this.height=e,this.depth=i;for(let n=0,r=this.texture.length;n<r;n++)this.texture[n].image.width=t,this.texture[n].image.height=e,this.texture[n].image.depth=i;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.texture.length=0;for(let e=0,i=t.texture.length;e<i;e++)this.texture[e]=t.texture[e].clone(),this.texture[e].isRenderTargetTexture=!0;return this}},fm=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=n}static slerpFlat(t,e,i,n,r,s,a){let o=i[n+0],l=i[n+1],h=i[n+2],c=i[n+3],u=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===a)return t[e+0]=o,t[e+1]=l,t[e+2]=h,void(t[e+3]=c);if(1===a)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(c!==f||o!==u||l!==d||h!==p){let t=1-a,e=o*u+l*d+h*p+c*f,i=e>=0?1:-1,n=1-e*e;if(n>Number.EPSILON){let r=Math.sqrt(n),s=Math.atan2(r,e*i);t=Math.sin(t*s)/r,a=Math.sin(a*s)/r}let r=a*i;if(o=o*t+u*r,l=l*t+d*r,h=h*t+p*r,c=c*t+f*r,t===1-a){let t=1/Math.sqrt(o*o+l*l+h*h+c*c);o*=t,l*=t,h*=t,c*=t}}t[e]=o,t[e+1]=l,t[e+2]=h,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,n,r,s){let a=i[n],o=i[n+1],l=i[n+2],h=i[n+3],c=r[s],u=r[s+1],d=r[s+2],p=r[s+3];return t[e]=a*p+h*c+o*d-l*u,t[e+1]=o*p+h*u+l*c-a*d,t[e+2]=l*p+h*d+a*u-o*c,t[e+3]=h*p-a*c-o*u-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){let i=t._x,n=t._y,r=t._z,s=t._order,a=Math.cos,o=Math.sin,l=a(i/2),h=a(n/2),c=a(r/2),u=o(i/2),d=o(n/2),p=o(r/2);switch(s){case"XYZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"YXZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"ZXY":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"ZYX":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"YZX":this._x=u*h*c+l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c-u*d*p;break;case"XZY":this._x=u*h*c-l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){let i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){let e=t.elements,i=e[0],n=e[4],r=e[8],s=e[1],a=e[5],o=e[9],l=e[2],h=e[6],c=e[10],u=i+a+c;if(u>0){let t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(h-o)*t,this._y=(r-l)*t,this._z=(s-n)*t}else if(i>a&&i>c){let t=2*Math.sqrt(1+i-a-c);this._w=(h-o)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(r+l)/t}else if(a>c){let t=2*Math.sqrt(1+a-i-c);this._w=(r-l)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(o+h)/t}else{let t=2*Math.sqrt(1+c-i-a);this._w=(s-n)/t,this._x=(r+l)/t,this._y=(o+h)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(kf(this.dot(t),-1,1)))}rotateTowards(t,e){let i=this.angleTo(t);if(0===i)return this;let n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){let i=t._x,n=t._y,r=t._z,s=t._w,a=e._x,o=e._y,l=e._z,h=e._w;return this._x=i*h+s*a+n*l-r*o,this._y=n*h+s*o+r*a-i*l,this._z=r*h+s*l+i*o-n*a,this._w=s*h-i*a-n*o-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);let i=this._x,n=this._y,r=this._z,s=this._w,a=s*t._w+i*t._x+n*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;let o=1-a*a;if(o<=Number.EPSILON){let t=1-e;return this._w=t*s+e*this._w,this._x=t*i+e*this._x,this._y=t*n+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(o),h=Math.atan2(l,a),c=Math.sin((1-e)*h)/l,u=Math.sin(e*h)/l;return this._w=s*c+this._w*u,this._x=i*c+this._x*u,this._y=n*c+this._y*u,this._z=r*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){let t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),n=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(n),i*Math.sin(r),i*Math.cos(r),e*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},mm=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;mm.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(vm.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(vm.setFromAxisAngle(t,e))}applyMatrix3(t){let e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){let e=this.x,i=this.y,n=this.z,r=t.elements,s=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*s,this}applyQuaternion(t){let e=this.x,i=this.y,n=this.z,r=t.x,s=t.y,a=t.z,o=t.w,l=o*e+s*n-a*i,h=o*i+a*e-r*n,c=o*n+r*i-s*e,u=-r*e-s*i-a*n;return this.x=l*o+u*-r+h*-a-c*-s,this.y=h*o+u*-s+c*-r-l*-a,this.z=c*o+u*-a+l*-s-h*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){let e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){let i=t.x,n=t.y,r=t.z,s=e.x,a=e.y,o=e.z;return this.x=n*o-r*a,this.y=r*s-i*o,this.z=i*a-n*s,this}projectOnVector(t){let e=t.lengthSq();if(0===e)return this.set(0,0,0);let i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return gm.copy(this).projectOnVector(t),this.sub(gm)}reflect(t){return this.sub(gm.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){let e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;let i=this.dot(t)/e;return Math.acos(kf(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){let n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){let e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){let e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},gm=new mm,vm=new fm,ym=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new mm(1/0,1/0,1/0),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mm(-1/0,-1/0,-1/0);this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=t.length;o<l;o+=3){let l=t[o],h=t[o+1],c=t[o+2];l<e&&(e=l),h<i&&(i=h),c<n&&(n=c),l>r&&(r=l),h>s&&(s=h),c>a&&(a=c)}return this.min.set(e,i,n),this.max.set(r,s,a),this}setFromBufferAttribute(t){let e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=t.count;o<l;o++){let l=t.getX(o),h=t.getY(o),c=t.getZ(o);l<e&&(e=l),h<i&&(i=h),c<n&&(n=c),l>r&&(r=l),h>s&&(s=h),c>a&&(a=c)}return this.min.set(e,i,n),this.max.set(r,s,a),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){let i=xm.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.updateWorldMatrix(!1,!1);let i=t.geometry;if(void 0!==i)if(e&&null!=i.attributes&&void 0!==i.attributes.position){let e=i.attributes.position;for(let i=0,n=e.count;i<n;i++)xm.fromBufferAttribute(e,i).applyMatrix4(t.matrixWorld),this.expandByPoint(xm)}else null===i.boundingBox&&i.computeBoundingBox(),wm.copy(i.boundingBox),wm.applyMatrix4(t.matrixWorld),this.union(wm);let n=t.children;for(let r=0,s=n.length;r<s;r++)this.expandByObject(n[r],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,xm),xm.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Pm),Tm.subVectors(this.max,Pm),Sm.subVectors(t.a,Pm),Am.subVectors(t.b,Pm),Em.subVectors(t.c,Pm),_m.subVectors(Am,Sm),Cm.subVectors(Em,Am),Mm.subVectors(Sm,Em);let e=[0,-_m.z,_m.y,0,-Cm.z,Cm.y,0,-Mm.z,Mm.y,_m.z,0,-_m.x,Cm.z,0,-Cm.x,Mm.z,0,-Mm.x,-_m.y,_m.x,0,-Cm.y,Cm.x,0,-Mm.y,Mm.x,0];return!(!Im(e,Sm,Am,Em,Tm)||(e=[1,0,0,0,1,0,0,0,1],!Im(e,Sm,Am,Em,Tm)))&&(Dm.crossVectors(_m,Cm),e=[Dm.x,Dm.y,Dm.z],Im(e,Sm,Am,Em,Tm))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return xm.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(xm).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(bm[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),bm[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),bm[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),bm[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),bm[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),bm[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),bm[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),bm[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(bm)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},bm=[new mm,new mm,new mm,new mm,new mm,new mm,new mm,new mm],xm=new mm,wm=new ym,Sm=new mm,Am=new mm,Em=new mm,_m=new mm,Cm=new mm,Mm=new mm,Pm=new mm,Tm=new mm,Dm=new mm,km=new mm;function Im(t,e,i,n,r){for(let s=0,a=t.length-3;s<=a;s+=3){km.fromArray(t,s);let a=r.x*Math.abs(km.x)+r.y*Math.abs(km.y)+r.z*Math.abs(km.z),o=e.dot(km),l=i.dot(km),h=n.dot(km);if(Math.max(-Math.max(o,l,h),Math.min(o,l,h))>a)return!1}return!0}var Rm=new ym,Om=new mm,Lm=new mm,Bm=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new mm,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){let i=this.center;void 0!==e?i.copy(e):Rm.setFromPoints(t).getCenter(i);let n=0;for(let r=0,s=t.length;r<s;r++)n=Math.max(n,i.distanceToSquared(t[r]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){let e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){let i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Om.subVectors(t,this.center);let e=Om.lengthSq();if(e>this.radius*this.radius){let t=Math.sqrt(e),i=.5*(t-this.radius);this.center.addScaledVector(Om,i/t),this.radius+=i}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(Lm.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Om.copy(t.center).add(Lm)),this.expandByPoint(Om.copy(t.center).sub(Lm))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}},zm=new mm,Fm=new mm,Nm=new mm,Um=new mm,Vm=new mm,jm=new mm,Gm=new mm,Hm=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new mm,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mm(0,0,-1);this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,zm)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);let i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){let e=zm.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(zm.copy(this.direction).multiplyScalar(e).add(this.origin),zm.distanceToSquared(t))}distanceSqToSegment(t,e,i,n){Fm.copy(t).add(e).multiplyScalar(.5),Nm.copy(e).sub(t).normalize(),Um.copy(this.origin).sub(Fm);let r,s,a,o,l=.5*t.distanceTo(e),h=-this.direction.dot(Nm),c=Um.dot(this.direction),u=-Um.dot(Nm),d=Um.lengthSq(),p=Math.abs(1-h*h);if(p>0)if(r=h*u-c,s=h*c-u,o=l*p,r>=0)if(s>=-o)if(s<=o){let t=1/p;r*=t,s*=t,a=r*(r+h*s+2*c)+s*(h*r+s+2*u)+d}else s=l,r=Math.max(0,-(h*s+c)),a=-r*r+s*(s+2*u)+d;else s=-l,r=Math.max(0,-(h*s+c)),a=-r*r+s*(s+2*u)+d;else s<=-o?(r=Math.max(0,-(-h*l+c)),s=r>0?-l:Math.min(Math.max(-l,-u),l),a=-r*r+s*(s+2*u)+d):s<=o?(r=0,s=Math.min(Math.max(-l,-u),l),a=s*(s+2*u)+d):(r=Math.max(0,-(h*l+c)),s=r>0?l:Math.min(Math.max(-l,-u),l),a=-r*r+s*(s+2*u)+d);else s=h>0?-l:l,r=Math.max(0,-(h*s+c)),a=-r*r+s*(s+2*u)+d;return i&&i.copy(this.direction).multiplyScalar(r).add(this.origin),n&&n.copy(Nm).multiplyScalar(s).add(Fm),a}intersectSphere(t,e){zm.subVectors(t.center,this.origin);let i=zm.dot(this.direction),n=zm.dot(zm)-i*i,r=t.radius*t.radius;if(n>r)return null;let s=Math.sqrt(r-n),a=i-s,o=i+s;return a<0&&o<0?null:a<0?this.at(o,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){let e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;let i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){let i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectsPlane(t){let e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,n,r,s,a,o,l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,u=this.origin;return l>=0?(i=(t.min.x-u.x)*l,n=(t.max.x-u.x)*l):(i=(t.max.x-u.x)*l,n=(t.min.x-u.x)*l),h>=0?(r=(t.min.y-u.y)*h,s=(t.max.y-u.y)*h):(r=(t.max.y-u.y)*h,s=(t.min.y-u.y)*h),i>s||r>n||((r>i||isNaN(i))&&(i=r),(s<n||isNaN(n))&&(n=s),c>=0?(a=(t.min.z-u.z)*c,o=(t.max.z-u.z)*c):(a=(t.max.z-u.z)*c,o=(t.min.z-u.z)*c),i>o||a>n)||((a>i||i!==i)&&(i=a),(o<n||n!==n)&&(n=o),n<0)?null:this.at(i>=0?i:n,e)}intersectsBox(t){return null!==this.intersectBox(t,zm)}intersectTriangle(t,e,i,n,r){Vm.subVectors(e,t),jm.subVectors(i,t),Gm.crossVectors(Vm,jm);let s,a=this.direction.dot(Gm);if(a>0){if(n)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}Um.subVectors(this.origin,t);let o=s*this.direction.dot(jm.crossVectors(Um,jm));if(o<0)return null;let l=s*this.direction.dot(Vm.cross(Um));if(l<0||o+l>a)return null;let h=-s*Um.dot(Gm);return h<0?null:this.at(h/a,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}},Wm=class{constructor(){Wm.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,e,i,n,r,s,a,o,l,h,c,u,d,p,f,m){let g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=n,g[1]=r,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=h,g[10]=c,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Wm).fromArray(this.elements)}copy(t){let e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){let e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){let e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){let e=this.elements,i=t.elements,n=1/qm.setFromMatrixColumn(t,0).length(),r=1/qm.setFromMatrixColumn(t,1).length(),s=1/qm.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){let e=this.elements,i=t.x,n=t.y,r=t.z,s=Math.cos(i),a=Math.sin(i),o=Math.cos(n),l=Math.sin(n),h=Math.cos(r),c=Math.sin(r);if("XYZ"===t.order){let t=s*h,i=s*c,n=a*h,r=a*c;e[0]=o*h,e[4]=-o*c,e[8]=l,e[1]=i+n*l,e[5]=t-r*l,e[9]=-a*o,e[2]=r-t*l,e[6]=n+i*l,e[10]=s*o}else if("YXZ"===t.order){let t=o*h,i=o*c,n=l*h,r=l*c;e[0]=t+r*a,e[4]=n*a-i,e[8]=s*l,e[1]=s*c,e[5]=s*h,e[9]=-a,e[2]=i*a-n,e[6]=r+t*a,e[10]=s*o}else if("ZXY"===t.order){let t=o*h,i=o*c,n=l*h,r=l*c;e[0]=t-r*a,e[4]=-s*c,e[8]=n+i*a,e[1]=i+n*a,e[5]=s*h,e[9]=r-t*a,e[2]=-s*l,e[6]=a,e[10]=s*o}else if("ZYX"===t.order){let t=s*h,i=s*c,n=a*h,r=a*c;e[0]=o*h,e[4]=n*l-i,e[8]=t*l+r,e[1]=o*c,e[5]=r*l+t,e[9]=i*l-n,e[2]=-l,e[6]=a*o,e[10]=s*o}else if("YZX"===t.order){let t=s*o,i=s*l,n=a*o,r=a*l;e[0]=o*h,e[4]=r-t*c,e[8]=n*c+i,e[1]=c,e[5]=s*h,e[9]=-a*h,e[2]=-l*h,e[6]=i*c+n,e[10]=t-r*c}else if("XZY"===t.order){let t=s*o,i=s*l,n=a*o,r=a*l;e[0]=o*h,e[4]=-c,e[8]=l*h,e[1]=t*c+r,e[5]=s*h,e[9]=i*c-n,e[2]=n*c-i,e[6]=a*h,e[10]=r*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Xm,t,Qm)}lookAt(t,e,i){let n=this.elements;return Jm.subVectors(t,e),0===Jm.lengthSq()&&(Jm.z=1),Jm.normalize(),Km.crossVectors(i,Jm),0===Km.lengthSq()&&(1===Math.abs(i.z)?Jm.x+=1e-4:Jm.z+=1e-4,Jm.normalize(),Km.crossVectors(i,Jm)),Km.normalize(),Zm.crossVectors(Jm,Km),n[0]=Km.x,n[4]=Zm.x,n[8]=Jm.x,n[1]=Km.y,n[5]=Zm.y,n[9]=Jm.y,n[2]=Km.z,n[6]=Zm.z,n[10]=Jm.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let i=t.elements,n=e.elements,r=this.elements,s=i[0],a=i[4],o=i[8],l=i[12],h=i[1],c=i[5],u=i[9],d=i[13],p=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],b=i[11],x=i[15],w=n[0],S=n[4],A=n[8],E=n[12],_=n[1],C=n[5],M=n[9],P=n[13],T=n[2],D=n[6],k=n[10],I=n[14],R=n[3],O=n[7],L=n[11],B=n[15];return r[0]=s*w+a*_+o*T+l*R,r[4]=s*S+a*C+o*D+l*O,r[8]=s*A+a*M+o*k+l*L,r[12]=s*E+a*P+o*I+l*B,r[1]=h*w+c*_+u*T+d*R,r[5]=h*S+c*C+u*D+d*O,r[9]=h*A+c*M+u*k+d*L,r[13]=h*E+c*P+u*I+d*B,r[2]=p*w+f*_+m*T+g*R,r[6]=p*S+f*C+m*D+g*O,r[10]=p*A+f*M+m*k+g*L,r[14]=p*E+f*P+m*I+g*B,r[3]=v*w+y*_+b*T+x*R,r[7]=v*S+y*C+b*D+x*O,r[11]=v*A+y*M+b*k+x*L,r[15]=v*E+y*P+b*I+x*B,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){let t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],s=t[1],a=t[5],o=t[9],l=t[13],h=t[2],c=t[6],u=t[10],d=t[14];return t[3]*(+r*o*c-n*l*c-r*a*u+i*l*u+n*a*d-i*o*d)+t[7]*(+e*o*d-e*l*u+r*s*u-n*s*d+n*l*h-r*o*h)+t[11]*(+e*l*c-e*a*d-r*s*c+i*s*d+r*a*h-i*l*h)+t[15]*(-n*a*h-e*o*c+e*a*u+n*s*c-i*s*u+i*o*h)}transpose(){let t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(t,e,i){let n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){let t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],h=t[8],c=t[9],u=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],v=c*m*l-f*u*l+f*o*d-a*m*d-c*o*g+a*u*g,y=p*u*l-h*m*l-p*o*d+s*m*d+h*o*g-s*u*g,b=h*f*l-p*c*l+p*a*d-s*f*d-h*a*g+s*c*g,x=p*c*o-h*f*o-p*a*u+s*f*u+h*a*m-s*c*m,w=e*v+i*y+n*b+r*x;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let S=1/w;return t[0]=v*S,t[1]=(f*u*r-c*m*r-f*n*d+i*m*d+c*n*g-i*u*g)*S,t[2]=(a*m*r-f*o*r+f*n*l-i*m*l-a*n*g+i*o*g)*S,t[3]=(c*o*r-a*u*r-c*n*l+i*u*l+a*n*d-i*o*d)*S,t[4]=y*S,t[5]=(h*m*r-p*u*r+p*n*d-e*m*d-h*n*g+e*u*g)*S,t[6]=(p*o*r-s*m*r-p*n*l+e*m*l+s*n*g-e*o*g)*S,t[7]=(s*u*r-h*o*r+h*n*l-e*u*l-s*n*d+e*o*d)*S,t[8]=b*S,t[9]=(p*c*r-h*f*r-p*i*d+e*f*d+h*i*g-e*c*g)*S,t[10]=(s*f*r-p*a*r+p*i*l-e*f*l-s*i*g+e*a*g)*S,t[11]=(h*a*r-s*c*r-h*i*l+e*c*l+s*i*d-e*a*d)*S,t[12]=x*S,t[13]=(h*f*n-p*c*n+p*i*u-e*f*u-h*i*m+e*c*m)*S,t[14]=(p*a*n-s*f*n-p*i*o+e*f*o+s*i*m-e*a*m)*S,t[15]=(s*c*n-h*a*n+h*i*o-e*c*o-s*i*u+e*a*u)*S,this}scale(t){let e=this.elements,i=t.x,n=t.y,r=t.z;return e[0]*=i,e[4]*=n,e[8]*=r,e[1]*=i,e[5]*=n,e[9]*=r,e[2]*=i,e[6]*=n,e[10]*=r,e[3]*=i,e[7]*=n,e[11]*=r,this}getMaxScaleOnAxis(){let t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){let e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){let e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){let e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){let i=Math.cos(e),n=Math.sin(e),r=1-i,s=t.x,a=t.y,o=t.z,l=r*s,h=r*a;return this.set(l*s+i,l*a-n*o,l*o+n*a,0,l*a+n*o,h*a+i,h*o-n*s,0,l*o-n*a,h*o+n*s,r*o*o+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,r,s){return this.set(1,i,r,0,t,1,s,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){let n=this.elements,r=e._x,s=e._y,a=e._z,o=e._w,l=r+r,h=s+s,c=a+a,u=r*l,d=r*h,p=r*c,f=s*h,m=s*c,g=a*c,v=o*l,y=o*h,b=o*c,x=i.x,w=i.y,S=i.z;return n[0]=(1-(f+g))*x,n[1]=(d+b)*x,n[2]=(p-y)*x,n[3]=0,n[4]=(d-b)*w,n[5]=(1-(u+g))*w,n[6]=(m+v)*w,n[7]=0,n[8]=(p+y)*S,n[9]=(m-v)*S,n[10]=(1-(u+f))*S,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){let n=this.elements,r=qm.set(n[0],n[1],n[2]).length(),s=qm.set(n[4],n[5],n[6]).length(),a=qm.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),t.x=n[12],t.y=n[13],t.z=n[14],Ym.copy(this);let o=1/r,l=1/s,h=1/a;return Ym.elements[0]*=o,Ym.elements[1]*=o,Ym.elements[2]*=o,Ym.elements[4]*=l,Ym.elements[5]*=l,Ym.elements[6]*=l,Ym.elements[8]*=h,Ym.elements[9]*=h,Ym.elements[10]*=h,e.setFromRotationMatrix(Ym),i.x=r,i.y=s,i.z=a,this}makePerspective(t,e,i,n,r,s){let a=this.elements,o=2*r/(e-t),l=2*r/(i-n),h=(e+t)/(e-t),c=(i+n)/(i-n),u=-(s+r)/(s-r),d=-2*s*r/(s-r);return a[0]=o,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=l,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,i,n,r,s){let a=this.elements,o=1/(e-t),l=1/(i-n),h=1/(s-r),c=(e+t)*o,u=(i+n)*l,d=(s+r)*h;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2*h,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){let e=this.elements,i=t.elements;for(let n=0;n<16;n++)if(e[n]!==i[n])return!1;return!0}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}},qm=new mm,Ym=new Wm,Xm=new mm(0,0,0),Qm=new mm(1,1,1),Km=new mm,Zm=new mm,Jm=new mm,$m=new Wm,tg=new fm,eg=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:eg.DEFAULT_ORDER;this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=t,this._y=e,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=t.elements,r=n[0],s=n[4],a=n[8],o=n[1],l=n[5],h=n[9],c=n[2],u=n[6],d=n[10];switch(e){case"XYZ":this._y=Math.asin(kf(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-kf(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-c,r),this._z=0);break;case"ZXY":this._x=Math.asin(kf(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-kf(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(kf(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-kf(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-h,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return $m.makeRotationFromQuaternion(t),this.setFromRotationMatrix($m,e,i)}setFromVector3(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(t.x,t.y,t.z,e)}reorder(t){return tg.setFromEuler(this),this.setFromQuaternion(tg,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};eg.DEFAULT_ORDER="XYZ";var ig=class{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return 0!==(this.mask&t.mask)}isEnabled(t){return 0!==(this.mask&1<<t)}},ng=0,rg=new mm,sg=new fm,ag=new Wm,og=new mm,lg=new mm,hg=new mm,cg=new fm,ug=new mm(1,0,0),dg=new mm(0,1,0),pg=new mm(0,0,1),fg={type:"added"},mg={type:"removed"},gg=class extends _f{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:ng++}),this.uuid=Df(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=gg.DEFAULT_UP.clone();let t=new mm,e=new eg,i=new fm,n=new mm(1,1,1);e._onChange((function(){i.setFromEuler(e,!1)})),i._onChange((function(){e.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Wm},normalMatrix:{value:new Vf}}),this.matrix=new Wm,this.matrixWorld=new Wm,this.matrixAutoUpdate=gg.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=gg.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new ig,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return sg.setFromAxisAngle(t,e),this.quaternion.multiply(sg),this}rotateOnWorldAxis(t,e){return sg.setFromAxisAngle(t,e),this.quaternion.premultiply(sg),this}rotateX(t){return this.rotateOnAxis(ug,t)}rotateY(t){return this.rotateOnAxis(dg,t)}rotateZ(t){return this.rotateOnAxis(pg,t)}translateOnAxis(t,e){return rg.copy(t).applyQuaternion(this.quaternion),this.position.add(rg.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(ug,t)}translateY(t){return this.translateOnAxis(dg,t)}translateZ(t){return this.translateOnAxis(pg,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(ag.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?og.copy(t):og.set(t,e,i);let n=this.parent;this.updateWorldMatrix(!0,!1),lg.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ag.lookAt(lg,og,this.up):ag.lookAt(og,lg,this.up),this.quaternion.setFromRotationMatrix(ag),n&&(ag.extractRotation(n.matrixWorld),sg.setFromRotationMatrix(ag),this.quaternion.premultiply(sg.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(fg)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}let e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(mg)),this}removeFromParent(){let t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){let e=this.children[t];e.parent=null,e.dispatchEvent(mg)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),ag.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),ag.multiply(t.parent.matrixWorld)),t.applyMatrix4(ag),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,n=this.children.length;i<n;i++){let n=this.children[i].getObjectByProperty(t,e);if(void 0!==n)return n}}getObjectsByProperty(t,e){let i=[];this[t]===e&&i.push(this);for(let n=0,r=this.children.length;n<r;n++){let r=this.children[n].getObjectsByProperty(t,e);r.length>0&&(i=i.concat(r))}return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(lg,t,hg),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(lg,cg,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);let e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);let e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);let e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}traverseAncestors(t){let e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);let e=this.children;for(let i=0,n=e.length;i<n;i++){let n=e[i];(!0===n.matrixWorldAutoUpdate||!0===t)&&n.updateMatrixWorld(t)}}updateWorldMatrix(t,e){let i=this.parent;if(!0===t&&null!==i&&!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){let t=this.children;for(let e=0,i=t.length;e<i;e++){let i=t[e];!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!1,!0)}}}toJSON(t){let e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let n={};function r(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(t.geometries,this.geometry);let e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){let i=e.shapes;if(Array.isArray(i))for(let e=0,n=i.length;e<n;e++){let n=i[e];r(t.shapes,n)}else r(t.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){let e=[];for(let i=0,n=this.material.length;i<n;i++)e.push(r(t.materials,this.material[i]));n.material=e}else n.material=r(t.materials,this.material);if(this.children.length>0){n.children=[];for(let e=0;e<this.children.length;e++)n.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let e=0;e<this.animations.length;e++){let i=this.animations[e];n.animations.push(r(t.animations,i))}}if(e){let e=s(t.geometries),n=s(t.materials),r=s(t.textures),a=s(t.images),o=s(t.shapes),l=s(t.skeletons),h=s(t.animations),c=s(t.nodes);e.length>0&&(i.geometries=e),n.length>0&&(i.materials=n),r.length>0&&(i.textures=r),a.length>0&&(i.images=a),o.length>0&&(i.shapes=o),l.length>0&&(i.skeletons=l),h.length>0&&(i.animations=h),c.length>0&&(i.nodes=c)}return i.object=n,i;function s(t){let e=[];for(let i in t){let n=t[i];delete n.metadata,e.push(n)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let i=0;i<t.children.length;i++){let e=t.children[i];this.add(e.clone())}return this}};gg.DEFAULT_UP=new mm(0,1,0),gg.DEFAULT_MATRIX_AUTO_UPDATE=!0,gg.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var vg=new mm,yg=new mm,bg=new mm,xg=new mm,wg=new mm,Sg=new mm,Ag=new mm,Eg=new mm,_g=new mm,Cg=new mm,Mg=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new mm,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mm,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new mm;this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,n){n.subVectors(i,e),vg.subVectors(t,e),n.cross(vg);let r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(t,e,i,n,r){vg.subVectors(n,e),yg.subVectors(i,e),bg.subVectors(t,e);let s=vg.dot(vg),a=vg.dot(yg),o=vg.dot(bg),l=yg.dot(yg),h=yg.dot(bg),c=s*l-a*a;if(0===c)return r.set(-2,-1,-1);let u=1/c,d=(l*o-a*h)*u,p=(s*h-a*o)*u;return r.set(1-d-p,p,d)}static containsPoint(t,e,i,n){return this.getBarycoord(t,e,i,n,xg),xg.x>=0&&xg.y>=0&&xg.x+xg.y<=1}static getUV(t,e,i,n,r,s,a,o){return this.getBarycoord(t,e,i,n,xg),o.set(0,0),o.addScaledVector(r,xg.x),o.addScaledVector(s,xg.y),o.addScaledVector(a,xg.z),o}static isFrontFacing(t,e,i,n){return vg.subVectors(i,e),yg.subVectors(t,e),vg.cross(yg).dot(n)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,e,i,n){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return vg.subVectors(this.c,this.b),yg.subVectors(this.a,this.b),.5*vg.cross(yg).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Mg.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Mg.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,n,r){return Mg.getUV(t,this.a,this.b,this.c,e,i,n,r)}containsPoint(t){return Mg.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Mg.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){let i,n,r=this.a,s=this.b,a=this.c;wg.subVectors(s,r),Sg.subVectors(a,r),Eg.subVectors(t,r);let o=wg.dot(Eg),l=Sg.dot(Eg);if(o<=0&&l<=0)return e.copy(r);_g.subVectors(t,s);let h=wg.dot(_g),c=Sg.dot(_g);if(h>=0&&c<=h)return e.copy(s);let u=o*c-h*l;if(u<=0&&o>=0&&h<=0)return i=o/(o-h),e.copy(r).addScaledVector(wg,i);Cg.subVectors(t,a);let d=wg.dot(Cg),p=Sg.dot(Cg);if(p>=0&&d<=p)return e.copy(a);let f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return n=l/(l-p),e.copy(r).addScaledVector(Sg,n);let m=h*p-d*c;if(m<=0&&c-h>=0&&d-p>=0)return Ag.subVectors(a,s),n=(c-h)/(c-h+(d-p)),e.copy(s).addScaledVector(Ag,n);let g=1/(m+f+u);return i=f*g,n=u*g,e.copy(r).addScaledVector(wg,i).addScaledVector(Sg,n)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}},Pg=0,Tg=class extends _f{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Pg++}),this.uuid=Df(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=xp,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=wf,this.stencilZFail=wf,this.stencilZPass=wf,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(let e in t){let i=t[e];if(void 0===i){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}let n=this[e];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}}toJSON(t){let e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});let i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(t){let e=[];for(let i in t){let n=t[i];delete n.metadata,e.push(n)}return e}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),0!==this.side&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(i.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),e){let e=n(t.textures),r=n(t.images);e.length>0&&(i.textures=e),r.length>0&&(i.images=r)}return i}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;let e=t.clippingPlanes,i=null;if(null!==e){let t=e.length;i=new Array(t);for(let n=0;n!==t;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}},Dg=class extends Tg{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new nm(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}},kg=new mm,Ig=new Uf,Rg=class{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=i,this.usage=Sf,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[t+n]=e.array[i+n];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,i=this.count;e<i;e++)Ig.fromBufferAttribute(this,e),Ig.applyMatrix3(t),this.setXY(e,Ig.x,Ig.y);else if(3===this.itemSize)for(let e=0,i=this.count;e<i;e++)kg.fromBufferAttribute(this,e),kg.applyMatrix3(t),this.setXYZ(e,kg.x,kg.y,kg.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)kg.fromBufferAttribute(this,e),kg.applyMatrix4(t),this.setXYZ(e,kg.x,kg.y,kg.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)kg.fromBufferAttribute(this,e),kg.applyNormalMatrix(t),this.setXYZ(e,kg.x,kg.y,kg.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)kg.fromBufferAttribute(this,e),kg.transformDirection(t),this.setXYZ(e,kg.x,kg.y,kg.z);return this}set(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(t,e),this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=zf(e,this.array)),e}setX(t,e){return this.normalized&&(e=Ff(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=zf(e,this.array)),e}setY(t,e){return this.normalized&&(e=Ff(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=zf(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Ff(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=zf(e,this.array)),e}setW(t,e){return this.normalized&&(e=Ff(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=Ff(e,this.array),i=Ff(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,n){return t*=this.itemSize,this.normalized&&(e=Ff(e,this.array),i=Ff(i,this.array),n=Ff(n,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t*=this.itemSize,this.normalized&&(e=Ff(e,this.array),i=Ff(i,this.array),n=Ff(n,this.array),r=Ff(r,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==Sf&&(t.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(t.updateRange=this.updateRange),t}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}},Og=class extends Rg{constructor(t,e,i){super(new Uint16Array(t),e,i)}},Lg=class extends Rg{constructor(t,e,i){super(new Uint32Array(t),e,i)}},Bg=class extends Rg{constructor(t,e,i){super(new Float32Array(t),e,i)}},zg=0,Fg=new Wm,Ng=new gg,Ug=new mm,Vg=new ym,jg=new ym,Gg=new mm,Hg=class extends _f{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:zg++}),this.uuid=Df(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Gf(t)?Lg:Og)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){let e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);let i=this.attributes.normal;if(void 0!==i){let e=(new Vf).getNormalMatrix(t);i.applyNormalMatrix(e),i.needsUpdate=!0}let n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(t),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Fg.makeRotationFromQuaternion(t),this.applyMatrix4(Fg),this}rotateX(t){return Fg.makeRotationX(t),this.applyMatrix4(Fg),this}rotateY(t){return Fg.makeRotationY(t),this.applyMatrix4(Fg),this}rotateZ(t){return Fg.makeRotationZ(t),this.applyMatrix4(Fg),this}translate(t,e,i){return Fg.makeTranslation(t,e,i),this.applyMatrix4(Fg),this}scale(t,e,i){return Fg.makeScale(t,e,i),this.applyMatrix4(Fg),this}lookAt(t){return Ng.lookAt(t),Ng.updateMatrix(),this.applyMatrix4(Ng.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ug).negate(),this.translate(Ug.x,Ug.y,Ug.z),this}setFromPoints(t){let e=[];for(let i=0,n=t.length;i<n;i++){let n=t[i];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Bg(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new ym);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new mm(-1/0,-1/0,-1/0),new mm(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let i=0,n=e.length;i<n;i++){let t=e[i];Vg.setFromBufferAttribute(t),this.morphTargetsRelative?(Gg.addVectors(this.boundingBox.min,Vg.min),this.boundingBox.expandByPoint(Gg),Gg.addVectors(this.boundingBox.max,Vg.max),this.boundingBox.expandByPoint(Gg)):(this.boundingBox.expandByPoint(Vg.min),this.boundingBox.expandByPoint(Vg.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Bm);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new mm,1/0);if(t){let i=this.boundingSphere.center;if(Vg.setFromBufferAttribute(t),e)for(let t=0,r=e.length;t<r;t++){let i=e[t];jg.setFromBufferAttribute(i),this.morphTargetsRelative?(Gg.addVectors(Vg.min,jg.min),Vg.expandByPoint(Gg),Gg.addVectors(Vg.max,jg.max),Vg.expandByPoint(Gg)):(Vg.expandByPoint(jg.min),Vg.expandByPoint(jg.max))}Vg.getCenter(i);let n=0;for(let e=0,r=t.count;e<r;e++)Gg.fromBufferAttribute(t,e),n=Math.max(n,i.distanceToSquared(Gg));if(e)for(let r=0,s=e.length;r<s;r++){let s=e[r],a=this.morphTargetsRelative;for(let e=0,r=s.count;e<r;e++)Gg.fromBufferAttribute(s,e),a&&(Ug.fromBufferAttribute(t,e),Gg.add(Ug)),n=Math.max(n,i.distanceToSquared(Gg))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");let i=t.array,n=e.position.array,r=e.normal.array,s=e.uv.array,a=n.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Rg(new Float32Array(4*a),4));let o=this.getAttribute("tangent").array,l=[],h=[];for(let _=0;_<a;_++)l[_]=new mm,h[_]=new mm;let c=new mm,u=new mm,d=new mm,p=new Uf,f=new Uf,m=new Uf,g=new mm,v=new mm;function y(t,e,i){c.fromArray(n,3*t),u.fromArray(n,3*e),d.fromArray(n,3*i),p.fromArray(s,2*t),f.fromArray(s,2*e),m.fromArray(s,2*i),u.sub(c),d.sub(c),f.sub(p),m.sub(p);let r=1/(f.x*m.y-m.x*f.y);!isFinite(r)||(g.copy(u).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(r),v.copy(d).multiplyScalar(f.x).addScaledVector(u,-m.x).multiplyScalar(r),l[t].add(g),l[e].add(g),l[i].add(g),h[t].add(v),h[e].add(v),h[i].add(v))}let b=this.groups;0===b.length&&(b=[{start:0,count:i.length}]);for(let _=0,C=b.length;_<C;++_){let t=b[_],e=t.start;for(let n=e,r=e+t.count;n<r;n+=3)y(i[n+0],i[n+1],i[n+2])}let x=new mm,w=new mm,S=new mm,A=new mm;function E(t){S.fromArray(r,3*t),A.copy(S);let e=l[t];x.copy(e),x.sub(S.multiplyScalar(S.dot(e))).normalize(),w.crossVectors(A,e);let i=w.dot(h[t])<0?-1:1;o[4*t]=x.x,o[4*t+1]=x.y,o[4*t+2]=x.z,o[4*t+3]=i}for(let _=0,C=b.length;_<C;++_){let t=b[_],e=t.start;for(let n=e,r=e+t.count;n<r;n+=3)E(i[n+0]),E(i[n+1]),E(i[n+2])}}computeVertexNormals(){let t=this.index,e=this.getAttribute("position");if(void 0!==e){let i=this.getAttribute("normal");if(void 0===i)i=new Rg(new Float32Array(3*e.count),3),this.setAttribute("normal",i);else for(let t=0,e=i.count;t<e;t++)i.setXYZ(t,0,0,0);let n=new mm,r=new mm,s=new mm,a=new mm,o=new mm,l=new mm,h=new mm,c=new mm;if(t)for(let u=0,d=t.count;u<d;u+=3){let d=t.getX(u+0),p=t.getX(u+1),f=t.getX(u+2);n.fromBufferAttribute(e,d),r.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),h.subVectors(s,r),c.subVectors(n,r),h.cross(c),a.fromBufferAttribute(i,d),o.fromBufferAttribute(i,p),l.fromBufferAttribute(i,f),a.add(h),o.add(h),l.add(h),i.setXYZ(d,a.x,a.y,a.z),i.setXYZ(p,o.x,o.y,o.z),i.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,u=e.count;t<u;t+=3)n.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),h.subVectors(s,r),c.subVectors(n,r),h.cross(c),i.setXYZ(t+0,h.x,h.y,h.z),i.setXYZ(t+1,h.x,h.y,h.z),i.setXYZ(t+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)Gg.fromBufferAttribute(t,e),Gg.normalize(),t.setXYZ(e,Gg.x,Gg.y,Gg.z)}toNonIndexed(){function t(t,e){let i=t.array,n=t.itemSize,r=t.normalized,s=new i.constructor(e.length*n),a=0,o=0;for(let l=0,h=e.length;l<h;l++){a=t.isInterleavedBufferAttribute?e[l]*t.data.stride+t.offset:e[l]*n;for(let t=0;t<n;t++)s[o++]=i[a++]}return new Rg(s,n,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let e=new Hg,i=this.index.array,n=this.attributes;for(let a in n){let r=t(n[a],i);e.setAttribute(a,r)}let r=this.morphAttributes;for(let a in r){let n=[],s=r[a];for(let e=0,r=s.length;e<r;e++){let r=t(s[e],i);n.push(r)}e.morphAttributes[a]=n}e.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let a=0,o=s.length;a<o;a++){let t=s[a];e.addGroup(t.start,t.count,t.materialIndex)}return e}toJSON(){let t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){let e=this.parameters;for(let i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};let e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});let i=this.attributes;for(let o in i){let e=i[o];t.data.attributes[o]=e.toJSON(t.data)}let n={},r=!1;for(let o in this.morphAttributes){let e=this.morphAttributes[o],i=[];for(let n=0,r=e.length;n<r;n++){let r=e[n];i.push(r.toJSON(t.data))}i.length>0&&(n[o]=i,r=!0)}r&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));let a=this.boundingSphere;return null!==a&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let e={};this.name=t.name;let i=t.index;null!==i&&this.setIndex(i.clone(e));let n=t.attributes;for(let l in n){let t=n[l];this.setAttribute(l,t.clone(e))}let r=t.morphAttributes;for(let l in r){let t=[],i=r[l];for(let n=0,r=i.length;n<r;n++)t.push(i[n].clone(e));this.morphAttributes[l]=t}this.morphTargetsRelative=t.morphTargetsRelative;let s=t.groups;for(let l=0,h=s.length;l<h;l++){let t=s[l];this.addGroup(t.start,t.count,t.materialIndex)}let a=t.boundingBox;null!==a&&(this.boundingBox=a.clone());let o=t.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,void 0!==t.parameters&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},Wg=new Wm,qg=new Hm,Yg=new Bm,Xg=new mm,Qg=new mm,Kg=new mm,Zg=new mm,Jg=new mm,$g=new Uf,tv=new Uf,ev=new Uf,iv=new mm,nv=new mm,rv=class extends gg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Hg,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Dg;super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){let t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){let i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){let e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}getVertexPosition(t,e){let i=this.geometry,n=i.attributes.position,r=i.morphAttributes.position,s=i.morphTargetsRelative;e.fromBufferAttribute(n,t);let a=this.morphTargetInfluences;if(r&&a){Jg.set(0,0,0);for(let i=0,n=r.length;i<n;i++){let n=a[i],o=r[i];0!==n&&(Zg.fromBufferAttribute(o,t),s?Jg.addScaledVector(Zg,n):Jg.addScaledVector(Zg.sub(e),n))}e.add(Jg)}return this.isSkinnedMesh&&this.boneTransform(t,e),e}raycast(t,e){let i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0===n||(null===i.boundingSphere&&i.computeBoundingSphere(),Yg.copy(i.boundingSphere),Yg.applyMatrix4(r),!1===t.ray.intersectsSphere(Yg))||(Wg.copy(r).invert(),qg.copy(t.ray).applyMatrix4(Wg),null!==i.boundingBox&&!1===qg.intersectsBox(i.boundingBox)))return;let s,a=i.index,o=i.attributes.position,l=i.attributes.uv,h=i.attributes.uv2,c=i.groups,u=i.drawRange;if(null!==a)if(Array.isArray(n))for(let d=0,p=c.length;d<p;d++){let i=c[d],r=n[i.materialIndex];for(let n=Math.max(i.start,u.start),o=Math.min(a.count,Math.min(i.start+i.count,u.start+u.count));n<o;n+=3){let o=a.getX(n),c=a.getX(n+1),u=a.getX(n+2);s=sv(this,r,t,qg,l,h,o,c,u),s&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=i.materialIndex,e.push(s))}}else{for(let i=Math.max(0,u.start),r=Math.min(a.count,u.start+u.count);i<r;i+=3){let r=a.getX(i),o=a.getX(i+1),c=a.getX(i+2);s=sv(this,n,t,qg,l,h,r,o,c),s&&(s.faceIndex=Math.floor(i/3),e.push(s))}}else if(void 0!==o)if(Array.isArray(n))for(let d=0,p=c.length;d<p;d++){let i=c[d],r=n[i.materialIndex];for(let n=Math.max(i.start,u.start),a=Math.min(o.count,Math.min(i.start+i.count,u.start+u.count));n<a;n+=3){s=sv(this,r,t,qg,l,h,n,n+1,n+2),s&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=i.materialIndex,e.push(s))}}else{for(let i=Math.max(0,u.start),r=Math.min(o.count,u.start+u.count);i<r;i+=3){s=sv(this,n,t,qg,l,h,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),e.push(s))}}}};function sv(t,e,i,n,r,s,a,o,l){t.getVertexPosition(a,Xg),t.getVertexPosition(o,Qg),t.getVertexPosition(l,Kg);let h=function(t,e,i,n,r,s,a,o){let l;if(l=1===e.side?n.intersectTriangle(a,s,r,!0,o):n.intersectTriangle(r,s,a,0===e.side,o),null===l)return null;nv.copy(o),nv.applyMatrix4(t.matrixWorld);let h=i.ray.origin.distanceTo(nv);return h<i.near||h>i.far?null:{distance:h,point:nv.clone(),object:t}}(t,e,i,n,Xg,Qg,Kg,iv);if(h){r&&($g.fromBufferAttribute(r,a),tv.fromBufferAttribute(r,o),ev.fromBufferAttribute(r,l),h.uv=Mg.getUV(iv,Xg,Qg,Kg,$g,tv,ev,new Uf)),s&&($g.fromBufferAttribute(s,a),tv.fromBufferAttribute(s,o),ev.fromBufferAttribute(s,l),h.uv2=Mg.getUV(iv,Xg,Qg,Kg,$g,tv,ev,new Uf));let t={a:a,b:o,c:l,normal:new mm,materialIndex:0};Mg.getNormal(Xg,Qg,Kg,t.normal),h.face=t}return h}var av=class extends Hg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:s};let a=this;n=Math.floor(n),r=Math.floor(r),s=Math.floor(s);let o=[],l=[],h=[],c=[],u=0,d=0;function p(t,e,i,n,r,s,p,f,m,g,v){let y=s/m,b=p/g,x=s/2,w=p/2,S=f/2,A=m+1,E=g+1,_=0,C=0,M=new mm;for(let a=0;a<E;a++){let s=a*b-w;for(let o=0;o<A;o++){let u=o*y-x;M[t]=u*n,M[e]=s*r,M[i]=S,l.push(M.x,M.y,M.z),M[t]=0,M[e]=0,M[i]=f>0?1:-1,h.push(M.x,M.y,M.z),c.push(o/m),c.push(1-a/g),_+=1}}for(let a=0;a<g;a++)for(let t=0;t<m;t++){let e=u+t+A*a,i=u+t+A*(a+1),n=u+(t+1)+A*(a+1),r=u+(t+1)+A*a;o.push(e,i,r),o.push(i,n,r),C+=6}a.addGroup(d,C,v),d+=C,u+=_}p("z","y","x",-1,-1,i,e,t,s,r,0),p("z","y","x",1,-1,i,e,-t,s,r,1),p("x","z","y",1,1,t,i,e,n,s,2),p("x","z","y",1,-1,t,i,-e,n,s,3),p("x","y","z",1,-1,t,e,i,n,r,4),p("x","y","z",-1,-1,t,e,-i,n,r,5),this.setIndex(o),this.setAttribute("position",new Bg(l,3)),this.setAttribute("normal",new Bg(h,3)),this.setAttribute("uv",new Bg(c,2))}static fromJSON(t){return new av(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}};function ov(t){let e={};for(let i in t){e[i]={};for(let n in t[i]){let r=t[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[i][n]=r.clone():Array.isArray(r)?e[i][n]=r.slice():e[i][n]=r}}return e}function lv(t){let e={};for(let i=0;i<t.length;i++){let n=ov(t[i]);for(let t in n)e[t]=n[t]}return e}function hv(t){return null===t.getRenderTarget()&&t.outputEncoding===vf?bf:xf}var cv={clone:ov,merge:lv},uv=class extends Tg{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=ov(t.uniforms),this.uniformsGroups=function(t){let e=[];for(let i=0;i<t.length;i++)e.push(t[i].clone());return e}(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){let e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(let n in this.uniforms){let i=this.uniforms[n].value;i&&i.isTexture?e.uniforms[n]={type:"t",value:i.toJSON(t).uuid}:i&&i.isColor?e.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?e.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?e.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?e.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?e.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?e.uniforms[n]={type:"m4",value:i.toArray()}:e.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;let i={};for(let n in this.extensions)!0===this.extensions[n]&&(i[n]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}},dv=class extends gg{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Wm,this.projectionMatrix=new Wm,this.projectionMatrixInverse=new Wm}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);let e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}},pv=class extends dv{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){let e=.5*this.getFilmHeight()/t;this.fov=2*Tf*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){let t=Math.tan(.5*Pf*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*Tf*Math.atan(Math.tan(.5*Pf*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,n,r,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let t=this.near,e=t*Math.tan(.5*Pf*this.fov)/this.zoom,i=2*e,n=this.aspect*i,r=-.5*n,s=this.view;if(null!==this.view&&this.view.enabled){let t=s.fullWidth,a=s.fullHeight;r+=s.offsetX*n/t,e-=s.offsetY*i/a,n*=s.width/t,i*=s.height/a}let a=this.filmOffset;0!==a&&(r+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){let e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}},fv=-90,mv=class extends gg{constructor(t,e,i){super(),this.type="CubeCamera",this.renderTarget=i;let n=new pv(fv,1,t,e);n.layers=this.layers,n.up.set(0,1,0),n.lookAt(1,0,0),this.add(n);let r=new pv(fv,1,t,e);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(-1,0,0),this.add(r);let s=new pv(fv,1,t,e);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(0,1,0),this.add(s);let a=new pv(fv,1,t,e);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(0,-1,0),this.add(a);let o=new pv(fv,1,t,e);o.layers=this.layers,o.up.set(0,1,0),o.lookAt(0,0,1),this.add(o);let l=new pv(fv,1,t,e);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(t,e){null===this.parent&&this.updateMatrixWorld();let i=this.renderTarget,[n,r,s,a,o,l]=this.children,h=t.getRenderTarget(),c=t.toneMapping,u=t.xr.enabled;t.toneMapping=0,t.xr.enabled=!1;let d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,n),t.setRenderTarget(i,1),t.render(e,r),t.setRenderTarget(i,2),t.render(e,s),t.setRenderTarget(i,3),t.render(e,a),t.setRenderTarget(i,4),t.render(e,o),i.texture.generateMipmaps=d,t.setRenderTarget(i,5),t.render(e,l),t.setRenderTarget(h),t.toneMapping=c,t.xr.enabled=u,i.texture.needsPMREMUpdate=!0}},gv=class extends hm{constructor(t,e,i,n,r,s,a,o,l,h){super(t=void 0!==t?t:[],e=void 0!==e?e:Op,i,n,r,s,a,o,l,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}},vv=class extends um{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,t,e),this.isWebGLCubeRenderTarget=!0;let i={width:t,height:t,depth:1},n=[i,i,i,i,i,i];this.texture=new gv(n,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:Gp}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;let i={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},n=new av(5,5,5),r=new uv({name:"CubemapFromEquirect",uniforms:ov(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:1,blending:0});r.uniforms.tEquirect.value=e;let s=new rv(n,r),a=e.minFilter;return e.minFilter===Wp&&(e.minFilter=Gp),new mv(1,10,this).update(t,s),e.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,i,n){let r=t.getRenderTarget();for(let s=0;s<6;s++)t.setRenderTarget(this,s),t.clear(e,i,n);t.setRenderTarget(r)}},yv=new mm,bv=new mm,xv=new Vf,wv=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new mm(1,0,0),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){let n=yv.subVectors(i,e).cross(bv.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){let t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){let i=t.delta(yv),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;let r=-(t.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:e.copy(i).multiplyScalar(r).add(t.start)}intersectsLine(t){let e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){let i=e||xv.getNormalMatrix(t),n=this.coplanarPoint(yv).applyMatrix4(t),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}},Sv=new Bm,Av=new mm,Ev=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new wv,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new wv,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new wv,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new wv,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new wv,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new wv;this.planes=[t,e,i,n,r,s]}set(t,e,i,n,r,s){let a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(s),this}copy(t){let e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){let e=this.planes,i=t.elements,n=i[0],r=i[1],s=i[2],a=i[3],o=i[4],l=i[5],h=i[6],c=i[7],u=i[8],d=i[9],p=i[10],f=i[11],m=i[12],g=i[13],v=i[14],y=i[15];return e[0].setComponents(a-n,c-o,f-u,y-m).normalize(),e[1].setComponents(a+n,c+o,f+u,y+m).normalize(),e[2].setComponents(a+r,c+l,f+d,y+g).normalize(),e[3].setComponents(a-r,c-l,f-d,y-g).normalize(),e[4].setComponents(a-s,c-h,f-p,y-v).normalize(),e[5].setComponents(a+s,c+h,f+p,y+v).normalize(),this}intersectsObject(t){let e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),Sv.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Sv)}intersectsSprite(t){return Sv.center.set(0,0,0),Sv.radius=.7071067811865476,Sv.applyMatrix4(t.matrixWorld),this.intersectsSphere(Sv)}intersectsSphere(t){let e=this.planes,i=t.center,n=-t.radius;for(let r=0;r<6;r++)if(e[r].distanceToPoint(i)<n)return!1;return!0}intersectsBox(t){let e=this.planes;for(let i=0;i<6;i++){let n=e[i];if(Av.x=n.normal.x>0?t.max.x:t.min.x,Av.y=n.normal.y>0?t.max.y:t.min.y,Av.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(Av)<0)return!1}return!0}containsPoint(t){let e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}};function _v(){let t=null,e=!1,i=null,n=null;function r(e,s){i(e,s),n=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==i&&(n=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(t){i=t},setContext:function(e){t=e}}}function Cv(t,e){let i=e.isWebGL2,n=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),n.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);let i=n.get(e);i&&(t.deleteBuffer(i.buffer),n.delete(e))},update:function(e,r){if(e.isGLBufferAttribute){let t=n.get(e);return void((!t||t.version<e.version)&&n.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);let s=n.get(e);void 0===s?n.set(e,function(e,n){let r,s=e.array,a=e.usage,o=t.createBuffer();if(t.bindBuffer(n,o),t.bufferData(n,s,a),e.onUploadCallback(),s instanceof Float32Array)r=5126;else if(s instanceof Uint16Array)if(e.isFloat16BufferAttribute){if(!i)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");r=5131}else r=5123;else if(s instanceof Int16Array)r=5122;else if(s instanceof Uint32Array)r=5125;else if(s instanceof Int32Array)r=5124;else if(s instanceof Int8Array)r=5120;else if(s instanceof Uint8Array)r=5121;else{if(!(s instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+s);r=5121}return{buffer:o,type:r,bytesPerElement:s.BYTES_PER_ELEMENT,version:e.version}}(e,r)):s.version<e.version&&(function(e,n,r){let s=n.array,a=n.updateRange;t.bindBuffer(r,e),-1===a.count?t.bufferSubData(r,0,s):(i?t.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s,a.offset,a.count):t.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s.subarray(a.offset,a.offset+a.count)),a.count=-1),n.onUploadCallback()}(s.buffer,e,r),s.version=e.version)}}}var Mv=class extends Hg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};let r=t/2,s=e/2,a=Math.floor(i),o=Math.floor(n),l=a+1,h=o+1,c=t/a,u=e/o,d=[],p=[],f=[],m=[];for(let g=0;g<h;g++){let t=g*u-s;for(let e=0;e<l;e++){let i=e*c-r;p.push(i,-t,0),f.push(0,0,1),m.push(e/a),m.push(1-g/o)}}for(let g=0;g<o;g++)for(let t=0;t<a;t++){let e=t+l*g,i=t+l*(g+1),n=t+1+l*(g+1),r=t+1+l*g;d.push(e,i,r),d.push(i,n,r)}this.setIndex(d),this.setAttribute("position",new Bg(p,3)),this.setAttribute("normal",new Bg(f,3)),this.setAttribute("uv",new Bg(m,2))}static fromJSON(t){return new Mv(t.width,t.height,t.widthSegments,t.heightSegments)}},Pv={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n\tvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Tv={common:{diffuse:{value:new nm(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Vf},uv2Transform:{value:new Vf},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Uf(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new nm(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new nm(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Vf}},sprite:{diffuse:{value:new nm(16777215)},opacity:{value:1},center:{value:new Uf(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Vf}}},Dv={basic:{uniforms:lv([Tv.common,Tv.specularmap,Tv.envmap,Tv.aomap,Tv.lightmap,Tv.fog]),vertexShader:Pv.meshbasic_vert,fragmentShader:Pv.meshbasic_frag},lambert:{uniforms:lv([Tv.common,Tv.specularmap,Tv.envmap,Tv.aomap,Tv.lightmap,Tv.emissivemap,Tv.bumpmap,Tv.normalmap,Tv.displacementmap,Tv.fog,Tv.lights,{emissive:{value:new nm(0)}}]),vertexShader:Pv.meshlambert_vert,fragmentShader:Pv.meshlambert_frag},phong:{uniforms:lv([Tv.common,Tv.specularmap,Tv.envmap,Tv.aomap,Tv.lightmap,Tv.emissivemap,Tv.bumpmap,Tv.normalmap,Tv.displacementmap,Tv.fog,Tv.lights,{emissive:{value:new nm(0)},specular:{value:new nm(1118481)},shininess:{value:30}}]),vertexShader:Pv.meshphong_vert,fragmentShader:Pv.meshphong_frag},standard:{uniforms:lv([Tv.common,Tv.envmap,Tv.aomap,Tv.lightmap,Tv.emissivemap,Tv.bumpmap,Tv.normalmap,Tv.displacementmap,Tv.roughnessmap,Tv.metalnessmap,Tv.fog,Tv.lights,{emissive:{value:new nm(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Pv.meshphysical_vert,fragmentShader:Pv.meshphysical_frag},toon:{uniforms:lv([Tv.common,Tv.aomap,Tv.lightmap,Tv.emissivemap,Tv.bumpmap,Tv.normalmap,Tv.displacementmap,Tv.gradientmap,Tv.fog,Tv.lights,{emissive:{value:new nm(0)}}]),vertexShader:Pv.meshtoon_vert,fragmentShader:Pv.meshtoon_frag},matcap:{uniforms:lv([Tv.common,Tv.bumpmap,Tv.normalmap,Tv.displacementmap,Tv.fog,{matcap:{value:null}}]),vertexShader:Pv.meshmatcap_vert,fragmentShader:Pv.meshmatcap_frag},points:{uniforms:lv([Tv.points,Tv.fog]),vertexShader:Pv.points_vert,fragmentShader:Pv.points_frag},dashed:{uniforms:lv([Tv.common,Tv.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Pv.linedashed_vert,fragmentShader:Pv.linedashed_frag},depth:{uniforms:lv([Tv.common,Tv.displacementmap]),vertexShader:Pv.depth_vert,fragmentShader:Pv.depth_frag},normal:{uniforms:lv([Tv.common,Tv.bumpmap,Tv.normalmap,Tv.displacementmap,{opacity:{value:1}}]),vertexShader:Pv.meshnormal_vert,fragmentShader:Pv.meshnormal_frag},sprite:{uniforms:lv([Tv.sprite,Tv.fog]),vertexShader:Pv.sprite_vert,fragmentShader:Pv.sprite_frag},background:{uniforms:{uvTransform:{value:new Vf},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Pv.background_vert,fragmentShader:Pv.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Pv.backgroundCube_vert,fragmentShader:Pv.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Pv.cube_vert,fragmentShader:Pv.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Pv.equirect_vert,fragmentShader:Pv.equirect_frag},distanceRGBA:{uniforms:lv([Tv.common,Tv.displacementmap,{referencePosition:{value:new mm},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Pv.distanceRGBA_vert,fragmentShader:Pv.distanceRGBA_frag},shadow:{uniforms:lv([Tv.lights,Tv.fog,{color:{value:new nm(0)},opacity:{value:1}}]),vertexShader:Pv.shadow_vert,fragmentShader:Pv.shadow_frag}};Dv.physical={uniforms:lv([Dv.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Uf(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new nm(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Uf},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new nm(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new nm(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Pv.meshphysical_vert,fragmentShader:Pv.meshphysical_frag};var kv={r:0,b:0,g:0};function Iv(t,e,i,n,r,s,a){let o,l,h=new nm(0),c=!0===s?0:1,u=null,d=0,p=null;function f(e,i){e.getRGB(kv,hv(t)),n.buffers.color.setClear(kv.r,kv.g,kv.b,i,a)}return{getClearColor:function(){return h},setClearColor:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;h.set(t),c=e,f(h,c)},getClearAlpha:function(){return c},setClearAlpha:function(t){c=t,f(h,c)},render:function(n,s){let a=!1,m=!0===s.isScene?s.background:null;m&&m.isTexture&&(m=(s.backgroundBlurriness>0?i:e).get(m));let g=t.xr,v=g.getSession&&g.getSession();v&&"additive"===v.environmentBlendMode&&(m=null),null===m?f(h,c):m&&m.isColor&&(f(m,1),a=!0),(t.autoClear||a)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),m&&(m.isCubeTexture||m.mapping===Bp)?(void 0===l&&(l=new rv(new av(1,1,1),new uv({name:"BackgroundCubeMaterial",uniforms:ov(Dv.backgroundCube.uniforms),vertexShader:Dv.backgroundCube.vertexShader,fragmentShader:Dv.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(l)),l.material.uniforms.envMap.value=m,l.material.uniforms.flipEnvMap.value=m.isCubeTexture&&!1===m.isRenderTargetTexture?-1:1,l.material.uniforms.backgroundBlurriness.value=s.backgroundBlurriness,l.material.uniforms.backgroundIntensity.value=s.backgroundIntensity,l.material.toneMapped=m.encoding!==vf,(u!==m||d!==m.version||p!==t.toneMapping)&&(l.material.needsUpdate=!0,u=m,d=m.version,p=t.toneMapping),l.layers.enableAll(),n.unshift(l,l.geometry,l.material,0,0,null)):m&&m.isTexture&&(void 0===o&&(o=new rv(new Mv(2,2),new uv({name:"BackgroundMaterial",uniforms:ov(Dv.background.uniforms),vertexShader:Dv.background.vertexShader,fragmentShader:Dv.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(o)),o.material.uniforms.t2D.value=m,o.material.uniforms.backgroundIntensity.value=s.backgroundIntensity,o.material.toneMapped=m.encoding!==vf,!0===m.matrixAutoUpdate&&m.updateMatrix(),o.material.uniforms.uvTransform.value.copy(m.matrix),(u!==m||d!==m.version||p!==t.toneMapping)&&(o.material.needsUpdate=!0,u=m,d=m.version,p=t.toneMapping),o.layers.enableAll(),n.unshift(o,o.geometry,o.material,0,0,null))}}}function Rv(t,e,i,n){let r=t.getParameter(34921),s=n.isWebGL2?null:e.get("OES_vertex_array_object"),a=n.isWebGL2||null!==s,o={},l=p(null),h=l,c=!1;function u(e){return n.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e)}function d(e){return n.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function p(t){let e=[],i=[],n=[];for(let s=0;s<r;s++)e[s]=0,i[s]=0,n[s]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:i,attributeDivisors:n,object:t,attributes:{},index:null}}function f(){let t=h.newAttributes;for(let e=0,i=t.length;e<i;e++)t[e]=0}function m(t){g(t,0)}function g(i,r){let s=h.newAttributes,a=h.enabledAttributes,o=h.attributeDivisors;s[i]=1,0===a[i]&&(t.enableVertexAttribArray(i),a[i]=1),o[i]!==r&&((n.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),o[i]=r)}function v(){let e=h.newAttributes,i=h.enabledAttributes;for(let n=0,r=i.length;n<r;n++)i[n]!==e[n]&&(t.disableVertexAttribArray(n),i[n]=0)}function y(e,i,r,s,a,o){!0!==n.isWebGL2||5124!==r&&5125!==r?t.vertexAttribPointer(e,i,r,s,a,o):t.vertexAttribIPointer(e,i,r,a,o)}function b(){x(),c=!0,h!==l&&(h=l,u(h.object))}function x(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,d,b,x){let w=!1;if(a){let e=function(e,i,r){let a=!0===r.wireframe,l=o[e.id];void 0===l&&(l={},o[e.id]=l);let h=l[i.id];void 0===h&&(h={},l[i.id]=h);let c=h[a];return void 0===c&&(c=p(n.isWebGL2?t.createVertexArray():s.createVertexArrayOES()),h[a]=c),c}(b,d,l);h!==e&&(h=e,u(h.object)),w=function(t,e,i,n){let r=h.attributes,s=e.attributes,a=0,o=i.getAttributes();for(let l in o)if(o[l].location>=0){let e=r[l],i=s[l];if(void 0===i&&("instanceMatrix"===l&&t.instanceMatrix&&(i=t.instanceMatrix),"instanceColor"===l&&t.instanceColor&&(i=t.instanceColor)),void 0===e||e.attribute!==i||i&&e.data!==i.data)return!0;a++}return h.attributesNum!==a||h.index!==n}(r,b,d,x),w&&function(t,e,i,n){let r={},s=e.attributes,a=0,o=i.getAttributes();for(let l in o)if(o[l].location>=0){let e=s[l];void 0===e&&("instanceMatrix"===l&&t.instanceMatrix&&(e=t.instanceMatrix),"instanceColor"===l&&t.instanceColor&&(e=t.instanceColor));let i={};i.attribute=e,e&&e.data&&(i.data=e.data),r[l]=i,a++}h.attributes=r,h.attributesNum=a,h.index=n}(r,b,d,x)}else{let t=!0===l.wireframe;(h.geometry!==b.id||h.program!==d.id||h.wireframe!==t)&&(h.geometry=b.id,h.program=d.id,h.wireframe=t,w=!0)}null!==x&&i.update(x,34963),(w||c)&&(c=!1,function(r,s,a,o){if(!1===n.isWebGL2&&(r.isInstancedMesh||o.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;f();let l=o.attributes,h=a.getAttributes(),c=s.defaultAttributeValues;for(let e in h){let n=h[e];if(n.location>=0){let s=l[e];if(void 0===s&&("instanceMatrix"===e&&r.instanceMatrix&&(s=r.instanceMatrix),"instanceColor"===e&&r.instanceColor&&(s=r.instanceColor)),void 0!==s){let e=s.normalized,a=s.itemSize,l=i.get(s);if(void 0===l)continue;let h=l.buffer,c=l.type,u=l.bytesPerElement;if(s.isInterleavedBufferAttribute){let i=s.data,l=i.stride,d=s.offset;if(i.isInstancedInterleavedBuffer){for(let t=0;t<n.locationSize;t++)g(n.location+t,i.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let t=0;t<n.locationSize;t++)m(n.location+t);t.bindBuffer(34962,h);for(let t=0;t<n.locationSize;t++)y(n.location+t,a/n.locationSize,c,e,l*u,(d+a/n.locationSize*t)*u)}else{if(s.isInstancedBufferAttribute){for(let t=0;t<n.locationSize;t++)g(n.location+t,s.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let t=0;t<n.locationSize;t++)m(n.location+t);t.bindBuffer(34962,h);for(let t=0;t<n.locationSize;t++)y(n.location+t,a/n.locationSize,c,e,a*u,a/n.locationSize*t*u)}}else if(void 0!==c){let i=c[e];if(void 0!==i)switch(i.length){case 2:t.vertexAttrib2fv(n.location,i);break;case 3:t.vertexAttrib3fv(n.location,i);break;case 4:t.vertexAttrib4fv(n.location,i);break;default:t.vertexAttrib1fv(n.location,i)}}}}v()}(r,l,d,b),null!==x&&t.bindBuffer(34963,i.get(x).buffer))},reset:b,resetDefaultState:x,dispose:function(){b();for(let t in o){let e=o[t];for(let t in e){let i=e[t];for(let t in i)d(i[t].object),delete i[t];delete e[t]}delete o[t]}},releaseStatesOfGeometry:function(t){if(void 0===o[t.id])return;let e=o[t.id];for(let i in e){let t=e[i];for(let e in t)d(t[e].object),delete t[e];delete e[i]}delete o[t.id]},releaseStatesOfProgram:function(t){for(let e in o){let i=o[e];if(void 0===i[t.id])continue;let n=i[t.id];for(let t in n)d(n[t].object),delete n[t];delete i[t.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:v}}function Ov(t,e,i,n){let r,s=n.isWebGL2;this.setMode=function(t){r=t},this.render=function(e,n){t.drawArrays(r,e,n),i.update(n,r,1)},this.renderInstances=function(n,a,o){if(0===o)return;let l,h;if(s)l=t,h="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),h="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[h](r,n,a,o),i.update(a,r,o)}}function Lv(t,e,i){let n;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let s=typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext,a=void 0!==i.precision?i.precision:"highp",o=r(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);let l=s||e.has("WEBGL_draw_buffers"),h=!0===i.logarithmicDepthBuffer,c=t.getParameter(34930),u=t.getParameter(35660),d=t.getParameter(3379),p=t.getParameter(34076),f=t.getParameter(34921),m=t.getParameter(36347),g=t.getParameter(36348),v=t.getParameter(36349),y=u>0,b=s||e.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===e.has("EXT_texture_filter_anisotropic")){let i=e.get("EXT_texture_filter_anisotropic");n=t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:h,maxTextures:c,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:b,floatVertexTextures:y&&b,maxSamples:s?t.getParameter(36183):0}}function Bv(t){let e=this,i=null,n=0,r=!1,s=!1,a=new wv,o=new Vf,l={value:null,needsUpdate:!1};function h(t,i,n,r){let s=null!==t?t.length:0,h=null;if(0!==s){if(h=l.value,!0!==r||null===h){let e=n+4*s,r=i.matrixWorldInverse;o.getNormalMatrix(r),(null===h||h.length<e)&&(h=new Float32Array(e));for(let i=0,l=n;i!==s;++i,l+=4)a.copy(t[i]).applyMatrix4(r,o),a.normal.toArray(h,l),h[l+3]=a.constant}l.value=h,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,h}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e){let i=0!==t.length||e||0!==n||r;return r=e,n=t.length,i},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(t,e){i=h(t,e,0)},this.setState=function(a,o,c){let u=a.clippingPlanes,d=a.clipIntersection,p=a.clipShadows,f=t.get(a);if(!r||null===u||0===u.length||s&&!p)s?h(null):(l.value!==i&&(l.value=i,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0);else{let t=s?0:n,e=4*t,r=f.clippingState||null;l.value=r,r=h(u,o,e,c);for(let n=0;n!==e;++n)r[n]=i[n];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function zv(t){let e=new WeakMap;function i(t,e){return 303===e?t.mapping=Op:304===e&&(t.mapping=Lp),t}function n(t){let i=t.target;i.removeEventListener("dispose",n);let r=e.get(i);void 0!==r&&(e.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){let s=r.mapping;if(303===s||304===s){if(e.has(r)){return i(e.get(r).texture,r.mapping)}{let s=r.image;if(s&&s.height>0){let a=new vv(s.height/2);return a.fromEquirectangularTexture(t,r),e.set(r,a),r.addEventListener("dispose",n),i(a.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}var Fv=class extends dv{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,n,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2,r=i-t,s=i+t,a=n+e,o=n-e;if(null!==this.view&&this.view.enabled){let t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,s=r+t*this.view.width,a-=e*this.view.offsetY,o=a-e*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){let e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}},Nv=[.125,.215,.35,.446,.526,.582],Uv=20,Vv=new Fv,jv=new nm,Gv=null,Hv=(1+Math.sqrt(5))/2,Wv=1/Hv,qv=[new mm(1,1,1),new mm(-1,1,1),new mm(1,1,-1),new mm(-1,1,-1),new mm(0,Hv,Wv),new mm(0,Hv,-Wv),new mm(Wv,0,Hv),new mm(-Wv,0,Hv),new mm(Hv,Wv,0),new mm(-Hv,Wv,0)],Yv=class{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;Gv=this._renderer.getRenderTarget(),this._setSize(256);let r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,i,n,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(t,e)}fromCubemap(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Zv(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Kv(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Gv),t.scissorTest=!1,Qv(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===Op||t.mapping===Lp?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Gv=this._renderer.getRenderTarget();let i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){let t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:Gp,minFilter:Gp,generateMipmaps:!1,type:Qp,format:Zp,encoding:gf,depthBuffer:!1},n=Xv(t,e,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Xv(t,e,i);let{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){let e=[],i=[],n=[],r=t,s=t-4+1+Nv.length;for(let a=0;a<s;a++){let s=Math.pow(2,r);i.push(s);let o=1/s;a>t-4?o=Nv[a-t+4-1]:0===a&&(o=0),n.push(o);let l=1/(s-2),h=-l,c=1+l,u=[h,h,c,h,c,c,h,h,c,c,h,c],d=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*d),y=new Float32Array(m*p*d),b=new Float32Array(g*p*d);for(let t=0;t<d;t++){let e=t%3*2/3-1,i=t>2?0:-1,n=[e,i,0,e+2/3,i,0,e+2/3,i+1,0,e,i,0,e+2/3,i+1,0,e,i+1,0];v.set(n,f*p*t),y.set(u,m*p*t);let r=[t,t,t,t,t,t];b.set(r,g*p*t)}let x=new Hg;x.setAttribute("position",new Rg(v,f)),x.setAttribute("uv",new Rg(y,m)),x.setAttribute("faceIndex",new Rg(b,g)),e.push(x),r>4&&r--}return{lodPlanes:e,sizeLods:i,sigmas:n}}(n)),this._blurMaterial=function(t,e,i){let n=new Float32Array(Uv),r=new mm(0,1,0);return new uv({name:"SphericalGaussianBlur",defines:{n:Uv,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:Jv(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(n,t,e)}return n}_compileMaterial(t){let e=new rv(this._lodPlanes[0],t);this._renderer.compile(e,Vv)}_sceneToCubeUV(t,e,i,n){let r=new pv(90,1,e,i),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,h=o.toneMapping;o.getClearColor(jv),o.toneMapping=0,o.autoClear=!1;let c=new Dg({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),u=new rv(new av,c),d=!1,p=t.background;p?p.isColor&&(c.color.copy(p),t.background=null,d=!0):(c.color.copy(jv),d=!0);for(let f=0;f<6;f++){let e=f%3;0===e?(r.up.set(0,s[f],0),r.lookAt(a[f],0,0)):1===e?(r.up.set(0,0,s[f]),r.lookAt(0,a[f],0)):(r.up.set(0,s[f],0),r.lookAt(0,0,a[f]));let i=this._cubeSize;Qv(n,e*i,f>2?i:0,i,i),o.setRenderTarget(n),d&&o.render(u,r),o.render(t,r)}u.geometry.dispose(),u.material.dispose(),o.toneMapping=h,o.autoClear=l,t.background=p}_textureToCubeUV(t,e){let i=this._renderer,n=t.mapping===Op||t.mapping===Lp;n?(null===this._cubemapMaterial&&(this._cubemapMaterial=Zv()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Kv());let r=n?this._cubemapMaterial:this._equirectMaterial,s=new rv(this._lodPlanes[0],r);r.uniforms.envMap.value=t;let a=this._cubeSize;Qv(e,0,0,3*a,2*a),i.setRenderTarget(e),i.render(s,Vv)}_applyPMREM(t){let e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let n=1;n<this._lodPlanes.length;n++){let e=Math.sqrt(this._sigmas[n]*this._sigmas[n]-this._sigmas[n-1]*this._sigmas[n-1]),i=qv[(n-1)%qv.length];this._blur(t,n-1,n,e,i)}e.autoClear=i}_blur(t,e,i,n,r){let s=this._pingPongRenderTarget;this._halfBlur(t,s,e,i,n,"latitudinal",r),this._halfBlur(s,t,i,i,n,"longitudinal",r)}_halfBlur(t,e,i,n,r,s,a){let o=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");let h=new rv(this._lodPlanes[n],l),c=l.uniforms,u=this._sizeLods[i]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):Uv;f>Uv&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);let m=[],g=0;for(let b=0;b<Uv;++b){let t=b/p,e=Math.exp(-t*t/2);m.push(e),0===b?g+=e:b<f&&(g+=2*e)}for(let b=0;b<m.length;b++)m[b]=m[b]/g;c.envMap.value=t.texture,c.samples.value=f,c.weights.value=m,c.latitudinal.value="latitudinal"===s,a&&(c.poleAxis.value=a);let{_lodMax:v}=this;c.dTheta.value=d,c.mipInt.value=v-i;let y=this._sizeLods[n];Qv(e,3*y*(n>v-4?n-v+4:0),4*(this._cubeSize-y),3*y,2*y),o.setRenderTarget(e),o.render(h,Vv)}};function Xv(t,e,i){let n=new um(t,e,i);return n.texture.mapping=Bp,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function Qv(t,e,i,n,r){t.viewport.set(e,i,n,r),t.scissor.set(e,i,n,r)}function Kv(){return new uv({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Jv(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Zv(){return new uv({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Jv(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Jv(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function $v(t){let e=new WeakMap,i=null;function n(t){let i=t.target;i.removeEventListener("dispose",n);let r=e.get(i);void 0!==r&&(e.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture){let s=r.mapping,a=303===s||304===s,o=s===Op||s===Lp;if(a||o){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let n=e.get(r);return null===i&&(i=new Yv(t)),n=a?i.fromEquirectangular(r,n):i.fromCubemap(r,n),e.set(r,n),n.texture}if(e.has(r))return e.get(r).texture;{let s=r.image;if(a&&s&&s.height>0||o&&s&&function(t){let e=0,i=6;for(let n=0;n<i;n++)void 0!==t[n]&&e++;return e===i}(s)){null===i&&(i=new Yv(t));let s=a?i.fromEquirectangular(r):i.fromCubemap(r);return e.set(r,s),r.addEventListener("dispose",n),s.texture}return null}}}return r},dispose:function(){e=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function ty(t){let e={};function i(i){if(void 0!==e[i])return e[i];let n;switch(i){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(i)}return e[i]=n,n}return{has:function(t){return null!==i(t)},init:function(t){t.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(t){let e=i(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function ey(t,e,i,n){let r={},s=new WeakMap;function a(t){let o=t.target;null!==o.index&&e.remove(o.index);for(let i in o.attributes)e.remove(o.attributes[i]);o.removeEventListener("dispose",a),delete r[o.id];let l=s.get(o);l&&(e.remove(l),s.delete(o)),n.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,i.memory.geometries--}function o(t){let i=[],n=t.index,r=t.attributes.position,a=0;if(null!==n){let t=n.array;a=n.version;for(let e=0,n=t.length;e<n;e+=3){let n=t[e+0],r=t[e+1],s=t[e+2];i.push(n,r,r,s,s,n)}}else{let t=r.array;a=r.version;for(let e=0,n=t.length/3-1;e<n;e+=3){let t=e+0,n=e+1,r=e+2;i.push(t,n,n,r,r,t)}}let o=new(Gf(i)?Lg:Og)(i,1);o.version=a;let l=s.get(t);l&&e.remove(l),s.set(t,o)}return{get:function(t,e){return!0===r[e.id]||(e.addEventListener("dispose",a),r[e.id]=!0,i.memory.geometries++),e},update:function(t){let i=t.attributes;for(let r in i)e.update(i[r],34962);let n=t.morphAttributes;for(let r in n){let t=n[r];for(let i=0,n=t.length;i<n;i++)e.update(t[i],34962)}},getWireframeAttribute:function(t){let e=s.get(t);if(e){let i=t.index;null!==i&&e.version<i.version&&o(t)}else o(t);return s.get(t)}}}function iy(t,e,i,n){let r,s,a,o=n.isWebGL2;this.setMode=function(t){r=t},this.setIndex=function(t){s=t.type,a=t.bytesPerElement},this.render=function(e,n){t.drawElements(r,n,s,e*a),i.update(n,r,1)},this.renderInstances=function(n,l,h){if(0===h)return;let c,u;if(o)c=t,u="drawElementsInstanced";else if(c=e.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===c)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[u](r,l,s,n*a,h),i.update(l,r,h)}}function ny(t){let e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,i,n){switch(e.calls++,i){case 4:e.triangles+=n*(t/3);break;case 1:e.lines+=n*(t/2);break;case 3:e.lines+=n*(t-1);break;case 2:e.lines+=n*t;break;case 0:e.points+=n*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function ry(t,e){return t[0]-e[0]}function sy(t,e){return Math.abs(e[1])-Math.abs(t[1])}function ay(t,e,i){let n={},r=new Float32Array(8),s=new WeakMap,a=new cm,o=[];for(let l=0;l<8;l++)o[l]=[l,0];return{update:function(l,h,c,u){let d=l.morphTargetInfluences;if(!0===e.isWebGL2){let n=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,r=void 0!==n?n.length:0,o=s.get(h);if(void 0===o||o.count!==r){let t=function(){v.dispose(),s.delete(h),h.removeEventListener("dispose",t)};void 0!==o&&o.texture.dispose();let i=void 0!==h.morphAttributes.position,n=void 0!==h.morphAttributes.normal,l=void 0!==h.morphAttributes.color,c=h.morphAttributes.position||[],u=h.morphAttributes.normal||[],d=h.morphAttributes.color||[],p=0;!0===i&&(p=1),!0===n&&(p=2),!0===l&&(p=3);let f=h.attributes.position.count*p,m=1;f>e.maxTextureSize&&(m=Math.ceil(f/e.maxTextureSize),f=e.maxTextureSize);let g=new Float32Array(f*m*4*r),v=new dm(g,f,m,r);v.type=Xp,v.needsUpdate=!0;let y=4*p;for(let e=0;e<r;e++){let t=c[e],r=u[e],s=d[e],o=f*m*4*e;for(let e=0;e<t.count;e++){let h=e*y;!0===i&&(a.fromBufferAttribute(t,e),g[o+h+0]=a.x,g[o+h+1]=a.y,g[o+h+2]=a.z,g[o+h+3]=0),!0===n&&(a.fromBufferAttribute(r,e),g[o+h+4]=a.x,g[o+h+5]=a.y,g[o+h+6]=a.z,g[o+h+7]=0),!0===l&&(a.fromBufferAttribute(s,e),g[o+h+8]=a.x,g[o+h+9]=a.y,g[o+h+10]=a.z,g[o+h+11]=4===s.itemSize?a.w:1)}}o={count:r,texture:v,size:new Uf(f,m)},s.set(h,o),h.addEventListener("dispose",t)}let l=0;for(let t=0;t<d.length;t++)l+=d[t];let c=h.morphTargetsRelative?1:1-l;u.getUniforms().setValue(t,"morphTargetBaseInfluence",c),u.getUniforms().setValue(t,"morphTargetInfluences",d),u.getUniforms().setValue(t,"morphTargetsTexture",o.texture,i),u.getUniforms().setValue(t,"morphTargetsTextureSize",o.size)}else{let e=void 0===d?0:d.length,i=n[h.id];if(void 0===i||i.length!==e){i=[];for(let t=0;t<e;t++)i[t]=[t,0];n[h.id]=i}for(let t=0;t<e;t++){let e=i[t];e[0]=t,e[1]=d[t]}i.sort(sy);for(let t=0;t<8;t++)t<e&&i[t][1]?(o[t][0]=i[t][0],o[t][1]=i[t][1]):(o[t][0]=Number.MAX_SAFE_INTEGER,o[t][1]=0);o.sort(ry);let s=h.morphAttributes.position,a=h.morphAttributes.normal,l=0;for(let t=0;t<8;t++){let e=o[t],i=e[0],n=e[1];i!==Number.MAX_SAFE_INTEGER&&n?(s&&h.getAttribute("morphTarget"+t)!==s[i]&&h.setAttribute("morphTarget"+t,s[i]),a&&h.getAttribute("morphNormal"+t)!==a[i]&&h.setAttribute("morphNormal"+t,a[i]),r[t]=n,l+=n):(s&&!0===h.hasAttribute("morphTarget"+t)&&h.deleteAttribute("morphTarget"+t),a&&!0===h.hasAttribute("morphNormal"+t)&&h.deleteAttribute("morphNormal"+t),r[t]=0)}let c=h.morphTargetsRelative?1:1-l;u.getUniforms().setValue(t,"morphTargetBaseInfluence",c),u.getUniforms().setValue(t,"morphTargetInfluences",r)}}}}function oy(t,e,i,n){let r=new WeakMap;function s(t){let e=t.target;e.removeEventListener("dispose",s),i.remove(e.instanceMatrix),null!==e.instanceColor&&i.remove(e.instanceColor)}return{update:function(t){let a=n.render.frame,o=t.geometry,l=e.get(t,o);return r.get(l)!==a&&(e.update(l),r.set(l,a)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",s)&&t.addEventListener("dispose",s),i.update(t.instanceMatrix,34962),null!==t.instanceColor&&i.update(t.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}var ly=new hm,hy=new dm,cy=new class extends hm{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:i,depth:n},this.magFilter=Up,this.minFilter=Up,this.wrapR=Fp,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},uy=new gv,dy=[],py=[],fy=new Float32Array(16),my=new Float32Array(9),gy=new Float32Array(4);function vy(t,e,i){let n=t[0];if(null==n||n<=0||n>0)return t;let r=e*i,s=dy[r];if(void 0===s&&(s=new Float32Array(r),dy[r]=s),0!==e){n.toArray(s,0);for(let n=1,r=0;n!==e;++n)r+=i,t[n].toArray(s,r)}return s}function yy(t,e){if(t.length!==e.length)return!1;for(let i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0}function by(t,e){for(let i=0,n=e.length;i<n;i++)t[i]=e[i]}function xy(t,e){let i=py[e];void 0===i&&(i=new Int32Array(e),py[e]=i);for(let n=0;n!==e;++n)i[n]=t.allocateTextureUnit();return i}function wy(t,e){let i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function Sy(t,e){let i=this.cache;if(void 0!==e.x)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(yy(i,e))return;t.uniform2fv(this.addr,e),by(i,e)}}function Ay(t,e){let i=this.cache;if(void 0!==e.x)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(void 0!==e.r)(i[0]!==e.r||i[1]!==e.g||i[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(yy(i,e))return;t.uniform3fv(this.addr,e),by(i,e)}}function Ey(t,e){let i=this.cache;if(void 0!==e.x)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(yy(i,e))return;t.uniform4fv(this.addr,e),by(i,e)}}function _y(t,e){let i=this.cache,n=e.elements;if(void 0===n){if(yy(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),by(i,e)}else{if(yy(i,n))return;gy.set(n),t.uniformMatrix2fv(this.addr,!1,gy),by(i,n)}}function Cy(t,e){let i=this.cache,n=e.elements;if(void 0===n){if(yy(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),by(i,e)}else{if(yy(i,n))return;my.set(n),t.uniformMatrix3fv(this.addr,!1,my),by(i,n)}}function My(t,e){let i=this.cache,n=e.elements;if(void 0===n){if(yy(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),by(i,e)}else{if(yy(i,n))return;fy.set(n),t.uniformMatrix4fv(this.addr,!1,fy),by(i,n)}}function Py(t,e){let i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function Ty(t,e){let i=this.cache;if(void 0!==e.x)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(yy(i,e))return;t.uniform2iv(this.addr,e),by(i,e)}}function Dy(t,e){let i=this.cache;if(void 0!==e.x)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(yy(i,e))return;t.uniform3iv(this.addr,e),by(i,e)}}function ky(t,e){let i=this.cache;if(void 0!==e.x)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(yy(i,e))return;t.uniform4iv(this.addr,e),by(i,e)}}function Iy(t,e){let i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function Ry(t,e){let i=this.cache;if(void 0!==e.x)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(yy(i,e))return;t.uniform2uiv(this.addr,e),by(i,e)}}function Oy(t,e){let i=this.cache;if(void 0!==e.x)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(yy(i,e))return;t.uniform3uiv(this.addr,e),by(i,e)}}function Ly(t,e){let i=this.cache;if(void 0!==e.x)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(yy(i,e))return;t.uniform4uiv(this.addr,e),by(i,e)}}function By(t,e,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2D(e||ly,r)}function zy(t,e,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(e||cy,r)}function Fy(t,e,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTextureCube(e||uy,r)}function Ny(t,e,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(e||hy,r)}function Uy(t,e){t.uniform1fv(this.addr,e)}function Vy(t,e){let i=vy(e,this.size,2);t.uniform2fv(this.addr,i)}function jy(t,e){let i=vy(e,this.size,3);t.uniform3fv(this.addr,i)}function Gy(t,e){let i=vy(e,this.size,4);t.uniform4fv(this.addr,i)}function Hy(t,e){let i=vy(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function Wy(t,e){let i=vy(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function qy(t,e){let i=vy(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function Yy(t,e){t.uniform1iv(this.addr,e)}function Xy(t,e){t.uniform2iv(this.addr,e)}function Qy(t,e){t.uniform3iv(this.addr,e)}function Ky(t,e){t.uniform4iv(this.addr,e)}function Zy(t,e){t.uniform1uiv(this.addr,e)}function Jy(t,e){t.uniform2uiv(this.addr,e)}function $y(t,e){t.uniform3uiv(this.addr,e)}function tb(t,e){t.uniform4uiv(this.addr,e)}function eb(t,e,i){let n=this.cache,r=e.length,s=xy(i,r);yy(n,s)||(t.uniform1iv(this.addr,s),by(n,s));for(let a=0;a!==r;++a)i.setTexture2D(e[a]||ly,s[a])}function ib(t,e,i){let n=this.cache,r=e.length,s=xy(i,r);yy(n,s)||(t.uniform1iv(this.addr,s),by(n,s));for(let a=0;a!==r;++a)i.setTexture3D(e[a]||cy,s[a])}function nb(t,e,i){let n=this.cache,r=e.length,s=xy(i,r);yy(n,s)||(t.uniform1iv(this.addr,s),by(n,s));for(let a=0;a!==r;++a)i.setTextureCube(e[a]||uy,s[a])}function rb(t,e,i){let n=this.cache,r=e.length,s=xy(i,r);yy(n,s)||(t.uniform1iv(this.addr,s),by(n,s));for(let a=0;a!==r;++a)i.setTexture2DArray(e[a]||hy,s[a])}var sb=class{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=function(t){switch(t){case 5126:return wy;case 35664:return Sy;case 35665:return Ay;case 35666:return Ey;case 35674:return _y;case 35675:return Cy;case 35676:return My;case 5124:case 35670:return Py;case 35667:case 35671:return Ty;case 35668:case 35672:return Dy;case 35669:case 35673:return ky;case 5125:return Iy;case 36294:return Ry;case 36295:return Oy;case 36296:return Ly;case 35678:case 36198:case 36298:case 36306:case 35682:return By;case 35679:case 36299:case 36307:return zy;case 35680:case 36300:case 36308:case 36293:return Fy;case 36289:case 36303:case 36311:case 36292:return Ny}}(e.type)}},ab=class{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Uy;case 35664:return Vy;case 35665:return jy;case 35666:return Gy;case 35674:return Hy;case 35675:return Wy;case 35676:return qy;case 5124:case 35670:return Yy;case 35667:case 35671:return Xy;case 35668:case 35672:return Qy;case 35669:case 35673:return Ky;case 5125:return Zy;case 36294:return Jy;case 36295:return $y;case 36296:return tb;case 35678:case 36198:case 36298:case 36306:case 35682:return eb;case 35679:case 36299:case 36307:return ib;case 35680:case 36300:case 36308:case 36293:return nb;case 36289:case 36303:case 36311:case 36292:return rb}}(e.type)}},ob=class{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,i){if(void 0===e)return;let n=this.seq;for(let r=0,s=n.length;r!==s;++r){let s=n[r];s.setValue(t,e[s.id],i)}}},lb=/(\w+)(\])?(\[|\.)?/g;function hb(t,e){t.seq.push(e),t.map[e.id]=e}function cb(t,e,i){let n=t.name,r=n.length;for(lb.lastIndex=0;;){let s=lb.exec(n),a=lb.lastIndex,o=s[1],l="]"===s[2],h=s[3];if(l&&(o|=0),void 0===h||"["===h&&a+2===r){hb(i,void 0===h?new sb(o,t,e):new ab(o,t,e));break}{let t=i.map[o];void 0===t&&(t=new ob(o),hb(i,t)),i=t}}}var ub=class{constructor(t,e){this.seq=[],this.map={};let i=t.getProgramParameter(e,35718);for(let n=0;n<i;++n){let i=t.getActiveUniform(e,n);cb(i,t.getUniformLocation(e,i.name),this)}}setValue(t,e,i,n){let r=this.map[e];void 0!==r&&r.setValue(t,i,n)}setOptional(t,e,i){let n=e[i];void 0!==n&&this.setValue(t,i,n)}static upload(t,e,i,n){for(let r=0,s=e.length;r!==s;++r){let s=e[r],a=i[s.id];!1!==a.needsUpdate&&s.setValue(t,a.value,n)}}static seqWithValue(t,e){let i=[];for(let n=0,r=t.length;n!==r;++n){let r=t[n];r.id in e&&i.push(r)}return i}};function db(t,e,i){let n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),n}var pb=0;function fb(t,e,i){let n=t.getShaderParameter(e,35713),r=t.getShaderInfoLog(e).trim();if(n&&""===r)return"";let s=/ERROR: 0:(\d+)/.exec(r);if(s){let n=parseInt(s[1]);return i.toUpperCase()+"\n\n"+r+"\n\n"+function(t,e){let i=t.split("\n"),n=[],r=Math.max(e-6,0),s=Math.min(e+6,i.length);for(let a=r;a<s;a++){let t=a+1;n.push(`${t===e?">":" "} ${t}: ${i[a]}`)}return n.join("\n")}(t.getShaderSource(e),n)}return r}function mb(t,e){let i=function(t){switch(t){case gf:return["Linear","( value )"];case vf:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function gb(t,e){let i;switch(e){case 1:i="Linear";break;case 2:i="Reinhard";break;case 3:i="OptimizedCineon";break;case 4:i="ACESFilmic";break;case 5:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function vb(t){return""!==t}function yb(t,e){let i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function bb(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var xb=/^[ \t]*#include +<([\w\d./]+)>/gm;function wb(t){return t.replace(xb,Sb)}function Sb(t,e){let i=Pv[e];if(void 0===i)throw new Error("Can not resolve #include <"+e+">");return wb(i)}var Ab=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Eb(t){return t.replace(Ab,_b)}function _b(t,e,i,n){let r="";for(let s=parseInt(e);s<parseInt(i);s++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function Cb(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Mb(t,e,i,n){let r,s,a=t.getContext(),o=i.defines,l=i.vertexShader,h=i.fragmentShader,c=function(t){let e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(i),u=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case Op:case Lp:e="ENVMAP_TYPE_CUBE";break;case Bp:e="ENVMAP_TYPE_CUBE_UV"}return e}(i),d=function(t){let e="ENVMAP_MODE_REFLECTION";t.envMap&&t.envMapMode===Lp&&(e="ENVMAP_MODE_REFRACTION");return e}(i),p=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(i),f=function(t){let e=t.envMapCubeUVHeight;if(null===e)return null;let i=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:n,maxMip:i}}(i),m=i.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(vb).join("\n")}(i),g=function(t){let e=[];for(let i in t){let n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}(o),v=a.createProgram(),y=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(r=[g].filter(vb).join("\n"),r.length>0&&(r+="\n"),s=[m,g].filter(vb).join("\n"),s.length>0&&(s+="\n")):(r=[Cb(i),"#define SHADER_NAME "+i.shaderName,g,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+d:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+c:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(vb).join("\n"),s=[m,Cb(i),"#define SHADER_NAME "+i.shaderName,g,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.envMap?"#define "+d:"",i.envMap?"#define "+p:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+c:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==i.toneMapping?"#define TONE_MAPPING":"",0!==i.toneMapping?Pv.tonemapping_pars_fragment:"",0!==i.toneMapping?gb("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Pv.encodings_pars_fragment,mb("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(vb).join("\n")),l=wb(l),l=yb(l,i),l=bb(l,i),h=wb(h),h=yb(h,i),h=bb(h,i),l=Eb(l),h=Eb(h),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(y="#version 300 es\n",r=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+r,s=["#define varying in",i.glslVersion===Af?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===Af?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+s);let b,x,w=y+s+h,S=db(a,35633,y+r+l),A=db(a,35632,w);if(a.attachShader(v,S),a.attachShader(v,A),void 0!==i.index0AttributeName?a.bindAttribLocation(v,0,i.index0AttributeName):!0===i.morphTargets&&a.bindAttribLocation(v,0,"position"),a.linkProgram(v),t.debug.checkShaderErrors){let t=a.getProgramInfoLog(v).trim(),e=a.getShaderInfoLog(S).trim(),i=a.getShaderInfoLog(A).trim(),n=!0,o=!0;if(!1===a.getProgramParameter(v,35714)){n=!1;let e=fb(a,S,"vertex"),i=fb(a,A,"fragment");console.error("THREE.WebGLProgram: Shader Error "+a.getError()+" - VALIDATE_STATUS "+a.getProgramParameter(v,35715)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+i)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):(""===e||""===i)&&(o=!1);o&&(this.diagnostics={runnable:n,programLog:t,vertexShader:{log:e,prefix:r},fragmentShader:{log:i,prefix:s}})}return a.deleteShader(S),a.deleteShader(A),this.getUniforms=function(){return void 0===b&&(b=new ub(a,v)),b},this.getAttributes=function(){return void 0===x&&(x=function(t,e){let i={},n=t.getProgramParameter(e,35721);for(let r=0;r<n;r++){let n=t.getActiveAttrib(e,r),s=n.name,a=1;35674===n.type&&(a=2),35675===n.type&&(a=3),35676===n.type&&(a=4),i[s]={type:n.type,location:t.getAttribLocation(e,s),locationSize:a}}return i}(a,v)),x},this.destroy=function(){n.releaseStatesOfProgram(this),a.deleteProgram(v),this.program=void 0},this.name=i.shaderName,this.id=pb++,this.cacheKey=e,this.usedTimes=1,this.program=v,this.vertexShader=S,this.fragmentShader=A,this}var Pb=0,Tb=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){let e=t.vertexShader,i=t.fragmentShader,n=this._getShaderStage(e),r=this._getShaderStage(i),s=this._getShaderCacheForMaterial(t);return!1===s.has(n)&&(s.add(n),n.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(t){let e=this.materialCache.get(t);for(let i of e)i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){let e=this.materialCache,i=e.get(t);return void 0===i&&(i=new Set,e.set(t,i)),i}_getShaderStage(t){let e=this.shaderCache,i=e.get(t);return void 0===i&&(i=new Db(t),e.set(t,i)),i}},Db=class{constructor(t){this.id=Pb++,this.code=t,this.usedTimes=0}};function kb(t,e,i,n,r,s,a){let o=new ig,l=new Tb,h=[],c=r.isWebGL2,u=r.logarithmicDepthBuffer,d=r.vertexTextures,p=r.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(s,o,h,m,g){let v=m.fog,y=g.geometry,b=s.isMeshStandardMaterial?m.environment:null,x=(s.isMeshStandardMaterial?i:e).get(s.envMap||b),w=x&&x.mapping===Bp?x.image.height:null,S=f[s.type];null!==s.precision&&(p=r.getMaxPrecision(s.precision),p!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",p,"instead."));let A,E,_,C,M=y.morphAttributes.position||y.morphAttributes.normal||y.morphAttributes.color,P=void 0!==M?M.length:0,T=0;if(void 0!==y.morphAttributes.position&&(T=1),void 0!==y.morphAttributes.normal&&(T=2),void 0!==y.morphAttributes.color&&(T=3),S){let t=Dv[S];A=t.vertexShader,E=t.fragmentShader}else A=s.vertexShader,E=s.fragmentShader,l.update(s),_=l.getVertexShaderID(s),C=l.getFragmentShaderID(s);let D=t.getRenderTarget(),k=s.alphaTest>0,I=s.clearcoat>0,R=s.iridescence>0;return{isWebGL2:c,shaderID:S,shaderName:s.type,vertexShader:A,fragmentShader:E,defines:s.defines,customVertexShaderID:_,customFragmentShaderID:C,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:p,instancing:!0===g.isInstancedMesh,instancingColor:!0===g.isInstancedMesh&&null!==g.instanceColor,supportsVertexTextures:d,outputEncoding:null===D?t.outputEncoding:!0===D.isXRRenderTarget?D.texture.encoding:gf,map:!!s.map,matcap:!!s.matcap,envMap:!!x,envMapMode:x&&x.mapping,envMapCubeUVHeight:w,lightMap:!!s.lightMap,aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,objectSpaceNormalMap:1===s.normalMapType,tangentSpaceNormalMap:0===s.normalMapType,decodeVideoTexture:!!s.map&&!0===s.map.isVideoTexture&&s.map.encoding===vf,clearcoat:I,clearcoatMap:I&&!!s.clearcoatMap,clearcoatRoughnessMap:I&&!!s.clearcoatRoughnessMap,clearcoatNormalMap:I&&!!s.clearcoatNormalMap,iridescence:R,iridescenceMap:R&&!!s.iridescenceMap,iridescenceThicknessMap:R&&!!s.iridescenceThicknessMap,displacementMap:!!s.displacementMap,roughnessMap:!!s.roughnessMap,metalnessMap:!!s.metalnessMap,specularMap:!!s.specularMap,specularIntensityMap:!!s.specularIntensityMap,specularColorMap:!!s.specularColorMap,opaque:!1===s.transparent&&1===s.blending,alphaMap:!!s.alphaMap,alphaTest:k,gradientMap:!!s.gradientMap,sheen:s.sheen>0,sheenColorMap:!!s.sheenColorMap,sheenRoughnessMap:!!s.sheenRoughnessMap,transmission:s.transmission>0,transmissionMap:!!s.transmissionMap,thicknessMap:!!s.thicknessMap,combine:s.combine,vertexTangents:!!s.normalMap&&!!y.attributes.tangent,vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!y.attributes.color&&4===y.attributes.color.itemSize,vertexUvs:!!s.map||!!s.bumpMap||!!s.normalMap||!!s.specularMap||!!s.alphaMap||!!s.emissiveMap||!!s.roughnessMap||!!s.metalnessMap||!!s.clearcoatMap||!!s.clearcoatRoughnessMap||!!s.clearcoatNormalMap||!!s.iridescenceMap||!!s.iridescenceThicknessMap||!!s.displacementMap||!!s.transmissionMap||!!s.thicknessMap||!!s.specularIntensityMap||!!s.specularColorMap||!!s.sheenColorMap||!!s.sheenRoughnessMap,uvsVertexOnly:!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatNormalMap||s.iridescenceMap||s.iridescenceThicknessMap||s.transmission>0||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheen>0||s.sheenColorMap||s.sheenRoughnessMap)&&!!s.displacementMap,fog:!!v,useFog:!0===s.fog,fogExp2:v&&v.isFogExp2,flatShading:!!s.flatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:u,skinning:!0===g.isSkinnedMesh,morphTargets:void 0!==y.morphAttributes.position,morphNormals:void 0!==y.morphAttributes.normal,morphColors:void 0!==y.morphAttributes.color,morphTargetsCount:P,morphTextureStride:T,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&h.length>0,shadowMapType:t.shadowMap.type,toneMapping:s.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:1===s.side,useDepthPacking:!!s.depthPacking,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionDerivatives:s.extensions&&s.extensions.derivatives,extensionFragDepth:s.extensions&&s.extensions.fragDepth,extensionDrawBuffers:s.extensions&&s.extensions.drawBuffers,extensionShaderTextureLOD:s.extensions&&s.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||n.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(e){let i=[];if(e.shaderID?i.push(e.shaderID):(i.push(e.customVertexShaderID),i.push(e.customFragmentShaderID)),void 0!==e.defines)for(let t in e.defines)i.push(t),i.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(function(t,e){t.push(e.precision),t.push(e.outputEncoding),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.combine),t.push(e.vertexUvs),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numSpotLightMaps),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.numSpotLightShadowsWithMaps),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking)}(i,e),function(t,e){o.disableAll(),e.isWebGL2&&o.enable(0),e.supportsVertexTextures&&o.enable(1),e.instancing&&o.enable(2),e.instancingColor&&o.enable(3),e.map&&o.enable(4),e.matcap&&o.enable(5),e.envMap&&o.enable(6),e.lightMap&&o.enable(7),e.aoMap&&o.enable(8),e.emissiveMap&&o.enable(9),e.bumpMap&&o.enable(10),e.normalMap&&o.enable(11),e.objectSpaceNormalMap&&o.enable(12),e.tangentSpaceNormalMap&&o.enable(13),e.clearcoat&&o.enable(14),e.clearcoatMap&&o.enable(15),e.clearcoatRoughnessMap&&o.enable(16),e.clearcoatNormalMap&&o.enable(17),e.iridescence&&o.enable(18),e.iridescenceMap&&o.enable(19),e.iridescenceThicknessMap&&o.enable(20),e.displacementMap&&o.enable(21),e.specularMap&&o.enable(22),e.roughnessMap&&o.enable(23),e.metalnessMap&&o.enable(24),e.gradientMap&&o.enable(25),e.alphaMap&&o.enable(26),e.alphaTest&&o.enable(27),e.vertexColors&&o.enable(28),e.vertexAlphas&&o.enable(29),e.vertexUvs&&o.enable(30),e.vertexTangents&&o.enable(31),e.uvsVertexOnly&&o.enable(32),t.push(o.mask),o.disableAll(),e.fog&&o.enable(0),e.useFog&&o.enable(1),e.flatShading&&o.enable(2),e.logarithmicDepthBuffer&&o.enable(3),e.skinning&&o.enable(4),e.morphTargets&&o.enable(5),e.morphNormals&&o.enable(6),e.morphColors&&o.enable(7),e.premultipliedAlpha&&o.enable(8),e.shadowMapEnabled&&o.enable(9),e.physicallyCorrectLights&&o.enable(10),e.doubleSided&&o.enable(11),e.flipSided&&o.enable(12),e.useDepthPacking&&o.enable(13),e.dithering&&o.enable(14),e.specularIntensityMap&&o.enable(15),e.specularColorMap&&o.enable(16),e.transmission&&o.enable(17),e.transmissionMap&&o.enable(18),e.thicknessMap&&o.enable(19),e.sheen&&o.enable(20),e.sheenColorMap&&o.enable(21),e.sheenRoughnessMap&&o.enable(22),e.decodeVideoTexture&&o.enable(23),e.opaque&&o.enable(24),t.push(o.mask)}(i,e),i.push(t.outputEncoding)),i.push(e.customProgramCacheKey),i.join()},getUniforms:function(t){let e,i=f[t.type];if(i){let t=Dv[i];e=cv.clone(t.uniforms)}else e=t.uniforms;return e},acquireProgram:function(e,i){let n;for(let t=0,r=h.length;t<r;t++){let e=h[t];if(e.cacheKey===i){n=e,++n.usedTimes;break}}return void 0===n&&(n=new Mb(t,i,e,s),h.push(n)),n},releaseProgram:function(t){if(0===--t.usedTimes){let e=h.indexOf(t);h[e]=h[h.length-1],h.pop(),t.destroy()}},releaseShaderCache:function(t){l.remove(t)},programs:h,dispose:function(){l.dispose()}}}function Ib(){let t=new WeakMap;return{get:function(e){let i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i},remove:function(e){t.delete(e)},update:function(e,i,n){t.get(e)[i]=n},dispose:function(){t=new WeakMap}}}function Rb(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Ob(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Lb(){let t=[],e=0,i=[],n=[],r=[];function s(i,n,r,s,a,o){let l=t[e];return void 0===l?(l={id:i.id,object:i,geometry:n,material:r,groupOrder:s,renderOrder:i.renderOrder,z:a,group:o},t[e]=l):(l.id=i.id,l.object=i,l.geometry=n,l.material=r,l.groupOrder=s,l.renderOrder=i.renderOrder,l.z=a,l.group=o),e++,l}return{opaque:i,transmissive:n,transparent:r,init:function(){e=0,i.length=0,n.length=0,r.length=0},push:function(t,e,a,o,l,h){let c=s(t,e,a,o,l,h);a.transmission>0?n.push(c):!0===a.transparent?r.push(c):i.push(c)},unshift:function(t,e,a,o,l,h){let c=s(t,e,a,o,l,h);a.transmission>0?n.unshift(c):!0===a.transparent?r.unshift(c):i.unshift(c)},finish:function(){for(let i=e,n=t.length;i<n;i++){let e=t[i];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){i.length>1&&i.sort(t||Rb),n.length>1&&n.sort(e||Ob),r.length>1&&r.sort(e||Ob)}}}function Bb(){let t=new WeakMap;return{get:function(e,i){let n,r=t.get(e);return void 0===r?(n=new Lb,t.set(e,[n])):i>=r.length?(n=new Lb,r.push(n)):n=r[i],n},dispose:function(){t=new WeakMap}}}function zb(){let t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new mm,color:new nm};break;case"SpotLight":i={position:new mm,direction:new mm,color:new nm,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new mm,color:new nm,distance:0,decay:0};break;case"HemisphereLight":i={direction:new mm,skyColor:new nm,groundColor:new nm};break;case"RectAreaLight":i={color:new nm,position:new mm,halfWidth:new mm,halfHeight:new mm}}return t[e.id]=i,i}}}var Fb=0;function Nb(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function Ub(t,e){let i=new zb,n=function(){let t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Uf};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Uf,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=i,i}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let l=0;l<9;l++)r.probe.push(new mm);let s=new mm,a=new Wm,o=new Wm;return{setup:function(s,a){let o=0,l=0,h=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let c=0,u=0,d=0,p=0,f=0,m=0,g=0,v=0,y=0,b=0;s.sort(Nb);let x=!0!==a?Math.PI:1;for(let t=0,e=s.length;t<e;t++){let e=s[t],a=e.color,w=e.intensity,S=e.distance,A=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)o+=a.r*w*x,l+=a.g*w*x,h+=a.b*w*x;else if(e.isLightProbe)for(let t=0;t<9;t++)r.probe[t].addScaledVector(e.sh.coefficients[t],w);else if(e.isDirectionalLight){let t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*x),e.castShadow){let t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.directionalShadow[c]=i,r.directionalShadowMap[c]=A,r.directionalShadowMatrix[c]=e.shadow.matrix,m++}r.directional[c]=t,c++}else if(e.isSpotLight){let t=i.get(e);t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(a).multiplyScalar(w*x),t.distance=S,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,r.spot[d]=t;let s=e.shadow;if(e.map&&(r.spotLightMap[y]=e.map,y++,s.updateMatrices(e),e.castShadow&&b++),r.spotLightMatrix[d]=s.matrix,e.castShadow){let t=n.get(e);t.shadowBias=s.bias,t.shadowNormalBias=s.normalBias,t.shadowRadius=s.radius,t.shadowMapSize=s.mapSize,r.spotShadow[d]=t,r.spotShadowMap[d]=A,v++}d++}else if(e.isRectAreaLight){let t=i.get(e);t.color.copy(a).multiplyScalar(w),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),r.rectArea[p]=t,p++}else if(e.isPointLight){let t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*x),t.distance=e.distance,t.decay=e.decay,e.castShadow){let t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,i.shadowCameraNear=t.camera.near,i.shadowCameraFar=t.camera.far,r.pointShadow[u]=i,r.pointShadowMap[u]=A,r.pointShadowMatrix[u]=e.shadow.matrix,g++}r.point[u]=t,u++}else if(e.isHemisphereLight){let t=i.get(e);t.skyColor.copy(e.color).multiplyScalar(w*x),t.groundColor.copy(e.groundColor).multiplyScalar(w*x),r.hemi[f]=t,f++}}p>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=Tv.LTC_FLOAT_1,r.rectAreaLTC2=Tv.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Tv.LTC_HALF_1,r.rectAreaLTC2=Tv.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=o,r.ambient[1]=l,r.ambient[2]=h;let w=r.hash;(w.directionalLength!==c||w.pointLength!==u||w.spotLength!==d||w.rectAreaLength!==p||w.hemiLength!==f||w.numDirectionalShadows!==m||w.numPointShadows!==g||w.numSpotShadows!==v||w.numSpotMaps!==y)&&(r.directional.length=c,r.spot.length=d,r.rectArea.length=p,r.point.length=u,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=v,r.spotShadowMap.length=v,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotLightMatrix.length=v+y-b,r.spotLightMap.length=y,r.numSpotLightShadowsWithMaps=b,w.directionalLength=c,w.pointLength=u,w.spotLength=d,w.rectAreaLength=p,w.hemiLength=f,w.numDirectionalShadows=m,w.numPointShadows=g,w.numSpotShadows=v,w.numSpotMaps=y,r.version=Fb++)},setupView:function(t,e){let i=0,n=0,l=0,h=0,c=0,u=e.matrixWorldInverse;for(let d=0,p=t.length;d<p;d++){let e=t[d];if(e.isDirectionalLight){let t=r.directional[i];t.direction.setFromMatrixPosition(e.matrixWorld),s.setFromMatrixPosition(e.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),i++}else if(e.isSpotLight){let t=r.spot[l];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(u),t.direction.setFromMatrixPosition(e.matrixWorld),s.setFromMatrixPosition(e.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),l++}else if(e.isRectAreaLight){let t=r.rectArea[h];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(u),o.identity(),a.copy(e.matrixWorld),a.premultiply(u),o.extractRotation(a),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),t.halfWidth.applyMatrix4(o),t.halfHeight.applyMatrix4(o),h++}else if(e.isPointLight){let t=r.point[n];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(u),n++}else if(e.isHemisphereLight){let t=r.hemi[c];t.direction.setFromMatrixPosition(e.matrixWorld),t.direction.transformDirection(u),c++}}},state:r}}function Vb(t,e){let i=new Ub(t,e),n=[],r=[];return{init:function(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:function(t){i.setup(n,t)},setupLightsView:function(t){i.setupView(n,t)},pushLight:function(t){n.push(t)},pushShadow:function(t){r.push(t)}}}function jb(t,e){let i=new WeakMap;return{get:function(n){let r,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=i.get(n);return void 0===a?(r=new Vb(t,e),i.set(n,[r])):s>=a.length?(r=new Vb(t,e),a.push(r)):r=a[s],r},dispose:function(){i=new WeakMap}}}var Gb=class extends Tg{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=yf,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}},Hb=class extends Tg{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new mm,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}};function Wb(t,e,i){let n=new Ev,r=new Uf,s=new Uf,a=new cm,o=new Gb({depthPacking:3201}),l=new Hb,h={},c=i.maxTextureSize,u={[vp]:1,[yp]:0,[bp]:2},d=new uv({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Uf},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;let f=new Hg;f.setAttribute("position",new Rg(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let m=new rv(f,d),g=this;function v(i,n){let s=e.update(m);d.defines.VSM_SAMPLES!==i.blurSamples&&(d.defines.VSM_SAMPLES=i.blurSamples,p.defines.VSM_SAMPLES=i.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===i.mapPass&&(i.mapPass=new um(r.x,r.y)),d.uniforms.shadow_pass.value=i.map.texture,d.uniforms.resolution.value=i.mapSize,d.uniforms.radius.value=i.radius,t.setRenderTarget(i.mapPass),t.clear(),t.renderBufferDirect(n,null,s,d,m,null),p.uniforms.shadow_pass.value=i.mapPass.texture,p.uniforms.resolution.value=i.mapSize,p.uniforms.radius.value=i.radius,t.setRenderTarget(i.map),t.clear(),t.renderBufferDirect(n,null,s,p,m,null)}function y(e,i,n,r,s,a){let c=null,d=!0===n.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(void 0!==d)c=d;else if(c=!0===n.isPointLight?l:o,t.localClippingEnabled&&!0===i.clipShadows&&Array.isArray(i.clippingPlanes)&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0||i.map&&i.alphaTest>0){let t=c.uuid,e=i.uuid,n=h[t];void 0===n&&(n={},h[t]=n);let r=n[e];void 0===r&&(r=c.clone(),n[e]=r),c=r}return c.visible=i.visible,c.wireframe=i.wireframe,c.side=3===a?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:u[i.side],c.alphaMap=i.alphaMap,c.alphaTest=i.alphaTest,c.map=i.map,c.clipShadows=i.clipShadows,c.clippingPlanes=i.clippingPlanes,c.clipIntersection=i.clipIntersection,c.displacementMap=i.displacementMap,c.displacementScale=i.displacementScale,c.displacementBias=i.displacementBias,c.wireframeLinewidth=i.wireframeLinewidth,c.linewidth=i.linewidth,!0===n.isPointLight&&!0===c.isMeshDistanceMaterial&&(c.referencePosition.setFromMatrixPosition(n.matrixWorld),c.nearDistance=r,c.farDistance=s),c}function b(i,r,s,a,o){if(!1===i.visible)return;if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&3===o)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,i.matrixWorld);let n=e.update(i),r=i.material;if(Array.isArray(r)){let e=n.groups;for(let l=0,h=e.length;l<h;l++){let h=e[l],c=r[h.materialIndex];if(c&&c.visible){let e=y(i,c,a,s.near,s.far,o);t.renderBufferDirect(s,null,n,e,i,h)}}}else if(r.visible){let e=y(i,r,a,s.near,s.far,o);t.renderBufferDirect(s,null,n,e,i,null)}}let l=i.children;for(let t=0,e=l.length;t<e;t++)b(l[t],r,s,a,o)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,i,o){if(!1===g.enabled||!1===g.autoUpdate&&!1===g.needsUpdate||0===e.length)return;let l=t.getRenderTarget(),h=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),d=t.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let p=0,f=e.length;p<f;p++){let l=e[p],h=l.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;r.copy(h.mapSize);let u=h.getFrameExtents();if(r.multiply(u),s.copy(h.mapSize),(r.x>c||r.y>c)&&(r.x>c&&(s.x=Math.floor(c/u.x),r.x=s.x*u.x,h.mapSize.x=s.x),r.y>c&&(s.y=Math.floor(c/u.y),r.y=s.y*u.y,h.mapSize.y=s.y)),null===h.map){let t=3!==this.type?{minFilter:Up,magFilter:Up}:{};h.map=new um(r.x,r.y,t),h.map.texture.name=l.name+".shadowMap",h.camera.updateProjectionMatrix()}t.setRenderTarget(h.map),t.clear();let f=h.getViewportCount();for(let t=0;t<f;t++){let e=h.getViewport(t);a.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),d.viewport(a),h.updateMatrices(l,t),n=h.getFrustum(),b(i,o,h.camera,l,this.type)}!0!==h.isPointLightShadow&&3===this.type&&v(h,o),h.needsUpdate=!1}g.needsUpdate=!1,t.setRenderTarget(l,h,u)}}function qb(t,e,i){let n=i.isWebGL2;let r=new function(){let e=!1,i=new cm,n=null,r=new cm(0,0,0,0);return{setMask:function(i){n!==i&&!e&&(t.colorMask(i,i,i,i),n=i)},setLocked:function(t){e=t},setClear:function(e,n,s,a,o){!0===o&&(e*=a,n*=a,s*=a),i.set(e,n,s,a),!1===r.equals(i)&&(t.clearColor(e,n,s,a),r.copy(i))},reset:function(){e=!1,n=null,r.set(-1,0,0,0)}}},s=new function(){let e=!1,i=null,n=null,r=null;return{setTest:function(t){t?U(2929):V(2929)},setMask:function(n){i!==n&&!e&&(t.depthMask(n),i=n)},setFunc:function(e){if(n!==e){switch(e){case 0:t.depthFunc(512);break;case 1:t.depthFunc(519);break;case 2:t.depthFunc(513);break;case 3:default:t.depthFunc(515);break;case 4:t.depthFunc(514);break;case 5:t.depthFunc(518);break;case 6:t.depthFunc(516);break;case 7:t.depthFunc(517)}n=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,i=null,n=null,r=null}}},a=new function(){let e=!1,i=null,n=null,r=null,s=null,a=null,o=null,l=null,h=null;return{setTest:function(t){e||(t?U(2960):V(2960))},setMask:function(n){i!==n&&!e&&(t.stencilMask(n),i=n)},setFunc:function(e,i,a){(n!==e||r!==i||s!==a)&&(t.stencilFunc(e,i,a),n=e,r=i,s=a)},setOp:function(e,i,n){(a!==e||o!==i||l!==n)&&(t.stencilOp(e,i,n),a=e,o=i,l=n)},setLocked:function(t){e=t},setClear:function(e){h!==e&&(t.clearStencil(e),h=e)},reset:function(){e=!1,i=null,n=null,r=null,s=null,a=null,o=null,l=null,h=null}}},o=new WeakMap,l=new WeakMap,h={},c={},u=new WeakMap,d=[],p=null,f=!1,m=null,g=null,v=null,y=null,b=null,x=null,w=null,S=!1,A=null,E=null,_=null,C=null,M=null,P=t.getParameter(35661),T=!1,D=0,k=t.getParameter(7938);-1!==k.indexOf("WebGL")?(D=parseFloat(/^WebGL (\d)/.exec(k)[1]),T=D>=1):-1!==k.indexOf("OpenGL ES")&&(D=parseFloat(/^OpenGL ES (\d)/.exec(k)[1]),T=D>=2);let I=null,R={},O=t.getParameter(3088),L=t.getParameter(2978),B=(new cm).fromArray(O),z=(new cm).fromArray(L);function F(e,i,n){let r=new Uint8Array(4),s=t.createTexture();t.bindTexture(e,s),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let a=0;a<n;a++)t.texImage2D(i+a,0,6408,1,1,0,6408,5121,r);return s}let N={};function U(e){!0!==h[e]&&(t.enable(e),h[e]=!0)}function V(e){!1!==h[e]&&(t.disable(e),h[e]=!1)}N[3553]=F(3553,3553,1),N[34067]=F(34067,34069,6),r.setClear(0,0,0,1),s.setClear(1),a.setClear(0),U(2929),s.setFunc(3),W(!1),q(1),U(2884),H(0);let j={[xp]:32774,[wp]:32778,[Sp]:32779};if(n)j[103]=32775,j[104]=32776;else{let t=e.get("EXT_blend_minmax");null!==t&&(j[103]=t.MIN_EXT,j[104]=t.MAX_EXT)}let G={[Ap]:0,[Ep]:1,[_p]:768,[Mp]:770,[Rp]:776,[kp]:774,[Tp]:772,[Cp]:769,[Pp]:771,[Ip]:775,[Dp]:773};function H(e,i,n,r,s,a,o,l){if(0!==e){if(!1===f&&(U(3042),f=!0),5===e)s=s||i,a=a||n,o=o||r,(i!==g||s!==b)&&(t.blendEquationSeparate(j[i],j[s]),g=i,b=s),(n!==v||r!==y||a!==x||o!==w)&&(t.blendFuncSeparate(G[n],G[r],G[a],G[o]),v=n,y=r,x=a,w=o),m=e,S=!1;else if(e!==m||l!==S){if((g!==xp||b!==xp)&&(t.blendEquation(32774),g=xp,b=xp),l)switch(e){case 1:t.blendFuncSeparate(1,771,1,771);break;case 2:t.blendFunc(1,1);break;case 3:t.blendFuncSeparate(0,769,0,1);break;case 4:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(770,771,1,771);break;case 2:t.blendFunc(770,1);break;case 3:t.blendFuncSeparate(0,769,0,1);break;case 4:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}v=null,y=null,x=null,w=null,m=e,S=l}}else!0===f&&(V(3042),f=!1)}function W(e){A!==e&&(e?t.frontFace(2304):t.frontFace(2305),A=e)}function q(e){0!==e?(U(2884),e!==E&&(1===e?t.cullFace(1029):2===e?t.cullFace(1028):t.cullFace(1032))):V(2884),E=e}function Y(e,i,n){e?(U(32823),(C!==i||M!==n)&&(t.polygonOffset(i,n),C=i,M=n)):V(32823)}return{buffers:{color:r,depth:s,stencil:a},enable:U,disable:V,bindFramebuffer:function(e,i){return c[e]!==i&&(t.bindFramebuffer(e,i),c[e]=i,n&&(36009===e&&(c[36160]=i),36160===e&&(c[36009]=i)),!0)},drawBuffers:function(n,r){let s=d,a=!1;if(n)if(s=u.get(r),void 0===s&&(s=[],u.set(r,s)),n.isWebGLMultipleRenderTargets){let t=n.texture;if(s.length!==t.length||36064!==s[0]){for(let e=0,i=t.length;e<i;e++)s[e]=36064+e;s.length=t.length,a=!0}}else 36064!==s[0]&&(s[0]=36064,a=!0);else 1029!==s[0]&&(s[0]=1029,a=!0);a&&(i.isWebGL2?t.drawBuffers(s):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(e){return p!==e&&(t.useProgram(e),p=e,!0)},setBlending:H,setMaterial:function(t,e){2===t.side?V(2884):U(2884);let i=1===t.side;e&&(i=!i),W(i),1===t.blending&&!1===t.transparent?H(0):H(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),s.setFunc(t.depthFunc),s.setTest(t.depthTest),s.setMask(t.depthWrite),r.setMask(t.colorWrite);let n=t.stencilWrite;a.setTest(n),n&&(a.setMask(t.stencilWriteMask),a.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),a.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),Y(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?U(32926):V(32926)},setFlipSided:W,setCullFace:q,setLineWidth:function(e){e!==_&&(T&&t.lineWidth(e),_=e)},setPolygonOffset:Y,setScissorTest:function(t){t?U(3089):V(3089)},activeTexture:function(e){void 0===e&&(e=33984+P-1),I!==e&&(t.activeTexture(e),I=e)},bindTexture:function(e,i,n){void 0===n&&(n=null===I?33984+P-1:I);let r=R[n];void 0===r&&(r={type:void 0,texture:void 0},R[n]=r),(r.type!==e||r.texture!==i)&&(I!==n&&(t.activeTexture(n),I=n),t.bindTexture(e,i||N[e]),r.type=e,r.texture=i)},unbindTexture:function(){let e=R[I];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(Y2){console.error("THREE.WebGLState:",Y2)}},compressedTexImage3D:function(){try{t.compressedTexImage3D.apply(t,arguments)}catch(Y2){console.error("THREE.WebGLState:",Y2)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(Y2){console.error("THREE.WebGLState:",Y2)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(Y2){console.error("THREE.WebGLState:",Y2)}},updateUBOMapping:function(e,i){let n=l.get(i);void 0===n&&(n=new WeakMap,l.set(i,n));let r=n.get(e);void 0===r&&(r=t.getUniformBlockIndex(i,e.name),n.set(e,r))},uniformBlockBinding:function(e,i){let n=l.get(i).get(e);o.get(i)!==n&&(t.uniformBlockBinding(i,n,e.__bindingPointIndex),o.set(i,n))},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(Y2){console.error("THREE.WebGLState:",Y2)}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(Y2){console.error("THREE.WebGLState:",Y2)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(Y2){console.error("THREE.WebGLState:",Y2)}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(Y2){console.error("THREE.WebGLState:",Y2)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(Y2){console.error("THREE.WebGLState:",Y2)}},compressedTexSubImage3D:function(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(Y2){console.error("THREE.WebGLState:",Y2)}},scissor:function(e){!1===B.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),B.copy(e))},viewport:function(e){!1===z.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),z.copy(e))},reset:function(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),!0===n&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),h={},I=null,R={},c={},u=new WeakMap,d=[],p=null,f=!1,m=null,g=null,v=null,y=null,b=null,x=null,w=null,S=!1,A=null,E=null,_=null,C=null,M=null,B.set(0,0,t.canvas.width,t.canvas.height),z.set(0,0,t.canvas.width,t.canvas.height),r.reset(),s.reset(),a.reset()}}}function Yb(t,e,i,n,r,s,a){let o,l=r.isWebGL2,h=r.maxTextures,c=r.maxCubemapSize,u=r.maxTextureSize,d=r.maxSamples,p=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,f=!(typeof navigator>"u")&&/OculusBrowser/g.test(navigator.userAgent),m=new WeakMap,g=new WeakMap,v=!1;try{v=typeof OffscreenCanvas<"u"&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch{}function y(t,e){return v?new OffscreenCanvas(t,e):qf("canvas")}function b(t,e,i,n){let r=1;if((t.width>n||t.height>n)&&(r=n/Math.max(t.width,t.height)),r<1||!0===e){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){let n=e?Bf:Math.floor,s=n(r*t.width),a=n(r*t.height);void 0===o&&(o=y(s,a));let l=i?y(s,a):o;return l.width=s,l.height=a,l.getContext("2d").drawImage(t,0,0,s,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+s+"x"+a+")."),l}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function x(t){return Of(t.width)&&Of(t.height)}function w(t,e){return t.generateMipmaps&&e&&t.minFilter!==Up&&t.minFilter!==Gp}function S(e){t.generateMipmap(e)}function A(i,n,r,s){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!1===l)return n;if(null!==i){if(void 0!==t[i])return t[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let o=n;return 6403===n&&(5126===r&&(o=33326),5131===r&&(o=33325),5121===r&&(o=33321)),33319===n&&(5126===r&&(o=33328),5131===r&&(o=33327),5121===r&&(o=33323)),6408===n&&(5126===r&&(o=34836),5131===r&&(o=34842),5121===r&&(o=s===vf&&!1===a?35907:32856),32819===r&&(o=32854),32820===r&&(o=32855)),(33325===o||33326===o||33327===o||33328===o||34842===o||34836===o)&&e.get("EXT_color_buffer_float"),o}function E(t,e,i){return!0===w(t,i)||t.isFramebufferTexture&&t.minFilter!==Up&&t.minFilter!==Gp?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function _(t){return t===Up||1004===t||t===jp?9728:9729}function C(t){let e=t.target;e.removeEventListener("dispose",C),function(t){let e=n.get(t);if(void 0===e.__webglInit)return;let i=t.source,r=g.get(i);if(r){let n=r[e.__cacheKey];n.usedTimes--,0===n.usedTimes&&P(t),0===Object.keys(r).length&&g.delete(i)}n.remove(t)}(e),e.isVideoTexture&&m.delete(e)}function M(e){let i=e.target;i.removeEventListener("dispose",M),function(e){let i=e.texture,r=n.get(e),s=n.get(i);if(void 0!==s.__webglTexture&&(t.deleteTexture(s.__webglTexture),a.memory.textures--),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(let n=0;n<6;n++)t.deleteFramebuffer(r.__webglFramebuffer[n]),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[n]);else{if(t.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&t.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(let e=0;e<r.__webglColorRenderbuffer.length;e++)r.__webglColorRenderbuffer[e]&&t.deleteRenderbuffer(r.__webglColorRenderbuffer[e]);r.__webglDepthRenderbuffer&&t.deleteRenderbuffer(r.__webglDepthRenderbuffer)}if(e.isWebGLMultipleRenderTargets)for(let o=0,l=i.length;o<l;o++){let e=n.get(i[o]);e.__webglTexture&&(t.deleteTexture(e.__webglTexture),a.memory.textures--),n.remove(i[o])}n.remove(i),n.remove(e)}(i)}function P(e){let i=n.get(e);t.deleteTexture(i.__webglTexture);let r=e.source;delete g.get(r)[i.__cacheKey],a.memory.textures--}let T=0;function D(t,e){let r=n.get(t);if(t.isVideoTexture&&function(t){let e=a.render.frame;m.get(t)!==e&&(m.set(t,e),t.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&r.__version!==t.version){let i=t.image;if(null===i)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==i.complete)return void L(r,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.bindTexture(3553,r.__webglTexture,33984+e)}let k={[zp]:10497,[Fp]:33071,[Np]:33648},I={[Up]:9728,[Vp]:9984,[jp]:9986,[Gp]:9729,[Hp]:9985,[Wp]:9987};function R(i,s,a){if(a?(t.texParameteri(i,10242,k[s.wrapS]),t.texParameteri(i,10243,k[s.wrapT]),(32879===i||35866===i)&&t.texParameteri(i,32882,k[s.wrapR]),t.texParameteri(i,10240,I[s.magFilter]),t.texParameteri(i,10241,I[s.minFilter])):(t.texParameteri(i,10242,33071),t.texParameteri(i,10243,33071),(32879===i||35866===i)&&t.texParameteri(i,32882,33071),(s.wrapS!==Fp||s.wrapT!==Fp)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(i,10240,_(s.magFilter)),t.texParameteri(i,10241,_(s.minFilter)),s.minFilter!==Up&&s.minFilter!==Gp&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){let a=e.get("EXT_texture_filter_anisotropic");if(s.magFilter===Up||s.minFilter!==jp&&s.minFilter!==Wp||s.type===Xp&&!1===e.has("OES_texture_float_linear")||!1===l&&s.type===Qp&&!1===e.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||n.get(s).__currentAnisotropy)&&(t.texParameterf(i,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy)}}function O(e,i){let n=!1;void 0===e.__webglInit&&(e.__webglInit=!0,i.addEventListener("dispose",C));let r=i.source,s=g.get(r);void 0===s&&(s={},g.set(r,s));let o=function(t){let e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.wrapR||0),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.encoding),e.join()}(i);if(o!==e.__cacheKey){void 0===s[o]&&(s[o]={texture:t.createTexture(),usedTimes:0},a.memory.textures++,n=!0),s[o].usedTimes++;let r=s[e.__cacheKey];void 0!==r&&(s[e.__cacheKey].usedTimes--,0===r.usedTimes&&P(i)),e.__cacheKey=o,e.__webglTexture=s[o].texture}return n}function L(e,r,a){let o=3553;(r.isDataArrayTexture||r.isCompressedArrayTexture)&&(o=35866),r.isData3DTexture&&(o=32879);let h=O(e,r),c=r.source;i.bindTexture(o,e.__webglTexture,33984+a);let d=n.get(c);if(c.version!==d.__version||!0===h){i.activeTexture(33984+a),t.pixelStorei(37440,r.flipY),t.pixelStorei(37441,r.premultiplyAlpha),t.pixelStorei(3317,r.unpackAlignment),t.pixelStorei(37443,0);let e=function(t){return!l&&(t.wrapS!==Fp||t.wrapT!==Fp||t.minFilter!==Up&&t.minFilter!==Gp)}(r)&&!1===x(r.image),n=b(r.image,e,!1,u);n=V(r,n);let p=x(n)||l,f=s.convert(r.format,r.encoding),m=s.convert(r.type),g=A(r.internalFormat,f,m,r.encoding,r.isVideoTexture);R(o,r,p);let v,y=r.mipmaps,_=l&&!0!==r.isVideoTexture,C=void 0===d.__version||!0===h,M=E(r,n,p);if(r.isDepthTexture)g=6402,l?g=r.type===Xp?36012:r.type===Yp?33190:r.type===Kp?35056:33189:r.type===Xp&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===Jp&&6402===g&&1012!==r.type&&r.type!==Yp&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=Yp,m=s.convert(r.type)),r.format===$p&&6402===g&&(g=34041,r.type!==Kp&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=Kp,m=s.convert(r.type))),C&&(_?i.texStorage2D(3553,1,g,n.width,n.height):i.texImage2D(3553,0,g,n.width,n.height,0,f,m,null));else if(r.isDataTexture)if(y.length>0&&p){_&&C&&i.texStorage2D(3553,M,g,y[0].width,y[0].height);for(let t=0,e=y.length;t<e;t++)v=y[t],_?i.texSubImage2D(3553,t,0,0,v.width,v.height,f,m,v.data):i.texImage2D(3553,t,g,v.width,v.height,0,f,m,v.data);r.generateMipmaps=!1}else _?(C&&i.texStorage2D(3553,M,g,n.width,n.height),i.texSubImage2D(3553,0,0,0,n.width,n.height,f,m,n.data)):i.texImage2D(3553,0,g,n.width,n.height,0,f,m,n.data);else if(r.isCompressedTexture)if(r.isCompressedArrayTexture){_&&C&&i.texStorage3D(35866,M,g,y[0].width,y[0].height,n.depth);for(let t=0,e=y.length;t<e;t++)v=y[t],r.format!==Zp?null!==f?_?i.compressedTexSubImage3D(35866,t,0,0,0,v.width,v.height,n.depth,f,v.data,0,0):i.compressedTexImage3D(35866,t,g,v.width,v.height,n.depth,0,v.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):_?i.texSubImage3D(35866,t,0,0,0,v.width,v.height,n.depth,f,m,v.data):i.texImage3D(35866,t,g,v.width,v.height,n.depth,0,f,m,v.data)}else{_&&C&&i.texStorage2D(3553,M,g,y[0].width,y[0].height);for(let t=0,e=y.length;t<e;t++)v=y[t],r.format!==Zp?null!==f?_?i.compressedTexSubImage2D(3553,t,0,0,v.width,v.height,f,v.data):i.compressedTexImage2D(3553,t,g,v.width,v.height,0,v.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):_?i.texSubImage2D(3553,t,0,0,v.width,v.height,f,m,v.data):i.texImage2D(3553,t,g,v.width,v.height,0,f,m,v.data)}else if(r.isDataArrayTexture)_?(C&&i.texStorage3D(35866,M,g,n.width,n.height,n.depth),i.texSubImage3D(35866,0,0,0,0,n.width,n.height,n.depth,f,m,n.data)):i.texImage3D(35866,0,g,n.width,n.height,n.depth,0,f,m,n.data);else if(r.isData3DTexture)_?(C&&i.texStorage3D(32879,M,g,n.width,n.height,n.depth),i.texSubImage3D(32879,0,0,0,0,n.width,n.height,n.depth,f,m,n.data)):i.texImage3D(32879,0,g,n.width,n.height,n.depth,0,f,m,n.data);else if(r.isFramebufferTexture){if(C)if(_)i.texStorage2D(3553,M,g,n.width,n.height);else{let t=n.width,e=n.height;for(let n=0;n<M;n++)i.texImage2D(3553,n,g,t,e,0,f,m,null),t>>=1,e>>=1}}else if(y.length>0&&p){_&&C&&i.texStorage2D(3553,M,g,y[0].width,y[0].height);for(let t=0,e=y.length;t<e;t++)v=y[t],_?i.texSubImage2D(3553,t,0,0,f,m,v):i.texImage2D(3553,t,g,f,m,v);r.generateMipmaps=!1}else _?(C&&i.texStorage2D(3553,M,g,n.width,n.height),i.texSubImage2D(3553,0,0,0,f,m,n)):i.texImage2D(3553,0,g,f,m,n);w(r,p)&&S(o),d.__version=c.version,r.onUpdate&&r.onUpdate(r)}e.__version=r.version}function B(e,r,a,o,l){let h=s.convert(a.format,a.encoding),c=s.convert(a.type),u=A(a.internalFormat,h,c,a.encoding);n.get(r).__hasExternalTextures||(32879===l||35866===l?i.texImage3D(l,0,u,r.width,r.height,r.depth,0,h,c,null):i.texImage2D(l,0,u,r.width,r.height,0,h,c,null)),i.bindFramebuffer(36160,e),U(r)?p.framebufferTexture2DMultisampleEXT(36160,o,l,n.get(a).__webglTexture,0,N(r)):(3553===l||l>=34069&&l<=34074)&&t.framebufferTexture2D(36160,o,l,n.get(a).__webglTexture,0),i.bindFramebuffer(36160,null)}function z(e,i,n){if(t.bindRenderbuffer(36161,e),i.depthBuffer&&!i.stencilBuffer){let r=33189;if(n||U(i)){let e=i.depthTexture;e&&e.isDepthTexture&&(e.type===Xp?r=36012:e.type===Yp&&(r=33190));let n=N(i);U(i)?p.renderbufferStorageMultisampleEXT(36161,n,r,i.width,i.height):t.renderbufferStorageMultisample(36161,n,r,i.width,i.height)}else t.renderbufferStorage(36161,r,i.width,i.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(i.depthBuffer&&i.stencilBuffer){let r=N(i);n&&!1===U(i)?t.renderbufferStorageMultisample(36161,r,35056,i.width,i.height):U(i)?p.renderbufferStorageMultisampleEXT(36161,r,35056,i.width,i.height):t.renderbufferStorage(36161,34041,i.width,i.height),t.framebufferRenderbuffer(36160,33306,36161,e)}else{let e=!0===i.isWebGLMultipleRenderTargets?i.texture:[i.texture];for(let r=0;r<e.length;r++){let a=e[r],o=s.convert(a.format,a.encoding),l=s.convert(a.type),h=A(a.internalFormat,o,l,a.encoding),c=N(i);n&&!1===U(i)?t.renderbufferStorageMultisample(36161,c,h,i.width,i.height):U(i)?p.renderbufferStorageMultisampleEXT(36161,c,h,i.width,i.height):t.renderbufferStorage(36161,h,i.width,i.height)}}t.bindRenderbuffer(36161,null)}function F(e){let r=n.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(r.depthTexture).__webglTexture||r.depthTexture.image.width!==r.width||r.depthTexture.image.height!==r.height)&&(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),D(r.depthTexture,0);let s=n.get(r.depthTexture).__webglTexture,a=N(r);if(r.depthTexture.format===Jp)U(r)?p.framebufferTexture2DMultisampleEXT(36160,36096,3553,s,0,a):t.framebufferTexture2D(36160,36096,3553,s,0);else{if(r.depthTexture.format!==$p)throw new Error("Unknown depthTexture format");U(r)?p.framebufferTexture2DMultisampleEXT(36160,33306,3553,s,0,a):t.framebufferTexture2D(36160,33306,3553,s,0)}}(r.__webglFramebuffer,e)}else if(s){r.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(36160,r.__webglFramebuffer[n]),r.__webglDepthbuffer[n]=t.createRenderbuffer(),z(r.__webglDepthbuffer[n],e,!1)}else i.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),z(r.__webglDepthbuffer,e,!1);i.bindFramebuffer(36160,null)}function N(t){return Math.min(d,t.samples)}function U(t){let i=n.get(t);return l&&t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==i.__useRenderToTexture}function V(t,i){let n=t.encoding,r=t.format,s=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||t.format===Ef||n!==gf&&(n===vf?!1===l?!0===e.has("EXT_sRGB")&&r===Zp?(t.format=Ef,t.minFilter=Gp,t.generateMipmaps=!1):i=sm.sRGBToLinear(i):(r!==Zp||s!==qp)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",n)),i}this.allocateTextureUnit=function(){let t=T;return t>=h&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+h),T+=1,t},this.resetTextureUnits=function(){T=0},this.setTexture2D=D,this.setTexture2DArray=function(t,e){let r=n.get(t);t.version>0&&r.__version!==t.version?L(r,t,e):i.bindTexture(35866,r.__webglTexture,33984+e)},this.setTexture3D=function(t,e){let r=n.get(t);t.version>0&&r.__version!==t.version?L(r,t,e):i.bindTexture(32879,r.__webglTexture,33984+e)},this.setTextureCube=function(e,r){let a=n.get(e);e.version>0&&a.__version!==e.version?function(e,r,a){if(6!==r.image.length)return;let o=O(e,r),h=r.source;i.bindTexture(34067,e.__webglTexture,33984+a);let u=n.get(h);if(h.version!==u.__version||!0===o){i.activeTexture(33984+a),t.pixelStorei(37440,r.flipY),t.pixelStorei(37441,r.premultiplyAlpha),t.pixelStorei(3317,r.unpackAlignment),t.pixelStorei(37443,0);let e=r.isCompressedTexture||r.image[0].isCompressedTexture,n=r.image[0]&&r.image[0].isDataTexture,d=[];for(let t=0;t<6;t++)d[t]=e||n?n?r.image[t].image:r.image[t]:b(r.image[t],!1,!0,c),d[t]=V(r,d[t]);let p,f=d[0],m=x(f)||l,g=s.convert(r.format,r.encoding),v=s.convert(r.type),y=A(r.internalFormat,g,v,r.encoding),_=l&&!0!==r.isVideoTexture,C=void 0===u.__version||!0===o,M=E(r,f,m);if(R(34067,r,m),e){_&&C&&i.texStorage2D(34067,M,y,f.width,f.height);for(let t=0;t<6;t++){p=d[t].mipmaps;for(let e=0;e<p.length;e++){let n=p[e];r.format!==Zp?null!==g?_?i.compressedTexSubImage2D(34069+t,e,0,0,n.width,n.height,g,n.data):i.compressedTexImage2D(34069+t,e,y,n.width,n.height,0,n.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):_?i.texSubImage2D(34069+t,e,0,0,n.width,n.height,g,v,n.data):i.texImage2D(34069+t,e,y,n.width,n.height,0,g,v,n.data)}}}else{p=r.mipmaps,_&&C&&(p.length>0&&M++,i.texStorage2D(34067,M,y,d[0].width,d[0].height));for(let t=0;t<6;t++)if(n){_?i.texSubImage2D(34069+t,0,0,0,d[t].width,d[t].height,g,v,d[t].data):i.texImage2D(34069+t,0,y,d[t].width,d[t].height,0,g,v,d[t].data);for(let e=0;e<p.length;e++){let n=p[e].image[t].image;_?i.texSubImage2D(34069+t,e+1,0,0,n.width,n.height,g,v,n.data):i.texImage2D(34069+t,e+1,y,n.width,n.height,0,g,v,n.data)}}else{_?i.texSubImage2D(34069+t,0,0,0,g,v,d[t]):i.texImage2D(34069+t,0,y,g,v,d[t]);for(let e=0;e<p.length;e++){let n=p[e];_?i.texSubImage2D(34069+t,e+1,0,0,g,v,n.image[t]):i.texImage2D(34069+t,e+1,y,g,v,n.image[t])}}}w(r,m)&&S(34067),u.__version=h.version,r.onUpdate&&r.onUpdate(r)}e.__version=r.version}(a,e,r):i.bindTexture(34067,a.__webglTexture,33984+r)},this.rebindTextures=function(t,e,i){let r=n.get(t);void 0!==e&&B(r.__webglFramebuffer,t,t.texture,36064,3553),void 0!==i&&F(t)},this.setupRenderTarget=function(e){let o=e.texture,h=n.get(e),c=n.get(o);e.addEventListener("dispose",M),!0!==e.isWebGLMultipleRenderTargets&&(void 0===c.__webglTexture&&(c.__webglTexture=t.createTexture()),c.__version=o.version,a.memory.textures++);let u=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultipleRenderTargets,p=x(e)||l;if(u){h.__webglFramebuffer=[];for(let e=0;e<6;e++)h.__webglFramebuffer[e]=t.createFramebuffer()}else{if(h.__webglFramebuffer=t.createFramebuffer(),d)if(r.drawBuffers){let i=e.texture;for(let e=0,r=i.length;e<r;e++){let r=n.get(i[e]);void 0===r.__webglTexture&&(r.__webglTexture=t.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(l&&e.samples>0&&!1===U(e)){let n=d?o:[o];h.__webglMultisampledFramebuffer=t.createFramebuffer(),h.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,h.__webglMultisampledFramebuffer);for(let i=0;i<n.length;i++){let r=n[i];h.__webglColorRenderbuffer[i]=t.createRenderbuffer(),t.bindRenderbuffer(36161,h.__webglColorRenderbuffer[i]);let a=s.convert(r.format,r.encoding),o=s.convert(r.type),l=A(r.internalFormat,a,o,r.encoding,!0===e.isXRRenderTarget),c=N(e);t.renderbufferStorageMultisample(36161,c,l,e.width,e.height),t.framebufferRenderbuffer(36160,36064+i,36161,h.__webglColorRenderbuffer[i])}t.bindRenderbuffer(36161,null),e.depthBuffer&&(h.__webglDepthRenderbuffer=t.createRenderbuffer(),z(h.__webglDepthRenderbuffer,e,!0)),i.bindFramebuffer(36160,null)}}if(u){i.bindTexture(34067,c.__webglTexture),R(34067,o,p);for(let t=0;t<6;t++)B(h.__webglFramebuffer[t],e,o,36064,34069+t);w(o,p)&&S(34067),i.unbindTexture()}else if(d){let t=e.texture;for(let r=0,s=t.length;r<s;r++){let s=t[r],a=n.get(s);i.bindTexture(3553,a.__webglTexture),R(3553,s,p),B(h.__webglFramebuffer,e,s,36064+r,3553),w(s,p)&&S(3553)}i.unbindTexture()}else{let t=3553;(e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(l?t=e.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(t,c.__webglTexture),R(t,o,p),B(h.__webglFramebuffer,e,o,36064,t),w(o,p)&&S(t),i.unbindTexture()}e.depthBuffer&&F(e)},this.updateRenderTargetMipmap=function(t){let e=x(t)||l,r=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let s=0,a=r.length;s<a;s++){let a=r[s];if(w(a,e)){let e=t.isWebGLCubeRenderTarget?34067:3553,r=n.get(a).__webglTexture;i.bindTexture(e,r),S(e),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(l&&e.samples>0&&!1===U(e)){let r=e.isWebGLMultipleRenderTargets?e.texture:[e.texture],s=e.width,a=e.height,o=16384,l=[],h=e.stencilBuffer?33306:36096,c=n.get(e),u=!0===e.isWebGLMultipleRenderTargets;if(u)for(let e=0;e<r.length;e++)i.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064+e,36161,null),i.bindFramebuffer(36160,c.__webglFramebuffer),t.framebufferTexture2D(36009,36064+e,3553,null,0);i.bindFramebuffer(36008,c.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,c.__webglFramebuffer);for(let i=0;i<r.length;i++){l.push(36064+i),e.depthBuffer&&l.push(h);let d=void 0!==c.__ignoreDepthValues&&c.__ignoreDepthValues;if(!1===d&&(e.depthBuffer&&(o|=256),e.stencilBuffer&&(o|=1024)),u&&t.framebufferRenderbuffer(36008,36064,36161,c.__webglColorRenderbuffer[i]),!0===d&&(t.invalidateFramebuffer(36008,[h]),t.invalidateFramebuffer(36009,[h])),u){let e=n.get(r[i]).__webglTexture;t.framebufferTexture2D(36009,36064,3553,e,0)}t.blitFramebuffer(0,0,s,a,0,0,s,a,o,9728),f&&t.invalidateFramebuffer(36008,l)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),u)for(let e=0;e<r.length;e++){i.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064+e,36161,c.__webglColorRenderbuffer[e]);let s=n.get(r[e]).__webglTexture;i.bindFramebuffer(36160,c.__webglFramebuffer),t.framebufferTexture2D(36009,36064+e,3553,s,0)}i.bindFramebuffer(36009,c.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=F,this.setupFrameBufferTexture=B,this.useMultisampledRTT=U}function Xb(t,e,i){let n=i.isWebGL2;return{convert:function(i){let r,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(i===qp)return 5121;if(1017===i)return 32819;if(1018===i)return 32820;if(1010===i)return 5120;if(1011===i)return 5122;if(1012===i)return 5123;if(1013===i)return 5124;if(i===Yp)return 5125;if(i===Xp)return 5126;if(i===Qp)return n?5131:(r=e.get("OES_texture_half_float"),null!==r?r.HALF_FLOAT_OES:null);if(1021===i)return 6406;if(i===Zp)return 6408;if(1024===i)return 6409;if(1025===i)return 6410;if(i===Jp)return 6402;if(i===$p)return 34041;if(i===Ef)return r=e.get("EXT_sRGB"),null!==r?r.SRGB_ALPHA_EXT:null;if(i===tf)return 6403;if(1029===i)return 36244;if(i===ef)return 33319;if(1031===i)return 33320;if(1033===i)return 36249;if(i===nf||i===rf||i===sf||i===af)if(s===vf){if(r=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===r)return null;if(i===nf)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===rf)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===sf)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===af)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(r=e.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(i===nf)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===rf)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===sf)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===af)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===i||35841===i||35842===i||35843===i){if(r=e.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(35840===i)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===i)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===i)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===i)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===i)return r=e.get("WEBGL_compressed_texture_etc1"),null!==r?r.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===i||37496===i){if(r=e.get("WEBGL_compressed_texture_etc"),null===r)return null;if(37492===i)return s===vf?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(37496===i)return s===vf?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(37808===i||37809===i||37810===i||37811===i||37812===i||37813===i||37814===i||37815===i||37816===i||37817===i||37818===i||37819===i||37820===i||37821===i){if(r=e.get("WEBGL_compressed_texture_astc"),null===r)return null;if(37808===i)return s===vf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===i)return s===vf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===i)return s===vf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===i)return s===vf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===i)return s===vf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===i)return s===vf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===i)return s===vf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===i)return s===vf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===i)return s===vf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===i)return s===vf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===i)return s===vf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===i)return s===vf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===i)return s===vf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===i)return s===vf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(i===of){if(r=e.get("EXT_texture_compression_bptc"),null===r)return null;if(i===of)return s===vf?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(36283===i||36284===i||36285===i||36286===i){if(r=e.get("EXT_texture_compression_rgtc"),null===r)return null;if(i===of)return r.COMPRESSED_RED_RGTC1_EXT;if(36284===i)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===i)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===i)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return i===Kp?n?34042:(r=e.get("WEBGL_depth_texture"),null!==r?r.UNSIGNED_INT_24_8_WEBGL:null):void 0!==t[i]?t[i]:null}}}var Qb=class extends pv{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isArrayCamera=!0,this.cameras=t}},Kb=class extends gg{constructor(){super(),this.isGroup=!0,this.type="Group"}},Zb={type:"move"},Jb=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Kb,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Kb,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new mm,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new mm),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Kb,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new mm,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new mm),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){let e=this._hand;if(e)for(let i of t.hand.values())this._getHandJoint(e,i)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,i){let n=null,r=null,s=null,a=this._targetRay,o=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(l&&t.hand){s=!0;for(let s of t.hand.values()){let t=e.getJointPose(s,i),n=this._getHandJoint(l,s);null!==t&&(n.matrix.fromArray(t.transform.matrix),n.matrix.decompose(n.position,n.rotation,n.scale),n.jointRadius=t.radius),n.visible=null!==t}let n=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],a=n.position.distanceTo(r.position),o=.02,h=.005;l.inputState.pinching&&a>o+h?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&a<=o-h&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==o&&t.gripSpace&&(r=e.getPose(t.gripSpace,i),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));null!==a&&(n=e.getPose(t.targetRaySpace,i),null===n&&null!==r&&(n=r),null!==n&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),n.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(n.linearVelocity)):a.hasLinearVelocity=!1,n.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(n.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Zb)))}return null!==a&&(a.visible=null!==n),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==s),this}_getHandJoint(t,e){if(void 0===t.joints[e.jointName]){let i=new Kb;i.matrixAutoUpdate=!1,i.visible=!1,t.joints[e.jointName]=i,t.add(i)}return t.joints[e.jointName]}},$b=class extends hm{constructor(t,e,i,n,r,s,a,o,l,h){if((h=void 0!==h?h:Jp)!==Jp&&h!==$p)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&h===Jp&&(i=Yp),void 0===i&&h===$p&&(i=Kp),super(null,n,r,s,a,o,h,i,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=void 0!==a?a:Up,this.minFilter=void 0!==o?o:Up,this.flipY=!1,this.generateMipmaps=!1}},tx=class extends _f{constructor(t,e){super();let i=this,n=null,r=1,s=null,a="local-floor",o=1,l=null,h=null,c=null,u=null,d=null,p=null,f=e.getContextAttributes(),m=null,g=null,v=[],y=[],b=new Set,x=new Map,w=new pv;w.layers.enable(1),w.viewport=new cm;let S=new pv;S.layers.enable(2),S.viewport=new cm;let A=[w,S],E=new Qb;E.layers.enable(1),E.layers.enable(2);let _=null,C=null;function M(t){let e=y.indexOf(t.inputSource);if(-1===e)return;let i=v[e];void 0!==i&&i.dispatchEvent({type:t.type,data:t.inputSource})}function P(){n.removeEventListener("select",M),n.removeEventListener("selectstart",M),n.removeEventListener("selectend",M),n.removeEventListener("squeeze",M),n.removeEventListener("squeezestart",M),n.removeEventListener("squeezeend",M),n.removeEventListener("end",P),n.removeEventListener("inputsourceschange",T);for(let t=0;t<v.length;t++){let e=y[t];null!==e&&(y[t]=null,v[t].disconnect(e))}_=null,C=null,t.setRenderTarget(m),d=null,u=null,c=null,n=null,g=null,O.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function T(t){for(let e=0;e<t.removed.length;e++){let i=t.removed[e],n=y.indexOf(i);n>=0&&(y[n]=null,v[n].disconnect(i))}for(let e=0;e<t.added.length;e++){let i=t.added[e],n=y.indexOf(i);if(-1===n){for(let t=0;t<v.length;t++){if(t>=y.length){y.push(i),n=t;break}if(null===y[t]){y[t]=i,n=t;break}}if(-1===n)break}let r=v[n];r&&r.connect(i)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=v[t];return void 0===e&&(e=new Jb,v[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=v[t];return void 0===e&&(e=new Jb,v[t]=e),e.getGripSpace()},this.getHand=function(t){let e=v[t];return void 0===e&&(e=new Jb,v[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){a=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(t){l=t},this.getBaseLayer=function(){return null!==u?u:d},this.getBinding=function(){return c},this.getFrame=function(){return p},this.getSession=function(){return n},this.setSession=async function(h){if(n=h,null!==n){if(m=t.getRenderTarget(),n.addEventListener("select",M),n.addEventListener("selectstart",M),n.addEventListener("selectend",M),n.addEventListener("squeeze",M),n.addEventListener("squeezestart",M),n.addEventListener("squeezeend",M),n.addEventListener("end",P),n.addEventListener("inputsourceschange",T),!0!==f.xrCompatible&&await e.makeXRCompatible(),void 0===n.renderState.layers||!1===t.capabilities.isWebGL2){let i={antialias:void 0!==n.renderState.layers||f.antialias,alpha:f.alpha,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:r};d=new XRWebGLLayer(n,e,i),n.updateRenderState({baseLayer:d}),g=new um(d.framebufferWidth,d.framebufferHeight,{format:Zp,type:qp,encoding:t.outputEncoding,stencilBuffer:f.stencil})}else{let i=null,s=null,a=null;f.depth&&(a=f.stencil?35056:33190,i=f.stencil?$p:Jp,s=f.stencil?Kp:Yp);let o={colorFormat:32856,depthFormat:a,scaleFactor:r};c=new XRWebGLBinding(n,e),u=c.createProjectionLayer(o),n.updateRenderState({layers:[u]}),g=new um(u.textureWidth,u.textureHeight,{format:Zp,type:qp,depthTexture:new $b(u.textureWidth,u.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:f.stencil,encoding:t.outputEncoding,samples:f.antialias?4:0}),t.properties.get(g).__ignoreDepthValues=u.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await n.requestReferenceSpace(a),O.setContext(n),O.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};let D=new mm,k=new mm;function I(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===n)return;E.near=S.near=w.near=t.near,E.far=S.far=w.far=t.far,(_!==E.near||C!==E.far)&&(n.updateRenderState({depthNear:E.near,depthFar:E.far}),_=E.near,C=E.far);let e=t.parent,i=E.cameras;I(E,e);for(let n=0;n<i.length;n++)I(i[n],e);E.matrixWorld.decompose(E.position,E.quaternion,E.scale),t.matrix.copy(E.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale);let r=t.children;for(let n=0,s=r.length;n<s;n++)r[n].updateMatrixWorld(!0);2===i.length?function(t,e,i){D.setFromMatrixPosition(e.matrixWorld),k.setFromMatrixPosition(i.matrixWorld);let n=D.distanceTo(k),r=e.projectionMatrix.elements,s=i.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],h=(r[9]-1)/r[5],c=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=a*c,p=a*u,f=n/(-c+u),m=f*-c;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();let g=a+f,v=o+f,y=d-m,b=p+(n-m),x=l*o/v*g,w=h*o/v*g;t.projectionMatrix.makePerspective(y,b,x,w,g,v)}(E,w,S):E.projectionMatrix.copy(w.projectionMatrix)},this.getCamera=function(){return E},this.getFoveation=function(){if(null!==u||null!==d)return o},this.setFoveation=function(t){o=t,null!==u&&(u.fixedFoveation=t),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=t)},this.getPlanes=function(){return b};let R=null;let O=new _v;O.setAnimationLoop((function(e,n){if(h=n.getViewerPose(l||s),p=n,null!==h){let e=h.views;null!==d&&(t.setRenderTargetFramebuffer(g,d.framebuffer),t.setRenderTarget(g));let i=!1;e.length!==E.cameras.length&&(E.cameras.length=0,i=!0);for(let n=0;n<e.length;n++){let r=e[n],s=null;if(null!==d)s=d.getViewport(r);else{let e=c.getViewSubImage(u,r);s=e.viewport,0===n&&(t.setRenderTargetTextures(g,e.colorTexture,u.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(g))}let a=A[n];void 0===a&&(a=new pv,a.layers.enable(n),a.viewport=new cm,A[n]=a),a.matrix.fromArray(r.transform.matrix),a.projectionMatrix.fromArray(r.projectionMatrix),a.viewport.set(s.x,s.y,s.width,s.height),0===n&&E.matrix.copy(a.matrix),!0===i&&E.cameras.push(a)}}for(let t=0;t<v.length;t++){let e=y[t],i=v[t];null!==e&&void 0!==i&&i.update(e,n,l||s)}if(R&&R(e,n),n.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:n.detectedPlanes});let t=null;for(let e of b)n.detectedPlanes.has(e)||(null===t&&(t=[]),t.push(e));if(null!==t)for(let e of t)b.delete(e),x.delete(e),i.dispatchEvent({type:"planeremoved",data:e});for(let e of n.detectedPlanes)if(b.has(e)){let t=x.get(e);e.lastChangedTime>t&&(x.set(e,e.lastChangedTime),i.dispatchEvent({type:"planechanged",data:e}))}else b.add(e),x.set(e,n.lastChangedTime),i.dispatchEvent({type:"planeadded",data:e})}p=null})),this.setAnimationLoop=function(t){R=t},this.dispose=function(){}}};function ex(t,e){function i(i,n){i.opacity.value=n.opacity,n.color&&i.diffuse.value.copy(n.color),n.emissive&&i.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(i.map.value=n.map),n.alphaMap&&(i.alphaMap.value=n.alphaMap),n.bumpMap&&(i.bumpMap.value=n.bumpMap,i.bumpScale.value=n.bumpScale,1===n.side&&(i.bumpScale.value*=-1)),n.displacementMap&&(i.displacementMap.value=n.displacementMap,i.displacementScale.value=n.displacementScale,i.displacementBias.value=n.displacementBias),n.emissiveMap&&(i.emissiveMap.value=n.emissiveMap),n.normalMap&&(i.normalMap.value=n.normalMap,i.normalScale.value.copy(n.normalScale),1===n.side&&i.normalScale.value.negate()),n.specularMap&&(i.specularMap.value=n.specularMap),n.alphaTest>0&&(i.alphaTest.value=n.alphaTest);let r,s,a=e.get(n).envMap;if(a&&(i.envMap.value=a,i.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,i.reflectivity.value=n.reflectivity,i.ior.value=n.ior,i.refractionRatio.value=n.refractionRatio),n.lightMap){i.lightMap.value=n.lightMap;let e=!0!==t.physicallyCorrectLights?Math.PI:1;i.lightMapIntensity.value=n.lightMapIntensity*e}n.aoMap&&(i.aoMap.value=n.aoMap,i.aoMapIntensity.value=n.aoMapIntensity),n.map?r=n.map:n.specularMap?r=n.specularMap:n.displacementMap?r=n.displacementMap:n.normalMap?r=n.normalMap:n.bumpMap?r=n.bumpMap:n.roughnessMap?r=n.roughnessMap:n.metalnessMap?r=n.metalnessMap:n.alphaMap?r=n.alphaMap:n.emissiveMap?r=n.emissiveMap:n.clearcoatMap?r=n.clearcoatMap:n.clearcoatNormalMap?r=n.clearcoatNormalMap:n.clearcoatRoughnessMap?r=n.clearcoatRoughnessMap:n.iridescenceMap?r=n.iridescenceMap:n.iridescenceThicknessMap?r=n.iridescenceThicknessMap:n.specularIntensityMap?r=n.specularIntensityMap:n.specularColorMap?r=n.specularColorMap:n.transmissionMap?r=n.transmissionMap:n.thicknessMap?r=n.thicknessMap:n.sheenColorMap?r=n.sheenColorMap:n.sheenRoughnessMap&&(r=n.sheenRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),i.uvTransform.value.copy(r.matrix)),n.aoMap?s=n.aoMap:n.lightMap&&(s=n.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),i.uv2Transform.value.copy(s.matrix))}return{refreshFogUniforms:function(e,i){i.color.getRGB(e.fogColor.value,hv(t)),i.isFog?(e.fogNear.value=i.near,e.fogFar.value=i.far):i.isFogExp2&&(e.fogDensity.value=i.density)},refreshMaterialUniforms:function(t,n,r,s,a){n.isMeshBasicMaterial||n.isMeshLambertMaterial?i(t,n):n.isMeshToonMaterial?(i(t,n),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(t,n)):n.isMeshPhongMaterial?(i(t,n),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}(t,n)):n.isMeshStandardMaterial?(i(t,n),function(t,i){t.roughness.value=i.roughness,t.metalness.value=i.metalness,i.roughnessMap&&(t.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(t.metalnessMap.value=i.metalnessMap),e.get(i).envMap&&(t.envMapIntensity.value=i.envMapIntensity)}(t,n),n.isMeshPhysicalMaterial&&function(t,e,i){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap)),e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&t.clearcoatNormalScale.value.negate())),e.iridescence>0&&(t.iridescence.value=e.iridescence,t.iridescenceIOR.value=e.iridescenceIOR,t.iridescenceThicknessMinimum.value=e.iridescenceThicknessRange[0],t.iridescenceThicknessMaximum.value=e.iridescenceThicknessRange[1],e.iridescenceMap&&(t.iridescenceMap.value=e.iridescenceMap),e.iridescenceThicknessMap&&(t.iridescenceThicknessMap.value=e.iridescenceThicknessMap)),e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=i.texture,t.transmissionSamplerSize.value.set(i.width,i.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor)),t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap)}(t,n,a)):n.isMeshMatcapMaterial?(i(t,n),function(t,e){e.matcap&&(t.matcap.value=e.matcap)}(t,n)):n.isMeshDepthMaterial?i(t,n):n.isMeshDistanceMaterial?(i(t,n),function(t,e){t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,n)):n.isMeshNormalMaterial?i(t,n):n.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,n),n.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,n)):n.isPointsMaterial?function(t,e,i,n){let r;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*i,t.scale.value=.5*n,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest),e.map?r=e.map:e.alphaMap&&(r=e.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,n,r,s):n.isSpriteMaterial?function(t,e){let i;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest),e.map?i=e.map:e.alphaMap&&(i=e.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,n):n.isShadowMaterial?(t.color.value.copy(n.color),t.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function ix(t,e,i,n){let r={},s={},a=[],o=i.isWebGL2?t.getParameter(35375):0;function l(t,e,i){let n=t.value;if(void 0===i[e]){if("number"==typeof n)i[e]=n;else{let t=Array.isArray(n)?n:[n],r=[];for(let e=0;e<t.length;e++)r.push(t[e].clone());i[e]=r}return!0}if("number"==typeof n){if(i[e]!==n)return i[e]=n,!0}else{let t=Array.isArray(i[e])?i[e]:[i[e]],r=Array.isArray(n)?n:[n];for(let e=0;e<t.length;e++){let i=t[e];if(!1===i.equals(r[e]))return i.copy(r[e]),!0}}return!1}function h(t){let e={boundary:0,storage:0};return"number"==typeof t?(e.boundary=4,e.storage=4):t.isVector2?(e.boundary=8,e.storage=8):t.isVector3||t.isColor?(e.boundary=16,e.storage=12):t.isVector4?(e.boundary=16,e.storage=16):t.isMatrix3?(e.boundary=48,e.storage=48):t.isMatrix4?(e.boundary=64,e.storage=64):t.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",t),e}function c(e){let i=e.target;i.removeEventListener("dispose",c);let n=a.indexOf(i.__bindingPointIndex);a.splice(n,1),t.deleteBuffer(r[i.id]),delete r[i.id],delete s[i.id]}return{bind:function(t,e){let i=e.program;n.uniformBlockBinding(t,i)},update:function(i,u){let d=r[i.id];void 0===d&&(function(t){let e=t.uniforms,i=0,n=16,r=0;for(let s=0,a=e.length;s<a;s++){let t=e[s],a={boundary:0,storage:0},o=Array.isArray(t.value)?t.value:[t.value];for(let e=0,i=o.length;e<i;e++){let t=h(o[e]);a.boundary+=t.boundary,a.storage+=t.storage}if(t.__data=new Float32Array(a.storage/Float32Array.BYTES_PER_ELEMENT),t.__offset=i,s>0){r=i%n,0!==r&&n-r-a.boundary<0&&(i+=n-r,t.__offset=i)}i+=a.storage}r=i%n,r>0&&(i+=n-r),t.__size=i,t.__cache={}}(i),d=function(e){let i=function(){for(let t=0;t<o;t++)if(-1===a.indexOf(t))return a.push(t),t;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();e.__bindingPointIndex=i;let n=t.createBuffer(),r=e.__size,s=e.usage;return t.bindBuffer(35345,n),t.bufferData(35345,r,s),t.bindBuffer(35345,null),t.bindBufferBase(35345,i,n),n}(i),r[i.id]=d,i.addEventListener("dispose",c));let p=u.program;n.updateUBOMapping(i,p);let f=e.render.frame;s[i.id]!==f&&(function(e){let i=r[e.id],n=e.uniforms,s=e.__cache;t.bindBuffer(35345,i);for(let r=0,a=n.length;r<a;r++){let e=n[r];if(!0===l(e,r,s)){let i=e.__offset,n=Array.isArray(e.value)?e.value:[e.value],r=0;for(let s=0;s<n.length;s++){let a=n[s],o=h(a);"number"==typeof a?(e.__data[0]=a,t.bufferSubData(35345,i+r,e.__data)):a.isMatrix3?(e.__data[0]=a.elements[0],e.__data[1]=a.elements[1],e.__data[2]=a.elements[2],e.__data[3]=a.elements[0],e.__data[4]=a.elements[3],e.__data[5]=a.elements[4],e.__data[6]=a.elements[5],e.__data[7]=a.elements[0],e.__data[8]=a.elements[6],e.__data[9]=a.elements[7],e.__data[10]=a.elements[8],e.__data[11]=a.elements[0]):(a.toArray(e.__data,r),r+=o.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(35345,i,e.__data)}}t.bindBuffer(35345,null)}(i),s[i.id]=f)},dispose:function(){for(let e in r)t.deleteBuffer(r[e]);a=[],r={},s={}}}}function nx(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isWebGLRenderer=!0;let e,i=void 0!==t.canvas?t.canvas:function(){let t=qf("canvas");return t.style.display="block",t}(),n=void 0!==t.context?t.context:null,r=void 0===t.depth||t.depth,s=void 0===t.stencil||t.stencil,a=void 0!==t.antialias&&t.antialias,o=void 0===t.premultipliedAlpha||t.premultipliedAlpha,l=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,h=void 0!==t.powerPreference?t.powerPreference:"default",c=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;e=null!==n?n.getContextAttributes().alpha:void 0!==t.alpha&&t.alpha;let u=null,d=null,p=[],f=[];this.domElement=i,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=gf,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;let m=this,g=!1,v=0,y=0,b=null,x=-1,w=null,S=new cm,A=new cm,E=null,_=i.width,C=i.height,M=1,P=null,T=null,D=new cm(0,0,_,C),k=new cm(0,0,_,C),I=!1,R=new Ev,O=!1,L=!1,B=null,z=new Wm,F=new Uf,N=new mm,U={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function V(){return null===b?M:1}let j,G,H,W,q,Y,X,Q,K,Z,J,$,tt,et,it,nt,rt,st,at,ot,lt,ht,ct,ut,dt=n;function pt(t,e){for(let n=0;n<t.length;n++){let r=t[n],s=i.getContext(r,e);if(null!==s)return s}return null}try{let t={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:h,failIfMajorPerformanceCaveat:c};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${dp}`),i.addEventListener("webglcontextlost",gt,!1),i.addEventListener("webglcontextrestored",vt,!1),i.addEventListener("webglcontextcreationerror",yt,!1),null===dt){let e=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&e.shift(),dt=pt(e,t),null===dt)throw pt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===dt.getShaderPrecisionFormat&&(dt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Dt){throw console.error("THREE.WebGLRenderer: "+Dt.message),Dt}function ft(){j=new ty(dt),G=new Lv(dt,j,t),j.init(G),ht=new Xb(dt,j,G),H=new qb(dt,j,G),W=new ny,q=new Ib,Y=new Yb(dt,j,H,q,G,ht,W),X=new zv(m),Q=new $v(m),K=new Cv(dt,G),ct=new Rv(dt,j,K,G),Z=new ey(dt,K,W,ct),J=new oy(dt,Z,K,W),at=new ay(dt,G,Y),nt=new Bv(q),$=new kb(m,X,Q,j,G,ct,nt),tt=new ex(m,q),et=new Bb,it=new jb(j,G),st=new Iv(m,X,Q,H,J,e,o),rt=new Wb(m,J,G),ut=new ix(dt,W,G,H),ot=new Ov(dt,j,W,G),lt=new iy(dt,j,W,G),W.programs=$.programs,m.capabilities=G,m.extensions=j,m.properties=q,m.renderLists=et,m.shadowMap=rt,m.state=H,m.info=W}ft();let mt=new tx(m,dt);function gt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function vt(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;let t=W.autoReset,e=rt.enabled,i=rt.autoUpdate,n=rt.needsUpdate,r=rt.type;ft(),W.autoReset=t,rt.enabled=e,rt.autoUpdate=i,rt.needsUpdate=n,rt.type=r}function yt(t){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",t.statusMessage)}function bt(t){let e=t.target;e.removeEventListener("dispose",bt),function(t){(function(t){let e=q.get(t).programs;void 0!==e&&(e.forEach((function(t){$.releaseProgram(t)})),t.isShaderMaterial&&$.releaseShaderCache(t))})(t),q.remove(t)}(e)}this.xr=mt,this.getContext=function(){return dt},this.getContextAttributes=function(){return dt.getContextAttributes()},this.forceContextLoss=function(){let t=j.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){let t=j.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return M},this.setPixelRatio=function(t){void 0!==t&&(M=t,this.setSize(_,C,!1))},this.getSize=function(t){return t.set(_,C)},this.setSize=function(t,e,n){mt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(_=t,C=e,i.width=Math.floor(t*M),i.height=Math.floor(e*M),!1!==n&&(i.style.width=t+"px",i.style.height=e+"px"),this.setViewport(0,0,t,e))},this.getDrawingBufferSize=function(t){return t.set(_*M,C*M).floor()},this.setDrawingBufferSize=function(t,e,n){_=t,C=e,M=n,i.width=Math.floor(t*n),i.height=Math.floor(e*n),this.setViewport(0,0,t,e)},this.getCurrentViewport=function(t){return t.copy(S)},this.getViewport=function(t){return t.copy(D)},this.setViewport=function(t,e,i,n){t.isVector4?D.set(t.x,t.y,t.z,t.w):D.set(t,e,i,n),H.viewport(S.copy(D).multiplyScalar(M).floor())},this.getScissor=function(t){return t.copy(k)},this.setScissor=function(t,e,i,n){t.isVector4?k.set(t.x,t.y,t.z,t.w):k.set(t,e,i,n),H.scissor(A.copy(k).multiplyScalar(M).floor())},this.getScissorTest=function(){return I},this.setScissorTest=function(t){H.setScissorTest(I=t)},this.setOpaqueSort=function(t){P=t},this.setTransparentSort=function(t){T=t},this.getClearColor=function(t){return t.copy(st.getClearColor())},this.setClearColor=function(){st.setClearColor.apply(st,arguments)},this.getClearAlpha=function(){return st.getClearAlpha()},this.setClearAlpha=function(){st.setClearAlpha.apply(st,arguments)},this.clear=function(){let t=0;(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(t|=16384),(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&(t|=256),(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&(t|=1024),dt.clear(t)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",gt,!1),i.removeEventListener("webglcontextrestored",vt,!1),i.removeEventListener("webglcontextcreationerror",yt,!1),et.dispose(),it.dispose(),q.dispose(),X.dispose(),Q.dispose(),J.dispose(),ct.dispose(),ut.dispose(),$.dispose(),mt.dispose(),mt.removeEventListener("sessionstart",wt),mt.removeEventListener("sessionend",St),B&&(B.dispose(),B=null),At.stop()},this.renderBufferDirect=function(t,e,i,n,r,s){null===e&&(e=U);let a=r.isMesh&&r.matrixWorld.determinant()<0,o=function(t,e,i,n,r){!0!==e.isScene&&(e=U),Y.resetTextureUnits();let s=e.fog,a=n.isMeshStandardMaterial?e.environment:null,o=null===b?m.outputEncoding:!0===b.isXRRenderTarget?b.texture.encoding:gf,l=(n.isMeshStandardMaterial?Q:X).get(n.envMap||a),h=!0===n.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,c=!!n.normalMap&&!!i.attributes.tangent,u=!!i.morphAttributes.position,p=!!i.morphAttributes.normal,f=!!i.morphAttributes.color,g=n.toneMapped?m.toneMapping:0,v=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,y=void 0!==v?v.length:0,S=q.get(n),A=d.state.lights;if(!0===O&&(!0===L||t!==w)){let e=t===w&&n.id===x;nt.setState(n,t,e)}let E=!1;n.version===S.__version?(S.needsLights&&S.lightsStateVersion!==A.state.version||S.outputEncoding!==o||r.isInstancedMesh&&!1===S.instancing||!r.isInstancedMesh&&!0===S.instancing||r.isSkinnedMesh&&!1===S.skinning||!r.isSkinnedMesh&&!0===S.skinning||S.envMap!==l||!0===n.fog&&S.fog!==s||void 0!==S.numClippingPlanes&&(S.numClippingPlanes!==nt.numPlanes||S.numIntersection!==nt.numIntersection)||S.vertexAlphas!==h||S.vertexTangents!==c||S.morphTargets!==u||S.morphNormals!==p||S.morphColors!==f||S.toneMapping!==g||!0===G.isWebGL2&&S.morphTargetsCount!==y)&&(E=!0):(E=!0,S.__version=n.version);let _=S.currentProgram;!0===E&&(_=Pt(n,e,r));let P=!1,T=!1,D=!1,k=_.getUniforms(),I=S.uniforms;if(H.useProgram(_.program)&&(P=!0,T=!0,D=!0),n.id!==x&&(x=n.id,T=!0),P||w!==t){if(k.setValue(dt,"projectionMatrix",t.projectionMatrix),G.logarithmicDepthBuffer&&k.setValue(dt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),w!==t&&(w=t,T=!0,D=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){let e=k.map.cameraPosition;void 0!==e&&e.setValue(dt,N.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&k.setValue(dt,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||r.isSkinnedMesh)&&k.setValue(dt,"viewMatrix",t.matrixWorldInverse)}if(r.isSkinnedMesh){k.setOptional(dt,r,"bindMatrix"),k.setOptional(dt,r,"bindMatrixInverse");let t=r.skeleton;t&&(G.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),k.setValue(dt,"boneTexture",t.boneTexture,Y),k.setValue(dt,"boneTextureSize",t.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let R=i.morphAttributes;if((void 0!==R.position||void 0!==R.normal||void 0!==R.color&&!0===G.isWebGL2)&&at.update(r,i,n,_),(T||S.receiveShadow!==r.receiveShadow)&&(S.receiveShadow=r.receiveShadow,k.setValue(dt,"receiveShadow",r.receiveShadow)),n.isMeshGouraudMaterial&&null!==n.envMap&&(I.envMap.value=l,I.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1),T&&(k.setValue(dt,"toneMappingExposure",m.toneMappingExposure),S.needsLights&&function(t,e){t.ambientLightColor.needsUpdate=e,t.lightProbe.needsUpdate=e,t.directionalLights.needsUpdate=e,t.directionalLightShadows.needsUpdate=e,t.pointLights.needsUpdate=e,t.pointLightShadows.needsUpdate=e,t.spotLights.needsUpdate=e,t.spotLightShadows.needsUpdate=e,t.rectAreaLights.needsUpdate=e,t.hemisphereLights.needsUpdate=e}(I,D),s&&!0===n.fog&&tt.refreshFogUniforms(I,s),tt.refreshMaterialUniforms(I,n,M,C,B),ub.upload(dt,S.uniformsList,I,Y)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(ub.upload(dt,S.uniformsList,I,Y),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&k.setValue(dt,"center",r.center),k.setValue(dt,"modelViewMatrix",r.modelViewMatrix),k.setValue(dt,"normalMatrix",r.normalMatrix),k.setValue(dt,"modelMatrix",r.matrixWorld),r.previousModelViewMatrix&&k.setValue(dt,"previousModelViewMatrix",r.previousModelViewMatrix),t.previousProjectionMatrix&&k.setValue(dt,"previousProjectionMatrix",t.previousProjectionMatrix),n.isShaderMaterial||n.isRawShaderMaterial){let t=n.uniformsGroups;for(let e=0,i=t.length;e<i;e++)if(G.isWebGL2){let i=t[e];ut.update(i,_),ut.bind(i,_)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return _}(t,e,i,n,r);H.setMaterial(n,a);let l=i.index,h=1;!0===n.wireframe&&(l=Z.getWireframeAttribute(i),h=2);let c=i.drawRange,u=i.attributes.position,p=c.start*h,f=(c.start+c.count)*h;null!==s&&(p=Math.max(p,s.start*h),f=Math.min(f,(s.start+s.count)*h)),null!==l?(p=Math.max(p,0),f=Math.min(f,l.count)):null!=u&&(p=Math.max(p,0),f=Math.min(f,u.count));let g=f-p;if(g<0||g===1/0)return;ct.setup(r,n,o,i,l);let v,y=ot;if(null!==l&&(v=K.get(l),y=lt,y.setIndex(v)),r.isMesh)!0===n.wireframe?(H.setLineWidth(n.wireframeLinewidth*V()),y.setMode(1)):y.setMode(4);else if(r.isLine){let t=n.linewidth;void 0===t&&(t=1),H.setLineWidth(t*V()),r.isLineSegments?y.setMode(1):r.isLineLoop?y.setMode(2):y.setMode(3)}else r.isPoints?y.setMode(0):r.isSprite&&y.setMode(4);if(r.isInstancedMesh)y.renderInstances(p,g,r.count);else if(i.isInstancedBufferGeometry){let t=void 0!==i._maxInstanceCount?i._maxInstanceCount:1/0,e=Math.min(i.instanceCount,t);y.renderInstances(p,g,e)}else y.render(p,g)},this.compile=function(t,e){function i(t,e,i){!0===t.transparent&&2===t.side&&!1===t.forceSinglePass?(t.side=1,t.needsUpdate=!0,Pt(t,e,i),t.side=0,t.needsUpdate=!0,Pt(t,e,i),t.side=2):Pt(t,e,i)}d=it.get(t),d.init(),f.push(d),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(d.pushLight(t),t.castShadow&&d.pushShadow(t))})),d.setupLights(m.physicallyCorrectLights),t.traverse((function(e){let n=e.material;if(n)if(Array.isArray(n))for(let r=0;r<n.length;r++){i(n[r],t,e)}else i(n,t,e)})),f.pop(),d=null};let xt=null;function wt(){At.stop()}function St(){At.start()}let At=new _v;function Et(t,e,i,n){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)i=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)d.pushLight(t),t.castShadow&&d.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||R.intersectsSprite(t)){n&&N.setFromMatrixPosition(t.matrixWorld).applyMatrix4(z);let e=J.update(t),r=t.material;r.visible&&u.push(t,e,r,i,N.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==W.render.frame&&(t.skeleton.update(),t.skeleton.frame=W.render.frame),!t.frustumCulled||R.intersectsObject(t))){n&&N.setFromMatrixPosition(t.matrixWorld).applyMatrix4(z);let e=J.update(t),r=t.material;if(Array.isArray(r)){let n=e.groups;for(let s=0,a=n.length;s<a;s++){let a=n[s],o=r[a.materialIndex];o&&o.visible&&u.push(t,e,o,i,N.z,a)}}else r.visible&&u.push(t,e,r,i,N.z,null)}let r=t.children;for(let s=0,a=r.length;s<a;s++)Et(r[s],e,i,n)}function _t(t,e,i,n){let r=t.opaque,s=t.transmissive,o=t.transparent;d.setupLightsView(i),!0===O&&nt.setGlobalState(m.clippingPlanes,i),s.length>0&&function(t,e,i){let n=G.isWebGL2;null===B&&(B=new um(1,1,{generateMipmaps:!0,type:j.has("EXT_color_buffer_half_float")?Qp:qp,minFilter:Wp,samples:n&&!0===a?4:0})),m.getDrawingBufferSize(F),n?B.setSize(F.x,F.y):B.setSize(Bf(F.x),Bf(F.y));let r=m.getRenderTarget();m.setRenderTarget(B),m.clear();let s=m.toneMapping;m.toneMapping=0,Ct(t,e,i),m.toneMapping=s,Y.updateMultisampleRenderTarget(B),Y.updateRenderTargetMipmap(B),m.setRenderTarget(r)}(r,e,i),n&&H.viewport(S.copy(n)),r.length>0&&Ct(r,e,i),s.length>0&&Ct(s,e,i),o.length>0&&Ct(o,e,i),H.buffers.depth.setTest(!0),H.buffers.depth.setMask(!0),H.buffers.color.setMask(!0),H.setPolygonOffset(!1)}function Ct(t,e,i){let n=!0===e.isScene?e.overrideMaterial:null;for(let r=0,s=t.length;r<s;r++){let s=t[r],a=s.object,o=s.geometry,l=null===n?s.material:n,h=s.group;a.layers.test(i.layers)&&Mt(a,e,i,o,l,h)}}function Mt(t,e,i,n,r,s){t.onBeforeRender(m,e,i,n,r,s),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),r.onBeforeRender(m,e,i,n,t,s),!0===r.transparent&&2===r.side&&!1===r.forceSinglePass?(r.side=1,r.needsUpdate=!0,m.renderBufferDirect(i,e,n,r,t,s),r.side=0,r.needsUpdate=!0,m.renderBufferDirect(i,e,n,r,t,s),r.side=2):m.renderBufferDirect(i,e,n,r,t,s),t.onAfterRender(m,e,i,n,r,s)}function Pt(t,e,i){!0!==e.isScene&&(e=U);let n=q.get(t),r=d.state.lights,s=d.state.shadowsArray,a=r.state.version,o=$.getParameters(t,r.state,s,e,i),l=$.getProgramCacheKey(o),h=n.programs;n.environment=t.isMeshStandardMaterial?e.environment:null,n.fog=e.fog,n.envMap=(t.isMeshStandardMaterial?Q:X).get(t.envMap||n.environment),void 0===h&&(t.addEventListener("dispose",bt),h=new Map,n.programs=h);let c=h.get(l);if(void 0!==c){if(n.currentProgram===c&&n.lightsStateVersion===a)return Tt(t,o),c}else o.uniforms=$.getUniforms(t),t.onBuild(i,o,m),t.onBeforeCompile(o,m),c=$.acquireProgram(o,l),h.set(l,c),n.uniforms=o.uniforms;let u=n.uniforms;(!t.isShaderMaterial&&!t.isRawShaderMaterial||!0===t.clipping)&&(u.clippingPlanes=nt.uniform),Tt(t,o),n.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),n.lightsStateVersion=a,n.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotLightMatrix.value=r.state.spotLightMatrix,u.spotLightMap.value=r.state.spotLightMap,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix);let p=c.getUniforms(),f=ub.seqWithValue(p.seq,u);return n.currentProgram=c,n.uniformsList=f,c}function Tt(t,e){let i=q.get(t);i.outputEncoding=e.outputEncoding,i.instancing=e.instancing,i.skinning=e.skinning,i.morphTargets=e.morphTargets,i.morphNormals=e.morphNormals,i.morphColors=e.morphColors,i.morphTargetsCount=e.morphTargetsCount,i.numClippingPlanes=e.numClippingPlanes,i.numIntersection=e.numClipIntersection,i.vertexAlphas=e.vertexAlphas,i.vertexTangents=e.vertexTangents,i.toneMapping=e.toneMapping}At.setAnimationLoop((function(t){xt&&xt(t)})),typeof self<"u"&&At.setContext(self),this.setAnimationLoop=function(t){xt=t,mt.setAnimationLoop(t),null===t?At.stop():At.start()},mt.addEventListener("sessionstart",wt),mt.addEventListener("sessionend",St),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===g)return;!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),!0===mt.enabled&&!0===mt.isPresenting&&(!0===mt.cameraAutoUpdate&&mt.updateCamera(e),e=mt.getCamera()),!0===t.isScene&&t.onBeforeRender(m,t,e,b),d=it.get(t,f.length),d.init(),f.push(d),z.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),R.setFromProjectionMatrix(z),L=this.localClippingEnabled,O=nt.init(this.clippingPlanes,L),u=et.get(t,p.length),u.init(),p.push(u),Et(t,e,0,m.sortObjects),u.finish(),!0===m.sortObjects&&u.sort(P,T),!0===O&&nt.beginShadows();let i=d.state.shadowsArray;if(rt.render(i,t,e),!0===O&&nt.endShadows(),!0===this.info.autoReset&&this.info.reset(),st.render(u,t),d.setupLights(m.physicallyCorrectLights),e.isArrayCamera){let i=e.cameras;for(let e=0,n=i.length;e<n;e++){let n=i[e];_t(u,t,n,n.viewport)}}else _t(u,t,e);null!==b&&(Y.updateMultisampleRenderTarget(b),Y.updateRenderTargetMipmap(b)),!0===t.isScene&&t.onAfterRender(m,t,e),ct.resetDefaultState(),x=-1,w=null,f.pop(),d=f.length>0?f[f.length-1]:null,p.pop(),u=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return b},this.setRenderTargetTextures=function(t,e,i){q.get(t.texture).__webglTexture=e,q.get(t.depthTexture).__webglTexture=i;let n=q.get(t);n.__hasExternalTextures=!0,n.__hasExternalTextures&&(n.__autoAllocateDepthBuffer=void 0===i,n.__autoAllocateDepthBuffer||!0===j.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),n.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(t,e){let i=q.get(t);i.__webglFramebuffer=e,i.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;b=t,v=e,y=i;let n=!0,r=null,s=!1,a=!1;if(t){let i=q.get(t);void 0!==i.__useDefaultFramebuffer?(H.bindFramebuffer(36160,null),n=!1):void 0===i.__webglFramebuffer?Y.setupRenderTarget(t):i.__hasExternalTextures&&Y.rebindTextures(t,q.get(t.texture).__webglTexture,q.get(t.depthTexture).__webglTexture);let o=t.texture;(o.isData3DTexture||o.isDataArrayTexture||o.isCompressedArrayTexture)&&(a=!0);let l=q.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=l[e],s=!0):r=G.isWebGL2&&t.samples>0&&!1===Y.useMultisampledRTT(t)?q.get(t).__webglMultisampledFramebuffer:l,S.copy(t.viewport),A.copy(t.scissor),E=t.scissorTest}else S.copy(D).multiplyScalar(M).floor(),A.copy(k).multiplyScalar(M).floor(),E=I;if(H.bindFramebuffer(36160,r)&&G.drawBuffers&&n&&H.drawBuffers(t,r),H.viewport(S),H.scissor(A),H.setScissorTest(E),s){let n=q.get(t.texture);dt.framebufferTexture2D(36160,36064,34069+e,n.__webglTexture,i)}else if(a){let n=q.get(t.texture),r=e||0;dt.framebufferTextureLayer(36160,36064,n.__webglTexture,i||0,r)}x=-1},this.readRenderTargetPixels=function(t,e,i,n,r,s,a){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=q.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){H.bindFramebuffer(36160,o);try{let a=t.texture,o=a.format,l=a.type;if(o!==Zp&&ht.convert(o)!==dt.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");let h=l===Qp&&(j.has("EXT_color_buffer_half_float")||G.isWebGL2&&j.has("EXT_color_buffer_float"));if(l!==qp&&ht.convert(l)!==dt.getParameter(35738)&&(l!==Xp||!(G.isWebGL2||j.has("OES_texture_float")||j.has("WEBGL_color_buffer_float")))&&!h)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");e>=0&&e<=t.width-n&&i>=0&&i<=t.height-r&&dt.readPixels(e,i,n,r,ht.convert(o),ht.convert(l),s)}finally{let t=null!==b?q.get(b).__webglFramebuffer:null;H.bindFramebuffer(36160,t)}}},this.readRenderTargetPixelsAsync=async function(t,e,i,n,r,s,a){if(!t||!t.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=q.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){let a=t.texture,l=a.format,h=a.type;if(e>=0&&e<=t.width-n&&i>=0&&i<=t.height-r){H.bindFramebuffer(dt.FRAMEBUFFER,o);let t=dt.createBuffer();dt.bindBuffer(dt.PIXEL_PACK_BUFFER,t),dt.bufferData(dt.PIXEL_PACK_BUFFER,s.byteLength,dt.STREAM_READ),dt.readPixels(e,i,n,r,ht.convert(l),ht.convert(h),0);let a=null!==b?q.get(b).__webglFramebuffer:null;H.bindFramebuffer(dt.FRAMEBUFFER,a);let c=dt.fenceSync(dt.SYNC_GPU_COMMANDS_COMPLETE,0);return dt.flush(),await function(t,e,i){return new Promise((function(n,r){setTimeout((function s(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:r();break;case t.TIMEOUT_EXPIRED:setTimeout(s,i);break;default:n()}}),i)}))}(dt,c,4),dt.bindBuffer(dt.PIXEL_PACK_BUFFER,t),dt.getBufferSubData(dt.PIXEL_PACK_BUFFER,0,s),dt.deleteBuffer(t),dt.deleteSync(c),s}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=Math.pow(2,-i),r=Math.floor(e.image.width*n),s=Math.floor(e.image.height*n);Y.setTexture2D(e,0),dt.copyTexSubImage2D(3553,i,0,0,t.x,t.y,r,s),H.unbindTexture()},this.copyTextureToTexture=function(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=e.image.width,s=e.image.height,a=ht.convert(i.format),o=ht.convert(i.type);Y.setTexture2D(i,0),dt.pixelStorei(37440,i.flipY),dt.pixelStorei(37441,i.premultiplyAlpha),dt.pixelStorei(3317,i.unpackAlignment),e.isDataTexture?dt.texSubImage2D(3553,n,t.x,t.y,r,s,a,o,e.image.data):e.isCompressedTexture?dt.compressedTexSubImage2D(3553,n,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,a,e.mipmaps[0].data):dt.texSubImage2D(3553,n,t.x,t.y,a,o,e.image),0===n&&i.generateMipmaps&&dt.generateMipmap(3553),H.unbindTexture()},this.copyTextureToTexture3D=function(t,e,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(m.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");let s,a=t.max.x-t.min.x+1,o=t.max.y-t.min.y+1,l=t.max.z-t.min.z+1,h=ht.convert(n.format),c=ht.convert(n.type);if(n.isData3DTexture)Y.setTexture3D(n,0),s=32879;else{if(!n.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Y.setTexture2DArray(n,0),s=35866}dt.pixelStorei(37440,n.flipY),dt.pixelStorei(37441,n.premultiplyAlpha),dt.pixelStorei(3317,n.unpackAlignment);let u=dt.getParameter(3314),d=dt.getParameter(32878),p=dt.getParameter(3316),f=dt.getParameter(3315),g=dt.getParameter(32877),v=i.isCompressedTexture?i.mipmaps[0]:i.image;dt.pixelStorei(3314,v.width),dt.pixelStorei(32878,v.height),dt.pixelStorei(3316,t.min.x),dt.pixelStorei(3315,t.min.y),dt.pixelStorei(32877,t.min.z),i.isDataTexture||i.isData3DTexture?dt.texSubImage3D(s,r,e.x,e.y,e.z,a,o,l,h,c,v.data):i.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),dt.compressedTexSubImage3D(s,r,e.x,e.y,e.z,a,o,l,h,v.data)):dt.texSubImage3D(s,r,e.x,e.y,e.z,a,o,l,h,c,v),dt.pixelStorei(3314,u),dt.pixelStorei(32878,d),dt.pixelStorei(3316,p),dt.pixelStorei(3315,f),dt.pixelStorei(32877,g),0===r&&n.generateMipmaps&&dt.generateMipmap(s),H.unbindTexture()},this.initRenderTarget=function(t){void 0===q.get(t).__webglFramebuffer&&Y.setupRenderTarget(t)},this.initTexture=function(t){t.isCubeTexture?Y.setTextureCube(t,0):t.isData3DTexture?Y.setTexture3D(t,0):t.isDataArrayTexture||t.isCompressedArrayTexture?Y.setTexture2DArray(t,0):Y.setTexture2D(t,0),H.unbindTexture()},this.resetState=function(){v=0,y=0,b=null,H.reset(),ct.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}(class extends nx{}).prototype.isWebGL1Renderer=!0;var rx=class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;this.isFog=!0,this.name="",this.color=new nm(t),this.near=e,this.far=i}clone(){return new rx(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},sx=class extends gg{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){let e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.object.backgroundIntensity=this.backgroundIntensity),e}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(t){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=t}},ax=class{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=Sf,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Df()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let n=0,r=this.stride;n<r;n++)this.array[t+n]=e.array[i+n];return this}set(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Df()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Df()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},ox=new mm,lx=class{constructor(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)ox.fromBufferAttribute(this,e),ox.applyMatrix4(t),this.setXYZ(e,ox.x,ox.y,ox.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)ox.fromBufferAttribute(this,e),ox.applyNormalMatrix(t),this.setXYZ(e,ox.x,ox.y,ox.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)ox.fromBufferAttribute(this,e),ox.transformDirection(t),this.setXYZ(e,ox.x,ox.y,ox.z);return this}setX(t,e){return this.normalized&&(e=Ff(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=Ff(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=Ff(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=Ff(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=zf(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=zf(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=zf(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=zf(e,this.array)),e}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=Ff(e,this.array),i=Ff(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=Ff(e,this.array),i=Ff(i,this.array),n=Ff(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=Ff(e,this.array),i=Ff(i,this.array),n=Ff(n,this.array),r=Ff(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=r,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let e=0;e<this.count;e++){let i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return new Rg(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new lx(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let e=0;e<this.count;e++){let i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},hx=class extends gg{constructor(){super(),this.isBone=!0,this.type="Bone"}},cx=class extends hm{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(null,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:Up,arguments.length>9&&void 0!==arguments[9]?arguments[9]:Up,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>10?arguments[10]:void 0,arguments.length>11?arguments[11]:void 0),this.isDataTexture=!0,this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},ux=new Wm,dx=new Wm,px=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.uuid=Df(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new Wm)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){let e=new Wm;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){let e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){let e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){let t=this.bones,e=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let r=0,s=t.length;r<s;r++){let n=t[r]?t[r].matrixWorld:dx;ux.multiplyMatrices(n,e[r]),ux.toArray(i,16*r)}null!==n&&(n.needsUpdate=!0)}clone(){return new px(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=Lf(t),t=Math.max(t,4);let e=new Float32Array(t*t*4);e.set(this.boneMatrices);let i=new cx(e,t,t,Zp,Xp);return i.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=i,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){let i=this.bones[e];if(i.name===t)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,n=t.bones.length;i<n;i++){let n=t.bones[i],r=e[n];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),r=new hx),this.bones.push(r),this.boneInverses.push((new Wm).fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){let t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;let e=this.bones,i=this.boneInverses;for(let n=0,r=e.length;n<r;n++){let r=e[n];t.bones.push(r.uuid);let s=i[n];t.boneInverses.push(s.toArray())}return t}},fx=class extends Rg{constructor(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(t,e,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){let t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}},mx=new Wm,gx=new Wm,vx=[],yx=new Wm,bx=new rv,xx=class extends rv{constructor(t,e,i){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new fx(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1;for(let n=0;n<i;n++)this.setMatrixAt(n,yx)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){let i=this.matrixWorld,n=this.count;if(bx.geometry=this.geometry,bx.material=this.material,void 0!==bx.material)for(let r=0;r<n;r++){this.getMatrixAt(r,mx),gx.multiplyMatrices(i,mx),bx.matrixWorld=gx,bx.raycast(t,vx);for(let t=0,i=vx.length;t<i;t++){let i=vx[t];i.instanceId=r,i.object=this,e.push(i)}vx.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new fx(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}},wx=class extends Tg{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new nm(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}},Sx=new mm,Ax=new mm,Ex=new Wm,_x=new Hm,Cx=new Bm,Mx=class extends gg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Hg,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new wx;super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){let t=this.geometry;if(null===t.index){let e=t.attributes.position,i=[0];for(let t=1,n=e.count;t<n;t++)Sx.fromBufferAttribute(e,t-1),Ax.fromBufferAttribute(e,t),i[t]=i[t-1],i[t]+=Sx.distanceTo(Ax);t.setAttribute("lineDistance",new Bg(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){let i=this.geometry,n=this.matrixWorld,r=t.params.Line.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Cx.copy(i.boundingSphere),Cx.applyMatrix4(n),Cx.radius+=r,!1===t.ray.intersectsSphere(Cx))return;Ex.copy(n).invert(),_x.copy(t.ray).applyMatrix4(Ex);let a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new mm,h=new mm,c=new mm,u=new mm,d=this.isLineSegments?2:1,p=i.index,f=i.attributes.position;if(null!==p){for(let i=Math.max(0,s.start),n=Math.min(p.count,s.start+s.count)-1;i<n;i+=d){let n=p.getX(i),r=p.getX(i+1);if(l.fromBufferAttribute(f,n),h.fromBufferAttribute(f,r),_x.distanceSqToSegment(l,h,u,c)>o)continue;u.applyMatrix4(this.matrixWorld);let s=t.ray.origin.distanceTo(u);s<t.near||s>t.far||e.push({distance:s,point:c.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else{for(let i=Math.max(0,s.start),n=Math.min(f.count,s.start+s.count)-1;i<n;i+=d){if(l.fromBufferAttribute(f,i),h.fromBufferAttribute(f,i+1),_x.distanceSqToSegment(l,h,u,c)>o)continue;u.applyMatrix4(this.matrixWorld);let n=t.ray.origin.distanceTo(u);n<t.near||n>t.far||e.push({distance:n,point:c.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){let i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){let e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}},Px=new mm,Tx=new mm,Dx=class extends Mx{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let t=this.geometry;if(null===t.index){let e=t.attributes.position,i=[];for(let t=0,n=e.count;t<n;t+=2)Px.fromBufferAttribute(e,t),Tx.fromBufferAttribute(e,t+1),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+Px.distanceTo(Tx);t.setAttribute("lineDistance",new Bg(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},kx=class extends hm{constructor(t,e,i,n,r,s,a,o,l){super(t,e,i,n,r,s,a,o,l),this.isVideoTexture=!0,this.minFilter=void 0!==s?s:Gp,this.magFilter=void 0!==r?r:Gp,this.generateMipmaps=!1;let h=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){h.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){let t=this.image;"requestVideoFrameCallback"in t===!1&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},Ix=class extends hm{constructor(t,e,i,n,r,s,a,o,l){super(t,e,i,n,r,s,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},Rx=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){let i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){let t=this.getLengths();return t[t.length-1]}getLengths(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let e,i=[],n=this.getPoint(0),r=0;i.push(0);for(let s=1;s<=t;s++)e=this.getPoint(s/t),r+=e.distanceTo(n),i.push(r),n=e;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){let i,n=this.getLengths(),r=0,s=n.length;i=e||t*n[s-1];let a,o=0,l=s-1;for(;o<=l;)if(r=Math.floor(o+(l-o)/2),a=n[r]-i,a<0)o=r+1;else{if(!(a>0)){l=r;break}l=r-1}if(r=l,n[r]===i)return r/(s-1);let h=n[r];return(r+(i-h)/(n[r+1]-h))/(s-1)}getTangent(t,e){let i=t-1e-4,n=t+1e-4;i<0&&(i=0),n>1&&(n=1);let r=this.getPoint(i),s=this.getPoint(n),a=e||(r.isVector2?new Uf:new mm);return a.copy(s).sub(r).normalize(),a}getTangentAt(t,e){let i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e){let i=new mm,n=[],r=[],s=[],a=new mm,o=new Wm;for(let d=0;d<=t;d++){let e=d/t;n[d]=this.getTangentAt(e,new mm)}r[0]=new mm,s[0]=new mm;let l=Number.MAX_VALUE,h=Math.abs(n[0].x),c=Math.abs(n[0].y),u=Math.abs(n[0].z);h<=l&&(l=h,i.set(1,0,0)),c<=l&&(l=c,i.set(0,1,0)),u<=l&&i.set(0,0,1),a.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],a),s[0].crossVectors(n[0],r[0]);for(let d=1;d<=t;d++){if(r[d]=r[d-1].clone(),s[d]=s[d-1].clone(),a.crossVectors(n[d-1],n[d]),a.length()>Number.EPSILON){a.normalize();let t=Math.acos(kf(n[d-1].dot(n[d]),-1,1));r[d].applyMatrix4(o.makeRotationAxis(a,t))}s[d].crossVectors(n[d],r[d])}if(!0===e){let e=Math.acos(kf(r[0].dot(r[t]),-1,1));e/=t,n[0].dot(a.crossVectors(r[0],r[t]))>0&&(e=-e);for(let i=1;i<=t;i++)r[i].applyMatrix4(o.makeRotationAxis(n[i],e*i)),s[i].crossVectors(n[i],r[i])}return{tangents:n,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){let t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}},Ox=class extends Rx{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(t,e){let i=e||new Uf,n=2*Math.PI,r=this.aEndAngle-this.aStartAngle,s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=s?0:n),!0===this.aClockwise&&!s&&(r===n?r=-n:r-=n);let a=this.aStartAngle+t*r,o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){let t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),i=o-this.aX,n=l-this.aY;o=i*t-n*e+this.aX,l=i*e+n*t+this.aY}return i.set(o,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){let t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}};function Lx(){let t=0,e=0,i=0,n=0;function r(r,s,a,o){t=r,e=a,i=-3*r+3*s-2*a-o,n=2*r-2*s+a+o}return{initCatmullRom:function(t,e,i,n,s){r(e,i,s*(i-t),s*(n-e))},initNonuniformCatmullRom:function(t,e,i,n,s,a,o){let l=(e-t)/s-(i-t)/(s+a)+(i-e)/a,h=(i-e)/a-(n-e)/(a+o)+(n-i)/o;l*=a,h*=a,r(e,i,l,h)},calc:function(r){let s=r*r;return t+e*r+i*s+n*(s*r)}}}var Bx=new mm,zx=new Lx,Fx=new Lx,Nx=new Lx;function Ux(t,e,i,n,r){let s=.5*(n-e),a=.5*(r-i),o=t*t;return(2*i-2*n+s+a)*(t*o)+(-3*i+3*n-2*s-a)*o+s*t+i}function Vx(t,e,i,n){return function(t,e){let i=1-t;return i*i*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,i)+function(t,e){return t*t*e}(t,n)}function jx(t,e,i,n,r){return function(t,e){let i=1-t;return i*i*i*e}(t,e)+function(t,e){let i=1-t;return 3*i*i*t*e}(t,i)+function(t,e){return 3*(1-t)*t*t*e}(t,n)+function(t,e){return t*t*t*e}(t,r)}var Gx=class extends Rx{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uf,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Uf,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Uf,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Uf;super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Uf,i=this.v0,n=this.v1,r=this.v2,s=this.v3;return e.set(jx(t,i.x,n.x,r.x,s.x),jx(t,i.y,n.y,r.y,s.y)),e}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}},Hx=class extends Rx{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new mm,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mm,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new mm,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new mm;super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mm,i=this.v0,n=this.v1,r=this.v2,s=this.v3;return e.set(jx(t,i.x,n.x,r.x,s.x),jx(t,i.y,n.y,r.y,s.y),jx(t,i.z,n.z,r.z,s.z)),e}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}},Wx=class extends Rx{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uf,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Uf;super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Uf;return 1===t?e.copy(this.v2):(e.copy(this.v2).sub(this.v1),e.multiplyScalar(t).add(this.v1)),e}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){let i=e||new Uf;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},qx=class extends Rx{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new mm,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mm;super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mm;return 1===t?e.copy(this.v2):(e.copy(this.v2).sub(this.v1),e.multiplyScalar(t).add(this.v1)),e}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},Yx=class extends Rx{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uf,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Uf,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Uf;super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}getPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Uf,i=this.v0,n=this.v1,r=this.v2;return e.set(Vx(t,i.x,n.x,r.x),Vx(t,i.y,n.y,r.y)),e}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},Xx=class extends Rx{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Uf,i=this.points,n=(i.length-1)*t,r=Math.floor(n),s=n-r,a=i[0===r?r:r-1],o=i[r],l=i[r>i.length-2?i.length-1:r+1],h=i[r>i.length-3?i.length-1:r+2];return e.set(Ux(s,a.x,o.x,l.x,h.x),Ux(s,a.y,o.y,l.y,h.y)),e}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){let i=t.points[e];this.points.push(i.clone())}return this}toJSON(){let t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){let i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){let i=t.points[e];this.points.push((new Uf).fromArray(i))}return this}},Qx=Object.freeze({__proto__:null,ArcCurve:class extends Ox{constructor(t,e,i,n,r,s){super(t,e,i,i,n,r,s),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class extends Rx{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=n}getPoint(t){let e,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mm,r=this.points,s=r.length,a=(s-(this.closed?0:1))*t,o=Math.floor(a),l=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:0===l&&o===s-1&&(o=s-2,l=1),this.closed||o>0?e=r[(o-1)%s]:(Bx.subVectors(r[0],r[1]).add(r[0]),e=Bx);let h=r[o%s],c=r[(o+1)%s];if(this.closed||o+2<s?i=r[(o+2)%s]:(Bx.subVectors(r[s-1],r[s-2]).add(r[s-1]),i=Bx),"centripetal"===this.curveType||"chordal"===this.curveType){let t="chordal"===this.curveType?.5:.25,n=Math.pow(e.distanceToSquared(h),t),r=Math.pow(h.distanceToSquared(c),t),s=Math.pow(c.distanceToSquared(i),t);r<1e-4&&(r=1),n<1e-4&&(n=r),s<1e-4&&(s=r),zx.initNonuniformCatmullRom(e.x,h.x,c.x,i.x,n,r,s),Fx.initNonuniformCatmullRom(e.y,h.y,c.y,i.y,n,r,s),Nx.initNonuniformCatmullRom(e.z,h.z,c.z,i.z,n,r,s)}else"catmullrom"===this.curveType&&(zx.initCatmullRom(e.x,h.x,c.x,i.x,this.tension),Fx.initCatmullRom(e.y,h.y,c.y,i.y,this.tension),Nx.initCatmullRom(e.z,h.z,c.z,i.z,this.tension));return n.set(zx.calc(l),Fx.calc(l),Nx.calc(l)),n}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){let i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){let t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){let i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){let i=t.points[e];this.points.push((new mm).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}},CubicBezierCurve:Gx,CubicBezierCurve3:Hx,EllipseCurve:Ox,LineCurve:Wx,LineCurve3:qx,QuadraticBezierCurve:Yx,QuadraticBezierCurve3:class extends Rx{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new mm,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mm,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new mm;super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}getPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mm,i=this.v0,n=this.v1,r=this.v2;return e.set(Vx(t,i.x,n.x,r.x),Vx(t,i.y,n.y,r.y),Vx(t,i.z,n.z,r.z)),e}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},SplineCurve:Xx}),Kx=class extends Rx{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){let t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Wx(e,t))}getPoint(t,e){let i=t*this.getLength(),n=this.getCurveLengths(),r=0;for(;r<n.length;){if(n[r]>=i){let t=n[r]-i,s=this.curves[r],a=s.getLength(),o=0===a?0:1-t/a;return s.getPointAt(o,e)}r++}return null}getLength(){let t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let t=[],e=0;for(let i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e}getPoints(){let t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,i=[];for(let n=0,r=this.curves;n<r.length;n++){let s=r[n],a=s.isEllipseCurve?2*e:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,o=s.getPoints(a);for(let e=0;e<o.length;e++){let n=o[e];t&&t.equals(n)||(i.push(n),t=n)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(t){super.copy(t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){let i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}toJSON(){let t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){let i=this.curves[e];t.curves.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){let i=t.curves[e];this.curves.push((new Qx[i.type]).fromJSON(i))}return this}},Zx=class extends Kx{constructor(t){super(),this.type="Path",this.currentPoint=new Uf,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){let i=new Wx(this.currentPoint.clone(),new Uf(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,i,n){let r=new Yx(this.currentPoint.clone(),new Uf(t,e),new Uf(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(t,e,i,n,r,s){let a=new Gx(this.currentPoint.clone(),new Uf(t,e),new Uf(i,n),new Uf(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}splineThru(t){let e=[this.currentPoint.clone()].concat(t),i=new Xx(e);return this.curves.push(i),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,i,n,r,s){let a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(t+a,e+o,i,n,r,s),this}absarc(t,e,i,n,r,s){return this.absellipse(t,e,i,i,n,r,s),this}ellipse(t,e,i,n,r,s,a,o){let l=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(t+l,e+h,i,n,r,s,a,o),this}absellipse(t,e,i,n,r,s,a,o){let l=new Ox(t,e,i,n,r,s,a,o);if(this.curves.length>0){let t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);let h=l.getPoint(1);return this.currentPoint.copy(h),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){let t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}},Jx=class extends Hg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[new Uf(0,-.5),new Uf(.5,0),new Uf(0,.5)],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:n},e=Math.floor(e),n=kf(n,0,2*Math.PI);let r=[],s=[],a=[],o=[],l=[],h=1/e,c=new mm,u=new Uf,d=new mm,p=new mm,f=new mm,m=0,g=0;for(let v=0;v<=t.length-1;v++)switch(v){case 0:m=t[v+1].x-t[v].x,g=t[v+1].y-t[v].y,d.x=1*g,d.y=-m,d.z=0*g,f.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case t.length-1:o.push(f.x,f.y,f.z);break;default:m=t[v+1].x-t[v].x,g=t[v+1].y-t[v].y,d.x=1*g,d.y=-m,d.z=0*g,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),o.push(d.x,d.y,d.z),f.copy(p)}for(let v=0;v<=e;v++){let r=i+v*h*n,d=Math.sin(r),p=Math.cos(r);for(let i=0;i<=t.length-1;i++){c.x=t[i].x*d,c.y=t[i].y,c.z=t[i].x*p,s.push(c.x,c.y,c.z),u.x=v/e,u.y=i/(t.length-1),a.push(u.x,u.y);let n=o[3*i+0]*d,r=o[3*i+1],h=o[3*i+0]*p;l.push(n,r,h)}}for(let v=0;v<e;v++)for(let e=0;e<t.length-1;e++){let i=e+v*t.length,n=i,s=i+t.length,a=i+t.length+1,o=i+1;r.push(n,s,o),r.push(a,o,s)}this.setIndex(r),this.setAttribute("position",new Bg(s,3)),this.setAttribute("uv",new Bg(a,2)),this.setAttribute("normal",new Bg(l,3))}static fromJSON(t){return new Jx(t.points,t.segments,t.phiStart,t.phiLength)}},$x=class extends Hg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o};let l=this;n=Math.floor(n),r=Math.floor(r);let h=[],c=[],u=[],d=[],p=0,f=[],m=i/2,g=0;function v(i){let r=p,s=new Uf,f=new mm,v=0,y=!0===i?t:e,b=!0===i?1:-1;for(let t=1;t<=n;t++)c.push(0,m*b,0),u.push(0,b,0),d.push(.5,.5),p++;let x=p;for(let t=0;t<=n;t++){let e=t/n*o+a,i=Math.cos(e),r=Math.sin(e);f.x=y*r,f.y=m*b,f.z=y*i,c.push(f.x,f.y,f.z),u.push(0,b,0),s.x=.5*i+.5,s.y=.5*r*b+.5,d.push(s.x,s.y),p++}for(let t=0;t<n;t++){let e=r+t,n=x+t;!0===i?h.push(n,n+1,e):h.push(n+1,n,e),v+=3}l.addGroup(g,v,!0===i?1:2),g+=v}(function(){let s=new mm,v=new mm,y=0,b=(e-t)/i;for(let l=0;l<=r;l++){let h=[],g=l/r,y=g*(e-t)+t;for(let t=0;t<=n;t++){let e=t/n,r=e*o+a,l=Math.sin(r),f=Math.cos(r);v.x=y*l,v.y=-g*i+m,v.z=y*f,c.push(v.x,v.y,v.z),s.set(l,b,f).normalize(),u.push(s.x,s.y,s.z),d.push(e,1-g),h.push(p++)}f.push(h)}for(let t=0;t<n;t++)for(let e=0;e<r;e++){let i=f[e][t],n=f[e+1][t],r=f[e+1][t+1],s=f[e][t+1];h.push(i,n,s),h.push(n,r,s),y+=6}l.addGroup(g,y,0),g+=y})(),!1===s&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(h),this.setAttribute("position",new Bg(c,3)),this.setAttribute("normal",new Bg(u,3)),this.setAttribute("uv",new Bg(d,2))}static fromJSON(t){return new $x(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}},tw=class extends $x{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;super(0,t,e,i,n,r,s,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:s,thetaLength:a}}static fromJSON(t){return new tw(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}},ew=class extends Hg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:n};let r=[],s=[];function a(t,e,i,n){let r=n+1,s=[];for(let a=0;a<=r;a++){s[a]=[];let n=t.clone().lerp(i,a/r),o=e.clone().lerp(i,a/r),l=r-a;for(let t=0;t<=l;t++)s[a][t]=0===t&&a===r?n:n.clone().lerp(o,t/l)}for(let a=0;a<r;a++)for(let t=0;t<2*(r-a)-1;t++){let e=Math.floor(t/2);t%2===0?(o(s[a][e+1]),o(s[a+1][e]),o(s[a][e])):(o(s[a][e+1]),o(s[a+1][e+1]),o(s[a+1][e]))}}function o(t){r.push(t.x,t.y,t.z)}function l(e,i){let n=3*e;i.x=t[n+0],i.y=t[n+1],i.z=t[n+2]}function h(t,e,i,n){n<0&&1===t.x&&(s[e]=t.x-1),0===i.x&&0===i.z&&(s[e]=n/2/Math.PI+.5)}function c(t){return Math.atan2(t.z,-t.x)}function u(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}(function(t){let i=new mm,n=new mm,r=new mm;for(let s=0;s<e.length;s+=3)l(e[s+0],i),l(e[s+1],n),l(e[s+2],r),a(i,n,r,t)})(n),function(t){let e=new mm;for(let i=0;i<r.length;i+=3)e.x=r[i+0],e.y=r[i+1],e.z=r[i+2],e.normalize().multiplyScalar(t),r[i+0]=e.x,r[i+1]=e.y,r[i+2]=e.z}(i),function(){let t=new mm;for(let e=0;e<r.length;e+=3){t.x=r[e+0],t.y=r[e+1],t.z=r[e+2];let i=c(t)/2/Math.PI+.5,n=u(t)/Math.PI+.5;s.push(i,1-n)}(function(){let t=new mm,e=new mm,i=new mm,n=new mm,a=new Uf,o=new Uf,l=new Uf;for(let u=0,d=0;u<r.length;u+=9,d+=6){t.set(r[u+0],r[u+1],r[u+2]),e.set(r[u+3],r[u+4],r[u+5]),i.set(r[u+6],r[u+7],r[u+8]),a.set(s[d+0],s[d+1]),o.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),n.copy(t).add(e).add(i).divideScalar(3);let p=c(n);h(a,d+0,t,p),h(o,d+2,e,p),h(l,d+4,i,p)}})(),function(){for(let t=0;t<s.length;t+=6){let e=s[t+0],i=s[t+2],n=s[t+4],r=Math.max(e,i,n),a=Math.min(e,i,n);r>.9&&a<.1&&(e<.2&&(s[t+0]+=1),i<.2&&(s[t+2]+=1),n<.2&&(s[t+4]+=1))}}()}(),this.setAttribute("position",new Bg(r,3)),this.setAttribute("normal",new Bg(r.slice(),3)),this.setAttribute("uv",new Bg(s,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(t){return new ew(t.vertices,t.indices,t.radius,t.details)}},iw=class extends ew{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(1+Math.sqrt(5))/2,n=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new iw(t.radius,t.detail)}},nw=class extends Zx{constructor(t){super(t),this.uuid=Df(),this.type="Shape",this.holes=[]}getPointsHoles(t){let e=[];for(let i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){let i=t.holes[e];this.holes.push(i.clone())}return this}toJSON(){let t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){let i=this.holes[e];t.holes.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){let i=t.holes[e];this.holes.push((new Zx).fromJSON(i))}return this}},rw=function(t,e){let i,n,r,s,a,o,l,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,c=e&&e.length,u=c?e[0]*h:t.length,d=sw(t,0,u,h,!0),p=[];if(!d||d.next===d.prev)return p;if(c&&(d=function(t,e,i,n){let r,s,a,o,l,h=[];for(r=0,s=e.length;r<s;r++)a=e[r]*n,o=r<s-1?e[r+1]*n:t.length,l=sw(t,a,o,n,!1),l===l.next&&(l.steiner=!0),h.push(gw(l));for(h.sort(dw),r=0;r<h.length;r++)i=pw(h[r],i);return i}(t,e,d,h)),t.length>80*h){i=r=t[0],n=s=t[1];for(let e=h;e<u;e+=h)a=t[e],o=t[e+1],a<i&&(i=a),o<n&&(n=o),a>r&&(r=a),o>s&&(s=o);l=Math.max(r-i,s-n),l=0!==l?32767/l:0}return ow(d,p,h,i,n,l,0),p};function sw(t,e,i,n,r){let s,a;if(r===function(t,e,i,n){let r=0;for(let s=e,a=i-n;s<i;s+=n)r+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return r}(t,e,i,n)>0)for(s=e;s<i;s+=n)a=Cw(s,t[s],t[s+1],a);else for(s=i-n;s>=e;s-=n)a=Cw(s,t[s],t[s+1],a);return a&&xw(a,a.next)&&(Mw(a),a=a.next),a}function aw(t,e){if(!t)return t;e||(e=t);let i,n=t;do{if(i=!1,n.steiner||!xw(n,n.next)&&0!==bw(n.prev,n,n.next))n=n.next;else{if(Mw(n),n=e=n.prev,n===n.next)break;i=!0}}while(i||n!==e);return e}function ow(t,e,i,n,r,s,a){if(!t)return;!a&&s&&function(t,e,i,n){let r=t;do{0===r.z&&(r.z=mw(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,i,n,r,s,a,o,l,h=1;do{for(i=t,t=null,s=null,a=0;i;){for(a++,n=i,o=0,e=0;e<h&&(o++,n=n.nextZ,n);e++);for(l=h;o>0||l>0&&n;)0!==o&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,o--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,h*=2}while(a>1)}(r)}(t,n,r,s);let o,l,h=t;for(;t.prev!==t.next;)if(o=t.prev,l=t.next,s?hw(t,n,r,s):lw(t))e.push(o.i/i|0),e.push(t.i/i|0),e.push(l.i/i|0),Mw(t),t=l.next,h=l.next;else if((t=l)===h){a?1===a?ow(t=cw(aw(t),e,i),e,i,n,r,s,2):2===a&&uw(t,e,i,n,r,s):ow(aw(t),e,i,n,r,s,1);break}}function lw(t){let e=t.prev,i=t,n=t.next;if(bw(e,i,n)>=0)return!1;let r=e.x,s=i.x,a=n.x,o=e.y,l=i.y,h=n.y,c=r<s?r<a?r:a:s<a?s:a,u=o<l?o<h?o:h:l<h?l:h,d=r>s?r>a?r:a:s>a?s:a,p=o>l?o>h?o:h:l>h?l:h,f=n.next;for(;f!==e;){if(f.x>=c&&f.x<=d&&f.y>=u&&f.y<=p&&vw(r,o,s,l,a,h,f.x,f.y)&&bw(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function hw(t,e,i,n){let r=t.prev,s=t,a=t.next;if(bw(r,s,a)>=0)return!1;let o=r.x,l=s.x,h=a.x,c=r.y,u=s.y,d=a.y,p=o<l?o<h?o:h:l<h?l:h,f=c<u?c<d?c:d:u<d?u:d,m=o>l?o>h?o:h:l>h?l:h,g=c>u?c>d?c:d:u>d?u:d,v=mw(p,f,e,i,n),y=mw(m,g,e,i,n),b=t.prevZ,x=t.nextZ;for(;b&&b.z>=v&&x&&x.z<=y;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==a&&vw(o,c,l,u,h,d,b.x,b.y)&&bw(b.prev,b,b.next)>=0||(b=b.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==a&&vw(o,c,l,u,h,d,x.x,x.y)&&bw(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;b&&b.z>=v;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==a&&vw(o,c,l,u,h,d,b.x,b.y)&&bw(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;x&&x.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==a&&vw(o,c,l,u,h,d,x.x,x.y)&&bw(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function cw(t,e,i){let n=t;do{let r=n.prev,s=n.next.next;!xw(r,s)&&ww(r,n,n.next,s)&&Ew(r,s)&&Ew(s,r)&&(e.push(r.i/i|0),e.push(n.i/i|0),e.push(s.i/i|0),Mw(n),Mw(n.next),n=t=s),n=n.next}while(n!==t);return aw(n)}function uw(t,e,i,n,r,s){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.i!==t.i&&yw(a,t)){let o=_w(a,t);return a=aw(a,a.next),o=aw(o,o.next),ow(a,e,i,n,r,s,0),void ow(o,e,i,n,r,s,0)}t=t.next}a=a.next}while(a!==t)}function dw(t,e){return t.x-e.x}function pw(t,e){let i=function(t,e){let i,n=e,r=-1/0,s=t.x,a=t.y;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){let t=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=s&&t>r&&(r=t,i=n.x<n.next.x?n:n.next,t===s))return i}n=n.next}while(n!==e);if(!i)return null;let o,l=i,h=i.x,c=i.y,u=1/0;n=i;do{s>=n.x&&n.x>=h&&s!==n.x&&vw(a<c?s:r,a,h,c,a<c?r:s,a,n.x,n.y)&&(o=Math.abs(a-n.y)/(s-n.x),Ew(n,t)&&(o<u||o===u&&(n.x>i.x||n.x===i.x&&fw(i,n)))&&(i=n,u=o)),n=n.next}while(n!==l);return i}(t,e);if(!i)return e;let n=_w(i,t);return aw(n,n.next),aw(i,i.next)}function fw(t,e){return bw(t.prev,t,e.prev)<0&&bw(e.next,t,t.next)<0}function mw(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function gw(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function vw(t,e,i,n,r,s,a,o){return(r-a)*(e-o)>=(t-a)*(s-o)&&(t-a)*(n-o)>=(i-a)*(e-o)&&(i-a)*(s-o)>=(r-a)*(n-o)}function yw(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&ww(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(Ew(t,e)&&Ew(e,t)&&function(t,e){let i=t,n=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(bw(t.prev,t,e.prev)||bw(t,e.prev,e))||xw(t,e)&&bw(t.prev,t,t.next)>0&&bw(e.prev,e,e.next)>0)}function bw(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function xw(t,e){return t.x===e.x&&t.y===e.y}function ww(t,e,i,n){let r=Aw(bw(t,e,i)),s=Aw(bw(t,e,n)),a=Aw(bw(i,n,t)),o=Aw(bw(i,n,e));return!!(r!==s&&a!==o||0===r&&Sw(t,i,e)||0===s&&Sw(t,n,e)||0===a&&Sw(i,t,n)||0===o&&Sw(i,e,n))}function Sw(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Aw(t){return t>0?1:t<0?-1:0}function Ew(t,e){return bw(t.prev,t,t.next)<0?bw(t,e,t.next)>=0&&bw(t,t.prev,e)>=0:bw(t,e,t.prev)<0||bw(t,t.next,e)<0}function _w(t,e){let i=new Pw(t.i,t.x,t.y),n=new Pw(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function Cw(t,e,i,n){let r=new Pw(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function Mw(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Pw(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Tw=class{static area(t){let e=t.length,i=0;for(let n=e-1,r=0;r<e;n=r++)i+=t[n].x*t[r].y-t[r].x*t[n].y;return.5*i}static isClockWise(t){return Tw.area(t)<0}static triangulateShape(t,e){let i=[],n=[],r=[];Dw(t),kw(i,t);let s=t.length;e.forEach(Dw);for(let o=0;o<e.length;o++)n.push(s),s+=e[o].length,kw(i,e[o]);let a=rw(i,n);for(let o=0;o<a.length;o+=3)r.push(a.slice(o,o+3));return r}};function Dw(t){let e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function kw(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}var Iw=class extends ew{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Iw(t.radius,t.detail)}},Rw=class extends Hg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:s,thetaLength:a},e=Math.max(3,Math.floor(e)),i=Math.max(2,Math.floor(i));let o=Math.min(s+a,Math.PI),l=0,h=[],c=new mm,u=new mm,d=[],p=[],f=[],m=[];for(let g=0;g<=i;g++){let d=[],v=g/i,y=0;0==g&&0==s?y=.5/e:g==i&&o==Math.PI&&(y=-.5/e);for(let i=0;i<=e;i++){let o=i/e;c.x=-t*Math.cos(n+o*r)*Math.sin(s+v*a),c.y=t*Math.cos(s+v*a),c.z=t*Math.sin(n+o*r)*Math.sin(s+v*a),p.push(c.x,c.y,c.z),u.copy(c).normalize(),f.push(u.x,u.y,u.z),m.push(o+y,1-v),d.push(l++)}h.push(d)}for(let g=0;g<i;g++)for(let t=0;t<e;t++){let e=h[g][t+1],n=h[g][t],r=h[g+1][t],a=h[g+1][t+1];(0!==g||s>0)&&d.push(e,n,a),(g!==i-1||o<Math.PI)&&d.push(n,r,a)}this.setIndex(d),this.setAttribute("position",new Bg(p,3)),this.setAttribute("normal",new Bg(f,3)),this.setAttribute("uv",new Bg(m,2))}static fromJSON(t){return new Rw(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}},Ow=class extends Hg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:48,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:r},i=Math.floor(i),n=Math.floor(n);let s=[],a=[],o=[],l=[],h=new mm,c=new mm,u=new mm;for(let d=0;d<=i;d++)for(let s=0;s<=n;s++){let p=s/n*r,f=d/i*Math.PI*2;c.x=(t+e*Math.cos(f))*Math.cos(p),c.y=(t+e*Math.cos(f))*Math.sin(p),c.z=e*Math.sin(f),a.push(c.x,c.y,c.z),h.x=t*Math.cos(p),h.y=t*Math.sin(p),u.subVectors(c,h).normalize(),o.push(u.x,u.y,u.z),l.push(s/n),l.push(d/i)}for(let d=1;d<=i;d++)for(let t=1;t<=n;t++){let e=(n+1)*d+t-1,i=(n+1)*(d-1)+t-1,r=(n+1)*(d-1)+t,a=(n+1)*d+t;s.push(e,i,a),s.push(i,r,a)}this.setIndex(s),this.setAttribute("position",new Bg(a,3)),this.setAttribute("normal",new Bg(o,3)),this.setAttribute("uv",new Bg(l,2))}static fromJSON(t){return new Ow(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}},Lw=class extends Hg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:n,p:r,q:s},i=Math.floor(i),n=Math.floor(n);let a=[],o=[],l=[],h=[],c=new mm,u=new mm,d=new mm,p=new mm,f=new mm,m=new mm,g=new mm;for(let y=0;y<=i;++y){let a=y/i*r*Math.PI*2;v(a,r,s,t,d),v(a+.01,r,s,t,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let t=0;t<=n;++t){let r=t/n*Math.PI*2,s=-e*Math.cos(r),a=e*Math.sin(r);c.x=d.x+(s*g.x+a*f.x),c.y=d.y+(s*g.y+a*f.y),c.z=d.z+(s*g.z+a*f.z),o.push(c.x,c.y,c.z),u.subVectors(c,d).normalize(),l.push(u.x,u.y,u.z),h.push(y/i),h.push(t/n)}}for(let y=1;y<=i;y++)for(let t=1;t<=n;t++){let e=(n+1)*(y-1)+(t-1),i=(n+1)*y+(t-1),r=(n+1)*y+t,s=(n+1)*(y-1)+t;a.push(e,i,s),a.push(i,r,s)}function v(t,e,i,n,r){let s=Math.cos(t),a=Math.sin(t),o=i/e*t,l=Math.cos(o);r.x=n*(2+l)*.5*s,r.y=n*(2+l)*a*.5,r.z=n*Math.sin(o)*.5}this.setIndex(a),this.setAttribute("position",new Bg(o,3)),this.setAttribute("normal",new Bg(l,3)),this.setAttribute("uv",new Bg(h,2))}static fromJSON(t){return new Lw(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}},Bw=class extends uv{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}};function zw(t,e,i){return Nw(t)?new t.constructor(t.subarray(e,void 0!==i?i:t.length)):t.slice(e,i)}function Fw(t,e,i){return!t||!i&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)}function Nw(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Uw(t){let e=t.length,i=new Array(e);for(let n=0;n!==e;++n)i[n]=n;return i.sort((function(e,i){return t[e]-t[i]})),i}function Vw(t,e,i){let n=t.length,r=new t.constructor(n);for(let s=0,a=0;a!==n;++s){let n=i[s]*e;for(let i=0;i!==e;++i)r[a++]=t[n+i]}return r}function jw(t,e,i,n){let r=1,s=t[0];for(;void 0!==s&&void 0===s[n];)s=t[r++];if(void 0===s)return;let a=s[n];if(void 0!==a)if(Array.isArray(a))do{a=s[n],void 0!==a&&(e.push(s.time),i.push.apply(i,a)),s=t[r++]}while(void 0!==s);else if(void 0!==a.toArray)do{a=s[n],void 0!==a&&(e.push(s.time),a.toArray(i,i.length)),s=t[r++]}while(void 0!==s);else do{a=s[n],void 0!==a&&(e.push(s.time),i.push(a)),s=t[r++]}while(void 0!==s)}var Gw=class{constructor(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){let e=this.parameterPositions,i=this._cachedIndex,n=e[i],r=e[i-1];t:{e:{let s;i:{n:if(!(t<n)){for(let s=i+2;;){if(void 0===n){if(t<r)break n;return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===s)break;if(r=n,n=e[++i],t<n)break e}s=e.length;break i}if(t>=r)break t;{let a=e[1];t<a&&(i=2,r=a);for(let s=i-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(i===s)break;if(n=r,r=e[--i-1],t>=r)break e}s=i,i=0}}for(;i<s;){let n=i+s>>>1;t<e[n]?s=n:i=n+1}if(n=e[i],r=e[i-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===n)return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){let e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=t*n;for(let s=0;s!==n;++s)e[s]=i[r+s];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},Hw=class extends Gw{constructor(t,e,i,n){super(t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:df,endingEnd:df}}intervalChanged_(t,e,i){let n=this.parameterPositions,r=t-2,s=t+1,a=n[r],o=n[s];if(void 0===a)switch(this.getSettings_().endingStart){case pf:r=t,a=2*e-i;break;case ff:r=n.length-2,a=e+n[r]-n[r+1];break;default:r=t,a=i}if(void 0===o)switch(this.getSettings_().endingEnd){case pf:s=t,o=2*i-e;break;case ff:s=1,o=i+n[1]-n[0];break;default:s=t-1,o=e}let l=.5*(i-e),h=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(o-i),this._offsetPrev=r*h,this._offsetNext=s*h}interpolate_(t,e,i,n){let r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,h=this._offsetPrev,c=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(i-e)/(n-e),f=p*p,m=f*p,g=-u*m+2*u*f-u*p,v=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,b=d*m-d*f;for(let x=0;x!==a;++x)r[x]=g*s[h+x]+v*s[l+x]+y*s[o+x]+b*s[c+x];return r}},Ww=class extends Gw{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){let r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,h=(i-e)/(n-e),c=1-h;for(let u=0;u!==a;++u)r[u]=s[l+u]*c+s[o+u]*h;return r}},qw=class extends Gw{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t){return this.copySampleValue_(t-1)}},Yw=class{constructor(t,e,i,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Fw(e,this.TimeBufferType),this.values=Fw(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){let e,i=t.constructor;if(i.toJSON!==this.toJSON)e=i.toJSON(t);else{e={name:t.name,times:Fw(t.times,Array),values:Fw(t.values,Array)};let i=t.getInterpolation();i!==t.DefaultInterpolation&&(e.interpolation=i)}return e.type=t.ValueTypeName,e}InterpolantFactoryMethodDiscrete(t){return new qw(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Ww(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Hw(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case hf:e=this.InterpolantFactoryMethodDiscrete;break;case cf:e=this.InterpolantFactoryMethodLinear;break;case uf:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){let e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return hf;case this.InterpolantFactoryMethodLinear:return cf;case this.InterpolantFactoryMethodSmooth:return uf}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){let e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]+=t}return this}scale(t){if(1!==t){let e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]*=t}return this}trim(t,e){let i=this.times,n=i.length,r=0,s=n-1;for(;r!==n&&i[r]<t;)++r;for(;-1!==s&&i[s]>e;)--s;if(++s,0!==r||s!==n){r>=s&&(s=Math.max(s,1),r=s-1);let t=this.getValueSize();this.times=zw(i,r,s),this.values=zw(this.values,r*t,s*t)}return this}validate(){let t=!0,e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);let i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let a=0;a!==r;a++){let e=i[a];if("number"==typeof e&&isNaN(e)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,e),t=!1;break}if(null!==s&&s>e){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,e,s),t=!1;break}s=e}if(void 0!==n&&Nw(n))for(let a=0,o=n.length;a!==o;++a){let e=n[a];if(isNaN(e)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,e),t=!1;break}}return t}optimize(){let t=zw(this.times),e=zw(this.values),i=this.getValueSize(),n=this.getInterpolation()===uf,r=t.length-1,s=1;for(let a=1;a<r;++a){let r=!1,o=t[a];if(o!==t[a+1]&&(1!==a||o!==t[0]))if(n)r=!0;else{let t=a*i,n=t-i,s=t+i;for(let a=0;a!==i;++a){let i=e[t+a];if(i!==e[n+a]||i!==e[s+a]){r=!0;break}}}if(r){if(a!==s){t[s]=t[a];let n=a*i,r=s*i;for(let t=0;t!==i;++t)e[r+t]=e[n+t]}++s}}if(r>0){t[s]=t[r];for(let t=r*i,n=s*i,a=0;a!==i;++a)e[n+a]=e[t+a];++s}return s!==t.length?(this.times=zw(t,0,s),this.values=zw(e,0,s*i)):(this.times=t,this.values=e),this}clone(){let t=zw(this.times,0),e=zw(this.values,0),i=new(0,this.constructor)(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}};Yw.prototype.TimeBufferType=Float32Array,Yw.prototype.ValueBufferType=Float32Array,Yw.prototype.DefaultInterpolation=cf;var Xw=class extends Yw{};Xw.prototype.ValueTypeName="bool",Xw.prototype.ValueBufferType=Array,Xw.prototype.DefaultInterpolation=hf,Xw.prototype.InterpolantFactoryMethodLinear=void 0,Xw.prototype.InterpolantFactoryMethodSmooth=void 0;var Qw=class extends Yw{};Qw.prototype.ValueTypeName="color";var Kw=class extends Yw{};Kw.prototype.ValueTypeName="number";var Zw=class extends Gw{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){let r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(i-e)/(n-e),l=t*a;for(let h=l+a;l!==h;l+=4)fm.slerpFlat(r,0,s,l-a,s,l,o);return r}},Jw=class extends Yw{InterpolantFactoryMethodLinear(t){return new Zw(this.times,this.values,this.getValueSize(),t)}};Jw.prototype.ValueTypeName="quaternion",Jw.prototype.DefaultInterpolation=cf,Jw.prototype.InterpolantFactoryMethodSmooth=void 0;var $w=class extends Yw{};$w.prototype.ValueTypeName="string",$w.prototype.ValueBufferType=Array,$w.prototype.DefaultInterpolation=hf,$w.prototype.InterpolantFactoryMethodLinear=void 0,$w.prototype.InterpolantFactoryMethodSmooth=void 0;var tS=class extends Yw{};tS.prototype.ValueTypeName="vector";var eS=class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:mf;this.name=t,this.tracks=i,this.duration=e,this.blendMode=n,this.uuid=Df(),this.duration<0&&this.resetDuration()}static parse(t){let e=[],i=t.tracks,n=1/(t.fps||1);for(let s=0,a=i.length;s!==a;++s)e.push(iS(i[s]).scale(n));let r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r}static toJSON(t){let e=[],i=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let r=0,s=i.length;r!==s;++r)e.push(Yw.toJSON(i[r]));return n}static CreateFromMorphTargetSequence(t,e,i,n){let r=e.length,s=[];for(let a=0;a<r;a++){let t=[],o=[];t.push((a+r-1)%r,a,(a+1)%r),o.push(0,1,0);let l=Uw(t);t=Vw(t,1,l),o=Vw(o,1,l),!n&&0===t[0]&&(t.push(r),o.push(o[0])),s.push(new Kw(".morphTargetInfluences["+e[a].name+"]",t,o).scale(1/i))}return new this(t,-1,s)}static findByName(t,e){let i=t;if(!Array.isArray(t)){let e=t;i=e.geometry&&e.geometry.animations||e.animations}for(let n=0;n<i.length;n++)if(i[n].name===e)return i[n];return null}static CreateClipsFromMorphTargetSequences(t,e,i){let n={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,o=t.length;a<o;a++){let e=t[a],i=e.name.match(r);if(i&&i.length>1){let t=i[1],r=n[t];r||(n[t]=r=[]),r.push(e)}}let s=[];for(let a in n)s.push(this.CreateFromMorphTargetSequence(a,n[a],e,i));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(t,e,i,n,r){if(0!==i.length){let s=[],a=[];jw(i,s,a,n),0!==s.length&&r.push(new t(e,s,a))}},n=[],r=t.name||"default",s=t.fps||30,a=t.blendMode,o=t.length||-1,l=t.hierarchy||[];for(let h=0;h<l.length;h++){let t=l[h].keys;if(t&&0!==t.length)if(t[0].morphTargets){let e,i={};for(e=0;e<t.length;e++)if(t[e].morphTargets)for(let n=0;n<t[e].morphTargets.length;n++)i[t[e].morphTargets[n]]=-1;for(let r in i){let i=[],s=[];for(let n=0;n!==t[e].morphTargets.length;++n){let n=t[e];i.push(n.time),s.push(n.morphTarget===r?1:0)}n.push(new Kw(".morphTargetInfluence["+r+"]",i,s))}o=i.length*s}else{let r=".bones["+e[h].name+"]";i(tS,r+".position",t,"pos",n),i(Jw,r+".quaternion",t,"rot",n),i(tS,r+".scale",t,"scl",n)}}return 0===n.length?null:new this(r,o,n,a)}resetDuration(){let t=0;for(let e=0,i=this.tracks.length;e!==i;++e){let i=this.tracks[e];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){let t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function iS(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Kw;case"vector":case"vector2":case"vector3":case"vector4":return tS;case"color":return Qw;case"quaternion":return Jw;case"bool":case"boolean":return Xw;case"string":return $w}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){let e=[],i=[];jw(t.keys,e,i,"value"),t.times=e,t.values=i}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}var nS={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}},rS=class{constructor(t,e,i){let n,r=this,s=!1,a=0,o=0,l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){o++,!1===s&&void 0!==r.onStart&&r.onStart(t,a,o),s=!0},this.itemEnd=function(t){a++,void 0!==r.onProgress&&r.onProgress(t,a,o),a===o&&(s=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(t){void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return n?n(t):t},this.setURLModifier=function(t){return n=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){let e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,i=l.length;e<i;e+=2){let i=l[e],n=l[e+1];if(i.global&&(i.lastIndex=0),i.test(t))return n}return null}}},sS=new rS,aS=class{constructor(t){this.manager=void 0!==t?t:sS,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){let i=this;return new Promise((function(n,r){i.load(t,n,e,r)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}},oS={},lS=class extends Error{constructor(t,e){super(t),this.response=e}},hS=class extends aS{constructor(t){super(t)}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);let r=nS.get(t);if(void 0!==r)return this.manager.itemStart(t),setTimeout((()=>{e&&e(r),this.manager.itemEnd(t)}),0),r;if(void 0!==oS[t])return void oS[t].push({onLoad:e,onProgress:i,onError:n});oS[t]=[],oS[t].push({onLoad:e,onProgress:i,onError:n});let s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||void 0===e.body||void 0===e.body.getReader)return e;let i=oS[t],n=e.body.getReader(),r=e.headers.get("Content-Length")||e.headers.get("X-File-Size"),s=r?parseInt(r):0,a=0!==s,o=0,l=new ReadableStream({start(t){!function e(){n.read().then((n=>{let{done:r,value:l}=n;if(r)t.close();else{o+=l.byteLength;let n=new ProgressEvent("progress",{lengthComputable:a,loaded:o,total:s});for(let t=0,e=i.length;t<e;t++){let e=i[t];e.onProgress&&e.onProgress(n)}t.enqueue(l),e()}}))}()}});return new Response(l)}throw new lS(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`,e)})).then((t=>{switch(o){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,a)));case"json":return t.json();default:if(void 0===a)return t.text();{let e=/charset="?([^;"\s]*)"?/i.exec(a),i=e&&e[1]?e[1].toLowerCase():void 0,n=new TextDecoder(i);return t.arrayBuffer().then((t=>n.decode(t)))}}})).then((e=>{nS.add(t,e);let i=oS[t];delete oS[t];for(let t=0,n=i.length;t<n;t++){let n=i[t];n.onLoad&&n.onLoad(e)}})).catch((e=>{let i=oS[t];if(void 0===i)throw this.manager.itemError(t),e;delete oS[t];for(let t=0,n=i.length;t<n;t++){let n=i[t];n.onError&&n.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}},cS=class extends aS{constructor(t){super(t)}load(t,e,i,n){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);let r=this,s=nS.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;let a=qf("img");function o(){h(),nS.add(t,this),e&&e(this),r.manager.itemEnd(t)}function l(e){h(),n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)}function h(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(t),a.src=t,a}},uS=class extends aS{constructor(t){super(t)}load(t,e,i,n){let r=new hm,s=new cS(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r)}),i,n),r}},dS=class extends gg{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.isLight=!0,this.type="Light",this.color=new nm(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){let e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}},pS=class extends dS{constructor(t,e,i){super(t,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(gg.DEFAULT_UP),this.updateMatrix(),this.groundColor=new nm(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}},fS=new Wm,mS=new mm,gS=new mm,vS=class{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Uf(512,512),this.map=null,this.mapPass=null,this.matrix=new Wm,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Ev,this._frameExtents=new Uf(1,1),this._viewportCount=1,this._viewports=[new cm(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){let e=this.camera,i=this.matrix;mS.setFromMatrixPosition(t.matrixWorld),e.position.copy(mS),gS.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(gS),e.updateMatrixWorld(),fS.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(fS),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(fS)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){let t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}},yS=class extends vS{constructor(){super(new pv(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){let e=this.camera,i=2*Tf*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;(i!==e.fov||n!==e.aspect||r!==e.far)&&(e.fov=i,e.aspect=n,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}},bS=class extends dS{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(gg.DEFAULT_UP),this.updateMatrix(),this.target=new gg,this.distance=i,this.angle=n,this.penumbra=r,this.decay=s,this.map=null,this.shadow=new yS}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}},xS=new Wm,wS=new mm,SS=new mm,AS=class extends vS{constructor(){super(new pv(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Uf(4,2),this._viewportCount=6,this._viewports=[new cm(2,1,1,1),new cm(0,1,1,1),new cm(3,1,1,1),new cm(1,1,1,1),new cm(3,0,1,1),new cm(1,0,1,1)],this._cubeDirections=[new mm(1,0,0),new mm(-1,0,0),new mm(0,0,1),new mm(0,0,-1),new mm(0,1,0),new mm(0,-1,0)],this._cubeUps=[new mm(0,1,0),new mm(0,1,0),new mm(0,1,0),new mm(0,1,0),new mm(0,0,1),new mm(0,0,-1)]}updateMatrices(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.camera,n=this.matrix,r=t.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),wS.setFromMatrixPosition(t.matrixWorld),i.position.copy(wS),SS.copy(i.position),SS.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(SS),i.updateMatrixWorld(),n.makeTranslation(-wS.x,-wS.y,-wS.z),xS.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(xS)}},ES=class extends dS{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new AS}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}},_S=class extends vS{constructor(){super(new Fv(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},CS=class extends dS{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(gg.DEFAULT_UP),this.updateMatrix(),this.target=new gg,this.shadow=new _S}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}},MS=class extends Hg{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){let t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}},PS=class extends aS{constructor(t){super(t)}load(t,e,i,n){let r=this,s=new hS(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,(function(i){try{e(r.parse(JSON.parse(i)))}catch(s){n?n(s):console.error(s),r.manager.itemError(t)}}),i,n)}parse(t){let e={},i={};function n(t,n){if(void 0!==e[n])return e[n];let r=t.interleavedBuffers[n],s=function(t,e){if(void 0!==i[e])return i[e];let n=t.arrayBuffers[e],r=new Uint32Array(n).buffer;return i[e]=r,r}(t,r.buffer),a=Wf(r.type,s),o=new ax(a,r.stride);return o.uuid=r.uuid,e[n]=o,o}let r=t.isInstancedBufferGeometry?new MS:new Hg,s=t.data.index;if(void 0!==s){let t=Wf(s.type,s.array);r.setIndex(new Rg(t,1))}let a=t.data.attributes;for(let c in a){let e,i=a[c];if(i.isInterleavedBufferAttribute){let r=n(t.data,i.data);e=new lx(r,i.itemSize,i.offset,i.normalized)}else{let t=Wf(i.type,i.array);e=new(i.isInstancedBufferAttribute?fx:Rg)(t,i.itemSize,i.normalized)}void 0!==i.name&&(e.name=i.name),void 0!==i.usage&&e.setUsage(i.usage),void 0!==i.updateRange&&(e.updateRange.offset=i.updateRange.offset,e.updateRange.count=i.updateRange.count),r.setAttribute(c,e)}let o=t.data.morphAttributes;if(o)for(let c in o){let e=o[c],i=[];for(let r=0,s=e.length;r<s;r++){let s,a=e[r];if(a.isInterleavedBufferAttribute){let e=n(t.data,a.data);s=new lx(e,a.itemSize,a.offset,a.normalized)}else{let t=Wf(a.type,a.array);s=new Rg(t,a.itemSize,a.normalized)}void 0!==a.name&&(s.name=a.name),i.push(s)}r.morphAttributes[c]=i}t.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);let l=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==l)for(let c=0,u=l.length;c!==u;++c){let t=l[c];r.addGroup(t.start,t.count,t.materialIndex)}let h=t.data.boundingSphere;if(void 0!==h){let t=new mm;void 0!==h.center&&t.fromArray(h.center),r.boundingSphere=new Bm(t,h.radius)}return t.name&&(r.name=t.name),t.userData&&(r.userData=t.userData),r}},TS=class{constructor(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=DS(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let e=DS();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}};function DS(){return(typeof performance>"u"?Date:performance).now()}var kS=class{constructor(t,e,i){let n,r,s;switch(this.binding=t,this.valueSize=i,e){case"quaternion":n=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){let i=this.buffer,n=this.valueSize,r=t*n+n,s=this.cumulativeWeight;if(0===s){for(let t=0;t!==n;++t)i[r+t]=i[t];s=e}else{s+=e;let t=e/s;this._mixBufferRegion(i,r,0,t,n)}this.cumulativeWeight=s}accumulateAdditive(t){let e=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,n,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){let e=this.valueSize,i=this.buffer,n=t*e+e,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){let t=e*this._origIndex;this._mixBufferRegion(i,n,t,1-r,e)}s>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*e,1,e);for(let o=e,l=e+e;o!==l;++o)if(i[o]!==i[o+e]){a.setValue(i,n);break}}saveOriginalState(){let t=this.binding,e=this.buffer,i=this.valueSize,n=i*this._origIndex;t.getValue(e,n);for(let r=i,s=n;r!==s;++r)e[r]=e[n+r%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){let t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,n,r){if(n>=.5)for(let s=0;s!==r;++s)t[e+s]=t[i+s]}_slerp(t,e,i,n){fm.slerpFlat(t,e,t,e,t,i,n)}_slerpAdditive(t,e,i,n,r){let s=this._workIndex*r;fm.multiplyQuaternionsFlat(t,s,t,e,t,i),fm.slerpFlat(t,e,t,e,t,s,n)}_lerp(t,e,i,n,r){let s=1-n;for(let a=0;a!==r;++a){let r=e+a;t[r]=t[r]*s+t[i+a]*n}}_lerpAdditive(t,e,i,n,r){for(let s=0;s!==r;++s){let r=e+s;t[r]=t[r]+t[i+s]*n}}},IS="\\[\\]\\.:\\/",RS=new RegExp("["+IS+"]","g"),OS="[^"+IS+"]",LS="[^"+IS.replace("\\.","")+"]",BS=/((?:WC+[\/:])*)/.source.replace("WC",OS),zS=/(WCOD+)?/.source.replace("WCOD",LS),FS=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",OS),NS=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",OS),US=new RegExp("^"+BS+zS+FS+NS+"$"),VS=["material","materials","bones","map"],jS=class{constructor(t,e,i){this.path=e,this.parsedPath=i||jS.parseTrackName(e),this.node=jS.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new jS.Composite(t,e,i):new jS(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(RS,"")}static parseTrackName(t){let e=US.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);let i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){let t=i.nodeName.substring(n+1);-1!==VS.indexOf(t)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=t)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){let i=t.skeleton.getBoneByName(e);if(void 0!==i)return i}if(t.children){let i=function(t){for(let n=0;n<t.length;n++){let r=t[n];if(r.name===e||r.uuid===e)return r;let s=i(r.children);if(s)return s}return null},n=i(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)t[e++]=i[n]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++]}_setValue_array_setNeedsUpdate(t,e){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node,e=this.parsedPath,i=e.objectName,n=e.propertyName,r=e.propertyIndex;if(t||(t=jS.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let n=e.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===n){n=e;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==n){if(void 0===t[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[n]}}let s=t[n];if(void 0===s){let i=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",t)}let a=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};jS.Composite=class{constructor(t,e,i){let n=i||jS.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}getValue(t,e){this.bind();let i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(t,e)}setValue(t,e){let i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(t,e)}bind(){let t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){let t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}},jS.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},jS.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},jS.prototype.GetterByBindingType=[jS.prototype._getValue_direct,jS.prototype._getValue_array,jS.prototype._getValue_arrayElement,jS.prototype._getValue_toArray],jS.prototype.SetterByBindingTypeAndVersioning=[[jS.prototype._setValue_direct,jS.prototype._setValue_direct_setNeedsUpdate,jS.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[jS.prototype._setValue_array,jS.prototype._setValue_array_setNeedsUpdate,jS.prototype._setValue_array_setMatrixWorldNeedsUpdate],[jS.prototype._setValue_arrayElement,jS.prototype._setValue_arrayElement_setNeedsUpdate,jS.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[jS.prototype._setValue_fromArray,jS.prototype._setValue_fromArray_setNeedsUpdate,jS.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var GS=class{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.blendMode;this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=n;let r=e.tracks,s=r.length,a=new Array(s),o={endingStart:df,endingEnd:df};for(let l=0;l!==s;++l){let t=r[l].createInterpolant(null);a[l]=t,t.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){let i=this._clip.duration,n=t._clip.duration,r=n/i,s=i/n;t.warp(1,r,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){let t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){let n=this._mixer,r=n.time,s=this.timeScale,a=this._timeScaleInterpolant;null===a&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);let o=a.parameterPositions,l=a.sampleValues;return o[0]=r,o[1]=r+i,l[0]=t/s,l[1]=e/s,this}stopWarping(){let t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,n){if(!this.enabled)return void this._updateWeight(t);let r=this._startTime;if(null!==r){let n=(t-r)*i;n<0||0===i?e=0:(this._startTime=null,e=i*n)}e*=this._updateTimeScale(t);let s=this._updateTime(e),a=this._updateWeight(t);if(a>0){let t=this._interpolants,e=this._propertyBindings;if(2501===this.blendMode)for(let i=0,n=t.length;i!==n;++i)t[i].evaluate(s),e[i].accumulateAdditive(a);else for(let i=0,r=t.length;i!==r;++i)t[i].evaluate(s),e[i].accumulate(n,a)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;let i=this._weightInterpolant;if(null!==i){let n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;let i=this._timeScaleInterpolant;if(null!==i){e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){let e=this._clip.duration,i=this.loop,n=this.time+t,r=this._loopCount,s=i===lf;if(0===t)return-1===r?n:s&&1===(1&r)?e-n:n;if(2200===i){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(n>=e)n=e;else{if(!(n<0)){this.time=n;break t}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),n>=e||n<0){let i=Math.floor(n/e);n-=e*i,r+=Math.abs(i);let a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?e:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===a){let e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(s&&1===(1&r))return e-n}return n}_setEndings(t,e,i){let n=this._interpolantSettings;i?(n.endingStart=pf,n.endingEnd=pf):(n.endingStart=t?this.zeroSlopeAtStart?pf:df:ff,n.endingEnd=e?this.zeroSlopeAtEnd?pf:df:ff)}_scheduleFading(t,e,i){let n=this._mixer,r=n.time,s=this._weightInterpolant;null===s&&(s=n._lendControlInterpolant(),this._weightInterpolant=s);let a=s.parameterPositions,o=s.sampleValues;return a[0]=r,o[0]=e,a[1]=r+t,o[1]=i,this}},HS=new Float32Array(1),WS=class extends _f{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){let i=t._localRoot||this._root,n=t._clip.tracks,r=n.length,s=t._propertyBindings,a=t._interpolants,o=i.uuid,l=this._bindingsByRootAndName,h=l[o];void 0===h&&(h={},l[o]=h);for(let c=0;c!==r;++c){let t=n[c],r=t.name,l=h[r];if(void 0!==l)++l.referenceCount,s[c]=l;else{if(l=s[c],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,o,r));continue}let n=e&&e._propertyBindings[c].binding.parsedPath;l=new kS(jS.create(i,r,n),t.ValueTypeName,t.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,o,r),s[c]=l}a[c].resultBuffer=l.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){let e=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,i,e)}let e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){let i=e[t];0===i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){let e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){let i=e[t];0===--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){let e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,i){let n=this._actions,r=this._actionsByClip,s=r[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=s;else{let e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=n.length,n.push(t),s.actionByRoot[i]=t}_removeInactiveAction(t){let e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n,e[n]=i,e.pop(),t._cacheIndex=null;let r=t._clip.uuid,s=this._actionsByClip,a=s[r],o=a.knownActions,l=o[o.length-1],h=t._byClipCacheIndex;l._byClipCacheIndex=h,o[h]=l,o.pop(),t._byClipCacheIndex=null,delete a.actionByRoot[(t._localRoot||this._root).uuid],0===o.length&&delete s[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){let e=t._propertyBindings;for(let i=0,n=e.length;i!==n;++i){let t=e[i];0===--t.referenceCount&&this._removeInactiveBinding(t)}}_lendAction(t){let e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackAction(t){let e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_addInactiveBinding(t,e,i){let n=this._bindingsByRootAndName,r=this._bindings,s=n[e];void 0===s&&(s={},n[e]=s),s[i]=t,t._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){let e=this._bindings,i=t.binding,n=i.rootNode.uuid,r=i.path,s=this._bindingsByRootAndName,a=s[n],o=e[e.length-1],l=t._cacheIndex;o._cacheIndex=l,e[l]=o,e.pop(),delete a[r],0===Object.keys(a).length&&delete s[n]}_lendBinding(t){let e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackBinding(t){let e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_lendControlInterpolant(){let t=this._controlInterpolants,e=this._nActiveControlInterpolants++,i=t[e];return void 0===i&&(i=new Ww(new Float32Array(2),new Float32Array(2),1,HS),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){let e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,r=e[n];t.__cacheIndex=n,e[n]=t,r.__cacheIndex=i,e[i]=r}clipAction(t,e,i){let n=e||this._root,r=n.uuid,s="string"==typeof t?eS.findByName(n,t):t,a=null!==s?s.uuid:t,o=this._actionsByClip[a],l=null;if(void 0===i&&(i=null!==s?s.blendMode:mf),void 0!==o){let t=o.actionByRoot[r];if(void 0!==t&&t.blendMode===i)return t;l=o.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;let h=new GS(this,s,e,i);return this._bindAction(h,l),this._addInactiveAction(h,a,r),h}existingAction(t,e){let i=e||this._root,n=i.uuid,r="string"==typeof t?eS.findByName(i,t):t,s=r?r.uuid:t,a=this._actionsByClip[s];return void 0!==a&&a.actionByRoot[n]||null}stopAllAction(){let t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;let e=this._actions,i=this._nActiveActions,n=this.time+=t,r=Math.sign(t),s=this._accuIndex^=1;for(let l=0;l!==i;++l)e[l]._update(n,t,r,s);let a=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)a[l].apply(s);return this}setTime(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){let e=this._actions,i=t.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){let t=r.knownActions;for(let i=0,n=t.length;i!==n;++i){let n=t[i];this._deactivateAction(n);let r=n._cacheIndex,s=e[e.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,s._cacheIndex=r,e[r]=s,e.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(t){let e=t.uuid,i=this._actionsByClip;for(let r in i){let t=i[r].actionByRoot[e];void 0!==t&&(this._deactivateAction(t),this._removeInactiveAction(t))}let n=this._bindingsByRootAndName[e];if(void 0!==n)for(let r in n){let t=n[r];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(t,e){let i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}},qS=class{constructor(t){this.value=t}clone(){return new qS(void 0===this.value.clone?this.value:this.value.clone())}},YS=class{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;this.ray=new Hm(t,e),this.near=i,this.far=n,this.camera=null,this.layers=new ig,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return QS(t,this,e,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),e.sort(XS),e}intersectObjects(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];for(let n=0,r=t.length;n<r;n++)QS(t[n],this,i,e);return i.sort(XS),i}};function XS(t,e){return t.distance-e.distance}function QS(t,e,i,n){if(t.layers.test(e.layers)&&t.raycast(e,i),!0===n){let n=t.children;for(let t=0,r=n.length;t<r;t++)QS(n[t],e,i,!0)}}var KS=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(kf(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},ZS=new Uf,JS=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uf(1/0,1/0),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Uf(-1/0,-1/0);this.isBox2=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){let i=ZS.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return ZS.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},$S=new mm,tA=new mm,eA=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new mm,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mm;this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){$S.subVectors(t,this.start),tA.subVectors(this.end,this.start);let i=tA.dot(tA),n=tA.dot($S)/i;return e&&(n=kf(n,0,1)),n}closestPointToPoint(t,e,i){let n=this.closestPointToPointParameter(t,e);return this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}},iA=new mm,nA=class extends gg{constructor(t,e){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e,this.type="SpotLightHelper";let i=new Hg,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,a=1,o=32;s<o;s++,a++){let t=s/o*Math.PI*2,e=a/o*Math.PI*2;n.push(Math.cos(t),Math.sin(t),1,Math.cos(e),Math.sin(e),1)}i.setAttribute("position",new Bg(n,3));let r=new wx({fog:!1,toneMapped:!1});this.cone=new Dx(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),iA.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(iA),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},rA=class extends rv{constructor(t,e,i){super(new Rw(e,4,2),new Dg({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},sA=new mm,aA=new mm,oA=new mm,lA=class extends gg{constructor(t,e,i){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",void 0===e&&(e=1);let n=new Hg;n.setAttribute("position",new Bg([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));let r=new wx({fog:!1,toneMapped:!1});this.lightPlane=new Mx(n,r),this.add(this.lightPlane),n=new Hg,n.setAttribute("position",new Bg([0,0,0,0,0,1],3)),this.targetLine=new Mx(n,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),sA.setFromMatrixPosition(this.light.matrixWorld),aA.setFromMatrixPosition(this.light.target.matrixWorld),oA.subVectors(aA,sA),this.lightPlane.lookAt(aA),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(aA),this.targetLine.scale.z=oA.length()}},hA=new mm,cA=new dv,uA=class extends Dx{constructor(t){let e=new Hg,i=new wx({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],r=[],s={};function a(t,e){o(t),o(e)}function o(t){n.push(0,0,0),r.push(0,0,0),void 0===s[t]&&(s[t]=[]),s[t].push(n.length/3-1)}a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4"),e.setAttribute("position",new Bg(n,3)),e.setAttribute("color",new Bg(r,3)),super(e,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();let l=new nm(16755200),h=new nm(16711680),c=new nm(43775),u=new nm(16777215),d=new nm(3355443);this.setColors(l,h,c,u,d)}setColors(t,e,i,n,r){let s=this.geometry.getAttribute("color");s.setXYZ(0,t.r,t.g,t.b),s.setXYZ(1,t.r,t.g,t.b),s.setXYZ(2,t.r,t.g,t.b),s.setXYZ(3,t.r,t.g,t.b),s.setXYZ(4,t.r,t.g,t.b),s.setXYZ(5,t.r,t.g,t.b),s.setXYZ(6,t.r,t.g,t.b),s.setXYZ(7,t.r,t.g,t.b),s.setXYZ(8,t.r,t.g,t.b),s.setXYZ(9,t.r,t.g,t.b),s.setXYZ(10,t.r,t.g,t.b),s.setXYZ(11,t.r,t.g,t.b),s.setXYZ(12,t.r,t.g,t.b),s.setXYZ(13,t.r,t.g,t.b),s.setXYZ(14,t.r,t.g,t.b),s.setXYZ(15,t.r,t.g,t.b),s.setXYZ(16,t.r,t.g,t.b),s.setXYZ(17,t.r,t.g,t.b),s.setXYZ(18,t.r,t.g,t.b),s.setXYZ(19,t.r,t.g,t.b),s.setXYZ(20,t.r,t.g,t.b),s.setXYZ(21,t.r,t.g,t.b),s.setXYZ(22,t.r,t.g,t.b),s.setXYZ(23,t.r,t.g,t.b),s.setXYZ(24,e.r,e.g,e.b),s.setXYZ(25,e.r,e.g,e.b),s.setXYZ(26,e.r,e.g,e.b),s.setXYZ(27,e.r,e.g,e.b),s.setXYZ(28,e.r,e.g,e.b),s.setXYZ(29,e.r,e.g,e.b),s.setXYZ(30,e.r,e.g,e.b),s.setXYZ(31,e.r,e.g,e.b),s.setXYZ(32,i.r,i.g,i.b),s.setXYZ(33,i.r,i.g,i.b),s.setXYZ(34,i.r,i.g,i.b),s.setXYZ(35,i.r,i.g,i.b),s.setXYZ(36,i.r,i.g,i.b),s.setXYZ(37,i.r,i.g,i.b),s.setXYZ(38,n.r,n.g,n.b),s.setXYZ(39,n.r,n.g,n.b),s.setXYZ(40,r.r,r.g,r.b),s.setXYZ(41,r.r,r.g,r.b),s.setXYZ(42,r.r,r.g,r.b),s.setXYZ(43,r.r,r.g,r.b),s.setXYZ(44,r.r,r.g,r.b),s.setXYZ(45,r.r,r.g,r.b),s.setXYZ(46,r.r,r.g,r.b),s.setXYZ(47,r.r,r.g,r.b),s.setXYZ(48,r.r,r.g,r.b),s.setXYZ(49,r.r,r.g,r.b),s.needsUpdate=!0}update(){let t=this.geometry,e=this.pointMap;cA.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),dA("c",e,t,cA,0,0,-1),dA("t",e,t,cA,0,0,1),dA("n1",e,t,cA,-1,-1,-1),dA("n2",e,t,cA,1,-1,-1),dA("n3",e,t,cA,-1,1,-1),dA("n4",e,t,cA,1,1,-1),dA("f1",e,t,cA,-1,-1,1),dA("f2",e,t,cA,1,-1,1),dA("f3",e,t,cA,-1,1,1),dA("f4",e,t,cA,1,1,1),dA("u1",e,t,cA,.7,1.1,-1),dA("u2",e,t,cA,-.7,1.1,-1),dA("u3",e,t,cA,0,2,-1),dA("cf1",e,t,cA,-1,0,1),dA("cf2",e,t,cA,1,0,1),dA("cf3",e,t,cA,0,-1,1),dA("cf4",e,t,cA,0,1,1),dA("cn1",e,t,cA,-1,0,-1),dA("cn2",e,t,cA,1,0,-1),dA("cn3",e,t,cA,0,-1,-1),dA("cn4",e,t,cA,0,1,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function dA(t,e,i,n,r,s,a){hA.set(r,s,a).unproject(n);let o=e[t];if(void 0!==o){let t=i.getAttribute("position");for(let e=0,i=o.length;e<i;e++)t.setXYZ(o[e],hA.x,hA.y,hA.z)}}var pA=class extends Dx{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960,i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Hg;n.setIndex(new Rg(i,1)),n.setAttribute("position",new Bg([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(n,new wx({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){let e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}},fA=class extends Dx{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=new Hg;i.setAttribute("position",new Bg(e,3)),i.setAttribute("color",new Bg([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(i,new wx({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,i){let n=new nm,r=this.geometry.attributes.color.array;return n.set(t),n.toArray(r,0),n.toArray(r,3),n.set(e),n.toArray(r,6),n.toArray(r,9),n.set(i),n.toArray(r,12),n.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},mA=function(){let t=new ArrayBuffer(4),e=new Float32Array(t),i=new Uint32Array(t),n=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){let t=l-127;t<-27?(n[l]=0,n[256|l]=32768,r[l]=24,r[256|l]=24):t<-14?(n[l]=1024>>-t-14,n[256|l]=1024>>-t-14|32768,r[l]=-t-1,r[256|l]=-t-1):t<=15?(n[l]=t+15<<10,n[256|l]=t+15<<10|32768,r[l]=13,r[256|l]=13):t<128?(n[l]=31744,n[256|l]=64512,r[l]=24,r[256|l]=24):(n[l]=31744,n[256|l]=64512,r[l]=13,r[256|l]=13)}let s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let t=l<<13,e=0;for(;0===(8388608&t);)t<<=1,e-=8388608;t&=-8388609,e+=947912704,s[l]=t|e}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)32!==l&&(o[l]=1024);return{floatView:e,uint32View:i,baseTable:n,shiftTable:r,mantissaTable:s,exponentTable:a,offsetTable:o}}();var gA=Object.freeze({__proto__:null,fromHalfFloat:function(t){let e=t>>10;return mA.uint32View[0]=mA.mantissaTable[mA.offsetTable[e]+(1023&t)]+mA.exponentTable[e],mA.floatView[0]},toHalfFloat:function(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=kf(t,-65504,65504),mA.floatView[0]=t;let e=mA.uint32View[0],i=e>>23&511;return mA.baseTable[i]+((8388607&e)>>mA.shiftTable[i])}});typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:dp}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=dp);var vA=".",yA=Symbol("target"),bA=Symbol("unsubscribe");function xA(t){return t instanceof Date||t instanceof Set||t instanceof Map||t instanceof WeakSet||t instanceof WeakMap||ArrayBuffer.isView(t)}var wA=Array.isArray;function SA(t){return"symbol"==typeof t}var AA={after:(t,e)=>wA(t)?t.slice(e.length):""===e?t:t.slice(e.length+1),concat:(t,e)=>wA(t)?(t=[...t],e&&t.push(e),t):e&&void 0!==e.toString?(""!==t&&(t+=vA),SA(e)?t+e.toString():t+e):t,initial:t=>{if(wA(t))return t.slice(0,-1);if(""===t)return t;let e=t.lastIndexOf(vA);return-1===e?"":t.slice(0,e)},last:t=>{if(wA(t))return t[t.length-1]||"";if(""===t)return t;let e=t.lastIndexOf(vA);return-1===e?t:t.slice(e+1)},walk:(t,e)=>{if(wA(t))for(let i of t)e(i);else if(""!==t){let i=0,n=t.indexOf(vA);if(-1===n)e(t);else for(;i<t.length;)-1===n&&(n=t.length),e(t.slice(i,n)),i=n+1,n=t.indexOf(vA,i)}},get(t,e){return this.walk(e,(e=>{t&&(t=t[e])})),t}},EA=AA;function _A(t,e,i){return t.isUnsubscribed||e.ignoreSymbols&&SA(i)||e.ignoreUnderscores&&"_"===i.charAt(0)||"ignoreKeys"in e&&e.ignoreKeys.includes(i)}var CA=class{constructor(t){this._equals=t,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return void 0===this._descriptorCache&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(t){let e=this._getDescriptorCache(),i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i}_getOwnPropertyDescriptor(t,e){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(t,e);let i=this._getProperties(t),n=i[e];return void 0===n&&(n=Reflect.getOwnPropertyDescriptor(t,e),i[e]=n),n}getProxy(t,e,i,n){if(this.isUnsubscribed)return t;let r=t[n],s=r||t;this._pathCache.set(s,e);let a=this._proxyCache.get(s);return void 0===a&&(a=void 0===r?new Proxy(t,i):t,this._proxyCache.set(s,a)),a}getPath(t){return this.isUnsubscribed?void 0:this._pathCache.get(t)}isDetached(t,e){return!Object.is(t,EA.get(e,this.getPath(t)))}defineProperty(t,e,i){return!!Reflect.defineProperty(t,e,i)&&(this.isUnsubscribed||(this._getProperties(t)[e]=i),!0)}setProperty(t,e,i,n,r){if(!this._equals(r,i)||!(e in t)){let r=this._getOwnPropertyDescriptor(t,e);return void 0!==r&&"set"in r?Reflect.set(t,e,i,n):Reflect.set(t,e,i)}return!0}deleteProperty(t,e,i){if(Reflect.deleteProperty(t,e)){if(!this.isUnsubscribed){let n=this._getDescriptorCache().get(t);n&&(delete n[e],this._pathCache.delete(i))}return!0}return!1}isSameDescriptor(t,e,i){let n=this._getOwnPropertyDescriptor(e,i);return void 0!==t&&void 0!==n&&Object.is(t.value,n.value)&&(t.writable||!1)===(n.writable||!1)&&(t.enumerable||!1)===(n.enumerable||!1)&&(t.configurable||!1)===(n.configurable||!1)&&t.get===n.get&&t.set===n.set}isGetInvariant(t,e){let i=this._getOwnPropertyDescriptor(t,e);return void 0!==i&&!0!==i.configurable&&!0!==i.writable}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}};function MA(t){return"[object Object]"===toString.call(t)}function PA(){return!0}function TA(t,e){return t.length!==e.length||t.some(((t,i)=>e[i]!==t))}var DA=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),kA=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),IA={push:PA,pop:PA,shift:PA,unshift:PA,copyWithin:TA,reverse:TA,sort:TA,splice:TA,flat:TA,fill:TA},RA=new Set([...DA,...kA,...Object.keys(IA)]);function OA(t,e){if(t.size!==e.size)return!0;for(let i of t)if(!e.has(i))return!0;return!1}var LA=["keys","values","entries"],BA=new Set(["has","toString"]),zA={add:OA,clear:OA,delete:OA,forEach:OA},FA=new Set([...BA,...Object.keys(zA),...LA]);function NA(t,e){if(t.size!==e.size)return!0;let i;for(let[n,r]of t)if(i=e.get(n),i!==r||void 0===i&&!e.has(n))return!0;return!1}var UA=new Set([...BA,"get"]),VA={set:NA,clear:NA,delete:NA,forEach:NA},jA=new Set([...UA,...Object.keys(VA),...LA]),GA=class{constructor(t,e,i,n){this._path=e,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=n,this._changes=n?[]:null,this.clone=void 0===e?t:this._shallowClone(t)}static isHandledMethod(t){return DA.has(t)}_shallowClone(t){let e=t;if(MA(t))e={...t};else if(wA(t))e=[...t];else if(t instanceof Date)e=new Date(t);else if(t instanceof Set)e=new Set([...t].map((t=>this._shallowClone(t))));else if(t instanceof Map){e=new Map;for(let[i,n]of t.entries())e.set(i,this._shallowClone(n))}return this._clonedCache.add(e),e}preferredThisArg(t,e,i,n){return t?(wA(n)?this._onIsChanged=IA[e]:n instanceof Set?this._onIsChanged=zA[e]:n instanceof Map&&(this._onIsChanged=VA[e]),n):i}update(t,e,i){let n=EA.after(t,this._path);if("length"!==e){let t=this.clone;EA.walk(n,(e=>{t&&t[e]&&(this._clonedCache.has(t[e])||(t[e]=this._shallowClone(t[e])),t=t[e])})),this._hasOnValidate&&this._changes.push({path:n,property:e,previous:i}),t&&t[e]&&(t[e]=i)}this._isChanged=!0}undo(t){let e;for(let i=this._changes.length-1;-1!==i;i--)e=this._changes[i],EA.get(t,e.path)[e.property]=e.previous}isChanged(t){return void 0===this._onIsChanged?this._isChanged:this._onIsChanged(this.clone,t)}},HA=class extends GA{static isHandledMethod(t){return RA.has(t)}},WA=class extends GA{undo(t){t.setTime(this.clone.getTime())}isChanged(t,e){return!e(this.clone.valueOf(),t.valueOf())}},qA=class extends GA{static isHandledMethod(t){return FA.has(t)}undo(t){for(let e of this.clone)t.add(e);for(let e of t)this.clone.has(e)||t.delete(e)}},YA=class extends GA{static isHandledMethod(t){return jA.has(t)}undo(t){for(let[e,i]of this.clone.entries())t.set(e,i);for(let e of t.keys())this.clone.has(e)||t.delete(e)}},XA=class extends GA{constructor(t,e,i,n){super(void 0,e,i,n),this._arg1=i[0],this._weakValue=t.has(this._arg1)}isChanged(t){return this._weakValue!==t.has(this._arg1)}undo(t){this._weakValue&&!t.has(this._arg1)?t.add(this._arg1):t.delete(this._arg1)}},QA=class extends GA{constructor(t,e,i,n){super(void 0,e,i,n),this._weakKey=i[0],this._weakHas=t.has(this._weakKey),this._weakValue=t.get(this._weakKey)}isChanged(t){return this._weakValue!==t.get(this._weakKey)}undo(t){let e=t.has(this._weakKey);this._weakHas&&!e?t.set(this._weakKey,this._weakValue):!this._weakHas&&e?t.delete(this._weakKey):this._weakValue!==t.get(this._weakKey)&&t.set(this._weakKey,this._weakValue)}},KA=class{constructor(t){this._stack=[],this._hasOnValidate=t}static isHandledType(t){return MA(t)||wA(t)||xA(t)}static isHandledMethod(t,e){return MA(t)?GA.isHandledMethod(e):wA(t)?HA.isHandledMethod(e):t instanceof Set?qA.isHandledMethod(e):t instanceof Map?YA.isHandledMethod(e):xA(t)}get isCloning(){return this._stack.length>0}start(t,e,i){let n=GA;wA(t)?n=HA:t instanceof Date?n=WA:t instanceof Set?n=qA:t instanceof Map?n=YA:t instanceof WeakSet?n=XA:t instanceof WeakMap&&(n=QA),this._stack.push(new n(t,e,i,this._hasOnValidate))}update(t,e,i){this._stack[this._stack.length-1].update(t,e,i)}preferredThisArg(t,e,i){let{name:n}=t,r=KA.isHandledMethod(i,n);return this._stack[this._stack.length-1].preferredThisArg(r,n,e,i)}isChanged(t,e,i){return this._stack[this._stack.length-1].isChanged(t,e,i)}undo(t){void 0!==this._previousClone&&this._previousClone.undo(t)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}},ZA={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},JA=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};i={...ZA,...i};let n=Symbol("ProxyTarget"),{equals:r,isShallow:s,ignoreDetached:a,details:o}=i,l=new CA(r),h="function"==typeof i.onValidate,c=new KA(h),u=(t,e,n,r,s)=>!h||c.isCloning||!0===i.onValidate(EA.concat(l.getPath(t),e),n,r,s),d=(e,n,r,s)=>{!_A(l,i,n)&&(!a||!l.isDetached(e,t))&&p(l.getPath(e),n,r,s)},p=(t,i,n,r,s)=>{c.isCloning?c.update(t,i,r):e(EA.concat(t,i),n,r,s)},f=t=>t&&(t[n]||t),m=(e,r,o,h)=>function(t){return("object"==typeof t?null===t:"function"!=typeof t)||t instanceof RegExp}(e)||"constructor"===o||s&&!KA.isHandledMethod(r,o)||_A(l,i,o)||l.isGetInvariant(r,o)||a&&l.isDetached(r,t)?e:(void 0===h&&(h=l.getPath(r)),l.getProxy(e,EA.concat(h,o),g,n)),g={get(t,e,i){if(SA(e)){if(e===n||e===yA)return t;if(e===bA&&!l.isUnsubscribed&&0===l.getPath(t).length)return l.unsubscribe(),t}let r=xA(t)?Reflect.get(t,e):Reflect.get(t,e,i);return m(r,t,e)},set(t,e,i,s){i=f(i);let a=t[n]||t,o=a[e];if(r(o,i)&&e in t)return!0;let h=u(t,e,i,o);return h&&l.setProperty(a,e,i,s,o)?(d(t,e,t[e],o),!0):!h},defineProperty(t,e,i){if(!l.isSameDescriptor(i,t,e)){let n=t[e];u(t,e,i.value,n)&&l.defineProperty(t,e,i,n)&&d(t,e,i.value,n)}return!0},deleteProperty(t,e){if(!Reflect.has(t,e))return!0;let i=Reflect.get(t,e),n=u(t,e,void 0,i);return n&&l.deleteProperty(t,e,i)?(d(t,e,void 0,i),!0):!n},apply(e,i,s){let a=i[n]||i;if(l.isUnsubscribed)return Reflect.apply(e,a,s);if((!1===o||!0!==o&&!o.includes(e.name))&&KA.isHandledType(a)){let n=EA.initial(l.getPath(e)),o=KA.isHandledMethod(a,e.name);c.start(a,n,s);let h=Reflect.apply(e,c.preferredThisArg(e,i,a),o?s.map((t=>f(t))):s),d=c.isChanged(a,r),v=c.stop();if(KA.isHandledType(h)&&o&&(i instanceof Map&&"get"===e.name&&(n=EA.concat(n,s[0])),h=l.getProxy(h,n,g)),d){let i={name:e.name,args:s,result:h},r=c.isCloning?EA.initial(n):n,o=c.isCloning?EA.last(n):"";u(EA.get(t,r),o,a,v,i)?p(r,o,a,v,i):c.undo(a)}return(i instanceof Map||i instanceof Set)&&function(t){return"object"==typeof t&&"function"==typeof t.next}(h)?function(t,e,i,n,r){let s=t.next;if("entries"===e.name)t.next=function(){let t=s.call(this);return!1===t.done&&(t.value[0]=r(t.value[0],e,t.value[0],n),t.value[1]=r(t.value[1],e,t.value[0],n)),t};else if("values"===e.name){let a=i[yA].keys();t.next=function(){let t=s.call(this);return!1===t.done&&(t.value=r(t.value,e,a.next().value,n)),t}}else t.next=function(){let t=s.call(this);return!1===t.done&&(t.value=r(t.value,e,t.value,n)),t};return t}(h,e,i,n,m):h}return Reflect.apply(e,i,s)}},v=l.getProxy(t,i.pathAsArray?[]:"",g);return e=e.bind(v),h&&(i.onValidate=i.onValidate.bind(v)),v};JA.target=t=>t&&t[yA]||t,JA.unsubscribe=t=>t[bA]||t;var $A=JA,tE="object"==typeof global&&global&&global.Object===Object&&global,eE="object"==typeof self&&self&&self.Object===Object&&self,iE=tE||eE||Function("return this")(),nE=iE.Symbol,rE=Object.prototype,sE=rE.hasOwnProperty,aE=rE.toString,oE=nE?nE.toStringTag:void 0;var lE=function(t){var e=sE.call(t,oE),i=t[oE];try{t[oE]=void 0;var n=!0}catch{}var r=aE.call(t);return n&&(e?t[oE]=i:delete t[oE]),r},hE=Object.prototype.toString;var cE=function(t){return hE.call(t)},uE=nE?nE.toStringTag:void 0;var dE=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":uE&&uE in Object(t)?lE(t):cE(t)};var pE=function(t){return null!=t&&"object"==typeof t};var fE=function(t){return"symbol"==typeof t||pE(t)&&"[object Symbol]"==dE(t)};var mE=function(t,e){for(var i=-1,n=null==t?0:t.length,r=Array(n);++i<n;)r[i]=e(t[i],i,t);return r},gE=Array.isArray,vE=1/0,yE=nE?nE.prototype:void 0,bE=yE?yE.toString:void 0;var xE=function t(e){if("string"==typeof e)return e;if(gE(e))return mE(e,t)+"";if(fE(e))return bE?bE.call(e):"";var i=e+"";return"0"==i&&1/e==-vE?"-0":i},wE=/\s/;var SE=function(t){for(var e=t.length;e--&&wE.test(t.charAt(e)););return e},AE=/^\s+/;var EE=function(t){return t&&t.slice(0,SE(t)+1).replace(AE,"")};var _E=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},CE=/^[-+]0x[0-9a-f]+$/i,ME=/^0b[01]+$/i,PE=/^0o[0-7]+$/i,TE=parseInt;var DE=function(t){if("number"==typeof t)return t;if(fE(t))return NaN;if(_E(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=_E(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=EE(t);var i=ME.test(t);return i||PE.test(t)?TE(t.slice(2),i?2:8):CE.test(t)?NaN:+t};var kE=function(t){return t};var IE=function(t){if(!_E(t))return!1;var e=dE(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},RE=iE["__core-js_shared__"],OE=function(){var t=/[^.]+$/.exec(RE&&RE.keys&&RE.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();var LE=function(t){return!!OE&&OE in t},BE=Function.prototype.toString;var zE=function(t){if(null!=t){try{return BE.call(t)}catch{}try{return t+""}catch{}}return""},FE=/^\[object .+?Constructor\]$/,NE=Function.prototype,UE=Object.prototype,VE=NE.toString,jE=UE.hasOwnProperty,GE=RegExp("^"+VE.call(jE).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var HE=function(t){return!(!_E(t)||LE(t))&&(IE(t)?GE:FE).test(zE(t))};var WE=function(t,e){return t?.[e]};var qE=function(t,e){var i=WE(t,e);return HE(i)?i:void 0},YE=qE(iE,"WeakMap"),XE=Object.create,QE=function(){function t(){}return function(e){if(!_E(e))return{};if(XE)return XE(e);t.prototype=e;var i=new t;return t.prototype=void 0,i}}(),KE=QE;var ZE=function(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)};var JE=function(t,e){var i=-1,n=t.length;for(e||(e=Array(n));++i<n;)e[i]=t[i];return e},$E=Date.now;var t_=function(t){var e=0,i=0;return function(){var n=$E(),r=16-(n-i);if(i=n,r>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}};var e_=function(t){return function(){return t}},i_=function(){try{var t=qE(Object,"defineProperty");return t({},"",{}),t}catch{}}(),n_=i_,r_=n_?function(t,e){return n_(t,"toString",{configurable:!0,enumerable:!1,value:e_(e),writable:!0})}:kE,s_=t_(r_);var a_=function(t,e){for(var i=-1,n=null==t?0:t.length;++i<n&&!1!==e(t[i],i,t););return t},o_=/^(?:0|[1-9]\d*)$/;var l_=function(t,e){var i=typeof t;return!!(e=e??9007199254740991)&&("number"==i||"symbol"!=i&&o_.test(t))&&t>-1&&t%1==0&&t<e};var h_=function(t,e,i){"__proto__"==e&&n_?n_(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i};var c_=function(t,e){return t===e||t!==t&&e!==e},u_=Object.prototype.hasOwnProperty;var d_=function(t,e,i){var n=t[e];(!u_.call(t,e)||!c_(n,i)||void 0===i&&!(e in t))&&h_(t,e,i)};var p_=function(t,e,i,n){var r=!i;i||(i={});for(var s=-1,a=e.length;++s<a;){var o=e[s],l=n?n(i[o],t[o],o,i,t):void 0;void 0===l&&(l=t[o]),r?h_(i,o,l):d_(i,o,l)}return i},f_=Math.max;var m_=function(t,e,i){return e=f_(void 0===e?t.length-1:e,0),function(){for(var n=arguments,r=-1,s=f_(n.length-e,0),a=Array(s);++r<s;)a[r]=n[e+r];r=-1;for(var o=Array(e+1);++r<e;)o[r]=n[r];return o[e]=i(a),ZE(t,this,o)}};var g_=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991};var v_=function(t){return null!=t&&g_(t.length)&&!IE(t)},y_=Object.prototype;var b_=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||y_)};var x_=function(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n};var w_=function(t){return pE(t)&&"[object Arguments]"==dE(t)},S_=Object.prototype,A_=S_.hasOwnProperty,E_=S_.propertyIsEnumerable,__=w_(function(){return arguments}())?w_:function(t){return pE(t)&&A_.call(t,"callee")&&!E_.call(t,"callee")},C_=__;var M_=function(){return!1},P_="object"==typeof exports&&exports&&!exports.nodeType&&exports,T_=P_&&"object"==typeof module&&module&&!module.nodeType&&module,D_=T_&&T_.exports===P_?iE.Buffer:void 0,k_=(D_?D_.isBuffer:void 0)||M_,I_={};I_["[object Float32Array]"]=I_["[object Float64Array]"]=I_["[object Int8Array]"]=I_["[object Int16Array]"]=I_["[object Int32Array]"]=I_["[object Uint8Array]"]=I_["[object Uint8ClampedArray]"]=I_["[object Uint16Array]"]=I_["[object Uint32Array]"]=!0,I_["[object Arguments]"]=I_["[object Array]"]=I_["[object ArrayBuffer]"]=I_["[object Boolean]"]=I_["[object DataView]"]=I_["[object Date]"]=I_["[object Error]"]=I_["[object Function]"]=I_["[object Map]"]=I_["[object Number]"]=I_["[object Object]"]=I_["[object RegExp]"]=I_["[object Set]"]=I_["[object String]"]=I_["[object WeakMap]"]=!1;var R_=function(t){return pE(t)&&g_(t.length)&&!!I_[dE(t)]};var O_=function(t){return function(e){return t(e)}},L_="object"==typeof exports&&exports&&!exports.nodeType&&exports,B_=L_&&"object"==typeof module&&module&&!module.nodeType&&module,z_=B_&&B_.exports===L_&&tE.process,F_=function(){try{return B_&&B_.require&&B_.require("util").types||z_&&z_.binding&&z_.binding("util")}catch{}}(),N_=F_&&F_.isTypedArray,U_=N_?O_(N_):R_,V_=Object.prototype.hasOwnProperty;var j_=function(t,e){var i=gE(t),n=!i&&C_(t),r=!i&&!n&&k_(t),s=!i&&!n&&!r&&U_(t),a=i||n||r||s,o=a?x_(t.length,String):[],l=o.length;for(var h in t)(e||V_.call(t,h))&&(!a||!("length"==h||r&&("offset"==h||"parent"==h)||s&&("buffer"==h||"byteLength"==h||"byteOffset"==h)||l_(h,l)))&&o.push(h);return o};var G_=function(t,e){return function(i){return t(e(i))}},H_=G_(Object.keys,Object),W_=Object.prototype.hasOwnProperty;var q_=function(t){if(!b_(t))return H_(t);var e=[];for(var i in Object(t))W_.call(t,i)&&"constructor"!=i&&e.push(i);return e};var Y_=function(t){return v_(t)?j_(t):q_(t)};var X_=function(t){var e=[];if(null!=t)for(var i in Object(t))e.push(i);return e},Q_=Object.prototype.hasOwnProperty;var K_=function(t){if(!_E(t))return X_(t);var e=b_(t),i=[];for(var n in t)"constructor"==n&&(e||!Q_.call(t,n))||i.push(n);return i};var Z_=function(t){return v_(t)?j_(t,!0):K_(t)},J_=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,$_=/^\w*$/;var tC=function(t,e){if(gE(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!fE(t))||($_.test(t)||!J_.test(t)||null!=e&&t in Object(e))},eC=qE(Object,"create");var iC=function(){this.__data__=eC?eC(null):{},this.size=0};var nC=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},rC=Object.prototype.hasOwnProperty;var sC=function(t){var e=this.__data__;if(eC){var i=e[t];return"__lodash_hash_undefined__"===i?void 0:i}return rC.call(e,t)?e[t]:void 0},aC=Object.prototype.hasOwnProperty;var oC=function(t){var e=this.__data__;return eC?void 0!==e[t]:aC.call(e,t)};var lC=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=eC&&void 0===e?"__lodash_hash_undefined__":e,this};function hC(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}hC.prototype.clear=iC,hC.prototype.delete=nC,hC.prototype.get=sC,hC.prototype.has=oC,hC.prototype.set=lC;var cC=hC;var uC=function(){this.__data__=[],this.size=0};var dC=function(t,e){for(var i=t.length;i--;)if(c_(t[i][0],e))return i;return-1},pC=Array.prototype.splice;var fC=function(t){var e=this.__data__,i=dC(e,t);return!(i<0)&&(i==e.length-1?e.pop():pC.call(e,i,1),--this.size,!0)};var mC=function(t){var e=this.__data__,i=dC(e,t);return i<0?void 0:e[i][1]};var gC=function(t){return dC(this.__data__,t)>-1};var vC=function(t,e){var i=this.__data__,n=dC(i,t);return n<0?(++this.size,i.push([t,e])):i[n][1]=e,this};function yC(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}yC.prototype.clear=uC,yC.prototype.delete=fC,yC.prototype.get=mC,yC.prototype.has=gC,yC.prototype.set=vC;var bC=yC,xC=qE(iE,"Map");var wC=function(){this.size=0,this.__data__={hash:new cC,map:new(xC||bC),string:new cC}};var SC=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var AC=function(t,e){var i=t.__data__;return SC(e)?i["string"==typeof e?"string":"hash"]:i.map};var EC=function(t){var e=AC(this,t).delete(t);return this.size-=e?1:0,e};var _C=function(t){return AC(this,t).get(t)};var CC=function(t){return AC(this,t).has(t)};var MC=function(t,e){var i=AC(this,t),n=i.size;return i.set(t,e),this.size+=i.size==n?0:1,this};function PC(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}PC.prototype.clear=wC,PC.prototype.delete=EC,PC.prototype.get=_C,PC.prototype.has=CC,PC.prototype.set=MC;var TC=PC;function DC(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var i=function(){var n=arguments,r=e?e.apply(this,n):n[0],s=i.cache;if(s.has(r))return s.get(r);var a=t.apply(this,n);return i.cache=s.set(r,a)||s,a};return i.cache=new(DC.Cache||TC),i}DC.Cache=TC;var kC=DC;var IC=function(t){var e=kC(t,(function(t){return 500===i.size&&i.clear(),t})),i=e.cache;return e},RC=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,OC=/\\(\\)?/g,LC=IC((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(RC,(function(t,i,n,r){e.push(n?r.replace(OC,"$1"):i||t)})),e})),BC=LC;var zC=function(t){return null==t?"":xE(t)};var FC=function(t,e){return gE(t)?t:tC(t,e)?[t]:BC(zC(t))},NC=1/0;var UC=function(t){if("string"==typeof t||fE(t))return t;var e=t+"";return"0"==e&&1/t==-NC?"-0":e};var VC=function(t,e){for(var i=0,n=(e=FC(e,t)).length;null!=t&&i<n;)t=t[UC(e[i++])];return i&&i==n?t:void 0};var jC=function(t,e){for(var i=-1,n=e.length,r=t.length;++i<n;)t[r+i]=e[i];return t},GC=nE?nE.isConcatSpreadable:void 0;var HC=function(t){return gE(t)||C_(t)||!!(GC&&t&&t[GC])};var WC=function t(e,i,n,r,s){var a=-1,o=e.length;for(n||(n=HC),s||(s=[]);++a<o;){var l=e[a];i>0&&n(l)?i>1?t(l,i-1,n,r,s):jC(s,l):r||(s[s.length]=l)}return s};var qC=function(t){return(null==t?0:t.length)?WC(t,1):[]};var YC=function(t){return s_(m_(t,void 0,qC),t+"")},XC=G_(Object.getPrototypeOf,Object),QC=Function.prototype,KC=Object.prototype,ZC=QC.toString,JC=KC.hasOwnProperty,$C=ZC.call(Object);var tM=function(t){if(!pE(t)||"[object Object]"!=dE(t))return!1;var e=XC(t);if(null===e)return!0;var i=JC.call(e,"constructor")&&e.constructor;return"function"==typeof i&&i instanceof i&&ZC.call(i)==$C};var eM=function(t,e,i){var n=-1,r=t.length;e<0&&(e=-e>r?0:r+e),(i=i>r?r:i)<0&&(i+=r),r=e>i?0:i-e>>>0,e>>>=0;for(var s=Array(r);++n<r;)s[n]=t[n+e];return s};var iM=function(){this.__data__=new bC,this.size=0};var nM=function(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i};var rM=function(t){return this.__data__.get(t)};var sM=function(t){return this.__data__.has(t)};var aM=function(t,e){var i=this.__data__;if(i instanceof bC){var n=i.__data__;if(!xC||n.length<199)return n.push([t,e]),this.size=++i.size,this;i=this.__data__=new TC(n)}return i.set(t,e),this.size=i.size,this};function oM(t){var e=this.__data__=new bC(t);this.size=e.size}oM.prototype.clear=iM,oM.prototype.delete=nM,oM.prototype.get=rM,oM.prototype.has=sM,oM.prototype.set=aM;var lM=oM;var hM=function(t,e){return t&&p_(e,Y_(e),t)};var cM=function(t,e){return t&&p_(e,Z_(e),t)},uM="object"==typeof exports&&exports&&!exports.nodeType&&exports,dM=uM&&"object"==typeof module&&module&&!module.nodeType&&module,pM=dM&&dM.exports===uM?iE.Buffer:void 0,fM=pM?pM.allocUnsafe:void 0;var mM=function(t,e){if(e)return t.slice();var i=t.length,n=fM?fM(i):new t.constructor(i);return t.copy(n),n};var gM=function(t,e){for(var i=-1,n=null==t?0:t.length,r=0,s=[];++i<n;){var a=t[i];e(a,i,t)&&(s[r++]=a)}return s};var vM=function(){return[]},yM=Object.prototype.propertyIsEnumerable,bM=Object.getOwnPropertySymbols,xM=bM?function(t){return null==t?[]:(t=Object(t),gM(bM(t),(function(e){return yM.call(t,e)})))}:vM,wM=xM;var SM=function(t,e){return p_(t,wM(t),e)},AM=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)jC(e,wM(t)),t=XC(t);return e}:vM,EM=AM;var _M=function(t,e){return p_(t,EM(t),e)};var CM=function(t,e,i){var n=e(t);return gE(t)?n:jC(n,i(t))};var MM=function(t){return CM(t,Y_,wM)};var PM=function(t){return CM(t,Z_,EM)},TM=qE(iE,"DataView"),DM=qE(iE,"Promise"),kM=qE(iE,"Set"),IM="[object Map]",RM="[object Promise]",OM="[object Set]",LM="[object WeakMap]",BM="[object DataView]",zM=zE(TM),FM=zE(xC),NM=zE(DM),UM=zE(kM),VM=zE(YE),jM=dE;(TM&&jM(new TM(new ArrayBuffer(1)))!=BM||xC&&jM(new xC)!=IM||DM&&jM(DM.resolve())!=RM||kM&&jM(new kM)!=OM||YE&&jM(new YE)!=LM)&&(jM=function(t){var e=dE(t),i="[object Object]"==e?t.constructor:void 0,n=i?zE(i):"";if(n)switch(n){case zM:return BM;case FM:return IM;case NM:return RM;case UM:return OM;case VM:return LM}return e});var GM=jM,HM=Object.prototype.hasOwnProperty;var WM=function(t){var e=t.length,i=new t.constructor(e);return e&&"string"==typeof t[0]&&HM.call(t,"index")&&(i.index=t.index,i.input=t.input),i},qM=iE.Uint8Array;var YM=function(t){var e=new t.constructor(t.byteLength);return new qM(e).set(new qM(t)),e};var XM=function(t,e){var i=e?YM(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)},QM=/\w*$/;var KM=function(t){var e=new t.constructor(t.source,QM.exec(t));return e.lastIndex=t.lastIndex,e},ZM=nE?nE.prototype:void 0,JM=ZM?ZM.valueOf:void 0;var $M=function(t){return JM?Object(JM.call(t)):{}};var tP=function(t,e){var i=e?YM(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)};var eP=function(t,e,i){var n=t.constructor;switch(e){case"[object ArrayBuffer]":return YM(t);case"[object Boolean]":case"[object Date]":return new n(+t);case"[object DataView]":return XM(t,i);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return tP(t,i);case"[object Map]":case"[object Set]":return new n;case"[object Number]":case"[object String]":return new n(t);case"[object RegExp]":return KM(t);case"[object Symbol]":return $M(t)}};var iP=function(t){return"function"!=typeof t.constructor||b_(t)?{}:KE(XC(t))};var nP=function(t){return pE(t)&&"[object Map]"==GM(t)},rP=F_&&F_.isMap,sP=rP?O_(rP):nP;var aP=function(t){return pE(t)&&"[object Set]"==GM(t)},oP=F_&&F_.isSet,lP=oP?O_(oP):aP,hP="[object Arguments]",cP="[object Function]",uP="[object Object]",dP={};dP[hP]=dP["[object Array]"]=dP["[object ArrayBuffer]"]=dP["[object DataView]"]=dP["[object Boolean]"]=dP["[object Date]"]=dP["[object Float32Array]"]=dP["[object Float64Array]"]=dP["[object Int8Array]"]=dP["[object Int16Array]"]=dP["[object Int32Array]"]=dP["[object Map]"]=dP["[object Number]"]=dP[uP]=dP["[object RegExp]"]=dP["[object Set]"]=dP["[object String]"]=dP["[object Symbol]"]=dP["[object Uint8Array]"]=dP["[object Uint8ClampedArray]"]=dP["[object Uint16Array]"]=dP["[object Uint32Array]"]=!0,dP["[object Error]"]=dP[cP]=dP["[object WeakMap]"]=!1;var pP=function t(e,i,n,r,s,a){var o,l=1&i,h=2&i,c=4&i;if(n&&(o=s?n(e,r,s,a):n(e)),void 0!==o)return o;if(!_E(e))return e;var u=gE(e);if(u){if(o=WM(e),!l)return JE(e,o)}else{var d=GM(e),p=d==cP||"[object GeneratorFunction]"==d;if(k_(e))return mM(e,l);if(d==uP||d==hP||p&&!s){if(o=h||p?{}:iP(e),!l)return h?_M(e,cM(o,e)):SM(e,hM(o,e))}else{if(!dP[d])return s?e:{};o=eP(e,d,l)}}a||(a=new lM);var f=a.get(e);if(f)return f;a.set(e,o),lP(e)?e.forEach((function(r){o.add(t(r,i,n,r,e,a))})):sP(e)&&e.forEach((function(r,s){o.set(s,t(r,i,n,s,e,a))}));var m=u?void 0:(c?h?PM:MM:h?Z_:Y_)(e);return a_(m||e,(function(r,s){m&&(r=e[s=r]),d_(o,s,t(r,i,n,s,e,a))})),o};var fP=function(t){return pP(t,5)};var mP=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var gP=function(t){return this.__data__.has(t)};function vP(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new TC;++e<i;)this.add(t[e])}vP.prototype.add=vP.prototype.push=mP,vP.prototype.has=gP;var yP=vP;var bP=function(t,e){for(var i=-1,n=null==t?0:t.length;++i<n;)if(e(t[i],i,t))return!0;return!1};var xP=function(t,e){return t.has(e)};var wP=function(t,e,i,n,r,s){var a=1&i,o=t.length,l=e.length;if(o!=l&&!(a&&l>o))return!1;var h=s.get(t),c=s.get(e);if(h&&c)return h==e&&c==t;var u=-1,d=!0,p=2&i?new yP:void 0;for(s.set(t,e),s.set(e,t);++u<o;){var f=t[u],m=e[u];if(n)var g=a?n(m,f,u,e,t,s):n(f,m,u,t,e,s);if(void 0!==g){if(g)continue;d=!1;break}if(p){if(!bP(e,(function(t,e){if(!xP(p,e)&&(f===t||r(f,t,i,n,s)))return p.push(e)}))){d=!1;break}}else if(f!==m&&!r(f,m,i,n,s)){d=!1;break}}return s.delete(t),s.delete(e),d};var SP=function(t){var e=-1,i=Array(t.size);return t.forEach((function(t,n){i[++e]=[n,t]})),i};var AP=function(t){var e=-1,i=Array(t.size);return t.forEach((function(t){i[++e]=t})),i},EP=nE?nE.prototype:void 0,_P=EP?EP.valueOf:void 0;var CP=function(t,e,i,n,r,s,a){switch(i){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!s(new qM(t),new qM(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return c_(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var o=SP;case"[object Set]":var l=1&n;if(o||(o=AP),t.size!=e.size&&!l)return!1;var h=a.get(t);if(h)return h==e;n|=2,a.set(t,e);var c=wP(o(t),o(e),n,r,s,a);return a.delete(t),c;case"[object Symbol]":if(_P)return _P.call(t)==_P.call(e)}return!1},MP=Object.prototype.hasOwnProperty;var PP=function(t,e,i,n,r,s){var a=1&i,o=MM(t),l=o.length;if(l!=MM(e).length&&!a)return!1;for(var h=l;h--;){var c=o[h];if(!(a?c in e:MP.call(e,c)))return!1}var u=s.get(t),d=s.get(e);if(u&&d)return u==e&&d==t;var p=!0;s.set(t,e),s.set(e,t);for(var f=a;++h<l;){var m=t[c=o[h]],g=e[c];if(n)var v=a?n(g,m,c,e,t,s):n(m,g,c,t,e,s);if(!(void 0===v?m===g||r(m,g,i,n,s):v)){p=!1;break}f||(f="constructor"==c)}if(p&&!f){var y=t.constructor,b=e.constructor;y!=b&&"constructor"in t&&"constructor"in e&&!("function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b)&&(p=!1)}return s.delete(t),s.delete(e),p},TP="[object Arguments]",DP="[object Array]",kP="[object Object]",IP=Object.prototype.hasOwnProperty;var RP=function(t,e,i,n,r,s){var a=gE(t),o=gE(e),l=a?DP:GM(t),h=o?DP:GM(e),c=(l=l==TP?kP:l)==kP,u=(h=h==TP?kP:h)==kP,d=l==h;if(d&&k_(t)){if(!k_(e))return!1;a=!0,c=!1}if(d&&!c)return s||(s=new lM),a||U_(t)?wP(t,e,i,n,r,s):CP(t,e,l,i,n,r,s);if(!(1&i)){var p=c&&IP.call(t,"__wrapped__"),f=u&&IP.call(e,"__wrapped__");if(p||f){var m=p?t.value():t,g=f?e.value():e;return s||(s=new lM),r(m,g,i,n,s)}}return!!d&&(s||(s=new lM),PP(t,e,i,n,r,s))};var OP=function t(e,i,n,r,s){return e===i||(null==e||null==i||!pE(e)&&!pE(i)?e!==e&&i!==i:RP(e,i,n,r,t,s))};var LP=function(t,e){return null!=t&&e in Object(t)};var BP=function(t,e,i){for(var n=-1,r=(e=FC(e,t)).length,s=!1;++n<r;){var a=UC(e[n]);if(!(s=null!=t&&i(t,a)))break;t=t[a]}return s||++n!=r?s:!!(r=null==t?0:t.length)&&g_(r)&&l_(a,r)&&(gE(t)||C_(t))};var zP=function(t,e){return null!=t&&BP(t,e,LP)},FP=function(){return iE.Date.now()},NP=Math.max,UP=Math.min;var VP=function(t,e,i){var n,r,s,a,o,l,h=0,c=!1,u=!1,d=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){var i=n,s=r;return n=r=void 0,h=e,a=t.apply(s,i)}function f(t){var i=t-l;return void 0===l||i>=e||i<0||u&&t-h>=s}function m(){var t=FP();if(f(t))return g(t);o=setTimeout(m,function(t){var i=e-(t-l);return u?UP(i,s-(t-h)):i}(t))}function g(t){return o=void 0,d&&n?p(t):(n=r=void 0,a)}function v(){var t=FP(),i=f(t);if(n=arguments,r=this,l=t,i){if(void 0===o)return function(t){return h=t,o=setTimeout(m,e),c?p(t):a}(l);if(u)return clearTimeout(o),o=setTimeout(m,e),p(l)}return void 0===o&&(o=setTimeout(m,e)),a}return e=DE(e)||0,_E(i)&&(c=!!i.leading,s=(u="maxWait"in i)?NP(DE(i.maxWait)||0,e):s,d="trailing"in i?!!i.trailing:d),v.cancel=function(){void 0!==o&&clearTimeout(o),h=0,n=l=r=o=void 0},v.flush=function(){return void 0===o?a:g(FP())},v};var jP=function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0};var GP=function(t,e){return t>e};var HP=function(t,e){return e.length<2?t:VC(t,eM(e,0,-1))};var WP=function(t,e){return OP(t,e)};var qP=function(t,e,i){for(var n=-1,r=t.length;++n<r;){var s=t[n],a=e(s);if(null!=a&&(void 0===o?a===a&&!fE(a):i(a,o)))var o=a,l=s}return l};var YP=function(t){return t&&t.length?qP(t,kE,GP):void 0};var XP=function(t,e){return e=FC(e,t),null==(t=HP(t,e))||delete t[UC(jP(e))]};var QP=function(t){return tM(t)?void 0:t},KP=YC((function(t,e){var i={};if(null==t)return i;var n=!1;e=mE(e,(function(e){return e=FC(e,t),n||(n=e.length>1),e})),p_(t,PM(t),i),n&&(i=pP(i,7,QP));for(var r=e.length;r--;)XP(i,e[r]);return i})),ZP=KP;var JP=function(t,e,i,n){if(!_E(t))return t;for(var r=-1,s=(e=FC(e,t)).length,a=s-1,o=t;null!=o&&++r<s;){var l=UC(e[r]),h=i;if("__proto__"===l||"constructor"===l||"prototype"===l)return t;if(r!=a){var c=o[l];void 0===(h=n?n(c,l,o):void 0)&&(h=_E(c)?c:l_(e[r+1])?[]:{})}d_(o,l,h),o=o[l]}return t};var $P=function(t,e,i){for(var n=-1,r=e.length,s={};++n<r;){var a=e[n],o=VC(t,a);i(o,a)&&JP(s,FC(a,t),o)}return s};var tT=function(t,e){return $P(t,e,(function(e,i){return zP(t,i)}))},eT=YC((function(t,e){return null==t?{}:tT(t,e)})),iT=eT;var nT=function(t,e,i){var n=!0,r=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return _E(i)&&(n="leading"in i?!!i.leading:n,r="trailing"in i?!!i.trailing:r),VP(t,e,{leading:n,maxWait:e,trailing:r})};function rT(t){for(let e of Object.keys(t))void 0===t[e]&&delete t[e];return t}function sT(t,e){return Object.setPrototypeOf(t,e),t}var aT=!(typeof window>"u")&&window.navigator.userAgent.toLowerCase().includes(" electron/"),oT=(aT&&(()=>{if(typeof window>"u")return;let t=new URLSearchParams(window.location.search).get("desktop-app-version");t?window.localStorage.setItem("desktop-app-version",t):window.localStorage.getItem("desktop-app-version")})(),!(typeof window>"u")&&window.navigator.platform.toUpperCase().includes("MAC")),lT=!(typeof window>"u")&&(/iPad|iPhone|iPod/.test(window.navigator.userAgent)||oT&&"ontouchend"in document),hT=!(typeof window>"u")&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,cT=!(typeof window>"u")&&("ontouchstart"in window||navigator.maxTouchPoints>0),uT=(()=>{if(typeof window>"u")return!1;let t=navigator.userAgent,e=navigator.vendor;return/Safari/i.test(t)&&/Apple Computer/.test(e)})(),dT=Number((()=>{if(typeof window>"u")return null;let t=navigator.userAgent.match(/Version\/(\d+\.\d)/);return t&&t[1]})());function pT(t){return Array.isArray(t)?t:[t]}function fT(t,e){let i=0;for(;i<t.length&&i<e.length;){if(t[i]<e[i])return-1;if(t[i]>e[i])return 1;i+=1}return i!==e.length?-1:i!==t.length?1:0}function mT(t){return oT?t.metaKey:t.ctrlKey}var gT=[],vT={},yT={},bT={};function xT(t){gT.includes(t)||gT.push(t)}function wT(t){delete vT[t.pointerId];for(let e=0;e<gT.length;e++)if(gT[e].pointerId===t.pointerId){gT.splice(e,1);break}}function ST(t){if("touch"!==t.pointerType)return;let e=vT[t.pointerId];void 0===e&&(e={x:0,y:0},vT[t.pointerId]=e),e.x=t.pageX,e.y=t.pageY}function AT(t){let e=t.pointerId===gT[0].pointerId?gT[1]:gT[0];return vT[e.pointerId]}function ET(t){yT[t.key]=!0,bT[t.key]=void 0===bT[t.key]?1:bT[t.key]+1}function _T(t){if(oT&&yT.Meta)for(let e in yT)yT[e]=!1;else yT[t.key]=!1;bT={}}var CT,MT,PT=new Promise((t=>{CT=t}));function TT(){if(MT)return MT;return MT=async function(){let t=__webpack_require__.e(208).then(__webpack_require__.bind(__webpack_require__,208)),[e,i]=await Promise.all([t,fetch("https://unpkg.com/@splinetool/navmesh-wasm@1.9.72/build/navmesh.wasm").then((t=>t.arrayBuffer()))]),n=e.default,r=await n({wasmBinary:i});CT(r)}()}var DT,kT,IT=new Promise((t=>{DT=t}));function RT(){if(kT)return kT;return kT=async function(){let t=await __webpack_require__.e(293).then(__webpack_require__.bind(__webpack_require__,293));await t.init(),DT(t)}()}var OT=class{modifyById(t,e){let i=this;if(void 0===i[t])throw new Error("not expected");{let n={...i,[t]:e};return Object.setPrototypeOf(n,OT.prototype),n}}add(t,e){return this.runOp({type:1,id:t,data:e})?.data??this}runOp(t){let e=this;if(1===t.type){let i,n=e[t.id];i=void 0===n?{type:2,id:t.id}:{type:1,id:t.id,data:n};let{id:r,data:s}=t,a={...e,[r]:s};return Object.setPrototypeOf(a,OT.prototype),{data:a,actual:t,reverse:i}}if(2===t.type){let{id:i}=t,n=e[i];if(void 0===n)return null;{let r={...e};return Object.setPrototypeOf(r,OT.prototype),delete r[i],{data:r,actual:t,reverse:{type:1,id:i,data:n}}}}return null}};function LT(t){if(void 0!==t.deepFreeze)return void t.deepFreeze(t);let e=Object.getOwnPropertyNames(t);for(let i of e){let e=t[i];e&&"object"==typeof e&&LT(e)}return Object.freeze(t)}var BT=class extends Error{};function zT(t){let e={...t};return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),e}function FT(t,e,i){if(void 0===t?void 0===e?(t=0,e=10):t=e-10:void 0===e&&(e=t+10),t>e){let i=t;t=e,e=i}let n=[],r=1/(i+1);for(let s=0;s<i;s++){let i=t+(e-t)*(s+.75+.5*Math.random())*r;n.push(i)}return n}function NT(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array}function UT(t,e){for(let i of t)!0!==e(i.id,i.data)&&UT(i.children,e)}function VT(t,e){if(!0!==e(t.id,t.data))for(let i of t.children)VT(i,e)}var jT,GT=class extends Array{constructor(){super(...arguments),Object.setPrototypeOf(this,GT.prototype)}deepFreeze(){let t=0;for(;t<this.length;)LT(this[t]),t++}fillCaches0(t,e){this.objCaches.set(t.id,t),this.parentCaches.set(t.id,e);for(let i of t.children)this.fillCaches0(i,t.id)}fillCaches(){if(void 0===this.objCaches){this.objCaches=new Map,this.parentCaches=new Map;for(let t of this)this.fillCaches0(t,null)}}randomId(){this.fillCaches();let t=Array.from(this.objCaches.keys());if(0!==t.length)return t[Math.max(0,Math.floor(Math.random()*t.length)-1)]}nonExistOrDescendantOf(t,e){if(!this.has(t))return!0;for(;t;){let i=this.parent(t);if(i===e)return!0;t=i}return!1}rootAcestor(t){for(;t;){let e=this.parent(t);if(!e)return t;t=e}return t}isDescendantOf(t,e){for(;t;){let i=this.parent(t);if(i===e)return!0;t=i}return!1}data(t){return this.get(t)?.data}has(t){return void 0!==this.childrenOf(t)}get(t){return this.fillCaches(),this.objCaches.get(t)}childrenOf(t){return null===t?this:this.get(t)?.children}traverseFrom(t,e){if(null===t)this.traverse(e);else{let i=this.get(t);i&&VT(i,e)}}traverse(t){UT(this,t)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(t){return this.fillCaches(),this.parentCaches.get(t)}childrenArray(t){return null===t?this:this.get(t).children}modifyById(t,e){if(void 0===this.get(t))throw new Error("not expected");{let i=this.parent(t),n=this.childrenArray(i),r=n.findIndex((e=>e.id===t));if(r<0)throw new Error("not expected");let s=n[r];return n=[...n],n[r]={...s,data:e},this.modifyArrayBy(i,n)}}modifyArrayBy(t,e){let i=t,n=e;for(;null!==i;){let t=n,e=i;if(i=this.parent(i),void 0===i)throw new Error;n=this.childrenArray(i);let r=n.findIndex((t=>t.id===e));if(r<0)throw new Error;n=[...n],n[r]={...n[r],children:t}}Object.setPrototypeOf(n,GT.prototype);let r=n;return r.fillCaches(),r}runOp(t){switch(t.type){case 7:return this.addOp(t);case 8:return this.deleteOp(t);case 9:return this.moveOp(t)}return null}checkDuplicatedIdRec(t){let{id:e,children:i}=t;if(void 0!==this.get(e))return!0;for(let n of i)if(this.checkDuplicatedIdRec(n))return!0;return!1}addOp(t){let{parent:e,fi:i,id:n,data:r,children:s}=t;if(null!==e&&void 0===this.get(e))return null;if(this.checkDuplicatedIdRec(t))return null;{let a=e,o=this.childrenArray(a),l={fi:i,id:n,data:r,children:s};return o=[...o,l],o.sort(((t,e)=>t.fi-e.fi)),t.localIndex=o.indexOf(l),{data:this.modifyArrayBy(a,o),actual:t,reverse:{type:8,id:n}}}}deleteOp(t){let{id:e}=t;if(null===this.get(e))return null;{let i=this.parent(e);if(void 0===i)return null;let n=this.childrenArray(i),r=n.findIndex((t=>t.id===e));t.localIndex=r,n=[...n];let s=n.splice(r,1)[0];return{data:this.modifyArrayBy(i,n),actual:t,reverse:{type:7,...s,parent:i}}}}moveOp(t){let{parent:e,fi:i,id:n}=t;if(null!==e&&void 0===this.get(e))return this.deleteOp({type:8,id:n});if(null!==e){let t=e;for(;null!==t;){if(void 0===t)throw new Error;if(t===n)throw new BT("cyclic tree");t=this.parent(t)}}let r=this.parent(n);if(void 0===r)return null;let s=r,a=this.childrenArray(r),o=a.findIndex((t=>t.id===n));a=[...a];let l=a.splice(o,1)[0],h=this.modifyArrayBy(r,a);r=e,a=h.childrenArray(r);let c=l.fi;return l={...l,fi:i},a=[...a,l],a.sort(((t,e)=>t.fi-e.fi)),t.localIndex=a.indexOf(l),h=h.modifyArrayBy(r,a),{data:h,actual:t,reverse:{type:9,parent:s,fi:c,id:n}}}previous(t,e){if(null===e){let e=this.childrenArray(t);return 0===e.length?null:e[e.length-1].id}let i=null;for(let n of this.childrenArray(t)){if(n.id===e)return i;i=n.id}return null}traverseSortNext(t){let e=this.parent(t);if(void 0!==e){let i=this.childrenArray(e),n=i.findIndex((e=>e.id===t))+1;if(n<i.length)return i[n].id;if(e)return this.traverseSortNext(e)}}sortNext(t){let e=this.childrenArray(t);return e.length>0?e[0].id:this.traverseSortNext(t)}traverseSortPrevious(t){let e=this.childrenArray(t);return e.length>0?this.traverseSortPrevious(e[e.length-1].id):t}sortPrevious(t){let e=this.parent(t);if(void 0!==e){let i=this.childrenArray(e),n=i.findIndex((e=>e.id===t))-1;return n>=0?this.traverseSortPrevious(i[n].id):e}}getAllSorted(t){let e=[];for(let i of t){let t=this.getWithSortKey(i.id);void 0!==t&&e.push({...i,...t})}e.sort(((t,e)=>function(t,e){let i=0;for(;i<t.length&&i<e.length;){if(t[i]<e[i])return-1;if(t[i]>e[i])return 1;i+=1}return i!==e.length?-1:i!==t.length?1:0}(t.sortKey,e.sortKey)));for(let i of e)delete i.sortKey;return e}getWithSortKey(t){var e=t;let i=[],n=this.get(e),r=n;if(void 0!==n){for(;e;)i.splice(0,0,n.fi),null!==(e=this.parent(e))&&(n=this.get(e));return{...r,sortKey:i}}}insertBeforeHelper(t,e,i){return this.insertAfterHelper(t,this.previous(t,e),i)}insertAfterHelper(t,e,i){let n=this.childrenArray(t);if(null===e){if(0===n.length)return FT(0,i,i);{let t=n[0].fi;return FT(t-i,t,i)}}{let r=this.get(e);if(void 0===r||this.parent(e)!==t)throw new Error("illegal args");let s=n.find((t=>t.fi>r.fi));if(void 0===s){let t=n[n.length-1].fi;return FT(t,t+i,i)}return FT(r.fi,s.fi,i)}}};(jT||(jT={})).runOp=function(t,e){if(0!==e.type)return null;if(Array.isArray(t)){let i=e.props,n={},r=[...t],s=!1;if(i)for(let t of Object.keys(i)){let e=parseInt(t);if(isNaN(e))throw new Error("wrong index");n[t]=r[e],r[e]=i[t],s=!0}return s?{data:r,actual:e,reverse:{type:0,props:n}}:null}{let i=e.props,n={},r={...t},s=!1;if(i)for(let t of Object.keys(i)){n[t]=r[t];let e=i[t];void 0===e?delete r[t]:r[t]=e,s=!0}return s?{data:r,actual:e,reverse:{type:0,props:n}}:null}};var HT=class extends Array{constructor(){super(...arguments),Object.setPrototypeOf(this,HT.prototype)}deepFreeze(){let t=0;for(;t<this.length;)LT(this[t]),t++}fillCaches0(t){this.objCaches.set(t.id,t)}fillCaches(){if(void 0===this.objCaches){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let t of this)this.fillCaches0(t)}}randomId(){this.fillCaches();let t=Array.from(this.objCaches.keys());if(0!==t.length)return t[Math.max(0,Math.floor(Math.random()*t.length)-1)]}data(t){return this.get(t)?.data}get(t){return this.fillCaches(),this.objCaches.get(t)}modifyById(t,e){if(void 0===this.get(t))throw new Error("not expected");{let i=this,n=i.findIndex((e=>e.id===t));if(n<0)throw new Error("not expected");let r=i[n];return i=[...i],i[n]={...r,data:e},this.modifyArrayBy(i)}}modifyArrayBy(t){Object.setPrototypeOf(t,HT.prototype);let e=t;return typeof process<"u"||e.fillCaches(),e}runOp(t){switch(t.type){case 4:return this.addOp(t);case 5:return this.deleteOp(t);case 6:return this.moveOp(t)}return null}addOp(t){let{fi:e,id:i,data:n}=t,r=this,s={fi:e,id:i,data:n};return r=[...r,s],r.sort(((t,e)=>t.fi-e.fi)),t.localIndex=r.indexOf(s),{data:this.modifyArrayBy(r),actual:t,reverse:{type:5,id:i}}}deleteOp(t){let{id:e}=t,i=this,n=i.findIndex((t=>t.id===e));if(-1===n)return null;t.localIndex=n,i=[...i];let r=i.splice(n,1)[0];return{data:this.modifyArrayBy(i),actual:t,reverse:{type:4,...r}}}moveOp(t){let{fi:e,id:i}=t,n=this;n=[...n];let r=n.findIndex((t=>t.id===i));if(-1===r)return null;let s=n[r].fi,a={...n[r],fi:e};return n[r]=a,n.sort(((t,e)=>t.fi-e.fi)),t.localIndex=n.indexOf(a),{data:this.modifyArrayBy(n),actual:t,reverse:{type:6,fi:s,id:i}}}previous(t){if(null===t)return 0===this.length?null:this[this.length-1].id;let e=null;for(let i of this){if(i.id===t)return e;e=i.id}return null}insertBeforeHelper(t,e){return this.insertAfterHelper(this.previous(t),e)}insertAfterHelper(t,e){let i=this;if(null===t){if(0===i.length)return FT(0,e,e);{let t=i[0].fi;return FT(t-e,t,e)}}{let n=this.get(t);if(void 0===n)throw new Error("illegal args");let r=i.find((t=>t.fi>n.fi));if(void 0===r){let t=i[i.length-1].fi;return FT(t,t+e,e)}return FT(n.fi,r.fi,e)}}};function WT(t){return t&&"object"==typeof t&&t instanceof ZT}var qT,YT,XT,QT,KT,ZT=class{unusedFunOverridesTable(t){}runOp(t){let e=[],i=this,n=0,r={};for(;n<t.path.length;){if(e.push(i),i=void 0===i?void 0:i[t.path[n]],void 0!==i&&!WT(i))return null;n+=1}i=i?zT(i):new ZT;for(let[s,a]of Object.entries(t.props)){let t=i[s];r[s]=t,void 0===a?delete i[s]:i[s]=a}for(;n>0;){if(0===Object.keys(i).length){let r=e[n-1];r&&(i=zT(r),delete i[t.path[n-1]])}else{let r=e[n-1];if(r){let e=zT(r);e[t.path[n-1]]=i,i=e}else{let e=new ZT;e[t.path[n-1]]=i,i=e}}n-=1}return{data:Object.setPrototypeOf(i,ZT.prototype),actual:t,reverse:{...t,props:r}}}};function JT(t,e){if(void 0===e)return;let i=!1,n=t.map((t=>{let n=t.id,r=$T(t.data,e[n]);if(i=i||void 0!==r,void 0===r&&(r=t.data),t.children){let s=JT(t.children,e);return void 0!==s?i=!0:s=t.children,{...t,id:n,data:r,children:s}}return{...t,id:n,data:r}}));return i?n:void 0}function $T(t,e){if(!WT(e))return e;if(t instanceof GT){let i=JT(t,e);return void 0!==i&&Object.setPrototypeOf(i,Object.getPrototypeOf(t)),i}if(t instanceof HT)return function(t,e){if(void 0===e)return;let i=!1,n=t.map((t=>{let n=t.id,r=$T(t.data,e[n]);return i=i||void 0!==r,void 0===r&&(r=t.data),{...t,id:n,data:r}}));return i?(Object.setPrototypeOf(n,Object.getPrototypeOf(t)),n):void 0}(t,e);if(Array.isArray(t)){let i=!1,n=t.map(((t,n)=>{let r=$T(t,e[n]);return i=i||void 0!==r,void 0===r&&(r=t),r}));return i?(Object.setPrototypeOf(n,Object.getPrototypeOf(t)),n):void 0}if(t instanceof ZT)return tD(t,e);if(t&&"object"==typeof t){let i={},n=!1;for(let[r,s]of Object.entries(t)){let t=$T(s,e[r]);n=n||void 0!==t,void 0===t&&(t=s),i[r]=t}return n?(Object.setPrototypeOf(i,Object.getPrototypeOf(t)),i):void 0}}function tD(t,e){if(void 0===t)return e;if(void 0===e)return t;if(!WT(e))return e;if(!WT(t))return qT.apply(t,e);let i=new Set;for(let r of Object.keys(t))i.add(r);for(let r of Object.keys(e))i.add(r);let n=new ZT;for(let r of i){let i=tD(void 0===t?void 0:t[r],void 0===e?void 0:e[r]);n[r]=i}return n}function eD(t,e){let i={cur:[],result:[],len:0};return[t=sD(t,e,i)??t,i.result]}function iD(t,e){return null===t?null:(t.cur[t.len]=e,t.len+=1,t)}function nD(t){t&&(t.len-=1)}function rD(t,e,i){let n=!1,r=t.map((t=>{let r=t.id,s=e[r];if(void 0!==s&&"string"==typeof s&&(n=!0,r=s,null!==i))throw new Error("not supported");let a=sD(t.data,e,iD(i,r));nD(i),n=n||void 0!==a,void 0===a&&(a=t.data);let o=rD(t.children,e,i);return void 0!==o?n=!0:o=t.children,{...t,id:r,data:a,children:o}}));if(n)return r}function sD(t,e,i){if(t instanceof GT){let n=rD(t,e,i);return void 0!==n&&Object.setPrototypeOf(n,Object.getPrototypeOf(t)),n}if(t instanceof HT)return function(t,e,i){let n=!1,r=t.map((t=>{let r=t.id,s=e[r];if(void 0!==s&&"string"==typeof s&&(n=!0,r=s,null!==i))throw new Error("not supported");let a=sD(t.data,e,iD(i,r));return nD(i),n=n||void 0!==a,void 0===a&&(a=t.data),{...t,id:r,data:a}}));if(n)return Object.setPrototypeOf(r,Object.getPrototypeOf(t)),r}(t,e,i);if(Array.isArray(t)){let n=!1,r=t.map(((t,r)=>{let s=sD(t,e,iD(i,r));return nD(i),n=n||void 0!==s,void 0===s&&(s=t),s}));return n?(Object.setPrototypeOf(r,Object.getPrototypeOf(t)),r):void 0}if(t&&"object"==typeof t&&!NT(t)){let n={},r=!1;for(let[s,a]of Object.entries(t))if("name"!==s&&"variableId"!==s){let t=e[s];if("string"==typeof t){if(null!==i)throw new Error("not supported");r=!0,s=t}let o=sD(a,e,iD(i,s));nD(i),r=r||void 0!==o,void 0===o&&(o=a),n[s]=o}else n[s]=a;return r?(Object.setPrototypeOf(n,Object.getPrototypeOf(t)),n):void 0}if("string"==typeof t){let n=e[t];return void 0!==n&&function(t){if(null===t)return null;t.result.push(t.cur.slice(0,t.len))}(i),n}}(YT=qT||(qT={})).apply=function(t,e){return $T(t,e)??t},YT.merge=function(t,e){return tD(t,e)},YT.filterOp=function(t,e){let i=0,n=e.path,r=t;for(;i<n.length&&void 0!==r;){if(r=yD.zoomOnce(r,n[i]),void 0===r)return e;if(!WT(r))return;i+=1}if(void 0===r)return e;if(WT(r)){if(0===e.type){let t={...e.props};for(let e of Object.keys(r))delete t[e];return{...e,props:t}}if(1===e.type||4===e.type||7===e.type){let t=JT([e],r);return t?(console.log(t),t):e}return e}},(t=>{t.replaceProps=function(t,e){let i=yD.zoom(e,t.path);if("object"==typeof i){let e={};for(let n of Object.keys(t.props))e[n]=i[n];return{...t,props:e}}return{...t,props:{}}}})(XT||(XT={})),(t=>{function e(t,e){let i=e.path;for(var n=[];;){let r;if(t instanceof ZT&&0===e.type&&(r=t.runOp({...e,path:i.slice(n.length)}),null===r&&(r=void 0)),void 0===r&&n.length===i.length&&(r=t instanceof GT||t instanceof HT||t instanceof OT?t.runOp(e):jT.runOp(t,e)),void 0!==r){if(null!==r){let t=r.data;for(let e=n.length-1;e>=0;e--){let r=i[e],s=n[e];if(s instanceof GT){if("number"==typeof r)throw new Error("illegal arg");t=s.modifyById(r,t)}else if(s instanceof HT){if("number"==typeof r)throw new Error("illegal arg");t=s.modifyById(r,t)}else if(s instanceof OT){if("number"==typeof r)throw new Error("illegal arg");t=s.modifyById(r,t)}else if(s instanceof ZT){let e={...s,[r]:t};t=Object.setPrototypeOf(e,ZT.prototype)}else{if("object"!=typeof s)return null;if(Array.isArray(s)){if("string"==typeof r&&(r=parseInt(r),isNaN(r)))throw new Error("Invalid path");let e=t;t=[...s],t[r]=e}else t={...s,[r]:t}}}return{data:t,actual:{...r.actual,path:i},reverse:{...r.reverse,path:i}}}return null}let s,a=i[n.length];if(t instanceof GT){if("number"==typeof a)throw new Error("");s=t.get(a)?.data}else if(t instanceof HT){if("number"==typeof a)throw new Error("");s=t.get(a)?.data}else null!==t&&(s=t[a]);if(void 0===s)return null;n.push(t),t=s}}function i(t,e){for(let i=0;i<t.length&&i<e.length;i++)if(t[i]!==e[i])return!0;return!1}function n(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}t.drop=function(t,e){return{...t,path:t.path.slice(e)}},t.applySimple=function(t,i){return e(t,i)?.data??t},t.apply=e,t.pathDisjoint=i,t.pathEq=n,t.commutative=function(t,e){return i(t.path,e.path)},t.subsumed=function(t,e){return!(0!==t.type||0!==e.type||!n(t.path,e.path))&&Object.keys(t.props).every((t=>void 0!==e.props[t]))}})(QT||(QT={})),(t=>{function e(t,e){var i=t;let n=[],r=[];for(let a of e)try{if(3===a.type||5===a.type&&"variables"===a.path[a.path.length-1]){let t,e,s;if(3===a.type?(t=yD.zoom(i,[...a.path,a.id]),s=QT.apply(i,{...a,type:2})):(t=yD.zoom(i,[...a.path,a.id,"value"]),s=QT.apply(i,a)),null!==s){i=s.data;let[o,l]=eD(i,{[a.id]:t});i=o;for(let s=0;s<l.length;s++){let o=l[s],h=o.pop();if("number"==typeof h){let n=[h];for(let t=s+1;t<l.length;t++){let e=l[t],i=e[e.length-1];if("number"!=typeof i||!yD.equal(o,e.slice(0,e.length-1)))break;n.push(i),l.splice(t,1)}let r=yD.zoom(i,o);e=r.map(((t,e)=>n.includes(e)?a.id:t)),t=r,h=o.pop()}else{if("alphaOverride"===h||"alpha"===h){t/=100;let e=t,n=yD.zoom(i,o.slice(0,o.length-2)),r=n.layers.map((t=>t.id===o[o.length-1]?{...t,data:{...t.data,[h]:e}}:t));Object.setPrototypeOf(r,Object.getPrototypeOf(n.layers)),n.layers=r}e=a.id}n.push({type:0,path:o,props:{[h]:t}}),r.push({type:0,path:o,props:{[h]:e}})}r.push(s.reverse),n.push(s.actual)}}else{let t=QT.apply(i,a);null!==t&&(n.push(t.actual),i=t.data,r.push(t.reverse))}}catch(s){if(s instanceof BT)return null;throw s}return{data:i,actual:n,reverse:r.reverse()}}t.empty=function(){return[]},t.removePrefix=function(t,e){let i=[];for(let n of t){let[t,...r]=n.path;t===e&&i.push({...n,path:r})}return i},t.addPrefix=function(t,e){return t.map((t=>({...t,path:[e,...t.path]})))},t.concat=function(t,e){return[...t,...e]},t.compress=function(t,e){return[...t.filter((t=>!e.some((e=>QT.subsumed(t,e))))),...e]},t.commutative=function(t,e){return t.every((t=>e.every((e=>QT.commutative(t,e)))))},t.applyAll=function(t,i){for(let n of i){let i=e(t,n);null!==i&&(t=i.data)}return t},t.apply=e})(KT||(KT={}));var aD=Symbol(),oD=Symbol(),lD=Symbol(),hD=class{reportOp(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=this;if(null===e)return;n._current=e.data;let r=i;for(;!(n instanceof bD);){let t=n._path,e=n._current;if(""!==t&&r.splice(0,0,t),n=n._parent,null===n)return;n.update(t,e)}n.push(r,t,e.actual,e.reverse)}deleteChildren(t){if(this._children){let e=this._children[t];if(e){let i=e[lD];i&&i(),delete this._children[t]}}}},cD=class extends hD{constructor(t,e,i){super(),this._parent=t,this._path=e,this._current=i}update(t,e){if(Array.isArray(this._current)){if("string"==typeof t&&(t=parseInt(t),isNaN(t)))throw new Error("Invalid path");this._current=[...this._current],this._current[t]=e}else this._current={...this._current,[t]:e}}runOp(t){this.reportOp(t,jT.runOp(this._current,t),t.path)}},uD=class extends hD{constructor(t,e,i){super(),this._parent=t,this._path=e,this._current=i}update(t,e){this._current={...this._current,[t]:e},Object.setPrototypeOf(this._current,OT.prototype)}runOp(t){this.reportOp(t,this._current.runOp(t))}},dD={get(t,e){if(e===lD)return()=>{t._parent=null};if(e===aD)return t._current;if(e===oD)return t;let{_current:i,_children:n}=t;if("push"===e&&Array.isArray(i))throw new Error("not supported to expand array");let r=void 0===n?void 0:n[e];if(void 0!==r)return r;let s=i[e],a=xD(t,e,s);return a!==s?(void 0===n&&(n={},t._children=n),n[e]=a,a):s},has:(t,e)=>e in t._current,ownKeys:t=>Reflect.ownKeys(t._current),defineProperty(){throw Error("not supported")},getPrototypeOf:t=>Object.getPrototypeOf(t._current),setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(t,e){let i=t._current,n=Reflect.getOwnPropertyDescriptor(i,e);return n&&{writable:!0,configurable:!0,enumerable:n.enumerable,value:i[e]}}},pD={...dD,set(t,e,i){let n={type:0,props:{[e]:AD(i)??i}};return t.deleteChildren(e),t.runOp(n),!0},deleteProperty(t,e){let i={type:0,props:{[e]:void 0}};return t.deleteChildren(e),t.runOp(i),!0}},fD={...dD,set(t,e,i){return void 0===i?this.deleteProperty(t,e):(t.deleteChildren(e),t.runOp({type:1,id:e,data:i})),!0},deleteProperty:(t,e)=>(t.runOp({type:2,id:e}),!0)},mD=class extends hD{constructor(t,e,i){super(),this._children={},this._parent=t,this._path=e,this._current=i,this[lD]=()=>{this._parent=null}}unproxy(){return this._current}update(t,e){this._current=this._current.modifyById(t,e)}runOp(t){this.reportOp(t,this._current.runOp(t))}randomId(){return this._current.randomId()}isDescendantOf(t,e){return this._current.isDescendantOf(t,e)}childrenOf(t){return this._current.childrenOf(t)}traverse(t){return this._current.traverse(t)}get(t){return this._current.get(t)}parent(t){return this._current.parent(t)}traverse(t){this._current.traverse(((e,i)=>{t(e,this.data(e))}))}data(t){let{_current:e,_children:i}=this,n=void 0===i?void 0:i[t];if(void 0!==n)return n;let r=e.get(t)?.data,s=xD(this,t,r);return s!==r?(void 0===i&&(i={},this._children=i),i[t]=s,s):r}add(t,e,i,n,r){this.runOp({type:7,parent:t,fi:e,id:i,data:n,children:r})}move(t,e,i){this.runOp({type:9,parent:t,fi:e,id:i})}insertAfter(t,e,i){let n=this._current.insertAfterHelper(t,e,i.length);for(let r=0;r<i.length;r++){let e=i[r];this.add(t,n[r],e.id,e.data,e.children)}}insertBefore(t,e,i){let n=this._current.insertBeforeHelper(t,e,i.length);for(let r=0;r<i.length;r++){let e=i[r];this.add(t,n[r],e.id,e.data,e.children)}}moveAfter(t,e,i){let n=this._current.insertAfterHelper(t,e,i.length);for(let r=0;r<i.length;r++){let e=i[r];this.move(t,n[r],e)}}moveBefore(t,e,i){let n=this._current.insertBeforeHelper(t,e,i.length);for(let r=0;r<i.length;r++){let e=i[r];this.move(t,n[r],e)}}delete(t){this.deleteChildren(t),this.runOp({type:8,id:t})}sortNext(t){return this._current.sortNext(t)}sortPrevious(t){return this._current.sortPrevious(t)}getAllSorted(t){return this._current.getAllSorted(t)}},gD=class extends hD{constructor(t,e,i){super(),this._children={},this._parent=t,this._path=e,this._current=i,this[lD]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(t){let e=this.length;for(let i=0;i<e;i++){let e=this._current[i].id,n=this._current[i].fi;t(this.data(this._current[i].id),e,n)}}find(t){let e=this.length;for(let i=0;i<e;i++){let e=this._current[i].id;if(t(this.data(e),e))return this.get(e)}}update(t,e){this._current=this._current.modifyById(t,e)}randomId(){return this._current.randomId()}get(t){return{...this._current.get(t),data:this.data(t)}}data(t){let{_current:e,_children:i}=this,n=void 0===i?void 0:i[t];if(void 0!==n)return n;let r=e.get(t)?.data,s=xD(this,t,r);return s!==r?(void 0===i&&(i={},this._children=i),i[t]=s,s):r}runOp(t){this.reportOp(t,this._current.runOp(t))}add(t,e,i){this.runOp({type:4,fi:t,id:e,data:i})}move(t,e){this.runOp({type:6,fi:t,id:e})}insertAfter(t,e){let i=this._current.insertAfterHelper(t,e.length);for(let n=0;n<e.length;n++){let t=e[n];this.add(i[n],t.id,t.data)}}insertBefore(t,e){let i=this._current.insertBeforeHelper(t,e.length);for(let n=0;n<e.length;n++){let t=e[n];this.add(i[n],t.id,t.data)}}moveAfter(t,e){let i=this._current.insertAfterHelper(t,e.length);for(let n=0;n<e.length;n++){let t=e[n];this.move(i[n],t)}}moveBefore(t,e){let i=this._current.insertBeforeHelper(t,e.length);for(let n=0;n<e.length;n++){let t=e[n];this.move(i[n],t)}}delete(t){this.deleteChildren(t),this.runOp({type:5,id:t})}};function vD(t,e,i){if(t.length>0){let n=t[t.length-1];if(0===n.type&&0===e.type&&yD.equal(n.path,i))return void Object.assign(n.props,e.props)}t.push({...e,path:i})}var yD,bD=class extends hD{constructor(t){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=t}update(t,e){if(""!==t)throw new Error("");this._current=e}push(t,e,i,n){vD(this.ts,e,t),vD(this.actual,i,t),vD(this.reverse,n,t)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function xD(t,e,i){return i instanceof GT?new mD(t,e,i):i instanceof HT?new gD(t,e,i):i instanceof OT?new Proxy(new uD(t,e,i),fD):null!==i&&"object"==typeof i?NT(i)?i:new Proxy(new cD(t,e,i),pD):i}function wD(t){let e=new bD(t);return[xD(e,"",t),e]}function SD(t,e){let[i,n]=wD(t);return e(i),n.result()}function AD(t){return t instanceof mD||t instanceof gD?t._current:null!==t&&"object"==typeof t?t[aD]:t}function ED(t,e){let i=[];if(!(e.length<=t.length))return null;for(var n=0;n<e.length;){if("*"===e[n])i.push(t[n]);else if(t[n]!==e[n])return null;n+=1}return i}(t=>{function e(t,e){return(t instanceof GT||t instanceof mD)&&"string"==typeof e||(t instanceof HT||t instanceof gD)&&"string"==typeof e?t.data(e):"number"==typeof e&&Array.isArray(t)||"string"==typeof e&&"object"==typeof t&&null!==t?t[e]:void 0}function i(t,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(;n<i.length&&void 0!==t;)t=e(t,i[n]),n+=1;return t}t.equal=function(t,e){if(e.length!==t.length)return!1;for(var i=0;i<t.length;){if(t[i]!==e[i])return!1;i+=1}return!0},t.removeOverridden=function(t,e,n){let r=i(n,t);if(void 0!==r&&"object"==typeof r&&null!==r){let t={...e};return Object.keys(r).forEach((e=>{delete t[e]})),t}return e},t.zoomOnce=e,t.zoom=i})(yD||(yD={}));var _D,CD=class{},MD=class extends CD{constructor(t){super(),this.id=t}},PD=class extends CD{constructor(t){super(),this.data=t}};try{_D=new TextDecoder}catch{}var TD,DD,kD,ID,RD,OD,LD,BD=0,zD=[],FD=zD,ND=0,UD={},VD=0,jD=0,GD=[],HD={useRecords:!1,mapsAsObjects:!0},WD=class{},qD=new WD;qD.name="MessagePack 0xC1";var YD=!1,XD=class{constructor(t){t&&(!1===t.useRecords&&void 0===t.mapsAsObjects&&(t.mapsAsObjects=!0),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0)),Object.assign(this,t)}unpack(t,e){if(TD)return bk((()=>(xk(),this?this.unpack(t,e):XD.prototype.unpack.call(HD,t,e))));DD=e>-1?e:t.length,BD=0,ND=0,jD=0,ID=null,FD=zD,RD=null,TD=t;try{LD=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(YT){throw TD=null,t instanceof Uint8Array?YT:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&"object"==typeof t?t.constructor.name:typeof t))}if(this instanceof XD){if(UD=this,this.structures)return kD=this.structures,QD();(!kD||kD.length>0)&&(kD=[])}else UD=HD,(!kD||kD.length>0)&&(kD=[]);return QD()}unpackMultiple(t,e){let i,n=0;try{YD=!0;let r=t.length,s=this?this.unpack(t,r):Ak.unpack(t,r);if(!e){for(i=[s];BD<r;)n=BD,i.push(QD());return i}for(e(s);BD<r;)if(n=BD,!1===e(QD()))return}catch(FI){throw FI.lastPosition=n,FI.values=i,FI}finally{YD=!1,xk()}}_mergeStructures(t,e){for(let i=0,n=(t=t||[]).length;i<n;i++){let e=t[i];e&&(e.isShared=!0,i>=32&&(e.highByte=i-32>>5))}t.sharedLength=t.length;for(let i in e||[])if(i>=0){let n=t[i],r=e[i];r&&(n&&((t.restoreStructures||(t.restoreStructures=[]))[i]=n),t[i]=r)}return this.structures=t}decode(t,e){return this.unpack(t,e)}};function QD(){try{if(!UD.trusted&&!YD){let t=kD.sharedLength||0;t<kD.length&&(kD.length=t)}let t=ZD();if(BD==DD)kD.restoreStructures&&KD(),kD=null,TD=null,OD&&(OD=null);else{if(BD>DD){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}if(!YD)throw new Error("Data read, but end of buffer not reached")}return t}catch(Fz){throw kD.restoreStructures&&KD(),xk(),(Fz instanceof RangeError||Fz.message.startsWith("Unexpected end of buffer"))&&(Fz.incomplete=!0),Fz}}function KD(){for(let t in kD.restoreStructures)kD[t]=kD.restoreStructures[t];kD.restoreStructures=null}function ZD(){let t=TD[BD++];if(t<160){if(t<128){if(t<64)return t;{let e=kD[63&t]||UD.getStructures&&ek()[63&t];return e?(e.read||(e.read=$D(e,63&t)),e.read()):t}}if(t<144){if(t-=128,UD.mapsAsObjects){let e={};for(let i=0;i<t;i++)e[mk()]=ZD();return e}{let e=new Map;for(let i=0;i<t;i++)e.set(ZD(),ZD());return e}}{t-=144;let e=new Array(t);for(let i=0;i<t;i++)e[i]=ZD();return e}}if(t<192){let e=t-160;if(jD>=BD)return ID.slice(BD-VD,(BD+=e)-VD);if(0==jD&&DD<140){let t=e<16?uk(e):ck(e);if(null!=t)return t}return ik(e)}{let e;switch(t){case 192:return null;case 193:return RD?(e=ZD(),e>0?RD[1].slice(RD.position1,RD.position1+=e):RD[0].slice(RD.position0,RD.position0-=e)):qD;case 194:return!1;case 195:return!0;case 196:return dk(TD[BD++]);case 197:return e=LD.getUint16(BD),BD+=2,dk(e);case 198:return e=LD.getUint32(BD),BD+=4,dk(e);case 199:return pk(TD[BD++]);case 200:return e=LD.getUint16(BD),BD+=2,pk(e);case 201:return e=LD.getUint32(BD),BD+=4,pk(e);case 202:if(e=LD.getFloat32(BD),UD.useFloat32>2){let t=wk[(127&TD[BD])<<1|TD[BD+1]>>7];return BD+=4,(t*e+(e>0?.5:-.5)|0)/t}return BD+=4,e;case 203:return e=LD.getFloat64(BD),BD+=8,e;case 204:return TD[BD++];case 205:return e=LD.getUint16(BD),BD+=2,e;case 206:return e=LD.getUint32(BD),BD+=4,e;case 207:return UD.int64AsNumber?(e=4294967296*LD.getUint32(BD),e+=LD.getUint32(BD+4)):e=LD.getBigUint64(BD),BD+=8,e;case 208:return LD.getInt8(BD++);case 209:return e=LD.getInt16(BD),BD+=2,e;case 210:return e=LD.getInt32(BD),BD+=4,e;case 211:return UD.int64AsNumber?(e=4294967296*LD.getInt32(BD),e+=LD.getUint32(BD+4)):e=LD.getBigInt64(BD),BD+=8,e;case 212:if(e=TD[BD++],114==e)return gk(63&TD[BD++]);{let t=GD[e];if(t)return t.read?(BD++,t.read(ZD())):t.noBuffer?(BD++,t()):t(TD.subarray(BD,++BD));throw new Error("Unknown extension "+e)}case 213:return e=TD[BD],114==e?(BD++,gk(63&TD[BD++],TD[BD++])):pk(2);case 214:return pk(4);case 215:return pk(8);case 216:return pk(16);case 217:return e=TD[BD++],jD>=BD?ID.slice(BD-VD,(BD+=e)-VD):nk(e);case 218:return e=LD.getUint16(BD),jD>=(BD+=2)?ID.slice(BD-VD,(BD+=e)-VD):rk(e);case 219:return e=LD.getUint32(BD),jD>=(BD+=4)?ID.slice(BD-VD,(BD+=e)-VD):sk(e);case 220:return e=LD.getUint16(BD),BD+=2,ok(e);case 221:return e=LD.getUint32(BD),BD+=4,ok(e);case 222:return e=LD.getUint16(BD),BD+=2,lk(e);case 223:return e=LD.getUint32(BD),BD+=4,lk(e);default:if(t>=224)return t-256;if(void 0===t){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}throw new Error("Unknown MessagePack token "+t)}}}var JD=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function $D(t,e){function i(){if(i.count++>2){let i=t.read=new Function("r","return function(){return {"+t.map((t=>JD.test(t)?t+":r()":"["+JSON.stringify(t)+"]:r()")).join(",")+"}}")(ZD);return 0===t.highByte&&(t.read=tk(e,t.read)),i()}let n={};for(let e=0,i=t.length;e<i;e++){n[t[e]]=ZD()}return n}return i.count=0,0===t.highByte?tk(e,i):i}var tk=(t,e)=>function(){let i=TD[BD++];if(0===i)return e();let n=t<32?-(t+(i<<5)):t+(i<<5),r=kD[n]||ek()[n];if(!r)throw new Error("Record id is not defined for "+n);return r.read||(r.read=$D(r,t)),r.read()};function ek(){let t=bk((()=>(TD=null,UD.getStructures())));return kD=UD._mergeStructures(t,kD)}var ik=ak,nk=ak,rk=ak,sk=ak;function ak(t){let e;if(t<16&&(e=uk(t)))return e;if(t>64&&_D)return _D.decode(TD.subarray(BD,BD+=t));let i=BD+t,n=[];for(e="";BD<i;){let t=TD[BD++];if(0===(128&t))n.push(t);else if(192===(224&t)){let e=63&TD[BD++];n.push((31&t)<<6|e)}else if(224===(240&t)){let e=63&TD[BD++],i=63&TD[BD++];n.push((31&t)<<12|e<<6|i)}else if(240===(248&t)){let e=(7&t)<<18|(63&TD[BD++])<<12|(63&TD[BD++])<<6|63&TD[BD++];e>65535&&(e-=65536,n.push(e>>>10&1023|55296),e=56320|1023&e),n.push(e)}else n.push(t);n.length>=4096&&(e+=hk.apply(String,n),n.length=0)}return n.length>0&&(e+=hk.apply(String,n)),e}function ok(t){let e=new Array(t);for(let i=0;i<t;i++)e[i]=ZD();return e}function lk(t){if(UD.mapsAsObjects){let e={};for(let i=0;i<t;i++)e[mk()]=ZD();return e}{let e=new Map;for(let i=0;i<t;i++)e.set(ZD(),ZD());return e}}var hk=String.fromCharCode;function ck(t){let e=BD,i=new Array(t);for(let n=0;n<t;n++){let t=TD[BD++];if((128&t)>0)return void(BD=e);i[n]=t}return hk.apply(String,i)}function uk(t){if(t<4){if(t<2){if(0===t)return"";{let t=TD[BD++];return(128&t)>1?void(BD-=1):hk(t)}}{let e=TD[BD++],i=TD[BD++];if((128&e)>0||(128&i)>0)return void(BD-=2);if(t<3)return hk(e,i);let n=TD[BD++];return(128&n)>0?void(BD-=3):hk(e,i,n)}}{let e=TD[BD++],i=TD[BD++],n=TD[BD++],r=TD[BD++];if((128&e)>0||(128&i)>0||(128&n)>0||(128&r)>0)return void(BD-=4);if(t<6){if(4===t)return hk(e,i,n,r);{let t=TD[BD++];return(128&t)>0?void(BD-=5):hk(e,i,n,r,t)}}if(t<8){let s=TD[BD++],a=TD[BD++];if((128&s)>0||(128&a)>0)return void(BD-=6);if(t<7)return hk(e,i,n,r,s,a);let o=TD[BD++];return(128&o)>0?void(BD-=7):hk(e,i,n,r,s,a,o)}{let s=TD[BD++],a=TD[BD++],o=TD[BD++],l=TD[BD++];if((128&s)>0||(128&a)>0||(128&o)>0||(128&l)>0)return void(BD-=8);if(t<10){if(8===t)return hk(e,i,n,r,s,a,o,l);{let t=TD[BD++];return(128&t)>0?void(BD-=9):hk(e,i,n,r,s,a,o,l,t)}}if(t<12){let h=TD[BD++],c=TD[BD++];if((128&h)>0||(128&c)>0)return void(BD-=10);if(t<11)return hk(e,i,n,r,s,a,o,l,h,c);let u=TD[BD++];return(128&u)>0?void(BD-=11):hk(e,i,n,r,s,a,o,l,h,c,u)}{let h=TD[BD++],c=TD[BD++],u=TD[BD++],d=TD[BD++];if((128&h)>0||(128&c)>0||(128&u)>0||(128&d)>0)return void(BD-=12);if(t<14){if(12===t)return hk(e,i,n,r,s,a,o,l,h,c,u,d);{let t=TD[BD++];return(128&t)>0?void(BD-=13):hk(e,i,n,r,s,a,o,l,h,c,u,d,t)}}{let p=TD[BD++],f=TD[BD++];if((128&p)>0||(128&f)>0)return void(BD-=14);if(t<15)return hk(e,i,n,r,s,a,o,l,h,c,u,d,p,f);let m=TD[BD++];return(128&m)>0?void(BD-=15):hk(e,i,n,r,s,a,o,l,h,c,u,d,p,f,m)}}}}}function dk(t){return UD.copyBuffers?Uint8Array.prototype.slice.call(TD,BD,BD+=t):TD.subarray(BD,BD+=t)}function pk(t){let e=TD[BD++];if(GD[e])return GD[e](TD.subarray(BD,BD+=t));throw new Error("Unknown extension type "+e)}var fk=new Array(4096);function mk(){let t=TD[BD++];if(!(t>=160&&t<192))return BD--,ZD();if(t-=160,jD>=BD)return ID.slice(BD-VD,(BD+=t)-VD);if(!(0==jD&&DD<180))return ik(t);let e,i=4095&(t<<5^(t>1?LD.getUint16(BD):t>0?TD[BD]:0)),n=fk[i],r=BD,s=BD+t-3,a=0;if(n&&n.bytes==t){for(;r<s;){if(e=LD.getUint32(r),e!=n[a++]){r=1879048192;break}r+=4}for(s+=3;r<s;)if(e=TD[r++],e!=n[a++]){r=1879048192;break}if(r===s)return BD=r,n.string;s-=3,r=BD}for(n=[],fk[i]=n,n.bytes=t;r<s;)e=LD.getUint32(r),n.push(e),r+=4;for(s+=3;r<s;)e=TD[r++],n.push(e);let o=t<16?uk(t):ck(t);return n.string=null!=o?o:ik(t)}var gk=(t,e)=>{var i=ZD();let n=t;void 0!==e&&(t=t<32?-((e<<5)+t):(e<<5)+t,i.highByte=e);let r=kD[t];return r&&r.isShared&&((kD.restoreStructures||(kD.restoreStructures=[]))[t]=r),kD[t]=i,i.read=$D(i,n),i.read()},vk="object"==typeof self?self:global;GD[0]=()=>{},GD[0].noBuffer=!0,GD[101]=()=>{let t=ZD();return(vk[t[0]]||Error)(t[1])},GD[105]=t=>{let e=LD.getUint32(BD-4);OD||(OD=new Map);let i,n=TD[BD];i=n>=144&&n<160||220==n||221==n?[]:{};let r={target:i};OD.set(e,r);let s=ZD();return r.used?Object.assign(i,s):(r.target=s,s)},GD[112]=t=>{let e=LD.getUint32(BD-4),i=OD.get(e);return i.used=!0,i.target},GD[115]=()=>new Set(ZD());var yk=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map((t=>t+"Array"));function bk(t){let e=DD,i=BD,n=ND,r=VD,s=jD,a=ID,o=FD,l=OD,h=RD,c=new Uint8Array(TD.slice(0,DD)),u=kD,d=kD.slice(0,kD.length),p=UD,f=YD,m=t();return DD=e,BD=i,ND=n,VD=r,jD=s,ID=a,FD=o,OD=l,RD=h,TD=c,YD=f,(kD=u).splice(0,kD.length,...d),UD=p,LD=new DataView(TD.buffer,TD.byteOffset,TD.byteLength),m}function xk(){TD=null,OD=null,kD=null}GD[116]=t=>{let e=t[0],i=yk[e];if(!i)throw new Error("Could not find typed array for code "+e);return new vk[i](Uint8Array.prototype.slice.call(t,1).buffer)},GD[120]=()=>{let t=ZD();return new RegExp(t[0],t[1])},GD[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],i=BD;BD+=e-4,(RD=[ZD(),ZD()]).position0=0,RD.position1=0;let n=BD;BD=i;try{return ZD()}finally{BD=n}},GD[255]=t=>4==t.length?new Date(1e3*(16777216*t[0]+(t[1]<<16)+(t[2]<<8)+t[3])):8==t.length?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+1e3*(4294967296*(3&t[3])+16777216*t[4]+(t[5]<<16)+(t[6]<<8)+t[7])):12==t.length?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+1e3*((128&t[4]?-281474976710656:0)+1099511627776*t[6]+4294967296*t[7]+16777216*t[8]+(t[9]<<16)+(t[10]<<8)+t[11])):new Date("invalid");var wk=new Array(147);for(let $2=0;$2<256;$2++)wk[$2]=+("1e"+Math.floor(45.15-.30103*$2));var Sk,Ak=new XD({useRecords:!1}),Ek=(Ak.unpack,Ak.unpackMultiple,Ak.unpack,new Float32Array(1));new Uint8Array(Ek.buffer,0,4);try{Sk=new TextEncoder}catch{}var _k,Ck,Mk,Pk,Tk,Dk=typeof Buffer<"u",kk=Dk?Buffer.allocUnsafeSlow:Uint8Array,Ik=Dk?Buffer:Uint8Array,Rk=Dk?4294967296:2144337920,Ok=0,Lk=null,Bk=/[\u0080-\uFFFF]/,zk=Symbol("record-id"),Fk=class extends XD{constructor(t){super(t),this.offset=0;let e,i,n,r,s,a=0,o=Ik.prototype.utf8Write?function(t,e,i){return Mk.utf8Write(t,e,i)}:!(!Sk||!Sk.encodeInto)&&function(t,e){return Sk.encodeInto(t,Mk.subarray(e)).written},l=this;t||(t={});let h=t&&t.sequential,c=t.structures||t.saveStructures,u=t.maxSharedStructures;if(null==u&&(u=c?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");let d=t.maxOwnStructures;null==d&&(d=c?32:64),h&&!t.saveStructures&&(this.structures=[]);let p=u>32||d+u>64,f=u+64,m=u+d+64;if(m>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let g=[],v=0,y=0;this.pack=this.encode=function(t,o){if(Mk||(Mk=new kk(8192),Pk=new DataView(Mk.buffer,0,8192),Ok=0),(Tk=Mk.length-10)-Ok<2048?(Mk=new kk(Mk.length),Pk=new DataView(Mk.buffer,0,Mk.length),Tk=Mk.length-10,Ok=0):Ok=Ok+7&2147483640,e=Ok,s=l.structuredClone?new Map:null,l.bundleStrings?(Lk=["",""],Mk[Ok++]=214,Mk[Ok++]=98,Lk.position=Ok-e,Ok+=4):Lk=null,i=l.structures,i){i.uninitialized&&(i=l._mergeStructures(l.getStructures()));let t=i.sharedLength||0;if(t>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let e=0;e<t;e++){let t=i[e];if(!t)continue;let n,r=i.transitions;for(let e=0,i=t.length;e<i;e++){let i=t[e];n=r[i],n||(n=r[i]=Object.create(null)),r=n}r[zk]=e+64}a=t}h||(i.nextId=t+64)}n&&(n=!1),r=i||[];try{if(b(t),Lk){Pk.setUint32(Lk.position+e,Ok-Lk.position-e);let t=Lk;Lk=null,b(t[0]),b(t[1])}if(l.offset=Ok,s&&s.idsToInsert){(Ok+=6*s.idsToInsert.length)>Tk&&w(Ok),l.offset=Ok;let t=function(t,e){let i,n=6*e.length,r=t.length-n;for(e.sort(((t,e)=>t.offset>e.offset?1:-1));i=e.pop();){let e=i.offset,s=i.id;t.copyWithin(e+n,e,r),n-=6;let a=e+n;t[a++]=214,t[a++]=105,t[a++]=s>>24,t[a++]=s>>16&255,t[a++]=s>>8&255,t[a++]=255&s,r=e}return t}(Mk.subarray(e,Ok),s.idsToInsert);return s=null,t}return o&Zk?(Mk.start=e,Mk.end=Ok,Mk):Mk.subarray(e,Ok)}finally{if(i){if(y<10&&y++,v>1e4)i.transitions=null,y=0,v=0,g.length>0&&(g=[]);else if(g.length>0&&!h){for(let t=0,e=g.length;t<e;t++)g[t][zk]=0;g=[]}if(n&&l.saveStructures){let n=i.sharedLength||u;i.length>n&&(i=i.slice(0,n));let r=Mk.subarray(e,Ok);return!1===l.saveStructures(i,a)?(l._mergeStructures(l.getStructures()),l.pack(t)):(a=n,r)}}o&Jk&&(Ok=e)}};let b=t=>{Ok>Tk&&(Mk=w(Ok));var i,n=typeof t;if("string"===n){let e,n=t.length;if(Lk&&n>=8&&n<4096){let e=Bk.test(t);return Lk[e?0:1]+=t,Mk[Ok++]=193,void b(e?-n:n)}e=n<32?1:n<256?2:n<65536?3:5;let r=3*n;if(Ok+r>Tk&&(Mk=w(Ok+r)),n<64||!o){let r,s,a,o=Ok+e;for(r=0;r<n;r++)s=t.charCodeAt(r),s<128?Mk[o++]=s:s<2048?(Mk[o++]=s>>6|192,Mk[o++]=63&s|128):55296===(64512&s)&&56320===(64512&(a=t.charCodeAt(r+1)))?(s=65536+((1023&s)<<10)+(1023&a),r++,Mk[o++]=s>>18|240,Mk[o++]=s>>12&63|128,Mk[o++]=s>>6&63|128,Mk[o++]=63&s|128):(Mk[o++]=s>>12|224,Mk[o++]=s>>6&63|128,Mk[o++]=63&s|128);i=o-Ok-e}else i=o(t,Ok+e,r);i<32?Mk[Ok++]=160|i:i<256?(e<2&&Mk.copyWithin(Ok+2,Ok+1,Ok+1+i),Mk[Ok++]=217,Mk[Ok++]=i):i<65536?(e<3&&Mk.copyWithin(Ok+3,Ok+2,Ok+2+i),Mk[Ok++]=218,Mk[Ok++]=i>>8,Mk[Ok++]=255&i):(e<5&&Mk.copyWithin(Ok+5,Ok+3,Ok+3+i),Mk[Ok++]=219,Pk.setUint32(Ok,i),Ok+=4),Ok+=i}else if("number"===n)if(t>>>0===t)t<64?Mk[Ok++]=t:t<256?(Mk[Ok++]=204,Mk[Ok++]=t):t<65536?(Mk[Ok++]=205,Mk[Ok++]=t>>8,Mk[Ok++]=255&t):(Mk[Ok++]=206,Pk.setUint32(Ok,t),Ok+=4);else if((t|0)===t)t>=-32?Mk[Ok++]=256+t:t>=-128?(Mk[Ok++]=208,Mk[Ok++]=t+256):t>=-32768?(Mk[Ok++]=209,Pk.setInt16(Ok,t),Ok+=2):(Mk[Ok++]=210,Pk.setInt32(Ok,t),Ok+=4);else{let e;if((e=this.useFloat32)>0&&t<4294967296&&t>=-2147483648){let i;if(Mk[Ok++]=202,Pk.setFloat32(Ok,t),e<4||((i=t*wk[(127&Mk[Ok])<<1|Mk[Ok+1]>>7])|0)===i)return void(Ok+=4);Ok--}Mk[Ok++]=203,Pk.setFloat64(Ok,t),Ok+=8}else if("object"===n)if(t){if(s){let i=s.get(t);if(i){if(!i.id){let t=s.idsToInsert||(s.idsToInsert=[]);i.id=t.push(i)}return Mk[Ok++]=214,Mk[Ok++]=112,Pk.setUint32(Ok,i.id),void(Ok+=4)}s.set(t,{offset:Ok-e})}let n=t.constructor;if(n===Object)x(t,!0);else if(n===Array){(i=t.length)<16?Mk[Ok++]=144|i:i<65536?(Mk[Ok++]=220,Mk[Ok++]=i>>8,Mk[Ok++]=255&i):(Mk[Ok++]=221,Pk.setUint32(Ok,i),Ok+=4);for(let e=0;e<i;e++)b(t[e])}else if(n===Map){(i=t.size)<16?Mk[Ok++]=128|i:i<65536?(Mk[Ok++]=222,Mk[Ok++]=i>>8,Mk[Ok++]=255&i):(Mk[Ok++]=223,Pk.setUint32(Ok,i),Ok+=4);for(let[e,i]of t)b(e),b(i)}else{for(let e=0,i=_k.length;e<i;e++){if(t instanceof Ck[e]){let i=_k[e];if(i.write)return i.type&&(Mk[Ok++]=212,Mk[Ok++]=i.type,Mk[Ok++]=0),void b(i.write.call(this,t));let n,r=Mk,s=Pk,a=Ok;Mk=null;try{n=i.pack.call(this,t,(t=>(Mk=r,r=null,(Ok+=t)>Tk&&w(Ok),{target:Mk,targetView:Pk,position:Ok-t})),b)}finally{r&&(Pk=s,Ok=a,Tk=(Mk=r).length-10)}return void(n&&(n.length+Ok>Tk&&w(n.length+Ok),Ok=Vk(n,Mk,Ok,i.type)))}}x(t,!t.hasOwnProperty)}}else Mk[Ok++]=192;else if("boolean"===n)Mk[Ok++]=t?195:194;else if("bigint"===n){if(t<BigInt(1)<<BigInt(63)&&t>=-(BigInt(1)<<BigInt(63)))Mk[Ok++]=211,Pk.setBigInt64(Ok,t);else if(t<BigInt(1)<<BigInt(64)&&t>0)Mk[Ok++]=207,Pk.setBigUint64(Ok,t);else{if(!this.largeBigIntToFloat)throw new RangeError(t+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");Mk[Ok++]=203,Pk.setFloat64(Ok,Number(t))}Ok+=8}else if("undefined"===n)this.encodeUndefinedAsNil?Mk[Ok++]=192:(Mk[Ok++]=212,Mk[Ok++]=0,Mk[Ok++]=0);else{if("function"!==n)throw new Error("Unknown type: "+n);b(this.writeFunction&&this.writeFunction())}},x=!1===this.useRecords?this.variableMapSize?t=>{let e,i=Object.keys(t),n=i.length;n<16?Mk[Ok++]=128|n:n<65536?(Mk[Ok++]=222,Mk[Ok++]=n>>8,Mk[Ok++]=255&n):(Mk[Ok++]=223,Pk.setUint32(Ok,n),Ok+=4);for(let r=0;r<n;r++)b(e=i[r]),b(t[e])}:(t,i)=>{Mk[Ok++]=222;let n=Ok-e;Ok+=2;let r=0;for(let e in t)(i||t.hasOwnProperty(e))&&(b(e),b(t[e]),r++);Mk[n+++e]=r>>8,Mk[n+e]=255&r}:t=>{let e,i=Object.keys(t),s=r.transitions||(r.transitions=Object.create(null)),a=0;for(let n=0,r=i.length;n<r;n++){let t=i[n];e=s[t],e||(e=s[t]=Object.create(null),a++),s=e}let o=s[zk];if(o)o>=96&&p?(Mk[Ok++]=96+(31&(o-=96)),Mk[Ok++]=o>>5):Mk[Ok++]=o;else{o=r.nextId,o||(o=64),o<f&&this.shouldShareStructure&&!this.shouldShareStructure(i)?(o=r.nextOwnId,o<m||(o=f),r.nextOwnId=o+1):(o>=m&&(o=f),r.nextId=o+1);let t=i.highByte=o>=96&&p?o-96>>5:-1;s[zk]=o,r[o-64]=i,o<f?(i.isShared=!0,r.sharedLength=o-63,n=!0,t>=0?(Mk[Ok++]=96+(31&o),Mk[Ok++]=t):Mk[Ok++]=o):(t>=0?(Mk[Ok++]=213,Mk[Ok++]=114,Mk[Ok++]=96+(31&o),Mk[Ok++]=t):(Mk[Ok++]=212,Mk[Ok++]=114,Mk[Ok++]=o),a&&(v+=y*a),g.length>=d&&(g.shift()[zk]=0),g.push(s),b(i))}for(let n=0,r=i.length;n<r;n++)b(t[i[n]])},w=t=>{let i;if(t>16777216){if(t-e>Rk)throw new Error("Packed buffer would be larger than maximum buffer size");i=Math.min(Rk,4096*Math.round(Math.max((t-e)*(t>67108864?1.25:2),4194304)/4096))}else i=1+(Math.max(t-e<<2,Mk.length-1)>>12)<<12;let n=new kk(i);return Pk=new DataView(n.buffer,0,i),Mk.copy?Mk.copy(n,0,e,t):n.set(Mk.slice(e,t)),Ok-=e,e=0,Tk=n.length-10,Mk=n}}useBuffer(t){Mk=t,Pk=new DataView(Mk.buffer,Mk.byteOffset,Mk.byteLength),Ok=0}};function Nk(t,e,i,n){let r=t.byteLength;if(r+1<256){var{target:s,position:a}=i(4+r);s[a++]=199,s[a++]=r+1}else if(r+1<65536){var{target:s,position:a}=i(5+r);s[a++]=200,s[a++]=r+1>>8,s[a++]=r+1&255}else{var{target:s,position:a,targetView:o}=i(7+r);s[a++]=201,o.setUint32(a,r+1),a+=4}s[a++]=116,s[a++]=e,s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),a)}function Uk(t,e){let i=t.byteLength;var n,r;if(i<256){var{target:n,position:r}=e(i+2);n[r++]=196,n[r++]=i}else if(i<65536){var{target:n,position:r}=e(i+3);n[r++]=197,n[r++]=i>>8,n[r++]=255&i}else{var{target:n,position:r,targetView:s}=e(i+5);n[r++]=198,s.setUint32(r,i),r+=4}n.set(t,r)}function Vk(t,e,i,n){let r=t.length;switch(r){case 1:e[i++]=212;break;case 2:e[i++]=213;break;case 4:e[i++]=214;break;case 8:e[i++]=215;break;case 16:e[i++]=216;break;default:r<256?(e[i++]=199,e[i++]=r):r<65536?(e[i++]=200,e[i++]=r>>8,e[i++]=255&r):(e[i++]=201,e[i++]=r>>24,e[i++]=r>>16&255,e[i++]=r>>8&255,e[i++]=255&r)}return e[i++]=n,e.set(t,i),i+=r}function jk(t){if(t.Class){if(!t.pack&&!t.write)throw new Error("Extension has no pack or write function");if(t.pack&&!t.type)throw new Error("Extension has no type (numeric code to identify the extension)");Ck.unshift(t.Class),_k.unshift(t)}!function(t){t.unpack?GD[t.type]=t.unpack:GD[t.type]=t}(t)}Ck=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,WD],_k=[{pack(t,e,i){let n=t.getTime()/1e3;if((this.useTimestamp32||0===t.getMilliseconds())&&n>=0&&n<4294967296){let{target:t,targetView:i,position:r}=e(6);t[r++]=214,t[r++]=255,i.setUint32(r,n)}else if(n>0&&n<17179869184){let{target:i,targetView:r,position:s}=e(10);i[s++]=215,i[s++]=255,r.setUint32(s,4e6*t.getMilliseconds()+(n/1e3/4294967296|0)),r.setUint32(s+4,n)}else if(isNaN(n)){if(this.onInvalidDate)return e(0),i(this.onInvalidDate());let{target:t,targetView:n,position:r}=e(3);t[r++]=212,t[r++]=255,t[r++]=255}else{let{target:i,targetView:r,position:s}=e(15);i[s++]=199,i[s++]=12,i[s++]=255,r.setUint32(s,1e6*t.getMilliseconds()),r.setBigInt64(s+4,BigInt(Math.floor(n)))}}},{pack(t,e,i){let n=Array.from(t),{target:r,position:s}=e(this.structuredClone?3:0);this.structuredClone&&(r[s++]=212,r[s++]=115,r[s++]=0),i(n)}},{pack(t,e,i){let{target:n,position:r}=e(this.structuredClone?3:0);this.structuredClone&&(n[r++]=212,n[r++]=101,n[r++]=0),i([t.name,t.message])}},{pack(t,e,i){let{target:n,position:r}=e(this.structuredClone?3:0);this.structuredClone&&(n[r++]=212,n[r++]=120,n[r++]=0),i([t.source,t.flags])}},{pack(t,e){this.structuredClone?Nk(t,16,e):Uk(Dk?Buffer.from(t):new Uint8Array(t),e)}},{pack(t,e){let i=t.constructor;i!==Ik&&this.structuredClone?Nk(t,yk.indexOf(i.name),e):Uk(t,e)}},{pack(t,e){let{target:i,position:n}=e(1);i[n]=193}}];var Gk,Hk,Wk,qk=new Fk({useRecords:!1}),{NEVER:Yk,ALWAYS:Xk,DECIMAL_ROUND:Qk,DECIMAL_FIT:Kk}=(qk.pack,qk.pack,{NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4}),Zk=512,Jk=1024,$k=new Fk({structuredClone:!0});function tI(t){if(NT(t))return t;if(Array.isArray(t))return t.map(tI);if("object"==typeof t&&null!==t){let e={};for(let i of Object.keys(t).sort())e[i]=tI(t[i]);return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),e}return t}function eI(t){return"MouseDown"===t||"MouseUp"===t||"KeyDown"===t||"KeyUp"===t||"Collision"===t||"Trigger"===t}jk({Class:OT.prototype.constructor,type:1,write:t=>({...t}),read:t=>(Object.setPrototypeOf(t,OT.prototype),t)}),jk({Class:HT.prototype.constructor,type:2,write:t=>[...t],read:t=>(Object.setPrototypeOf(t,HT.prototype),t)}),jk({Class:GT.prototype.constructor,type:3,write:t=>[...t],read:t=>(Object.setPrototypeOf(t,GT.prototype),t)}),jk({Class:MD.prototype.constructor,type:4,write:t=>t.id,read:t=>new MD(t)}),jk({Class:PD.prototype.constructor,type:5,write:t=>t.data,read:t=>new PD(t)}),jk({Class:ZT.prototype.constructor,type:6,write:t=>({...t}),read:t=>(Object.setPrototypeOf(t,ZT.prototype),t)}),(t=>{function e(t){return $k.pack(t)}t.serialize=e,t.deserialize=function(t){return $k.unpack(t)},t.checksum=function(t){return function(t){var e=0;if(0===t.length)return e;for(let i=0;i<t.length;i++)e=(e<<5)-e+t[i],e|=0;return e}(e(tI(t))).toString()}})(Gk||(Gk={})),(Wk=Hk||(Hk={})).toEventUIType=function(t){return"Conditional"===t.type?"Distance"===t.condition.type?"Distance":"StateChange":t.type},Wk.fromEventUIType=function(t){return"Distance"===t||"StateChange"===t?"Conditional":t};var iI,nI,rI,sI,aI,oI,lI,hI,cI,uI,dI,pI,fI,mI,gI,vI,yI,bI,xI,wI,SI={LookAt:[],Follow:["Create"],DragDrop:["Transition","Animation","Audio","Particles","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseHover:["Transition","Animation","Particles","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Scroll:["Transition","Animation","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Start:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Conditional:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MousePress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyPress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],GameControl:["Transition","Animation","Audio","Particles","Create","Conditional"],Collision:["Transition","Animation","Audio","Particles","Video","Create","Destroy","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Trigger:["Transition","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Resize:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],VariableChange:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],API:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],WEBHOOK:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],AIAssistantListener:["SetVariable"],AIAssistantTrigger:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"]};(t=>{t.is=function(t){return"MouseDown"===t.type||"MouseUp"===t.type||"MousePress"===t.type||"KeyDown"===t.type||"KeyUp"===t.type||"KeyPress"===t.type},t.defaultData=function(t){return"MouseDown"===t||"MouseUp"===t||"MousePress"===t?{type:t,mode:"Object",disabled:!1,actions:new HT}:{type:t,disabled:!1,key:void 0,actions:new HT}}})(iI||(iI={})),(t=>{t.propertyDefaultData=function(t){return{type:"Property",value:[t??null,"position","x"]}},t.valueDefaultData={type:"Literal",value:0}})(nI||(nI={})),(t=>{t.comparisonDefaultData=function(t){return{type:"Comparison",operator:"==",lOperand:nI.propertyDefaultData(t),rOperand:{...nI.valueDefaultData}}},t.distanceDefaultData=function(t){return{type:"Distance",toObject:t??null,fromObject:t??null,distance:200}},t.stateDefaultData=function(t,e){return{type:"State",object:t??null,state:e??null}}})(rI||(rI={})),(t=>{t.isConditionalSubActions=function(t){return void 0!==t.find((t=>"ifActions"===t||"elseActions"===t))}})(sI||(sI={})),(t=>{t.is=function(t){return"Conditional"===t.type},t.defaultData=function(t){return{type:"Conditional",disabled:!1,inActions:new HT,outActions:new HT,condition:rI.distanceDefaultData(t)}}})(aI||(aI={})),(t=>{t.defaultData={type:"DragDrop",cursor:"hand",disabled:!1,dampingFactor:1,objects:[],snapTo:"center",snapSurfaceMode:"bbox",snapSurfaceOffset:0,dropOn:"all",autoOrient:!0,dropDestinations:[],plane:"adaptive",planeMode:"locked",referenceFrame:"global",limits:[-1/0,1/0,-1/0,1/0,-1/0,1/0],drop:!1,resetOnSnapFail:!1,snapSpeed:20,resetSpeed:20,dragDropActions:{drag:new HT,drop:new HT}}})(oI||(oI={})),(t=>{t.defaultData={type:"Follow",disabled:!1,maxDelta:0,dampingFactor:1,target:"cursor",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledTranslation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5,actions:new HT}})(lI||(lI={})),(t=>{t.defaultData={type:"LookAt",disabled:!1,distance:1e3,dampingFactor:1,target:"cursor",tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledRotation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5}})(hI||(hI={})),(t=>{t.is=function(t){return"MouseHover"===t.type},t.defaultData=function(){return{type:"MouseHover",disabled:!1,actions:new HT}}})(cI||(cI={})),(t=>{t.is=function(t){return"Scroll"===t.type},t.defaultData=function(){return{type:"Scroll",disabled:!1,steps:100,trigger:"load",startFrom:"enter",enterAnchor:"top",startOffset:0,endAfter:400,actions:new HT}}})(uI||(uI={})),(t=>{t.is=function(t){return"Start"===t.type},t.defaultData=function(){return{type:"Start",disabled:!1,actions:new HT}}})(dI||(dI={})),(t=>{t.is=function(t){return"Collision"===t.type},t.defaultData=function(){return{type:"Collision",disabled:!1,target:"character",actions:new HT}}})(pI||(pI={})),(t=>{t.is=function(t){return"Trigger"===t.type},t.defaultData=function(t,e){return{type:"Trigger",disabled:!1,target:"all",triggeringObjects:[],actions:new HT,triggerZone:"box",position:e.toArray(),rotation:[0,0,0],size:t.toArray(),radius:t.length()/2,helperVisible:!0}}})(fI||(fI={})),(gI=mI||(mI={})).defaultSizes={mobile:[480,480],tablet:[768,768],desktop:[1200,1200],custom:[769,1200]},gI.is=function(t){return"Resize"===t.type},gI.sizeToDevice=function(t){return"string"==typeof t?t:"custom"},gI.deviceToSize=function(t){return"string"==typeof t?[...gI.defaultSizes[t]]:[...t]},gI.defaultData=function(){let t={size:"mobile",operator:"<",actions:new HT},e={size:"tablet",operator:"<",actions:new HT},i={size:[...gI.defaultSizes.custom],operator:"<>",actions:new HT},n=new HT;return n.push({id:Nf.generateUUID(),fi:0,data:t},{id:Nf.generateUUID(),fi:1,data:e},{id:Nf.generateUUID(),fi:2,data:i}),{type:"Resize",disabled:!1,orientation:"horizontal",breakpoints:n}},gI.defaultBreakpointData=function(){return{size:[...gI.defaultSizes.custom],operator:"<>",actions:new HT}},(t=>{t.propertyPaths={Position:["position"],"Position X":["position","x"],"Position Y":["position","y"],"Position Z":["position","z"],Rotation:["rotation"],"Rotation X":["rotation","x"],"Rotation Y":["rotation","y"],"Rotation Z":["rotation","z"],Scale:["scale"],"Scale X":["scale","x"],"Scale Y":["scale","y"],"Scale Z":["scale","z"],Width:["width"],Height:["height"],Depth:["depth"],"Mouse Position X":["mouse","x"],"Mouse Position Y":["mouse","y"],"Mouse Pressed":["mouse","pressed"],"Screen Width":["mouse","width"],"Screen Height":["mouse","height"],"Hit Position X":["raycast","x"],"Hit Position Y":["raycast","y"],"Hit Position Z":["raycast","z"],"Hit Object Position X":["raycast","objX"],"Hit Object Position Y":["raycast","objY"],"Hit Object Position Z":["raycast","objZ"]},t.is=function(t){return"VariableChange"===t.type},t.defaultData=function(){return{disabled:!1,type:"VariableChange",actions:new HT,variableId:"",objectId:null,property:"Position X"}}})(vI||(vI={})),(t=>{t.is=function(t){return"API"===t.type},t.defaultData=function(){return{disabled:!1,type:"API",successActions:new HT,errorActions:new HT,userAPIId:""}}})(yI||(yI={})),(t=>{t.is=function(t){return"WEBHOOK"===t.type},t.defaultData=function(){return{disabled:!1,type:"WEBHOOK",actions:new HT,userWebhookId:""}}})(bI||(bI={})),(t=>{t.is=function(t){return"AIAssistantListener"===t.type},t.defaultData=function(){return{disabled:!1,type:"AIAssistantListener",actions:new HT,analysis:"average",analysisRange:[0,71],analysisSingle:0}}})(xI||(xI={})),(t=>{t.is=function(t){return"AIAssistantTrigger"===t.type},t.defaultData=function(){return{disabled:!1,description:"",type:"AIAssistantTrigger",actions:new HT}}})(wI||(wI={}));var AI,EI,_I,CI,MI,PI,TI,DI,kI,II,RI,OI,LI,BI,zI,FI,NI,UI,VI,jI,GI="personal camera",HI="a218fcc3-276b-49b9-b485-49037fd14f5f",WI=5526619;function qI(t){return"string"==typeof t&&36===t.length&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t)}(t=>{function e(t,e){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)}function i(t,i){return Math.sqrt(e(t,i))}function n(e,i,n){let r=t.sub(i,e),s=t.sub(n,e),a=t.dot(r,s)/t.dot(r,r),o=t.scalarMultiply(r,a);return t.add(e,o)}t.isEqual=function(t,e){return t[0]===e[0]&&t[1]===e[1]},t.lerp=function(t,e,i){return[t[0]+(e[0]-t[0])*i,t[1]+(e[1]-t[1])*i]},t.add=function(t,e){return[t[0]+e[0],t[1]+e[1]]},t.sub=function(t,e){return[t[0]-e[0],t[1]-e[1]]},t.multiply=function(t,e){return[t[0]*e[0],t[1]*e[1]]},t.divide=function(t,e){return[t[0]/e[0],t[1]/e[1]]},t.distanceSquared=e,t.distance=i,t.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},t.scalarMultiply=function(t,e){return[t[0]*e,t[1]*e]},t.projectionOnto=n,t.projectionOntoDistance=function(t,e,r){return i(t,n(t,e,r))},t.center=function(t,e){return[.5*(t[0]+e[0]),.5*(t[1]+e[1])]}})(AI||(AI={})),(_I=EI||(EI={})).isEqual=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},_I.add=function(t,e){return[t[0]+e[0],t[1]+e[1],t[2]+e[2]]},_I.sub=function(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]},_I.div=function(t,e){return[t[0]/e[0],t[1]/e[1],t[2]/e[2]]},_I.mul=function(t,e){return[t[0]*e[0],t[1]*e[1],t[2]*e[2]]},_I.dist=function(t,e){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])},_I.lerp=function(t,e,i){return[t[0]+(e[0]-t[0])*i,t[1]+(e[1]-t[1])*i,t[2]+(e[2]-t[2])*i]},(t=>{t.isEqual=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},t.lerp=function(t,e,i){return[t[0]+(e[0]-t[0])*i,t[1]+(e[1]-t[1])*i,t[2]+(e[2]-t[2])*i,t[3]+(e[3]-t[3])*i]}})(CI||(CI={})),(t=>{let e=180/Math.PI,i=Math.PI/180;function n(t){return"number"==typeof t?t*e:t}function r(t){return"number"==typeof t?t*i:t}t.radToDeg=function(t){return[n(t[0]),n(t[1]),n(t[2])]},t.degToRad=function(t){return[r(t[0]),r(t[1]),r(t[2])]}})(MI||(MI={})),(TI=PI||(PI={})).identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],TI.isEqual=function(t,e){for(let i=0;i<16;i++)if(t[i]!==e[i])return!1;return!0},TI.simplify=function(t){return t??TI.identity},TI.applyMatrix4=function(t,e){let i=e.slice(0);for(var n=0,r=e.length;n<r;n+=3){let r=t[3]*e[n]+t[7]*e[n+1]+t[11]*e[n+2]+t[15];i[n]=(t[0]*e[n]+t[4]*e[n+1]+t[8]*e[n+2]+t[12])/r,i[n+1]=(t[1]*e[n]+t[5]*e[n+1]+t[9]*e[n+2]+t[13])/r,i[n+2]=(t[2]*e[n]+t[6]*e[n+1]+t[10]*e[n+2]+t[14])/r}return i},(kI=DI||(DI={})).isRGB=function(t){return"object"==typeof t&&"number"==typeof t.r&&"number"==typeof t.g&&"number"==typeof t.b},kI.white={r:1,g:1,b:1},kI.red={r:1,g:0,b:0},kI.black={r:0,g:0,b:0},kI.toRgb255a1=function(t){return{r:Math.round(255*t.r),g:Math.round(255*t.g),b:Math.round(255*t.b),a:1}},kI.clone=function(t){return{r:t.r,g:t.g,b:t.b}},kI.fromHex=function(t){return{r:((t=Math.floor(t))>>16&255)/255,g:(t>>8&255)/255,b:(255&t)/255}},kI.toHex=function(t){return 65536*Math.round(255*t.r)+256*Math.round(255*t.g)+Math.round(255*t.b)},kI.equals=function(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b},kI.equalsFixed=function(t,e){return t.r.toFixed(2)===e.r.toFixed(2)&&t.g.toFixed(2)===e.g.toFixed(2)&&t.b.toFixed(2)===e.b.toFixed(2)},kI.lerp=function(t,e,i){return{r:t.r+(e.r-t.r)*i,g:t.g+(e.g-t.g)*i,b:t.b+(e.b-t.b)*i}},(RI=II||(II={})).white={...DI.white,a:1},RI.transparent={...DI.white,a:0},RI.from0to1=function(t){return{r:t[0],g:t[1],b:t[2],a:t[3]}},RI.fromHexAndA=function(t,e){return{...DI.fromHex(t),a:e}},RI.toRgb255a1=function(t){return{r:Math.round(255*t.r),g:Math.round(255*t.g),b:Math.round(255*t.b),a:t.a}},RI.equals=function(t,e){return DI.equals(t,e)&&t.a===e.a},RI.equalsFixed=function(t,e){return DI.equalsFixed(t,e)&&t.a.toFixed(2)===e.a.toFixed(2)},RI.lerp=function(t,e,i){return{r:t.r+(e.r-t.r)*i,g:t.g+(e.g-t.g)*i,b:t.b+(e.b-t.b)*i,a:t.a+(e.a-t.a)*i}},RI.toStyle=function(){let{r:t,g:e,b:i,a:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:RI.white;return`rgba(${255*t}, ${255*e}, ${255*i}, ${n})`},(t=>{t.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]}})(OI||(OI={})),(t=>{t.defaultData={mass:1,stiffness:80,damping:10,velocity:0}})(LI||(LI={})),(t=>{t.defaultData={control1:[.5,0],control2:[.5,1]}})(BI||(BI={})),(FI=zI||(zI={})).linear=[0,0,1,1],FI.ease=[.25,.1,.25,1],FI.easeIn=[.42,0,1,1],FI.easeOut=[0,0,.58,1],FI.easeInOut=[.42,0,.58,1],(t=>{t.all=["PerspectiveCamera","OrthographicCamera"],t.is=function(e){return t.all.includes(e)}})(NI||(NI={})),(t=>{t.DefaultUp=[0,1,0],t.DefaultTargetOffset=1e3,t.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:t.DefaultUp,isUpVectorFlipped:!1,targetOffset:t.DefaultTargetOffset},t.getZoom=function(t){return"PerspectiveCamera"===t.type?t.perspective?.zoom??1:t.orthographic?.zoom??1}})(UI||(UI={})),(t=>{t.defaultData=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:2*Math.max(t[0],t[1]),start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[t[0]+t[0]*e,0,0]},grid:{count:[2,2,2],size:t.map((t=>t*(1+e))),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}},t.merge=function(t,e){let i={...t};if(rR.forEach((n=>{Object.assign(i,{[n]:e[n]??t[n]})})),i.radial={...t.radial},e.radial){let n=t.radial,r=e.radial;sR.forEach((t=>{Object.assign(i.radial,{[t]:r[t]??n[t]})}))}if(i.linear={...t.linear},e.linear){let n=t.linear,r=e.linear;aR.forEach((t=>{Object.assign(i.linear,{[t]:r[t]??n[t]})}))}if(i.grid={...t.grid},e.grid){let n=t.grid,r=e.grid;oR.forEach((t=>{Object.assign(i.grid,{[t]:r[t]??n[t]})}))}if(i.toObject={...t.toObject},e.toObject){let n=t.toObject,r=e.toObject;lR.forEach((t=>{Object.assign(i.toObject,{[t]:r[t]??n[t]})}))}if(i.randomnessObject={...t.randomnessObject},e.randomnessObject){let n=t.randomnessObject,r=e.randomnessObject;hR.forEach((t=>{Object.assign(i.randomnessObject,{[t]:r[t]??n[t]})}))}return i}})(VI||(VI={})),(t=>{t.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let e=["radial","linear","grid","toObject","randomnessObject"];t.toOps=function(t,i){let n=[];void 0!==t.count&&n.push({type:0,path:i,props:{count:t.count}});for(let r of e){let e=t[r];e&&Object.keys(e).length>0&&n.push({type:0,path:[...i,r],props:e})}return n}})(jI||(jI={}));var YI,XI,QI,KI,ZI,JI,$I,tR,eR,iR,nR,rR=["count"],sR=["radius","start","end","position","scale","rotation"],aR=["position","scale","rotation"],oR=["count","size"],lR=["count","position","scale","rotation"],hR=["strength","scale","rotation","position","movement","seed","freqScale"];(t=>{t.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"],t.is=function(e){return t.all.includes(e)}})(YI||(YI={})),(t=>{t.defaultData=function(t){return function(t){if("PointLight"===t)return{type:t,color:II.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if("SpotLight"===t)return{type:t,color:II.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if("DirectionalLight"===t)return{type:t,color:II.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}(t)}})(XI||(XI={})),(t=>{t.defaultShapeData={type:"PlaneEmitterShape",size:[100,100,100]},t.defaultCollisionData={colliderEntityId:null,collisionBounce:.75},t.defaultData={renderMaterial:{type:"particleMaterial",color:{r:1,g:.2,b:.545,a:1},color2:{r:.945,g:.714,b:.184,a:1},coloring:"gradient",ease:"linearFadeOut",easeSize:"linearFadeOut",transparent:!0,size:[40,40],texture:"pt_default_particle",spriteRotation:[0,0]},birthRatePerSec:50,gravity:1,noiseStrength:0,noiseScale:0,noiseSeed:1,noiseType:"curl",randomRotation:0,randomScale:.2,randomMass:.5,rootObjectType:"instancedMesh",life:1,direction:[0,0,0],directionMode:"axis",speed:10,shape:t.defaultShapeData,autoPlay:!0,emitTimeDelay:0,emitTimeCycle:"infinity",emitTimeDuration:1,...t.defaultCollisionData}})(QI||(QI={})),(t=>{t.defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]}})(KI||(KI={})),(t=>{t.defaultData={castShadow:!0,receiveShadow:!0},t.equals=function(t,e){return t.castShadow===e.castShadow&&t.receiveShadow===e.receiveShadow}})(ZI||(ZI={})),(t=>{t.defaultData={flatShading:!1,wireframe:!1,side:0},t.equals=function(t,e){return t.flatShading===e.flatShading&&t.side===e.side&&t.wireframe===e.wireframe}})(JI||(JI={})),(t=>{t.defaultData={...JI.defaultData,...ZI.defaultData}})($I||($I={})),(t=>{t.getMaterialData=function(t,e){let i=[];if("material"in t){let n="string"==typeof t.material?e.materials[t.material]??e.lib.materials[t.material]?.asset:t.material;n&&i.push(n)}else if("materials"in t)for(let n of t.materials){let t="string"==typeof n?e.materials[n]??e.lib.materials[n]?.asset:n;t&&i.push(t)}return i}})(tR||(tR={})),(t=>{t.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},t.maxSize=3e7})(eR||(eR={})),(t=>{t.is=function(t){return"texture"===t||"video"===t||"color"===t||"depth"===t||"normal"===t||"gradient"===t||"noise"===t||"fresnel"===t||"rainbow"===t||"toon"===t||"outline"===t||"particle"===t||"transmission"===t||"matcap"===t||"displace"===t||"pattern"===t||"light"===t}})(iR||(iR={})),(t=>{t.is=function(t){return"phong"===t||"toon"===t||"lambert"===t||"physical"===t}})(nR||(nR={}));var cR,uR,dR,pR,fR=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],mR=["wrapping","image","video","name","minFilter","magFilter"];(t=>{t.patch=function(t,e){let{texture:i,...n}=e;if(Object.assign(t,n),i){let e=t.texture;e&&Object.assign(e,i)}},t.defaultData=function(t,e){return"light"===t&&e?function(t){let e={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(t){case"phong":return{...e,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...e,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...e,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...e,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}}(e):function(t){let e={alpha:1,mode:0,isMask:!1,visible:!0};switch(t){case"texture":return{...e,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"video":return{...e,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:eR.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"color":return{...e,type:"color",color:DI.fromHex(WI)};case"depth":return{...e,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...e,type:"normal",cnormal:[1,1,1]};case"gradient":return{...e,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...e,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...DI.fromHex(6710886),a:1},colorB:{...DI.fromHex(6710886),a:1},colorC:{...DI.fromHex(16777215),a:1},colorD:{...DI.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...e,type:"fresnel",color:II.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...e,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...e,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:II.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...e,type:"outline",outlineColor:II.fromHexAndA(0,1),contourColor:II.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...e,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006}};case"transmission":return{...e,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...e,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{...DI.fromHex(0),a:1},colorB:{...DI.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}}(t)}})(cR||(cR={})),(t=>{function e(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"layer1",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"layer2",n=new HT;return n.push({fi:0,data:cR.defaultData("light",t),id:e}),n.push({fi:1,data:cR.defaultData("color"),id:i}),{layers:n}}t.isMergable=function(t){return!t.layers.some((t=>"texture"===t.data.type&&0!==t.data.projection||"depth"===t.data.type&&!t.data.isWorldSpace||"noise"===t.data.type||"displace"===t.data.type))},t.getHash=function(t){let e="";return t.layers.forEach((t=>{Object.entries(t.data).forEach((t=>{let[i,n]=t;e+=`${i}${n}`,Array.isArray(n)?n.forEach((t=>e+=`${t}`)):"object"==typeof n?Object.values(n).forEach((t=>{e+="number"==typeof t?`${t.toFixed(4)}`:`${t}`})):e+=`${n}`}))})),e},t.defaultEmptyData=function(){return{layers:new HT}},t.defaultData=function(){return e("phong",arguments.length>0&&void 0!==arguments[0]?arguments[0]:"layer1",arguments.length>1&&void 0!==arguments[1]?arguments[1]:"layer2")},t.withName=function(t,e){return{...t,name:e}},t.defaultTwoLayerData=e,t.defaultUIObjectMaterial=function(t){let e=cR.defaultData("texture");t&&Object.assign(e.texture,{image:t});let i=new HT;return i.push({fi:0,data:e,id:"layer1"}),i.push({fi:1,data:{...cR.defaultData("transmission"),alpha:1},id:"layer2"}),i.push({fi:2,data:{...cR.defaultData("light","lambert"),alpha:0},id:"layer3"}),{layers:i}},t.defaultTwoLayerTextureData=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"phong",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"layer1",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"layer2",r=cR.defaultData("texture");Object.assign(r.texture,{image:t});let s=new HT;return s.push({fi:0,data:r,id:i}),s.push({fi:1,data:cR.defaultData("light",e),id:n}),{layers:s}},t.defaultTwoLayerVideoTextureData=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"phong",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"layer1",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"layer2",r=cR.defaultData("video");Object.assign(r.texture,{video:t});let s=new HT;return s.push({fi:0,data:r,id:i}),s.push({fi:1,data:cR.defaultData("light",e),id:n}),{layers:s}}})(uR||(uR={})),(t=>{t.defaultData=function(){return{points:new HT,roundness:0,shapeHoles:[],isClosed:!1}}})(dR||(dR={})),(t=>{t.defaultData=function(){return{points:new HT,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}})(pR||(pR={}));var gR,vR={type:"Ellipse",width:50,height:50,spikes:16,angle:360,innerRadius:0};(t=>{t.merge=function(t,e){let i={...t};return SR.forEach((n=>{Object.assign(i,{[n]:e[n]??t[n]})})),i}})(gR||(gR={}));var yR,bR,xR,wR={shape:vR,depth:1,offset:0,bevel:50,bevelSides:6,angle:0,twist:0,startScale:1,endScale:1,capType:"flat"},SR=["depth","offset","angle","twist","startScale","endScale"];(t=>{t.is2DParametricMesh=function(t){return"PolygonGeometry"===t||"RectangleGeometry"===t||"StarGeometry"===t||"TriangleGeometry"===t||"EllipseGeometry"===t||"UIGeometry"===t},t.isParametricMesh=function(t){return"PolygonGeometry"===t||"PolygonGeometry"===t||"RectangleGeometry"===t||"StarGeometry"===t||"TriangleGeometry"===t||"EllipseGeometry"===t||"PathGeometry"===t||"VectorGeometry"===t||"ConeGeometry"===t||"CubeGeometry"===t||"CylinderGeometry"===t||"DodecahedronGeometry"===t||"HelixGeometry"===t||"IcosahedronGeometry"===t||"LatheGeometry"===t||"PyramidGeometry"===t||"SphereGeometry"===t||"PlaneGeometry"===t||"BackdropGeometry"===t||"TorusGeometry"===t||"TorusKnotGeometry"===t||"BooleanGeometry"===t||"TextGeometry"===t||"InputGeometry"===t}})(yR||(yR={})),(t=>{t.merge=function(t,e){let i={...t};return Object.assign(i,e),"PathGeometry"===i.type&&"extrusion"in e&&e.extrusion&&(i.extrusion={...t.extrusion},Object.assign(i.extrusion,gR.merge(i.extrusion,e.extrusion))),i}})(bR||(bR={})),(t=>{t.defaultData=function(e){if("RectangleGeometry"===e)return{width:320,height:320,type:e,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("UIGeometry"===e)return{type:e,frame:"",cornerRadius:[0,0,0,0],cornerType:0,width:1,height:1};if("PathGeometry"===e)return{type:e,width:1,height:1,depth:1,path:pR.defaultData(),extrusion:wR};if("VectorGeometry"===e)return{width:1,height:1,type:e,subdivisions:12,shape:dR.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("BooleanGeometry"===e)return{type:e,operation:2,width:0,height:0,depth:0,phongAngle:35};if("ShapeBlendGeometry"===e)return{type:e,width:0,height:0,depth:0,resolutionLevel:6,blendRange:100,useChildrenColors:!1};if("TextGeometry"===e)return{type:e,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:{textValue:""},textTransform:1,font:"Roboto_regular",editable:!1,extrudeBevelSize:0,extrudeBevelSegments:1};if("InputGeometry"===e)return{...t.defaultData("TextGeometry"),type:e,editable:!0};if("SphereGeometry"===e)return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180};throw new Error("not implemented")}})(xR||(xR={}));var AR,ER,_R,CR,MR,PR,TR,DR,kR,IR,RR,OR,LR,BR,zR,FR,NR,UR,VR,jR,GR,HR,WR,qR,YR,XR,QR,KR,ZR,JR,$R,tO,eO,iO,nO,rO,sO,aO,oO,lO,hO,cO,uO=["width","height","depth"];function dO(t){t.layers.forEach((t=>{if("depth"===t.type&&void 0!==t.colorA){let e=t.colorA,i=t.colorB,n=[[e.r,e.g,e.b,e.a],[i.r,i.g,i.b,i.a]],r=[0,1];for(let t=2;t<10;t++)n.push(n[1]),r.push(1);let s={...iT(AD(t),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,t.near),far:Math.max(0,t.far),colors:n,steps:r,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(t,s)}else if("depth"===t.type&&1===t.gradientType&&(t.near<0||t.far<0)){let e={...AD(t),near:Math.max(t.near,0),far:Math.max(t.far,0)};Object.assign(t,e)}}))}function pO(t,e){Object.values(t.shared.materials).forEach((t=>e(t)))}function fO(t,e){t.scene.objects.traverse(((t,i)=>{"materials"in i?i.materials.forEach(((t,n)=>{void 0===t&&(i.materials[n]=uR.defaultData(),t=i.materials[n]),"string"!=typeof t&&e(t)})):"material"in i?"string"!=typeof i.material&&(void 0===i.material&&(i.material=uR.defaultData()),e(i.material)):"Mesh"===i.type&&(void 0===i.material&&(i.material=uR.defaultData()),e(i.material)),"overrides"in i&&Object.values(i.overrides).forEach((t=>{t.material&&"string"!=typeof t.material&&Object.getPrototypeOf(t.material)!==ZT.prototype&&e(t.material)}))}))}function mO(t){void 0===t.layers&&Object.assign(t,uR.defaultTwoLayerData("lambert"))}function gO(t){!t.layers||t.layers.forEach((t=>{if("depth"===t.type&&10===t.colors.length){let e=[...t.colors];e.push(t.colors[9]);let i=[...t.steps];i.push(t.steps[9]);let n={...AD(t),colors:e,steps:i};Object.assign(t,n)}}))}function vO(t){t.scene.objects.traverse(((t,e)=>{"materials"in e?e.materials.forEach((t=>{"string"!=typeof t&&gO(t)})):"material"in e&&"string"!=typeof e.material&&gO(e.material)})),Object.values(t.shared.materials).forEach((t=>gO(t)))}function yO(t){t.layers&&t.layers.forEach((t=>{"depth"===t.type&&void 0!==t.num&&(t.colors=t.colors.slice(0,t.num),t.steps=t.steps.slice(0,t.num),delete t.num)}))}function bO(t){t.layers&&t.layers.forEach((t=>{(function(t){return"displace"!==t.type})(t)&&void 0===t.isMask&&(t.isMask=!1),("texture"===t.type||"video"===t.type)&&void 0===t.blending&&(t.blending=0),("noise"===t.type||"displace"===t.type&&"noise"===t.displacementType)&&(void 0===t.voronoiStyle&&(t.voronoiStyle=0),void 0===t.highCut&&(t.highCut=1),void 0===t.lowCut&&(t.lowCut=0),void 0===t.smoothness&&(t.smoothness=.3),void 0===t.seed&&(t.seed=0),void 0===t.quality&&(t.quality=1))}))}function xO(t){let e=t.layers.find((t=>"light"===t.type))?.data;if("basic"===e?.category){let t=cR.defaultData("light","phong"),i=e;Object.assign(i,t),i.visible=!1}}function wO(t){pO(t,xO),fO(t,xO)}function SO(t){t.layers.forEach((t=>{"light"===t.type&&"toon"!==t.category&&void 0===t.occlusion&&(t.occlusion=!0)}))}function AO(t){t.layers&&t.layers.forEach((t=>{"light"===t.type&&void 0===t.bumpMapIntensity&&(t.bumpMapIntensity=5)}))}function EO(t,e){if(e<1&&(fO(t,dO),pO(t,dO),t.schema=1),e<2&&(function(t){Object.assign(t.scene.publish,{orbitControls:{...YR.defaultData,...AD(t.scene.publish.orbitControls)}})}(t),t.schema=2),e<3&&(function(t){function e(t){if(t.layers)for(let e of Object.values(t.layers))if(e)for(let[t,i]of Object.entries(e))if((fR.includes(t)||"boolean"==typeof i)&&delete e[t],"texture"===t)for(let[e,n]of Object.entries(i))(mR.includes(e)||"boolean"==typeof n)&&delete i[e]}t.scene.objects.traverse(((t,i)=>{i.states.forEach((t=>{let i=t;i.material?e(i.material):i.materials&&i.materials.forEach((t=>{e(t)}))}))}))}(t),t.schema=3),e<4&&(function(t){t.scene.publish.withBackground=!0}(t),t.schema=4),e<5&&(function(t){t.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}(t),t.schema=5),e<6&&(function(t){t.scene.objects.traverse(((t,e)=>{let i=e.cloner;i&&(i.radial.scale=i.radial.scale.map((t=>t+1)),i.linear.scale=i.linear.scale.map((t=>t+1)))}))}(t),t.schema=6),e<7&&(function(t){t.scene.objects.traverse(((t,e)=>{let i=e.geometry;i&&("DodecahedronGeometry"===i.type||"IcosahedronGeometry"===i.type)&&(i.detail=Math.round(i.detail))}))}(t),t.schema=7),e<8&&(t.schema=8),e<9&&(vO(t),t.schema=9),e<10&&(function(t){t.scene.objects.traverse(((t,e)=>{"Mesh"===e.type&&("BooleanGeometry"===e.geometry.type||"SubdivGeometry"===e.geometry.type)&&(e.geometry.phongAngle=35)}))}(t),t.schema=10),e<11&&(function(t){t.scene.environment.ambientLight.softShadows=!1,t.scene.environment.ambientLight.softShadowQuality="low",t.scene.objects.traverse(((t,e)=>{("DirectionalLight"===e.type||"SpotLight"===e.type)&&(e.shadowResolution=1024,e.shadowRadius=1,e.depth=1e5)})),t.shared.penumbraSize=new Array(5).fill(.5)}(t),t.schema=11),e<12&&(vO(t),t.schema=12),e<13&&(function(t){t.shared.audios=sT({},OT.prototype)}(t),t.schema=13),e<14&&(function(t){let e=t.shared.materials;Object.entries(e).forEach((t=>{let[i,n]=t;if(!n.layers){let t={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(e,{[i]:t})}}))}(t),t.schema=14),e<15&&(function(t){Object.entries(AD(t.shared.images)).filter((t=>!1===t[1].asset)).map((t=>t[0])).forEach((e=>{delete t.shared.images[e]})),Object.entries(AD(t.shared.audios)).filter((t=>!1===t[1].asset)).map((t=>t[0])).forEach((e=>{delete t.shared.audios[e]}))}(t),t.schema=15),e<16&&(function(t){t.scene.publish.settings.web.preload=!1}(t),t.schema=16),e<17&&(fO(t,yO),pO(t,yO),t.schema=17),e<18&&(fO(t,mO),pO(t,mO),t.schema=18),e<19&&(function(t){Object.assign(t.scene.publish.settings,{video:{...XR.defaultData.settings.video,...AD(t.scene.publish.settings.video)}})}(t),t.schema=19),e<20&&(function(t){t.shared.fonts=sT({},OT.prototype)}(t),function(t){let e=[];t.scene.objects.traverse(((i,n)=>{let r=n;if("TextFrame"===r.type){let n=uR.defaultTwoLayerData("phong"),s="string"==typeof r.color?t.shared.colors[r.color]:r.color;n.layers[1].data.color={r:s.r,g:s.g,b:s.b},n.layers[1].data.alpha=r.alpha;let a=function(t){return t.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map((t=>t.charAt(0).toUpperCase()+t.slice(1))).join(" ")}(r.font);void 0===t.shared.fonts[a]&&(t.shared.fonts[a]={name:a});let o={name:r.name,...OR.defaultData,...NR.defaultData,flatShading:!1,wireframe:!1,geometry:{...xR.defaultData("TextGeometry"),width:r.width,height:r.height,font:a,depth:0,horizontalAlign:r.horizontalAlign,verticalAlign:r.verticalAlign,fontSize:1.40625*r.fontSize,lineHeight:r.lineHeight/1.40625,letterSpacing:r.letterSpacing-1,text:r.text,textTransform:r.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:n,states:AD(r.states),events:AD(r.events),visible:r.visible,raycastLock:r.raycastLock,position:r.position,rotation:r.rotation,scale:r.scale,hiddenMatrix:r.hiddenMatrix},l=AD(t.scene.objects).parent(i);t.scene.objects.insertAfter(l??null,i,[{id:i+"new",data:o,children:[]}]),e.push(i)}})),e.forEach((e=>{t.scene.objects.delete(e)}))}(t),t.schema=20),e<21&&(function(t){let e={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};t.scene.objects.traverse(((t,i)=>{i.events.forEach((t=>{if(e[Number(t.type)])if(Object.assign(t,{type:e[Number(t.type)]}),"Audio"===t.type&&"audioEvent"in t&&(Object.assign(t,{playAudio:t.audioEvent}),delete t.audioEvent),"GameControl"===t.type)Object.assign(t,{gameActions:{idle:new HT,move:new HT,jump:new HT}});else{let e=new HT;Object.assign(t,{actions:e}),("MouseDown"===t.type||"MouseUp"===t.type||"KeyDown"===t.type||"KeyUp"===t.type)&&"url"in t&&e.push({fi:0,id:Nf.generateUUID(),data:{type:"Link",url:t.url,delay:0}}),"targets"in t&&(t.targets.forEach(((t,i,n)=>{let r={easing:t.easing,duration:t.duration};6===t.easing?Object.assign(r,iT(t,"mass","stiffness","damping","velocity")):5===t.easing&&Object.assign(r,{control1:{...t.control1},control2:{...t.control2}});let s={repeat:t.repeat?-1:0,delay:t.delay,delayDirection:t.delayDirection,direction:t.cycle&&t.rewind?"pingpong-rewind":t.cycle?"pingpong":"normal"},a={state:t.state,...s,...r},o={allowSlerp:!0,type:"Transition",object:t.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new HT({fi:0,id:Nf.generateUUID(),data:{state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4}},{fi:1,id:Nf.generateUUID(),data:a})};e.push({fi:n,id:i,data:o})})),delete t.targets)}}))}))}(t),function(t){t.scene.objects.traverse(((t,e)=>{function i(t,i){let n=new HT,r=[];if(e.events.forEach(((t,e,s)=>{if("Audio"===t.type&&t.trigger===i){let i;r.push(e),"play"===t.interaction?i={...iT(t,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in t?t.after:void 0,toggle:"after"in t?t.toggle:void 0,type:"Audio"}:("pause"===t.interaction||"stop"===t.interaction)&&(i={...iT(t,"interaction","delay","object","playAudio"),type:"Audio"}),i&&n.push({fi:s,id:e,data:i})}})),r.forEach((t=>e.events.delete(t))),n.length){let i=e.events.find((e=>e.type===t))?.data;i?"actions"in i&&i.actions.insertBefore(null,n):e.events.insertBefore(null,[{id:Nf.generateUUID(),data:{type:t,actions:n}}])}}i("Start","start"),i("MouseDown","mouseDown"),i("MouseUp","mouseUp"),i("KeyDown","keyDown"),i("KeyUp","keyUp")}))}(t),t.schema=21),e<22&&(wO(t),t.schema=22),e<23&&(function(t){t.scene.objects.traverse(((t,e)=>{"Mesh"===e.type&&"SubdivGeometry"===e.geometry.type&&(e.geometry.scaleBaked||(e.geometry.scaleBaked=[1,1,1]))}))}(t),t.schema=23),e<24&&(function(t){t.scene.objects.traverse(((t,e)=>{("Empty"===e.type||"Mesh"===e.type)&&e.cloner&&!e.cloner.randomnessObject&&!e.cloner.toObject&&!e.cloner.randomness&&(e.cloner={...e.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})}))}(t),t.schema=24),(e<25||void 0===t.shared.videos)&&(function(t){t.shared.videos=sT({},OT.prototype)}(t),e<25&&(t.schema=25)),e<26&&(function(t){t.scene.objects.traverse(((e,i)=>{let n=t.scene.objects.unproxy().parent(e);if(n){let e=AD(t.scene.objects.data(n));e&&"Mesh"===e.type&&"BooleanGeometry"===e.geometry.type&&"Mesh"===i.type&&(i.visible=!0!==AD(i).booleanExclude)}}))}(t),t.schema=26),e<27&&(function(t){t.scene.objects.traverse(((t,e)=>{if("Mesh"===e.type){let t=e;"NonParametricGeometry"===e.geometry.type?void 0!==t.material&&delete t.material:void 0!==t.materials&&delete t.materials}}))}(t),t.schema=27),e<28&&(wO(t),t.schema=28),e<29&&(function(t){function e(t){Object.setPrototypeOf(t,ZT.prototype),t.texture&&Object.setPrototypeOf(t.texture,ZT.prototype)}function i(t){Object.setPrototypeOf(t,ZT.prototype);for(let i in t)e(t[i])}t.scene.objects.traverse(((t,e)=>{e.states.forEach((t=>{let e=t;if(e.material){let t=AD(e.material).layers;i(t),e.material.layers=t}if(e.materials)for(let n=0;n<e.materials.length;n++){let t=e.materials[n],r=AD(t).layers;i(r),t.layers=r}}))}))}(t),t.schema=29),e<30&&(function(t){t.scene.objects.traverse(((t,e)=>{"Mesh"===e.type&&"NonParametricGeometry"===e.geometry.type&&!("material"in e)&&!("materials"in e)&&(e.material=uR.defaultTwoLayerData("phong"))}))}(t),t.schema=30),e<31&&(function(t){void 0===t.scene.publish.orbitControls.autoZoom&&(t.scene.publish.orbitControls.autoZoom=!1),t.scene.objects.traverse(((t,e)=>{("OrthographicCamera"===e.type||"PerspectiveCamera"===e.type)&&(void 0===e.orthographic.autoZoom&&(e.orthographic.autoZoom=!1),void 0===e.orthographic.autoZoomFrustumSize&&(e.orthographic.autoZoomFrustumSize=790))}))}(t),t.schema=31),e<33&&(function(t){t.scene.objects.traverse(((t,e)=>{void 0===e.pathSnapping&&(e.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),void 0===e.pathSnapping.offset&&(e.pathSnapping.offset=0)}))}(t),t.schema=33),e<34&&(function(t){void 0===t.scene.publish.mouseEventTarget&&(t.scene.publish.mouseEventTarget="canvas"),void 0===t.scene.publish.settings.web.hint&&(t.scene.publish.settings.web.hint=!1)}(t),t.schema=34),e<35&&(function(t){let{video:e}=t.scene.publish.settings;"gif"===e.format&&e.fps>48&&(e.fps=15)}(t),t.schema=35),e<36&&(function(t){t.scene.objects.traverse(((t,e)=>{e.events.forEach((t=>{"GameControl"===t.type&&(t.resetYPosition=Math.abs(t.resetYPosition-e.position[1]))}))}))}(t),t.schema=36),e<37&&(function(t){let e=t.scene.environment.usePhysics;t.scene.objects.traverse(((t,i)=>{e&&null===i.physics?i.collision=!1:i.collision="visibility"}))}(t),t.schema=37),e<38&&(fO(t,bO),pO(t,bO),t.schema=38),e<39&&(function(t){t.scene.objects.traverse(((t,e)=>{e.events.forEach((t=>{"GameControl"===t.type&&(t.navmesh=cO.defaultDataThirdPerson.navmesh)}))}))}(t),t.schema=39),e<40&&(function(t){t.scene.styles||(t.scene.styles=ZR.defaultData())}(t),t.schema=40),e<41&&(function(t){void 0===t.scene.environment.ambientLight.occlusion&&(t.scene.environment.ambientLight.occlusion=!1),void 0===t.scene.environment.ambientLight.aoFullRes&&(t.scene.environment.ambientLight.aoFullRes=!1),void 0===t.scene.environment.ambientLight.radius&&(t.scene.environment.ambientLight.radius=256),void 0===t.scene.environment.ambientLight.bias&&(t.scene.environment.ambientLight.bias=.5),void 0===t.scene.environment.ambientLight.aoColor&&(t.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),fO(t,SO),pO(t,SO)}(t),t.schema=41),e<42&&(function(t){t.scene.objects.traverse(((t,e)=>{e.events.forEach((t=>{"GameControl"===t.type&&Object.assign(t.gameActions,{run:new HT})}))}))}(t),t.schema=42),e<43&&(function(t){t.scene.objects.traverse(((t,e)=>{e.events.forEach((t=>{"GameControl"===t.type&&(t.keyAssignments=[...t.keyAssignments,["run","\u21e7"],["none","Ctrl"]])}))}))}(t),t.schema=43),e<99){fO(t,AO),pO(t,AO),null===t.scene.publish.playCamera&&(t.scene.publish.playCamera=GI);let e=AD(t.scene.objects),i=t.scene.objects;t.scene.publish.playPage=HI,i.insertBefore(null,null,[{id:HI,data:{...HR.defaultData,backgroundColor:t.scene.backgroundColor,fog:t.scene.fog,postprocessing:t.scene.postprocessing,ao:iT(t.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:t.scene.publish.playCamera,gameControlObject:t.scene.publish.gameControlObject},shadow:iT(t.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:{...PR.defaultData,...iT(t.scene.environment,"usePhysics","gravity")},camera:AD(t.scene.ownerCamera)??HR.defaultData.camera,name:"Scene"},children:[]}]);for(let t of e)t.id!==$R.TRASH_CAN_ID&&i.move(HI,t.fi,t.id);let n=0,r=0;t.shared.penumbraSize&&t.scene.objects.traverse(((e,i)=>{"DirectionalLight"===i.type?(i.penumbraSize=t.shared.penumbraSize[Math.min(n,2)],n+=1):"SpotLight"===i.type&&(i.penumbraSize=t.shared.penumbraSize[3+Math.min(r,1)],r+=1),(void 0===i.physics||null===i.physics)&&"Instance"!==i.type&&(i.physics={},Object.assign(i.physics,KI.defaultData)),void 0!==i.physics&&null!==i.physics&&(i.physics.enabled=i.collision??"visibility",delete i.collision)})),t.schema=99}}function _O(t){t.layers&&t.layers.forEach((t=>{"light"===t.type&&void 0===t.alphaOverride&&(t.alphaOverride=1)}))}(t=>{t.defaultData={enabled:!1,useBackgroundColor:!1,color:DI.white,near:.1,far:2e3}})(AR||(AR={})),(t=>{let e={opacity:1,blendFunction:13,enabled:!1};t.defaultData={enabled:!1,pixelation:{...e,blendFunction:16,granularity:15},bloom:{...e,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...e,offset:[2,2]},vignette:{...e,darkness:1,offset:0},hueSaturation:{...e,hue:3,saturation:0},brightnessContrast:{...e,brightness:.25,contrast:0},depthOfField:{...e,focusDistance:100,focalLength:20,bokehScale:5},noise:{...e,blendFunction:16}}})(ER||(ER={})),(t=>{t.defaultData={softShadowQuality:"low"}})(_R||(_R={})),(t=>{t.defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75}})(CR||(CR={})),(t=>{t.defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}}})(MR||(MR={})),(t=>{t.defaultData={usePhysics:!1,gravity:-10}})(PR||(PR={})),(t=>{t.defaultData={playCamera:GI,gameControlObject:null}})(TR||(TR={})),(t=>{t.defaultData={backgroundColor:II.fromHexAndA(2960946,1),postprocessing:ER.defaultData,fog:AR.defaultData,globalPhysics:PR.defaultData,ambient:CR.defaultData,ao:MR.defaultData,shadow:_R.defaultData,publish:TR.defaultData}})(DR||(DR={})),(t=>{t.defaultData={colliderType:"box",size:[100,100,100],colliderHelperVisible:!0,forceType:"collider",forceRange:"global",forceIntensity:.5,forceDambing:.95}})(kR||(kR={})),(t=>{t.isComponentRelated=function(t){return"Component"===t||"Instance"===t},t.isEmptyOrComponent=function(t){return"Empty"===t||"Instance"===t}})(IR||(IR={})),(t=>{t.identity={...OI.identity,hiddenMatrix:PI.identity},t.fromObject=function(t){return{position:t.position,rotation:t.rotation,scale:t.scale,hiddenMatrix:t.hiddenMatrix}},t.merge=function(t,e){return{position:e?.position||t.position,rotation:e?.rotation||t.rotation,scale:e?.scale||t.scale,hiddenMatrix:e?.hiddenMatrix||t.hiddenMatrix}},t.diff=function(t,e){return rT({position:EI.isEqual(t.position,e.position)?void 0:e.position,rotation:EI.isEqual(t.rotation,e.rotation)?void 0:e.rotation,scale:EI.isEqual(t.scale,e.scale)?null:e.scale,hiddenMatrix:PI.isEqual(t.hiddenMatrix,e.hiddenMatrix)?void 0:e.hiddenMatrix})}})(RR||(RR={})),(t=>{t.defaultData={states:new HT,events:new HT,visible:!0,raycastLock:!1,physics:KI.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...RR.identity,cloner:null}})(OR||(OR={})),(t=>{t.defaultData={type:"Empty",...OR.defaultData}})(LR||(LR={})),(t=>{t.defaultData={type:"ParticleCollider",...kR.defaultData,...OR.defaultData}})(BR||(BR={})),(t=>{t.defaultData={type:"Component",...OR.defaultData}})(zR||(zR={})),(t=>{t.defaultData={type:"Particle",...OR.defaultData,...QI.defaultData}})(FR||(FR={})),(t=>{t.defaultData={type:"Mesh",...OR.defaultData,...$I.defaultData}})(NR||(NR={})),(t=>{t.defaultData={...OR.defaultData,...RR.identity,position:[0,0,UI.DefaultTargetOffset],...UI.defaultData}})(UR||(UR={})),(t=>{t.defaultData=function(t){return{...OR.defaultData,...XI.defaultData(t)}},t.defaultDirectionalLightData={...t.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7}})(VR||(VR={})),(t=>{function e(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(;i<e.length;){let n=t?t[e[i]]:void 0;if(e.length===i+1)return n;if(!n)return;t=n.descendants,i+=1}}t.resolveWithDes=e,t.resolve=function(t,i){let n=e(t,i,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);if(n){let t=Object.keys(n);if(1===t.length&&"descendants"===t[0])return}return n}})(jR||(jR={})),(t=>{function e(t,e){return{...OR.defaultData,...e,component:t,overrides:new ZT,physics:void 0,events:void 0,type:"Instance"}}t.rootOverrideProps=["physics","events"],t.compositeNonOptionalOverrideProps=["geometry"],t.compositeEntireOverrideOverrideProps=["material"],t.ofComponent=e,t.fromComponentData=function(t){let i=RR.fromObject(t.data);return e(t.id,i)}})(GR||(GR={})),(t=>{t.defaultData={type:"Page",...OR.defaultData,physics:{...KI.defaultData,fusedBody:!1},...DR.defaultData,camera:UR.defaultData},t.isUIPage=function(t){return void 0!==t.uiScene}})(HR||(HR={})),(t=>{t.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:PI.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:KI.defaultData,states:new HT,events:new HT,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...UI.defaultData},t.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},t.defaultMeshObject={name:"Rectangle",...OR.defaultData,...NR.defaultData,geometry:xR.defaultData("RectangleGeometry"),material:uR.defaultTwoLayerData("phong","layer1","layer2")},t.defaultBooleanObject={name:"Boolean",...OR.defaultData,...NR.defaultData,geometry:xR.defaultData("BooleanGeometry"),material:uR.defaultTwoLayerData("phong","layer1","layer2")},t.defaultShapeBlendObject={name:"Shape Blend",...OR.defaultData,...NR.defaultData,geometry:xR.defaultData("ShapeBlendGeometry"),material:uR.defaultTwoLayerData("phong","layer1","layer2")},t.defaultTextObject={name:"Text",...OR.defaultData,...NR.defaultData,geometry:xR.defaultData("TextGeometry"),material:uR.defaultTwoLayerData("phong","layer1","layer2")},t.defaultInputObject={name:"Input",...OR.defaultData,...NR.defaultData,geometry:xR.defaultData("InputGeometry"),material:uR.defaultTwoLayerData("phong","layer1","layer2")}})(WR||(WR={})),(t=>{t.newEmpty=function(t,e){let i={name:e};return"Mesh"===t.type?(i.geometry={},"material"in t&&(i.material={layers:new ZT}),"materials"in t&&(i.materials=t.materials.map((t=>({layers:new ZT}))))):NI.is(t.type)&&(i.perspective={},i.orthographic={}),i},t.toOps=function(t,e){let i,n=[],r={orthographic:0,perspective:0,geometry:0};function s(t,e){for(let[i,r]of Object.entries(e.layers)){let{texture:e,...s}=r;if(void 0!==e&&Object.keys(e).length>0){let r={path:[...t,"layers",i,"texture"],props:e,type:0};n.push(r)}if(Object.keys(s).length>0){let e={path:[...t,"layers",i],props:s,type:0};n.push(e)}}}for(let[a,o]of Object.entries(e))if("name"!==a)if("cloner"===a)n.push(...jI.toOps(o,["cloner"]));else if("pathSnapping"===a)n.push({path:[a],props:{slide:o.slide,offset:o.offset},type:0});else if("material"===a)s(["material"],o);else if("materials"===a)for(let[t,e]of Object.entries(o))s(["materials",t],e);else if(0===r[a]){if("geometry"===a&&void 0!==o.extrusion){let t={path:[a,"extrusion"],props:o.extrusion,type:0};n.push(t),o={...o},delete o.extrusion}if(Object.keys(o).length>0){let t={path:[a],props:o,type:0};n.push(t)}}else void 0===i&&(i={path:[],props:{},type:0},n.push(i)),i.props[a]=o;return n},t.patch=function(t,e){if(void 0===e)return t;let i={...t};if(Object.assign(i,RR.merge(i,e)),Object.assign(i,{pathSnapping:Object.assign({},i.pathSnapping,{slide:e.pathSnapping?.slide??i.pathSnapping?.slide??0,offset:e.pathSnapping?.offset??i.pathSnapping?.offset??0})}),NI.is(t.type)){i.orthographic={...i.orthographic},i.perspective={...i.perspective};let t=e;void 0!==t.orthographic?.zoom&&(i.orthographic.zoom=t.orthographic.zoom),void 0!==t.perspective?.zoom&&(i.perspective.zoom=t.perspective.zoom),void 0!==t.isUpVectorFlipped&&(i.isUpVectorFlipped=t.isUpVectorFlipped),void 0!==t.targetOffset&&(i.targetOffset=t.targetOffset)}else if("Mesh"===t.type)"geometry"in e&&Object.assign(i,{geometry:bR.merge(i.geometry,e.geometry)}),(e.material||e.materials)&&(i=function(t,e){if(void 0===e)return t;let i={...t};return"material"in i&&"material"in e&&e.material&&(i.material=SD(i.material,(t=>{if("string"!=typeof t)for(let[i,n]of Object.entries(e.material.layers)){let e=t.layers.data(i);e&&cR.patch(e,n)}})).data),i.materials&&e.materials&&(i.materials=SD(i.materials,(t=>{for(let n=0;n<i.materials.length;n++){let i=e.materials[n];if("string"!=typeof i)for(let[e,r]of Object.entries(i.layers)){let i=t[n]?.layers?.data(e);i&&cR.patch(i,r)}}})).data),i}(i,e)),i.cloner&&"cloner"in e&&Object.assign(i,{cloner:VI.merge(i.cloner,e.cloner)});else if("Empty"===t.type)i.cloner&&"cloner"in e&&Object.assign(i,{cloner:VI.merge(i.cloner,e.cloner)});else if(YI.is(t.type)){let t=e;void 0!==t.intensity&&(i.intensity=t.intensity),void 0!==t.color&&("string"==typeof t.color?i.color=t.color:i.color=DI.clone(t.color))}return i}})(qR||(qR={})),(t=>{t.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,hoverRotateDamping:.125,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0}})(YR||(YR={})),(t=>{t.defaultData={orbitControls:YR.defaultData,playPage:HI,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map(((t,e)=>{let i=0,n=0;return e<5?n=-30:e<10&&(n=30),0===e||10===e||5===e?i=30:(4===e||11===e||9===e)&&(i=-30),[120,[i,n],"show"]})),settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1,imageQuality:70}},stopRaycast:!0,hdTransmission:!1}})(XR||(XR={})),(t=>{t.defaultData={id:"basic",label:"Basic",style:"None",prompt:""}})(QR||(QR={})),(t=>{t.defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0}})(KR||(KR={})),(t=>{t.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{...QR.defaultData},isRandomSeed:!0,seed:t.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:KR.defaultData}),t.generateSeed=()=>Math.round(1e5*Math.random())})(ZR||(ZR={})),(t=>{t.physicsEnabled=function(t){return void 0!==t.find((t=>"Page"===t.data.type&&t.data.globalPhysics.usePhysics))},t.traverseModuleInstances=function(t,e,i){t.scene.objects.traverseFrom(e,((e,n)=>{if("Instance"===n.type){let r=TO.getComponentData(t,n.component)?.data;r&&i(e,n,r.events)}else i(e,n,n.events)}))}})(JR||(JR={})),(t=>{function e(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=[],r=WR.defaultMeshObject;e&&(n.push({...t.defaultLight}),n.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:r,children:[]})),n.push(...i);let s=new GT;return s.push({fi:1,id:HI,data:{...HR.defaultData,name:"Scene 1"},children:n}),s}function i(e){return{...t.defaultData,objects:sT(e,GT.prototype)}}t.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222",t.defaultLight={fi:-1,data:VR.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]},t.createDefaultObjectTreeWithPage=e,t.defaultData={objects:e(),publish:XR.defaultData,styles:ZR.defaultData()},t.emptyDataWithoutPage=function(){return{objects:new GT,publish:XR.defaultData,styles:ZR.defaultData()}},t.emptyDataWithPage=function(){return{objects:e(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]),publish:XR.defaultData,styles:ZR.defaultData()}},t.emptyData=function(){return{objects:new GT,publish:{...XR.defaultData},styles:ZR.defaultData()}},t.withObjs=i,t.withObj=function(t,e){return i([{id:t,data:e,children:[],fi:0}])}})($R||($R={})),(t=>{t.defaultData={preset:"fullscreen",allowResponsive:!1,size:[512,512],coords:[0,0],sceneScale:1,color:{r:0,g:0,b:0,a:.5}}})(tO||(tO={})),(t=>{t.defaultData=t=>({url:t,name:"New Webhook",parametersSchemas:new HT}),t.defaultParameterValueByType=t=>"number"===t?0:"boolean"!==t&&""})(eO||(eO={})),(t=>{t.defaultData=function(t){return{url:t,method:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",name:"New API",headers:new HT,queries:new HT,autoStart:!0}}})(iO||(iO={})),(t=>{function e(t){return void 0!==t.textValue}function i(t){return"boolean"==typeof t}t.isTextValue=e,t.isNumber=function(t){return"number"==typeof t},t.isBoolean=i,t.typeOfVariable=function(t){return e(t)?"string":i(t)?"boolean":"number"},t.getDisplayedValue=function(e){return t.isTextValue(e)?Array.isArray(e.textValue)?e.textValue.map((t=>t.toString().padStart(e.padding??2,"0"))).join(e.deliminator??":")+(void 0!==e.suffix?" "+e.suffix:""):e.textValue.toString():t.isBoolean(e)?e?"True":"False":t.isNumber(e)?parseFloat(e.toFixed(3)).toString():e.toString()}})(nO||(nO={})),(t=>{t.all=["images","videos","colors","audios","particles","fonts","materials","variables"]})(rO||(rO={})),(t=>{t.all=[...rO.all,"components"]})(sO||(sO={})),(t=>{t.defaultData=function(){return{images:new OT,videos:new OT,colors:new OT,audios:new OT,particles:new OT,fonts:new OT,materials:new OT,components:new OT,variables:new OT,userAPIs:new OT,userWebhooks:new OT}}})(aO||(aO={})),(t=>{t.defaultData=function(){return{images:new OT,videos:new OT,colors:new OT,audios:new OT,particles:new OT,fonts:new OT,materials:new OT,components:new OT,variables:new OT,userAPIs:new OT,userWebhooks:new OT}}})(oO||(oO={})),(t=>{t.defaultColors=function(){let t={"89b10010-844c-11ec-a8a3-0242ac120002":{r:.5,g:.5,b:.5,a:1,name:"Default Color"}};return sT(t,OT.prototype)},t.defaultImages=function(){return sT({},OT.prototype)},t.emptyData=function(){return{catelogs:new OT,materials:new OT,images:new OT,videos:new OT,colors:new OT,audios:new OT,particles:new OT,fonts:new OT,variables:new HT,userAPIs:new OT,userWebhooks:new OT,lib:oO.defaultData()}},t.defaultVariables=function(t){switch(t){case"number":return{value:0,name:"Number"};case"boolean":return{value:!1,name:"Boolean"};case"string":return{value:{textValue:"String value"},name:"String"};case"time":let e=[0,0,0];return{name:"Time",value:{textValue:e,deliminator:":",padding:2,suffix:"AM"},dynamicVariableType:"time",format:"HH:mm:ss",format12h24h:"12ampm",timeZone:null,hasEnd:!1,endValue:{textValue:e,deliminator:":",padding:2,suffix:"AM"},autoStart:!0,repeat:!1};case"counter":return{name:"Counter",value:0,dynamicVariableType:"counter",updateInterval:1e3,increment:1,autoStart:!0,hasEnd:!0,endValue:60,repeat:!0,randomStart:!1,range:[0,100],decimals:0};case"random":return{name:"Random",value:0,dynamicVariableType:"random",updateInterval:1e3,increment:1,autoStart:!0,isStatic:!1,hasEnd:!0,endValue:60,repeat:!0,min:0,max:100,decimals:0};default:console.error("Unknown variable type",t)}},t.getFormattedTimerTime=function(t,e){if("HH:mm:ss"===e.format){let e=Math.floor(t/3600),i=Math.floor((t-3600*e)/60);return{textValue:[e,i,Math.round(t-3600*e-60*i)]}}if("mm:ss"===e.format){let e=Math.floor(t/60);return{textValue:[e,Math.round(t-60*e)]}}return t="number"===e.format?Math.round(t):Math.round(1e3*t)/1e3}})(lO||(lO={})),(t=>{t.list=["idle","move","jump","run"]})(hO||(hO={})),(t=>{t.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},t.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","\u25b2"],["rotPosY","\u25c0"],["rotNegX","\u25bc"],["rotNegY","\u25b6"],["jump","Space"],["run","\u21e7"],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:t.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new HT,move:new HT,jump:new HT,run:new HT},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:II.fromHexAndA(3728051,1)}}})(cO||(cO={}));var CO=180/Math.PI;function MO(t){t.rotation=t.rotation.slice(0,3).map((t=>t*CO))}function PO(t){MO(t),"Page"===t.type&&MO(t.camera),t.states?.forEach((t=>{void 0===t.rotation||null===t.rotation||(t.rotation=t.rotation.slice(0,3).map((t=>t*CO)))}));let e=t.geometry;e&&"SphereGeometry"===e.type&&(e.thetaLength=(e.thetaLength??180)*CO),e&&"TorusGeometry"===e.type&&(e.arc=e.arc*CO),e&&"PathGeometry"===e.type&&(e.extrusion.angle*=CO,e.extrusion.twist*=CO),"Mesh"===t.type&&"TextGeometry"===t.geometry.type&&(t.geometry.text={textValue:t.geometry.text}),Array.isArray(AD(t.events))&&t.events?.forEach((t=>{("MouseDown"===t.type||"MouseUp"===t.type||"MousePress"===t.type||"KeyDown"===t.type||"KeyUp"===t.type||"KeyPress"===t.type||"Collision"===t.type||"Trigger"===t.type)&&(t.runMode=t.toggle?"Toggle":"Repeat")}))}var TO,DO,kO,IO,RO,OO,LO,BO,zO,FO,NO,UO,VO,jO,GO,HO,WO,qO,YO,XO,QO=115;function KO(t,e){e(t.data);for(let i of t.children)KO(i,e)}function ZO(t){let e=t.schema??104;e!==QO&&e<105&&(KO(t.asset,PO),t.schema=105)}function JO(t){let e=t.schema??0;if(e!==QO){console.warn("updating from ",e,"to ",QO),EO(t,e),e<100&&(void 0===t.scene.publish.joystickSizeAndXYOffset&&(t.scene.publish.joystickSizeAndXYOffset=XR.defaultData.joystickSizeAndXYOffset),t.schema=100),e<101&&(fO(t,_O),pO(t,_O),t.schema=101),e<102&&(function(t){t.scene.objects.traverse(((t,e)=>{let i=e.geometry;i&&"PathGeometry"===i.type&&(i.extrusion.capType="flat",i.extrusion.bevel=50,i.extrusion.bevelSides=6,"Custom"===i.extrusion.shape.type&&(i.extrusion.shape.shapeQuality="low"))}))}(t),t.schema=102),e<104&&(t.shared.catelogs=new OT,t.shared.lib=oO.defaultData(),t.schema=104),e<105&&(function(t){t.shared.variables=sT({},OT.prototype)}(t),t.scene.objects.traverse(((t,e)=>{PO(e)})),t.schema=105);for(let e of Object.values(t.shared.lib.components))ZO(e);e<106&&(function(t){let e=AD(t.shared.variables);t.shared.variables=sT(Object.entries(e??{}).map(((t,e)=>{let[i,n]=t;return{fi:e,id:i,data:n}})),HT.prototype)}(t),t.schema=106),e<107&&(t.shared.lib.variables=oO.defaultData().variables,t.schema=107),e<109&&(function(t){t.shared.particles=sT({},OT.prototype),t.shared.lib&&(t.shared.lib.particles=oO.defaultData().particles)}(t),t.schema=109),e<110&&(function(t){t.scene.objects.traverse(((t,e)=>{"Particle"===e.type&&"number"==typeof e.renderMaterial.size&&Object.assign(e.renderMaterial,{size:[e.renderMaterial.size,e.renderMaterial.size]})}))}(t),t.schema=110),e<111&&(t.scene.objects.traverse(((t,e)=>{!function(t){Array.isArray(AD(t.events))&&t.events?.forEach((t=>{"disabled"in t||(t.disabled=!1),("MouseDown"===t.type||"MouseUp"===t.type||"MousePress"===t.type)&&(t.mode=t.mode||"Object")}))}(e)})),t.schema=111),e<112&&(function(t){t.scene.objects.traverse(((t,e)=>{"Page"===e.type&&(e.postprocessing.depthOfField.focusDistance=100,e.postprocessing.depthOfField.focalLength=20,e.postprocessing.depthOfField.bokehScale=5)}))}(t),t.schema=112),e<113&&(function(t){t.scene.objects.traverse(((t,e)=>{!1!==Array.isArray(AD(e.events))&&e.events?.forEach((t=>{let e=t.runMode;"MouseDown"===t.type||"MouseUp"===t.type||"KeyDown"===t.type||"KeyUp"===t.type||"Collision"===t.type||"Trigger"===t.type?t.actions?.forEach((t=>{"Transition"===t.type&&(t.runMode=e??"Repeat"),("Animation"===t.type||"SwitchCamera"===t.type)&&(t.runMode="Toggle"===e?"Toggle":"Normal")})):"MouseHover"===t.type||"MousePress"===t.type||"KeyPress"===t.type?t.actions?.forEach((t=>{("Transition"===t.type||"Animation"===t.type||"SwitchCamera"===t.type)&&(t.runMode="Toggle")})):"GameControl"===t.type?(delete t.actions,Object.keys(t.gameActions).forEach((e=>{t.gameActions[e]?.forEach((t=>{"Transition"===t.type&&(t.runMode="Repeat"),"Animation"===t.type&&(t.runMode="Normal")}))}))):"DragDrop"===t.type?(delete t.actions,t.dragDropActions?.drag?.forEach((t=>{("Transition"===t.type||"Animation"===t.type||"SwitchCamera"===t.type)&&(t.runMode="Toggle")})),t.dragDropActions?.drop?.forEach((t=>{("Transition"===t.type||"Animation"===t.type||"SwitchCamera"===t.type)&&(t.runMode="Toggle")}))):"Resize"===t.type?(delete t.actions,t.breakpoints?.forEach((t=>{t.actions?.forEach((t=>{("Transition"===t.type||"Animation"===t.type||"SwitchCamera"===t.type)&&(t.runMode="Toggle")}))}))):"Start"===t.type?t.actions?.forEach((t=>{"Transition"===t.type&&(t.runMode="Once"),("Animation"===t.type||"SwitchCamera"===t.type)&&(t.runMode="Normal")})):"VariableChange"===t.type||"Scroll"===t.type?t.actions?.forEach((t=>{"Transition"===t.type&&(t.runMode="Repeat"),("Animation"===t.type||"SwitchCamera"===t.type)&&(t.runMode="Normal")})):"Conditional"===t.type&&(delete t.actions,t.inActions?.forEach((t=>{"Transition"===t.type&&(t.runMode="Repeat"),("Animation"===t.type||"SwitchCamera"===t.type)&&(t.runMode="Normal")})),t.outActions?.forEach((t=>{"Transition"===t.type&&(t.runMode="Repeat"),("Animation"===t.type||"SwitchCamera"===t.type)&&(t.runMode="Normal")})))}))}))}(t),t.schema=113),e<114&&(void 0===t.scene.publish.settings.web.imageQuality&&(t.scene.publish.settings.web.imageQuality=70),t.schema=114),e<115&&(function(t){t.shared.userAPIs=sT({},OT.prototype),t.shared.userWebhooks=sT({},OT.prototype),t.shared.lib&&(t.shared.lib.userAPIs=oO.defaultData().userAPIs,t.shared.lib.userWebhooks=oO.defaultData().userWebhooks)}(t),t.schema=115)}}function $O(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=null!==t[0].index,n=new Set(Object.keys(t[0].attributes)),r=new Set(Object.keys(t[0].morphAttributes)),s={},a={},o=t[0].morphTargetsRelative,l=new Hg,h=0;for(let c=0;c<t.length;++c){let u=t[c],d=0;if(i!==(null!==u.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let t in u.attributes){if(!n.has(t))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+'. All geometries must have compatible attributes; make sure "'+t+'" attribute exists among all geometries, or in none of them.'),null;void 0===s[t]&&(s[t]=[]),s[t].push(u.attributes[t]),d++}if(d!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". Make sure all geometries have the same number of attributes."),null;if(o!==u.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let t in u.morphAttributes){if(!r.has(t))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===a[t]&&(a[t]=[]),a[t].push(u.morphAttributes[t])}if(e){let t;if(i)t=u.index.count;else{if(void 0===u.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". The geometry must have either an index or a position attribute"),null;t=u.attributes.position.count}l.addGroup(h,t,c),h+=t}}if(i){let e=0,i=[];for(let n=0;n<t.length;++n){let r=t[n].index;for(let t=0;t<r.count;++t)i.push(r.getX(t)+e);e+=t[n].attributes.position.count}l.setIndex(i)}for(let c in s){let t=tL(s[c]);if(!t)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+c+" attribute."),null;l.setAttribute(c,t)}for(let c in a){let t=a[c][0].length;if(0===t)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[c]=[];for(let e=0;e<t;++e){let t=[];for(let n=0;n<a[c].length;++n)t.push(a[c][n][e]);let i=tL(t);if(!i)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+c+" morphAttribute."),null;l.morphAttributes[c].push(i)}}return l}function tL(t){let e,i,n,r=0;for(let o=0;o<t.length;++o){let s=t[o];if(s.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===e&&(e=s.array.constructor),e!==s.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===i&&(i=s.itemSize),i!==s.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===n&&(n=s.normalized),n!==s.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;r+=s.array.length}let s=new e(r),a=0;for(let o=0;o<t.length;++o)s.set(t[o].array,a),a+=t[o].array.length;return new Rg(s,i,n)}(t=>{t.defaultData={schema:QO,scene:$R.defaultData,frames:(new OT).add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",tO.defaultData),shared:{...lO.emptyData(),colors:lO.defaultColors()}},t.emptyDataForImports=function(){let t=$R.emptyDataWithPage();return{schema:QO,scene:t,frames:(new OT).add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",tO.defaultData),shared:{...lO.emptyData(),colors:lO.defaultColors(),images:lO.defaultImages()}}},t.emptyData=function(){return{schema:QO,scene:$R.emptyDataWithPage(),frames:(new OT).add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",tO.defaultData),shared:lO.emptyData()}},t.clipboard2dData=function(){return{schema:QO,scene:$R.emptyData(),frames:new OT,shared:lO.emptyData()}},t.collabHelper={...KT,updateSchema:t=>(t.schema??0)<QO?SD(t,JO):(t.schema??0)-QO},t.updateSchemaDirectly=function(e){let i=t.collabHelper.updateSchema(e);return"number"==typeof i?0===i?e:null:i.data},t.withoutLib=function(t){return{...t,shared:{...t.shared,lib:oO.defaultData()}}},t.getComponentData=function(t,e){let i=t.scene.objects.get(e);if(i&&"Component"===i.data.type)return i;{let i=t.shared.lib.components[e];if(i)return i.asset}},t.hasSensitiveData=function(t){let e=Object.values(t.shared.userAPIs);for(let i of e){let t=i.headers;for(let e of t)if("authorization"===e.data.key.toLowerCase()&&""!==e.data.value)return!0}return!1}})(TO||(TO={})),(t=>{t.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"}})(DO||(DO={})),(t=>{t.is=function(t){return!0}})(kO||(kO={})),(t=>{t.defaultData={position:[0,0],scale:[1,1],rotation:0,shear:[0,0]},t.merge=function(t,e){return{position:e?.position??t.position,rotation:e?.rotation??t.rotation,scale:e?.scale??t.scale,shear:e?.shear??t.shear}},t.diff=function(t,e){return rT({position:AI.isEqual(t.position,e.position)?void 0:e.position,rotation:t.rotation===e.rotation?void 0:e.rotation,scale:AI.isEqual(t.scale,e.scale)?void 0:e.scale,shear:t.shear&&e.shear&&AI.isEqual(t.shear,e.shear)?void 0:e.shear})}})(IO||(IO={})),(t=>{t.defaultData={horizontalConstraint:0,verticalConstraint:0}})(RO||(RO={})),(t=>{t.defaultData={direction:"row",wrap:"unwrap",align:"top-left",gap:10,rowGap:10,autoGap:!1,autoRowGap:!1,leftPadding:8,rightPadding:8,topPadding:8,bottomPadding:8}})(OO||(OO={})),(t=>{t.defaultData={opacity:1,fill:{color:II.fromHexAndA(WI,1),enabled:!0},stroke:{color:II.from0to1([0,0,0,1]),thickness:1,enabled:!1,mode:"inside"},layerBlur:{radius:2,enabled:!1},backgroundBlur:{radius:2,enabled:!1},dropShadow:{offset:[10,10],blurRadius:10,color:II.from0to1([0,0,0,1]),enabled:!1,spread:0},innerShadow:{offset:[10,10],blurRadius:10,color:II.from0to1([0,0,0,1]),enabled:!1,spread:0}}})(LO||(LO={})),(t=>{t.newEmpty=function(t,e){return{name:e}},t.patch=function(t,e){if(void 0===e)return t;let i={...t};return Object.assign(i,IO.merge(i,e)),i=function(t,e){if(void 0===e)return t;let i={...t},n=["width","height","cornerRadius"];for(let r of n)r in i&&r in e&&void 0!==e[r]&&Object.assign(i,{[r]:e[r]});return i}(i,e),i=function(t,e){if(void 0===e)return t;let i={...t};return"fill"in i&&"fill"in e&&void 0!==e.fill&&Object.assign(i,{fill:{...i.fill,...e.fill}}),"stroke"in i&&"stroke"in e&&void 0!==e.stroke&&Object.assign(i,{stroke:{...i.stroke,...e.stroke}}),"layerBlur"in i&&"layerBlur"in e&&void 0!==e.layerBlur&&Object.assign(i,{layerBlur:{...i.layerBlur,...e.layerBlur}}),"backgroundBlur"in i&&"backgroundBlur"in e&&void 0!==e.backgroundBlur&&Object.assign(i,{backgroundBlur:{...i.backgroundBlur,...e.backgroundBlur}}),"dropShadow"in i&&"dropShadow"in e&&void 0!==e.dropShadow&&Object.assign(i,{dropShadow:{...i.dropShadow,...e.dropShadow}}),"innerShadow"in i&&"innerShadow"in e&&void 0!==e.innerShadow&&Object.assign(i,{innerShadow:{...i.innerShadow,...e.innerShadow}}),i}(i,e),i},t.toOps=function(t,e){let i,n=[];for(let[r,s]of Object.entries(e))"name"!==r&&(void 0===i&&(i={path:[],props:{},type:0},n.push(i)),i.props[r]=s);return n}})(BO||(BO={})),(t=>{t.defaultData={...IO.defaultData,...RO.defaultData,states:new HT,events:new HT,visible:!0,raycastLock:!1}})(zO||(zO={})),(t=>{t.defaultData={...zO.defaultData,...LO.defaultData}})(FO||(FO={})),(t=>{t.defaultData={cornerRadius:[0,0,0,0]}})(NO||(NO={})),(t=>{t.defaultData={...FO.defaultData,type:"ellipse2d",width:100,height:100,name:"Ellipse"}})(UO||(UO={})),(t=>{t.defaultData={...FO.defaultData,...NO.defaultData,type:"rectangle2d",width:100,height:100,name:"Rectangle"}})(VO||(VO={})),(t=>{t.defaultData={...FO.defaultData,type:"text2d",width:100,height:100,fontSize:12,lineHeight:1.2,letterSpacing:0,text:{textValue:"Hello world"},horizontalAlign:1,verticalAlign:1,textTransform:1,font:"Roboto_regular",name:"Text"}})(jO||(jO={})),(t=>{t.defaultData={...FO.defaultData,type:"path2d",path:"",name:"Path"}})(GO||(GO={})),(t=>{t.is=function(t){return"ellipse2d"===t.type||"rectangle2d"===t.type||"text2d"===t.type||"vector2d"===t.type||"path2d"===t.type}})(HO||(HO={})),(t=>{t.defaultData={...zO.defaultData,name:"Group",type:"group2d"}})(WO||(WO={})),(t=>{t.defaultData=()=>({...zO.defaultData,...NO.defaultData,...LO.defaultData,name:"Frame",type:"frame2d",clipped:!0,width:200,height:200,fill:{color:II.fromHexAndA(4737101,1),enabled:!0},stroke:{color:II.fromHexAndA(0,1),thickness:1,enabled:!1,mode:"inside"},backgroundBlur:{radius:2,enabled:!1},layerBlur:{radius:2,enabled:!1}})})(qO||(qO={})),(t=>{t.defaultData=function(t){switch(t){case"rectangle2d":case"vector2d":return{...VO.defaultData};case"ellipse2d":return{...UO.defaultData};case"text2d":return{...jO.defaultData};case"path2d":return{...GO.defaultData};case"frame2d":return{...qO.defaultData()};case"group2d":return{...WO.defaultData}}},t.getPivot=function(t){return"width"in t&&"height"in t?["number"==typeof t.width?.5*t.width:0,"number"==typeof t.height?.5*t.height:0]:[0,0]},t.isResizeable=function(t){return"rectangle2d"===t.type||"ellipse2d"===t.type||"text2d"===t.type||"frame2d"===t.type},t.isAutoLayoutable=function(t){return"frame2d"===t.type&&void 0!==t.autoLayout},t.hasCorners=function(t){return"rectangle2d"===t.type||"frame2d"===t.type}})(YO||(YO={})),(t=>{t.defaultData={name:"UI",type:"scene2d",objects:new GT},t.emptyData=function(){return{type:"scene2d",objects:new GT}}})(XO||(XO={}));var eL=Math.pow(2,-24),iL=class{constructor(){}};function nL(t,e,i){return i.min.x=e[t],i.min.y=e[t+1],i.min.z=e[t+2],i.max.x=e[t+3],i.max.y=e[t+4],i.max.z=e[t+5],i}function rL(t){let e=-1,i=-1/0;for(let n=0;n<3;n++){let r=t[n+3]-t[n];r>i&&(i=r,e=n)}return e}function sL(t,e){e.set(t)}function aL(t,e,i){let n,r;for(let s=0;s<3;s++){let a=s+3;n=t[s],r=e[s],i[s]=n<r?n:r,n=t[a],r=e[a],i[a]=n>r?n:r}}function oL(t,e,i){for(let n=0;n<3;n++){let r=e[t+2*n],s=e[t+2*n+1],a=r-s,o=r+s;a<i[n]&&(i[n]=a),o>i[n+3]&&(i[n+3]=o)}}function lL(t){let e=t[3]-t[0],i=t[4]-t[1],n=t[5]-t[2];return 2*(e*i+i*n+n*e)}function hL(t,e,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=1/0,a=1/0,o=1/0,l=-1/0,h=-1/0,c=-1/0,u=1/0,d=1/0,p=1/0,f=-1/0,m=-1/0,g=-1/0,v=null!==r;for(let y=6*e,b=6*(e+i);y<b;y+=6){let e=t[y+0],i=t[y+1],n=e-i,r=e+i;n<s&&(s=n),r>l&&(l=r),v&&e<u&&(u=e),v&&e>f&&(f=e);let b=t[y+2],x=t[y+3],w=b-x,S=b+x;w<a&&(a=w),S>h&&(h=S),v&&b<d&&(d=b),v&&b>m&&(m=b);let A=t[y+4],E=t[y+5],_=A-E,C=A+E;_<o&&(o=_),C>c&&(c=C),v&&A<p&&(p=A),v&&A>g&&(g=A)}n[0]=s,n[1]=a,n[2]=o,n[3]=l,n[4]=h,n[5]=c,v&&(r[0]=u,r[1]=d,r[2]=p,r[3]=f,r[4]=m,r[5]=g)}var cL=32,uL=(t,e)=>t.candidate-e.candidate,dL=new Array(cL).fill().map((()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}))),pL=new Float32Array(6);function fL(t,e){function i(t){d&&d(t/p)}function n(e,r,d){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!f&&m>=l&&(f=!0,h&&(console.warn(`MeshBVH: Max depth of ${l} reached when generating BVH. Consider increasing maxDepth.`),console.warn(t))),d<=c||m>=l)return i(r+d),e.offset=r,e.count=d,e;let g=function(t,e,i,n,r,s){let a=-1,o=0;if(0===s)a=rL(e),-1!==a&&(o=(e[a]+e[a+3])/2);else if(1===s)a=rL(t),-1!==a&&(o=function(t,e,i,n){let r=0;for(let s=e,a=e+i;s<a;s++)r+=t[6*s+2*n];return r/i}(i,n,r,a));else if(2===s){let s=lL(t),l=1.25*r,h=6*n,c=6*(n+r);for(let t=0;t<3;t++){let n=e[t],u=(e[t+3]-n)/cL;if(r<8){let e=[...dL];e.length=r;let n=0;for(let r=h;r<c;r+=6,n++){let s=e[n];s.candidate=i[r+2*t],s.count=0;let{bounds:a,leftCacheBounds:o,rightCacheBounds:l}=s;for(let t=0;t<3;t++)l[t]=1/0,l[t+3]=-1/0,o[t]=1/0,o[t+3]=-1/0,a[t]=1/0,a[t+3]=-1/0;oL(r,i,a)}e.sort(uL);let u=r;for(let t=0;t<u;t++){let i=e[t];for(;t+1<u&&e[t+1].candidate===i.candidate;)e.splice(t+1,1),u--}for(let r=h;r<c;r+=6){let n=i[r+2*t];for(let t=0;t<u;t++){let s=e[t];n>=s.candidate?oL(r,i,s.rightCacheBounds):(oL(r,i,s.leftCacheBounds),s.count++)}}for(let i=0;i<u;i++){let n=e[i],h=n.count,c=r-n.count,u=n.leftCacheBounds,d=n.rightCacheBounds,p=0;0!==h&&(p=lL(u)/s);let f=0;0!==c&&(f=lL(d)/s);let m=1+1.25*(p*h+f*c);m<l&&(a=t,l=m,o=n.candidate)}}else{for(let t=0;t<cL;t++){let e=dL[t];e.count=0,e.candidate=n+u+t*u;let i=e.bounds;for(let t=0;t<3;t++)i[t]=1/0,i[t+3]=-1/0}for(let r=h;r<c;r+=6){let e=~~((i[r+2*t]-n)/u);e>=cL&&(e=31);let s=dL[e];s.count++,oL(r,i,s.bounds)}let e=dL[31];sL(e.bounds,e.rightCacheBounds);for(let t=30;t>=0;t--){let e=dL[t],i=dL[t+1];aL(e.bounds,i.rightCacheBounds,e.rightCacheBounds)}let d=0;for(let i=0;i<31;i++){let e=dL[i],n=e.count,h=e.bounds,c=dL[i+1].rightCacheBounds;0!==n&&(0===d?sL(h,pL):aL(h,pL,pL)),d+=n;let u=0,p=0;0!==d&&(u=lL(pL)/s);let f=r-d;0!==f&&(p=lL(c)/s);let m=1+1.25*(u*d+p*f);m<l&&(a=t,l=m,o=e.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:a,pos:o}}(e.boundingData,p,a,r,d,u);if(-1===g.axis)return i(r+d),e.offset=r,e.count=d,e;let v=function(t,e,i,n,r){let s=i,a=i+n-1,o=r.pos,l=2*r.axis;for(;;){for(;s<=a&&e[6*s+l]<o;)s++;for(;s<=a&&e[6*a+l]>=o;)a--;if(!(s<a))return s;for(let i=0;i<3;i++){let n=t[3*s+i];t[3*s+i]=t[3*a+i],t[3*a+i]=n;let r=e[6*s+2*i+0];e[6*s+2*i+0]=e[6*a+2*i+0],e[6*a+2*i+0]=r;let o=e[6*s+2*i+1];e[6*s+2*i+1]=e[6*a+2*i+1],e[6*a+2*i+1]=o}s++,a--}}(o,a,r,d,g);if(v===r||v===r+d)i(r+d),e.offset=r,e.count=d;else{e.splitAxis=g.axis;let t=new iL,i=r,o=v-r;e.left=t,t.boundingData=new Float32Array(6),hL(a,i,o,t.boundingData,s),n(t,i,o,s,m+1);let l=new iL,h=v,c=d-o;e.right=l,l.boundingData=new Float32Array(6),hL(a,h,c,l.boundingData,s),n(l,h,c,s,m+1)}return e}!function(t,e){if(!t.index){let i,n=t.attributes.position.count,r=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;i=n>65535?new Uint32Array(new r(4*n)):new Uint16Array(new r(2*n)),t.setIndex(new Rg(i,1));for(let t=0;t<n;t++)i[t]=t}}(t,e);let r=new Float32Array(6),s=new Float32Array(6),a=function(t,e){let i=t.attributes.position,n=t.index.array,r=n.length/3,s=new Float32Array(6*r),a=i.normalized,o=i.array,l=i.offset||0,h=3;i.isInterleavedBufferAttribute&&(h=i.data.stride);let c=["getX","getY","getZ"];for(let u=0;u<r;u++){let t,r,d,p=3*u,f=6*u;a?(t=n[p+0],r=n[p+1],d=n[p+2]):(t=n[p+0]*h+l,r=n[p+1]*h+l,d=n[p+2]*h+l);for(let n=0;n<3;n++){let l,h,u;a?(l=i[c[n]](t),h=i[c[n]](r),u=i[c[n]](d)):(l=o[t+n],h=o[r+n],u=o[d+n]);let p=l;h<p&&(p=h),u<p&&(p=u);let m=l;h>m&&(m=h),u>m&&(m=u);let g=(m-p)/2,v=2*n;s[f+v+0]=p+g,s[f+v+1]=g+(Math.abs(p)+g)*eL,p<e[n]&&(e[n]=p),m>e[n+3]&&(e[n+3]=m)}}return s}(t,r),o=t.index.array,l=e.maxDepth,h=e.verbose,c=e.maxLeafTris,u=e.strategy,d=e.onProgress,p=t.index.count/3,f=!1,m=[],g=function(t){if(!t.groups||!t.groups.length)return[{offset:0,count:t.index.count/3}];let e=[],i=new Set;for(let r of t.groups)i.add(r.start),i.add(r.start+r.count);let n=Array.from(i.values()).sort(((t,e)=>t-e));for(let r=0;r<n.length-1;r++){let t=n[r],i=n[r+1];e.push({offset:t/3,count:(i-t)/3})}return e}(t);if(1===g.length){let t=g[0],e=new iL;e.boundingData=r,function(t,e,i,n){let r=1/0,s=1/0,a=1/0,o=-1/0,l=-1/0,h=-1/0;for(let c=6*e,u=6*(e+i);c<u;c+=6){let e=t[c+0];e<r&&(r=e),e>o&&(o=e);let i=t[c+2];i<s&&(s=i),i>l&&(l=i);let n=t[c+4];n<a&&(a=n),n>h&&(h=n)}n[0]=r,n[1]=s,n[2]=a,n[3]=o,n[4]=l,n[5]=h}(a,t.offset,t.count,s),n(e,t.offset,t.count,s),m.push(e)}else for(let v of g){let t=new iL;t.boundingData=new Float32Array(6),hL(a,v.offset,v.count,t.boundingData,s),n(t,v.offset,v.count,s),m.push(t)}return m}var mL=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let i=1/0,n=-1/0;for(let r=0,s=t.length;r<s;r++){let s=t[r][e];i=s<i?s:i,n=s>n?s:n}this.min=i,this.max=n}setFromPoints(t,e){let i=1/0,n=-1/0;for(let r=0,s=e.length;r<s;r++){let s=e[r],a=t.dot(s);i=a<i?a:i,n=a>n?a:n}this.min=i,this.max=n}isSeparated(t){return this.min>t.max||t.min>this.max}};mL.prototype.setFromBox=function(){let t=new mm;return function(e,i){let n=i.min,r=i.max,s=1/0,a=-1/0;for(let o=0;o<=1;o++)for(let i=0;i<=1;i++)for(let l=0;l<=1;l++){t.x=n.x*o+r.x*(1-o),t.y=n.y*i+r.y*(1-i),t.z=n.z*l+r.z*(1-l);let h=e.dot(t);s=Math.min(h,s),a=Math.max(h,a)}this.min=s,this.max=a}}();!function(){let t=new mL}();var gL=function(){let t=new mm,e=new mm,i=new mm;return function(n,r,s){let a=n.start,o=t,l=r.start,h=e;i.subVectors(a,l),t.subVectors(n.end,n.start),e.subVectors(r.end,r.start);let c,u,d=i.dot(h),p=h.dot(o),f=h.dot(h),m=i.dot(o),g=o.dot(o)*f-p*p;c=0!==g?(d*p-m*f)/g:0,u=(d+c*p)/f,s.x=c,s.y=u}}(),vL=function(){let t=new Uf,e=new mm,i=new mm;return function(n,r,s,a){gL(n,r,t);let o=t.x,l=t.y;if(o>=0&&o<=1&&l>=0&&l<=1)return n.at(o,s),void r.at(l,a);if(o>=0&&o<=1)return l<0?r.at(0,a):r.at(1,a),void n.closestPointToPoint(a,!0,s);if(l>=0&&l<=1)return o<0?n.at(0,s):n.at(1,s),void r.closestPointToPoint(s,!0,a);{let t,h;t=o<0?n.start:n.end,h=l<0?r.start:r.end;let c=e,u=i;return n.closestPointToPoint(h,!0,e),r.closestPointToPoint(t,!0,i),c.distanceToSquared(h)<=u.distanceToSquared(t)?(s.copy(c),void a.copy(h)):(s.copy(t),void a.copy(u))}}}(),yL=function(){let t=new mm,e=new mm,i=new wv,n=new eA;return function(r,s){let{radius:a,center:o}=r,{a:l,b:h,c:c}=s;if(n.start=l,n.end=h,n.closestPointToPoint(o,!0,t).distanceTo(o)<=a||(n.start=l,n.end=c,n.closestPointToPoint(o,!0,t).distanceTo(o)<=a)||(n.start=h,n.end=c,n.closestPointToPoint(o,!0,t).distanceTo(o)<=a))return!0;let u=s.getPlane(i);if(Math.abs(u.distanceToPoint(o))<=a){let t=u.projectPoint(o,e);if(s.containsPoint(t))return!0}return!1}}();function bL(t){return Math.abs(t)<1e-15}var xL=class extends Mg{constructor(){super(...arguments),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new mm)),this.satBounds=new Array(4).fill().map((()=>new mL)),this.points=[this.a,this.b,this.c],this.sphere=new Bm,this.plane=new wv,this.needsUpdate=!0}intersectsSphere(t){return yL(t,this)}update(){let t=this.a,e=this.b,i=this.c,n=this.points,r=this.satAxes,s=this.satBounds,a=r[0],o=s[0];this.getNormal(a),o.setFromPoints(a,n);let l=r[1],h=s[1];l.subVectors(t,e),h.setFromPoints(l,n);let c=r[2],u=s[2];c.subVectors(e,i),u.setFromPoints(c,n);let d=r[3],p=s[3];d.subVectors(i,t),p.setFromPoints(d,n),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,t),this.needsUpdate=!1}};xL.prototype.closestPointToSegment=function(){let t=new mm,e=new mm,i=new eA;return function(n){let r,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,{start:o,end:l}=n,h=this.points,c=1/0;for(let u=0;u<3;u++){let o=(u+1)%3;i.start.copy(h[u]),i.end.copy(h[o]),vL(i,n,t,e),r=t.distanceToSquared(e),r<c&&(c=r,s&&s.copy(t),a&&a.copy(e))}return this.closestPointToPoint(o,t),r=o.distanceToSquared(t),r<c&&(c=r,s&&s.copy(t),a&&a.copy(o)),this.closestPointToPoint(l,t),r=l.distanceToSquared(t),r<c&&(c=r,s&&s.copy(t),a&&a.copy(l)),Math.sqrt(c)}}(),xL.prototype.intersectsTriangle=function(){let t=new xL,e=new Array(3),i=new Array(3),n=new mL,r=new mL,s=new mm,a=new mm,o=new mm,l=new mm,h=new eA,c=new eA,u=new eA;return function(d){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.needsUpdate&&this.update(),d.isExtendedTriangle?d.needsUpdate&&d.update():(t.copy(d),t.update(),d=t);let m=this.plane,g=d.plane;if(Math.abs(m.normal.dot(g.normal))>1-1e-10){let t=this.satBounds,a=this.satAxes;i[0]=d.a,i[1]=d.b,i[2]=d.c;for(let e=0;e<4;e++){let r=t[e],s=a[e];if(n.setFromPoints(s,i),r.isSeparated(n))return!1}let o=d.satBounds,l=d.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let i=0;i<4;i++){let t=o[i],r=l[i];if(n.setFromPoints(r,e),t.isSeparated(n))return!1}for(let h=0;h<4;h++){let t=a[h];for(let a=0;a<4;a++){let o=l[a];if(s.crossVectors(t,o),n.setFromPoints(s,e),r.setFromPoints(s,i),n.isSeparated(r))return!1}}return p&&(f||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),p.start.set(0,0,0),p.end.set(0,0,0)),!0}{let t=this.points,e=!1,i=0;for(let o=0;o<3;o++){let n=t[o],r=t[(o+1)%3];h.start.copy(n),h.end.copy(r),h.delta(a);let s=e?c.start:c.end,l=bL(g.distanceToPoint(n));if(bL(g.normal.dot(a))&&l){c.copy(h),i=2;break}if((g.intersectLine(h,s)||l)&&!bL(s.distanceTo(r))){if(i++,e)break;e=!0}}if(1===i&&d.containsPoint(c.end))return p&&(p.start.copy(c.end),p.end.copy(c.end)),!0;if(2!==i)return!1;let n=d.points,r=!1,s=0;for(let a=0;a<3;a++){let t=n[a],e=n[(a+1)%3];h.start.copy(t),h.end.copy(e),h.delta(o);let i=r?u.start:u.end,l=bL(m.distanceToPoint(t));if(bL(m.normal.dot(o))&&l){u.copy(h),s=2;break}if((m.intersectLine(h,i)||l)&&!bL(i.distanceTo(e))){if(s++,r)break;r=!0}}if(1===s&&this.containsPoint(u.end))return p&&(p.start.copy(u.end),p.end.copy(u.end)),!0;if(2!==s)return!1;if(c.delta(a),u.delta(o),a.dot(o)<0){let t=u.start;u.start=u.end,u.end=t}let f=c.start.dot(a),v=c.end.dot(a),y=u.start.dot(a),b=u.end.dot(a);return(f===b||y===v||v<y!==f<b)&&(p&&(l.subVectors(c.start,u.start),l.dot(a)>0?p.start.copy(c.start):p.start.copy(u.start),l.subVectors(c.end,u.end),l.dot(a)<0?p.end.copy(c.end):p.end.copy(u.end)),!0)}}}(),xL.prototype.distanceToPoint=function(){let t=new mm;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),xL.prototype.distanceToTriangle=function(){let t=new mm,e=new mm,i=["a","b","c"],n=new eA,r=new eA;return function(s){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=a||o?n:null;if(this.intersectsTriangle(s,l))return(a||o)&&(a&&l.getCenter(a),o&&l.getCenter(o)),0;let h=1/0;for(let e=0;e<3;e++){let n,r=i[e],l=s[r];this.closestPointToPoint(l,t),n=l.distanceToSquared(t),n<h&&(h=n,a&&a.copy(t),o&&o.copy(l));let c=this[r];s.closestPointToPoint(c,t),n=c.distanceToSquared(t),n<h&&(h=n,a&&a.copy(c),o&&o.copy(t))}for(let c=0;c<3;c++){let l=i[c],u=i[(c+1)%3];n.set(this[l],this[u]);for(let c=0;c<3;c++){let l=i[c],u=i[(c+1)%3];r.set(s[l],s[u]),vL(n,r,t,e);let d=t.distanceToSquared(e);d<h&&(h=d,a&&a.copy(t),o&&o.copy(e))}}return Math.sqrt(h)}}();var wL=class{constructor(t,e,i){this.isOrientedBox=!0,this.min=new mm,this.max=new mm,this.matrix=new Wm,this.invMatrix=new Wm,this.points=new Array(8).fill().map((()=>new mm)),this.satAxes=new Array(3).fill().map((()=>new mm)),this.satBounds=new Array(3).fill().map((()=>new mL)),this.alignedSatBounds=new Array(3).fill().map((()=>new mL)),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),i&&this.matrix.copy(i)}set(t,e,i){this.min.copy(t),this.max.copy(e),this.matrix.copy(i),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}};wL.prototype.update=function(){let t=this.matrix,e=this.min,i=this.max,n=this.points;for(let l=0;l<=1;l++)for(let r=0;r<=1;r++)for(let s=0;s<=1;s++){let a=n[1*l|2*r|4*s];a.x=l?i.x:e.x,a.y=r?i.y:e.y,a.z=s?i.z:e.z,a.applyMatrix4(t)}let r=this.satBounds,s=this.satAxes,a=n[0];for(let l=0;l<3;l++){let t=s[l],e=r[l],i=n[1<<l];t.subVectors(a,i),e.setFromPoints(t,n)}let o=this.alignedSatBounds;o[0].setFromPointsField(n,"x"),o[1].setFromPointsField(n,"y"),o[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},wL.prototype.intersectsBox=function(){let t=new mL;return function(e){this.needsUpdate&&this.update();let i=e.min,n=e.max,r=this.satBounds,s=this.satAxes,a=this.alignedSatBounds;if(t.min=i.x,t.max=n.x,a[0].isSeparated(t)||(t.min=i.y,t.max=n.y,a[1].isSeparated(t))||(t.min=i.z,t.max=n.z,a[2].isSeparated(t)))return!1;for(let o=0;o<3;o++){let i=s[o],n=r[o];if(t.setFromBox(i,e),n.isSeparated(t))return!1}return!0}}(),wL.prototype.intersectsTriangle=function(){let t=new xL,e=new Array(3),i=new mL,n=new mL,r=new mm;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(t.copy(s),t.update(),s=t);let a=this.satBounds,o=this.satAxes;e[0]=s.a,e[1]=s.b,e[2]=s.c;for(let t=0;t<3;t++){let n=a[t],r=o[t];if(i.setFromPoints(r,e),n.isSeparated(i))return!1}let l=s.satBounds,h=s.satAxes,c=this.points;for(let t=0;t<3;t++){let e=l[t],n=h[t];if(i.setFromPoints(n,c),e.isSeparated(i))return!1}for(let t=0;t<3;t++){let s=o[t];for(let t=0;t<4;t++){let a=h[t];if(r.crossVectors(s,a),i.setFromPoints(r,e),n.setFromPoints(r,c),i.isSeparated(n))return!1}}return!0}}(),wL.prototype.closestPointToPoint=function(t,e){return this.needsUpdate&&this.update(),e.copy(t).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e},wL.prototype.distanceToPoint=function(){let t=new mm;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),wL.prototype.distanceToBox=function(){let t=["x","y","z"],e=new Array(12).fill().map((()=>new eA)),i=new Array(12).fill().map((()=>new eA)),n=new mm,r=new mm;return function(s){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(o||l)&&(s.getCenter(r),this.closestPointToPoint(r,n),s.closestPointToPoint(n,r),o&&o.copy(n),l&&l.copy(r)),0;let h=a*a,c=s.min,u=s.max,d=this.points,p=1/0;for(let t=0;t<8;t++){let e=d[t];r.copy(e).clamp(c,u);let i=e.distanceToSquared(r);if(i<p&&(p=i,o&&o.copy(e),l&&l.copy(r),i<h))return Math.sqrt(i)}let f=0;for(let n=0;n<3;n++)for(let r=0;r<=1;r++)for(let s=0;s<=1;s++){let a=(n+1)%3,o=(n+2)%3,l=1<<n|r<<a|s<<o,h=d[r<<a|s<<o],p=d[l];e[f].set(h,p);let m=t[n],g=t[a],v=t[o],y=i[f],b=y.start,x=y.end;b[m]=c[m],b[g]=r?c[g]:u[g],b[v]=s?c[v]:u[g],x[m]=u[m],x[g]=r?c[g]:u[g],x[v]=s?c[v]:u[g],f++}for(let t=0;t<=1;t++)for(let e=0;e<=1;e++)for(let i=0;i<=1;i++){r.x=t?u.x:c.x,r.y=e?u.y:c.y,r.z=i?u.z:c.z,this.closestPointToPoint(r,n);let s=r.distanceToSquared(n);if(s<p&&(p=s,o&&o.copy(n),l&&l.copy(r),s<h))return Math.sqrt(s)}for(let t=0;t<12;t++){let s=e[t];for(let t=0;t<12;t++){let e=i[t];vL(s,e,n,r);let a=n.distanceToSquared(r);if(a<p&&(p=a,o&&o.copy(n),l&&l.copy(r),a<h))return Math.sqrt(a)}}return Math.sqrt(p)}}();var SL=new mm,AL=new mm,EL=new mm,_L=new Uf,CL=new Uf,ML=new Uf,PL=new mm,TL=new mm,DL=new mm,kL=new mm;function IL(t,e,i,n,r){let s=3*n,a=t.index.getX(s),o=t.index.getX(s+1),l=t.index.getX(s+2),{position:h,normal:c,uv:u,uv1:d}=t.attributes,p=function(t,e,i,n,r,s,a,o,l){SL.fromBufferAttribute(e,s),AL.fromBufferAttribute(e,a),EL.fromBufferAttribute(e,o);let h=function(t,e,i,n,r,s){let a;return a=1===s?t.intersectTriangle(n,i,e,!0,r):t.intersectTriangle(e,i,n,2!==s,r),null===a?null:{distance:t.origin.distanceTo(r),point:r.clone()}}(t,SL,AL,EL,kL,l);if(h){n&&(_L.fromBufferAttribute(n,s),CL.fromBufferAttribute(n,a),ML.fromBufferAttribute(n,o),h.uv=Mg.getInterpolation(kL,SL,AL,EL,_L,CL,ML,new Uf)),r&&(_L.fromBufferAttribute(r,s),CL.fromBufferAttribute(r,a),ML.fromBufferAttribute(r,o),h.uv1=Mg.getInterpolation(kL,SL,AL,EL,_L,CL,ML,new Uf)),i&&(PL.fromBufferAttribute(i,s),TL.fromBufferAttribute(i,a),DL.fromBufferAttribute(i,o),h.normal=Mg.getInterpolation(kL,SL,AL,EL,PL,TL,DL,new mm),h.normal.dot(t.direction)>0&&h.normal.multiplyScalar(-1));let e={a:s,b:a,c:o,normal:new mm,materialIndex:0};Mg.getNormal(SL,AL,EL,e.normal),h.face=e,h.faceIndex=s}return h}(i,h,c,u,d,a,o,l,e);return p?(p.faceIndex=n,r&&r.push(p),p):null}function RL(t,e,i,n){let r=t.a,s=t.b,a=t.c,o=e,l=e+1,h=e+2;i&&(o=i.getX(e),l=i.getX(e+1),h=i.getX(e+2)),r.x=n.getX(o),r.y=n.getY(o),r.z=n.getZ(o),s.x=n.getX(l),s.y=n.getY(l),s.z=n.getZ(l),a.x=n.getX(h),a.y=n.getY(h),a.z=n.getZ(h)}function OL(t,e,i,n,r,s,a){let o=i.index,l=i.attributes.position;for(let h=t,c=e+t;h<c;h++)if(RL(a,3*h,o,l),a.needsUpdate=!0,n(a,h,r,s))return!0;return!1}var LL=class{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){let t=this._primitives;return 0===t.length?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}};function BL(t,e){return 65535===e[t+15]}function zL(t,e){return e[t+6]}function FL(t,e){return e[t+14]}function NL(t){return t+8}function UL(t,e){return e[t+6]}var VL=new ym,jL=new mm,GL=["x","y","z"];function HL(t,e,i,n,r){let s=2*t,a=KL,o=ZL,l=JL;if(BL(s,o)){!function(t,e,i,n,r,s){for(let a=n,o=n+r;a<o;a++)IL(t,e,i,a,s)}(e,i,n,zL(t,l),FL(s,o),r)}else{let s=NL(t);XL(s,a,n,jL)&&HL(s,e,i,n,r);let o=UL(t,l);XL(o,a,n,jL)&&HL(o,e,i,n,r)}}function WL(t,e,i,n){let r=2*t,s=KL,a=ZL,o=JL;if(BL(r,a)){return function(t,e,i,n,r){let s=1/0,a=null;for(let o=n,l=n+r;o<l;o++){let n=IL(t,e,i,o);n&&n.distance<s&&(a=n,s=n.distance)}return a}(e,i,n,zL(t,o),FL(r,a))}{let r,a,l=function(t,e){return e[t+7]}(t,o),h=GL[l],c=n.direction[h]>=0;c?(r=NL(t),a=UL(t,o)):(r=UL(t,o),a=NL(t));let u=XL(r,s,n,jL)?WL(r,e,i,n):null;if(u){let t=u.point[h];if(c?t<=s[a+l]:t>=s[a+l+3])return u}let d=XL(a,s,n,jL)?WL(a,e,i,n):null;return u&&d?u.distance<=d.distance?u:d:u||d||null}}var qL=function(){let t,e,i=[],n=new LL((()=>new ym));return function(){t=n.getPrimitive(),e=n.getPrimitive(),i.push(t,e);let s=r(...arguments);n.releasePrimitive(t),n.releasePrimitive(e),i.pop(),i.pop();let a=i.length;return a>0&&(e=i[a-1],t=i[a-2]),s};function r(i,n,s,a){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;function c(t){let e=2*t,i=ZL,n=JL;for(;!BL(e,i);)e=2*(t=NL(t));return zL(t,n)}function u(t){let e=2*t,i=ZL,n=JL;for(;!BL(e,i);)e=2*(t=UL(t,n));return zL(t,n)+FL(e,i)}let d=2*i,p=KL,f=ZL,m=JL;if(BL(d,f)){let e=zL(i,m),n=FL(d,f);return nL(i,p,t),a(e,n,!1,h,l+i,t)}{let d,g,v,y,b=NL(i),x=UL(i,m),w=b,S=x;if(o&&(v=t,y=e,nL(w,p,v),nL(S,p,y),d=o(v),g=o(y),g<d)){w=x,S=b;let t=d;d=g,g=t,v=y}v||(v=t,nL(w,p,v));let A,E=s(v,BL(2*w,f),d,h+1,l+w);if(2===E){let t=c(w);A=a(t,u(w)-t,!0,h+1,l+w,v)}else A=E&&r(w,n,s,a,o,l,h+1);if(A)return!0;y=e,nL(S,p,y);let _,C=s(y,BL(2*S,f),g,h+1,l+S);if(2===C){let t=c(S);_=a(t,u(S)-t,!0,h+1,l+S,y)}else _=C&&r(S,n,s,a,o,l,h+1);return!!_}}}(),YL=function(){let t=new xL,e=new xL,i=new Wm,n=new wL,r=new wL;return function s(a,o,l,h){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=2*a,d=KL,p=ZL,f=JL;if(null===c&&(l.boundingBox||l.computeBoundingBox(),n.set(l.boundingBox.min,l.boundingBox.max,h),c=n),!BL(u,p)){let t=a+8,e=f[a+6];return nL(t,d,VL),!!(c.intersectsBox(VL)&&s(t,o,l,h,c)||(nL(e,d,VL),c.intersectsBox(VL)&&s(e,o,l,h,c)))}{let n=o,s=n.index,c=n.attributes.position,m=l.index,g=l.attributes.position,v=zL(a,f),y=FL(u,p);if(i.copy(h).invert(),l.boundsTree)return nL(a,d,r),r.matrix.copy(i),r.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:t=>r.intersectsBox(t),intersectsTriangle:t=>{t.a.applyMatrix4(h),t.b.applyMatrix4(h),t.c.applyMatrix4(h),t.needsUpdate=!0;for(let i=3*v,n=3*(y+v);i<n;i+=3)if(RL(e,i,s,c),e.needsUpdate=!0,t.intersectsTriangle(e))return!0;return!1}});for(let r=3*v,a=y+3*v;r<a;r+=3){RL(t,r,s,c),t.a.applyMatrix4(i),t.b.applyMatrix4(i),t.c.applyMatrix4(i),t.needsUpdate=!0;for(let i=0,n=m.count;i<n;i+=3)if(RL(e,i,m,g),e.needsUpdate=!0,t.intersectsTriangle(e))return!0}}}}();function XL(t,e,i,n){return nL(t,e,VL),i.intersectBox(VL,n)}var QL,KL,ZL,JL,$L=[];function tB(t){QL&&$L.push(QL),QL=t,KL=new Float32Array(t),ZL=new Uint16Array(t),JL=new Uint32Array(t)}function eB(){QL=null,KL=null,ZL=null,JL=null,$L.length&&tB($L.pop())}var iB=Symbol("skip tree generation"),nB=new ym,rB=new ym,sB=new Wm,aB=new wL,oB=new wL,lB=new mm,hB=new mm,cB=new mm,uB=new mm,dB=new mm,pB=new ym,fB=new LL((()=>new xL)),mB=class{static serialize(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),mB.serialize(arguments[0],{cloneBuffers:void 0===arguments[2]||arguments[2]});e={cloneBuffers:!0,...e};let i,n=t.geometry,r=t._roots,s=n.getIndex();return i=e.cloneBuffers?{roots:r.map((t=>t.slice())),index:s.array.slice()}:{roots:r,index:s.array},i}static deserialize(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("boolean"==typeof i)return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),mB.deserialize(arguments[0],arguments[1],{setIndex:void 0===arguments[2]||arguments[2]});i={setIndex:!0,...i};let{index:n,roots:r}=t,s=new mB(e,{...i,[iB]:!0});if(s._roots=r,i.setIndex){let i=e.getIndex();if(null===i){let i=new Rg(t.index,1,!1);e.setIndex(i)}else i.array!==n&&(i.array.set(n),i.needsUpdate=!0)}return s}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if(e=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[iB]:!1},e),e.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,e[iB]||(this._roots=function(t,e){let i,n,r,s=fL(t,e),a=[],o=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let c=0;c<s.length;c++){let t=s[c],e=new o(32*l(t));i=new Float32Array(e),n=new Uint32Array(e),r=new Uint16Array(e),h(0,t),a.push(e)}return a;function l(t){return t.count?1:1+l(t.left)+l(t.right)}function h(t,e){let s=t/4,a=t/2,o=!!e.count,l=e.boundingData;for(let n=0;n<6;n++)i[s+n]=l[n];if(o){let i=e.offset,o=e.count;return n[s+6]=i,r[a+14]=o,r[a+15]=65535,t+32}{let i,r=e.left,a=e.right,o=e.splitAxis;if(i=h(t+32,r),i/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[s+6]=i/4,i=h(i,a),n[s+7]=o,i}}}(t,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new ym))),this.geometry=t}refit(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t&&Array.isArray(t)&&(t=new Set(t));let e,i,n,r,s=this.geometry,a=s.index.array,o=s.attributes.position,l=0,h=this._roots;for(let u=0,d=h.length;u<d;u++)e=h[u],i=new Uint32Array(e),n=new Uint16Array(e),r=new Float32Array(e),c(0,l),l+=e.byteLength;function c(e,s){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=2*e;if(65535===n[h+15]){let t=i[e+6],s=1/0,l=1/0,c=1/0,u=-1/0,d=-1/0,p=-1/0;for(let e=3*t,i=3*(t+n[h+14]);e<i;e++){let t=a[e],i=o.getX(t),n=o.getY(t),r=o.getZ(t);i<s&&(s=i),i>u&&(u=i),n<l&&(l=n),n>d&&(d=n),r<c&&(c=r),r>p&&(p=r)}return(r[e+0]!==s||r[e+1]!==l||r[e+2]!==c||r[e+3]!==u||r[e+4]!==d||r[e+5]!==p)&&(r[e+0]=s,r[e+1]=l,r[e+2]=c,r[e+3]=u,r[e+4]=d,r[e+5]=p,!0)}{let n=e+8,a=i[e+6],o=n+s,h=a+s,u=l,d=!1,p=!1;t?u||(d=t.has(o),p=t.has(h),u=!d&&!p):(d=!0,p=!0);let f=u||p,m=!1;(u||d)&&(m=c(n,s,u));let g=!1;f&&(g=c(a,s,u));let v=m||g;if(v)for(let t=0;t<3;t++){let i=n+t,s=a+t,o=r[i],l=r[i+3],h=r[s],c=r[s+3];r[e+t]=o<h?o:h,r[e+t+3]=l>c?l:c}return v}}}traverse(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this._roots[e],n=new Uint32Array(i),r=new Uint16Array(i);!function e(s){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=2*s,l=65535===r[o+15];if(l){let e=n[s+6],h=r[o+14];t(a,l,new Float32Array(i,4*s,6),e,h)}else{let r=s+8,o=n[s+6],h=n[s+7];t(a,l,new Float32Array(i,4*s,6),h)||(e(r,a+1),e(o,a+1))}}(0)}raycast(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this._roots,n=this.geometry,r=[],s=e.isMaterial,a=Array.isArray(e),o=n.groups,l=s?e.side:e;for(let h=0,c=i.length;h<c;h++){let s=a?e[o[h].materialIndex].side:l,c=r.length;if(tB(i[h]),HL(0,n,s,t,r),eB(),a){let t=o[h].materialIndex;for(let e=c,i=r.length;e<i;e++)r[e].face.materialIndex=t}}return r}raycastFirst(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this._roots,n=this.geometry,r=e.isMaterial,s=Array.isArray(e),a=null,o=n.groups,l=r?e.side:e;for(let h=0,c=i.length;h<c;h++){let r=s?e[o[h].materialIndex].side:l;tB(i[h]);let c=WL(0,n,r,t);eB(),null!=c&&(null==a||c.distance<a.distance)&&(a=c,s&&(c.face.materialIndex=o[h].materialIndex))}return a}intersectsGeometry(t,e){let i=this.geometry,n=!1;for(let r of this._roots)if(tB(r),n=YL(0,i,t,e),eB(),n)break;return n}shapecast(t,e,i){let n=this.geometry;if(t instanceof Function){if(e){let t=e;e=(e,i,n,r)=>{let s=3*i;return t(e,s,s+1,s+2,n,r)}}t={boundsTraverseOrder:i,intersectsBounds:t,intersectsTriangle:e,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let r=fB.getPrimitive(),{boundsTraverseOrder:s,intersectsBounds:a,intersectsRange:o,intersectsTriangle:l}=t;if(o&&l){let t=o;o=(e,i,s,a,o)=>!!t(e,i,s,a,o)||OL(e,i,n,l,s,a,r)}else o||(o=l?(t,e,i,s)=>OL(t,e,n,l,i,s,r):(t,e,i)=>i);let h=!1,c=0;for(let u of this._roots){if(tB(u),h=qL(0,n,a,o,s,c),eB(),h)break;c+=u.byteLength}return fB.releasePrimitive(r),h}bvhcast(t,e,i){let{intersectsRanges:n,intersectsTriangles:r}=i,s=this.geometry.index,a=this.geometry.attributes.position,o=t.geometry.index,l=t.geometry.attributes.position;sB.copy(e).invert();let h=fB.getPrimitive(),c=fB.getPrimitive();if(r){let t=function(t,i,n,u,d,p,f,m){for(let g=n,v=n+u;g<v;g++){RL(c,3*g,o,l),c.a.applyMatrix4(e),c.b.applyMatrix4(e),c.c.applyMatrix4(e),c.needsUpdate=!0;for(let e=t,n=t+i;e<n;e++)if(RL(h,3*e,s,a),h.needsUpdate=!0,r(h,c,e,g,d,p,f,m))return!0}return!1};if(n){let e=n;n=function(i,n,r,s,a,o,l,h){return!!e(i,n,r,s,a,o,l,h)||t(i,n,r,s,a,o,l,h)}}else n=t}t.getBoundingBox(rB),rB.applyMatrix4(e);let u=this.shapecast({intersectsBounds:t=>rB.intersectsBox(t),intersectsRange:(e,i,r,s,a,o)=>(nB.copy(o),nB.applyMatrix4(sB),t.shapecast({intersectsBounds:t=>nB.intersectsBox(t),intersectsRange:(t,r,o,l,h)=>n(e,i,t,r,s,a,l,h)}))});return fB.releasePrimitive(h),fB.releasePrimitive(c),u}intersectsBox(t,e){return aB.set(t.min,t.max,e),aB.needsUpdate=!0,this.shapecast({intersectsBounds:t=>aB.intersectsBox(t),intersectsTriangle:t=>aB.intersectsTriangle(t)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0;t.boundingBox||t.computeBoundingBox(),aB.set(t.boundingBox.min,t.boundingBox.max,e),aB.needsUpdate=!0;let a=this.geometry,o=a.attributes.position,l=a.index,h=t.attributes.position,c=t.index,u=fB.getPrimitive(),d=fB.getPrimitive(),p=hB,f=cB,m=null,g=null;n&&(m=uB,g=dB);let v=1/0,y=null,b=null;return sB.copy(e).invert(),oB.matrix.copy(sB),this.shapecast({boundsTraverseOrder:t=>aB.distanceToBox(t),intersectsBounds:(t,e,i)=>i<v&&i<s&&(e&&(oB.min.copy(t.min),oB.max.copy(t.max),oB.needsUpdate=!0),!0),intersectsRange:(i,n)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:t=>oB.distanceToBox(t),intersectsBounds:(t,e,i)=>i<v&&i<s,intersectsRange:(t,s)=>{for(let a=3*t,x=3*(t+s);a<x;a+=3){RL(d,a,c,h),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let t=3*i,e=3*(i+n);t<e;t+=3){RL(u,t,l,o),u.needsUpdate=!0;let e=u.distanceToTriangle(d,p,m);if(e<v&&(f.copy(p),g&&g.copy(m),v=e,y=t/3,b=a/3),e<r)return!0}}}});for(let t=0,s=c?c.count:h.count;t<s;t+=3){RL(d,t,c,h),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let e=3*i,s=3*(i+n);e<s;e+=3){RL(u,e,l,o),u.needsUpdate=!0;let i=u.distanceToTriangle(d,p,m);if(i<v&&(f.copy(p),g&&g.copy(m),v=i,y=e/3,b=t/3),i<r)return!0}}}}),fB.releasePrimitive(u),fB.releasePrimitive(d),v===1/0?null:(i.point?i.point.copy(f):i.point=f.clone(),i.distance=v,i.faceIndex=y,n&&(n.point?n.point.copy(g):n.point=g.clone(),n.point.applyMatrix4(sB),f.applyMatrix4(sB),n.distance=f.sub(n.point).length(),n.faceIndex=b),i)}closestPointToPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,r=i*i,s=n*n,a=1/0,o=null;if(this.shapecast({boundsTraverseOrder:e=>(lB.copy(t).clamp(e.min,e.max),lB.distanceToSquared(t)),intersectsBounds:(t,e,i)=>i<a&&i<s,intersectsTriangle:(e,i)=>{e.closestPointToPoint(t,lB);let n=t.distanceToSquared(lB);return n<a&&(hB.copy(lB),a=n,o=i),n<r}}),a===1/0)return null;let l=Math.sqrt(a);return e.point?e.point.copy(hB):e.point=hB.clone(),e.distance=l,e.faceIndex=o,e}getBoundingBox(t){return t.makeEmpty(),this._roots.forEach((e=>{nL(0,new Float32Array(e),pB),t.union(pB)})),t}},gB=np(sp()),vB=.5*(Math.sqrt(3)-1),yB=(3-Math.sqrt(3))/6,bB=1/3,xB=1/6,wB=(Math.sqrt(5),Math.sqrt(5),t=>0|Math.floor(t)),SB=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),AB=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function EB(t){let e=new Uint8Array(512);for(let i=0;i<256;i++)e[i]=i;for(let i=0;i<255;i++){let n=i+~~(t()*(256-i)),r=e[i];e[i]=e[n],e[n]=r}for(let i=256;i<512;i++)e[i]=e[i-256];return e}var _B,CB=new Mg,MB=class{constructor(t){this.weightAttribute=null;let e=t.geometry;if(!e.isBufferGeometry||3!==e.attributes.position.itemSize)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");e.index&&(e=e.toNonIndexed()),this.geometry=e,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let t=this.positionAttribute,e=new Float32Array(t.count/3);for(let n=0;n<t.count;n+=3){let i=1;CB.a.fromBufferAttribute(t,n),CB.b.fromBufferAttribute(t,n+1),CB.c.fromBufferAttribute(t,n+2),i*=CB.getArea(),e[n/3]=i}this.distribution=new Float32Array(t.count/3);let i=0;for(let n=0;n<e.length;n++)i+=e[n],this.distribution[n]=i;return this}setRandomGenerator(t){return this.randomFunction=t,this}sample(t,e){if(this.distribution){let i=this.distribution[this.distribution.length-1],n=this.binarySearch(this.randomFunction()*i);return this.sampleFace(n,t,e)}}binarySearch(t){if(!this.distribution)return 0;let e=this.distribution,i=0,n=e.length-1,r=-1;for(;i<=n;){let s=Math.ceil((i+n)/2);if(0===s||e[s-1]<=t&&e[s]>t){r=s;break}t<e[s]?n=s-1:i=s+1}return r}sampleFace(t,e,i){let n=this.randomFunction(),r=this.randomFunction();return n+r>1&&(n=1-n,r=1-r),CB.a.fromBufferAttribute(this.positionAttribute,3*t),CB.b.fromBufferAttribute(this.positionAttribute,3*t+1),CB.c.fromBufferAttribute(this.positionAttribute,3*t+2),e.set(0,0,0).addScaledVector(CB.a,n).addScaledVector(CB.b,r).addScaledVector(CB.c,1-(n+r)),CB.getNormal(i),this}},PB=np(ap()),TB=new Wm,DB=new Wm,kB=new Wm;(t=>{t.is=function(t){return t&&t.__isSPEObject}})(_B||(_B={}));var IB,RB=t=>class extends t{constructor(){super(...arguments),this.previousModelViewMatrix=new Wm,this.copyPreviousMatrix=!0,this.hiddenMatrix=new Wm,this.matrixWorldRigid=new Wm,this.shearScale=new Wm,this.shearScaleInv=new Wm}get __isSPEObject(){return!0}isDescendantOf(t){t instanceof gg&&(t=t.uuid);let e=this;for(;e.parent;){if(e.parent.uuid===t)return!0;e=e.parent}return!1}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);for(let e of this.children)e.updateMatrixWorld(t)}updateWorldMatrix(t,e){let i=this.parent;if(t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),e)for(let n of this.children)n.updateWorldMatrix(!1,!0)}traverseChildren(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let i of this.children)_B.is(i)&&i.traverseObject(t,e+1)}traverseObject(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!0!==t(this,e))for(let i of this.children)_B.is(i)&&i.traverseObject(t,e+1)}updateMatrixWorldSVD(){let t=this.matrixWorld.elements,e=[[t[0],t[4],t[8]],[t[1],t[5],t[9]],[t[2],t[6],t[10]]],{u:i,v:n,q:r}=(0,PB.SVD)(e),s=TB.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),a=DB.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1),o=kB.copy(a).transpose();this.shearScale.makeScale(r[0],r[1],r[2]).multiply(o).premultiply(a),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(s,o).copyPosition(this.matrixWorld),r.every((t=>Math.abs(r[0]-t)<.01))?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(t,e){this.updateWorldMatrix(!0,!1);let i=(new Wm).copy(this.matrixWorld).invert();return null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),i.multiply(t.parent.matrixWorld)),"hiddenMatrix"in t&&t.hiddenMatrix instanceof Wm?t.hiddenMatrix.premultiply(i):t.applyMatrix4(i),t.updateWorldMatrix(!1,!1),this.add(t),void 0!==e&&(this.children.pop(),this.children.splice(e,0,t)),this}copy(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return super.copy(t,e),this.hasNonUniformScale=t.hasNonUniformScale,this}onAfterRender(t,e,i,n,r,s){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},OB=class extends(RB(gg)){},LB=class extends OB{constructor(t){super(),this.object=t,this.matrixAutoUpdate=!1,this.hasNonUniformScale=t.hasNonUniformScale}raycast(t,e){}expand(){let t=0,e=this.object.entityChildren(t);for(;e;){let i=this.children[t];i?.object!==e&&(i&&this.remove(i),i=new LB(e),this.add(i),this.children.splice(t,0,this.children.pop()),i.matrixWorldNeedsUpdate=!0,i.matrixAutoUpdate=!1,i.matrix=e.matrix,i.hiddenMatrix=e.hiddenMatrix),i.expand(),t+=1,e=this.object.entityChildren(t)}for(;this.children.length>t;)this.remove(this.children[t])}get visible(){return void 0!==this.playModeVisible?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&!0===this.object.dataPatched.cloner?.hideBase}set visible(t){}get castShadow(){return this.object.castShadow}set castShadow(t){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(t){}get isMesh(){return"Mesh"===this.object.type}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(t){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},BB=new mm,zB=new mm,FB=new Wm,NB=[new mm(-1,1,1),new mm(-1,-1,1),new mm(1,-1,1),new mm(1,1,1),new mm(-1,1,-1),new mm(-1,-1,-1),new mm(1,-1,-1),new mm(1,1,-1)],UB=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],VB=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],jB=(t,e,i)=>{t.updateEntityBoxSize(BB,zB),FB.copy(e).multiply(t.matrixWorld),0===zB.x&&0===zB.y&&0===zB.z?i.push(new mm(BB.x,BB.y,BB.z).applyMatrix4(FB)):NB.forEach((t=>{i.push(t.clone().multiply(zB).add(BB).applyMatrix4(FB))}))},GB=class extends ym{constructor(){super(...arguments),this.matrix=new Wm,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(t){return super.copy(t),this.matrix.copy(t.matrix),this.vertices=t.vertices.map((t=>t.clone())),this.faces=t.faces.map((t=>t.clone())),this.edges=t.edges.map((t=>t.clone())),this.centerEdges=t.centerEdges.map((t=>t.clone())),this}setFromObjectSize(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.updateWorldMatrix(!1,e),this.makeEmpty(),this.matrix.copy(t.matrixWorld);let i=(new Wm).copy(t.matrixWorld).invert();return this.expandByObjectSize(t,i,e)}expandByObjectSize(t,e){let i=[];return!0===(arguments.length>2&&void 0!==arguments[2]&&arguments[2])?t.traverseEntity((t=>{if(t.visible||t.cloner&&t.data.visible){if(!("geometry"in t))return void i.push(new mm);jB(t,e,i)}})):jB(t,e,i),this.setFromPoints(i)}getCenter(t){return(t=super.getCenter(t)).applyMatrix4(this.matrix),t}getPositionToCenter(t){return(t=super.getCenter(t)).applyMatrix4(FB.copy(this.matrix).setPosition(0,0,0)),t}computeVertices(){this.getSize(zB).multiplyScalar(.5),this.getCenter(BB),FB.copy(this.matrix).setPosition(BB),this.vertices=NB.map((t=>t.clone().multiply(zB).applyMatrix4(FB)))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=UB.map((t=>{let[e,i]=t;return new eA(this.vertices[e],this.vertices[i])})),this.centerEdges=this.edges.map((t=>t.getCenter(new mm)))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=VB.map((t=>{let[e,i]=t;return this.vertices[e].clone().add(this.vertices[i]).multiplyScalar(.5)}))}},HB={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},WB=class extends Kx{constructor(){super()}getPoints(){let t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,i=[],n=this.getCurveLengths(),r=n[n.length-1]/n.length;for(let s=0,a=this.curves;s<a.length;s++){let o=a[s],l=0===s?n[s]:n[s]-n[s-1],h=Math.ceil(e*l/r),c=o.getPoints(h);for(let e=0;e<c.length;e++){let n=c[e];t&&t.equals(n)||(i.push(n),t=n)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}},qB=.001;function YB(t,e,i){return e.clone().sub(t).cross(e.clone().sub(i)).length()<=qB}function XB(t,e){let i=new mm(...t.position),n=new mm(...t.controlNext.position),r=new mm(...e.controlPrevious.position),s=new mm(...e.position);return YB(i,n,s)&&YB(i,r,s)}function QB(t){let e=t.points.map((t=>new mm(...t.data.position))),i=[t.points[0]],n=new mm(...i[0].data.position);for(let c=0;c<t.points.length-1;c++)YB(n,e[c],e[c+1])||(i.push(t.points[c]),n=e[c]);i.push(t.points[t.points.length-1]);let r=t.isClosed,s=i.length-(r?0:1),a=i.length,o=[];for(let c=0;c<a;c++){let e=i[c].data,n=new mm(...e.position),s=new mm(...e.controlPrevious.position),l=new mm(...e.controlNext.position),h={position:n,baseRoundness:e.roundness,controlPrevious:s,controlNext:l};if(0===e.roundness||!t.isClosed&&(0===c||c===a-1)){o[c]={...h,removedLength:0};continue}let u=r&&c==a-1?0:c+1,d=i[r&&0==c?a-1:c-1].data,p=i[u].data,f=new mm(...d.position),m=new mm(...p.position),g=f.clone().sub(n).normalize(),v=m.clone().sub(n).normalize();Object.assign(h,{prevDir:g,nextDir:v});let y=XB(d,e),b=XB(e,p);if(y&&b){let t=g.clone().add(v).normalize(),i=t.clone().cross(g).length()/g.dot(t);o[c]={...h,tan:i,removedLength:e.roundness/i}}else o[c]={...h,removedLength:0}}for(let c=0;c<s;c++){let t=r&&c===a-1?0:c+1,e=o[c],i=o[t];if(0!==e.removedLength||0!==i.removedLength){let t=e.position.distanceTo(i.position);e.removedLength=Math.min(e.removedLength,t/2),i.removedLength=Math.min(i.removedLength,t/2)}}let l=[];for(let c=0;c<s;c++){let t=c,e=r&&c===a-1?0:c+1,n=o[t],s=o[e],h=null;if(XB(i[t].data,i[e].data)){let t=n.position.clone(),e=s.position.clone();(0!==n.removedLength||0!==s.removedLength)&&(n.nextDir&&t.add(n.nextDir.clone().setLength(n.removedLength)),s.prevDir&&e.add(s.prevDir.clone().setLength(s.removedLength))),t.distanceTo(e)>qB&&(h=new Hx(t,t.clone().lerp(e,.3),e.clone().lerp(t,.3),e))}else n.position.distanceTo(s.position)>qB&&(h=new Hx(n.position,n.controlNext,s.controlPrevious,s.position));l[2*c+1]=h}for(let c=0;c<a;c++){let t=o[c];if(0===t.removedLength){l[2*c]=null;continue}let e=t.position,i=t.prevDir.clone().multiplyScalar(t.removedLength).add(e),n=t.nextDir.clone().multiplyScalar(t.removedLength).add(e),r=t.tan*t.removedLength,s=t.prevDir.clone().add(t.nextDir).normalize(),a=i.clone().lerp(n,.5),h=i.distanceTo(n)/2,u=s.clone().multiplyScalar(Math.sqrt(Math.pow(r,2)-Math.pow(h,2))).add(a),d=s.clone().multiplyScalar(-r).add(u),p=e.distanceTo(d)/e.distanceTo(a),f=t.prevDir.clone().multiplyScalar(p*e.distanceTo(i)).add(e),m=f.clone().lerp(d,2),g=i.clone().lerp(f,4/3),v=n.clone().lerp(m,4/3);l[2*c]=new Hx(i,g,v,n)}let h=new WB;return l.forEach((t=>{t&&h.add(t)})),h}(t=>{t.is=function(t){return t&&t.__isEntity}})(IB||(IB={}));var KB=t=>IB.is(t),ZB={type:"completeState",isfromEntity:!0},JB=["x","y","z"],$B=new mm,tz=(new mm).set(0,1,0),ez=t=>class extends(RB(t)){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.destroyedInAction=!1,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new GB,this._recursiveBBox=new GB,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(t){let e=this.children[t];if(IB.is(e))return e}entityChildrenCount(){let t=this.children.length;for(;t--;)if(IB.is(this.children[t]))return t+1;return 0}get isConcreteEntity(){return"string"==typeof this.identity}get isVirtualEntity(){return"string"!=typeof this.identity}get isInstanceRoot(){return this.isConcreteEntity&&"Instance"===this.data.type}nearestInstanceSelfOrParent(){let t=this;for(;"Instance"!==t.data.type;){let e=t.parent;if(!IB.is(e))return;t=e}return t}forInstancesRec(t){this.instances.forEach((e=>{e.disposed||t(e),e.forInstancesRec(t)}))}super_Entity(t,e){"string"==typeof t&&(this.uuid=t),this.identity=t,this.data=e,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0!==this.data.states.length||i){for(let t of this.data.states)qR.toOps(this.data,t.data).forEach((t=>{let i=XT.replaceProps(t,this.data);this.dataPatched=this.data,this.updateByPatchedOp(i,this.data,e)}));if(null!==t){let i=this.data.states.data(t);i&&(this.dataPatched=qR.patch(this.data,i),qR.toOps(this.data,i).forEach((t=>{this.updateByPatchedOp(t,this.dataPatched,e)})))}i&&this.updateTransformState(this.dataPatched,e),this.stateSelection=t,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(t,e){t.setScalar(0),e.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors((t=>{KB(t)&&t.resetBBoxNeedsUpdateSelf()})),this.traverseEntity((t=>{t.resetBBoxNeedsUpdateSelf()}))}find(t){let e;return this.traverseEntity((i=>{i.uuid===t&&(e=i)})),e}traverseSortNextHelper(){let t=this.parent;if(t){let e=t.children,i=e.indexOf(this)+1;if(IB.is(e[i]))return e[i];if(IB.is(t))return t.traverseSortNextHelper()}}sortNext(){let t=this.children;return this.children.length>0&&IB.is(this.children[0])?t[0]:this.traverseSortNextHelper()}goUp(t){let e=this;for(;t>0&&null!==e;)e=e.parent,t-=1;return e}hasAnccestorOrSelf(t){return this===t||this.hasAnccestor(t)}hasAnccestor(t){let e=this.parent;for(;e;){if(t===e)return!0;e=e.parent}return!1}countToAccestor(t){let e=0,i=this;for(;i!==t;){if(null===i)return-1;i=i.parent,e+=1}return e}forEachEntity(t){for(let e of this.children)KB(e)&&t(e)}traverseEntityAncestors(t){this.traverseAncestors((e=>{IB.is(e)&&t(e)}))}traverseConcreteEntity(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!0!==t(this,e))for(let i of this.children)KB(i)&&i.isConcreteEntity&&i.traverseEntity(t,e+1)}traverseEntity(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!0!==t(this,e))for(let i of this.children)KB(i)&&i.traverseEntity(t,e+1)}traverseVisibleEntity(t){t(this);for(let e of this.children)KB(e)&&e.visible&&e.traverseVisibleEntity(t)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}updateMatrixWorld(t){super.updateMatrixWorld(t),this.dispatchEvent({type:"updateMatrixWorld"})}copy(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return super.copy(t,e),this.dataPatched=t.dataPatched,this.raycastLock=t.raycastLock,this.scaleLock=t.scaleLock,this.hiddenMatrix.copy(t.hiddenMatrix),this}hasEntityChild(){return this.children.some((t=>KB(t)))}isAncestorOf(t){if(this.uuid===t)return!1;let e=!1;return this.traverseEntity((i=>{i.uuid===t&&(e=!0)})),e}toObjectTransformState(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.updateWorldMatrix(!0,!1);let e={position:this.position.toArray(),rotation:[this.rotation.x*Nf.RAD2DEG,this.rotation.y*Nf.RAD2DEG,this.rotation.z*Nf.RAD2DEG],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return ZP(e,t)}getTransformValues(t,e,i){return e[t].map(((e,n)=>i?.shared.getVariable(e,[this.uuid,t,JB[n]])??e))}updateTransformState(t,e){let i=!1;return t.position&&(this.position.fromArray(this.getTransformValues("position",t,e)),i=!0),t.rotation&&($B.fromArray(this.getTransformValues("rotation",t,e)).multiplyScalar(Nf.DEG2RAD),this.rotation.setFromVector3($B),i=!0),t.scale&&(this.scale.fromArray(this.getTransformValues("scale",t,e)),i=!0),void 0!==t.hiddenMatrix&&(i=!0,this.hiddenMatrix.fromArray(t.hiddenMatrix??PI.identity)),i&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors((t=>{t.invalidateClonerTransform(this)}))),t.position&&t.rotation&&t.scale&&void 0!==t.hiddenMatrix&&this.updateWorldMatrix(!1,!0),i}onVariableUpdate(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.resetBBoxNeedsUpdate():(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors((t=>{t.invalidateClonerTransform(this)})))}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let t of this.children)IB.is(t)&&t.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach((t=>{IB.is(t)&&t.disposeRecursively()}))}toState(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(t)};return ZP(e,t)}updateByObjUpdateOp(t,e){void 0!==t&&this.updateByOp({type:0,props:t,path:[]},{...this.data,...t},e,!1)}updateByOp(t,e,i,n){let r=this.data;this.data=e;let s=t,a=ED(t.path,["states","*"]);if(null!==a){if(0===t.type){let[e]=a;if(this?.stateSelection===e){let e={...t.props};if(delete e.name,Object.values(t.props).some((t=>void 0===t))){let i=this.data;if(void 0!==i){let n=yD.zoom(i,t.path.slice(2));if(n)for(let i in t.props)void 0===t.props[i]&&i in n&&(e[i]=n[i])}}s={...t,props:e,path:t.path.slice(2)}}}}else if(0===t.type){let e=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(void 0!==e){if(void 0!==t.props.name&&e.name){let{name:t,...i}=e;e=i}if(void 0!==t.props.material&&"material"in e){let{material:t,...i}=e;e=i}let i=yD.removeOverridden(t.path,t.props,e);s={...t,props:i}}}if(this.updateByPatchedOpBase(s,qR.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),i),ED(t.path,["overrides"])){let n=[],r=[...t.path];for(n.push(r[1]),r.splice(0,2);r.length>0&&"descendants"===r[0];)n.push(r[1]),r.splice(0,2);if(void 0===n[n.length-1]){if(0===t.type)for(let e of Object.keys(t.props)){n[n.length-1]=e;let r=i.scene.findInstance([this.uuid,...n]);r&&(r.overrideData=t.props[e],r.updateState(qT.apply(r.component.data,r.overrideData),i))}}else{let s=i.scene.findInstance([this.uuid,...n]);if(s){let a=yD.zoom(s.component.data,r);if(0===(t={...t,path:r}).type){let e=t.props;if(a)for(let[i,n]of Object.entries(t.props))void 0===n&&(e===t.props&&(e={...t.props}),e[i]=a[i]);t={...t,props:e}}s.overrideData=jR.resolve(e.overrides,n),s.updateByOp(t,QT.applySimple(s.data,t),i,!1)}}}else if(this.instances.length>0){let n;if(0===t.path.length&&0===t.type){let e;for(let i of GR.rootOverrideProps)i in t.props&&(void 0===e&&(e={}),e[i]=t.props[i]);e&&(n={...t,props:e})}else for(let e of GR.rootOverrideProps)if(ED(t.path,[e])){n=t;break}void 0!==n&&this.instances.forEach((t=>{if(t.isInstanceRoot){let e=qT.filterOp(t.overrideData,n);e&&t.updateByOp(e,QT.applySimple(t.data,e),i,!0)}})),this.instances.forEach((n=>{if(!n.isInstanceRoot){let s=qT.filterOp(n.overrideData,t);if(s){let a;a=r===n.data&&t===s?e:QT.applySimple(n.data,s),n.updateByOp(s,a,i,!0)}}}))}}updateByPatchedOpBase(t,e,i){if(this.dataPatched=e,0===t.path.length&&0===t.type)void 0!==t.props.type&&!NI.is(t.props.type)&&HB.changeEntityProptotype(this,e,i);else if(1===t.path.length&&"geometry"===t.path[0]&&0===t.type&&"type"in t.props){HB.changeEntityProptotype(this,e,i);for(let t of this.children)IB.is(t)&&t.updateVisible(i.scene)}this.updateByPatchedOp(t,e,i)}updateByPatchedOp(t,e,i){if(0===t.path.length&&0===t.type?this.updateState(t.props,i):0===t.type&&("resolutionLevel"in t.props||"useChildrenColors"in t.props)&&this.updateState(e,i),"morphTargetInfluences"===t.path[0]&&0===t.type){let n=e.morphTargetInfluences.get(t.path[1])?.data.name;n&&this.updateMorphInfluences(n,i.shared.getVariable(t.props.value,[this.uuid,"morphTargetInfluences",n]))}if(null!==ED(t.path,["pathSnapping"])&&this.updatePathSnapping(e.pathSnapping),null!==ED(t.path,["cloner"])){let n=QT.drop(t,1);0===n.path.length&&0===n.type&&!0===n.props.disabled?this.setFromClonerState(null,i):this.cloner?this.cloner.updateState(e.cloner,i.scene):(this.setFromClonerState(e.cloner,i),this.expandCloner(i.scene)),this.updateVisible(i.scene)}}updatePathSnapping(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.dataPatched.pathSnapping;this._updatedPathSnapping=t,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(t){let e=this._updatedPathSnapping?.pathId??this.dataPatched.pathSnapping.pathId,i=this._updatedPathSnapping?.slide??this.dataPatched.pathSnapping.slide??0,n=this._updatedPathSnapping?.offset??this.dataPatched.pathSnapping.offset??0,r=this._updatedPathSnapping?.orientation??this.dataPatched.pathSnapping.orientation;if(null===e)return;let s=t.find(e);if(!s||!1===this._needApplyPathSnapping)return;this._needApplyPathSnapping=!1;let a=s.data;if(a.geometry.path.points.length<=1)return;let o=QB(a.geometry.path),l=(i+n)%1;i+n===1&&0===l&&(l=1);let h=null;try{h=o.curves.length?o.getPointAt(l):null}catch(p){}if(null===h)return;let c=this.parent?this.parent?.matrixWorld:new Wm;s.updateMatrixWorld();let u=(new Wm).multiplyMatrices(c.clone().invert(),s.matrixWorld);h.applyMatrix4(u);let d={position:h.toArray(),rotation:a.rotation};if("tangential"===r){let t=(new Wm).extractRotation(s.matrixWorld),e=o.getTangentAt(l).applyMatrix4(t).add(h),i=(new Wm).lookAt(h,e,tz),n=$B.setFromEuler((new eg).setFromRotationMatrix(i)).multiplyScalar(Nf.RAD2DEG);d={...d,rotation:n.toArray()}}this.updateTransformState(d),this.traverseEntity((t=>{t._cameraType&&t.dispatchEvent(ZB)}))}updateVisible(t){if(this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||!0!==this.dataPatched.cloner?.hideBase),!t)return;let e=!1;this.traverseEntity((t=>{if("Splat"===t.data.type)return e=!0,!0})),e&&t.reloadSplats()}updateState_Entity(t,e){void 0!==t.name&&(this.name=t.name),void 0!==t.raycastLock&&(this.raycastLock=t.raycastLock),void 0!==t.visible&&(this.updateVisible(e?.scene),this.resetBBoxNeedsUpdate()),e&&"cloner"in t&&void 0!==t.cloner&&(this.setFromClonerState(t.cloner,e),this.updateVisible(e.scene)),this.updateTransformState(t,e)}get attachedSurfaceCloners(){return this.children.filter((t=>t instanceof HB.Cloner&&"toObject"===t.parameters.type))}setFromClonerState(t,e){this.disposed||(null===t||t.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):void 0===this.cloner?(this.cloner=new HB.Cloner(this,t),e.scene.addPendingExpandCloner(this)):this.cloner.updateState(t,e.scene))}expandCloner(t){!this.disposed&&this.cloner&&this.cloner.expandClones(t)}invalidateClonerTransform(t){this.cloner&&this.cloner.invalidateTransform(t)}requestRender(){this.dispatchEvent({type:"requestRender"})}},iz=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=t.parameters?.radiusTop,n=t.parameters?.radiusBottom,r=Object.assign({},e?.parameters??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},t.parameters);r.thetaLength=Nf.clamp(r.thetaLength,0,360);let s=r.width/2,a=r.radiusTop??s,o=r.radiusBottom??s;if(a===o?(a=s,o=s):a>o?(a=s,o=o*s/a):(a=a*s/o,o=s),r.shapeBlendNode){a=i??s,o=n??s;let t=2*Math.max(a,o);r.width=t,r.depth=t}return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width),radiusTop:a,radiusBottom:o})}}static build(t){let e,{width:i,depth:n,height:r,radialSegments:s,heightSegments:a,openEnded:o,thetaStart:l,thetaLength:h,radiusTop:c,radiusBottom:u,cornerRadius:d,cornerSegments:p,hollow:f}=t.parameters;return 0===h?(e=new Hg,e.setAttribute("position",new Bg([],3))):e=d||f?new sz(c,u,r,s,a,o,l,h*Math.PI/180,d,d,p,f):new $x(c,u,r,s,a,o,l,h*Math.PI/180),e.scale(1,1,n/i),Object.assign(e,{userData:{...t,type:"CylinderGeometry"}})}};function nz(t,e,i){i.x=t.x*e.x,i.y=t.y,i.z=t.x*e.y}function rz(t){return new Uf(t.y,-t.x)}var sz=class extends Hg{constructor(t,e,i,n,r,s,a,o,l,h,c,u){let d=arguments.length>12&&void 0!==arguments[12]&&arguments[12];super(),this.type="RoundedCylinderBufferGeometry",t=void 0!==t?t:1,e=void 0!==e?e:1,i=i||1,n=Math.floor(n)||8,r=Math.floor(r)||1,s=void 0!==s&&s,a=void 0!==a?a:0,o=void 0!==o?o:2*Math.PI,s&&(l=0,h=0);let p=[],f=[],m=[],g=[],v=0,y=i/2,b=new mm,x=new mm;d&&0==t&&(t=l),d&&0==e&&(e=h);let w=new Uf(t,y),S=new Uf(e,-y),A=null,E=null,_=null,C=null,M=w.clone().sub(S),P=0,T=0,D=0;u>0&&(P=Math.min(t,e)*(1-u),T=t-P,D=e-P);let k=w.clone();k.x-=P;let I=Math.PI-M.angle(),R=M.angle(),O=Math.tan(R/2),L=Math.tan(I/2),B=O+L,z=u?B:L,F=u?B:O;if(l=Math.min(l,(t-T)/z,M.length()/B),h=Math.min(h,(e-D)/F,M.length()/B),l>0){let t=l/O;A=w.clone().sub(new Uf(t,l)),u&&(_=A.clone(),_.x-=P-B*l),w.sub(M.clone().setLength(t))}if(h>0){let t=h/L;E=S.clone().sub(new Uf(t,-h)),S.add(M.clone().setLength(t)),u&&(C=E.clone(),C.x-=P-B*h,k.sub(M.clone().setLength(t)))}M=w.clone().sub(S);let N=M.length()<.5,U=[];for(let H=0;H<=n;H++){let c=[],d=H/n,p=d*o+a,y=new Uf(Math.sin(p),Math.cos(p));if(C&&E?(V(c,d,y,I,h,C,-1,!0),V(c,d,y,R,h,E,-1,!1)):E?(j(c,y,E.x,0,-1),V(c,d,y,R,h,E,-1,!1)):s||j(c,y,e,D,-1),nz(rz(M).normalize(),y,b),!N)for(let t=0;t<=r;t++){let e=t/r;nz(M.clone().multiplyScalar(e).add(S),y,x),f.push(x.x,x.y,x.z),m.push(b.x,b.y,b.z),g.push(d,.5+x.y/i),c.push(v++)}if(_&&A?(V(c,d,y,I,l,A,1,!1),V(c,d,y,R,l,_,1,!0)):A?(V(c,d,y,I,l,A,1,!1),j(c,y,A.x,0,1)):s||j(c,y,t,T,1),u&&!N){nz(rz(M).multiplyScalar(-1).normalize(),y,b);for(let t=0;t<=r;t++){let e=t/r;nz(M.clone().multiplyScalar(-e).add(k),y,x),f.push(x.x,x.y,x.z),m.push(b.x,b.y,b.z),g.push(d,.5+x.y/i),c.push(v++)}}u&&!s&&c.push(c[0]),U.push(c)}for(let H=0;H<U.length-1;H++)for(let t=0;t<U[0].length-1;t++){if(s&&u&&t==r)continue;let e=U[H][t],i=U[H+1][t],n=U[H+1][t+1],a=U[H][t+1],o=f[3*n+0],l=f[3*n+2];p.push(e,i,a),(0!=o||0!=l)&&p.push(i,n,a)}function V(t,e,n,r,s,a,o,l){for(let h=0;h<c+1;h++){let u=h/c,d=o<0?u:1-u;l&&(d-=1),d*=r;let p=new Uf(Math.sin(d),Math.cos(d)*o);nz(p.clone().multiplyScalar(s).add(a),n,x),f.push(x.x,x.y,x.z),nz(p,n,b),m.push(b.x,b.y,b.z),g.push(e,.5+x.y/i),t.push(v++)}}function j(t,e,i,n,r){let s=new mm,a=new Uf,o=[i,n];r<0&&o.reverse();for(let l of o)a.set(l,y*r),nz(a,e,s),f.push(s.x,s.y,s.z),m.push(0,r,0),g.push(.5,.5),t.push(v++)}function G(i,n,r){let s=new Uf(Math.sin(r),Math.cos(r)),a=new Uf(-Math.cos(r),Math.sin(r)),o=new mm,l=i<0?(t,e,i)=>p.push(t,e,i):(t,e,i)=>p.push(t,i,e);nz(new Uf((t+e+T+D)/4,0),s,o),f.push(o.x,o.y,o.z),m.push(a.x,0,a.y),g.push(.5,.5);let h=v++;for(let t of n){let e=f.slice(3*t,3*t+3);f.push(...e),m.push(a.x,0,a.y);let i=g.slice(2*t,2*t+2);g.push(...i),v++}for(let t=h+1;t<v-1;t++)l(h,t,t+1);l(h,v-1,h+1)}o<2*Math.PI&&(G(-1,U[0],a),G(1,U[U.length-1],a+o)),this.setIndex(p),this.setAttribute("position",new Bg(f,3)),this.setAttribute("normal",new Bg(m,3)),this.setAttribute("uv",new Bg(g,2))}},az=Math.PI/2,oz=class extends Hg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:4;super(),this.type="BoxGeometry",n=Math.floor(n),r=Math.floor(r),s=Math.floor(s),o=Math.floor(o),a=Math.min(a,t/2,e/2,i/2);let l=[],h=[],c=[],u=[],d=0;function p(t,e,i,n,r,s,o,p,f,m){let g=(s-2*a)/f,v=(o-2*a)/m,y=s/2-a,b=o/2-a,x=p/2,w=f+1,S=m+1,A=0,E=new mm;for(let a=0;a<S;a++){let s=a*v-b;for(let o=0;o<w;o++){let l=o*g-y;E[t]=l*n,E[e]=s*r,E[i]=x,h.push(E.x,E.y,E.z),E[t]=0,E[e]=0,E[i]=p>0?1:-1,c.push(E.x,E.y,E.z),u.push(o/f),u.push(1-a/m),A+=1}}for(let a=0;a<m;a++)for(let t=0;t<f;t++){let e=d+t+w*a,i=d+t+w*(a+1),n=d+(t+1)+w*(a+1),r=d+(t+1)+w*a;l.push(e,i,r),l.push(i,n,r)}d+=A}function f(t,e,i,n,r,s,p,f,m,g){let v=(p-2*a)/g,y=p/2-a,b=f/2-a,x=m/2,w=g+1,S=0,A=new mm,E=new mm;for(let l=0;l<o+1;l++){let d=l/o*az,p=Math.sin(d)*a,f=(1-Math.cos(d))*a,m=Math.sin(d),_=Math.cos(d);A[e]=(b+p)*r,A[i]=(x-f)*s,E[t]=0,E[e]=m*Math.sign(A[e]),E[i]=_*Math.sign(A[i]);for(let e=0;e<w;e++){let i=e*v-y;A[t]=i*n,h.push(A.x,A.y,A.z),c.push(E.x,E.y,E.z),u.push(e/g),u.push(0),S+=1}}for(let a=0;a<o;a++)for(let t=0;t<g;t++){let e=d+t+w*a,i=d+t+w*(a+1),n=d+(t+1)+w*(a+1),r=d+(t+1)+w*a;l.push(e,i,r),l.push(i,n,r)}d+=S}function m(n,r,s){let p=new mm,f=new mm(t/2,e/2,i/2);f.subScalar(a);let m=[],g=n*r*s>0?(t,e,i)=>l.push(t,e,i):(t,e,i)=>l.push(t,i,e);for(let t=0;t<=o;t++){let e=[],i=az*(1-t/o),l=Math.cos(i),g=Math.sin(i),v=0;for(let o=0;o<=t;o++){let i=Math.cos(v),o=Math.sin(v);p.x=l*i,p.y=g,p.z=l*o;let m=f.clone().addScaledVector(p,a);h.push(n*m.x,r*m.y,s*m.z),c.push(n*p.x,r*p.y,s*p.z),u.push(0,0),e.push(d++),v+=az/t}m.push(e)}let v=m.length-1;for(let t=0;t<v;t++){let e=m[t],i=m[t+1],n=e.length-1;g(e[0],i[1],i[0]);for(let t=1;t<=n;t++)g(e[t-1],e[t],i[t]),g(e[t],i[t+1],i[t])}}p("z","y","x",-1,-1,i,e,t,s,r),p("z","y","x",1,-1,i,e,-t,s,r),p("x","z","y",1,1,t,i,e,n,s),p("x","z","y",1,-1,t,i,-e,n,s),p("x","y","z",1,-1,t,e,i,n,r),p("x","y","z",-1,-1,t,e,-i,n,r),a>0&&(f("z","y","x",-1,-1,1,i,e,t,s),f("z","y","x",1,-1,-1,i,e,t,s),f("z","y","x",-1,1,-1,i,e,t,s),f("z","y","x",1,1,1,i,e,t,s),f("x","y","z",-1,-1,-1,t,e,i,n),f("x","y","z",1,-1,1,t,e,i,n),f("x","y","z",-1,1,1,t,e,i,n),f("x","y","z",1,1,-1,t,e,i,n),f("y","x","z",-1,-1,1,e,t,i,r),f("y","x","z",1,-1,-1,e,t,i,r),f("y","x","z",1,1,1,e,t,i,r),f("y","x","z",-1,1,-1,e,t,i,r),m(1,1,1),m(-1,1,1),m(1,-1,1),m(-1,-1,1),m(1,1,-1),m(-1,1,-1),m(1,-1,-1),m(-1,-1,-1)),this.setIndex(l),this.setAttribute("position",new Bg(h,3)),this.setAttribute("normal",new Bg(c,3)),this.setAttribute("uv",new Bg(u,2))}},lz=class extends Hg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.2,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:4;super(),this.type="PolyhedronGeometryRound";let a=[],o=[],l=[];return function(){r=Math.min(.99999,r),0==r&&(s=0);let o={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[i],h=new mm,c=h.clone(),u=new Mg,d=r*n,p=n-d,f=s+1,m=new mm,g=(t,e)=>m.subVectors(t,e).normalize(),v=(t,e)=>Array(t).fill(void 0).map(e),y=v(t.length/3,((e,i)=>(new mm).fromArray(t,3*i).setLength(n))),b=[],x=1e6;for(let t=0;t<y.length;t++){let i,n,r,s=y[t],a=[],o=1e10,l=-1;for(;-1!=(l=e.indexOf(t,l+1));){let t=l-l%3;i=e[t+(l+1)%3],n=e[t+(l+2)%3],r=s.distanceToSquared(y[i]),o=Math.min(o,r),a.push([i,n,r])}o+=1e-6;let h=[],c=0,u=a.length;for(let e=0;e<u;e++){[i,n,r]=a[c];let e=1==b[i]?.includes(t);r<=o&&h.push(i+ +e*x),c=a.findIndex((t=>t[0]==n))}b.push(h)}let w=[];{let t,e,i=0,n=0,r=3==o;for(let a=0;a<=s;a++){t=a*(a+1)/2,e=(a+1)*(a+2)/2;for(let o=0;o<s-a;o++)[i,n]=[t+o+a+2,e+o+a+3],w.push(t,e,...r?[n,t]:[i,e],n,i),[t,e]=[i,n];w.push(t,e,t+s+2)}}let S=h.clone(),A=h.clone(),E=h.clone(),_=h.clone(),C=h.clone(),M=[],P=v(y.length,(()=>v(o,(()=>h.clone()))));for(let t=0;t<y.length;t++){h.copy(y[t]).normalize(),S.copy(h).multiplyScalar(p);let e=b[t];for(let s=0;s<e.length;s++){let i=e[s],n=e[(s+1)%o];u.setFromPointsAndIndices(y,t,i%x,n%x),u.b.sub(u.a).setLength(1e10).add(u.a),u.c.sub(u.a).setLength(1e10).add(u.a),u.closestPointToPoint(S,P[t][s])}let i=[],n=[],r=[],v=new mm;0==s&&[...P[t]].reduce(((t,e)=>t.add(e)),v).multiplyScalar(1/o);for(let a=0;a<o;a++){let e=[],l=(a-1+o)%o,u=P[t][l],y=P[t][a];h.copy(u).sub(S),c.copy(y).sub(S);let b=S.angleTo(h),x=h.angleTo(c),w=Math.cos(b)*d;0==s?A.copy(v):A.copy(S).setLength(p+w),n.push(w);let M=[A,u,y];for(let t=0;t<2;t++){let n=M[t],r=M[t+1];_.subVectors(n,S),C.subVectors(r,S),E.crossVectors(_,C).normalize();for(let s=0;s<f;s++){let r=[b,x][t]*s/f;h.copy(_).applyAxisAngle(E,r).add(S),i.push(h.clone()),t&&(g(h,S),e.push([0==s?n:h.clone(),m.clone()]))}t&&(g(r,S),e.push([r,m.clone()]))}r.push(e)}M.push(r);let T=2*f,D=2;for(let t=0;t<o;t++){let e=T*t,r=T*((t+1)%o),s=[i[e]];for(let a=1;a<f;a++){_=i[e+a],C=i[r+a],s.push(_);for(let e=1,i=a-D+1;e<=i;e++)h.lerpVectors(_,C,e/(i+1)),h.sub(S).setLength(n[t]).add(S),s.push(h.clone());s.push(C)}for(let t=0;t<f;t++)s.push(i[t+f+e]);s.push(i[r+f]);let c=w.map((t=>s[t]));a.push(...c.map((t=>[t.x,t.y,t.z])).flat()),l.push(...c.map((t=>(g(t,S),[m.x,m.y,m.z]))).flat())}}let T=[];for(let t=0;t<b.length;t++)for(let e=0;e<o;e++){let i=b[t][e];if(i<x){let n=b[i].findIndex((e=>e%x==t)),r=M[t][e],s=M[i][n];for(let t=0;t<f;t++){let e=r[t],i=s[f-t],n=r[t+1];[e,i,n,n,i,s[f-(t+1)]].forEach((t=>{a.push(t[0].x,t[0].y,t[0].z),l.push(t[1].x,t[1].y,t[1].z)}))}T.push(r[0][0],s[f][0],r[f][0],s[0][0])}}for(;T.length;){let t,e,i,n;[t,e]=T.splice(0,2);let r=[t];for(;t!=e;)r.push(e),i=T.indexOf(e),n=i%2,e=T.splice(i-n,2)[1-n];m.subVectors(r[0],r[1]).cross(h.subVectors(r[0],r[2])).normalize();let s=m.dot(r[0])<0;s&&m.negate();for(let o=1;o<=r.length-2;o++)[r[o+ +s],r[o+1-+s],r[0]].forEach((t=>{a.push(t.x,t.y,t.z),l.push(m.x,m.y,m.z)}))}}(),function(){let t=new mm;for(let p=0;p<a.length;p+=3){t.x=a[p+0],t.y=a[p+1],t.z=a[p+2];let e=u(t)/2/Math.PI+.5,i=d(t)/Math.PI+.5;o.push(e,1-i)}let e=new mm,i=new mm,n=new mm,r=new mm,s=new Uf,l=new Uf,h=new Uf,c=(t,e,i,n)=>{n<0&&1===t.x&&(o[e]=t.x-1),0===i.x&&0===i.z&&(o[e]=n/2/Math.PI+.5)};for(let p=0,f=0;p<a.length;p+=9,f+=6){e.set(a[p+0],a[p+1],a[p+2]),i.set(a[p+3],a[p+4],a[p+5]),n.set(a[p+6],a[p+7],a[p+8]),s.set(o[f+0],o[f+1]),l.set(o[f+2],o[f+3]),h.set(o[f+4],o[f+5]),r.copy(e).add(i).add(n).divideScalar(3);let t=u(r);c(s,f+0,e,t),c(l,f+2,i,t),c(h,f+4,n,t)}for(let a=0;a<o.length;a+=6){let t=o[a+0],e=o[a+2],i=o[a+4],n=Math.max(t,e,i),r=Math.min(t,e,i);n>.9&&r<.1&&(t<.2&&(o[a+0]+=1),e<.2&&(o[a+2]+=1),i<.2&&(o[a+4]+=1))}function u(t){return Math.atan2(t.z,-t.x)}function d(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}}(),this.setAttribute("position",new Bg(a,3)),this.setAttribute("normal",new Bg(l,3)),void this.setAttribute("uv",new Bg(o,2))}static fromJSON(t){return new lz(t.vertices,t.indices,t.radius,t.corner,t.cornerSides)}},hz=class extends lz{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,n=(1+Math.sqrt(5))/2,r=1/n,s="DodecahedronGeometry";super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],s,t,e,i),this.type=s}static fromJSON(t){return new hz(t.radius,t.corner,t.cornerSides)}},cz=1e-12,uz=class{constructor(t){this.position=new Uf,this.startPosition=new Uf,this.uuid=Nf.generateUUID(),this.position=t.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(t){this.position.copy(this.startPosition).add(t)}copy(t){return this.position.copy(t.position),this.startPosition.copy(t.startPosition),this}clone(){return new uz(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},dz=class extends uz{constructor(t){super(t.position),this.parent=t}copy(t){return super.copy(t),this}clone(){return new dz(this.parent).copy(this)}},pz=class extends uz{constructor(t,e){super(e),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=t,this.controls.push(new dz(this),new dz(this))}static create(t,e){let i=new pz(t,new Uf(...e.position));return i.controls[0].position.set(...e.controlPrevious.position),i.controls[1].position.set(...e.controlNext.position),i.roundness=e.roundness,i.areControlsDirectionsMirrored=e.areControlsDirectionsMirrored,i}getOppositeControl(t){let e=this.controls.indexOf(t);return 0===e?this.controls[1]:1===e?this.controls[0]:null}applyOffsetToControls(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;for(let i=0,n=this.controls.length;i<n;i++){let n=this.controls[i];this.position.distanceTo(n.position)<=e?n.position.copy(this.position):n.applyOffset(t)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(t){return super.copy(t),this.controls[0].copy(t.controls[0]),this.controls[1].copy(t.controls[1]),this.roundness=t.roundness,this.uuid=t.uuid,this}clone(){return new pz(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){let t=this.curveBefore?.getTangentAt(1),e=this.curveAfter?.getTangentAt(0);return[t,e]}computeNormals(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uf,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Uf,[i,n]=this.computeTangents();return i&&n&&(fz(i,t),fz(n,e)),[t,e]}computeTangent(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uf,[e,i]=this.computeTangents();return e&&i&&t.copy(e).add(i).normalize(),t}computeNormal(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uf,[e,i]=this.computeNormals();return t.copy(e).add(i).normalize(),t}};function fz(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Uf,i=t.length();return e.set(-t.y/i,t.x/i)}var mz=new Uf,gz=new Uf,vz=new Uf,yz=new Uf,bz=new Uf,xz=new Uf,wz=new mm,Sz=new mm;function Az(t){let e=new Uf;e.addVectors(t.v0,mz.subVectors(t.v1,t.v0).multiplyScalar(2/3));let i=new Uf;return i.addVectors(t.v2,gz.subVectors(t.v1,t.v2).multiplyScalar(2/3)),new Gx(t.v0,e,i,t.v2)}function Ez(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.EPSILON;return Math.abs(t-e)<i}function _z(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.EPSILON;return t.distanceTo(e)<i}function Cz(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.EPSILON;return t.distanceTo(e)<i}function Mz(t,e,i){let n=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),r=Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2)),s=Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2));return Math.acos((r*r+n*n-s*s)/(2*r*n))}function Pz(t,e,i){return Oz(t,e)&&Oz(e,i)&&Tz(t.position,e.position,i.position)}function Tz(t,e,i){return 0===mz.copy(e).sub(t).cross(gz.copy(i).sub(t))}function Dz(t,e,i,n,r){let s=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),a=(t.y+e.y)/2,o=(t.x+e.x)/2,l=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(t.y-e.y)/s,h=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(e.x-t.x)/s;return n.set(o+l,a+h),r.set(o-l,a-h),[n,r]}function kz(t,e,i){return t.distanceTo(i)<e.distanceTo(i)?e:t}function Iz(t,e,i,n,r,s){let a,o=e.x-t.x,l=e.y-t.y,h=i.x-t.x,c=i.y-t.y,u=Math.sqrt((o+h)*(o+h)+(l+c)*(l+c));return Mz(e,t,i)>Math.PI&&(u*=-1),a=Ez(c,l)?(l+c)*(n/u-.5)*8/3/(o-h):(o+h)*(n/u-.5)*8/3/(c-l),r.set(e.x-a*l,e.y+a*o),s.set(i.x+a*c,i.y-a*h),[r,s]}function Rz(t,e){return t.position.equals(t.controls[1].position)&&e.position.equals(e.controls[0].position)}function Oz(t,e){return Tz(t.position,t.controls[1].position,e.position)&&Tz(t.position,e.controls[0].position,e.position)}function Lz(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=[];for(let r=0,s=t.length;r<s;r++){let s=t[r],a=0;if(i&&void 0!==s.roundedCurveCorner){let t=.5*Bz(s.roundedCurveCorner,e);r>0&&(n[r-1]+=t),a+=t}void 0!==s.curveAfter&&(a+=Bz(s.curveAfter,e)),n.push(a)}return t.length>0&&i&&void 0!==t[0].roundedCurveCorner&&(n[t.length-1]+=.5*Bz(t[0].roundedCurveCorner,e)),n}function Bz(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;return t&&t instanceof Ox?2*e:t&&(t instanceof Wx||t instanceof qx)?1:t&&t instanceof Xx?e*t.points.length:e}var zz,Fz,Nz,Uz=new Uf,Vz=new Uf,jz=new Uf,Gz=new Uf,Hz=new Uf,Wz=new Uf,qz=class extends nw{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;super(),this.points=[],this.shapeHoles=[],this.plane=new wv(new mm(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this.isText=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=Nf.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=t,this._height=e}static createFromState(t,e,i){let n=new qz;return n.isClosed=t.isClosed,n.points=t.points.map((t=>pz.create(t.id,t.data))),"number"==typeof t.roundness&&(n.roundness=t.roundness),n.shapeHoles=t.shapeHoles.map((t=>qz.createFromState(t))),void 0!==e&&void 0!==i&&n.applySize(e,i),n.update(),n}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(t){if(this._roundness!==t){this._roundness=t;for(let e=0,i=this.points.length;e<i;e++)this.points[e].roundness=t;this.needsUpdate=!0}}getPointsIndexesByIds(t){return t.map((t=>this.getPointIndexById(t))).filter((t=>t>=0))}getPointIndexById(t){let e=this.points.length,i=this.points.findIndex((e=>e.uuid===t));if(i<0){let i=e;for(let e=0,n=this.shapeHoles.length;e<n;e++){let n=this.shapeHoles[e],r=n.points.length,s=n.getPointIndexById(t);if(!(s<0))return s+i;i+=r}}return i}getLineIndexById(t){return this.getPointIndexById(t)}getBezierPoint(t){if(t<=this.points.length-1)return this.points[t];if(this.shapeHoles.length>0){let e=this.points.length;for(let i=0,n=this.shapeHoles.length;i<n;i++){let n=this.shapeHoles[i],r=t-e;if(r<=n.points.length-1)return n.points[r];e+=n.points.length}}throw new Error("This shape does not have a point for this index: "+t)}getBezierPointIndex(t){let e=this.points.indexOf(t);if(e>=0)return e;if(e=this.points.length,this.shapeHoles.length>0)for(let i=0,n=this.shapeHoles.length;i<n;i++){let n=this.shapeHoles[i],r=n.points.indexOf(t);if(r>=0)return e+r;e+=n.points.length}return-1}getAllPoints(){let t=[].concat(...this.shapeHoles.map((t=>t.points)));return[...this.points,...t]}applySize(t,e){0===t&&(t=.001),0===e&&(e=.001),this._width=t,this._height=e}applyScale(t,e){let i=Uz.set(t,e);for(let n=0,r=this.points.length;n<r;n++){let t=this.points[n];t.position.multiply(i),t.controls[0].position.multiply(i),t.controls[1].position.multiply(i)}for(let n=0,r=this.shapeHoles.length;n<r;n++)this.shapeHoles[n].applyScale(t,e);this._update()}createPoint(t){let e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Nf.generateUUID();e=t instanceof Uf?t:new Uf(t,i);let r=new pz(n,e);return r.roundness=this.roundness,r}addPoint(t){this.points.push(t),this.needsUpdate=!0}addPointAt(t,e){this.points.splice(e,0,t),this.needsUpdate=!0}getPointByUuid(t){for(let e=0,i=this.points.length;e<i;e++){let i=this.points[e];if(i.uuid===t)return i}for(let e=0,i=this.shapeHoles.length;e<i;e++){let i=this.shapeHoles[e].getPointByUuid(t);if(i)return i}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(t){let e=this.points.indexOf(t);e>=0&&this.points.splice(e,1),this.needsUpdate=!0}removePointById(t){let e=this.points.find((e=>e.uuid===t));e&&this.removePoint(e)}update(){for(let t=0,e=this.shapeHoles.length;t<e;t++)this.shapeHoles[t].update();this._update()}extractShapePointsToBuffer(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.subdivision=e,void 0===this.curveDivisions&&this.computeCurveDivisions(e);let n=i?this.roundedCurveDivisions:this.curveDivisions;return function(t,e){let i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=Sz.set(0,0,0),a=0,o=[];for(let l=0;l<e.length;l++){let r=e[l],h=mz,c=Bz(r,n);o.push(c);for(let e=0;e<=c;e++)if(r instanceof Gx||r instanceof Yx||r instanceof Wx){if(r.getPoint(e/c,h),s.set(h.x,h.y,0),void 0!==i&&Cz(i,s))continue;void 0===i&&(i=wz),i.copy(s),t.setXYZ(a,s.x,s.y,s.z),a++}}r&&a>1&&!(t.getX(a-1)===t.getX(0)&&t.getY(a-1)===t.getY(0)&&t.getZ(a-1)===t.getZ(0))&&(t.setXYZ(a,t.getX(0),t.getY(0),t.getZ(0)),a++)}(t,i?this.roundedCurves:this.curves,e,this.autoClose),n.reduce(((t,e)=>t+e),0)+1}computeCurveDivisions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;return this.curveDivisions=Lz(this.points,t,!1),this.roundedCurveDivisions=Lz(this.points,t,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12;return 2*function(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=Sz.set(0,0,0),a=0,o=[];for(let l=0;l<e.length;l++){if(!1===i[l])continue;let r,h=e[l],c=mz,u=Bz(h,n);o.push(u);for(let e=0;e<=u;e++)if(h instanceof Gx||h instanceof Yx||h instanceof Wx){if(h.getPoint(e/u,c),s.set(c.x,c.y,0),r?.equals(s))continue;void 0===r?r=wz:(t.setXYZ(a,r.x,r.y,r.z),a++,t.setXYZ(a,s.x,s.y,s.z),a++),r.copy(s)}}return r&&a>1&&!(t.getX(a-1)===t.getX(0)&&t.getY(a-1)===t.getY(0)&&t.getZ(a-1)===t.getZ(0))&&(t.setXYZ(a,t.getX(0),t.getY(0),t.getZ(0)),a++),o}(t,this.curves,e,i,this.autoClose).reduce(((t,e)=>t+e),0)}extractShapePointsToFlatArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;return this.subdivision=e,void 0===this.curveDivisions&&this.computeCurveDivisions(e),function(t,e){let i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=0;for(let a=0;a<e.length;a++){let r=e[a],o=Bz(r,n),l=mz;for(let e=0;e<=o;e++)if(r instanceof Gx||r instanceof Yx||r instanceof Wx){if(r.getPoint(e/o,l),void 0!==i&&_z(i,l,cz))continue;void 0===i&&(i=gz),i.copy(l),t.push(l.x,l.y),s++}}return Ez(t[0],t[t.length-2],cz)&&Ez(t[1],t[t.length-1],cz)&&(t.pop(),t.pop()),r&&s>1&&!(Ez(t[s-1],t[1],cz)&&Ez(t[s-2],t[0],cz))&&(t.push(t[0],t[1]),s++),t}(t,this.roundedCurves,e,this.autoClose)}getCurveIndexFromVertexId(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=0;void 0===this.curveDivisions&&this.computeCurveDivisions(this.subdivision);let n=e?this.roundedCurveDivisions:this.curveDivisions,r=0;e&&void 0!==this.points[0].roundedCurveCorner&&(r=.5*Bz(this.points[0].roundedCurveCorner,this.subdivision));let s=t-r;s<0&&(s+=n.reduce(((t,e)=>t+e),0));for(let a=0,o=n.length;a<o;a++){let t=n[a];if(s<i+t)return[a,(s-i+1)/t];i+=t}return[0,1]}getCurveT(t,e,i){let n=this.points[t],r=this.points[t>=this.points.length-1?0:t+1],s=this.curveDivisions,a=s[t];if(Rz(n,r)){let t=n.position.distanceTo(r.position);return n.position.distanceTo(Uz.set(i.x,i.y))/t}let o=0;for(let l=0;l<t;l++)o+=s[l];return(e-o)/a}dispose(){}_applyCurveForPoint(t,e){Rz(e,t)?this.lineTo(t.position.x,t.position.y):this.bezierCurveTo(e.controls[1].position.x,e.controls[1].position.y,t.controls[0].position.x,t.controls[0].position.y,t.position.x,t.position.y);let i=this.curves[this.curves.length-1];t.curveBefore=i,e.curveAfter=i;let n=i.clone();t.roundedCurveBefore=n,e.roundedCurveAfter=n,t.roundedCurveCorner=void 0,this.roundedCurves.push(n)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let e=0,i=this.points.length;e<i;e++){let t=this.points[e];if(0===e)this.moveTo(t.position.x,t.position.y);else{let i=this.points[e-1];this._applyCurveForPoint(t,i)}}let t=this.getLastPoint();if(t?.curveAfter&&(t.curveAfter=void 0),this.isClosed){let t=this.points[0],e=this.points[this.points.length-1];this._applyCurveForPoint(t,e)}if(this.points.length>2){let t=0;for(let e=0,i=this.points.length;e<i;e++){let i=this.points[e],n=this.points[e-1]??this.points[this.points.length-1],r=this.points[e+1]??this.points[0],s=i.roundness,a=n&&r&&Pz(n,i,r);if(!i.controlsMoved()&&s>0&&!a){let n=i.curveBefore,r=i.curveAfter;if(void 0===n||void 0===r)continue;let a,o=i.roundedCurveBefore,l=i.roundedCurveAfter,h=n.getLength(),c=r.getLength(),u=Math.min(s,.499*h),d=Math.min(s,.499*c),p=Math.min(u,d),f=1-p/h,m=p/c,g=n.getPointAt(f,Uz),v=r.getPointAt(m,Vz);if(this._subSplitCurve(n,o,f,g,void 0),this._subSplitCurve(r,l,m,void 0,v),this.useCubicForRoundedCorners){let t=Mz(g,i.position,v)/2,e=Math.tan(t)*g.distanceTo(i.position),[n,r]=Dz(g,v,e,jz,Gz),s=kz(n,r,i.position),[o,l]=Iz(s,g,v,e,Hz,Wz);a=new Gx(g.clone(),o.clone(),l.clone(),v.clone())}else a=new Yx(g.clone(),i.position.clone(),v.clone());i.roundedCurveCorner=a,this.roundedCurves.splice(e+t,0,a),t++}}}}_subSplitCurve(t,e,i,n,r){if(!(t instanceof Wx)){let s=t,a=e,o=s.getUtoTmapping(i,0),l=function(t,e,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,s=mz.subVectors(e,t).multiplyScalar(r).add(t),a=gz.subVectors(i,e).multiplyScalar(r).add(e),o=vz.subVectors(n,i).multiplyScalar(r).add(i),l=s,h=yz.subVectors(a,s).multiplyScalar(r).add(s),c=bz.subVectors(o,a).multiplyScalar(r).add(a),u=o,d=xz.subVectors(c,h).multiplyScalar(r).add(h);return[t.x,t.y,l.x,l.y,h.x,h.y,d.x,d.y,c.x,c.y,u.x,u.y,n.x,n.y]}(s.v0,s.v1,s.v2,s.v3,o);return void 0!==n&&(a.v0.set(l[0],l[1]),a.v1.set(l[2],l[3]),a.v2.set(l[4],l[5]),a.v3.set(l[6],l[7])),void 0!==r&&(a.v0.set(l[6],l[7]),a.v1.set(l[8],l[9]),a.v2.set(l[10],l[11]),a.v3.set(l[12],l[13])),a}return void 0!==n&&e.v2.copy(n),void 0!==r&&e.v1.copy(r),e}clone(){let t=new qz(this._width,this._height);return t.points=this.points.map((t=>t.clone())),t.isClosed=this.isClosed,t.roundness=this.roundness,t.isMesh2D=this.isMesh2D,t.shapeHoles=this.shapeHoles.map((t=>t.clone())),t}toJSON(){return{points:this.points.reduce(((t,e)=>t.concat(e.toJSON())),[]),shapeHoles:this.shapeHoles.map((t=>t.toJSON())),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(t){this.points=[],this.pointIDs=0;let e=t.points.length/7;for(let i=0;i<e;i++){let e=7*i,n=t.points[e+0],r=t.points[e+1],s=t.points[e+2],a=t.points[e+3],o=t.points[e+4],l=t.points[e+5],h=t.points[e+6],c=new pz(Nf.generateUUID(),new Uf(n,r));c.controls[0].position.set(s,a),c.controls[1].position.set(o,l),c.roundness=h,this.points.push(c)}return this.shapeHoles=t.shapeHoles?.length?t.shapeHoles.map((t=>{let e=new qz;return e.fromJSON(t),e})):[],this.isClosed=t.isClosed,this._roundness=t.roundness,this._update(),this}fromShape(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.isText=e;let i=(t,e)=>{e instanceof Gx&&e.v3.equals(t.position)&&t.controls[0].position.copy(e.v2)};return this.points=(t=>{let e,n,r=[];for(e=0,n=t.length;e<n;e++)t[e]instanceof Yx&&(t[e]=Az(t[e]));for(e=0,n=t.length;e<n;e++){let n,s=t[e],a=e>0?t[e-1]:null;s instanceof Gx?(n=this.createPoint(s.v0),n.controls[1].position.copy(s.v1)):s instanceof Wx&&(n=this.createPoint(s.v1)),void 0!==n&&(null!==a&&i(n,a),r.push(n))}let s=t[t.length-1],a=!1;return s instanceof Gx?s.v3.equals(r[0].position)&&(r[0].controls[0].position.copy(s.v2),a=!0):s instanceof Wx&&s.v2.equals(r[0].position)&&(a=!0),this.isClosed=a,r})(t.curves),t instanceof nw&&(this.shapeHoles=t.holes.map((t=>{let e=new qz;return e.fromShape(t),e}))),this.update(),this}updatePoint(t,e){let i=this.getPointByUuid(t);i&&(void 0!==e.position&&i.position.fromArray(e.position),void 0!==e.roundness&&(i.roundness=e.roundness),void 0!==e.areControlsDirectionsMirrored&&(i.areControlsDirectionsMirrored=e.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(t,e){let i=this.getPointByUuid(t)?.controls[0];i&&(e.position&&i.position.fromArray(e.position),this.needsUpdate=!0)}updateNextControl(t,e){let i=this.getPointByUuid(t)?.controls[1];i&&(e.position&&i.position.fromArray(e.position),this.needsUpdate=!0)}},Yz=2*Math.PI;function Xz(t,e,i,n,r){let{x:s,y:a}=t;return{x:s*e+n,y:a*i+r}}function Qz(t,e){let i=1.5707963267948966===e?.551915024494:-1.5707963267948966===e?-.551915024494:1.3333333333333333*Math.tan(e/4),n=Math.cos(t),r=Math.sin(t),s=Math.cos(t+e),a=Math.sin(t+e);return[{x:n-r*i,y:r+n*i},{x:s+a*i,y:a-s*i},{x:s,y:a}]}function Kz(t,e,i,n){let r=t*n-e*i<0?-1:1,s=Math.min(1,Math.max(-1,t*i+e*n));return r*Math.acos(s)}function Zz(t){let{px:e,py:i,cx:n,cy:r,rx:s,ry:a,largeArcFlag:o,sweepFlag:l}=t,h=[];if(0===s||0===a)return[];let c=(e-n)/2,u=(i-r)/2;if(0===c&&0===u)return[];s=Math.abs(s),a=Math.abs(a);let d=Math.pow(c,2)/Math.pow(s,2)+Math.pow(u,2)/Math.pow(a,2);d>1&&(s*=Math.sqrt(d),a*=Math.sqrt(d));let p=function(t,e,i,n,r,s,a,o,l,h){let c=Math.pow(r,2),u=Math.pow(s,2),d=Math.pow(a,2),p=Math.pow(o,2),f=c*u-c*p-u*d;f<0&&(f=0),f/=c*p+u*d,f=Math.sqrt(f)*(l===h?-1:1);let m=f*r/s*o,g=f*-s/r*a,v=m+(t+i)/2,y=g+(e+n)/2,b=(a-m)/r,x=(o-g)/s,w=(-a-m)/r,S=(-o-g)/s,A=Kz(1,0,b,x),E=Kz(b,x,w,S);return!h&&E>0&&(E-=Yz),h&&E<0&&(E+=Yz),{centerx:v,centery:y,ang1:A,ang2:E}}(e,i,n,r,s,a,c,u,o,l),{ang1:f,ang2:m}=p,{centerx:g,centery:v}=p,y=Math.abs(m)/(Yz/4);Math.abs(1-y)<1e-7&&(y=1);let b=Math.max(Math.ceil(y),1);m/=b;for(let x=0;x<b;x++)h.push(Qz(f,m)),f+=m;return h.map((t=>{let{x:e,y:i}=Xz(t[0],s,a,g,v),{x:n,y:r}=Xz(t[1],s,a,g,v),{x:o,y:l}=Xz(t[2],s,a,g,v);return{x1:e,y1:i,x2:n,y2:r,x:o,y:l}}))}function Jz(t,e){if(!t)throw e||"Assertion Failed!"}(Fz=zz||(zz={}))[Fz.ODD=0]="ODD",Fz[Fz.NONZERO=1]="NONZERO",Fz[Fz.POSITIVE=2]="POSITIVE",Fz[Fz.NEGATIVE=3]="NEGATIVE",Fz[Fz.ABS_GEQ_TWO=4]="ABS_GEQ_TWO",function(t){t[t.POLYGONS=0]="POLYGONS",t[t.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",t[t.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"}(Nz||(Nz={}));var $z=function(){function t(){}return t.vertEq=function(t,e){return t.s===e.s&&t.t===e.t},t.vertLeq=function(t,e){return t.s<e.s||t.s===e.s&&t.t<=e.t},t.transLeq=function(t,e){return t.t<e.t||t.t===e.t&&t.s<=e.s},t.edgeGoesLeft=function(e){return t.vertLeq(e.Dst,e.Org)},t.edgeGoesRight=function(e){return t.vertLeq(e.Org,e.Dst)},t.vertL1dist=function(t,e){return Math.abs(t.s-e.s)+Math.abs(t.t-e.t)},t.edgeEval=function(e,i,n){Jz(t.vertLeq(e,i)&&t.vertLeq(i,n));var r=i.s-e.s,s=n.s-i.s;return r+s>0?r<s?i.t-e.t+(e.t-n.t)*(r/(r+s)):i.t-n.t+(n.t-e.t)*(s/(r+s)):0},t.edgeSign=function(e,i,n){Jz(t.vertLeq(e,i)&&t.vertLeq(i,n));var r=i.s-e.s,s=n.s-i.s;return r+s>0?(i.t-n.t)*r+(i.t-e.t)*s:0},t.transEval=function(e,i,n){Jz(t.transLeq(e,i)&&t.transLeq(i,n));var r=i.t-e.t,s=n.t-i.t;return r+s>0?r<s?i.s-e.s+(e.s-n.s)*(r/(r+s)):i.s-n.s+(n.s-e.s)*(s/(r+s)):0},t.transSign=function(e,i,n){Jz(t.transLeq(e,i)&&t.transLeq(i,n));var r=i.t-e.t,s=n.t-i.t;return r+s>0?(i.s-n.s)*r+(i.s-e.s)*s:0},t.vertCCW=function(t,e,i){return t.s*(e.t-i.t)+e.s*(i.t-t.t)+i.s*(t.t-e.t)>=0},t.interpolate=function(t,e,i,n){return(t=t<0?0:t)<=(i=i<0?0:i)?0===i?(e+n)/2:e+t/(t+i)*(n-e):n+i/(t+i)*(e-n)},t.intersect=function(e,i,n,r,s){var a,o,l;t.vertLeq(e,i)||(l=e,e=i,i=l),t.vertLeq(n,r)||(l=n,n=r,r=l),t.vertLeq(e,n)||(l=e,e=n,n=l,l=i,i=r,r=l),t.vertLeq(n,i)?t.vertLeq(i,r)?((a=t.edgeEval(e,n,i))+(o=t.edgeEval(n,i,r))<0&&(a=-a,o=-o),s.s=t.interpolate(a,n.s,o,i.s)):((a=t.edgeSign(e,n,i))+(o=-t.edgeSign(e,r,i))<0&&(a=-a,o=-o),s.s=t.interpolate(a,n.s,o,r.s)):s.s=(n.s+i.s)/2,t.transLeq(e,i)||(l=e,e=i,i=l),t.transLeq(n,r)||(l=n,n=r,r=l),t.transLeq(e,n)||(l=e,e=n,n=l,l=i,i=r,r=l),t.transLeq(n,i)?t.transLeq(i,r)?((a=t.transEval(e,n,i))+(o=t.transEval(n,i,r))<0&&(a=-a,o=-o),s.t=t.interpolate(a,n.t,o,i.t)):((a=t.transSign(e,n,i))+(o=-t.transSign(e,r,i))<0&&(a=-a,o=-o),s.t=t.interpolate(a,n.t,o,r.t)):s.t=(n.t+i.t)/2},t}(),tF=function(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1},eF=function(){function t(t){this.side=t,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(t.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(t){this.Sym.Lface=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(t){this.Sym.Org=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(t){this.Sym.Lnext=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(t){this.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(t){this.Lnext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(t){this.Sym.Onext=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(t){this.Sym.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(t){this.Sym.Lnext.Sym=t},enumerable:!0,configurable:!0}),t}(),iF=function(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0},nF=function(){function t(){var t=new iF,e=new tF,i=new eF(0),n=new eF(1);t.next=t.prev=t,t.anEdge=null,e.next=e.prev=e,i.next=i,i.Sym=n,n.next=n,n.Sym=i,this.vHead=t,this.fHead=e,this.eHead=i,this.eHeadSym=n}return t.prototype.makeEdge_=function(t){var e=new eF(0),i=new eF(1);t.Sym.side<t.side&&(t=t.Sym);var n=t.Sym.next;return i.next=n,n.Sym.next=e,e.next=t,t.Sym.next=i,e.Sym=i,e.Onext=e,e.Lnext=i,e.Org=null,e.Lface=null,e.winding=0,e.activeRegion=null,i.Sym=e,i.Onext=i,i.Lnext=e,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,e},t.prototype.splice_=function(t,e){var i=t.Onext,n=e.Onext;i.Sym.Lnext=e,n.Sym.Lnext=t,t.Onext=n,e.Onext=i},t.prototype.makeVertex_=function(t,e,i){var n=t;Jz(n,"Vertex can't be null!");var r=i.prev;n.prev=r,r.next=n,n.next=i,i.prev=n,n.anEdge=e;var s=e;do{s.Org=n,s=s.Onext}while(s!==e)},t.prototype.makeFace_=function(t,e,i){var n=t;Jz(n,"Face can't be null");var r=i.prev;n.prev=r,r.next=n,n.next=i,i.prev=n,n.anEdge=e,n.trail=null,n.marked=!1,n.inside=i.inside;var s=e;do{s.Lface=n,s=s.Lnext}while(s!==e)},t.prototype.killEdge_=function(t){t.Sym.side<t.side&&(t=t.Sym);var e=t.next,i=t.Sym.next;e.Sym.next=i,i.Sym.next=e},t.prototype.killVertex_=function(t,e){var i=t.anEdge,n=i;do{n.Org=e,n=n.Onext}while(n!==i);var r=t.prev,s=t.next;s.prev=r,r.next=s},t.prototype.killFace_=function(t,e){var i=t.anEdge,n=i;do{n.Lface=e,n=n.Lnext}while(n!==i);var r=t.prev,s=t.next;s.prev=r,r.next=s},t.prototype.makeEdge=function(){var t=new iF,e=new iF,i=new tF,n=this.makeEdge_(this.eHead);return this.makeVertex_(t,n,this.vHead),this.makeVertex_(e,n.Sym,this.vHead),this.makeFace_(i,n,this.fHead),n},t.prototype.splice=function(t,e){var i=!1,n=!1;if(t!==e){if(e.Org!==t.Org&&(n=!0,this.killVertex_(e.Org,t.Org)),e.Lface!==t.Lface&&(i=!0,this.killFace_(e.Lface,t.Lface)),this.splice_(e,t),!n){var r=new iF;this.makeVertex_(r,e,t.Org),t.Org.anEdge=t}if(!i){var s=new tF;this.makeFace_(s,e,t.Lface),t.Lface.anEdge=t}}},t.prototype.delete=function(t){var e=t.Sym,i=!1;if(t.Lface!==t.Rface&&(i=!0,this.killFace_(t.Lface,t.Rface)),t.Onext===t)this.killVertex_(t.Org,null);else if(t.Rface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev),!i){var n=new tF;this.makeFace_(n,t,t.Lface)}e.Onext===e?(this.killVertex_(e.Org,null),this.killFace_(e.Lface,null)):(t.Lface.anEdge=e.Oprev,e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev)),this.killEdge_(t)},t.prototype.addEdgeVertex=function(t){var e=this.makeEdge_(t),i=e.Sym;this.splice_(e,t.Lnext),e.Org=t.Dst;var n=new iF;return this.makeVertex_(n,i,e.Org),e.Lface=i.Lface=t.Lface,e},t.prototype.splitEdge=function(t){var e=this.addEdgeVertex(t).Sym;return this.splice_(t.Sym,t.Sym.Oprev),this.splice_(t.Sym,e),t.Dst=e.Org,e.Dst.anEdge=e.Sym,e.Rface=t.Rface,e.winding=t.winding,e.Sym.winding=t.Sym.winding,e.idx=t.idx,e.Sym.idx=t.Sym.idx,e},t.prototype.connect=function(t,e){var i=!1,n=this.makeEdge_(t),r=n.Sym;if(e.Lface!==t.Lface&&(i=!0,this.killFace_(e.Lface,t.Lface)),this.splice_(n,t.Lnext),this.splice_(r,e),n.Org=t.Dst,r.Org=e.Org,n.Lface=r.Lface=t.Lface,t.Lface.anEdge=r,!i){var s=new tF;this.makeFace_(s,n,t.Lface)}return n},t.prototype.zapFace=function(t){var e,i,n,r,s,a=t.anEdge;i=a.Lnext;do{i=(e=i).Lnext,e.Lface=null,null===e.Rface&&(e.Onext===e?this.killVertex_(e.Org,null):(e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev)),(n=e.Sym).Onext===n?this.killVertex_(n.Org,null):(n.Org.anEdge=n.Onext,this.splice_(n,n.Oprev)),this.killEdge_(e))}while(e!=a);r=t.prev,(s=t.next).prev=r,r.next=s},t.prototype.countFaceVerts_=function(t){var e=t.anEdge,i=0;do{i++,e=e.Lnext}while(e!==t.anEdge);return i},t.prototype.mergeConvexFaces=function(t){var e,i,n,r,s;for(e=this.fHead.next;e!==this.fHead;e=e.next)if(e.inside)for(s=(i=e.anEdge).Org;n=i.Lnext,(r=i.Sym)&&r.Lface&&r.Lface.inside&&(this.countFaceVerts_(e)+this.countFaceVerts_(r.Lface)-2<=t&&$z.vertCCW(i.Lprev.Org,i.Org,r.Lnext.Lnext.Org)&&$z.vertCCW(r.Lprev.Org,r.Org,i.Lnext.Lnext.Org)&&(n=r.Lnext,this.delete(r),i=null,r=null)),!i||i.Lnext.Org!==s;)i=n;return!0},t.prototype.check=function(){var t,e,i,n,r,s,a=this.fHead,o=this.vHead,l=this.eHead;for(e=a,e=a;(t=e.next)!==a;e=t){Jz(t.prev===e),r=t.anEdge;do{Jz(r.Sym!==r),Jz(r.Sym.Sym===r),Jz(r.Lnext.Onext.Sym===r),Jz(r.Onext.Sym.Lnext===r),Jz(r.Lface===t),r=r.Lnext}while(r!==t.anEdge)}for(Jz(t.prev===e&&null===t.anEdge),n=o,n=o;(i=n.next)!==o;n=i){Jz(i.prev===n),r=i.anEdge;do{Jz(r.Sym!==r),Jz(r.Sym.Sym===r),Jz(r.Lnext.Onext.Sym===r),Jz(r.Onext.Sym.Lnext===r),Jz(r.Org===i),r=r.Onext}while(r!==i.anEdge)}for(Jz(i.prev===n&&null===i.anEdge),s=l,s=l;(r=s.next)!==l;s=r)Jz(r.Sym.next===s.Sym),Jz(r.Sym!==r),Jz(r.Sym.Sym===r),Jz(null!==r.Org),Jz(null!==r.Dst),Jz(r.Lnext.Onext.Sym===r),Jz(r.Onext.Sym.Lnext===r);Jz(r.Sym.next===s.Sym&&r.Sym===this.eHeadSym&&r.Sym.Sym===r&&null===r.Org&&null===r.Dst&&null===r.Lface&&null===r.Rface)},t}(),rF=function(){this.handle=null},sF=function(){this.key=null,this.node=0},aF=function(){function t(t,e){this.leq=e,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=t,this.nodes=[],this.handles=[];for(var i=0;i<t+1;i++)this.nodes[i]=new rF,this.handles[i]=new sF;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return t.prototype.floatDown_=function(t){var e,i,n,r=this.nodes,s=this.handles;for(e=r[t].handle;;){if((n=t<<1)<this.size&&this.leq(s[r[n+1].handle].key,s[r[n].handle].key)&&++n,Jz(n<=this.max),i=r[n].handle,n>this.size||this.leq(s[e].key,s[i].key)){r[t].handle=e,s[e].node=t;break}r[t].handle=i,s[i].node=t,t=n}},t.prototype.floatUp_=function(t){var e,i,n,r=this.nodes,s=this.handles;for(e=r[t].handle;;){if(i=r[n=t>>1].handle,0===n||this.leq(s[i].key,s[e].key)){r[t].handle=e,s[e].node=t;break}r[t].handle=i,s[i].node=t,t=n}},t.prototype.init=function(){for(var t=this.size;t>=1;--t)this.floatDown_(t);this.initialized=!0},t.prototype.min=function(){return this.handles[this.nodes[1].handle].key},t.prototype.insert=function(t){var e,i;if(2*(e=++this.size)>this.max){var n,r;for(this.max*=2,r=this.nodes.length,this.nodes.length=this.max+1,n=r;n<this.nodes.length;n++)this.nodes[n]=new rF;for(r=this.handles.length,this.handles.length=this.max+1,n=r;n<this.handles.length;n++)this.handles[n]=new sF}return 0===this.freeList?i=e:(i=this.freeList,this.freeList=this.handles[i].node),this.nodes[e].handle=i,this.handles[i].node=e,this.handles[i].key=t,this.initialized&&this.floatUp_(e),i},t.prototype.extractMin=function(){var t=this.nodes,e=this.handles,i=t[1].handle,n=e[i].key;return this.size>0&&(t[1].handle=t[this.size].handle,e[t[1].handle].node=1,e[i].key=null,e[i].node=this.freeList,this.freeList=i,--this.size,this.size>0&&this.floatDown_(1)),n},t.prototype.delete=function(t){var e,i=this.nodes,n=this.handles;Jz(t>=1&&t<=this.max&&null!==n[t].key),i[e=n[t].node].handle=i[this.size].handle,n[i[e].handle].node=e,--this.size,e<=this.size&&(e<=1||this.leq(n[i[e>>1].handle].key,n[i[e].handle].key)?this.floatDown_(e):this.floatUp_(e)),n[t].key=null,n[t].node=this.freeList,this.freeList=t},t}(),oF=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},lF=function(){this.key=null,this.next=null,this.prev=null},hF=function(){function t(t,e){this.frame=t,this.leq=e,this.head=new lF,this.head.next=this.head,this.head.prev=this.head}return t.prototype.min=function(){return this.head.next},t.prototype.max=function(){return this.head.prev},t.prototype.insert=function(t){return this.insertBefore(this.head,t)},t.prototype.search=function(t){var e=this.head;do{e=e.next}while(null!==e.key&&!this.leq(this.frame,t,e.key));return e},t.prototype.insertBefore=function(t,e){do{t=t.prev}while(null!==t.key&&!this.leq(this.frame,t.key,e));var i=new lF;return i.key=e,i.next=t.next,t.next.prev=i,i.prev=t,t.next=i,i},t.prototype.delete=function(t){t.next.prev=t.prev,t.prev.next=t.next},t}(),cF=function(){function t(){}return t.regionBelow=function(t){return t.nodeUp.prev.key},t.regionAbove=function(t){return t.nodeUp.next.key},t.debugEvent=function(t){},t.addWinding=function(t,e){t.winding+=e.winding,t.Sym.winding+=e.Sym.winding},t.edgeLeq=function(t,e,i){var n=t.event,r=e.eUp,s=i.eUp;return r.Dst===n?s.Dst===n?$z.vertLeq(r.Org,s.Org)?$z.edgeSign(s.Dst,r.Org,s.Org)<=0:$z.edgeSign(r.Dst,s.Org,r.Org)>=0:$z.edgeSign(s.Dst,n,s.Org)<=0:s.Dst===n?$z.edgeSign(r.Dst,n,r.Org)>=0:$z.edgeEval(r.Dst,n,r.Org)>=$z.edgeEval(s.Dst,n,s.Org)},t.deleteRegion=function(t,e){e.fixUpperEdge&&Jz(0===e.eUp.winding),e.eUp.activeRegion=null,t.dict.delete(e.nodeUp)},t.fixUpperEdge=function(t,e,i){Jz(e.fixUpperEdge),t.mesh.delete(e.eUp),e.fixUpperEdge=!1,e.eUp=i,i.activeRegion=e},t.topLeftRegion=function(e,i){var n,r=i.eUp.Org;do{i=t.regionAbove(i)}while(i.eUp.Org===r);if(i.fixUpperEdge){if(null===(n=e.mesh.connect(t.regionBelow(i).eUp.Sym,i.eUp.Lnext)))return null;t.fixUpperEdge(e,i,n),i=t.regionAbove(i)}return i},t.topRightRegion=function(e){var i=e.eUp.Dst;do{e=t.regionAbove(e)}while(e.eUp.Dst===i);return e},t.addRegionBelow=function(t,e,i){var n=new oF;return n.eUp=i,n.nodeUp=t.dict.insertBefore(e.nodeUp,n),n.fixUpperEdge=!1,n.sentinel=!1,n.dirty=!1,i.activeRegion=n,n},t.isWindingInside=function(t,e){switch(t.windingRule){case zz.ODD:return 0!==(1&e);case zz.NONZERO:return 0!==e;case zz.POSITIVE:return e>0;case zz.NEGATIVE:return e<0;case zz.ABS_GEQ_TWO:return e>=2||e<=-2}throw new Error("Invalid winding rulle")},t.computeWinding=function(e,i){i.windingNumber=t.regionAbove(i).windingNumber+i.eUp.winding,i.inside=t.isWindingInside(e,i.windingNumber)},t.finishRegion=function(e,i){var n=i.eUp,r=n.Lface;r.inside=i.inside,r.anEdge=n,t.deleteRegion(e,i)},t.finishLeftRegions=function(e,i,n){for(var r,s=null,a=i,o=i.eUp;a!==n;){if(a.fixUpperEdge=!1,(r=(s=t.regionBelow(a)).eUp).Org!=o.Org){if(!s.fixUpperEdge){t.finishRegion(e,a);break}r=e.mesh.connect(o.Lprev,r.Sym),t.fixUpperEdge(e,s,r)}o.Onext!==r&&(e.mesh.splice(r.Oprev,r),e.mesh.splice(o,r)),t.finishRegion(e,a),o=s.eUp,a=s}return o},t.addRightEdges=function(e,i,n,r,s,a){var o,l,h,c,u=!0;h=n;do{Jz($z.vertLeq(h.Org,h.Dst)),t.addRegionBelow(e,i,h.Sym),h=h.Onext}while(h!==r);for(null===s&&(s=t.regionBelow(i).eUp.Rprev),l=i,c=s;(h=(o=t.regionBelow(l)).eUp.Sym).Org===c.Org;)h.Onext!==c&&(e.mesh.splice(h.Oprev,h),e.mesh.splice(c.Oprev,h)),o.windingNumber=l.windingNumber-h.winding,o.inside=t.isWindingInside(e,o.windingNumber),l.dirty=!0,!u&&t.checkForRightSplice(e,l)&&(t.addWinding(h,c),t.deleteRegion(e,l),e.mesh.delete(c)),u=!1,l=o,c=h;l.dirty=!0,Jz(l.windingNumber-h.winding===o.windingNumber),a&&t.walkDirtyRegions(e,l)},t.spliceMergeVertices=function(t,e,i){t.mesh.splice(e,i)},t.vertexWeights=function(t,e,i){var n=$z.vertL1dist(e,t),r=$z.vertL1dist(i,t),s=.5*r/(n+r),a=.5*n/(n+r);t.coords[0]+=s*e.coords[0]+a*i.coords[0],t.coords[1]+=s*e.coords[1]+a*i.coords[1],t.coords[2]+=s*e.coords[2]+a*i.coords[2]},t.getIntersectData=function(e,i,n,r,s,a){i.coords[0]=i.coords[1]=i.coords[2]=0,i.idx=-1,t.vertexWeights(i,n,r),t.vertexWeights(i,s,a)},t.checkForRightSplice=function(e,i){var n=t.regionBelow(i),r=i.eUp,s=n.eUp;if($z.vertLeq(r.Org,s.Org)){if($z.edgeSign(s.Dst,r.Org,s.Org)>0)return!1;$z.vertEq(r.Org,s.Org)?r.Org!==s.Org&&(e.pq.delete(r.Org.pqHandle),t.spliceMergeVertices(e,s.Oprev,r)):(e.mesh.splitEdge(s.Sym),e.mesh.splice(r,s.Oprev),i.dirty=n.dirty=!0)}else{if($z.edgeSign(r.Dst,s.Org,r.Org)<0)return!1;t.regionAbove(i).dirty=i.dirty=!0,e.mesh.splitEdge(r.Sym),e.mesh.splice(s.Oprev,r)}return!0},t.checkForLeftSplice=function(e,i){var n,r=t.regionBelow(i),s=i.eUp,a=r.eUp;if(Jz(!$z.vertEq(s.Dst,a.Dst)),$z.vertLeq(s.Dst,a.Dst)){if($z.edgeSign(s.Dst,a.Dst,s.Org)<0)return!1;t.regionAbove(i).dirty=i.dirty=!0,n=e.mesh.splitEdge(s),e.mesh.splice(a.Sym,n),n.Lface.inside=i.inside}else{if($z.edgeSign(a.Dst,s.Dst,a.Org)>0)return!1;i.dirty=r.dirty=!0,n=e.mesh.splitEdge(a),e.mesh.splice(s.Lnext,a.Sym),n.Rface.inside=i.inside}return!0},t.checkForIntersect=function(e,i){var n,r,s=t.regionBelow(i),a=i.eUp,o=s.eUp,l=a.Org,h=o.Org,c=a.Dst,u=o.Dst,d=new iF;if(Jz(!$z.vertEq(u,c)),Jz($z.edgeSign(c,e.event,l)<=0),Jz($z.edgeSign(u,e.event,h)>=0),Jz(l!==e.event&&h!==e.event),Jz(!i.fixUpperEdge&&!s.fixUpperEdge),l===h||Math.min(l.t,c.t)>Math.max(h.t,u.t))return!1;if($z.vertLeq(l,h)){if($z.edgeSign(u,l,h)>0)return!1}else if($z.edgeSign(c,h,l)<0)return!1;return t.debugEvent(e),$z.intersect(c,l,u,h,d),Jz(Math.min(l.t,c.t)<=d.t),Jz(d.t<=Math.max(h.t,u.t)),Jz(Math.min(u.s,c.s)<=d.s),Jz(d.s<=Math.max(h.s,l.s)),$z.vertLeq(d,e.event)&&(d.s=e.event.s,d.t=e.event.t),n=$z.vertLeq(l,h)?l:h,$z.vertLeq(n,d)&&(d.s=n.s,d.t=n.t),$z.vertEq(d,l)||$z.vertEq(d,h)?(t.checkForRightSplice(e,i),!1):!$z.vertEq(c,e.event)&&$z.edgeSign(c,e.event,d)>=0||!$z.vertEq(u,e.event)&&$z.edgeSign(u,e.event,d)<=0?u===e.event?(e.mesh.splitEdge(a.Sym),e.mesh.splice(o.Sym,a),i=t.topLeftRegion(e,i),a=t.regionBelow(i).eUp,t.finishLeftRegions(e,t.regionBelow(i),s),t.addRightEdges(e,i,a.Oprev,a,a,!0),!0):c===e.event?(e.mesh.splitEdge(o.Sym),e.mesh.splice(a.Lnext,o.Oprev),s=i,i=t.topRightRegion(i),r=t.regionBelow(i).eUp.Rprev,s.eUp=o.Oprev,o=t.finishLeftRegions(e,s,null),t.addRightEdges(e,i,o.Onext,a.Rprev,r,!0),!0):($z.edgeSign(c,e.event,d)>=0&&(t.regionAbove(i).dirty=i.dirty=!0,e.mesh.splitEdge(a.Sym),a.Org.s=e.event.s,a.Org.t=e.event.t),$z.edgeSign(u,e.event,d)<=0&&(i.dirty=s.dirty=!0,e.mesh.splitEdge(o.Sym),o.Org.s=e.event.s,o.Org.t=e.event.t),!1):(e.mesh.splitEdge(a.Sym),e.mesh.splitEdge(o.Sym),e.mesh.splice(o.Oprev,a),a.Org.s=d.s,a.Org.t=d.t,a.Org.pqHandle=e.pq.insert(a.Org),t.getIntersectData(e,a.Org,l,c,h,u),t.regionAbove(i).dirty=i.dirty=s.dirty=!0,!1)},t.walkDirtyRegions=function(e,i){for(var n,r,s=t.regionBelow(i);;){for(;s.dirty;)i=s,s=t.regionBelow(s);if(!i.dirty&&(s=i,null===(i=t.regionAbove(i))||!i.dirty))return;if(i.dirty=!1,n=i.eUp,r=s.eUp,n.Dst!==r.Dst&&t.checkForLeftSplice(e,i)&&(s.fixUpperEdge?(t.deleteRegion(e,s),e.mesh.delete(r),r=(s=t.regionBelow(i)).eUp):i.fixUpperEdge&&(t.deleteRegion(e,i),e.mesh.delete(n),n=(i=t.regionAbove(s)).eUp)),n.Org!==r.Org)if(n.Dst===r.Dst||i.fixUpperEdge||s.fixUpperEdge||n.Dst!==e.event&&r.Dst!==e.event)t.checkForRightSplice(e,i);else if(t.checkForIntersect(e,i))return;n.Org===r.Org&&n.Dst===r.Dst&&(t.addWinding(r,n),t.deleteRegion(e,i),e.mesh.delete(n),i=t.regionAbove(s))}},t.connectRightVertex=function(e,i,n){var r,s=n.Onext,a=t.regionBelow(i),o=i.eUp,l=a.eUp,h=!1;o.Dst!==l.Dst&&t.checkForIntersect(e,i),$z.vertEq(o.Org,e.event)&&(e.mesh.splice(s.Oprev,o),i=t.topLeftRegion(e,i),s=t.regionBelow(i).eUp,t.finishLeftRegions(e,t.regionBelow(i),a),h=!0),$z.vertEq(l.Org,e.event)&&(e.mesh.splice(n,l.Oprev),n=t.finishLeftRegions(e,a,null),h=!0),h?t.addRightEdges(e,i,n.Onext,s,s,!0):(r=$z.vertLeq(l.Org,o.Org)?l.Oprev:o,r=e.mesh.connect(n.Lprev,r),t.addRightEdges(e,i,r,r.Onext,r.Onext,!1),r.Sym.activeRegion.fixUpperEdge=!0,t.walkDirtyRegions(e,i))},t.connectLeftDegenerate=function(e,i,n){var r,s,a,o,l;return r=i.eUp,$z.vertEq(r.Org,n)?(Jz(!1),void t.spliceMergeVertices(e,r,n.anEdge)):$z.vertEq(r.Dst,n)?(Jz(!1),i=t.topRightRegion(i),s=o=(a=(l=t.regionBelow(i)).eUp.Sym).Onext,l.fixUpperEdge&&(Jz(s!==a),t.deleteRegion(e,l),e.mesh.delete(a),a=s.Oprev),e.mesh.splice(n.anEdge,a),$z.edgeGoesLeft(s)||(s=null),void t.addRightEdges(e,i,a.Onext,o,s,!0)):(e.mesh.splitEdge(r.Sym),i.fixUpperEdge&&(e.mesh.delete(r.Onext),i.fixUpperEdge=!1),e.mesh.splice(n.anEdge,r),void t.sweepEvent(e,n))},t.connectLeftVertex=function(e,i){var n,r,s,a,o,l,h=new oF;if(h.eUp=i.anEdge.Sym,n=e.dict.search(h).key,r=t.regionBelow(n)){if(a=n.eUp,o=r.eUp,0===$z.edgeSign(a.Dst,i,a.Org))return void t.connectLeftDegenerate(e,n,i);if(s=$z.vertLeq(o.Dst,a.Dst)?n:r,n.inside||s.fixUpperEdge){if(s===n)l=e.mesh.connect(i.anEdge.Sym,a.Lnext);else l=e.mesh.connect(o.Dnext,i.anEdge).Sym;s.fixUpperEdge?t.fixUpperEdge(e,s,l):t.computeWinding(e,t.addRegionBelow(e,n,l)),t.sweepEvent(e,i)}else t.addRightEdges(e,n,i.anEdge,i.anEdge,null,!0)}},t.sweepEvent=function(e,i){e.event=i,t.debugEvent(e);for(var n=i.anEdge;null===n.activeRegion;)if((n=n.Onext)===i.anEdge)return void t.connectLeftVertex(e,i);var r=t.topLeftRegion(e,n.activeRegion);Jz(null!==r);var s=t.regionBelow(r),a=s.eUp,o=t.finishLeftRegions(e,s,null);o.Onext===a?t.connectRightVertex(e,r,o):t.addRightEdges(e,r,o.Onext,a,a,!0)},t.addSentinel=function(t,e,i,n){var r=new oF,s=t.mesh.makeEdge();s.Org.s=i,s.Org.t=n,s.Dst.s=e,s.Dst.t=n,t.event=s.Dst,r.eUp=s,r.windingNumber=0,r.inside=!1,r.fixUpperEdge=!1,r.sentinel=!0,r.dirty=!1,r.nodeUp=t.dict.insert(r)},t.initEdgeDict=function(e){e.dict=new hF(e,t.edgeLeq);var i=e.bmax[0]-e.bmin[0],n=e.bmax[1]-e.bmin[1],r=e.bmin[0]-i,s=e.bmax[0]+i,a=e.bmin[1]-n,o=e.bmax[1]+n;t.addSentinel(e,r,s,a),t.addSentinel(e,r,s,o)},t.doneEdgeDict=function(e){for(var i,n=0;null!==(i=e.dict.min().key);)i.sentinel||(Jz(i.fixUpperEdge),Jz(1===++n)),Jz(0===i.windingNumber),t.deleteRegion(e,i)},t.removeDegenerateEdges=function(e){var i,n,r,s=e.mesh.eHead;for(i=s.next;i!==s;i=n)n=i.next,r=i.Lnext,$z.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(t.spliceMergeVertices(e,r,i),e.mesh.delete(i),r=(i=r).Lnext),r.Lnext===i&&(r!==i&&((r===n||r===n.Sym)&&(n=n.next),e.mesh.delete(r)),(i===n||i===n.Sym)&&(n=n.next),e.mesh.delete(i))},t.initPriorityQ=function(t){var e,i,n,r=0;for(i=(n=t.mesh.vHead).next;i!==n;i=i.next)r++;for(r+=8,e=t.pq=new aF(r,$z.vertLeq),i=(n=t.mesh.vHead).next;i!==n;i=i.next)i.pqHandle=e.insert(i);return i===n&&(e.init(),!0)},t.donePriorityQ=function(t){t.pq=null},t.removeDegenerateFaces=function(e,i){var n,r,s;for(n=i.fHead.next;n!==i.fHead;n=r)r=n.next,Jz((s=n.anEdge).Lnext!==s),s.Lnext.Lnext===s&&(t.addWinding(s.Onext,s),e.mesh.delete(s));return!0},t.computeInterior=function(e,i){var n,r;if(void 0===i&&(i=!0),t.removeDegenerateEdges(e),!t.initPriorityQ(e))return!1;for(t.initEdgeDict(e);null!==(n=e.pq.extractMin());){for(;null!==(r=e.pq.min())&&$z.vertEq(r,n);)r=e.pq.extractMin(),t.spliceMergeVertices(e,n.anEdge,r.anEdge);t.sweepEvent(e,n)}return e.event=e.dict.min().key.eUp.Org,t.debugEvent(e),t.doneEdgeDict(e),t.donePriorityQ(e),!!t.removeDegenerateFaces(e,e.mesh)&&(i&&e.mesh.check(),!0)},t}(),uF=function(){function t(){this.mesh=new nF,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=zz.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return t.prototype.dot_=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},t.prototype.normalize_=function(t){var e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(!e)throw"Zero-size vector!";e=Math.sqrt(e),t[0]/=e,t[1]/=e,t[2]/=e},t.prototype.longAxis_=function(t){var e=0;return Math.abs(t[1])>Math.abs(t[0])&&(e=1),Math.abs(t[2])>Math.abs(t[e])&&(e=2),e},t.prototype.computeNormal_=function(t){var e,i,n,r,s,a,o=[0,0,0],l=[0,0,0],h=[0,0,0],c=[0,0,0],u=[0,0,0],d=[null,null,null],p=[null,null,null],f=this.mesh.vHead;e=f.next;for(var m=0;m<3;++m)r=e.coords[m],l[m]=r,p[m]=e,o[m]=r,d[m]=e;for(e=f.next;e!==f;e=e.next)for(var g=0;g<3;++g)(r=e.coords[g])<l[g]&&(l[g]=r,p[g]=e),r>o[g]&&(o[g]=r,d[g]=e);var v=0;if(o[1]-l[1]>o[0]-l[0]&&(v=1),o[2]-l[2]>o[v]-l[v]&&(v=2),l[v]>=o[v])return t[0]=0,t[1]=0,void(t[2]=1);for(a=0,i=p[v],n=d[v],h[0]=i.coords[0]-n.coords[0],h[1]=i.coords[1]-n.coords[1],h[2]=i.coords[2]-n.coords[2],e=f.next;e!==f;e=e.next)c[0]=e.coords[0]-n.coords[0],c[1]=e.coords[1]-n.coords[1],c[2]=e.coords[2]-n.coords[2],u[0]=h[1]*c[2]-h[2]*c[1],u[1]=h[2]*c[0]-h[0]*c[2],u[2]=h[0]*c[1]-h[1]*c[0],(s=u[0]*u[0]+u[1]*u[1]+u[2]*u[2])>a&&(a=s,t[0]=u[0],t[1]=u[1],t[2]=u[2]);a<=0&&(t[0]=t[1]=t[2]=0,t[this.longAxis_(h)]=1)},t.prototype.checkOrientation_=function(){for(var t,e,i=this.mesh.fHead,n=this.mesh.vHead,r=0,s=i.next;s!==i;s=s.next)if(!((e=s.anEdge).winding<=0))do{r+=(e.Org.s-e.Dst.s)*(e.Org.t+e.Dst.t),e=e.Lnext}while(e!==s.anEdge);if(r<0){for(t=n.next;t!==n;t=t.next)t.t=-t.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},t.prototype.projectPolygon_=function(){var t,e,i=this.mesh.vHead,n=[0,0,0],r=!1;n[0]=this.normal[0],n[1]=this.normal[1],n[2]=this.normal[2],!n[0]&&!n[1]&&!n[2]&&(this.computeNormal_(n),r=!0),t=this.sUnit,e=this.tUnit;var s=this.longAxis_(n);t[s]=0,t[(s+1)%3]=1,t[(s+2)%3]=0,e[s]=0,e[(s+1)%3]=0,e[(s+2)%3]=n[s]>0?1:-1;for(var a=i.next;a!==i;a=a.next)a.s=this.dot_(a.coords,t),a.t=this.dot_(a.coords,e);r&&this.checkOrientation_();for(var o=!0,l=i.next;l!==i;l=l.next)o?(this.bmin[0]=this.bmax[0]=l.s,this.bmin[1]=this.bmax[1]=l.t,o=!1):(l.s<this.bmin[0]&&(this.bmin[0]=l.s),l.s>this.bmax[0]&&(this.bmax[0]=l.s),l.t<this.bmin[1]&&(this.bmin[1]=l.t),l.t>this.bmax[1]&&(this.bmax[1]=l.t))},t.prototype.addWinding_=function(t,e){t.winding+=e.winding,t.Sym.winding+=e.Sym.winding},t.prototype.tessellateMonoRegion_=function(t,e){var i,n;if((i=e.anEdge).Lnext===i||i.Lnext.Lnext===i)throw"Mono region invalid";for(;$z.vertLeq(i.Dst,i.Org);i=i.Lprev);for(;$z.vertLeq(i.Org,i.Dst);i=i.Lnext);n=i.Lprev;for(;i.Lnext!==n;)if($z.vertLeq(i.Dst,n.Org)){for(;n.Lnext!==i&&($z.edgeGoesLeft(n.Lnext)||$z.edgeSign(n.Org,n.Dst,n.Lnext.Dst)<=0);)n=t.connect(n.Lnext,n).Sym;n=n.Lprev}else{for(;n.Lnext!==i&&($z.edgeGoesRight(i.Lprev)||$z.edgeSign(i.Dst,i.Org,i.Lprev.Org)>=0);)i=t.connect(i,i.Lprev).Sym;i=i.Lnext}if(n.Lnext===i)throw"Mono region invalid";for(;n.Lnext.Lnext!==i;)n=t.connect(n.Lnext,n).Sym;return!0},t.prototype.tessellateInterior_=function(t){for(var e,i=t.fHead.next;i!==t.fHead;i=e)if(e=i.next,i.inside&&!this.tessellateMonoRegion_(t,i))return!1;return!0},t.prototype.discardExterior_=function(t){for(var e,i=t.fHead.next;i!==t.fHead;i=e)e=i.next,i.inside||t.zapFace(i)},t.prototype.setWindingNumber_=function(t,e,i){for(var n,r=t.eHead.next;r!==t.eHead;r=n)n=r.next,r.Rface.inside!==r.Lface.inside?r.winding=r.Lface.inside?e:-e:i?t.delete(r):r.winding=0},t.prototype.getNeighbourFace_=function(t){return t.Rface&&t.Rface.inside?t.Rface.n:-1},t.prototype.outputPolymesh_=function(t,e,i,n){var r,s,a=0,o=0;i>3&&t.mergeConvexFaces(i);for(var l=t.vHead.next;l!==t.vHead;l=l.next)l.n=-1;for(var h=t.fHead.next;h!==t.fHead;h=h.next)if(h.n=-1,h.inside){r=h.anEdge,s=0;do{-1===(l=r.Org).n&&(l.n=o,o++),s++,r=r.Lnext}while(r!==h.anEdge);if(s>i)throw"Face vertex greater that support polygon";h.n=a,++a}this.elementCount=a,e===Nz.CONNECTED_POLYGONS&&(a*=2),this.elements=[],this.elements.length=a*i,this.vertexCount=o,this.vertices=[],this.vertices.length=o*n,this.vertexIndices=[],this.vertexIndices.length=o;for(l=t.vHead.next;l!==t.vHead;l=l.next)if(-1!==l.n){var c=l.n*n;this.vertices[c+0]=l.coords[0],this.vertices[c+1]=l.coords[1],n>2&&(this.vertices[c+2]=l.coords[2]),this.vertexIndices[l.n]=l.idx}var u=0;for(h=t.fHead.next;h!==t.fHead;h=h.next)if(h.inside){r=h.anEdge,s=0;do{l=r.Org;this.elements[u++]=l.n,s++,r=r.Lnext}while(r!==h.anEdge);for(var d=s;d<i;++d)this.elements[u++]=-1;if(e===Nz.CONNECTED_POLYGONS){r=h.anEdge;do{this.elements[u++]=this.getNeighbourFace_(r),r=r.Lnext}while(r!==h.anEdge);for(var p=s;p<i;++p)this.elements[u++]=-1}}},t.prototype.outputContours_=function(t,e){var i,n,r=0,s=0;this.vertexCount=0,this.elementCount=0;for(var a=t.fHead.next;a!==t.fHead;a=a.next)if(a.inside){n=i=a.anEdge;do{this.vertexCount++,i=i.Lnext}while(i!==n);this.elementCount++}this.elements=[],this.elements.length=2*this.elementCount,this.vertices=[],this.vertices.length=this.vertexCount*e,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var o=0,l=0,h=0;r=0;for(a=t.fHead.next;a!==t.fHead;a=a.next)if(a.inside){s=0,n=i=a.anEdge;do{this.vertices[o++]=i.Org.coords[0],this.vertices[o++]=i.Org.coords[1],e>2&&(this.vertices[o++]=i.Org.coords[2]),this.vertexIndices[l++]=this.vertexIdCallback?this.vertexIdCallback(i):i.Org.idx,s++,i=i.Lnext}while(i!==n);this.elements[h++]=r,this.elements[h++]=s,r+=s}},t.prototype.addContour=function(t,e){null===this.mesh&&(this.mesh=new nF),t<2&&(t=2),t>3&&(t=3);for(var i=null,n=0;n<e.length;n+=t)null===i?(i=this.mesh.makeEdge(),this.mesh.splice(i,i.Sym)):(this.mesh.splitEdge(i),i=i.Lnext),i.Org.coords[0]=e[n+0],i.Org.coords[1]=e[n+1],i.Org.coords[2]=t>2?e[n+2]:0,i.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(i),i.winding=1,i.Sym.winding=-1},t.prototype.tesselate=function(t,e,i,n,r,s){if(void 0===t&&(t=zz.ODD),void 0===e&&(e=Nz.POLYGONS),void 0===s&&(s=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,r&&(this.normal[0]=r[0],this.normal[1]=r[1],this.normal[2]=r[2]),this.windingRule=t,n<2&&(n=2),n>3&&(n=3),!this.mesh)return!1;this.projectPolygon_(),cF.computeInterior(this,s);var a=this.mesh;return e===Nz.BOUNDARY_CONTOURS?this.setWindingNumber_(a,1,!0):this.tessellateInterior_(a),s&&a.check(),e===Nz.BOUNDARY_CONTOURS?this.outputContours_(a,n):this.outputPolymesh_(a,e,i,n),!0},t}();function dF(t){var e=t.windingRule,i=void 0===e?zz.ODD:e,n=t.elementType,r=void 0===n?Nz.POLYGONS:n,s=t.polySize,a=void 0===s?3:s,o=t.vertexSize,l=void 0===o?2:o,h=t.normal,c=void 0===h?[0,0,1]:h,u=t.contours,d=void 0===u?[]:u,p=t.strict,f=void 0===p||p,m=t.debug,g=void 0!==m&&m;if(!d&&f)throw new Error("Contours can't be empty");if(d){var v=new uF;t.edgeCreateCallback&&(v.edgeCreateCallback=t.edgeCreateCallback),t.vertexIdCallback&&(v.vertexIdCallback=t.vertexIdCallback);for(var y=0;y<d.length;y++)v.addContour(l||2,d[y]);return v.tesselate(i,r,a,l,c,f),{vertices:v.vertices,vertexIndices:v.vertexIndices,vertexCount:v.vertexCount,elements:v.elements,elementCount:v.elementCount,mesh:g?v.mesh:void 0}}}zz.ODD,zz.NONZERO,zz.POSITIVE,zz.NEGATIVE,zz.ABS_GEQ_TWO,Nz.POLYGONS,Nz.CONNECTED_POLYGONS,Nz.BOUNDARY_CONTOURS;var pF=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:256,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.capacity=t,this.size=0,this.debug=e,this.debug&&console.log(`allocating with cap ${t}`);let i=t*pF.eSize;this.buffer=new ArrayBuffer(i);let n=Float32Array.BYTES_PER_ELEMENT,r=0;this.positions=new Float32Array(this.buffer,r*n,3*t),r+=3*t,this.normals=new Float32Array(this.buffer,r*n,3*t),r+=3*t,this.uvs=new Float32Array(this.buffer,r*n,2*t)}realloc(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t<this.size)throw Error("cannot shrink buffer");if(t<=this.capacity&&!e)return;this.debug&&console.log(`resizing from ${this.capacity} \u2192 ${t}`);let i=t*pF.eSize,n=new ArrayBuffer(i),r=Float32Array.BYTES_PER_ELEMENT,s=0,a=new Float32Array(n,s*r,3*t);s+=3*t;let o=new Float32Array(n,s*r,3*t);s+=3*t;let l=new Float32Array(n,s*r,2*t);e?(a.set(this.positions.subarray(0,3*this.size)),o.set(this.normals.subarray(0,3*this.size)),l.set(this.uvs.subarray(0,2*this.size))):(a.set(this.positions),o.set(this.normals),l.set(this.uvs)),this.buffer=n,this.positions=a,this.normals=o,this.uvs=l,this.capacity=t}get(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=this.size+t;if(e>this.capacity){let t=this.capacity;for(;e>t;)t*=2;this.realloc(t)}let i=this.size;return this.size=e,i}reserve(t){let e=this.size+t;e>this.capacity&&this.realloc(e)}shrink(){this.debug&&console.log(`shrinking ${this.capacity} \u2192 ${this.size}`),this.realloc(this.size,!0)}},fF=pF;fF.eSize=8*Float32Array.BYTES_PER_ELEMENT;var mF=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(t,e)=>t<e?-1:t>e?1:0;if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(0===this.length)return;let t=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){let{data:e,compare:i}=this,n=e[t];for(;t>0;){let r=t-1>>1,s=e[r];if(i(n,s)>=0)break;e[t]=s,t=r}e[t]=n}_down(t){let{data:e,compare:i}=this,n=this.length>>1,r=e[t];for(;t<n;){let n=1+(t<<1),s=n+1;if(s<this.length&&i(e[s],e[n])<0&&(n=s),i(e[n],r)>=0)break;e[t]=e[n],t=n}e[t]=r}};function gF(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=1/0,s=1/0,a=-1/0,o=-1/0;for(let[y,b]of t[0])y<r&&(r=y),b<s&&(s=b),y>a&&(a=y),b>o&&(o=b);let l=a-r,h=o-s,c=Math.max(i,Math.min(l,h));if(c===i){let t=[r,s];return t.distance=0,t.distance}let u=new mF([],((t,e)=>e.max-t.max)),d=function(t){let e=0,i=0,n=0,r=t[0];for(let a=0,o=r.length,l=o-1;a<o;l=a++){let t=r[a],s=r[l],o=t[0]*s[1]-s[0]*t[1];i+=(t[0]+s[0])*o,n+=(t[1]+s[1])*o,e+=3*o}let s=new vF(i/e,n/e,0,t);return 0===e||s.d<0?new vF(r[0][0],r[0][1],0,t):s}(t),p=new vF(r+l/2,s+h/2,0,t);p.d>d.d&&(d=p);let f=2;function m(r,s,a){let o=new vF(r,s,a,t);if(f++,o.max>d.d+i&&u.push(o),o.d>d.d&&(d=o,n&&console.log(`found best ${Math.round(1e4*o.d)/1e4} after ${f} probes`),d.d>e))return e}let g=c/2;for(let y=r;y<a;y+=c)for(let t=s;t<o;t+=c)m(y+g,t+g,g);for(;u.length;){let{max:t,x:e,y:n,h:r}=u.pop();if(t-d.d<=i)break;g=r/2,m(e-g,n-g,g),m(e+g,n-g,g),m(e-g,n+g,g),m(e+g,n+g,g)}n&&console.log(`num probes: ${f}\nbest distance: ${d.d}`);let v=[d.x,d.y];return v.distance=d.d,v.distance}function vF(t,e,i,n){this.x=t,this.y=e,this.h=i,this.d=function(t,e,i){let n=!1,r=1/0;for(let s of i)for(let i=0,a=s.length,o=a-1;i<a;o=i++){let a=s[i],l=s[o];a[1]>e!=l[1]>e&&t<(l[0]-a[0])*(e-a[1])/(l[1]-a[1])+a[0]&&(n=!n),r=Math.min(r,yF(t,e,a,l))}return 0===r?0:(n?1:-1)*Math.sqrt(r)}(t,e,n),this.max=this.d+this.h*Math.SQRT2}function yF(t,e,i,n){let r=i[0],s=i[1],a=n[0]-r,o=n[1]-s;if(0!==a||0!==o){let i=((t-r)*a+(e-s)*o)/(a*a+o*o);i>1?(r=n[0],s=n[1]):i>0&&(r+=a*i,s+=o*i)}return a=t-r,o=e-s,a*a+o*o}var bF={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},xF={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},wF={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},SF=(t,e)=>i=>{let[n,r]=i;return r<n&&(r+=e),(t>=n?t:t+e)<=r},AF=class extends Hg{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:zz.ODD,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(),this.forPathBevel=a,this.type="ShapeGeometry",this.vertexCache={},this._shape=t,this._depth=e,this._curveSegments=n,this._bevelSegmentsInput=r;let o,l,h,c=this._shape.extractShapePointsToFlatArray([],n),u=this._shape.shapeHoles.map((t=>{let e=t.extractShapePointsToFlatArray([],n),i=[];for(let n=e.length-1;n>=1;n-=2){let t=e[n-1],r=e[n-0];i.push(t,r)}return i})),d=[],p=[];for(let _=0;_<c.length;_+=2)p.push([c[_],c[_+1]]);d.push(p);for(let _=0;_<u.length;_++){let t=u[_],e=[];for(let i=0;i<t.length;i+=2)e.push([t[i],t[i+1]]);d.push(e)}o=t.isText?.1*(new JS).setFromPoints(t.points.map((t=>t.position))).getSize(new Uf).length():0===d[0].length?i:i>0?gF(d,i):1e-5,i<=0?(this._bevel=0,this._bevelSegments=0):(this._bevel=Math.min(i,o,e/2),this._bevelSegments=Math.floor(r));try{l=dF({windingRule:s,elementType:Nz.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[c]})}catch{l=bF}try{h=dF({windingRule:zz.ODD,elementType:Nz.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...u]})}catch{h=xF}if(!l)throw new Error("error generating geometry");let f=l.elementCount;if(h){l.elementCount+=h.elementCount;for(let t=0;t<h.elements.length;t++){let e=h.elements[t],i=t%2===0?l.vertexCount:0;l.elements.push(e+i)}for(let t=0;t<h.vertexIndices.length;t++){let e=h.vertexIndices[t],i=l.vertexCount;l.vertexIndices.push(e+i)}for(let t=0;t<h.vertices.length;t++){let e=h.vertices[t];l.vertices.push(e)}}let m=1/0,g=-1/0,v=1/0,y=-1/0;for(let _=0,C=l.vertexCount;_<C;_++){let t=2*_,e=l.vertices[t+0],i=l.vertices[t+1];e<m&&(m=e),e>g&&(g=e),i<v&&(v=i),i>y&&(y=i)}this._minX=m,this._minY=v,this._width=g-m,this._height=y-v,this._buffer=new fF(this._computeBufferEstimatedSize(l));let b=[],x=[];for(let _=l.elementCount-1;_>=0;_--){let t=_>=f,e=2*_,i=l.elements[e+0],r=l.elements[e+1],s=i+r,h={start:i,count:r,normals:[],continuous:[],concave:[]},c=i,d=s-1,p=i+1,m=this._shape.roundedCurves.length;do{let e=c-i,n=l.vertices[2*d+0],a=l.vertices[2*d+1],o=l.vertices[2*c+0],u=l.vertices[2*c+1],f=l.vertices[2*p+0],g=l.vertices[2*p+1],v=o-n,y=u-a,b=Math.sqrt(v*v+y*y);v/=b,y/=b;let x=o-f,w=u-g,S=Math.sqrt(x*x+w*w);x/=S,w/=S,h.normals[2*e+0]=-w,h.normals[2*e+1]=x,h.concave[e]=v*w-y*x>0;let A=l.vertexIndices[c];if(Array.isArray(A))h.continuous[e]=!1;else{let[t,i]=this._shape.getCurveIndexFromVertexId(A-1,!0);if(i>0&&i<1)h.continuous[e]=!0;else{let n=1===i?t+1:t-1;n=(n+m)%m;let r=1===i?0:1,s=this._shape.roundedCurves[t].getTangent(i),a=this._shape.roundedCurves[n].getTangent(r);h.continuous[e]=s.dot(a)>.95}}t&&(h.normals[2*e+0]*=-1,h.normals[2*e+1]*=-1),[d,c,p]=[c,p,p+1],p>=s&&(p-=r)}while(p!==i+1);let g=[];g.push({bevelI:0,angle:0,size:0,boundary:{vertices:l.vertices.slice(2*i,2*s),vertexCount:r,vertexIndices:new Array(r).fill(!0).map(((t,e)=>[e,e])),elements:[0,r],elementCount:1,mesh:null},reverseMap:[],insetPoints:l.vertices.slice(2*i,2*s)});let v=0;for(let a=1;a<=this._bevelSegments;a++){let e=a/this._bevelSegments*Math.PI/2,i=(1-Math.cos(e))*this._bevel,s=[],o=[],c=[],u=[],d=0;for(let a=0;a<r;a++){let e=2*a,p=(a-1+r)%r*2,f=l.vertices[2*h.start+e+0],m=l.vertices[2*h.start+e+1],g=-h.normals[p+0]*i,v=-h.normals[p+1]*i,y=-h.normals[e+0]*i,b=-h.normals[e+1]*i;if(h.concave[a]||!h.concave[a]&&t){let e=Math.atan2(v,g),r=Math.atan2(b,y);r>e&&(r-=2*Math.PI);let o=r-e;if(h.continuous[a]||t){let n=e+o/2,r=Math.cos(n)*i,l=Math.sin(n)*i;s[2*d+0]=f+r*(t?-1:1),s[2*d+1]=m+l*(t?-1:1),u[d]=a,d++}else{let t=Math.max(1,Math.floor(n/4*Math.abs(o)/Math.PI));for(let n=0;n<=t;n++){let r=e+o*(n/t),l=Math.cos(r)*i,h=Math.sin(r)*i;s[2*d+0]=f+l,s[2*d+1]=m+h,u[d]=a,d++}}}else s[2*d+0]=f+g,s[2*d+1]=m+v,u[d]=a,o[a]=d,d++,s[2*d+0]=f,s[2*d+1]=m,u[d]=a,d++,s[2*d+0]=f+y,s[2*d+1]=m+b,u[d]=a,c[a]=d,d++}let p=dF({windingRule:zz.POSITIVE,elementType:Nz.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[s],edgeCreateCallback:t=>{let e=t.Org.idx,i=u[e],n=u[(e+1)%u.length];t.idx=[i,n],t.Sym.idx=[n,i]},vertexIdCallback:t=>{let e=t.Lprev.idx;return[e?e[1]:0,t.idx?t.idx[0]:0]}});if(!p)throw console.log("Error"),new Error(`error generating bevel geometry for ${a}'th loop`);if(!p.vertexCount){let t=(a-1)/this._bevelSegments*Math.PI/2;v=(1-Math.sin(t))*this._bevel;break}for(let t=0;t<p.vertexIndices.length;t++){let[e,i]=p.vertexIndices[t];if(e===i)continue;let n=i;i<e&&(n+=r);for(let s=e;s<n;s++){let n=s%r,a=(s+1)%r;if(!h.continuous[n]||!h.continuous[a]){p.vertexIndices[t]=[e,n],p.vertexIndices.splice(t+1,0,[a,i]),p.vertices.splice(2*(t+1),0,p.vertices[2*t],p.vertices[2*t+1]);break}}}g.push({bevelI:a,angle:e,size:i,boundary:p,reverseMap:u,insetPoints:s})}let y=(t,e,i)=>{let n=0,r=t.boundary.vertexIndices.length;for(;n<r&&i(t.boundary.vertexIndices[e]);)e=(e+1)%r,n++;return n},w=b.length;for(let n=1;n<g.length;n++){let t=g[n-1],e=g[n],i=t.boundary.vertexIndices.length,s=e.boundary.vertexIndices.length;if(!i||!s)break;let o=h.concave.length,l=0,c=SF(l,r);for(;!t.boundary.vertexIndices.filter(c).length||!e.boundary.vertexIndices.filter(c).length;)l++,c=SF(l,r);let u=t.boundary.vertexIndices.findIndex(c),d=e.boundary.vertexIndices.findIndex(c);do{u=(u+1)%i}while(c(t.boundary.vertexIndices[u]));do{d=(d+1)%s}while(c(e.boundary.vertexIndices[d]));l=(l+1)%r;let p,f,m=l,v=0,x=this._buildBevelVert(h,t,(u-1+i)%i,void 0,v),w=this._buildBevelVert(h,e,(d-1+s)%s,void 0,v),S=!1;do{v=(l||o)/o,c=SF(l,r);let n=y(t,u,c),m=y(e,d,c),g=S;if(S=!1,n&&!m){for(let e=0;e<n;e++)p=this._buildBevelVert(h,t,(u+e)%i,e/(n-1),v),b.push(x.topN,p.topP,w.topN),!1===a&&b.push(p.bottomP,x.bottomN,w.bottomN),x=p;S=!0}else if(!n&&m)for(let t=0;t<m;t++)f=this._buildBevelVert(h,e,(d+t)%s,t/(m-1),v),b.push(w.topN,x.topP,f.topP),!1===a&&b.push(x.bottomP,w.bottomN,f.bottomP),w=f;else if(n&&m)if(p=this._buildBevelVert(h,t,u,0,v),f=this._buildBevelVert(h,e,d,0,v),g?(b.push(x.topN,f.topP,w.topN),b.push(x.topN,p.topP,f.topP),!1===a&&(b.push(f.bottomP,x.bottomN,w.bottomN),b.push(f.bottomP,p.bottomP,x.bottomN))):(b.push(w.topN,x.topN,p.topP),b.push(w.topN,p.topP,f.topP),!1===a&&(b.push(p.bottomP,x.bottomN,w.bottomN),b.push(p.bottomP,w.bottomN,f.bottomP))),x=p,w=f,n===m)for(let r=1;r<n;r++)p=this._buildBevelVert(h,t,(u+r)%i,r/(n-1),v),f=this._buildBevelVert(h,e,(d+r)%s,r/(m-1),v),b.push(x.topN,p.topP,w.topN),b.push(w.topN,p.topP,f.topP),!1===a&&(b.push(p.bottomP,x.bottomN,w.bottomN),b.push(p.bottomP,w.bottomN,f.bottomP)),x=p,w=f;else if(n>m){let r=n/m,o=0;for(let l=1;l<n;l++)p=this._buildBevelVert(h,t,(u+l)%i,l/(n-1),v),b.push(x.topN,p.topP,w.topN),!1===a&&b.push(p.bottomP,x.bottomN,w.bottomN),x=p,l>(o+1)*r&&(o++,f=this._buildBevelVert(h,e,(d+o)%s,o/(m-1),v),b.push(w.topN,p.topP,f.topP),!1===a&&b.push(p.bottomP,w.bottomN,f.bottomP),w=f)}else{let r=m/n,o=0;for(let l=1;l<m;l++)f=this._buildBevelVert(h,e,(d+l)%s,l/(m-1),v),b.push(w.topN,p.topP,f.topP),!1===a&&b.push(p.bottomP,w.bottomN,f.bottomP),w=f,l>(o+1)*r&&(o++,p=this._buildBevelVert(h,t,(u+o)%i,o/(n-1),v),b.push(x.topN,p.topP,w.topN),!1===a&&b.push(p.bottomP,x.bottomN,w.bottomN),x=p)}u=(u+n)%i,d=(d+m)%s,l=(l+1)%o}while(l!==m)}if(!1===a&&this._depth>2*this._bevel&&this._buildWall(g,h,b),t){let t=[];for(let e=b.length-1;e>=w+2;e-=3){let i=b[e-2],n=b[e-1],r=b[e-0];t.push(r,n,i)}b.splice(w,b.length-w,...t)}if(t){let t=[];for(let e=g[g.length-1].boundary.vertices.length-1;e>=1;e-=2){let i=g[g.length-1].boundary.vertices[e-1],n=g[g.length-1].boundary.vertices[e-0];t.push(i,n)}x.push(t)}if(!t){let t,e=g[g.length-1];try{t=dF({windingRule:g.length>1?zz.POSITIVE:zz.ODD,elementType:Nz.POLYGONS,vertexSize:2,strict:!0,contours:[e.insetPoints,...x]})}catch{t=wF}if(!t)throw new Error("Error generating geometry for surface");0===u.length&&this._bevel<o&&Object.assign(this,{useNgonForTopBottomFaceDuringBake:!0});for(let i=0;i<3*t.elementCount;i+=3){let e=this._buildSurfaceVert(t,t.elements[i+0],v),n=this._buildSurfaceVert(t,t.elements[i+1],v),r=this._buildSurfaceVert(t,t.elements[i+2],v);b.push(e.top,n.top,r.top),!1===a&&b.push(r.bottom,n.bottom,e.bottom)}}this.vertexCache={}}this._buffer.shrink();let w=new Rg(Uint32Array.from(b),1),S=new Rg(this._buffer.positions,3),A=new Rg(this._buffer.normals,3),E=new Rg(this._buffer.uvs,2);S.needsUpdate=!0,A.needsUpdate=!0,E.needsUpdate=!0,w.needsUpdate=!0,this.setAttribute("position",S),this.setAttribute("normal",A),this.setAttribute("uv",E),this.setIndex(w)}_computeBufferEstimatedSize(t){return 2*t.vertexCount*(2+this._bevelSegments)}_buildWall(t,e,i){let n=t[0];for(let r=0,s=n.boundary.vertexCount;r<s;r++){let t=this._buildBevelVert(e,n,r),a=this._buildBevelVert(e,n,(r+1)%s);i.push(a.topP,t.topN,t.bottomN),i.push(a.topP,t.bottomN,a.bottomP)}}_buildSurfaceVert(t,e,i){let n=e.toString();if(n in this.vertexCache)return this.vertexCache[n];let r=t.vertices[2*e+0],s=t.vertices[2*e+1],a=(r-this._minX)/this._width,o=(s-this._minY)/this._height;this.forPathBevel&&(o=1);let l=this._buffer.get(this.forPathBevel?1:2),h=3*l,c=2*l,u={top:l+0,bottom:l+1};return this._buffer.positions[h+0]=r,this._buffer.positions[h+1]=s,this._buffer.positions[h+2]=this.forPathBevel?this._bevel:this._depth-i,this._buffer.normals[h+0]=0,this._buffer.normals[h+1]=0,this._buffer.normals[h+2]=1,this._buffer.uvs[c+0]=a,this._buffer.uvs[c+1]=o,!1===this.forPathBevel&&(this._buffer.positions[h+3]=r,this._buffer.positions[h+4]=s,this._buffer.positions[h+5]=i,this._buffer.normals[h+3]=0,this._buffer.normals[h+4]=0,this._buffer.normals[h+5]=-1,this._buffer.uvs[c+2]=a,this._buffer.uvs[c+3]=o),this.vertexCache[n]=u,u}_buildBevelVert(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4?arguments[4]:void 0,s=`${e.bevelI}:${i}`;if(s in this.vertexCache&&0!==r&&1!==r&&(!r||r===this.vertexCache[s].pathBevelUCoord))return this.vertexCache[s];let a,o,l,h,[c,u]=e.boundary.vertexIndices[i];c!==u?(o=c,a=u,h=!1,l=t.continuous[o]&&t.continuous[a]):(a=c,o=(a-1+t.count)%t.count,h=t.concave[a]&&e.bevelI>0,l=t.continuous[a]||h);let d=Math.cos(e.angle),p=Math.sin(e.angle),f=2*i,m=2*a,g=2*o,v=e.boundary.vertices[f+0],y=e.boundary.vertices[f+1],b=(1-p)*this._bevel,x=(v-this._minX)/this._width,w=(y-this._minY)/this._height;this.forPathBevel&&(void 0!==r&&(x=r),w=1);let S=t.normals[m+0],A=t.normals[m+1],E=t.normals[g+0],_=t.normals[g+1];if(h){S+=(E-S)*(1-n),A+=(_-A)*(1-n);let t=Math.sqrt(S*S+A*A);S/=t,A/=t}let C=this.forPathBevel?this._buffer.get(l?1:2):this._buffer.get(l?2:4),M=3*C,P=2*C,T={i:i,fi:a,topP:C+0,topN:C+0,bottomP:C+1,bottomN:C+1,pathBevelUCoord:r};return this._buffer.positions[M+0]=v,this._buffer.positions[M+1]=y,this._buffer.positions[M+2]=(this.forPathBevel?this._bevel:this._depth)-b,this._buffer.normals[M+0]=S*d,this._buffer.normals[M+1]=A*d,this._buffer.normals[M+2]=p,this._buffer.uvs[P+0]=x,this._buffer.uvs[P+1]=w,!1===this.forPathBevel&&(this._buffer.positions[M+3]=v,this._buffer.positions[M+4]=y,this._buffer.positions[M+5]=b,this._buffer.normals[M+3]=S*d,this._buffer.normals[M+4]=A*d,this._buffer.normals[M+5]=-p,this._buffer.uvs[P+2]=w,this._buffer.uvs[P+3]=x),l||(this.forPathBevel?(C+=1,M+=3,P+=2):(C+=2,M+=6,P+=4),T.topP=C+0,T.bottomP=C+1,this._buffer.positions[M+0]=v,this._buffer.positions[M+1]=y,this._buffer.positions[M+2]=(this.forPathBevel?this._bevel:this._depth)-b,this._buffer.normals[M+0]=E*d,this._buffer.normals[M+1]=_*d,this._buffer.normals[M+2]=p,this._buffer.uvs[P+0]=x,this._buffer.uvs[P+1]=w,!1===this.forPathBevel&&(this._buffer.positions[M+3]=v,this._buffer.positions[M+4]=y,this._buffer.positions[M+5]=b,this._buffer.normals[M+3]=E*d,this._buffer.normals[M+4]=_*d,this._buffer.normals[M+5]=-p,this._buffer.uvs[P+2]=w,this._buffer.uvs[P+3]=x)),this.vertexCache[s]=T,T}clone(){let t=new AF(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return t.userData=fP(this.userData),t}},EF=class extends Hg{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.type="ShapeGeometry",this.windingRule=zz.ODD,this.elementType=Nz.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=t,this._curveSegments=e,this._triangulationOptions=Object.assign({windingRule:zz.ODD,elementType:Nz.POLYGONS,polySize:3,vertexSize:2,strict:!0},i);let n,r,s,a=this._shape.extractShapePointsToFlatArray([],this._curveSegments),o=this._shape.shapeHoles.map((t=>t.extractShapePointsToFlatArray([],this._curveSegments))),l=!0,h=!0;for(let d=0,p=a.length/2;d<p;d++){let t=2*d,e=a[t+0],i=a[t+1];if(void 0!==r&&e!==r&&(l=!1),void 0!==s&&i!==s&&(h=!1),r=e,s=i,!l&&!h)break}if(!l&&!h)try{n=dF({contours:[a,...o],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{n=bF}let c=n?.vertexCount??1,u=n?.elementCount??1;if(this._positionAttribute=new Rg(new Float32Array(3*c),3),this._normalAttribute=new Rg(new Float32Array(3*c),3),this._uvAttribute=new Rg(new Float32Array(2*c),2),this._indexAttribute=new Rg(new Uint32Array(3*u),1),n){let t=1/0,e=-1/0,i=1/0,r=-1/0;for(let o=0,l=c;o<l;o++){let s=2*o,a=n.vertices[s+0],l=n.vertices[s+1];a<t&&(t=a),a>e&&(e=a),l<i&&(i=l),l>r&&(r=l)}let s=e-t,a=r-i;for(let o=0,l=c;o<l;o++){let e=2*o,r=n.vertices[e+0],l=n.vertices[e+1],h=(r-t)/s,c=(l-i)/a;this._positionAttribute.setXYZ(o,r,l,0),this._normalAttribute.setXYZ(o,0,0,1),this._uvAttribute.setXY(o,h,c)}for(let o=0,l=u;o<l;o++){let t=3*o,e=n.elements[t+0],i=n.elements[t+1],r=n.elements[t+2];this._indexAttribute.setX(t+0,e),this._indexAttribute.setX(t+1,i),this._indexAttribute.setX(t+2,r)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,3*(n?.elementCount??1))}clone(){let t=new EF(this._shape,this._curveSegments);return t.userData=fP(this.userData),t}},_F=class extends AF{constructor(t,e){super(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:12,arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,arguments.length>5&&void 0!==arguments[5]?arguments[5]:zz.ODD),this.type="ShapeGeometry"}_computeBufferEstimatedSize(t){return 2*t.vertexCount*(2+this._bevelSegments)}_buildWall(t,e,i){let n=t[0];for(let r=0,s=n.boundary.vertexCount;r<s;r++){let t=this._buildBevelVert(e,n,r),a=this._buildBevelVert(e,n,(r+1)%s);i.push(a.topP,t.topN,t.bottomN),i.push(a.topP,t.bottomN,a.bottomP)}}clone(){let t=new _F(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return t.userData=fP(this.userData),t}},CF=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:zz.ODD},t.parameters),n=Math.abs(i.width),r=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=t.shape??e?.shape,o=a?.roundness??i.roundness;void 0!==a&&(a instanceof qz?(a.width!==n||a.height!==r)&&a.applySize(n,r):a=new qz(n,r).fromJSON(a),void 0!==t.parameters?.roundness&&t.parameters?.roundness>0&&a.update());let l=a??new qz(n,r);return{parameters:Object.assign(i,{width:n,height:r,depth:s,roundness:o}),shape:l}}static build(t){let e,{depth:i,extrudeBevelSize:n,extrudeBevelSegments:r,subdivisions:s,roundness:a,windingRule:o}=t.parameters;return t.shape.roundness=a,e=i<=0?new EF(t.shape,s,{windingRule:o}):new _F(t.shape,i,n,s,r,o),Object.assign(e,{userData:{...t,type:"VectorGeometry"}})}},MF=2*Math.PI,PF=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},t.parameters);return i.angle=Nf.clamp(i.angle,0,360),{shape:t.shape&&t.shape instanceof qz?t.shape:new qz,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(t){let e,{width:i,height:n,spikes:r,angle:s,innerRadius:a,depth:o,extrudeBevelSize:l,extrudeBevelSegments:h}=t.parameters,c=t.shape,u=function(t,e,i,n,r,s){if(n>=MF)return r>30||r%4===0?(function(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=.5522847498,o=e*a,l=i*a;t.addPoint(kF(r-e,s,r-e,s-l,r-e,s+l)),t.addPoint(kF(r,s+i,r-o,s+i,r+o,s+i)),t.addPoint(kF(r+e,s,r+e,s+l,r+e,s-l)),t.addPoint(kF(r,s-i,r+o,s-i,r-o,s-i)),n>0&&RF(t,e,i,n)}(t,e,i,s),Math.round(r/4)):TF(t,n,r,e,i,s);n=Math.max(n,.001);let a={x:0,y:i},o=n+.5*Math.PI,l={x:Math.cos(o)*e,y:Math.sin(o)*i},h=Zz({px:a.x,py:a.y,cx:l.x,cy:l.y,rx:e,ry:i,largeArcFlag:n>Math.PI,sweepFlag:!0});return r>30||r%h.length===0?function(t,e,i,n,r,s,a,o){let l=Math.round(r/n.length);t.addPoint(DF(e,i));for(let h=0,c=n.length;h<c;h++){let e=n[h],i=t.points[h],r=DF(e.x,e.y);i.controls[1].position.set(e.x1,e.y1),r.controls[0].position.set(e.x2,e.y2),t.addPoint(r)}return o>0?IF(t,s,a,o):t.addPoint(DF(0,0)),l}(t,a.x,a.y,h,r,e,i,s):TF(t,n,r,e,i,s)}(c,.5*i,.5*n,s*Math.PI/180,r,a);return c.isClosed=!0,c.update(),0===s?(e=new Hg,e.setAttribute("position",new Bg([],3))):e=CF.create({shape:c,parameters:{subdivisions:u,depth:o,extrudeBevelSize:l,extrudeBevelSegments:h}}),Object.assign(e,{userData:{...t,type:"EllipseGeometry"}})}};function TF(t,e,i,n,r,s){let a=-e/i;for(let o=0;o<=i;o++){let e=a*o,i=Math.sin(e)*n,s=Math.cos(e)*r;t.addPoint(DF(i,s))}return e<MF?s>0?IF(t,n,r,s):t.addPoint(DF(0,0)):(t.removePoint(t.points[t.points.length-1]),s>0&&RF(t,n,r,s)),1}function DF(t,e){return new pz(Nf.generateUUID(),new Uf(t,e))}function kF(t,e,i,n,r,s){let a=DF(t,e);return a.controls[0].position.set(i,n),a.controls[1].position.set(r,s),a}function IF(t,e,i,n){OF(t,e,i,n).forEach((e=>t.addPoint(e)))}function RF(t,e,i,n){let r=OF(t,e,i,n),s=new qz;r.forEach((t=>s.addPoint(t))),s.isClosed=!0,t.shapeHoles.push(s)}function OF(t,e,i,n){let r=n*e/100,s=r*(Math.abs(i)/Math.abs(e)),a=new Uf(r/e,s/i),o=t.points.map((t=>{let e=t.clone();return e.uuid=Nf.generateUUID(),e})).reverse();return o.forEach((t=>{t.position.multiply(a);let e=t.controls[0].position.clone().multiply(a),i=t.controls[1].position.clone().multiply(a);t.controls[0].position.copy(i),t.controls[1].position.copy(e)})),o}var LF=new Lg([0,0,0],1),BF=class extends Hg{constructor(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:1,o=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,l=arguments.length>11&&void 0!==arguments[11]?arguments[11]:1;if(super(),0===n)return;let h=t&&1===n;h&&(l=0),o>100&&(o=100),0===o&&(l=0);let c,u,d,p,f,m,g,v,y=()=>new mm,b=new mm,x=y(),w=y(),S=y(),A=y(),E=y(),_=y(),C=y(),M=y(),P=y(),T=y(),D=y(),k=e-2*s+.001,I=k/n,R=Math.ceil(r*n),O=R+1,L=k/R,B=-k/2,z=a+1,F=2*Math.PI/a,N=Math.PI/2/l,U=Math.min((1-o/100)*s,s-.01),V=s-U,j=0,G=2*l+2,H=z*G/2,W=H+z*O,q=Math.max(0,z*(O+G)),[Y,X,Q]=[3,3,2].map((t=>Array(q*t).fill(0))),K=[],Z=i-s;function J(e,i){let n=Math.PI/2;m=i*L,v=2*Math.PI*(m%I)/I+n,m+=B,g=Math.sin(v)*Z,f=Math.cos(v)*Z,t?e.set(f,g,m):e.set(f,m,g)}J(b,-1e-10),J(x,0),A.copy(b),J(b,1);let $=b.distanceTo(x),tt=h?0:V+U,et=$*R+2*tt,it=U,nt=et-tt;for(let ot=0;ot<=R;ot++){J(w,ot),D.subVectors(w,A).normalize(),A.copy(w),P.copy(w).setComponent(+t+1,0).normalize(),T.crossVectors(D,P).normalize();let e=0===ot,i=ot===R,n=e?3*Math.PI/2:N,r=e?it:nt,o=e?z:W,c=e?0:q-z,u=D.clone().multiplyScalar(e?-V:V).add(w),d=D.clone().multiplyScalar(e?-1:1).normalize();for(let t=0;t<z;t++){let p=t*F;if(E.addVectors(b.copy(P).multiplyScalar(s*Math.cos(p)),x.copy(T).multiplyScalar(s*Math.sin(p))),_.copy(E).normalize(),e||i){h||(j=c+t,[0,1,2].forEach((t=>{Y[3*j+t]=u.getComponent(t),X[3*j+t]=d.getComponent(t)})),Q[2*j]=+i,Q[2*j+1]=t/a),x.copy(_).multiplyScalar(U),S.addVectors(w,x);for(let i=0;i<l;i++){let s=i*N+n;C.addVectors(b.copy(D).multiplyScalar(V*Math.sin(s)),x.copy(_).multiplyScalar(V*Math.cos(s))),M.copy(C).normalize(),x.addVectors(S,C),C.normalize(),j=o+i*z+t,[0,1,2].forEach((t=>{Y[3*j+t]=x.getComponent(t),X[3*j+t]=M.getComponent(t)}));let l=+e+Math.sin(s);Q[2*j]=(r+V*l)/et,Q[2*j+1]=t/a}}x.addVectors(w,E),j=H+ot*z+t,[0,1,2].forEach((t=>{Y[3*j+t]=x.getComponent(t),X[3*j+t]=_.getComponent(t)})),Q[2*j]=(tt+ot*$)/et,Q[2*j+1]=t/a}}let rt=O+2*l+2,[st,at]=[+h,rt-1];for(let ot=st;ot<=at-1;ot++){let t=h&&ot===at-1;for(let e=0;e<z-1;e++)c=ot*z+e,u=c+1,d=(t?e:c)+z,p=(t?e+1:u)+z,0===ot?K.push(u,p,d):ot===rt-2?K.push(c,u,d):K.push(c,u,d,u,p,d)}this.setIndex(K),this.setAttribute("position",new Bg(Y,3)),this.setAttribute("normal",new Bg(X,3)),this.setAttribute("uv",new Bg(Q,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let t,e,i,n,r=this.userData.parameters,s=Math.ceil(r.tubularSegments),a=r.radialSegments+1,o=Array.from(this.getIndex().array),l=6*(s-1)*r.radialSegments,h=s,c=h===s;for(let u=0;u<r.radialSegments;u++)t=h*a+u,e=t+1,i=(c?u:t)+a,n=(c?u+1:e)+a,o[l++]=t,o[l++]=e,o[l++]=i,o[l++]=e,o[l++]=n,o[l++]=i;return o.length=l,LF.array=o,LF.count=o.length,LF}},zF=class extends lz{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,n=(1+Math.sqrt(5))/2,r="IcosahedronGeometry";super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],r,t,e,i),this.type=r}static fromJSON(t){return new zF(t.radius,t.corner,t.cornerSides)}},FF=new Wm,NF=new gg,UF=new mm,VF=class extends _f{constructor(){super(),this.uuid=Nf.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(t){let e=(new Vf).getNormalMatrix(t);for(let i=0,n=this.vertices.length;i<n;i++)this.vertices[i].applyMatrix4(t);for(let i=0,n=this.faces.length;i<n;i++){let t=this.faces[i];t.normal.applyMatrix3(e).normalize();for(let i=0,n=t.vertexNormals.length;i<n;i++)t.vertexNormals[i].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(t){return FF.makeRotationX(t),this.applyMatrix4(FF),this}rotateY(t){return FF.makeRotationY(t),this.applyMatrix4(FF),this}rotateZ(t){return FF.makeRotationZ(t),this.applyMatrix4(FF),this}translate(t,e,i){return FF.makeTranslation(t,e,i),this.applyMatrix4(FF),this}scale(t,e,i){return FF.makeScale(t,e,i),this.applyMatrix4(FF),this}lookAt(t){return NF.lookAt(t),NF.updateMatrix(),this.applyMatrix4(NF.matrix),this}fromBufferGeometry(t){let e=this,i=null!==t.index?t.index:void 0,n=t.attributes;if(void 0===n.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let r=n.position,s=n.normal,a=n.color,o=n.uv,l=n.uv2;void 0!==l&&(this.faceVertexUvs[1]=[]);for(let u=0;u<r.count;u++)e.vertices.push((new mm).fromBufferAttribute(r,u)),void 0!==a&&e.colors.push((new nm).fromBufferAttribute(a,u));function h(t,i,n,r){let h=void 0===a?[]:[e.colors[t].clone(),e.colors[i].clone(),e.colors[n].clone()],c=void 0===s?[]:[(new mm).fromBufferAttribute(s,t),(new mm).fromBufferAttribute(s,i),(new mm).fromBufferAttribute(s,n)],u=new GF(t,i,n,c,h,r);e.faces.push(u),void 0!==o&&e.faceVertexUvs[0].push([(new Uf).fromBufferAttribute(o,t),(new Uf).fromBufferAttribute(o,i),(new Uf).fromBufferAttribute(o,n)]),void 0!==l&&e.faceVertexUvs[1].push([(new Uf).fromBufferAttribute(l,t),(new Uf).fromBufferAttribute(l,i),(new Uf).fromBufferAttribute(l,n)])}let c=t.groups;if(c.length>0)for(let u=0;u<c.length;u++){let t=c[u],e=t.start;for(let n=e,r=e+t.count;n<r;n+=3)void 0!==i?h(i.getX(n),i.getX(n+1),i.getX(n+2),t.materialIndex):h(n,n+1,n+2,t.materialIndex)}else if(void 0!==i)for(let u=0;u<i.count;u+=3)h(i.getX(u),i.getX(u+1),i.getX(u+2));else for(let u=0;u<r.count;u+=3)h(u,u+1,u+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(UF).negate(),this.translate(UF.x,UF.y,UF.z),this}normalize(){this.computeBoundingSphere();let t=this.boundingSphere.center,e=this.boundingSphere.radius,i=0===e?1:1/e,n=new Wm;return n.set(i,0,0,-i*t.x,0,i,0,-i*t.y,0,0,i,-i*t.z,0,0,0,1),this.applyMatrix4(n),this}computeFaceNormals(){let t=new mm,e=new mm;for(let i=0,n=this.faces.length;i<n;i++){let n=this.faces[i],r=this.vertices[n.a],s=this.vertices[n.b],a=this.vertices[n.c];t.subVectors(a,s),e.subVectors(r,s),t.cross(e),t.normalize(),n.normal.copy(t)}}computeVertexNormals(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=new Array(this.vertices.length);for(let i=0,n=this.vertices.length;i<n;i++)e[i]=new mm;if(t){let t=new mm,i=new mm;for(let n=0,r=this.faces.length;n<r;n++){let r=this.faces[n],s=this.vertices[r.a],a=this.vertices[r.b],o=this.vertices[r.c];t.subVectors(o,a),i.subVectors(s,a),t.cross(i),e[r.a].add(t),e[r.b].add(t),e[r.c].add(t)}}else{this.computeFaceNormals();for(let t=0,i=this.faces.length;t<i;t++){let i=this.faces[t];e[i.a].add(i.normal),e[i.b].add(i.normal),e[i.c].add(i.normal)}}for(let i=0,n=this.vertices.length;i<n;i++)e[i].normalize();for(let i=0,n=this.faces.length;i<n;i++){let t=this.faces[i],n=t.vertexNormals;3===n.length?(n[0].copy(e[t.a]),n[1].copy(e[t.b]),n[2].copy(e[t.c])):(n[0]=e[t.a].clone(),n[1]=e[t.b].clone(),n[2]=e[t.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let t=0,e=this.faces.length;t<e;t++){let e=this.faces[t],i=e.vertexNormals;3===i.length?(i[0].copy(e.normal),i[1].copy(e.normal),i[2].copy(e.normal)):(i[0]=e.normal.clone(),i[1]=e.normal.clone(),i[2]=e.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let e=0,i=this.faces.length;e<i;e++){let t=this.faces[e];t.__originalFaceNormal?t.__originalFaceNormal.copy(t.normal):t.__originalFaceNormal=t.normal.clone(),t.__originalVertexNormals||(t.__originalVertexNormals=[]);for(let e=0,i=t.vertexNormals.length;e<i;e++)t.__originalVertexNormals[e]?t.__originalVertexNormals[e].copy(t.vertexNormals[e]):t.__originalVertexNormals[e]=t.vertexNormals[e].clone()}let t=new VF;t.faces=this.faces;for(let e=0,i=this.morphTargets.length;e<i;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];let t=this.morphNormals[e].faceNormals,i=this.morphNormals[e].vertexNormals;for(let e=0,n=this.faces.length;e<n;e++){let e=new mm,n={a:new mm,b:new mm,c:new mm};t.push(e),i.push(n)}}let i=this.morphNormals[e];t.vertices=this.morphTargets[e].vertices,t.computeFaceNormals(),t.computeVertexNormals();for(let t=0,e=this.faces.length;t<e;t++){let e=this.faces[t],n=i.faceNormals[t],r=i.vertexNormals[t];n.copy(e.normal),r.a.copy(e.vertexNormals[0]),r.b.copy(e.vertexNormals[1]),r.c.copy(e.vertexNormals[2])}}for(let e=0,i=this.faces.length;e<i;e++){let t=this.faces[e];t.normal=t.__originalFaceNormal,t.vertexNormals=t.__originalVertexNormals}}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new ym),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Bm),this.boundingSphere.setFromPoints(this.vertices)}merge(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!t||!t.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);let n,r=this.vertices.length,s=this.vertices,a=t.vertices,o=this.faces,l=t.faces,h=this.colors,c=t.colors;void 0!==e&&(n=(new Vf).getNormalMatrix(e));for(let u=0,d=a.length;u<d;u++){let t=a[u].clone();void 0!==e&&t.applyMatrix4(e),s.push(t)}for(let u=0,d=c.length;u<d;u++)h.push(c[u].clone());for(let u=0,d=l.length;u<d;u++){let t,e,s=l[u],a=s.vertexNormals,h=s.vertexColors,c=new GF(s.a+r,s.b+r,s.c+r);c.normal.copy(s.normal),void 0!==n&&c.normal.applyMatrix3(n).normalize();for(let i=0,r=a.length;i<r;i++)t=a[i].clone(),void 0!==n&&t.applyMatrix3(n).normalize(),c.vertexNormals.push(t);c.color.copy(s.color);for(let i=0,n=h.length;i<n;i++)e=h[i],c.vertexColors.push(e.clone());c.materialIndex=s.materialIndex+i,o.push(c)}for(let u=0,d=t.faceVertexUvs.length;u<d;u++){let e=t.faceVertexUvs[u];void 0===this.faceVertexUvs[u]&&(this.faceVertexUvs[u]=[]);for(let t=0,i=e.length;t<i;t++){let i=e[t],n=[];for(let t=0,e=i.length;t<e;t++)n.push(i[t].clone());this.faceVertexUvs[u].push(n)}}}mergeMesh(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)}mergeVertices(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,e={},i=[],n=[],r=Math.pow(10,t);for(let o=0,l=this.vertices.length;o<l;o++){let t=this.vertices[o],s=Math.round(t.x*r)+"_"+Math.round(t.y*r)+"_"+Math.round(t.z*r);void 0===e[s]?(e[s]=o,i.push(this.vertices[o]),n[o]=i.length-1):n[o]=n[e[s]]}let s=[];for(let o=0,l=this.faces.length;o<l;o++){let t=this.faces[o];t.a=n[t.a],t.b=n[t.b],t.c=n[t.c];let e=[t.a,t.b,t.c];for(let i=0;i<3;i++)if(e[i]===e[(i+1)%3]){s.push(o);break}}for(let o=s.length-1;o>=0;o--){let t=s[o];this.faces.splice(t,1);for(let e=0,i=this.faceVertexUvs.length;e<i;e++)this.faceVertexUvs[e].splice(t,1)}let a=this.vertices.length-i.length;return this.vertices=i,a}setFromPoints(t){this.vertices=[];for(let e=0,i=t.length;e<i;e++){let i=t[e];this.vertices.push(new mm(i.x,i.y,i.z||0))}return this}sortFacesByMaterialIndex(){let t=this.faces,e=t.length;for(let a=0;a<e;a++)t[a]._id=a;t.sort((function(t,e){return t.materialIndex-e.materialIndex}));let i,n,r=this.faceVertexUvs[0],s=this.faceVertexUvs[1];r&&r.length===e&&(i=[]),s&&s.length===e&&(n=[]);for(let a=0;a<e;a++){let e=t[a]._id;i&&i.push(r[e]),n&&n.push(s[e])}i&&(this.faceVertexUvs[0]=i),n&&(this.faceVertexUvs[1]=n)}toJSON(){let t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){let e=this.parameters;for(let i in e)void 0!==e[i]&&(t[i]=e[i]);return t}let e=[];for(let p=0;p<this.vertices.length;p++){let t=this.vertices[p];e.push(t.x,t.y,t.z)}let i=[],n=[],r={},s=[],a={},o=[],l={};for(let p=0;p<this.faces.length;p++){let t=this.faces[p],e=!0,n=!1,r=void 0!==this.faceVertexUvs[0][p],s=t.normal.length()>0,a=t.vertexNormals.length>0,o=1!==t.color.r||1!==t.color.g||1!==t.color.b,l=t.vertexColors.length>0,f=0;if(f=h(f,0,0),f=h(f,1,e),f=h(f,2,n),f=h(f,3,r),f=h(f,4,s),f=h(f,5,a),f=h(f,6,o),f=h(f,7,l),i.push(f),i.push(t.a,t.b,t.c),i.push(t.materialIndex),r){let t=this.faceVertexUvs[0][p];i.push(d(t[0]),d(t[1]),d(t[2]))}if(s&&i.push(c(t.normal)),a){let e=t.vertexNormals;i.push(c(e[0]),c(e[1]),c(e[2]))}if(o&&i.push(u(t.color)),l){let e=t.vertexColors;i.push(u(e[0]),u(e[1]),u(e[2]))}}function h(t,e,i){return i?t|1<<e:t&~(1<<e)}function c(t){let e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==r[e]||(r[e]=n.length/3,n.push(t.x,t.y,t.z)),r[e]}function u(t){let e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==a[e]||(a[e]=s.length,s.push(t.getHex())),a[e]}function d(t){let e=t.x.toString()+t.y.toString();return void 0!==l[e]||(l[e]=o.length/2,o.push(t.x,t.y)),l[e]}return t.data={},t.data.vertices=e,t.data.normals=n,s.length>0&&(t.data.colors=s),o.length>0&&(t.data.uvs=[o]),t.data.faces=i,t}clone(){return(new VF).copy(this)}copy(t){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;let e=t.vertices;for(let u=0,d=e.length;u<d;u++)this.vertices.push(e[u].clone());let i=t.colors;for(let u=0,d=i.length;u<d;u++)this.colors.push(i[u].clone());let n=t.faces;for(let u=0,d=n.length;u<d;u++)this.faces.push(n[u].clone());for(let u=0,d=t.faceVertexUvs.length;u<d;u++){let e=t.faceVertexUvs[u];void 0===this.faceVertexUvs[u]&&(this.faceVertexUvs[u]=[]);for(let t=0,i=e.length;t<i;t++){let i=e[t],n=[];for(let t=0,e=i.length;t<e;t++){let e=i[t];n.push(e.clone())}this.faceVertexUvs[u].push(n)}}let r=t.morphTargets;for(let u=0,d=r.length;u<d;u++){let t={};if(t.name=r[u].name,void 0!==r[u].vertices){t.vertices=[];for(let e=0,i=r[u].vertices.length;e<i;e++)t.vertices.push(r[u].vertices[e].clone())}if(void 0!==r[u].normals){t.normals=[];for(let e=0,i=r[u].normals.length;e<i;e++)t.normals.push(r[u].normals[e].clone())}this.morphTargets.push(t)}let s=t.morphNormals;for(let u=0,d=s.length;u<d;u++){let t={};if(void 0!==s[u].vertexNormals){t.vertexNormals=[];for(let e=0,i=s[u].vertexNormals.length;e<i;e++){let i=s[u].vertexNormals[e],n={};n.a=i.a.clone(),n.b=i.b.clone(),n.c=i.c.clone(),t.vertexNormals.push(n)}}if(void 0!==s[u].faceNormals){t.faceNormals=[];for(let e=0,i=s[u].faceNormals.length;e<i;e++)t.faceNormals.push(s[u].faceNormals[e].clone())}this.morphNormals.push(t)}let a=t.skinWeights;for(let u=0,d=a.length;u<d;u++)this.skinWeights.push(a[u].clone());let o=t.skinIndices;for(let u=0,d=o.length;u<d;u++)this.skinIndices.push(o[u].clone());let l=t.lineDistances;for(let u=0,d=l.length;u<d;u++)this.lineDistances.push(l[u]);let h=t.boundingBox;null!==h&&(this.boundingBox=h.clone());let c=t.boundingSphere;return null!==c&&(this.boundingSphere=c.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}toBufferGeometry(){let t=(new jF).fromGeometry(this),e=new Hg,i=new Float32Array(3*t.vertices.length);if(e.setAttribute("position",YF.call(new Rg(i,3),t.vertices)),t.normals.length>0){let i=new Float32Array(3*t.normals.length);e.setAttribute("normal",YF.call(new Rg(i,3),t.normals))}if(t.colors.length>0){let i=new Float32Array(3*t.colors.length);e.setAttribute("color",WF.call(new Rg(i,3),t.colors))}if(t.uvs.length>0){let i=new Float32Array(2*t.uvs.length);e.setAttribute("uv",qF.call(new Rg(i,2),t.uvs))}if(t.uvs2.length>0){let i=new Float32Array(2*t.uvs2.length);e.setAttribute("uv2",qF.call(new Rg(i,2),t.uvs2))}e.groups=t.groups;for(let n in t.morphTargets){let i=[],r=t.morphTargets[n];for(let t=0,e=r.length;t<e;t++){let e=r[t],n=new Bg(3*e.data.length,3);n.name=e.name,i.push(YF.call(n,e.data))}e.morphAttributes[n]=i}if(t.skinIndices.length>0){let i=new Bg(4*t.skinIndices.length,4);e.setAttribute("skinIndex",XF.call(i,t.skinIndices))}if(t.skinWeights.length>0){let i=new Bg(4*t.skinWeights.length,4);e.setAttribute("skinWeight",XF.call(i,t.skinWeights))}return null!==t.boundingSphere&&(e.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(e.boundingBox=t.boundingBox.clone()),e}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(t){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(t){let e=new Hg,i=t.geometry;if(t.isPoints||t.isLine){let t=new Bg(3*i.vertices.length,3),n=new Bg(3*i.colors.length,3);if(e.setAttribute("position",YF.call(t,i.vertices)),e.setAttribute("color",WF.call(n,i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){let t=new Bg(i.lineDistances.length,1);e.setAttribute("lineDistance",HF.call(t,i.lineDistances))}null!==i.boundingSphere&&(e.boundingSphere=i.boundingSphere.clone()),null!==i.boundingBox&&(e.boundingBox=i.boundingBox.clone())}else t.isMesh&&(e=i.toBufferGeometry());return e}};VF.prototype.isGeometry=!0;var jF=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(t){let e,i,n,r=[],s=t.faces;for(i=0;i<s.length;i++){let t=s[i];t.materialIndex!==n&&(n=t.materialIndex,void 0!==e&&(e.count=3*i-e.start,r.push(e)),e={start:3*i,materialIndex:n})}void 0!==e&&(e.count=3*i-e.start,r.push(e)),this.groups=r}fromGeometry(t){let e,i=t.faces,n=t.vertices,r=t.faceVertexUvs,s=r[0]&&r[0].length>0,a=r[1]&&r[1].length>0,o=t.morphTargets,l=o.length;if(l>0){e=[];for(let t=0;t<l;t++)e[t]={name:o[t].name,data:[]};this.morphTargets.position=e}let h,c=t.morphNormals,u=c.length;if(u>0){h=[];for(let t=0;t<u;t++)h[t]={name:c[t].name,data:[]};this.morphTargets.normal=h}let d=t.skinIndices,p=t.skinWeights,f=d.length===n.length,m=p.length===n.length;n.length>0&&0===i.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let g=0;g<i.length;g++){let t=i[g];this.vertices.push(n[t.a],n[t.b],n[t.c]);let v=t.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{let e=t.normal;this.normals.push(e,e,e)}let y=t.vertexColors;if(3===y.length)this.colors.push(y[0],y[1],y[2]);else{let e=t.color;this.colors.push(e,e,e)}if(!0===s){let t=r[0][g];void 0!==t?this.uvs.push(t[0],t[1],t[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",g),this.uvs.push(new Uf,new Uf,new Uf))}if(!0===a){let t=r[1][g];void 0!==t?this.uvs2.push(t[0],t[1],t[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",g),this.uvs2.push(new Uf,new Uf,new Uf))}for(let i=0;i<l;i++){let n=o[i].vertices;e[i].data.push(n[t.a],n[t.b],n[t.c])}for(let e=0;e<u;e++){let t=c[e].vertexNormals[g];h[e].data.push(t.a,t.b,t.c)}f&&this.skinIndices.push(d[t.a],d[t.b],d[t.c]),m&&this.skinWeights.push(p[t.a],p[t.b],p[t.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}},GF=class{constructor(t,e,i,n,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.a=t,this.b=e,this.c=i,this.normal=n&&n.isVector3?n:new mm,this.vertexNormals=Array.isArray(n)?n:[],this.color=r&&r.isColor?r:new nm,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=s}clone(){return(new this.constructor).copy(this)}copy(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(let e=0,i=t.vertexNormals.length;e<i;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(let e=0,i=t.vertexColors.length;e<i;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}};function HF(t){return this.array.set(t),this}function WF(t){let e=this.array,i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),r=new nm),e[i++]=r.r,e[i++]=r.g,e[i++]=r.b}return this}function qF(t){let e=this.array,i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),r=new Uf),e[i++]=r.x,e[i++]=r.y}return this}function YF(t){let e=this.array,i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),r=new mm),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z}return this}function XF(t){let e=this.array,i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),r=new cm),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z,e[i++]=r.w}return this}var QF=["a","b","c"];function KF(t,e){switch(e){case"c":return t.c;case"b":return t.b;default:return t.a}}function ZF(t,e,i){let n=Math.min(t,e)+"_"+Math.max(t,e);return i.get(n)}function JF(t,e,i,n,r,s){let a,o=Math.min(t,e),l=Math.max(t,e),h=o+"_"+l;if(n.has(h))a=n.get(h);else{a={a:i[o],b:i[l],newEdge:null,faces:[]},n.set(h,a)}a.faces.push(r),s[t].edges.push(a),s[e].edges.push(a)}function $F(t,e,i,n,r){t.push(new GF(e,i,n,void 0,void 0,r))}function tN(t,e){return Math.abs(e-t)/2+Math.min(t,e)}function eN(t,e,i,n){t.push([e.clone(),i.clone(),n.clone()])}var iN=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.subdivisions=t}modify(t){(t=t instanceof Hg?(new VF).fromBufferGeometry(t):t.clone()).mergeVertices();let e=this.subdivisions;for(;e-- >0;)this._smooth(t);return t.computeFaceNormals(),t.computeVertexNormals(),t}_smooth(t){let e,i,n,r,s,a=new mm,o=t.vertices,l=t.faces,h=t.faceVertexUvs[0],c=void 0!==h&&h.length>0,u=[],d=new Map;!function(t,e,i,n){let r,s,a;for(r=0,s=t.length;r<s;r++)i[r]={edges:[]};for(r=0,s=e.length;r<s;r++)a=e[r],JF(a.a,a.b,t,n,a,i),JF(a.b,a.c,t,n,a,i),JF(a.c,a.a,t,n,a,i)}(o,l,u,d);let p,f,m,g,v,y,b,x=[];for(let G of Array.from(d.keys())){for(f=d.get(G),m=new mm,v=3/8,y=1/8,b=f.faces.length,2!=b&&(v=.5,y=0),m.addVectors(f.a,f.b).multiplyScalar(v),a.set(0,0,0),r=0;r<b;r++){for(g=f.faces[r],s=0;s<3&&(p=o[KF(g,QF[s])],p===f.a||p===f.b);s++);p&&a.add(p)}a.multiplyScalar(y),m.add(a),f.newEdge=x.length,x.push(m)}let w,S,A,E,_,C,M,P=[];for(i=0,n=o.length;i<n;i++){for(C=o[i],_=u[i].edges,e=_.length,3==e?w=3/16:e>3&&(w=3/(8*e)),S=1-e*Number(w),A=w,e<=2&&(2==e&&(S=3/4,A=1/8)),M=C.clone().multiplyScalar(S),a.set(0,0,0),r=0;r<e;r++)E=_[r],p=E.a!==C?E.a:E.b,a.add(p);a.multiplyScalar(Number(A)),M.add(a),P.push(M)}let T,D,k,I,R,O,L,B=P.concat(x),z=P.length,F=[],N=[],U=new Uf,V=new Uf,j=new Uf;for(i=0,n=l.length;i<n;i++)g=l[i],T=Number(ZF(g.a,g.b,d).newEdge)+z,D=Number(ZF(g.b,g.c,d).newEdge)+z,k=Number(ZF(g.c,g.a,d).newEdge)+z,$F(F,T,D,k,g.materialIndex),$F(F,g.a,T,k,g.materialIndex),$F(F,g.b,D,T,g.materialIndex),$F(F,g.c,k,D,g.materialIndex),c&&(I=h[i],R=I[0],O=I[1],L=I[2],U.set(tN(R.x,O.x),tN(R.y,O.y)),V.set(tN(O.x,L.x),tN(O.y,L.y)),j.set(tN(R.x,L.x),tN(R.y,L.y)),eN(N,U,V,j),eN(N,R,U,j),eN(N,O,V,U),eN(N,L,j,V));t.vertices=B,t.faces=F,c&&(t.faceVertexUvs[0]=N)}},nN=new mm,rN=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},t.parameters);return{shape:t.shape&&t.shape instanceof qz?t.shape:new qz,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(t){let{width:e,height:i,spikes:n,cornerRadius:r,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}=t.parameters,l=t.shape,h=.5*e,c=.5*i,u=2*Math.PI/n;for(let p=0;p<n;p++){let t=u*p,e=0+Math.sin(t)*h,i=0+Math.cos(t)*c;l.addPoint(l.createPoint(e,i))}l.isClosed=!0;for(let p=0,f=l.points.length;p<f;p++)l.points[p].roundness=r;l.roundness=r,l.update();let d=CF.create({shape:l,parameters:{roundness:r,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}});return Object.assign(d,{userData:{...t,type:"PolygonGeometry"}})}};function sN(t,e,i){i.x=t.x*e.x,i.y=t.y,i.z=t.x*e.y}function aN(t,e,i,n,r,s){let a=e.clone().sub(t),o=i.clone().sub(t),l=a.angleTo(o);if(a.normalize(),o.normalize(),n===r){let e=a.add(o).normalize();s.copy(t).addScaledVector(e,n/Math.sin(l/2))}else{let e=a.angleTo(o);s.copy(t),s.addScaledVector(a,r/Math.sin(e)),s.addScaledVector(o,n/Math.sin(e))}}function oN(t,e,i){let n=t.clone().sub(e),r=i.clone().sub(e);return n.projectOnVector(r),n.add(e)}var lN=class extends Hg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:4;super(),i=Math.floor(Math.max(3,i)),n=Math.floor(n),a=Math.floor(a);let o,l=[],h=[],c=[],u=[],d=0,p=e/2,f=Math.PI/i,m=t*Math.cos(Math.PI/i),g=2*Math.PI/i,v=(i-2)*Math.PI/i,y=Math.PI-v,b=new mm(0,-p,0),x=new mm(0,p,0),w=new Uf(t,-p),S=new Uf(m,-p),A=new Uf(0,x.y).sub(S),E=new Uf(0,x.y).sub(w),_=new Uf(A.y,-A.x).normalize(),C=new Uf(E.y,-E.x).normalize(),M=t*Math.cos(Math.PI/i)*Math.tan((Math.PI-A.angle())/2)-1e-8;s=Math.min(s,M);{let t=new mm(_.x,_.y,0),e=new mm(Math.cos(g)*t.x,t.y,Math.sin(g)*t.x);o=t.angleTo(e)}let P=s/Math.tan((Math.PI-A.angle())/2),T=s/Math.tan((Math.PI-o)/2),D=new mm;if(!r){h.push(b.x,b.y,b.z),c.push(0,-1,0),u.push(0,0);let t=d++,e=[],n=w.clone(),r=P/Math.cos(Math.PI/i);n.x-=r;for(let s=0;s<i;s++){let t=s/i*Math.PI*2+f;sN(n,new Uf(Math.sin(t),Math.cos(t)),D),h.push(D.x,D.y,D.z),c.push(0,-1,0),u.push(0,0),e.push(d++)}for(let i=0;i<e.length;i++)l.push(e[i],t,e[(i+1)%e.length])}let k=[];{let t=new mm,e=new mm,n=new mm,r=new mm,p=new mm,m=new mm;for(let g=0;g<i;g++){let v=g/i*Math.PI*2+f,y=(g+.5)/i*Math.PI*2+f,S=(g+1)/i*Math.PI*2+f,E=new Uf(Math.sin(v),Math.cos(v)),M=new Uf(Math.sin(y),Math.cos(y)),D=new Uf(Math.sin(S),Math.cos(S));sN(w,E,e),sN(w,D,n),sN(_,M,t),aN(x,e,n,T,T,r),h.push(r.x,r.y,r.z),aN(e,x,n,T,P,p),h.push(p.x,p.y,p.z),aN(n,e,x,P,T,m),h.push(m.x,m.y,m.z),c.push(t.x,t.y,t.z),c.push(t.x,t.y,t.z),c.push(t.x,t.y,t.z),u.push(0,0),u.push(0,0),u.push(0,0);let O=d++,L=d++,B=d++;if(l.push(O,L,B),s>0){{let t=e.clone().add(n).multiplyScalar(.5),i=x.clone().sub(t).normalize(),r=b.clone().sub(t).normalize().add(i).normalize().multiplyScalar(-1);I(t,m.clone().sub(p),r,A.angle())}let f,g;{let t=new mm;sN(C,D,t);let e=m.clone().add(r).multiplyScalar(.5);e=oN(e,n,x);let i=m.clone().sub(r);[f,g]=I(e,i,t,o,r.y)}{let t=f,e=t.clone().setY(0).normalize(),i=new mm(0,-1,0),n=e.clone().cross(i);R(t,e,i,n)}k.concat(g);{let e=A.angle(),n=Math.PI-e,r=x.clone();r.y-=s/Math.sin(e-Math.PI/2);let o=new mm,p=[];for(let l=0;l<a;l++){let e=[],f=Math.PI/2-n*l/a,m=Math.cos(f),g=Math.sin(f),v=y;for(let n=0;n<=l;n++){let n=Math.cos(v),a=Math.sin(v);t.x=m*a,t.y=g,t.z=m*n,o.copy(r).addScaledVector(t,s),h.push(o.x,o.y,o.z),c.push(t.x,t.y,t.z),u.push(0,0),e.push(d++),v+=2*Math.PI/l/i}p.push(e)}g.reverse(),p.push(g);let f=p.length-1;for(let t=0;t<f;t++){let e=p[t],i=p[t+1],n=e.length-1;l.push(i[1],e[0],i[0]);for(let t=1;t<=n;t++)l.push(e[t],e[t-1],i[t]),l.push(i[t+1],e[t],i[t])}}}}}function I(t,e,i,n,r){let o=-n/2,p=(Math.PI-n)/2,f=e.clone().normalize().cross(i);t.addScaledVector(i,-s/Math.sin(p));let m=new mm,g=new mm,v=d,y=[];for(let l=0;l<=a;l++){let p=o+l/a*n;g.set(0,0,0),g.addScaledVector(f,Math.sin(p)),g.addScaledVector(i,Math.cos(p));for(let i=0;i<=1;i++){let n=i/1-.5;if(m.copy(t),m.addScaledVector(e,n),m.addScaledVector(g,s),null!=r){let t=Math.max(0,m.y-r);m.addScaledVector(e,-t/e.y)}h.push(m.x,m.y,m.z),c.push(g.x,g.y,g.z),u.push(0,0),0===i&&y.push(d),d++}}for(let s=0;s<a;s++)for(let t=0;t<1;t++){let e=v+t+2*s,i=e+2,n=i+1,r=e+1;l.push(e,i,r),l.push(i,n,r)}return[t.clone().addScaledVector(e,.5),y]}function R(t,e,i,n){let r=Math.PI/2,o=E.angle()-r,p=[],f=new mm,m=new mm;for(let l=0;l<=a;l++){let g=[],v=l/a;for(let a=0;a<=l;a++){let p=((l?a/l:0)-.5)*y,b=Math.cos(p),x=Math.sin(p),w=(r+Math.atan(Math.tan(o)*b))*v,S=Math.cos(w),A=Math.sin(w);f.set(0,0,0),f.addScaledVector(e,A*b),f.addScaledVector(i,S),f.addScaledVector(n,A*x),m.copy(t).addScaledVector(f,s),h.push(m.x,m.y,m.z),c.push(f.x,f.y,f.z),u.push(0,0),g.push(d++)}p.push(g)}let g=p.length-1;for(let s=0;s<g;s++){let t=p[s],e=p[s+1],i=t.length-1;l.push(t[0],e[1],e[0]);for(let n=1;n<=i;n++)l.push(t[n-1],t[n],e[n]),l.push(t[n],e[n+1],e[n])}}this.setIndex(l),this.setAttribute("position",new Bg(h,3)),this.setAttribute("normal",new Bg(c,3)),this.setAttribute("uv",new Bg(u,2))}},hN=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},t.parameters),n=Object.assign(e?.ui??{enabledIndieCorners:!1},t.ui);return{shape:t.shape&&t.shape instanceof qz?t.shape:new qz,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)}),ui:n}}static build(t){let e=t.shape,{width:i,height:n,cornerRadius:r,cornerType:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=t.parameters,h={x:.5*i,y:.5*n},c={x:-h.x,y:-h.y},u={x:h.x,y:h.y};function d(t,e,r){return e>i&&r>n?Math.min(t*i/e,t*n/r):e>i?t*i/e:r>n?t*n/r:t}let p=[];p[0]=0===r[0]?0:d(r[0],r[0]+r[3],r[0]+r[1]),p[1]=0===r[1]?0:d(r[1],r[1]+r[2],r[1]+r[0]),p[2]=0===r[2]?0:d(r[2],r[2]+r[1],r[2]+r[3]),p[3]=0===r[3]?0:d(r[3],r[3]+r[0],r[3]+r[2]);let f=c.x,m=u.x,g=u.y,v=c.y;e.addPoint(e.createPoint(f,g)),e.addPoint(e.createPoint(m,g)),e.addPoint(e.createPoint(m,v)),e.addPoint(e.createPoint(f,v)),e.isClosed=!0;let y=!0;for(let x=0,w=e.points.length;x<w;x++)e.points[x].roundness=p[x],x>0&&p[x]!==p[x-1]&&(y=!1);y&&(e.roundness=p[0]),e.useCubicForRoundedCorners=1!==s,e.update();let b=CF.create({shape:e,parameters:{depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}});return Object.assign(b,{userData:{...t,type:"RectangleGeometry"}})}},cN=class extends Hg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:90,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:24;super(),this.type="BackdropGeometry";let a=[],o=[],l=[],h=.001;0==r&&(s=1),s=Math.max(1,Math.floor(s)),r=Math.min(r,100),n=Math.min(180-h,n),n*=Math.PI/180;let c=[],u=Math.PI/2,d=function(){return new mm(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)},p=d(),f=d(),[m,g,v]=[e/2,t/2,i/2],y=-g,b=+g,[x,w,S]=[d(y,-m,+v),d(y,-m,-v),d(y,+m,-v)],A=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Math.sin(t-Math.PI/(+e+1))},E=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Math.cos(t-Math.PI/(+e+1))};S.y=Math.sin(n)*e-m;let _=Math.cos(n)*e-v,C=x.z-h;n<=u?(S.z=Math.min(_,C),S.z==C&&(S.y-=(_-C)/Math.tan(u-n))):w.z=Math.min(w.z-_-v,x.z-h),p.subVectors(x,w),f.subVectors(S,w);let M=Math.min(p.length(),f.length())*r/100,P=M*Math.tan(n/2),T=M/Math.cos(n/2),D=p.clone().normalize().add(f.normalize()).setLength(T).add(w);p.set(0,A(n,!0),E(n,!0)),c.push([S,p.clone()]);let k=(Math.PI-n)/s;for(let j=0;j<=s;j++){let t=u+n+j*k;p.set(0,Math.sin(t)*P,Math.cos(t)*P),p.add(D),f.set(0,A(t),E(t)),c.push([p.clone(),f.clone()])}c.push([x,d(0,1,0)]);let I=Math.sin(k/2)*P*2,R=c.length-1,O=c[0][0].distanceTo(c[1][0]),L=O+I*s+c[R-1][0].distanceTo(c[R][0]);c[0].push(1);for(let j=0;j<=s;j++)c[j+1].push(1-(O+j*I)/L);c[R].push(0);let B,z,F,[N,U,V]=c[0];for(let j=1;j<c.length;j++)[B,z,F]=c[j],a.push(y,N.y,N.z,y,B.y,B.z,b,N.y,N.z,b,N.y,N.z,y,B.y,B.z,b,B.y,B.z),o.push(0,U.y,U.z,0,z.y,z.z,0,U.y,U.z,0,U.y,U.z,0,z.y,z.z,0,z.y,z.z),l.push(0,V,0,F,1,V,1,V,0,F,1,F),[N,U,V]=[B,z,F];this.setAttribute("position",new Bg(a,3)),this.setAttribute("normal",new Bg(o,3)),this.setAttribute("uv",new Bg(l,2))}},uN=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},t.parameters);return{shape:t.shape&&t.shape instanceof qz?t.shape:new qz,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(t){let{width:e,height:i,innerRadiusPercent:n,spikes:r,cornerRadius:s,angle:a,depth:o,extrudeBevelSize:l,extrudeBevelSegments:h}=t.parameters,c=t.shape,u=.5*e,d=.5*i,p=a*Math.PI/360/r,f=Math.PI/2*3*-1,m=u*n/100,g=d*n/100;if(3===r&&50===n){p=2*Math.PI/r;for(let t=0;t<r;t++){let e=p*t,i=0+Math.sin(e)*u,n=0+Math.cos(e)*d;c.addPoint(c.createPoint(i,n))}}else for(let y=0;y<r;y++){let t=0+Math.cos(f)*u,e=0+Math.sin(f)*d;c.addPoint(c.createPoint(t,e)),f+=p,t=0+Math.cos(f)*m,e=0+Math.sin(f)*g,c.addPoint(c.createPoint(t,e)),f+=p}c.isClosed=!0;for(let y=0,b=c.points.length;y<b;y++)c.points[y].roundness=s;c.roundness=s,c.update();let v=CF.create({shape:c,parameters:{roundness:s,depth:o,extrudeBevelSize:l,extrudeBevelSegments:h}});return Object.assign(v,{userData:{...t,type:"StarGeometry"}})}};var dN={parseRgba:function(t){return/^(rgba)?\(\s*(\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(t.toLowerCase())},hsvToRgb:function(t,e,i){let n,r,s,a=Math.floor(6*t),o=6*t-a,l=i*(1-e),h=i*(1-o*e),c=i*(1-(1-o)*e);switch(a%6){case 0:n=i,r=c,s=l;break;case 1:n=h,r=i,s=l;break;case 2:n=l,r=i,s=c;break;case 3:n=l,r=h,s=i;break;case 4:n=c,r=l,s=i;break;default:n=i,r=l,s=h}return{r:255*n,g:255*r,b:255*s}},rgbToHsv:function(t,e,i){t/=255,e/=255,i/=255;let n,r=Math.max(t,e,i),s=Math.min(t,e,i),a=r,o=r-s,l=0==r?0:o/r;if(r==s)n=0;else{switch(r){case t:n=(e-i)/o+(e<i?6:0);break;case e:n=(i-t)/o+2;break;default:n=(t-e)/o+4}n/=6}return{h:n,s:l,v:a}},hexToRgb:function(t){return{r:(t=Math.floor(t))>>16&255,g:t>>8&255,b:255&t}},rgbToHex:function(t,e,i){return(t<<16)+(e<<8)+i},rgbToHexString:function(t,e,i){return"#"+[t=Math.round(t),e=Math.round(e),i=Math.round(i)].map((t=>t.toString(16).padStart(2,"0"))).join("").toUpperCase()},hexStringToRgb:function(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,((t,e,i,n)=>String(e+e+i+i+n+n)));let e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}},pN=class{static get version(){return"1.3.8"}static toString(){return"JavaScript Expression Parser (JSEP) v"+pN.version}static addUnaryOp(t){return pN.max_unop_len=Math.max(t.length,pN.max_unop_len),pN.unary_ops[t]=1,pN}static addBinaryOp(t,e,i){return pN.max_binop_len=Math.max(t.length,pN.max_binop_len),pN.binary_ops[t]=e,i?pN.right_associative.add(t):pN.right_associative.delete(t),pN}static addIdentifierChar(t){return pN.additional_identifier_chars.add(t),pN}static addLiteral(t,e){return pN.literals[t]=e,pN}static removeUnaryOp(t){return delete pN.unary_ops[t],t.length===pN.max_unop_len&&(pN.max_unop_len=pN.getMaxKeyLen(pN.unary_ops)),pN}static removeAllUnaryOps(){return pN.unary_ops={},pN.max_unop_len=0,pN}static removeIdentifierChar(t){return pN.additional_identifier_chars.delete(t),pN}static removeBinaryOp(t){return delete pN.binary_ops[t],t.length===pN.max_binop_len&&(pN.max_binop_len=pN.getMaxKeyLen(pN.binary_ops)),pN.right_associative.delete(t),pN}static removeAllBinaryOps(){return pN.binary_ops={},pN.max_binop_len=0,pN}static removeLiteral(t){return delete pN.literals[t],pN}static removeAllLiterals(){return pN.literals={},pN}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(t){this.expr=t,this.index=0}static parse(t){return new pN(t).parse()}static getMaxKeyLen(t){return Math.max(0,...Object.keys(t).map((t=>t.length)))}static isDecimalDigit(t){return t>=48&&t<=57}static binaryPrecedence(t){return pN.binary_ops[t]||0}static isIdentifierStart(t){return t>=65&&t<=90||t>=97&&t<=122||t>=128&&!pN.binary_ops[String.fromCharCode(t)]||pN.additional_identifier_chars.has(String.fromCharCode(t))}static isIdentifierPart(t){return pN.isIdentifierStart(t)||pN.isDecimalDigit(t)}throwError(t){let e=new Error(t+" at character "+this.index);throw e.index=this.index,e.description=t,e}runHook(t,e){if(pN.hooks[t]){let i={context:this,node:e};return pN.hooks.run(t,i),i.node}return e}searchHook(t){if(pN.hooks[t]){let e={context:this};return pN.hooks[t].find((function(t){return t.call(e.context,e),e.node})),e.node}}gobbleSpaces(){let t=this.code;for(;t===pN.SPACE_CODE||t===pN.TAB_CODE||t===pN.LF_CODE||t===pN.CR_CODE;)t=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let t=this.gobbleExpressions(),e=1===t.length?t[0]:{type:pN.COMPOUND,body:t};return this.runHook("after-all",e)}gobbleExpressions(t){let e,i,n=[];for(;this.index<this.expr.length;)if(e=this.code,e===pN.SEMCOL_CODE||e===pN.COMMA_CODE)this.index++;else if(i=this.gobbleExpression())n.push(i);else if(this.index<this.expr.length){if(e===t)break;this.throwError('Unexpected "'+this.char+'"')}return n}gobbleExpression(){let t=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",t)}gobbleBinaryOp(){this.gobbleSpaces();let t=this.expr.substr(this.index,pN.max_binop_len),e=t.length;for(;e>0;){if(pN.binary_ops.hasOwnProperty(t)&&(!pN.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!pN.isIdentifierPart(this.expr.charCodeAt(this.index+t.length))))return this.index+=e,t;t=t.substr(0,--e)}return!1}gobbleBinaryExpression(){let t,e,i,n,r,s,a,o,l;if(s=this.gobbleToken(),!s||(e=this.gobbleBinaryOp(),!e))return s;for(r={value:e,prec:pN.binaryPrecedence(e),right_a:pN.right_associative.has(e)},a=this.gobbleToken(),a||this.throwError("Expected expression after "+e),n=[s,r,a];e=this.gobbleBinaryOp();){if(i=pN.binaryPrecedence(e),0===i){this.index-=e.length;break}r={value:e,prec:i,right_a:pN.right_associative.has(e)},l=e;let o=t=>r.right_a&&t.right_a?i>t.prec:i<=t.prec;for(;n.length>2&&o(n[n.length-2]);)a=n.pop(),e=n.pop().value,s=n.pop(),t={type:pN.BINARY_EXP,operator:e,left:s,right:a},n.push(t);t=this.gobbleToken(),t||this.throwError("Expected expression after "+l),n.push(r,t)}for(o=n.length-1,t=n[o];o>1;)t={type:pN.BINARY_EXP,operator:n[o-1].value,left:n[o-2],right:t},o-=2;return t}gobbleToken(){let t,e,i,n;if(this.gobbleSpaces(),n=this.searchHook("gobble-token"),n)return this.runHook("after-token",n);if(t=this.code,pN.isDecimalDigit(t)||t===pN.PERIOD_CODE)return this.gobbleNumericLiteral();if(t===pN.SQUOTE_CODE||t===pN.DQUOTE_CODE)n=this.gobbleStringLiteral();else if(t===pN.OBRACK_CODE)n=this.gobbleArray();else{for(e=this.expr.substr(this.index,pN.max_unop_len),i=e.length;i>0;){if(pN.unary_ops.hasOwnProperty(e)&&(!pN.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!pN.isIdentifierPart(this.expr.charCodeAt(this.index+e.length)))){this.index+=i;let t=this.gobbleToken();return t||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:pN.UNARY_EXP,operator:e,argument:t,prefix:!0})}e=e.substr(0,--i)}pN.isIdentifierStart(t)?(n=this.gobbleIdentifier(),pN.literals.hasOwnProperty(n.name)?n={type:pN.LITERAL,value:pN.literals[n.name],raw:n.name}:n.name===pN.this_str&&(n={type:pN.THIS_EXP})):t===pN.OPAREN_CODE&&(n=this.gobbleGroup())}return n?(n=this.gobbleTokenProperty(n),this.runHook("after-token",n)):this.runHook("after-token",!1)}gobbleTokenProperty(t){this.gobbleSpaces();let e=this.code;for(;e===pN.PERIOD_CODE||e===pN.OBRACK_CODE||e===pN.OPAREN_CODE||e===pN.QUMARK_CODE;){let i;if(e===pN.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==pN.PERIOD_CODE)break;i=!0,this.index+=2,this.gobbleSpaces(),e=this.code}this.index++,e===pN.OBRACK_CODE?(t={type:pN.MEMBER_EXP,computed:!0,object:t,property:this.gobbleExpression()},this.gobbleSpaces(),e=this.code,e!==pN.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):e===pN.OPAREN_CODE?t={type:pN.CALL_EXP,arguments:this.gobbleArguments(pN.CPAREN_CODE),callee:t}:(e===pN.PERIOD_CODE||i)&&(i&&this.index--,this.gobbleSpaces(),t={type:pN.MEMBER_EXP,computed:!1,object:t,property:this.gobbleIdentifier()}),i&&(t.optional=!0),this.gobbleSpaces(),e=this.code}return t}gobbleNumericLiteral(){let t,e,i="";for(;pN.isDecimalDigit(this.code);)i+=this.expr.charAt(this.index++);if(this.code===pN.PERIOD_CODE)for(i+=this.expr.charAt(this.index++);pN.isDecimalDigit(this.code);)i+=this.expr.charAt(this.index++);if(t=this.char,"e"===t||"E"===t){for(i+=this.expr.charAt(this.index++),t=this.char,("+"===t||"-"===t)&&(i+=this.expr.charAt(this.index++));pN.isDecimalDigit(this.code);)i+=this.expr.charAt(this.index++);pN.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+i+this.char+")")}return e=this.code,pN.isIdentifierStart(e)?this.throwError("Variable names cannot start with a number ("+i+this.char+")"):(e===pN.PERIOD_CODE||1===i.length&&i.charCodeAt(0)===pN.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:pN.LITERAL,value:parseFloat(i),raw:i}}gobbleStringLiteral(){let t="",e=this.index,i=this.expr.charAt(this.index++),n=!1;for(;this.index<this.expr.length;){let e=this.expr.charAt(this.index++);if(e===i){n=!0;break}if("\\"===e)switch(e=this.expr.charAt(this.index++),e){case"n":t+="\n";break;case"r":t+="\r";break;case"t":t+="\t";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=e}else t+=e}return n||this.throwError('Unclosed quote after "'+t+'"'),{type:pN.LITERAL,value:t,raw:this.expr.substring(e,this.index)}}gobbleIdentifier(){let t=this.code,e=this.index;for(pN.isIdentifierStart(t)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(t=this.code,pN.isIdentifierPart(t));)this.index++;return{type:pN.IDENTIFIER,name:this.expr.slice(e,this.index)}}gobbleArguments(t){let e=[],i=!1,n=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let r=this.code;if(r===t){i=!0,this.index++,t===pN.CPAREN_CODE&&n&&n>=e.length&&this.throwError("Unexpected token "+String.fromCharCode(t));break}if(r===pN.COMMA_CODE){if(this.index++,n++,n!==e.length)if(t===pN.CPAREN_CODE)this.throwError("Unexpected token ,");else if(t===pN.CBRACK_CODE)for(let t=e.length;t<n;t++)e.push(null)}else if(e.length!==n&&0!==n)this.throwError("Expected comma");else{let t=this.gobbleExpression();(!t||t.type===pN.COMPOUND)&&this.throwError("Expected comma"),e.push(t)}}return i||this.throwError("Expected "+String.fromCharCode(t)),e}gobbleGroup(){this.index++;let t=this.gobbleExpressions(pN.CPAREN_CODE);if(this.code===pN.CPAREN_CODE)return this.index++,1===t.length?t[0]:!!t.length&&{type:pN.SEQUENCE_EXP,expressions:t};this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:pN.ARRAY_EXP,elements:this.gobbleArguments(pN.CBRACK_CODE)}}},fN=new class{add(t,e,i){if("string"!=typeof arguments[0])for(let n in arguments[0])this.add(n,arguments[0][n],arguments[1]);else(Array.isArray(t)?t:[t]).forEach((function(t){this[t]=this[t]||[],e&&this[t][i?"unshift":"push"](e)}),this)}run(t,e){this[t]=this[t]||[],this[t].forEach((function(t){t.call(e&&e.context?e.context:e,e)}))}};Object.assign(pN,{hooks:fN,plugins:new class{constructor(t){this.jsep=t,this.registered={}}register(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e.forEach((t=>{if("object"!=typeof t||!t.name||!t.init)throw new Error("Invalid JSEP plugin format");this.registered[t.name]||(t.init(this.jsep),this.registered[t.name]=t)}))}}(pN),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"}),pN.max_unop_len=pN.getMaxKeyLen(pN.unary_ops),pN.max_binop_len=pN.getMaxKeyLen(pN.binary_ops);var mN=t=>new pN(t).parse();Object.getOwnPropertyNames(pN).forEach((t=>{void 0===mN[t]&&"prototype"!==t&&(mN[t]=pN[t])})),mN.Jsep=pN;var gN={name:"ternary",init(t){t.hooks.add("after-expression",(function(e){if(e.node&&this.code===t.QUMARK_CODE){this.index++;let i=e.node,n=this.gobbleExpression();if(n||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===t.COLON_CODE){this.index++;let r=this.gobbleExpression();if(r||this.throwError("Expected expression"),e.node={type:"ConditionalExpression",test:i,consequent:n,alternate:r},i.operator&&t.binary_ops[i.operator]<=.9){let n=i;for(;n.right.operator&&t.binary_ops[n.right.operator]<=.9;)n=n.right;e.node.test=n.right,n.right=e.node,e.node=i}}else this.throwError("Expected :")}}))}};function vN(t){return{all:t=t||new Map,on:function(e,i){var n=t.get(e);n?n.push(i):t.set(e,[i])},off:function(e,i){var n=t.get(e);n&&(i?n.splice(n.indexOf(i)>>>0,1):t.set(e,[]))},emit:function(e,i){var n=t.get(e);n&&n.slice().map((function(t){t(i)})),(n=t.get("*"))&&n.slice().map((function(t){t(e,i)}))}}}mN.plugins.register(gN);var yN=class{constructor(t,e,i){this.id=t,this.userAPI=e,this.result=void 0,this.error="null",this.isPrefetched=!1,this.isLoading=!1,this.isLoaded=!1,this.prefetchPromise=new Promise((t=>t())),this.emitter=vN(),this._innerCallUserAPI=async t=>{this.emitter.emit("start",{userAPIId:this.id}),this.isLoading=!0,this.isLoading=!1;try{this.result=await async function(t,e){let i,n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new AbortController,s=t.url,a=t.proxy?.enabled??!1;if("OpenAI"===t.integration?.type){let i=wN(""===t.integration.prompt?[]:JSON.parse(t.integration.prompt),e),r=""===t.integration.behavior?[]:wN(JSON.parse(t.integration.behavior),e);n=`{\n\t\t"model": "${t.integration.model}",\n\t\t"messages": [${t.integration.useBehavior?`\n\t\t{\n\t\t\t"role": "system",\n\t\t\t"content": "${r}"\n\t\t},`:""}\n\t\t{\n\t\t\t"role": "user",\n\t\t\t"content": "${i}"\n\t\t}\n\t\t]\n\t}`}if(a){let i;s=`https://apis.spline.design/file/${t.proxy.fileId}/external-api/request?uuidexternalapi=${t.proxy.proxyId}`,void 0!==n?i=n:"POST"===t.method&&t.body&&(i=wN(JSON.parse(t.body),e)),void 0!==i&&(s+=`&data=${encodeURIComponent(i.replace(/(\r\n|\n|\r|\t)/gm,""))}`)}else"OpenAI"===t.integration?.type?i=n:"POST"===t.method&&t.body&&(i=wN(JSON.parse(t.body),e));let o=await fetch(s,{method:a?"GET":t.method,headers:a?void 0:bN(t),signal:r.signal,body:i});if(!o.ok)throw new Error("status:"+o.status+"_:_"+o.statusText);if("OpenAI"===t.integration?.type){let t=await o.json();return a&&(t=t.response),{content:t.choices[0].message.content}}{let t=await o.json();return a&&(t=t.response),t}}(this.userAPI,t),this.error="null",this.emitter.emit("success",{userAPIId:this.id})}catch(e){let i=e.message?.split("_:_")?.[0]?.replace("status:","")??"null";this.error=i,this.result=null,this.emitter.emit("error",{userAPIId:this.id})}this.isLoading=!1,this.isPrefetched=!0,this.isLoaded=!0},"OpenAI"===e?.integration?.type?this.result={content:""}:"GET"===e.method&&""!==e.url&&(this.prefetchPromise=this.prefetch(i)),this._debouncedCallUserAPI=this._innerCallUserAPI,this._updateDebouncedCallUserAPI(),this._debouncedPrefetch=VP(this.prefetch,1e3,{trailing:!0})}_updateDebouncedCallUserAPI(){this._debouncedCallUserAPI=void 0!==this.userAPI.debounce&&this.userAPI.debounce>0?VP(this._innerCallUserAPI,this.userAPI.debounce,{leading:!0,trailing:!0}):this._innerCallUserAPI}async prefetch(t){await this.callUserAPI(t)}async callUserAPI(t){await this._debouncedCallUserAPI(t)}update(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.userAPI=t,this._updateDebouncedCallUserAPI(),""!==this.userAPI.url&&"GET"===this.userAPI.method&&i&&this._debouncedPrefetch(e)}retrieveValue(t){if(this.result)try{return yD.zoom(this.result,t)}catch(Wk){console.error(Wk)}}retrieveZoomedKeyValues(t){if(this.result){let e=t&&t.length?yD.zoom(this.result,t):this.result;if(function(t){return"object"==typeof t&&null!==t}(e))return Object.entries(e);if(function(t){return Array.isArray(t)}(e))return e.map(((t,e)=>[e.toString(),t]));throw function(t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t||null===t}(e)?new Error("This path points to a value, use retrieveValue() instead. "+t?.join(".")):new Error("Path error"+t?.join("."))}}dispose(){}on(t,e){this.emitter.on(t,e)}off(t,e){this.emitter.off(t,e)}get autostart(){return this.userAPI.autoStart}};function bN(t){let e=new Headers;return t.headers.forEach((t=>{""!==t.data.key&&e.append(t.data.key,t.data.value)})),e}var xN=(t,e)=>{if("string"==typeof t){let i=e.getVariable(t);if(i)return xN(i,e)}return nO.isBoolean(t)?nO.getDisplayedValue(t).toLowerCase():nO.getDisplayedValue(t)},wN=(t,e)=>t.map(((t,i)=>{if("text"in t)return t.text;if("type"in t){if("paragraph"===t.type)return(i>0?"\n":"")+wN(t.children,e);if("variable"===t.type){let i=e.getVariable(t.variableId);if(void 0!==i)return xN(i,e)}}return""})).join(""),SN=["+","-","*","/","(",")","==","!=",">","<",">=","<=","and","or","!","%","^",","],AN=["0","1","2","3","4","5","6","7","8","9","."],EN=["sin","cos","tan","asin","acos","atan","atan2","sqrt","abs","log","exp","floor","ceil","round","min","max","random"];function _N(t){return"string"==typeof t&&(!isNaN(t)&&!isNaN(parseFloat(t)))}function CN(t,e){let i,n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"number",s="";for(let a=0;a<t.length;a++){let i=t[a];if("objType"in i&&"api"===i.objType){let t=JSON.parse(i.id),n=t[0],r=e.getUserAPI(n);if(void 0!==r&&r instanceof yN){let e=r.retrieveValue(t.slice(1));void 0!==e&&(s+=e)}}else if("objType"in i&&"webhook"===i.objType){let t=JSON.parse(i.id),[n,r]=t,a=e.getUserWebhook(n);if(void 0!==a){let t=a.getParameterValue(r);void 0!==t&&(s+=t)}}else if("objType"in i&&"aiAssistant"===i.objType){let t=e.openAIRealtime;if("objId"in i&&void 0!==i.objId){let n;if(e.scene.data.objects.traverse(((t,e)=>{let r=e.events?.find((t=>t.id===i.objId));r&&(n=r)})),void 0!==n&&"AIAssistantListener"===n.data.type){let e=t?.computeAnalysisForListenerEvent(n.data);if(void 0!==e){s+=e;continue}}}s+=t?.voice??0}else if("id"in i){let n=t[a-1];if(a>0&&"id"in n)return void console.error("Two variables in a row",t);let o=e.getVariable(i.id),l=nO.getDisplayedValue(o);"number"===r&&nO.isTextValue(o)&&Array.isArray(o.textValue)&&1===o.textValue.length?l=parseFloat(l).toString():"boolean"===r&&nO.isBoolean(o)?l=o?"true":"false":"boolean"===r&&nO.isTextValue(o)&&!Array.isArray(o.textValue)&&(l='"'+l+'"'),s+=l}else"string"!==r?"and"!==i.name?"or"!==i.name?"True"!==i.name?"False"!==i.name?"boolean"!==r||_N(i.name)||AN.includes(i.name)||SN.includes(i.name)||EN.includes(i.name.replace(/\($/g,""))?s+=i.name:s+='"'+i.name+'"':s+="false":s+="true":s+="||":s+="&&":('"'!==i.name&&("+"!==i.name||i.escaped)&&(s+=i.name),"+"===i.name&&!i.escaped&&"\\"===s[s.length-1]&&(s=s.slice(0,-1)+i.name))}if("string"===r)return s;if(0===t.length){if("number"===r)return 0;if("boolean"===r)return!1}try{i=mN(s)}catch(gI){return void console.error(s,gI)}try{n=MN(i)}catch(gI){console.error(s,i,gI)}return n}function MN(t){switch(t.type){case"BinaryExpression":switch(t.operator){case"==":return Number(MN(t.left)===MN(t.right));case"!=":return Number(MN(t.left)!==MN(t.right));case">":return Number(MN(t.left)>MN(t.right));case">=":return Number(MN(t.left)>=MN(t.right));case"<":return Number(MN(t.left)<MN(t.right));case"<=":return Number(MN(t.left)<=MN(t.right));case"+":return MN(t.left)+MN(t.right);case"-":return MN(t.left)-MN(t.right);case"*":return MN(t.left)*MN(t.right);case"/":return MN(t.left)/MN(t.right);case"%":return MN(t.left)%MN(t.right);case"&&":return MN(t.left)&&MN(t.right);case"||":return MN(t.left)||MN(t.right);case"^":return Math.pow(MN(t.left),MN(t.right));default:throw new Error("Unknown operator: "+t.operator)}case"UnaryExpression":switch(t.operator){case"-":return-MN(t.argument);case"!":return Number(!MN(t.argument));default:throw new Error("Unknown operator: "+t.operator)}case"Identifier":throw new Error("Unknown identifier: "+t.name);case"Literal":return t.value;case"CallExpression":if("Identifier"===t.callee.type){if("random"===t.callee.name){let e=0,i=1;if(t.arguments.length>=1)try{e=MN(t.arguments[0])}catch(YT){console.warn(YT)}if(t.arguments.length>=2)try{i=MN(t.arguments[1])}catch(YT){console.warn(YT)}return e=Math.min(i,e),i=Math.max(i,e),e+Math.random()*(i-e)}return Math[t.callee.name].apply(null,t.arguments.map(MN))}throw new Error("Unknown node");default:throw new Error("Unknown node type: "+t.type)}}mN.addBinaryOp("^",11,!0);var PN=new Wm,TN=new Wm;var DN=class extends Hg{constructor(t){super(),this.type="PathExtrusionGeometry",this.inputs=t,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&1===this.inputs.parameters.extrusion.depth}_isOpenEnded(){let t=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&1===t.depth)||!function(t,e){let i=2*Math.PI;return(t%i+i)%i===(e%i+i)%i}(t.twist,0)||t.startScale!==t.endScale}build(){let t=this._extractPathPoints();if(t.length<2)return;let e=this._computeBasisMatrices(t),{depth:i,offset:n}=this.inputs.parameters.extrusion;i=Math.max(0,Math.min(i,1)),n=Math.max(0,Math.min(n,1));let r=this.inputs.path.isClosed?t.length:t.length-1,s=Math.floor(n*r),a=this.inputs.path.isClosed?Math.ceil((i+n)*r):Math.ceil(Math.min(1,i+n)*r),o=Math.min(Math.max(2,a-s+1),r+2),l=[],h=[];for(let R=0;R<o;R++){let i=this.inputs.path.isClosed?(R+s)%t.length:Math.min(R+s,t.length-1);l.push(t[i].clone()),h.push(e[i].clone())}let c=(t,e,i)=>{l[t]=l[t].clone().lerp(l[e],i),h[t]=function(t,e,i){let n=[new mm,new mm,new mm],r=[new mm,new mm,new mm];return t.extractBasis(n[0],n[1],n[2]),e.extractBasis(r[0],r[1],r[2]),n.forEach(((t,e)=>{let n=r[e],s=Nf.lerp(t.length(),n.length(),i);t.lerp(n,i).setLength(s)})),(new Wm).makeBasis(n[0],n[1],n[2])}(h[t],h[e],i)},u=0,d=n*r%1;(!this.inputs.path.isClosed||i<=1)&&(d||0===n)&&(u=d,c(0,1,u));let p=0,f=(n+i)*r%1;if((this.inputs.path.isClosed&&i<=1||!this.inputs.path.isClosed&&n+i<1)&&f&&(p=f,c(l.length-1,l.length-2,1-p)),0===i){let t=l.length-1;l[t].copy(l[0]),h[t].copy(h[0])}this._applyPathModifiers(h,u,p);let{bevel:m,bevelSides:g}=this.inputs.parameters.extrusion,v=m>0?this.inputs.parameters.extrusion.capType:"flat",y=5;"Custom"===this.inputs.parameters.extrusion.shape.type&&(y="low"===this.inputs.parameters.extrusion.shape.shapeQuality?5:12);let b,{regions:x,infos:w,vertices:S}=this._computeShapePoints(y),A=0;"round"===v&&(b=new AF(this.inputs.shapeData,2*m,m,y,g,void 0,!0),A=b.getAttribute("position").count);let E=0,_=0;w.sort(((t,e)=>t.start-e.start)),w.forEach((t=>{t.verticesStart=E,t.verticesCount=t.continuous.reduce(((t,e,i)=>t+(0!==i&&e?1:2)),0),_+=t.verticesCount,E=_}));let C,M=_*o,P=0;if(this._isOpenEnded()&&"flat"===v){try{C=dF({windingRule:zz.ODD,elementType:Nz.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:x})}catch{C=wF}P=C.vertexCount}let T=M+2*P+2*A,D=M+2*P,k={positions:new Float32Array(3*T),normals:new Float32Array(3*T),uvs:new Float32Array(2*T)},I=[];if(w.forEach((t=>{this._extrudeRegion(t,S,h,l,k,I,this._isGeometryClosed()&&!this._isOpenEnded())})),C&&(this._closeEnd(C,M,I,k,h[0],l[0],!1),this._closeEnd(C,M+P,I,k,h[h.length-1],l[l.length-1],!0)),b){k.positions.set(b.getAttribute("position").array,3*D),k.normals.set(b.getAttribute("normal").array,3*D),k.uvs.set(b.getAttribute("uv").array,2*D);for(let n=D;n<D+A;n++)k.uvs[2*n+1]=1e-4;let t=I.length;I.push(...b.getIndex().array.map((t=>t+D))),D+=A,k.positions.set(b.getAttribute("position").array,3*D),k.normals.set(b.getAttribute("normal").array,3*D),k.uvs.set(b.getAttribute("uv").array,2*D);let e=I.length;I.push(...b.getIndex().array.map((t=>t+D))),this.setAttribute("position",new Rg(k.positions,3)),this.setAttribute("normal",new Rg(k.normals,3)),this.setAttribute("uv",new Rg(k.uvs,2)),this.setIndex(I);let i=PN;i.copy(h[h.length-1]).setPosition(l[l.length-1]),this.applyMatrix4OnRange(i,D,T),i.copy(h[0]).setPosition(l[0]).multiply(TN.makeScale(1,1,-1)),this.applyMatrix4OnRange(i,D-A,D),this.reverseIndicesOnRange(t,e)}else this.setAttribute("position",new Rg(k.positions,3)),this.setAttribute("normal",new Rg(k.normals,3)),this.setAttribute("uv",new Rg(k.uvs,2)),this.setIndex(I)}_extractPathPoints(){let t=QB(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(t.length<2)return[];let e=[t[0]];return t.forEach((t=>{e[e.length-1].distanceToSquared(t)>.001&&e.push(t)})),this.inputs.path.isClosed&&e[e.length-1].distanceTo(e[0])<.001&&e.pop(),e}_computeBasisMatrices(t){let e=[],i=t.length,n=this.inputs.path.isClosed,r=new mm,s=new mm,a=new mm,o=new mm,l=new mm(0,1,0);for(let f=0;f<i;f++){let h,c,u=t[f];h=0===f?n?t[t.length-2]:u.clone().multiplyScalar(2).sub(t[1]):t[f-1],c=f===i-1?n?t[1]:u.clone().multiplyScalar(2).sub(t[f-1]):t[f+1];let d=u.clone().sub(h).normalize(),p=c.clone().sub(u).normalize(),m=d.clone().add(p).normalize();a.copy(m),0===f&&(m.equals(l)||m.clone().negate().equals(l))&&l.set(0,0,1);let g=l.clone().cross(m).normalize(),v=m.clone().cross(g).normalize();l.copy(v),o.copy(g),0===f&&(r.copy(v),s.copy(m));let y=(new Wm).makeBasis(g,v,m);e.push(y)}let h=n?s:a,c=n?r:new mm(0,1,0),u=h.clone().cross(o).normalize(),d=Math.acos(c.dot(u));if(isNaN(d))return e;let p=c.clone().cross(u);h.dot(p)>0&&(d*=-1);for(let f=1;f<e.length;f++){let t=(new Wm).makeRotationZ(d*f/e.length);e[f].multiply(t)}return e}_applyPathModifiers(t,e,i){let n=t.length,{angle:r,twist:s,startScale:a,endScale:o}=this.inputs.parameters.extrusion,l=new Wm,h=new Wm;return t.forEach(((t,c)=>{let u=0===c?0:c===n-1?1:(c-e)/(n-(0===i?0:1)-(e+(1-i)));l.makeRotationZ(Nf.lerp(r,r+s,u)*Nf.DEG2RAD);let d=Nf.lerp(a,o,u);h.makeScale(d,d,d),t.multiply(l).multiply(h)})),t}_computeShapePoints(){let t,e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:zz.ODD,r=this.inputs.shapeData,s=r.extractShapePointsToFlatArray([],i),a=r.shapeHoles.map((t=>{let e=t.extractShapePointsToFlatArray([],i),n=[];for(let i=e.length-1;i>=1;i-=2){let t=e[i-1],r=e[i-0];n.push(t,r)}return n}));try{t=dF({windingRule:n,elementType:Nz.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[s]})}catch{t=bF}try{e=dF({windingRule:zz.ODD,elementType:Nz.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...a]})}catch{e=xF}if(!t)throw new Error("error generating geometry");let o=t.elementCount;if(e){t.elementCount+=e.elementCount;for(let i=0;i<e.elements.length;i++){let n=e.elements[i],r=i%2===0?t.vertexCount:0;t.elements.push(n+r)}for(let i=0;i<e.vertexIndices.length;i++){let n=e.vertexIndices[i],r=t.vertexCount;t.vertexIndices.push(n+r)}for(let i=0;i<e.vertices.length;i++){let n=e.vertices[i];t.vertices.push(n)}}let l=1/0,h=-1/0,c=1/0,u=-1/0;for(let p=0,f=t.vertexCount;p<f;p++){let e=2*p,i=t.vertices[e+0],n=t.vertices[e+1];i<l&&(l=i),i>h&&(h=i),n<c&&(c=n),n>u&&(u=n)}let d=[];for(let p=t.elementCount-1;p>=0;p--){let e=p>=o,i=2*p,n=t.elements[i+0],s=t.elements[i+1],a=n+s,l={start:n,count:s,normals:[],isHole:e,continuous:[],verticesStart:0,verticesCount:0};d.push(l);let h=n,c=a-1,u=n+1,f=r.roundedCurves.length;do{let i=h-n,o=t.vertices[2*c+0],d=t.vertices[2*c+1],p=t.vertices[2*h+0],m=t.vertices[2*h+1],g=t.vertices[2*u+0],v=t.vertices[2*u+1],y=p-o,b=m-d,x=Math.sqrt(y*y+b*b);y/=x,b/=x;let w=p-g,S=m-v,A=Math.sqrt(w*w+S*S);w/=A,S/=A,l.normals[2*i+0]=-S,l.normals[2*i+1]=w;let E=t.vertexIndices[h];if(Array.isArray(E))l.continuous[i]=!1;else{let[t,e]=r.getCurveIndexFromVertexId(E-1,!0);if(e>0&&e<1)l.continuous[i]=!0;else{let n=1===e?t+1:t-1;n=(n+f)%f;let s=1===e?0:1,a=r.roundedCurves[t].getTangent(e),o=r.roundedCurves[n].getTangent(s);l.continuous[i]=a.dot(o)>.95}}e&&(l.normals[2*i+0]*=-1,l.normals[2*i+1]*=-1),[c,h,u]=[h,u,u+1],u>=a&&(u-=s)}while(u!==n+1)}return{regions:[s,...a],infos:d,vertices:t.vertices}}_insertVertex(t,e,i,n,r){let s=2*e,a=3*e;t.positions[a+0]=i.x,t.positions[a+1]=i.y,t.positions[a+2]=i.z,t.normals[a+0]=n.x,t.normals[a+1]=n.y,t.normals[a+2]=n.z,t.uvs[s+0]=r.x,t.uvs[s+1]=r.y}_extrudeRegion(t,e,i,n,r,s,a){let o=new mm,l=new mm,h=new mm,c=new mm,u=new Uf;i.forEach(((s,a)=>{let d=n[a],p=t.verticesStart*i.length+t.verticesCount*a;for(let n=0;n<t.count;n++){let f=2*(t.start+n);if(o.set(e[f+0],e[f+1],0),h.copy(o).applyMatrix4(s).add(d),t.continuous[n])c.set(t.normals[2*n+0],t.normals[2*n+1],0);else{let i=0===n?2*(t.start+t.count-1):f-2;l.set(e[i+0],e[i+1],0),c.copy(o).sub(l),c.set(-c.y,c.x,0),t.isHole||c.negate()}if(c.applyMatrix4(s).normalize(),u.set(0===n?1:n/t.count,a/(i.length-1)),this._insertVertex(r,p,h,c,u),p++,!t.continuous[n]||0===n){if(0===n)c.set(t.normals[2*n+0],t.normals[2*n+1],0),u.set(0,a/(i.length-1));else{let i=n===t.count-1?2*t.start:f+2;l.set(e[i+0],e[i+1],0),c.copy(l).sub(o),c.set(-c.y,c.x,0),t.isHole||c.negate()}c.applyMatrix4(s).normalize(),this._insertVertex(r,p,h,c,u),p++}}}));let d=i.length-1;for(let p=0;p<d;p++){let e=t.verticesStart*i.length+t.verticesCount*p,n=t.verticesStart*i.length+t.verticesCount*(p+1),r=0;for(let i=0;i<t.count;i++){(!t.continuous[i]||0===i)&&r++;let a=i===t.count-1?0:r+1,o=e+r,l=e+a,h=n+a,c=n+r;t.isHole?s.push(o,h,l,o,c,h):s.push(o,l,h,o,h,c),r++}}}_closeEnd(t,e,i,n,r,s,a){let o=t.vertexCount,l=new mm(0,0,a?-1:1).applyMatrix4(r),h=new mm,c=new Uf;for(let d=0;d<o;d++){let i=2*d;h.set(t.vertices[i+0],t.vertices[i+1],0).applyMatrix4(r).add(s),this._insertVertex(n,e+d,h,l,c)}let u=t.elements;for(let d=0;d<t.elementCount;d++){let t=3*d,n=u[t+0]+e,r=u[t+(a?1:2)]+e,s=u[t+(a?2:1)]+e;i.push(n,r,s)}}applyMatrix4OnRange(t,e,i){let n,r,s,a,o=t.elements,l=(new Vf).getNormalMatrix(t).elements,h=this.attributes.position,c=this.attributes.normal;if(!h||!c)return;let u=h.array,d=c.array,p=h.itemSize;for(let f=e*p,m=i*p;f<m;f+=p)n=u[f+0],r=u[f+1],s=u[f+2],a=1/(o[3]*n+o[7]*r+o[11]*s+o[15]),u[f+0]=(o[0]*n+o[4]*r+o[8]*s+o[12])*a,u[f+1]=(o[1]*n+o[5]*r+o[9]*s+o[13])*a,u[f+2]=(o[2]*n+o[6]*r+o[10]*s+o[14])*a,n=d[f+0],r=d[f+1],s=d[f+2],d[f+0]=l[0]*n+l[3]*r+l[6]*s,d[f+1]=l[1]*n+l[4]*r+l[7]*s,d[f+2]=l[2]*n+l[5]*r+l[8]*s;h.needsUpdate=!0,c.needsUpdate=!0}reverseIndicesOnRange(t,e){let i=this.index;if(i){for(let n=t;n<e;n+=3){let t=i.getX(n),e=i.getX(n+1),r=i.getX(n+2);i.setXYZ(n,r,e,t)}i.needsUpdate=!0}}};function kN(){let t=new Hg;return t.setAttribute("position",new Rg(new Float32Array([]),3)),t.setIndex(new Rg(new Uint16Array([]),1)),t}var IN=kN().attributes,RN=class extends Hg{constructor(t,e){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,IN),this.userData={parameters:t,type:"TextGeometry"};let i=e.getFont(t.font);i?.isLoaded?(this.font=i,this.update(t)):this.updateFont(t.font,e).then((()=>{this.update(t),e?.requestRender()}))}async updateFont(t,e){let i=e.getFont(t);i&&(this.font=i,await i.loadingPromise)}update(t){let e=this.font;if(this.userData={parameters:t,type:"TextGeometry"},!e?.isLoaded)return void console.warn("Cannot update text because its font is not loaded");let{width:i,height:n,depth:r,extrudeBevelSize:s,extrudeBevelSegments:a,text:o,textTransform:l}=t,h=nO.getDisplayedValue(o),c=function(t,e,i){let n=[""],r="";for(let s of i)r+=s," "===s||"\n"===s?(n[n.length-1]+=r,r="","\n"===s&&n.push("")):e.getTextWidth(n[n.length-1]+r,t)>t.width&&(n[n.length-1].length&&n.push(""),e.getTextWidth(n[n.length-1]+r,t)>t.width&&(1===r.length?(n[n.length-1]+=r,r=""):(n[n.length-1]+=r.slice(0,-1),r=r[r.length-1],n.push(""))));return n[n.length-1]+=r,n}(t,e,2===l?h.toUpperCase():3===l?h.toLowerCase():h),{shapes:u,charWidths:d,charCoords:p}=e.generateShapes(c,t),f=.5*("number"==typeof i?i:1),m=.5*("number"==typeof n?n:1),g=u.map((t=>(new qz).fromShape(t,!0)));this.vectorShapes=g;let v=g.map((t=>CF.create({shape:t,parameters:{depth:r,extrudeBevelSegments:a,extrudeBevelSize:s,windingRule:r<=0?zz.NONZERO:zz.ODD,subdivisions:this.isLowResolution&&r>0?1:12}}))),y=v.length?$O(v):kN();y.translate(-f,m,0),this.dispose(),this.wrappedText=c,this.charCoords=p,this.charWidths=d,this.deleteAttribute("extrudeNormal"),Object.entries(y.attributes).forEach((t=>{let[e,i]=t;this.setAttribute(e,i)})),this.setIndex(y.index),this.computeBoundingSphere()}clone(){let t=sT(new Hg,RN.prototype);return t.copy(this),console.log("CloneGeometry",this,t),t}copy(t){return Object.entries(t.attributes).forEach((t=>{let[e,i]=t;this.setAttribute(e,i)})),this.setIndex(t.index),this.userData={parameters:{...t.userData.parameters},type:"TextGeometry"},this}async setText(t){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:{textValue:t}})}get text(){return this.userData.parameters.text??""}};var ON,LN,BN=new Promise((t=>{ON=t})),zN=!1;function FN(){if(!zN)return LN||(LN=async function(){let t=__webpack_require__.e(917).then(__webpack_require__.bind(__webpack_require__,917)),[e,i]=await Promise.all([t,fetch("https://unpkg.com/@splinetool/modelling-wasm@1.9.72/build/process.wasm").then((t=>t.arrayBuffer()))]),n=e.default,r=await n({wasmBinary:i});ON(r),zN=!0}(),LN)}var NN=["font"];function UN(t,e,i,n){let r,s,a;"PathGeometry"===t.type?(s=JSON.parse(JSON.stringify(t)),a=[[],["extrusion"]]):(s={...t},a=[[]]);for(let h of a){let t=s;for(let e of h)t=t[e];for(r in t){let i=t[r];qI(i)&&!NN.includes(r)&&(t[r]=e.getVariable(i,[n.uuid,"geometry",...h,r]),qI(t[r])&&(t[r]=1))}}let o,l={parameters:s,type:s.type};if("PathGeometry"===s.type)l.path=s.path;else if("VectorGeometry"===s.type){let t=qz.createFromState(s.shape,s.width,s.height);l.shape=t}else if("NonParametricGeometry"===s.type){if(s.data.groups&&s.data.groups?.forEach((t=>t.materialIndex=Math.max(t.materialIndex??0,0))),l.geometry=(new PS).parse(s),0===l.geometry.groups.length){let t=l.geometry;t.addGroup(0,Math.max(t.getIndex()?.count??0,t.getAttribute("position").count),0)}}else{if("SubdivGeometry"===s.type){let e=new QN(s,i);return e.data=t,e}if("TextGeometry"===s.type)return new RN(s,e);if("InputGeometry"===s.type)return new RN(s,e);if("UIGeometry"===s.type)return hN.create({parameters:{width:s.width,height:s.height,cornerRadius:s.cornerRadius,cornerType:s.cornerType}})}try{o=bU(l)}catch(RI){console.error(RI)}if(!o){let t=qz.createFromState(dR.defaultData(),100,100);l.shape=t,o=bU(l)}return o}var VN=new Wm;function jN(t,e,i,n){let r,s,a,o=t.position.array,l=t.normal.array,h=VN.makeScale(e,i,n).invert().elements;for(var c=0,u=o.length;c<u;c+=3)o[c]*=e,o[c+1]*=i,o[c+2]*=n,r=l[c],s=l[c+1],a=l[c+2],l[c]=h[0]*r+h[4]*s+h[8]*a,l[c+1]=h[1]*r+h[5]*s+h[9]*a,l[c+2]=h[2]*r+h[6]*s+h[10]*a;t.position.needsUpdate=!0,t.normal.needsUpdate=!0}var GN,HN=new ym,WN=new mm;BN.then((t=>{GN=t}));var qN=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),YN=new Uint32Array([0,1,2,3]),XN=new Uint8Array([4]),QN=class extends Hg{constructor(t,e){super(),this.data=t,this.flatShading=e,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(t,e){this.freeSubdivPointer();let i=this.data.scaleBaked,n=EI.div(e,i);this.subdividedGeometry&&jN(this.subdividedGeometry.attributes,...n),this.originalGeometry&&jN(this.originalGeometry.attributes,...n),this.data=t;let r=this.userData.parameters;this.userData.parameters={width:r.width*n[0],height:r.height*n[1],depth:r.depth*n[2]},this.originalGeometry.boundingSphere.center.multiply(WN.fromArray(n));let s=WN.set(r.width,r.height,r.depth).length();this.originalGeometry.boundingSphere.radius=s/2}ensureSubdivPointer(){return 0===this.subdivPointer&&this.rebuild(),this.subdivPointer}rebuild(){let t,e,i;try{({originalGeometry:t,subdividedGeometry:e,subdivPointer:i}=QN.build(this.data,void 0,!this.flatShading,void 0))}catch{t=new av(100,100,100),i=0}this.subdivPointer=i,this.originalGeometry=t,this.subdividedGeometry=e??void 0;let n=this.subdividedGeometry??this.originalGeometry;Object.assign(this,n),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(QN.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let t=this.originalGeometry;null===t.boundingSphere&&(t.boundingSphere=new Bm,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=t.boundingSphere));let e=t.attributes.position,i=t.boundingSphere.center;HN.setFromBufferAttribute(e),HN.getCenter(i),t.boundingSphere.radius=i.distanceTo(HN.max),isNaN(t.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),HN.getSize(WN);let n={width:WN.x,height:WN.y,depth:WN.z};return this.userData.parameters=n,n}static build(t,e,i,n){let r,s,a,o=t?.phongAngle??35;!1===i&&(o=-1),e&&(GN.free_bvh(e),GN.free_subdivision_surface(e));try{r=QN.allocate(t,n)}catch(l){console.error(l,t),r=QN.allocate({positionWASM:qN,indexWASM:YN,verticesPerFaceWASM:XN},n)}if(GN.set_destination_refinement_level(r,0),s=QN.buildLevel(r,!0,o),t.subdivisions>0)try{GN.set_destination_refinement_level(r,t.subdivisions),a=QN.buildLevel(r,!1,o)}catch{try{GN.set_destination_refinement_level(r,t.subdivisions-1),a=QN.buildLevel(r,!1,o)}catch{a=null}}else a=null;return{subdivPointer:r,originalGeometry:s,subdividedGeometry:a}}static primitiveToQuads(t,e,i){t.widthSegments>16&&(t.widthSegments=16),t.heightSegments>16&&(t.heightSegments=16),t.depthSegments>16&&(t.depthSegments=16),t.radialSegments>16&&(t.radialSegments=16),"DodecahedronGeometry"===t.type&&(t.detail=0);let n,r,s,a,o,l,h=void 0!==t.shape||void 0!==t.path?e.geometry:UN(t,i,!1);if(n="TorusGeometry"===t.type&&t.arc===2*Math.PI?h.getClosedTorusIndicesForBooleanOrSubdiv():h.getIndex(),({positions:r,triIndices:o}=ZN(h.getAttribute("position"),n)),"CylinderGeometry"===t.type&&0===t.cornerRadius&&0===t.hollow&&!1===t.openEnded){let e=t.radialSegments*t.heightSegments*3*2;l=[e,e+3*t.radialSegments]}return({indices:s,verticesPerFace:a}=iU(r,o,h,l)),{positions:r,indices:s,verticesPerFace:a}}static allocate(t,e){let i,n,r,s=[],a=[];t.positionWASM&&t.positionWASM.length>0?(i=t.positionWASM,n=t.indexWASM,r=t.verticesPerFaceWASM):(i=qN,n=YN,r=XN);let o,l=i.length,h=n.length,c=r.length,u=i.length+s.length+a.length,d=n.length+r.length,p=u*Float32Array.BYTES_PER_ELEMENT+d*Uint32Array.BYTES_PER_ELEMENT,f=u*Float32Array.BYTES_PER_ELEMENT,m=(Uint32Array.BYTES_PER_ELEMENT,GN._malloc(p)),g=new Float32Array(GN.HEAPF32.buffer,m,u),v=new Uint32Array(GN.HEAPU32.buffer,m+f,d);g.set(i,0),g.set(s,i.length),g.set(a,i.length+s.length),v.set(n,0),v.set(r,n.length),t?.scaleBaked?.some((t=>1!==t))&&(o=(new Wm).makeScale(...t.scaleBaked)),e&&(o?o.premultiply(e):o=e);let y=o?GN.alloc_subdivision_surface2(m,l,m+f,h,m+f+n.length*Uint32Array.BYTES_PER_ELEMENT,c,o.elements):GN.alloc_subdivision_surface(m,l,m+f,h,m+f+n.length*Uint32Array.BYTES_PER_ELEMENT,c);return GN._free(m),y}static buildLevel(t,e,i,n,r){let s=r?GN.get_mesh_data2(t,e?GN.Level.CONTROL:GN.Level.REFINED,i,r.elements):GN.get_mesh_data(t,e?GN.Level.CONTROL:GN.Level.REFINED,i),a=GN.HEAPU32.subarray(s>>2,8+(s>>2)),o=a.subarray(4,8),l=0,h=GN.HEAPU32[a[l]>>2],c=GN.HEAPF32.subarray(h>>2,(h>>2)+o[l]);l++;let u=GN.HEAPU32[a[l]>>2],d=GN.HEAPF32.subarray(u>>2,(u>>2)+o[l]);l++;let p=GN.HEAPU32[a[l]>>2],f=GN.HEAPU32.subarray(p>>2,(p>>2)+o[l]);l++;let m=GN.HEAPU32[a[l]>>2],g=GN.HEAPU32.subarray(m>>2,(m>>2)+o[l]);if(l++,void 0===n){let t=new Hg;if(t.setIndex(new Lg(g,1)),t.setAttribute("position",new Bg(c,3)),t.setAttribute("normal",new Bg(d,3)),e){t.setAttribute("faceMap",new Lg(f,1));let e=new Float32Array(d.length/3*4).fill(0);t.setAttribute("color",new Rg(e,4))}return GN.free_mesh_data(s),t.userData.type="SubdivGeometry",t}n.getAttribute("position").copyArray(c),n.getAttribute("normal").copyArray(d),n.attributes.position.needsUpdate=!0,n.attributes.normal.needsUpdate=!0,GN.free_mesh_data(s)}static freeSubdivPointer(t){GN.free_bvh(t),GN.free_subdivision_surface(t)}static buildControlCageWireframe(t,e,i){let n=GN.get_wireframe_data_for_base_level(t),r=GN.HEAPU32.subarray(n>>2,4+(n>>2)),s=r.subarray(2,4),a=0,o=GN.HEAPU32[r[a]>>2],l=GN.HEAPF32.subarray(o>>2,(o>>2)+s[a]);a++;let h=GN.HEAPU32[r[a]>>2],c=GN.HEAPU32.subarray(h>>2,(h>>2)+s[a]);if(void 0===e){let t=new Hg;t.setAttribute("position",new Bg(l,3));let e=new Float32Array(l.length);for(let n=0,r=l.length;n<r;)e[n++]=i.r,e[n++]=i.g,e[n++]=i.b;return t.setAttribute("color",new Rg(e,3)),t.setIndex(new Lg(c,1)),GN.free_wireframe_data_for_base_level(n),t}e.getAttribute("position").copyArray(l),e.attributes.position.needsUpdate=!0,GN.free_wireframe_data_for_base_level(n)}static updateCollabMesh(t,e,i){let n=0===e;n||GN.set_destination_refinement_level(t,e);let r=i?GN.get_topological_data2(t,n?GN.Level.CONTROL:GN.Level.REFINED,i.elements):GN.get_topological_data(t,n?GN.Level.CONTROL:GN.Level.REFINED),s=GN.HEAPU32.subarray(r>>2,6+(r>>2)),a=s.subarray(3,6),o=0,l=GN.HEAPU32[s[o]>>2],h=new Float32Array(GN.HEAPF32.subarray(l>>2,(l>>2)+a[o]));o++;let c=GN.HEAPU32[s[o]>>2],u=new Uint32Array(GN.HEAPU32.subarray(c>>2,(c>>2)+a[o]));o++;let d=GN.HEAPU32[s[o]>>2],p=new Uint8Array(GN.HEAPU32.subarray(d>>2,(d>>2)+a[o]));return GN.free_topological_data(r),{positions:h,indices:u,verticesPerFace:p}}},KN=["getX","getY","getZ"];function ZN(t,e){let i={},n=e?e.count:t.count,r=0,s=[],a=[];for(let l=0;l<n;l++){let n=e?e.getX(l):l,o="";for(let e=0;e<3;e++)o+=~~(1e4*t[KN[e]](n))+",";if(o in i)s.push(i[o]);else{for(let e=0;e<3;e++)a.push(t[KN[e]](n));i[o]=r,s.push(r),r++}}let o=[];for(let l=0;l<s.length;l+=3)s[l]===s[l+1]||s[l]===s[l+2]||s[l+1]===s[l+2]||o.push(s[l],s[l+1],s[l+2]);return{positions:a,triIndices:o}}var JN=new mm,$N=new mm,tU=new mm,eU=new mm;function iU(t,e,i,n){let r=[],s=[];if(void 0!==i.userData.shape&&0===i.userData.parameters.depth&&0===i.userData.shape.shapeHoles.length){let e=i.userData.shape.extractShapePointsToFlatArray([]),n=i.userData.parameters.spikes;if("EllipseGeometry"===i.userData.type&&n<=24&&n%4===0&&i.userData.parameters.angle>=360){let t=e.length/2/n;e=e.filter(((e,i)=>Math.floor(i/2)%t===0))}let a=0;for(let t=0;t<e.length;t+=2)a+=(e[t]-e[(0===t?e.length:t)-2])*(e[t+1]+e[(0===t?e.length:t)-1]);t.length=0;let o=0;if(a<0)for(let i=0;i<e.length;i+=2)t.push(e[i],e[i+1],0),r.push(o++);else for(let i=e.length-2;i>=0;i-=2)t.push(e[i],e[i+1],0),r.push(o++);return s.push(o),{indices:r,verticesPerFace:s}}let a=new Float32Array([i.userData.parameters.depth])[0],o=0;for(;o<e.length;){if(i.useNgonForTopBottomFaceDuringBake){let i=0;if((t[3*e[o]+2]===a||0===t[3*e[o]+2])&&i++,(t[3*e[o+1]+2]===a||0===t[3*e[o+1]+2])&&i++,(t[3*e[o+2]+2]===a||0===t[3*e[o+2]+2])&&i++,3===i)break}if(e[o+1]===e[o+3]&&e[o+2]===e[o+5]||e[o+0]===e[o+3]&&e[o+2]===e[o+4]){JN.set(t[3*e[o]],t[3*e[o]+1],t[3*e[o]+2]),$N.set(t[3*e[o+1]],t[3*e[o+1]+1],t[3*e[o+1]+2]),tU.set(t[3*e[o+4]],t[3*e[o+4]+1],t[3*e[o+4]+2]),eU.set(t[3*e[o+5]],t[3*e[o+5]+1],t[3*e[o+5]+2]),$N.sub(JN).normalize(),tU.sub(JN).normalize(),eU.sub(JN).normalize();let i=$N.cross(tU).dot(eU);Math.abs(i)>.005||n&&n.some(((t,e)=>e%2!==1&&(o>=n[e]&&o<n[e+1])))?(r.push(e[o],e[o+1],e[o+2]),s.push(3),o+=3):(r.push(e[o],e[o+1],e[o+4],e[o+5]),s.push(4),o+=6)}else r.push(e[o],e[o+1],e[o+2]),s.push(3),o+=3}if(i.useNgonForTopBottomFaceDuringBake){let e=[],n=[],o=0;for(let i=0,r=0;i<t.length;i+=3,r++)0===t[i+2]&&(e.push(r),o++),t[i+2]===a&&n.push(r);if(0===i.userData.parameters.extrudeBevelSize){let t=n[0];n[0]=n[1],n[1]=t}e.reverse(),r.push(...e,...n),s.push(o,o)}return{indices:r,verticesPerFace:s}}var nU={};((t,e)=>{for(var i in e)Zd(t,i,{get:e[i],enumerable:!0})})(nU,{calcBoolean:()=>pU,calcBooleanTopological:()=>dU,freeMeshSet:()=>vU,getMeshSet:()=>fU,hasOpenEdges:()=>mU,transformMeshSet:()=>gU});var rU,sU,aU,oU,lU=new Promise((t=>{rU=t}));function hU(){if(sU)return sU;return sU=async function(){let t=__webpack_require__.e(516).then(__webpack_require__.bind(__webpack_require__,516)),[e,i]=await Promise.all([t,fetch("https://unpkg.com/@splinetool/boolean-wasm@1.9.72/build/boolean.wasm").then((t=>t.arrayBuffer()))]),n=e.default,r=await n({wasmBinary:i});rU(r)}(),sU}function cU(t){let e=t.length,i=e*Uint32Array.BYTES_PER_ELEMENT,n=e*Float32Array.BYTES_PER_ELEMENT,r=Number.isInteger(t[0])?i:n,s=aU._malloc(r);return(Number.isInteger(t[0])?new Uint32Array(aU.HEAPU32.buffer,s,e):new Float32Array(aU.HEAPF32.buffer,s,e)).set(t,0),s}function uU(t){switch(t){case 0:return aU.OP.UNION;case 1:return aU.OP.INTERSECTION;case 2:return aU.OP.A_MINUS_B;default:throw new Error("Unknown boolean operation "+t)}}function dU(t,e){void 0===oU&&(oU=aU.init_csg());let i=cU(t),n=aU.csg_calc_topological(oU,i,t.length,uU(e));aU._free(i);let r=aU.HEAPU32.subarray(n>>2,6+(n>>2)),s=r.subarray(3,6),a=0,o=aU.HEAPU32[r[a]>>2],l=new Float32Array(aU.HEAPF32.subarray(o>>2,(o>>2)+s[a]));a++;let h=aU.HEAPU32[r[a]>>2],c=new Uint32Array(aU.HEAPU32.subarray(h>>2,(h>>2)+s[a]));a++;let u=aU.HEAPU32[r[a]>>2],d=new Uint8Array(aU.HEAPU32.subarray(u>>2,(u>>2)+s[a]));return aU.free_mesh_data(n),{positions:l,indices:c,verticesPerFace:d}}function pU(t,e,i,n){void 0===oU&&(oU=aU.init_csg());let r=cU(t),s=aU.csg_calc(oU,r,t.length,n,uU(e));aU._free(r);let a=aU.HEAPU32.subarray(s>>2,5+(s>>2)),o=a.subarray(2,5),l=0,h=aU.HEAPU32[a[l]>>2],c=aU.HEAPF32.subarray(h>>2,(h>>2)+o[l]);l++;let u=aU.HEAPU32[a[l]>>2],d=aU.HEAPF32.subarray(u>>2,(u>>2)+o[l]);l++;let p=o[l];i.setAttribute("position",new Bg(c,3)),i.setAttribute("normal",new Bg(d,3));let f=aU.HEAPF32.subarray(5+(s>>2),5+(s>>2)+6);return null===i.boundingSphere&&(i.boundingSphere=new Bm),i.boundingSphere.center.set(f[0],f[1],f[2]),i.boundingSphere.radius=(f[3]**2+f[4]**2+f[5]**2)**.5,i.userData.parameters={width:2*f[3],height:2*f[4],depth:2*f[5]},aU.free_mesh_data(s),p}function fU(t,e,i){if(void 0===aU)return-1;let n,r,s;if(e&&void 0!==t.userData.positions){let e=t.userData;s=e.verticesPerFace.length,n=e.positions,r=Array(e.verticesPerFace.reduce(((t,e)=>t+e),0)+s);for(let t=0,i=0,n=0;t<e.verticesPerFace.length;t++){r[n++]=e.verticesPerFace[t];for(let s=0;s<e.verticesPerFace[t];s++)r[n++]=e.indices[i++]}}else({positions:n,faceIndices:r,nFaces:s}=function(t,e,i){let n,r;r="TorusGeometry"===t.userData.parameters.type&&t.userData.parameters.arc===2*Math.PI?t.getClosedTorusIndicesForBooleanOrSubdiv():t.getIndex();let s,{positions:a,triIndices:o}=ZN(t.getAttribute("position"),r);if(e&&i){let{indices:e,verticesPerFace:i}=iU(a,o,t);s=i.length,n=[];for(let t=0,r=0;t<s;t++){n.push(i[t]);for(let s=0;s<i[t];s++)n.push(e[r++])}}else{let t=o.length;n=Array(t+t/3),s=0;for(let e=0,i=0;i<n.length;)n[i++]=3,s++,n[i++]=o[e++],n[i++]=o[e++],n[i++]=o[e++]}return{positions:a,faceIndices:n,nFaces:s}}(t,e,i));let a=n.length,o=r.length,l=n.length,h=r.length,c=l*Float32Array.BYTES_PER_ELEMENT+h*Uint32Array.BYTES_PER_ELEMENT,u=l*Float32Array.BYTES_PER_ELEMENT,d=(Uint32Array.BYTES_PER_ELEMENT,aU._malloc(c)),p=new Float32Array(aU.HEAPF32.buffer,d,l),f=new Uint32Array(aU.HEAPU32.buffer,d+u,h);p.set(n,0),f.set(r,0);let m=aU.get_csg_mesh(d,a,d+u,o,s);return aU._free(d),m}function mU(t){return aU.has_open_edges(t)}function gU(t,e){aU.transform_csg_mesh(t,e.elements)}function vU(t){aU.free_csg_mesh(t)}lU.then((t=>aU=t));var yU={ConeGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},t.parameters);return i.thetaLength=Nf.clamp(i.thetaLength,0,360),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let e,{width:i,depth:n,height:r,radialSegments:s,heightSegments:a,openEnded:o,thetaStart:l,thetaLength:h,cornerRadiusTop:c,cornerRadiusBottom:u,cornerSegments:d}=t.parameters;return 0===h?(e=new Hg,e.setAttribute("position",new Bg([],3))):e=c>0||u>0||h<360?new sz(0,i/2,r,s,a,o,l,h*Math.PI/180,c,u,d,0,!0):new tw(i/2,r,s,a,o),e.scale(1,1,n/i),Object.assign(e,{userData:{...t,type:"ConeGeometry"}})}},CubeGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let e,{width:i,height:n,depth:r,widthSegments:s,heightSegments:a,depthSegments:o,cornerRadius:l,cornerSegments:h}=t.parameters;return e=0===l?new av(i,n,r,s,a,o):new oz(i,n,r,s,a,o,l,h),Object.assign(e,{userData:{...t,type:"CubeGeometry"}})}},CylinderGeometry:iz,DodecahedronGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,detail:0,corner:0,cornerSides:4},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,height:i,depth:n,detail:r,corner:s,cornerSides:a}=t.parameters,o=0===r&&0!==s?new hz(.5*e,s,a):new iw(.5*e,r);return o.scale(1,i/e,n/e),Object.assign(o,{userData:{...t,type:"DodecahedronGeometry"}})}},EllipseGeometry:PF,HelixGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},t.parameters),n=Math.abs(i.width),r=Math.abs(i.height??n),s=Math.abs(i.depth??n),a=Math.abs(Math.min(n,s))/2;return{parameters:Object.assign(i,{width:n,height:r,depth:s,radius:a,segments:Math.round(i.segments),pathSegments:Math.round(i.pathSegments),cornerSegments:Math.round(i.cornerSegments)})}}static build(t){let{width:e,height:i,depth:n,radius:r,revolutions:s,segments:a,pathRadius:o,pathType:l,pathSegments:h,cornerRadius:c,cornerSegments:u}=t.parameters,d=new BF(!1,e,i,n,r,s,a,o,l,h,c,u);return Object.assign(d,{userData:{...t,type:"HelixGeometry"}})}},IcosahedronGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,detail:0,corner:0,cornerSides:4},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,height:i,depth:n,detail:r,corner:s,cornerSides:a}=t.parameters,o=0===r&&0!==s?new zF(.5*e,s,a):new Iw(.5*e,r);return o.scale(1,i/e,n/e),Object.assign(o,{userData:{...t,type:"IcosahedronGeometry"}})}},LatheGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){(t.parameters?.points??[]).forEach((t=>{Array.isArray(t)&&(t.x=t[0],t.y=t[1])}));let i=Object.assign({},e?.parameters??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{points:e,segments:i,verticalSegments:n}=t.parameters,r=new nw;r.moveTo(e[0].x,e[0].y),r.bezierCurveTo(e[1].x,e[1].y,e[2].x,e[2].y,e[3].x,e[3].y);let s=new Jx(r.extractPoints(n).shape,i);return s.rotateZ(Math.PI),Object.assign(s,{userData:{...t,type:"LatheGeometry"}})}},NonParametricGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i,n=t.geometry??e?.geometry??(new Hg).copy(new av(100,100,100));void 0===e?(n.computeBoundingBox(),n.boundingBox.getSize(nN),i={width:nN.x,height:nN.y,depth:nN.z,subdivisions:0}):i=e.parameters;let r={...i,...t.parameters};return{parameters:{width:Math.abs(r.width),height:Math.abs(r.height),depth:Math.abs(r.depth),subdivisions:Math.abs(r.subdivisions)},geometry:n}}static build(t){let{width:e,height:i,depth:n,subdivisions:r}=t.parameters,s=t.geometry??(new Hg).copy(new av(100,100,100)),a=s.userData.parameters;void 0===a?(s.computeBoundingBox(),s.boundingBox.getSize(nN)):nN.set(a.width,a.height,a.depth),(e!==nN.x||i!==nN.y||n!==nN.z)&&s.scale(0===nN.x?1:e/nN.x,0===nN.y?1:i/nN.y,0===nN.z?1:n/nN.z);let o=s.originalGeometry;try{r>0?(void 0===o||a?.subdivisions!==r)&&(void 0===o&&(o=s),s=new iN(r).modify(o).toBufferGeometry()):(void 0!==o&&(s=o),o=void 0,void 0===s.getAttribute("normal")&&s.computeVertexNormals())}catch{void 0!==o&&(s=o),o=void 0,void 0===s.getAttribute("normal")&&s.computeVertexNormals()}return void 0!==o&&Object.assign(s,{originalGeometry:o}),delete t.geometry,Object.assign(s,{userData:{...t,type:"NonParametricGeometry"}})}static loadFromUrl(t,e,i){new PS(i).load(t,(t=>{let i=this.normalizeInputs({geometry:t});t.boundingBox.getSize(nN);let n=100/nN.x;Object.assign(i.parameters,{width:100,height:nN.y*n,depth:nN.z*n}),e(this.build(i))}))}},PolygonGeometry:rN,PyramidGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,height:i,depth:n,radialSegments:r,heightSegments:s,openEnded:a,cornerRadius:o,cornerSegments:l}=t.parameters,h=new lN(.5*e,i,r,s,a,o,l);return h.scale(1,1,n/e),Object.assign(h,{userData:{...t,type:"PyramidGeometry"}})}},RectangleGeometry:hN,SphereGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180},t.parameters);return i.thetaLength=Nf.clamp(i.thetaLength,0,180),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let e,{width:i=100,height:n=i,depth:r=i,widthSegments:s=64,heightSegments:a=64,phiStart:o,phiLength:l,thetaStart:h,thetaLength:c}=t.parameters;return 0===c?(e=new Hg,e.setAttribute("position",new Bg([],3))):e=new Rw(.5*i,s,a,o,l,h,c*Nf.DEG2RAD),e.scale(1,n/i,r/i),Object.assign(e,{userData:{...t,type:"SphereGeometry"}})}},PlaneGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,depth:0,widthSegments:8,heightSegments:8},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:0})}}static build(t){let{width:e=100,height:i=e,widthSegments:n=8,heightSegments:r=8}=t.parameters,s=new Mv(e,i,n,r);return s.scale(1,1,1),Object.assign(s,{userData:{...t,type:"PlaneGeometry"}})}},BackdropGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,angle:90,cornerRadius:24,cornerSegments:8},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,height:i,depth:n,angle:r,cornerRadius:s,cornerSegments:a}=t.parameters,o=new cN(e,i,n,r,s,a);return Object.assign(o,{userData:{...t,type:"BackdropGeometry"}})}},StarGeometry:uN,TextFrameGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,depth:0},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(t){let{width:e,height:i}=t.parameters,n=new Mv(e,i);return Object.assign(n,{userData:{...t,type:"TextFrameGeometry"}})}},TorusGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,radialSegments:32,tubularSegments:64,arc:360,cornerRadius:30,cornerSegments:8},t.parameters),n=Math.abs(i.width),r=Math.abs(i.height??i.width);i.shapeBlendNode&&(r=n);let s=Math.round(Math.abs(i.depth??.25*i.width));return{parameters:Object.assign(i,{width:n,height:r,depth:s})}}static build(t){let{width:e,height:i,depth:n,radialSegments:r,tubularSegments:s,arc:a,cornerRadius:o,cornerSegments:l}=t.parameters,h=function(t,e,i,n,r,s,a,o,l,h,c){[e,i]=[i,e],a=e/2;let u=Nf.clamp(r/360,0,1);if(0===u){let t=new Hg;return t.setAttribute("position",new Bg([],3)),t}return 1===u&&(h=0),new BF(!0,t,e,i,n,u,s,a,o,l,h,c)}(e,i,n,.5*e,a,s,0,0,r,o,l);return h.scale(1,i/e,1),Object.assign(h,{userData:{...t,type:"TorusGeometry"}})}},TorusKnotGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),tube:i.tube??.125*i.width})}}static build(t){let{width:e,tube:i,tubularSegments:n,radialSegments:r,p:s,q:a}=t.parameters,o=.5*e;o!==i&&(o-=i);let l=new Lw(o,i,n,r,s,a);return Object.assign(l,{userData:{...t,type:"TorusKnotGeometry"}})}},TriangleGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},t.parameters);return{shape:t.shape&&t.shape instanceof qz?t.shape:new qz,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width*(i.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(i.depth??0)})}}static build(t){let{width:e=100,height:i,cornerRadius:n,depth:r,extrudeBevelSize:s,extrudeBevelSegments:a,isRect:o}=t.parameters,l=t.shape,h=.5*e,c=.5*i;o?(l.addPoint(l.createPoint(-h,c)),l.addPoint(l.createPoint(h,-c)),l.addPoint(l.createPoint(-h,-c))):(l.addPoint(l.createPoint(0,c)),l.addPoint(l.createPoint(h,-c)),l.addPoint(l.createPoint(-h,-c))),l.isClosed=!0;for(let d=0,p=l.points.length;d<p;d++)l.points[d].roundness=n;l.roundness=n,l.update();let u=CF.create({shape:l,parameters:{roundness:n,depth:r,extrudeBevelSize:s,extrudeBevelSegments:a}});return Object.assign(u,{userData:{...t,type:"TriangleGeometry"}})}},PathGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},t.parameters),n=Math.abs(i.width),r=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=e?.shapeData??PF.create({parameters:vR}).userData.shape;return{path:t.path??pR.defaultData(),parameters:Object.assign(i,{width:n,height:r,depth:s,extrusion:{...wR,...i.extrusion}}),shapeData:a}}static build(t){if(t.path.points.length>=2){let e=new DN(t);return Object.assign(e,{userData:{...t,type:"PathGeometry"}})}return Object.assign(new Hg,{userData:{...t,type:"PathGeometry"}})}},VectorGeometry:CF},bU=t=>yU[t.type].create(t);function xU(t){return null!==t&&"booleanOp"in t}var wU=class extends(ez(rv)){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new Wm}updateVisible(t){super.updateVisible(t),this.visible=!xU(this.parent)&&this.visible,xU(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){-1!==this.booleanMeshSetAddress&&(nU.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.booleanWasTransformed=!0:this.freeBooleanPointer(),xU(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let t of this.children)t instanceof wU&&(t.freeBooleanPointer(),xU(t)&&t.invalidateUpstreamBooleanData())}updateTransformState(t,e){let i=super.updateTransformState(t,e);return i&&xU(this.parent)&&this.invalidateDownstreamBooleanData(!0),i}onVariableUpdate(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.onVariableUpdate(t),xU(this.parent)&&this.invalidateDownstreamBooleanData(!0)}},SU=new ym;function AU(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.count,n=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,s=1/0,a=1/0,o=1/0,l=-1/0,h=-1/0,c=-1/0;for(let u=e;u<i;u++){let e=t.getX(u),i=t.getY(u),n=t.getZ(u);e<s&&(s=e),i<a&&(a=i),n<o&&(o=n),e>l&&(l=e),i>h&&(h=i),n>c&&(c=n)}SU.min.set(s,a,o),SU.max.set(l,h,c),SU.getCenter(n),SU.getSize(r).multiplyScalar(.5)}var EU=new Hg,_U=new Dg,CU=class extends wU{constructor(t,e){super(EU,_U),this.super_Entity(t,e)}updateState(t,e){this.updateState_Entity(t,e)}updateEntityBoxSize(t,e){let i=this.geometry.getAttribute("position");void 0!==i?AU(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,t,e):super.updateEntityBoxSize(t,e)}},MU=class{constructor(t){if(this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},null===MU.uuidContext)throw new Error("plz startContext");MU.uuidContext===MU.globalContext?this.uuid="_gid"+MU.uuidContext.nodeContextUuid++:this.uuid="_uid"+MU.uuidContext.nodeContextUuid++,this.type=t,this.name=""}static startContext(t){null===this.uuidContext||this.uuidContext===MU.globalContext?this.uuidContext=t:console.error("Can't start context twice")}static endContext(t){this.uuidContext!==t&&console.error("Can't end context twice"),this.uuidContext=null}analyze(t,e){e=e??{},t.analyzing=!0,this.build(t.addFlow(e.slot,e.cache,e.context),"v4"),t.clearVertexNodeCode(),t.clearFragmentNodeCode(),t.removeFlow(),t.analyzing=!1}analyzeAndFlow(t,e,i){return i=i??{},this.analyze(t,i),this.flow(t,e,i)}flow(t,e,i){i=i??{},t.addFlow(i.slot,i.cache,i.context);let n={result:this.build(t,e),code:t.clearNodeCode(),extra:t.context.extra};return t.removeFlow(),n}build(t,e,i){e=e??this.getType(t,e);let n=t.getNodeData(i??this);return t.analyzing&&this.appendDepsNode(t,n,e),-1===t.nodes.indexOf(this)&&t.nodes.push(this),void 0!==this.updateFrame&&-1===t.updaters.indexOf(this)&&t.updaters.push(this),this.generate(t,e,i)}updateFrame(t){}generateReadonly(t,e,i,n,r,s){return""}generate(t,e,i,n,r){return""}parse(t,e,i,n){}appendDepsNode(t,e,i){e.deps=(e.deps||0)+1;let n=t.getTypeLength(i);(n>(e.outputMax||0)||this.getType(t,i))&&(e.outputMax=n,e.output=i)}setName(t){this.name=t}getName(){return this.name}getType(t,e){return"sampler2D"===e||"samplerCube"===e?e:this.type}},PU=MU;PU.globalContext={nodeContextUuid:0},PU.uuidContext=MU.globalContext;var TU=class{constructor(t){t=t??{},this.name=t.name,this.type=t.type,this.node=t.node,this.size=t.size,this.needsUpdate=t.needsUpdate}get value(){return this.node.value}set value(t){this.node.value=t}},DU=new class{constructor(){this.nodes={},this.keywords={}}add(t){this.nodes[t.name]=t}addKeyword(t,e,i){i=void 0===i||i,this.keywords[t]={callback:e,cache:i}}remove(t){delete this.nodes[t.name]}removeKeyword(t){delete this.keywords[t]}get(t){return this.nodes[t]}getKeyword(t,e){return this.keywords[t].callback(e)}getKeywordData(t){return this.keywords[t]}contains(t){return void 0!==this.nodes[t]}containsKeyword(t){return void 0!==this.keywords[t]}},kU=class extends PU{constructor(t,e){super(t),this.scope="",e=e??{},this.shared=void 0===e.shared||e.shared,this.unique=void 0!==e.unique&&e.unique}build(t,e,i,n){if(e=e??this.getType(t),this.getShared(t,e)){let r=this.getUnique(t,e);r&&void 0===this.uuid&&(this.uuid=Nf.generateUUID()),i=t.getUUID(i??this.getUUID(),!r);let s=t.getNodeData(i),a=s.output||this.getType(t);if(t.analyzing)return(s.deps||0)>0||this.getLabel()?(this.appendDepsNode(t,s,e),this.generate(t,e,i)):super.build(t,e,i);if(r)return s.name=s.name||super.build(t,e,i),s.name;if(!this.getLabel()&&(!this.getShared(t,a)||t.context.ignoreCache||1===s.deps))return super.build(t,e,i);i=this.getUUID(!1);let o=this.getTemp(t,i);if(o)return t.format(o,a,e);{o=super.generate(t,e,i,s.output,n);let r=this.generate(t,a,i);return t.addNodeCode(o+" = "+r+";"),t.format(o,a,e)}}return super.build(t,e,i)}getShared(t,e){return"sampler2D"!==e&&"samplerCube"!==e&&this.shared}getUnique(t,e){return this.unique}setLabel(t){return this.label=t,this}getLabel(){return this.label}getUUID(t){let e=this.uuid;return"string"==typeof this.scope&&(e=this.scope+"-"+e),e}getTemp(t,e){e=e||this.uuid;let i=t.getVars()[e];return i?i.name:void 0}generate(t,e,i,n,r){return this.getShared(t,e)||console.error("TempNode is not shared"),i=i??this.uuid,t.getTempVar(i,n??this.getType(t),r,this.getLabel()).name}},IU=class extends kU{constructor(t,e){(e=e??{}).shared=void 0!==e.shared&&e.shared,super(t,e),this.readonly=!1}setReadonly(t){return this.readonly=t,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(t,e,i,n,r,s){i=t.getUUID(i??this.getUUID()),n=n??this.getType(t);let a=t.getNodeData(i);return this.getReadonly()&&void 0!==this.generateReadonly?this.generateReadonly(t,e,i,n,r,s):t.isShader("vertex")?(a.vertex||(a.vertex=t.createVertexUniform(n,this,r,s,this.getLabel())),t.format(a.vertex.name,n,e)):(a.fragment||(a.fragment=t.createFragmentUniform(n,this,r,s,this.getLabel())),t.format(a.fragment.name,n,e))}},RU=class extends IU{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0;super("v2"),this.nodeType="Vector2",this.value=t instanceof Uf?t:new Uf(t,e)}get x(){return this.value.x}set x(t){this.value.x=t}get y(){return this.value.y}set y(t){this.value.y=t}generateReadonly(t,e,i,n,r,s){return t.format("vec2("+this.value.x+", "+this.value.y+")",n,e)}},OU=class extends IU{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;super("v3"),this.nodeType="Vector3",this.value=t instanceof mm?t:new mm(t,e,i)}get x(){return this.value.x}set x(t){this.value.x=t}get y(){return this.value.y}set y(t){this.value.y=t}get z(){return this.value.z}set z(t){this.value.z=t}generateReadonly(t,e,i,n,r,s){return t.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",n,e)}},LU=class extends nm{constructor(t,e,i,n){super(t,e,i),this.isColorA=!0,this.a=n}setRGBA(t,e,i,n){super.setRGB(t,e,i),this.a=n}copy(t){return super.copy(t),this.a="a"in t?t.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}equals(t){return super.equals(t)&&this.a===t.a}setStyle(t){let e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"srgb";if("transparent"===t)return this.setRGBA(0,0,0,0),this;if(e=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(t)){let n,r=e[1],s=e[2];switch(r){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a="rgba"===r?parseFloat(n[4]):1,super.setStyle(t,i);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a="hsla"===r?parseFloat(n[4]):1,super.setStyle(t,i)}}return super.setStyle(t,i)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(t){this.r=t}set y(t){this.g=t}set z(t){this.b=t}set w(t){this.a=t}},BU=class extends IU{constructor(t){super("v4"),this.nodeType="Vector4",this.value=t instanceof LU?t:new LU(t.r,t.g,t.b,t.a)}generateReadonly(t,e,i,n,r,s){return t.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",n,e)}},zU=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,FU=/[a-z_0-9]+/gi,NU=class extends kU{constructor(t,e,i,n,r){super(r),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=void 0===r,this.isInterface=!1,this.parse(t,e,i,n)}getShared(t,e){return!this.isMethod}getType(t){return t.getTypeByFormat(this.type)}getInputByName(t){if(this.inputs){let e=this.inputs.length;for(;e--;)if(this.inputs[e].name===t)return this.inputs[e]}}getIncludeByName(t){if(this.includes){let e=this.includes.length;for(;e--;)if(this.includes[e].name===t)return this.includes[e]}}generate(t,e,i,n,r){let s,a=0,o=this.src;if(this.includes)for(let h=0;h<this.includes.length;h++)t.include(this.includes[h],this);for(let h in this.extensions)t.extensions[h]=!0;let l=[];for(;s=FU.exec(this.src);)l.push(s);for(let h=0;h<l.length;h++){let e=l[h],i=e[0],n=!this.isMethod||!this.getInputByName(i),r=i;if(this.keywords[i]||this.useKeywords&&n&&DU.containsKeyword(i)){let e=this.keywords[i];if(!e){let n=DU.getKeywordData(i);n.cache&&(e=t.keywords[i]),e=e||DU.getKeyword(i,t),n.cache&&(t.keywords[i]=e)}r=e.build(t)}i!==r&&"."!==o[e.index+a-1]&&(o=o.substring(0,e.index+a)+r+o.substring(e.index+i.length+a),a+=r.length-i.length),void 0===this.getIncludeByName(r)&&DU.contains(r)&&t.include(DU.get(r))}return"source"===e?o:this.isMethod?(this.isInterface||t.include(this,void 0,o),this.name):t.format("( "+o+" )",this.getType(t),e)}parse(t,e,i,n){if(this.src=t||"",this.includes=e??[],this.extensions=i??{},this.keywords=n??{},this.isMethod){let t=zU.exec(this.src);if(this.inputs=[],t&&4==t.length){this.type=t[1],this.name=t[2];let e=t[3].match(FU);if(e){let t=0;for(;t<e.length;){let i,n=e[t++];"in"===n||"out"===n||"inout"===n?i=e[t++]:(i=n,n="");let r=e[t++];this.inputs.push({name:r,type:i,qualifier:n})}}this.isInterface=-1===this.src.indexOf("{")}else this.type="",this.name=""}}},UU=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,VU=class extends kU{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0;super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(t||VU.PI,void 0,void 0,void 0,e)}getType(t){return t.getTypeByFormat(this.type)}parse(t,e,i,n,r){this.src=t||"";let s,a,o="",l=UU.exec(t);this.useDefine=r??"#"===this.src.charAt(0),l&&l.length>1?(a=l[1],s=l[2],o=l[3]):(s=this.src,a="f"),this.name=s,this.type=a,this.value=o}build(t,e){if("source"===e){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return t.include(this),t.format(this.name,this.getType(t),e)}generate(t,e,i,n,r){return t.format(this.name,this.getType(t),e)}},jU=VU;jU.PI="PI",jU.PI2="PI2",jU.RECIPROCAL_PI="RECIPROCAL_PI",jU.RECIPROCAL_PI2="RECIPROCAL_PI2",jU.LOG2="LOG2",jU.EPSILON="EPSILON";var GU=new RegExp("^structs*([a-z_0-9]+)s*{s*((.|\n)*?)}","gim"),HU=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),WU=class extends kU{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(t)}getType(t){return t.getTypeByFormat(this.name)}getInputByName(t){let e=this.inputs.length;for(;e--;)if(this.inputs[e].name===t)return this.inputs[e]}generate(t,e,i,n,r){return"source"===e?this.src+";":t.format("( "+this.src+" )",this.getType(t),e)}parse(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.src=t,this.inputs=[];let e=GU.exec(t);if(e){let t,i=e[2];for(;t=HU.exec(i);)this.inputs.push({type:t[1],name:t[2]});this.name=e[1]}else this.name="";this.type=this.name}},qU=class extends kU{constructor(t){super("v2",{shared:!1}),this.nodeType="UV",this.index=t??0}generate(t,e){t.requires.uv[this.index]=!0;let i=this.index>0?this.index+1:"",n=t.isShader("vertex")?"uv"+i:"vUv"+i;return t.format(n,this.getType(t),e)}};DU.addKeyword("uv",(function(){return new qU})),DU.addKeyword("uv2",(function(){return new qU(1)}));var YU=class extends kU{constructor(t,e){super("v4"),this.nodeType="ColorSpace",this.input=t,this.method=e??YU.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(t){switch(t){case gf:return["Linear"];case vf:return["sRGB"];default:return[]}}generate(t,e){let i=this.input.build(t,"v4"),n=this.getType(t),r=YU.Nodes[this.method],s=t.include(r);if(s===YU.LINEAR_TO_LINEAR)return t.format(i,n,e);if(2===r.inputs?.length){let r=this.factor.build(t,"f");return t.format(s+"( "+i+", "+r+" )",n,e)}return t.format(s+"( "+i+" )",n,e)}fromEncoding(t){let e=YU.getEncodingComponents(t);this.method="LinearTo"+e[0],this.factor=e[1]}fromDecoding(t){let e=YU.getEncodingComponents(t);this.method=e[0]+"ToLinear",this.factor=e[1]}},XU=YU;XU.Nodes={LinearToLinear:new NU(["vec4 LinearToLinear( in vec4 value ) {","\treturn value;","}"].join("\n")),sRGBToLinear:new NU(["vec4 sRGBToLinear( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join("\n")),LinearTosRGB:new NU(["vec4 LinearTosRGB( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join("\n"))},XU.LINEAR_TO_LINEAR="LinearToLinear",XU.SRGB_TO_LINEAR="sRGBToLinear",XU.LINEAR_TO_SRGB="LinearTosRGB";var QU=class extends NU{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",arguments.length>4?arguments[4]:void 0,arguments.length>3?arguments[3]:void 0,arguments.length>2?arguments[2]:void 0,arguments.length>1?arguments[1]:void 0),this.nodeType="Expression"}},KU=class extends IU{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new hm,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;super("v4",{shared:!0}),this.nodeType="Texture",this.value=t,this.uv=e??new qU,this.bias=i,this.project=void 0!==n&&n}getTexture(t,e){return super.generate(t,e,this.value.uuid,"t")}generate(t,e){if("sampler2D"===e)return this.getTexture(t,e);let i,n,r=this.getTexture(t,e),s=this.uv.build(t,this.project?"v4":"v2"),a=this.bias?this.bias.build(t,"f"):void 0;void 0===a&&t.context.bias&&(a=t.context.bias.setTexture(this).build(t,"f")),i=this.project?"texture2DProj":a?"tex2DBias":"tex2D",n=a?i+"( "+r+", "+s+", "+a+" )":i+"( "+r+", "+s+" )";let o={include:t.isShader("vertex"),ignoreCache:!0},l=this.getType(t);return t.addContext(o),this.colorSpace=this.colorSpace??new XU(new QU("",l)),this.colorSpace.fromDecoding(t.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(n),n=this.colorSpace.build(t,l),t.removeContext(),t.format(n,l,e)}},ZU=class extends IU{constructor(t){super("f"),this.nodeType="Float",this.value=t??0}generateReadonly(t,e,i,n,r,s){return t.format(this.value+(this.value%1?"":".0"),n,e)}},JU=class extends kU{constructor(t,e){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=t,this.inputs=e??[]}getFunction(){return this.value}getType(t){return this.value.getType(t)}generate(t,e,i,n,r){n=this.getType(t);let s=this.value,a=s.build(t,e)+"( ",o=[];if(s.inputs){for(let e=0;e<s.inputs.length;e++){let i=s.inputs[e],n=this.inputs[e]||this.inputs[i.name];o.push(n.build(t,t.getTypeByFormat(i.type)))}a+=o.join(", ")+" )"}return t.format(a,n,e)}},$U=class extends kU{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:$U.ADD;super(),this.nodeType="Operator",this.type=t.type,this.a=t,this.b=e,this.op=i}getType(t){let e=this.a.getType(t),i=this.b.getType(t);return t.isTypeMatrix(e)?"v4":t.getTypeLength(i)>t.getTypeLength(e)?i:e}generate(t,e){let i=this.getType(t);this.type=i;let n=this.a.build(t,i),r=this.b.build(t,i);return t.format("( "+n+" "+this.op+" "+r+" )",i,e)}},tV=$U;tV.ADD="+",tV.SUB="-",tV.MUL="*",tV.DIV="/";var eV=class extends kU{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:eV.ABS,i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;super(),this.nodeType="Math",this.a=t,"string"!=typeof e?this.b=e:n=e,"string"!=typeof i?this.c=i:n=i,this.method=n,this.hashProperties=["method"]}getNumInputs(t){switch(this.method){case eV.MIX:case eV.CLAMP:case eV.REFRACT:case eV.SMOOTHSTEP:case eV.FACEFORWARD:return 3;case eV.MIN:case eV.MAX:case eV.MOD:case eV.STEP:case eV.REFLECT:case eV.DISTANCE:case eV.DOT:case eV.CROSS:case eV.POW:return 2;default:return 1}}getInputType(t){let e=t.getTypeLength(this.a.getType(t)),i=this.b?t.getTypeLength(this.b.getType(t)):0,n=this.c?t.getTypeLength(this.c.getType(t)):0;return e>i&&e>n?this.a.getType(t):i>n?this.b.getType(t):this.c.getType(t)}getType(t){switch(this.method){case eV.LENGTH:case eV.DISTANCE:case eV.DOT:return"f";case eV.CROSS:return"v3"}return this.getInputType(t)}generate(t,e){let i,n,r,s=this.a?t.getTypeLength(this.a.getType(t)):0,a=this.b?t.getTypeLength(this.b.getType(t)):0,o=this.c?t.getTypeLength(this.c.getType(t)):0,l=this.getInputType(t),h=this.getType(t);switch(this.type=h,this.method){case eV.NEGATE:return t.format("( -"+this.a.build(t,l)+" )",l,e);case eV.INVERT:return t.format("( 1.0 - "+this.a.build(t,l)+" )",l,e);case eV.CROSS:i=this.a.build(t,"v3"),n=this.b.build(t,"v3");break;case eV.STEP:i=this.a.build(t,1===s?"f":l),n=this.b.build(t,l);break;case eV.MIN:case eV.MAX:case eV.MOD:i=this.a.build(t,l),n=this.b.build(t,1===a?"f":l);break;case eV.REFRACT:i=this.a.build(t,l),n=this.b.build(t,l),r=this.c.build(t,"f");break;case eV.MIX:i=this.a.build(t,l),n=this.b.build(t,l),r=this.c.build(t,1===o?"f":l);break;default:i=this.a.build(t,l),this.b&&(n=this.b.build(t,l)),this.c&&(r=this.c.build(t,l))}let c=[];c.push(i),n&&c.push(n),r&&c.push(r);let u=this.getNumInputs(t);if(c.length!==u)throw Error(`Arguments not match used in "${this.method}". Require ${u}, currently ${c.length}.`);return t.format(this.method+"( "+c.join(", ")+" )",h,e)}},iV=eV;iV.RAD="radians",iV.DEG="degrees",iV.EXP="exp",iV.EXP2="exp2",iV.LOG="log",iV.LOG2="log2",iV.SQRT="sqrt",iV.INV_SQRT="inversesqrt",iV.FLOOR="floor",iV.CEIL="ceil",iV.NORMALIZE="normalize",iV.FRACT="fract",iV.SATURATE="saturate",iV.SIN="sin",iV.COS="cos",iV.TAN="tan",iV.ASIN="asin",iV.ACOS="acos",iV.ARCTAN="atan",iV.ABS="abs",iV.SIGN="sign",iV.LENGTH="length",iV.NEGATE="negate",iV.INVERT="invert",iV.MIN="min",iV.MAX="max",iV.MOD="mod",iV.STEP="step",iV.REFLECT="reflect",iV.DISTANCE="distance",iV.DOT="dot",iV.CROSS="cross",iV.POW="pow",iV.MIX="mix",iV.CLAMP="clamp",iV.REFRACT="refract",iV.SMOOTHSTEP="smoothstep",iV.FACEFORWARD="faceforward";var nV=class extends kU{constructor(t,e,i){super("v4"),this.nodeType="TextureCubeUV",this.value=t,this.uv=e,this.bias=i}bilinearCubeUV(t,e,i,n){let r=new JU(nV.Nodes.bilinearCubeUV,[e,i,n]);this.colorSpaceTL=this.colorSpaceTL??new XU(new QU("","v4")),this.colorSpaceTL.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(r.build(t)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new XU(new QU("","v4")),this.colorSpaceTR.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(r.build(t)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new XU(new QU("","v4")),this.colorSpaceBL.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(r.build(t)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new XU(new QU("","v4")),this.colorSpaceBR.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(r.build(t)+".br");let s={include:t.isShader("vertex"),ignoreCache:!0};t.addContext(s),this.colorSpaceTLExp=new QU(this.colorSpaceTL.build(t,"v4"),"v4"),this.colorSpaceTRExp=new QU(this.colorSpaceTR.build(t,"v4"),"v4"),this.colorSpaceBLExp=new QU(this.colorSpaceBL.build(t,"v4"),"v4"),this.colorSpaceBRExp=new QU(this.colorSpaceBR.build(t,"v4"),"v4"),t.removeContext();let a=new QU("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return a.keywords.cubeUV_TL=this.colorSpaceTLExp,a.keywords.cubeUV_TR=this.colorSpaceTRExp,a.keywords.cubeUV_BL=this.colorSpaceBLExp,a.keywords.cubeUV_BR=this.colorSpaceBRExp,a.keywords.cubeUV=r,a}generate(t,e){if(t.isShader("fragment")){let i=this.uv,n=this.bias||t.context.roughness,r=new JU(nV.Nodes.roughnessToMip,[n]),s=new iV(r,nV.Nodes.m0,nV.Nodes.cubeUV_maxMipLevel,iV.CLAMP),a=new iV(s,iV.FLOOR),o=new iV(s,iV.FRACT),l=this.bilinearCubeUV(t,this.value,i,a),h=this.bilinearCubeUV(t,this.value,i,new tV(a,new ZU(1).setReadonly(!0),tV.ADD)),c=new iV(l,h,o,iV.MIX);return t.format(c.build(t),"v4",e)}return console.warn("TextureCubeUVNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e)}},rV=nV;rV.Nodes=function(){let t=new WU("struct TextureCubeUVData {\n\t\t\tvec4 tl;\n\t\t\tvec4 tr;\n\t\t\tvec4 br;\n\t\t\tvec4 bl;\n\t\t\tvec2 f;\n\t\t}"),e=new jU("float cubeUV_maxMipLevel 8.0",!0),i=new jU("float cubeUV_minMipLevel 4.0",!0),n=new jU("float cubeUV_maxTileSize 256.0",!0),r=new jU("float cubeUV_minTileSize 16.0",!0),s=new NU("float getFace(vec3 direction) {\n\t\t\t\tvec3 absDirection = abs(direction);\n\t\t\t\tfloat face = -1.0;\n\t\t\t\tif (absDirection.x > absDirection.z) {\n\t\t\t\t\tif (absDirection.x > absDirection.y)\n\t\t\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t} else {\n\t\t\t\t\tif (absDirection.z > absDirection.y)\n\t\t\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t}\n\t\t\t\treturn face;\n\t\t}");s.useKeywords=!1;let a=new NU("vec2 getUV(vec3 direction, float face) {\n\t\t\t\tvec2 uv;\n\t\t\t\tif (face == 0.0) {\n\t\t\t\t\tuv = vec2(direction.z, direction.y) / abs(direction.x); // pos x\n\t\t\t\t} else if (face == 1.0) {\n\t\t\t\t\tuv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y\n\t\t\t\t} else if (face == 2.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z\n\t\t\t\t} else if (face == 3.0) {\n\t\t\t\t\tuv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x\n\t\t\t\t} else if (face == 4.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y\n\t\t\t\t} else {\n\t\t\t\t\tuv = vec2(direction.x, direction.y) / abs(direction.z); // neg z\n\t\t\t\t}\n\t\t\t\treturn 0.5 * (uv + 1.0);\n\t\t}");a.useKeywords=!1;let o=new NU("TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n\t\t\tfloat face = getFace(direction);\n\t\t\tfloat filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n\t\t\tmipInt = max(mipInt, cubeUV_minMipLevel);\n\t\t\tfloat faceSize = exp2(mipInt);\n\t\t\tfloat texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n\t\t\tvec2 uv = getUV(direction, face) * (faceSize - 1.0);\n\t\t\tvec2 f = fract(uv);\n\t\t\tuv += 0.5 - f;\n\t\t\tif (face > 2.0) {\n\t\t\t\tuv.y += faceSize;\n\t\t\t\tface -= 3.0;\n\t\t\t}\n\t\t\tuv.x += face * faceSize;\n\t\t\tif(mipInt < cubeUV_maxMipLevel){\n\t\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t\t}\n\t\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\t\tuv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n\t\t\tuv *= texelSize;\n\t\t\tvec4 tl = texture2D(envMap, uv);\n\t\t\tuv.x += texelSize;\n\t\t\tvec4 tr = texture2D(envMap, uv);\n\t\t\tuv.y += texelSize;\n\t\t\tvec4 br = texture2D(envMap, uv);\n\t\t\tuv.x -= texelSize;\n\t\t\tvec4 bl = texture2D(envMap, uv);\n\t\t\treturn TextureCubeUVData( tl, tr, br, bl, f );\n\t\t}",[t,s,a,e,i,n,r]);o.useKeywords=!1;let l=new jU("float r0 1.0",!0),h=new jU("float v0 0.339",!0),c=new jU("float m0 -2.0",!0),u=new jU("float r1 0.8",!0),d=new jU("float v1 0.276",!0),p=new jU("float m1 -1.0",!0),f=new jU("float r4 0.4",!0),m=new jU("float v4 0.046",!0),g=new jU("float m4 2.0",!0),v=new jU("float r5 0.305",!0),y=new jU("float v5 0.016",!0),b=new jU("float m5 3.0",!0),x=new jU("float r6 0.21",!0),w=new jU("float v6 0.0038",!0),S=new jU("float m6 4.0",!0);return{bilinearCubeUV:o,roughnessToMip:new NU("float roughnessToMip(float roughness) {\n\t\t\tfloat mip = 0.0;\n\t\t\tif (roughness >= r1) {\n\t\t\t\tmip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n\t\t\t} else if (roughness >= r4) {\n\t\t\t\tmip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n\t\t\t} else if (roughness >= r5) {\n\t\t\t\tmip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n\t\t\t} else if (roughness >= r6) {\n\t\t\t\tmip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n\t\t\t} else {\n\t\t\t\tmip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25\n\t\t\t}\n\t\t\treturn mip;\n\t\t}",[l,h,c,u,d,p,f,m,g,v,y,b,x,w,S]),m0:c,cubeUV_maxMipLevel:e}}();var sV=class extends kU{constructor(t){super("v3"),this.nodeType="Normal",this.scope=t??sV.VIEW}getShared(){return this.scope===sV.WORLD}build(t,e,i,n){let r=t.context[this.scope+"Normal"];return r?r.build(t,e,i,n):super.build(t,e,i)}generate(t,e,i,n,r){let s;switch(this.scope){case sV.VIEW:s=t.isShader("vertex")?"transformedNormal":"geometryNormal";break;case sV.LOCAL:t.isShader("vertex")?s="objectNormal":(t.requires.normal=!0,s="vObjectNormal");break;case sV.WORLD:t.isShader("vertex")?s="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(t.requires.worldNormal=!0,s="vWNormal")}return t.format(s,this.getType(t),e)}},aV=sV;aV.LOCAL="local",aV.WORLD="world",aV.VIEW="view",aV.NORMAL="normal",DU.addKeyword("viewNormal",(function(){return new aV(aV.VIEW)})),DU.addKeyword("localNormal",(function(){return new aV(aV.NORMAL)})),DU.addKeyword("worldNormal",(function(){return new aV(aV.WORLD)}));var oV=class extends kU{constructor(t){super("v3"),this.nodeType="Position",this.scope=t??oV.LOCAL}getType(){return this.scope===oV.PROJECTION?"v4":this.type}getShader(){switch(this.scope){case oV.LOCAL:case oV.WORLD:return!1}return!0}generate(t,e,i,n,r){let s;switch(this.scope){case oV.LOCAL:t.isShader("vertex")?s="transformed":(t.requires.position=!0,s="vPosition");break;case oV.WORLD:if(t.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";t.requires.worldPosition=!0,s="vWPosition";break;case oV.VIEW:s=t.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case oV.PROJECTION:s=t.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )"}return t.format(s,this.getType(),e)}},lV=oV;lV.LOCAL="local",lV.WORLD="world",lV.VIEW="view",lV.PROJECTION="projection",DU.addKeyword("position",(function(){return new lV})),DU.addKeyword("worldPosition",(function(){return new lV(lV.WORLD)})),DU.addKeyword("viewPosition",(function(){return new lV(lV.VIEW)}));var hV=class extends kU{constructor(t){super("v3"),this.nodeType="Reflect",this.scope=t??hV.CUBE}getUnique(t){return!t.context.viewNormal}getType(){return this.scope===hV.SPHERE?"v2":this.type}generate(t,e){let i=this.getUnique(t);if(t.isShader("fragment")){let n;switch(this.scope){case hV.VECTOR:{let e=new aV(aV.VIEW),r=t.context.roughness,s=e.build(t,"v3"),a=new lV(lV.VIEW).build(t,"v3"),o=r?r.build(t,"f"):void 0,l=`reflect( -normalize( ${a} ), ${s} )`;o&&(l=`normalize( mix( ${l}, ${s}, ${o} * ${o} ) )`);let h=`inverseTransformDirection( ${l}, viewMatrix )`;i?(t.addNodeCode(`vec3 reflectVec = ${h};`),n="reflectVec"):n=h;break}case hV.CUBE:{let e=new hV(hV.VECTOR).build(t,"v3"),r="vec3( -"+e+".x, "+e+".yz )";i?(t.addNodeCode(`vec3 reflectCubeVec = ${r};`),n="reflectCubeVec"):n=r;break}case hV.SPHERE:{let e="normalize( ( viewMatrix * vec4( "+new hV(hV.VECTOR).build(t,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";i?(t.addNodeCode(`vec2 reflectSphereVec = ${e};`),n="reflectSphereVec"):n=e;break}}return t.format(n,this.getType(),e)}return console.warn("ReflectNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.type,e)}},cV=hV;cV.CUBE="cube",cV.SPHERE="sphere",cV.VECTOR="vector";var uV=class extends kU{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new KU,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;super("v4"),this.nodeType="TextureCube",this.value=t,this.radianceNode=new rV(this.value,e??new cV(cV.VECTOR),i),this.irradianceNode=new rV(this.value,new aV(aV.WORLD),new ZU(1).setReadonly(!0))}generate(t,e){return t.isShader("fragment")?(t.require("irradiance"),t.context.bias&&t.context.bias.setTexture(this.value),("irradiance"===t.slot?this.irradianceNode:this.radianceNode).build(t,e)):(console.warn("TextureCubeNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e))}},dV=class extends IU{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new gv,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=t,this.uv=e??new cV,this.bias=i}getTexture(t,e){return super.generate(t,e,this.value.uuid,"tc")}generate(t,e){if("samplerCube"===e)return this.getTexture(t,e);let i,n=this.getTexture(t,e),r=this.uv?.build(t,"v3"),s=this.bias?this.bias.build(t,"f"):void 0;void 0===s&&t.context.bias&&(s=t.context.bias.setTexture(this).build(t,"f")),i=s?"texCubeBias( "+n+", "+r+", "+s+" )":"texCube( "+n+", "+r+" )";let a={include:t.isShader("vertex"),ignoreCache:!0},o=this.getType(t);return t.addContext(a),this.colorSpace=this.colorSpace??new XU(new QU("",o)),this.colorSpace.fromDecoding(t.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(i),i=this.colorSpace.build(t,o),t.removeContext(),t.format(i,o,e)}},pV=["x","y","z","w"],fV=["float","vec2","vec3","vec4"],mV={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},gV={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},vV=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=function(){function t(t,e){return t.deps.length-e.deps.length}return function(e,i){let n=this.getIncludes(e,i);if(!n)return"";let r="";n=n.sort(t);for(let t=0;t<n.length;t++)n[t].src&&(r+=n[t].src+"\n");return r}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCube(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif","\n\t\t\t// NOTE: Include Spline's blending modes. This could be part of BlendNode\n\t\t\t#define SPE_BLENDING_NORMAL 0\n\t\t\t#define SPE_BLENDING_MULTIPLY 1\n\t\t\t#define SPE_BLENDING_SCREEN 2\n\t\t\t#define SPE_BLENDING_OVERLAY 3\n\n\t\t\tvec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, a * b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );\n\t\t\t\treturn mix( a, tmp, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );\n\t\t\t\treturn clamp( mix( a, tmp, alpha ), 0.0, 1.0 );\n\t\t\t}\n\n\t\t\tvec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {\n\t\t\t\tif ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );\n\t\t\t\treturn vec3( 1.0 );\n\t\t\t}\n\t\t\t","#include <packing>","#include <common>"].join("\n"),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join("\n"),fragment:["float accumAlpha = 0.0;","void accumulateAlpha(float alpha) {\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * alpha;\n\t\t\t\t}",""].join("\n")},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(t,e){this.addVertexParsCode("\nuniform int frameIndex;\nuniform vec2 resolution;\nuniform mat4 previousModelViewMatrix;\nuniform mat4 previousProjectionMatrix;\n\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n"),this.addFragmentParsCode("\nlayout(location = 1) out vec4 gVelocity;\n\nuniform int frameIndex;\nuniform vec2 resolution;\n\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n\nconst vec2 haltonSequence[16] = vec2[16](\nvec2( 0.000000,-0.333334),\nvec2(-0.500000, 0.333334),\nvec2( 0.500000,-0.777778),\nvec2(-0.750000,-0.111112),\nvec2( 0.250000, 0.555556),\nvec2(-0.250000,-0.555556),\nvec2( 0.750000, 0.111112),\nvec2(-0.875000, 0.777778),\nvec2(0.125000, -0.925926),\nvec2(-0.375000, -0.259260),\nvec2(0.625000, 0.407408),\nvec2(-0.625000, -0.703704),\nvec2(0.375000, -0.037038),\nvec2(-0.125000, 0.629630),\nvec2(0.875000, -0.481482),\nvec2(-0.937500, 0.185186));\n\nvec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {\n  const float goldenAngle = 2.399963f; // radians\n  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));\n  float theta = float(sampleIndex) * goldenAngle + angle;\n  float sine = sin(theta);\n  float cosine = cos(theta);\n  return vec2(cosine, sine) * r;\n}\n\n// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso\nfloat getNoiseInterleavedGradient(vec2 screenPos) {\n    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);\n    return fract(magic.z * fract(dot(screenPos, magic.xy)));\n}\n\n"),this.buildShader("vertex",t),this.buildShader("fragment",e);for(let i=0;i<this.requires.uv.length;i++)if(this.requires.uv[i]){let t=i>0?i+1:"";this.addVaryCode("varying vec2 vUv"+t+";"),i>0&&this.addVertexParsCode("attribute vec2 uv"+t+";"),this.addVertexFinalCode("vUv"+t+" = uv"+t+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("\n\t\t\t\t#ifndef SHAPEBLEND \n\t\t\t\t\tvObjectNormal = normal;\n\t\t\t\t#else\n\t\t\t\t\tvObjectNormal = objectNormal;\n\t\t\t\t#endif\n\t\t\t")),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode("\n// TODO: This could be generated CPU side and passed to the shader every frame\nconst vec2 haltonSequence[16] = vec2[16](\nvec2( 0.000000,-0.333334),\nvec2(-0.500000, 0.333334),\nvec2( 0.500000,-0.777778),\nvec2(-0.750000,-0.111112),\nvec2( 0.250000, 0.555556),\nvec2(-0.250000,-0.555556),\nvec2( 0.750000, 0.111112),\nvec2(-0.875000, 0.777778),\nvec2(0.125000, -0.925926),\nvec2(-0.375000, -0.259260),\nvec2(0.625000, 0.407408),\nvec2(-0.625000, -0.703704),\nvec2(0.375000, -0.037038),\nvec2(-0.125000, 0.629630),\nvec2(0.875000, -0.481482),\nvec2(-0.937500, 0.185186));\n\n// TODO: Pass correct view size\nvec2 offset = haltonSequence[frameIndex];\noffset.x /= resolution.x;\noffset.y /= resolution.y;\n\nvec4 currentPosition = gl_Position;\nvec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);\n\n// We want to calculate the velocity with unjittered positions\n// so that things that are not moving get a velocity = 0\nvCurrentPosition = currentPosition;\nvPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);\n#ifdef OUTLINE_COMPENSATION\nvPreviousPosition.xy += OUTLINE_COMPENSATION;\n#endif\ngl_Position = currentPositionJittered;\n\n"),this.addFragmentFinalCode("\nvec2 oldPos = vPreviousPosition.xy;\n    oldPos /= vPreviousPosition.w;\n    oldPos.xy = (oldPos.xy+1.)/2.0;\n\nvec2 newPos = vCurrentPosition.xy;\n    newPos /= vCurrentPosition.w;\n    newPos.xy = (newPos.xy+1.)/2.0;\n\nvec2 velocity = (newPos - oldPos);\n\n// Discard fully transparent pixels \nif (gl_FragColor.a <= 0.0) discard;\n\ngVelocity = vec4(velocity, 0.0, 1.0);\n")),this}buildShader(t,e){this.resultCode[t]=e.build(this.setShader(t),"v4")}setMaterial(t,e){return this.defines={},this}addFlow(t,e,i){return this.addSlot(t).addCache(e).addContext(i)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(t){return this.cache=t??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(t){return this.context=Object.assign({},this.context,t),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(t){return this.slot=t||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(t,e){void 0===this.fragmentVariables[t]&&(this.addFragmentCode(`${e} ${t};`),this.fragmentVariables[t]="")}addFragmentParsVariable(t,e){void 0===this.fragmentParsVariables[t]&&(this.addFragmentParsCode(`${e} ${t};`),this.fragmentParsVariables[t]="")}addVertexParsVariable(t,e){void 0===this.vertexParsVariables[t]&&(this.addVertexParsCode(`${e} ${t};`),this.vertexParsVariables[t]="")}addVertexCode(t){this.addCode(t,"vertex")}addFragmentCode(t){this.addCode(t,"fragment")}addCode(t,e){this.code[e??this.shader]+=t+"\n"}addVertexNodeCode(t){this.addNodeCode(t,"vertex")}addFragmentNodeCode(t){this.addNodeCode(t,"fragment")}addNodeCode(t,e){this.nodeCode[e??this.shader]+=t+"\n"}clearNodeCode(t){t=t??this.shader;let e=this.nodeCode[t];return this.nodeCode[t]="",e}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(t){this.addFinalCode(t,"vertex")}addFragmentFinalCode(t){this.addFinalCode(t,"fragment")}addFinalCode(t,e){this.finalCode[e??this.shader]+=t+"\n"}addVertexParsCode(t){this.addParsCode(t,"vertex")}addFragmentParsCode(t){this.addParsCode(t,"fragment")}addParsCode(t,e){this.parsCode[e??this.shader]+=t+"\n"}addVaryCode(t){this.addVertexParsCode(t),this.addFragmentParsCode(t)}isCache(t){return-1!==this.caches.indexOf(t)}isSlot(t){return-1!==this.slots.indexOf(t)}define(t,e){this.defines[t]=void 0===e?1:e}require(t){this.requires[t]=!0}isDefined(t){return void 0!==this.defines[t]}getVar(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"varying",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"V",s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",a=this.getVars(n),o=a[t];if(!o){let n=a.length;o={name:i||"node"+r+n+(s?"_"+s:""),type:e},a.push(o),a[t]=o}return o}getTempVar(t,e,i,n){return this.getVar(t,e,i,this.shader,"T",n)}getAttribute(t,e){if(!this.attributes[t]){let i=this.getVar(t,e);this.addVertexParsCode("attribute "+e+" "+t+";"),this.addVertexFinalCode(i.name+" = "+t+";"),this.attributes[t]={varying:i,name:t,type:e}}return this.attributes[t]}getCode(t){return[this.prefixCode,this.parsCode[t],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[t],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[t],"uniform"),this.getIncludesCode("consts",t),this.getIncludesCode("structs",t),this.getIncludesCode("functions",t),"void main() {",this.getVarListCode(this.getVars(t)),this.code[t],this.resultCode[t],this.finalCode[t],"}"].join("\n")}getVarListCode(t,e){e=e??"";let i="";for(let n=0,r=t.length;n<r;++n){let r=t[n],s=r.type,a=r.name,o=r.size,l=this.getFormatByType(s);if(void 0===l)throw new Error("Node pars "+l+" not found.");l.includes("[]")?i+=e+" "+l.substring(0,l.length-2)+" "+a+`[${o}];\n`:i+=e+" "+l+" "+a+";\n"}return i}getVars(t){return this.inputs.vars[t??this.shader]}getNodeData(t){let e=t instanceof PU?t.uuid:t;return this.nodeData[e]=this.nodeData[e]||{}}createUniform(t,e,i,n,r,s){if(e.includes("[]")){let a=this.inputs.arrayUniforms,o=a.list.length,l=new TU({type:e,size:i.size,name:n||"nodeUA"+o+(s?"_"+s:""),node:i,needsUpdate:r});return a.list.push(l),a[t].push(l),a[t][l.name]=l,this.uniforms[l.name]=l,l}{let a=this.inputs.uniforms,o=a.list.length,l=new TU({type:e,name:n||"nodeU"+o+(s?"_"+s:""),node:i,needsUpdate:r});return a.list.push(l),a[t].push(l),a[t][l.name]=l,this.uniforms[l.name]=l,l}}createVertexUniform(t,e,i,n,r){return this.createUniform("vertex",t,e,i,n,r)}createFragmentUniform(t,e,i,n,r){return this.createUniform("fragment",t,e,i,n,r)}include(t,e,i){let n;if(t="string"==typeof t?DU.get(t):t,!1===this.context.include)return t.name;t instanceof NU?n=this.includes.functions:t instanceof jU?n=this.includes.consts:t instanceof WU&&(n=this.includes.structs);let r=n[this.shader]=n[this.shader]||[];if(t){let n=r[t.name];if(n||(n=r[t.name]={node:t,deps:[]},r.push(n),n.src=t.build(this,"source")),t instanceof NU&&e&&r[e.name]&&-1===r[e.name].deps.indexOf(t)&&(r[e.name].deps.push(t),t.includes?.length)){let i=0;do{this.include(t.includes[i++],e)}while(i<t.includes.length)}return i&&(n.src=i),t.name}throw new Error("Include not found.")}colorToVectorProperties(t){return t.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(t){return t.replace(/c/g,"v3")}getIncludes(t,e){return this.includes[t][e||this.shader]}getConstructorFromLength(t){return fV[t-1]}isTypeMatrix(t){return/^m/.test(t)}getTypeLength(t){return"f"===t?1:parseInt(this.colorToVector(t).substr(1))}getTypeFromLength(t){return 1===t?"f":"v"+t}findNode(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];for(let n=0;n<arguments.length;n++){let t=e[n];if(t?.isNode)return t}}resolve(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];for(let n=0;n<arguments.length;n++){let t=e[n];if(void 0!==t){if(t.isNode)return t;if(t.isTexture)switch(t.mapping){case Op:case Lp:return new dV(t);case Bp:return new uV(new KU(t));default:return new KU(t)}else{if(t.isVector2)return new RU(t);if(t.isVector3)return new OU(t);if(t.isVector4)return new BU(t)}}}}format(t,e,i){switch(this.colorToVector(i+" <- "+e)){case"f <- v2":case"f <- v3":case"f <- v4":return t+".x";case"f <- i":case"f <- b":return"float( "+t+" )";case"v2 <- f":return"vec2( "+t+" )";case"v2 <- v3":case"v2 <- v4":return t+".xy";case"v2 <- i":case"v2 <- b":case"v3 <- i":case"v3 <- b":return"vec2( float( "+t+" ) )";case"v3 <- f":return"vec3( "+t+" )";case"v3 <- v2":return"vec3( "+t+", 0.0 )";case"v3 <- v4":return t+".xyz";case"v4 <- f":return"vec4( "+t+" )";case"v4 <- v2":return"vec4( "+t+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+t+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+t+" ) )";case"i <- f":case"i <- b":return"int( "+t+" )";case"i <- v2":case"i <- v3":case"i <- v4":return"int( "+t+".x )";case"b <- f":return"( "+t+" != 0.0 )";case"b <- v2":return"( "+t+" != vec2( 0.0 ) )";case"b <- v3":return"( "+t+" != vec3( 0.0 ) )";case"b <- v4":return"( "+t+" != vec4( 0.0 ) )";case"b <- i":return"( "+t+" != 0 )"}return t}getTypeByFormat(t){return mV[t]||t}getFormatByType(t){return gV[t]||t}getUUID(t,e){return(e=void 0===e||e)&&this.cache&&(t=this.cache+"-"+t),t}getElementByIndex(t){return pV[t]}getIndexByElement(t){return pV.indexOf(t)}isShader(t){return this.shader===t}setShader(t){return this.shader=t,this}mergeDefines(t){for(let e in t)this.defines[e]=t[e];return this.defines}mergeUniform(t){for(let e in t)this.uniforms[e]=t[e];return this.uniforms}getTextureEncodingFromMap(t){let e;return t?t.isTexture&&(e=t.encoding):e=gf,e===gf&&this.context.gamma&&(e=vf),e}},yV=class extends IU{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;super("c"),this.nodeType="Color",this.value=t instanceof LU?t:new LU(t||0,e,i,n)}setRGBA(t){this.value.setRGBA(t.r,t.g,t.b,t.a)}generate(t,e,i,n,r,s){i=t.getUUID(i??this.getUUID()),n=n??this.getType(t);let a=t.getNodeData(i),o=this.getReadonly()&&void 0!==this.generateReadonly;if(this.alpha){let e=this.alpha.build(t,"f");t.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${e};`)}return o?this.generateReadonly(t,e,i,n,r,s):t.isShader("vertex")?(a.vertex||(a.vertex=t.createVertexUniform(n,this,r,s,this.getLabel())),t.format(a.vertex.name,n,e)):(a.fragment||(a.fragment=t.createFragmentUniform(n,this,r,s,this.getLabel())),t.format(a.fragment.name,n,e))}generateReadonly(t,e,i,n,r,s){return t.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",n,e)}},bV=class extends IU{constructor(t){super("i"),this.nodeType="Int",this.value=Math.floor(t??0)}generateReadonly(t,e,i,n,r,s){return t.format(this.value.toString(),n,e)}},xV=class extends IU{constructor(t){super("b"),this.nodeType="Bool",this.value=t??!1}generateReadonly(t,e,i,n){return t.format(this.value?"true":"false",n,e)}},wV=class extends IU{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1?arguments[1]:void 0;super("f[]"),this.nodeType="FloatArray",this.size=t,this.value=Array.isArray(e)?e:"number"==typeof e?new Array(t).fill(e):new Array(t).fill(0)}},SV=class extends IU{},AV=class extends SV{constructor(t){super("v3"),this.image=t,this._value=new mm}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},EV=class extends SV{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1008,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1006;super("t"),this.image=t,this.wrap=e,this.minFilter=i,this.magFilter=n}get value(){return this.image.getTexture(this.wrap,this.minFilter,this.magFilter)}},_V=class extends IU{constructor(t){super("m3"),this.nodeType="Matrix3",this.value=t??new Vf}generateReadonly(t,e,i,n,r,s){return t.format("mat3("+this.value.elements.join(", ")+")",n,e)}get elements(){return this.value.elements}set elements(t){this.value.fromArray(t)}},CV=class extends IU{constructor(t){super("m4"),this.nodeType="Matrix4",this.value=t??new Wm}generateReadonly(t,e,i,n,r,s){return t.format("mat4("+this.value.elements.join(", ")+")",n,e)}get elements(){return this.value.elements}set elements(t){this.value.fromArray(t)}};function MV(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t.setUvTransform(i[0],i[1],e[0],e[1],0,0,0).premultiply((new Vf).makeRotation(n*Nf.DEG2RAD))}var PV=class extends _V{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(new Vf),this.repeat=t,this.offset=e,this.rotation=i,MV(this.value,t,e,i)}updateMatrix(){MV(this.value,this.repeat,this.offset,this.rotation)}},TV=class extends IU{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1?arguments[1]:void 0;super("v4[]"),this.nodeType="Vector4Array",this.size=t,this.value=Array.isArray(e)?e:e instanceof cm?new Array(t).fill(e):new Array(t).fill(new cm(0))}},DV=class extends kU{constructor(t,e,i,n){super("v3"),this.nodeType="Blend",this.a=t,this.b=e,this.alpha=i,this.mode=n}generate(t,e){if(t.isShader("fragment")){let i=[];return i.push(this.a.build(t,"c")),i.push(this.b.build(t,"c")),i.push(this.alpha.build(t,"f")),i.push(this.mode.build(t,"i")),t.format("spe_blend("+i.join(",")+")",this.getType(t),e)}return console.warn("BlendNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},kV=class extends kU{constructor(t,e){super("v3"),this.nodeType="CustomColor",this.color=t,this.alpha=e,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.isShader("fragment")){let i=t.include(kV.Nodes.customColor);t.addFragmentVariable(this.calpha,"float");let n=[];return n.push(this.color.build(t,"v3")),n.push(this.mask?`luminance(${this.mask.build(t,"v3")})`:"1.0"),n.push(this.alpha.build(t,"f")),n.push(this.calpha),t.format(i+"("+n.join(",")+")",this.getType(t),e)}return console.warn("CustomColorNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},IV=kV;IV.Nodes={customColor:new NU("vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {\n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha;\n\n\t\t\t\treturn color;\n\t\t\t}")};var RV=class extends kU{constructor(t,e){super("v3"),this.nodeType="CustomNormal",this.cnormal=t,this.alpha=e,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.isShader("fragment")){let i=t.include(RV.Nodes.customNormal);t.addFragmentVariable(this.calpha,"float");let n=[];return n.push(this.cnormal.build(t,"v3")),n.push("normal"),n.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),n.push(this.alpha.build(t,"f")),n.push(this.calpha),t.format(i+"("+n.join(",")+")",this.getType(t),e)}return console.warn("CustomNormalNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},OV=RV;OV.Nodes={customNormal:new NU("vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {\n\t\t\t\tvec3 normal = packNormalToRGB( norm ).rgb;\n\t\t\t\tnormal *= step( vec3(0.5), cnormal );\n\n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\n\t\t\t\treturn normal;\n\t\t\t}")};var LV=class extends kU{constructor(t,e,i,n,r,s,a,o,l,h,c,u){super("v3"),this.nodeType="CustomTexture",this.texture=t,this.textureSize=e,this.crop=i,this.projection=n,this.axis=r,this.side=s,this.size=a,this.blending=o,this.mat=l,this.isMask=u,this.alpha=h,this.mode=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){t.require("position"),t.require("normal"),t.require("uv"),t.requires.uv=[!0],t.extensions.shaderTextureLOD=!0,t.extensions.derivatives=!0;let i,n=`g${this.uuid.toString().replace(/-/g,"")}`;switch(this.projection.value){case 3:i=t.include(LV.Nodes.cylindrical);break;case 2:i=t.include(LV.Nodes.spherical);break;case 1:let e=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],r=["zy","xz","xy"][this.axis.value],s=new NU(`\n\t\tvec3 ${n}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n\t\t\t\tvec2 projected = (1. + (position.${r})) / 2.;\n\t\t\t\tvec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n\t\t\t\tvec4 tmp = texture2D( tex, uvs );\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\t${2===this.side.value?"":`lalpha *= step(0.0, ${1===this.side.value?"-1.0 * ":""}dot(vObjectNormal, ${e}));`}\n\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}`);i=t.include(s);break;case 4:i=t.include(LV.Nodes.triplanar);break;default:i=t.include(LV.Nodes.uv)}t.addFragmentVariable(this.calpha,"float");let r=[];if(r.push("normal"),r.push(this.texture.generate(t,"t")),r.push(this.textureSize.build(t,"v2")),r.push(this.crop.build(t,"f")),r.push(this.mat.build(t,"mat3")),r.push(this.size.build(t,"v2")),r.push(this.blending.build(t,"f")),r.push(this.isMask.build(t,"b")),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.mode.build(t,"i")),r.push(this.calpha),4===this.projection.value){let e=`${n}_writeUvs`,i=e+"0",s=e+"1",a=e+"2",o=`${n}_triplanarWeights`;t.addFragmentVariable(i,"vec2"),t.addFragmentVariable(s,"vec2"),t.addFragmentVariable(a,"vec2"),t.addFragmentVariable(o,"vec3"),r.push(i),r.push(s),r.push(a),r.push(o)}else{let e=`${n}_writeUvs`;t.addFragmentVariable(e,"vec2"),r.push(e)}return t.format(i+"("+r.join(",")+")",this.getType(t),e)}},BV=LV;BV.Nodes={cylindrical:new NU("\nvec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n                vec3 posN = normalize(position);\n                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);\n                float scaledHeight = position.y / (size.y * 0.5);\n                float v =  (scaledHeight / 2.) + .5;\n\n                vec2 calculatedUv = vec2(u,v);\n\t\t\t\tvec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n                vec2 df = fwidth(uvs);\n               \tif(df.x > 0.5) df.x = 0.;\n\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#else\n                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\t\t\t\t\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}\n"),spherical:new NU("\nvec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n                vec3 posN = normalize(vPosition);\n                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);\n                float v = 0.5 + asin(posN.y) / 3.1415;\n\n                vec2 calculatedUv = vec2(u,v);\n\t\t\t\tvec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n                vec2 df = fwidth(uvs);\n               \tif(df.x > 0.5) df.x = 0.;\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#else\n                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}\n"),uv:new NU("vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n\t\t\t\tvec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n\t\t\t\tvec4 tmp = texture2D( tex, uvs );\n\n\t\t\t\tvec3 col = tmp.rgb;\n\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}"),triplanar:new NU("vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {\n\t\t\t\tvec3 p = position;\n\t\t\t\tvec2 uv0 = (1.0 + p.xy) / 2.0;     \n\t\t\t\tvec2 uv1 = (1.0 + p.zy) / 2.0;\t\t\n\t\t\t\tvec2 uv2 = (1.0 + p.xz) / 2.0;\t\t\n\t\n\t\t\t\tuv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\t\t\t\tuv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\t\t\t\tuv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\n\t\t\t\t// Range from 3 to 128 seems to be good\n\t\t\t\tfloat exponent = (1.0 - blending) * 125.0 + 3.0;\n\n\t\t\t\tvec3 n = vObjectNormal;\n\t\t\t\tvec3 weights = abs(normalize(n));\n\t\t\t\tweights = pow(weights, vec3(exponent));\n\t\t\t\tweights /= dot(weights, vec3(1.0));\n\n\t\t\t\t// Write out all sets of UVs that we generated\n\t\t\t\twriteUvs0 = uv0;\n\t\t\t\twriteUvs1 = uv1;\n\t\t\t\twriteUvs2 = uv2;\n\t\t\t\twriteWeights = weights;\n\n\t\t\t\t// Derivatives for LOD\n\t\t\t\tvec2 df0 = fwidth(uv0);\n\t\t\t\tvec2 df1 = fwidth(uv1);\n\t\t\t\tvec2 df2 = fwidth(uv2);\n\t\t\t\tif (df0.x > 0.5) df0.x = 0.0;\n\t\t\t\tif (df1.x > 0.5) df1.x = 0.0;\n\t\t\t\tif (df2.x > 0.5) df2.x = 0.0;\n\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                \tvec4 tmp = \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;\n\t\t\t\t#else\n                \tvec4 tmp = \n\t\t\t\t\t\ttextureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + \n\t\t\t\t\t\ttextureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + \n\t\t\t\t\t\ttextureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\n\t\t\t\t// Apply cropping across all 3 planes\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t\tif ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t\tif ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;//n * 0.5 + 0.5;\n\t\t\t}\t\t\t\n\t\t\t")};var zV=class extends kU{constructor(t,e,i,n,r,s,a,o,l,h,c,u){super("v3"),this.nodeType="Depth",this.gradientType=t,this.smooth=e,this.near=i,this.far=n,this.isVector=r,this.isWorldSpace=s,this.origin=a,this.direction=o,this.colors=l,this.steps=h,this.isMask=u,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){let i=`g${this.uuid.toString().replace(/-/g,"")}`,n=new NU(`vec3 ${i}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${i}_MAX_COLORS], float steps[${i}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {\n               vec4 color = colors[0];\n               #ifdef ${i}_IS_VECTOR\n                   #ifdef ${i}_LINEAR\n                       #ifdef ${i}_WORLDSPACE\n                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);\n                       #else\n                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);\n                       #endif\n                   #else\n                       #ifdef ${i}_WORLDSPACE\n                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);\n                       #else\n                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);\n                       #endif\n                   #endif\n               #else\n                   float dist = length(vWPosition - cameraPosition);\n\t\t\t       float depth = ( dist - near ) / ( far - near );\n               #endif\n\n\n              float p;\n              #ifdef ${i}_SMOOTH\n\t\t\t\tfor ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {\n\t\t\t\t\t\tp = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t\t}\n              #else\n                for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {\n                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);\n                   color = mix(color, colors[i], p);\n                 }\n              #endif\n\n               float lalpha = alpha * color.a * mask;\n               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t   \n               return color.rgb;\n\t\t\t}`,[zV.Nodes.vectorLinearWorldSpaceDepth,zV.Nodes.vectorLinearObjectSpaceDepth,zV.Nodes.vectorSphericalObjectSpaceDepth,zV.Nodes.vectorSphericalWorldSpaceDepth]);if(t.isShader("fragment")){t.define(`${i}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&t.define(`${i}_SMOOTH`),this.isVector.value>.5&&t.define(`${i}_IS_VECTOR`),0===this.gradientType.value&&t.define(`${i}_LINEAR`),this.isWorldSpace.value>.5&&t.define(`${i}_WORLDSPACE`),t.require("worldPosition"),t.addFragmentVariable(this.calpha,"float");let r=t.include(n),s=[];return s.push(this.near.build(t,"f")),s.push(this.far.build(t,"f")),s.push(this.origin.build(t,"v3")),s.push(this.direction.build(t,"v3")),s.push(this.colors.build(t,"v4[]")),s.push(this.steps.build(t,"f[]")),s.push(this.isMask.build(t,"b")),s.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),s.push(this.alpha.build(t,"f")),s.push(this.calpha),t.format(r+"("+s.join(",")+")",this.getType(t),e)}return console.warn("DepthNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},FV=zV;FV.Nodes={vectorLinearWorldSpaceDepth:new NU("float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {\n               vec3 n = normalize(direction);\n               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));\n               return ( dist - near ) / ( far - near );\n            }"),vectorLinearObjectSpaceDepth:new NU("float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {\n               vec3 n = normalize(direction);\n               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));\n               return ( dist - near ) / ( far - near );\n            }"),vectorSphericalWorldSpaceDepth:new NU("float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {\n               float dist = length(vWPosition - origin);\n               return ( dist - near ) / ( far - near );\n            }"),vectorSphericalObjectSpaceDepth:new NU("float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {\n               float dist = length(position - origin);\n               return ( dist - near ) / ( far - near );\n            }")};var NV=class extends kU{constructor(t,e,i,n,r,s,a,o){super("v3"),this.nodeType="Fresnel",this.color=t,this.bias=e,this.scale=i,this.intensity=n,this.factor=r,this.isMask=o,this.alpha=s,this.mode=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.require("vWorldViewDir"),t.require("worldNormal"),t.isShader("fragment")){t.addFragmentVariable(this.calpha,"float");let i=new NU("vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {\n\t\t\t\t\tfloat fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );\n\n\t\t\t\t\tfloat lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\t\treturn color;\n\t\t\t\t}"),n=t.include(i),r=[];return r.push(this.color.build(t,"c")),r.push(this.bias.build(t,"f")),r.push(this.scale.build(t,"f")),r.push(this.intensity.build(t,"f")),r.push(this.factor.build(t,"f")),r.push(this.isMask.build(t,"b")),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.mode.build(t,"i")),r.push(this.calpha),t.format(n+"("+r.join(",")+")",this.getType(t),e)}return console.warn("FresnelNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},UV=class extends kU{constructor(t,e,i,n,r,s,a,o,l){super("v3"),this.nodeType="Gradient",this.gradientType=t,this.smooth=e,this.colors=i,this.steps=n,this.offset=r,this.morph=s,this.angle=a,this.isMask=l,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.isShader("fragment")){t.define("GRAD_MAX",10),t.require("uv"),t.requires.uv=[!0],t.addFragmentVariable(this.calpha,"float");let i=t.include(UV.Nodes.gradient),n=[];return n.push(this.gradientType.build(t,"i")),n.push(this.smooth.build(t,"b")),n.push(this.colors.build(t,"v4[]")),n.push(this.steps.build(t,"f[]")),n.push(this.offset.build(t,"v2")),n.push(this.morph.build(t,"v2")),n.push(this.angle.build(t,"f")),n.push(this.isMask.build(t,"b")),n.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),n.push(this.alpha.build(t,"f")),n.push(this.calpha),t.format(i+"("+n.join(",")+")",this.getType(t),e)}return console.warn("GradientNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},VV=UV;VV.Nodes={gradient:new NU("vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\tvec4 color = colors[0];\n\t\t\t\tvec2 m = morph / vUv.xy;\n\t\t\t\tvec2 rot = vec2( 0.5 + m.x, m.y );\n\t\t\t\tvec2 dt = vec2(\n\t\t\t\t\tcos( angle ) * rot.x - sin( angle ) * rot.y,\n\t\t\t\t\tsin( angle ) * rot.x + cos( angle ) * rot.y\n\t\t\t\t);\n\t\t\t\tvec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;\n\t\t\t\tfloat t = dot( pt, dt ) / dot( dt, dt );\n\t\t\t\tif ( gradientType == 1 ) {\n\t\t\t\t\tt = distance (\n\t\t\t\t\t\t( vUv + morph ) * 3.0,\n\t\t\t\t\t\t( vUv + offset ) + 1.0\n\t\t\t\t\t) + angle;\n\t\t\t\t} else if ( gradientType == 2 ) {\n\t\t\t\t\tfloat polar = atan(\n\t\t\t\t\t\tvUv.x + morph.x - 0.5 + offset.x,\n\t\t\t\t\t\tvUv.y + morph.y - 0.5 + offset.y\n\t\t\t\t\t) * -1.0;\n\t\t\t\t\tt = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );\n\t\t\t\t}\n\n\t\t\t\tfloat p;\n\t\t\t\tif (smoothed) {\n\t\t\t\t\tfor ( int i = 1; i < GRAD_MAX; i++ ) {\n\t\t\t\t\t\tp = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tfor ( int i = 1; i < GRAD_MAX; i++ ) {\n\t\t\t\t\t\tp = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], p);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t\t\n\t\t\t\treturn color.xyz;\n\t\t\t}")};var jV=class extends kU{constructor(t,e,i,n,r){super("v3"),this.nodeType="Matcap",this.texture=t,this.isMask=n,this.alpha=e,this.mode=i,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`,this.rotation=r}generate(t,e){if(t.isShader("fragment")){t.addFragmentVariable(this.calpha,"float");let i=t.include(jV.Nodes.matcap);t.require("normal"),t.requires.normal=!0;let n=[];return n.push(this.texture.generate(t,"t")),n.push("normal"),n.push(this.isMask.build(t,"b")),n.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),n.push(this.alpha.build(t,"f")),n.push(this.mode.build(t,"i")),n.push(this.calpha),n.push(this.rotation.build(t,"f")),t.format(i+"("+n.join(",")+")",this.getType(t),e)}return console.warn("MatcapNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},GV=jV;GV.Nodes={matcap:new NU("vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha, float rotation) {\n\t\t\t\t\tvec3 viewDir = normalize( vViewPosition );\n\t\t\t\t\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\t\t\t\t\tvec3 y = cross( viewDir, x );\n\t\t\t\t\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) );\n\t\t\t\t\tuv = mat2( cos(rotation), sin(rotation), -sin(rotation), cos(rotation) ) * uv;\n\t\t\t\t\tuv = uv * 0.495 + 0.5;\n\t\t\t\t\tvec4 matcapColor = texture2D( matcapTex, uv );\n\n\t\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t\t\t\n\t\t\t\t\treturn matcapColor.rgb;\n            \t}")};var HV=function(){let t=new NU("vec3 random3(vec3 c) {\n\t\t\tfloat j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));\n\t\t\tvec3 r;\n\t\t\tr.z = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.x = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.y = fract(512.0*j);\n\t\t\treturn r-0.5;\n\t\t}"),e=new NU("float simplexFast(vec3 p) {\n\t\t\t vec3 s = floor(p + dot(p, vec3(F3)));\n\t\t\t mediump vec3 x = p - s + dot(s, vec3(G3));\n\t\t\t mediump vec3 hs = s;\n\t\t\t \n\t\t\t mediump vec3 e = step(vec3(0.0), x - x.yzx);\n\t\t\t mediump vec3 i1 = e*(1.0 - e.zxy);\n\t\t\t mediump vec3 i2 = 1.0 - e.zxy*(1.0 - e);\n\t\t\t\t\n\t\t\t mediump vec3 x1 = x - i1 + G3;\n\t\t\t mediump vec3 x2 = x - i2 + 2.0*G3;\n\t\t\t mediump vec3 x3 = x - 1.0 + 3.0*G3;\n\t\t\t \n\t\t\t mediump vec4 w, d;\n\t\t\t \n\t\t\t w.x = dot(x, x);\n\t\t\t w.y = dot(x1, x1);\n\t\t\t w.z = dot(x2, x2);\n\t\t\t w.w = dot(x3, x3);\n\t\t\t \n\t\t\t w = max(0.6 - w, 0.0);\n\t\t\t \n\t\t\t d.x = dot(random3(hs), x);\n\t\t\t d.y = dot(random3(hs + i1), x1);\n\t\t\t d.z = dot(random3(hs + i2), x2);\n\t\t\t d.w = dot(random3(hs + 1.0), x3);\n\t\t\t \n\t\t\t w *= w;\n\t\t\t w *= w;\n\t\t\t d *= w;\n\t\t\t \n\t\t\t return dot(d, vec4(52.0));\n\t\t}",[t]);e.keywords.F3=new jU("float F3 0.3333333"),e.keywords.G3=new jU("float G3 0.1666667");let i=new NU("float simplexPrecise(vec3 p) {\n\t\t\t vec3 s = floor(p + dot(p, vec3(F3)));\n\t\t\t vec3 x = p - s + dot(s, vec3(G3));\n\t\t\t \n\t\t\t vec3 e = step(vec3(0.0), x - x.yzx);\n\t\t\t vec3 i1 = e*(1.0 - e.zxy);\n\t\t\t vec3 i2 = 1.0 - e.zxy*(1.0 - e);\n\t\t\t\t\n\t\t\t vec3 x1 = x - i1 + G3;\n\t\t\t vec3 x2 = x - i2 + 2.0*G3;\n\t\t\t vec3 x3 = x - 1.0 + 3.0*G3;\n\t\t\t \n\t\t\t vec4 w, d;\n\t\t\t \n\t\t\t w.x = dot(x, x);\n\t\t\t w.y = dot(x1, x1);\n\t\t\t w.z = dot(x2, x2);\n\t\t\t w.w = dot(x3, x3);\n\t\t\t \n\t\t\t w = max(0.6 - w, 0.0);\n\t\t\t \n\t\t\t d.x = dot(random3(s), x);\n\t\t\t d.y = dot(random3(s + i1), x1);\n\t\t\t d.z = dot(random3(s + i2), x2);\n\t\t\t d.w = dot(random3(s + 1.0), x3);\n\t\t\t \n\t\t\t w *= w;\n\t\t\t w *= w;\n\t\t\t d *= w;\n\t\t\t \n\t\t\t return dot(d, vec4(52.0));\n\t\t}",[t]);i.keywords.F3=new jU("float F3 0.3333333"),i.keywords.G3=new jU("float G3 0.1666667");let n=new NU("float simplexFractal(vec3 m) {\n\t\t\tmat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);\n\t\t\tmat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);\n\t\t\tmat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);\n\t\t\treturn 0.5333333 * simplexFast(m * rot1)\n\t\t\t\t + 0.2666667 * simplexFast(2.0 * m * rot2)\n\t\t\t\t + 0.1333333 * simplexFast(4.0 * m * rot3)\n\t\t\t\t + 0.0666667 * simplexFast(8.0 * m);\n\t\t}",[e]),r=new NU("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),s=new NU("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),a=new NU("float simplexAshima(vec3 v) {\n\t\t  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n\t\t  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\t\t  vec3 i  = floor(v + dot(v, C.yyy) );\n\t\t  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\t\t  vec3 g = step(x0.yzx, x0.xyz);\n\t\t  vec3 l = 1.0 - g;\n\t\t  vec3 i1 = min( g.xyz, l.zxy );\n\t\t  vec3 i2 = max( g.xyz, l.zxy );\n\t\t  vec3 x1 = x0 - i1 + 1.0 * C.xxx;\n\t\t  vec3 x2 = x0 - i2 + 2.0 * C.xxx;\n\t\t  vec3 x3 = x0 - 1. + 3.0 * C.xxx;\n\t\t  i = mod(i, 289.0 ); \n\t\t  vec4 p = permute( permute( permute( \n\t\t\t\t\t i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n\t\t\t\t   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n\t\t\t\t   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\t\t  float n_ = 1.0/7.0; // N=7\n\t\t  vec3  ns = n_ * D.wyz - D.xzx;\n\t\t  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)\n\t\t  vec4 x_ = floor(j * ns.z);\n\t\t  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\t\t  vec4 x = x_ *ns.x + ns.yyyy;\n\t\t  vec4 y = y_ *ns.x + ns.yyyy;\n\t\t  vec4 h = 1.0 - abs(x) - abs(y);\n\t\t  vec4 b0 = vec4( x.xy, y.xy );\n\t\t  vec4 b1 = vec4( x.zw, y.zw );\n\t\t  vec4 s0 = floor(b0)*2.0 + 1.0;\n\t\t  vec4 s1 = floor(b1)*2.0 + 1.0;\n\t\t  vec4 sh = -step(h, vec4(0.0));\n\t\t  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n\t\t  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\t\t  vec3 p0 = vec3(a0.xy,h.x);\n\t\t  vec3 p1 = vec3(a0.zw,h.y);\n\t\t  vec3 p2 = vec3(a1.xy,h.z);\n\t\t  vec3 p3 = vec3(a1.zw,h.w);\n\t\t  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n\t\t  p0 *= norm.x;\n\t\t  p1 *= norm.y;\n\t\t  p2 *= norm.z;\n\t\t  p3 *= norm.w;\n\t\t  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n\t\t  m = m * m;\n\t\t  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), \n\t\t\t\t\t\t\t\t\t\tdot(p2,x2), dot(p3,x3) ) );\n\t\t}",[r,s]),o=new NU("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),l=new NU("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[o]),h=new NU("float noise(vec3 p){\n\t\t\tvec3 a = floor(p);\n\t\t\tvec3 d = p - a;\n\t\t\td = d * d * (3.0 - 2.0 * d);\n\t\t\tvec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n\t\t\tvec4 k1 = perm(b.xyxy);\n\t\t\tvec4 k2 = perm(k1.xyxy + b.zzww);\n\t\t\tvec4 c = k2 + a.zzzz;\n\t\t\tvec4 k3 = perm(c);\n\t\t\tvec4 k4 = perm(c + 1.0);\n\t\t\tvec4 o1 = fract(k3 * (1.0 / 41.0));\n\t\t\tvec4 o2 = fract(k4 * (1.0 / 41.0));\n\t\t\tvec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n\t\t\tvec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\t\t\treturn o4.y * d.y + o4.x * (1.0 - d.y);\n\t\t}",[l]),c=new NU("float fbm(vec3 x) {\n\t\t\tfloat v = 0.0;\n\t\t\tfloat a = 0.5;\n\t\t\tvec3 shift = vec3(100);\n\t\t\tfor (int i = 0; i < NUM_OCTAVES; ++i) {\n\t\t\t\tv += a * noise(x);\n\t\t\t\tx = x * 2.0 + shift;\n\t\t\t\ta *= 0.5;\n\t\t\t}\n\t\t\treturn v;\n\t\t}",[h]);c.keywords.NUM_OCTAVES=new jU("int NUM_OCTAVES 5");let u=new NU("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),d=new NU("float perlin(vec3 P){\n\t\t  vec3 Pi0 = floor(P);\n\t\t  vec3 Pi1 = Pi0 + vec3(1.0);\n\t\t  Pi0 = mod(Pi0, 289.0);\n\t\t  Pi1 = mod(Pi1, 289.0);\n\t\t  vec3 Pf0 = fract(P);\n\t\t  vec3 Pf1 = Pf0 - vec3(1.0);\n\t\t  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n\t\t  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n\t\t  vec4 iz0 = Pi0.zzzz;\n\t\t  vec4 iz1 = Pi1.zzzz;\n\t\t  vec4 ixy = permute(permute(ix) + iy);\n\t\t  vec4 ixy0 = permute(ixy + iz0);\n\t\t  vec4 ixy1 = permute(ixy + iz1);\n\t\t  vec4 gx0 = ixy0 / 7.0;\n\t\t  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;\n\t\t  gx0 = fract(gx0);\n\t\t  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n\t\t  vec4 sz0 = step(gz0, vec4(0.0));\n\t\t  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n\t\t  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\t\t  vec4 gx1 = ixy1 / 7.0;\n\t\t  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;\n\t\t  gx1 = fract(gx1);\n\t\t  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n\t\t  vec4 sz1 = step(gz1, vec4(0.0));\n\t\t  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n\t\t  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\t\t  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n\t\t  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n\t\t  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n\t\t  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n\t\t  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n\t\t  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n\t\t  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n\t\t  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\t\t  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n\t\t  g000 *= norm0.x;\n\t\t  g010 *= norm0.y;\n\t\t  g100 *= norm0.z;\n\t\t  g110 *= norm0.w;\n\t\t  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n\t\t  g001 *= norm1.x;\n\t\t  g011 *= norm1.y;\n\t\t  g101 *= norm1.z;\n\t\t  g111 *= norm1.w;\n\t\t  float n000 = dot(g000, Pf0);\n\t\t  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n\t\t  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n\t\t  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n\t\t  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n\t\t  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n\t\t  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n\t\t  float n111 = dot(g111, Pf1);\n\t\t  vec3 fade_xyz = fade(Pf0);\n\t\t  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n\t\t  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n\t\t  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n\t\t  return 2.2 * n_xyz;\n\t\t}",[r,s,u]),p=new NU("float hashwithoutsine13(vec3 p3)\n\t\t{\n\t\t\tp3  = fract(p3 * .1031);\n\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t}"),f=new NU("vec3 hashwithoutsine33(vec3 p3)\n\t\t{\n\t\t\tp3 = fract(p3 * vec3(.1031, .1030, .0973));\n\t\t\tp3 += dot(p3, p3.yxz+33.33);\n\t\t\treturn fract((p3.xxy + p3.yxx)*p3.zyx);\n\t\t}"),m=new NU("float metric(in vec3 p)\n\t\t{\n\t\t\t// L2 \n\t\t\treturn length(p);\n\n\t\t\t// Chebyshev \n\t\t\t// vec3 a = abs(p);\n\t\t\t// return max(a.x, max(a.y, a.z));\n\t\t}"),g=new NU("float smin( float a, float b, float k )\n\t\t{\n\t\t\tfloat h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);\n\t\t\tfloat correction = k * h * (1.0 - h);\n\t\t\treturn mix(b, a, h) - correction;\n\t\t}"),v=new NU("float smax( float a, float b, float k )\n\t\t{\n\t\t\tfloat h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);\n\t\t\tfloat correction = k * h * (1.0 - h);\n\t\t\treturn mix(a, b, h) + correction;\n\t\t}"),y=new NU("float remap(float value, float input_min, float input_max, float output_min, float output_max) {\n\t\t\t// Compute width of each interval\n\t\t\tfloat input_width = input_max - input_min;\n\t\t\tfloat output_width = output_max - output_min;\n\t\t\n\t\t\t// Convert input range into a 0-1 range \n\t\t\tfloat scaled = (value - input_min) / input_width;\n\t\t\n\t\t\t// Convert the 0-1 range into a value in output range\n\t\t\treturn output_min + (scaled * output_width);\n\t\t}");return{simplexFast:e,simplexPrecise:i,simplexFractal:n,simplexAshima:a,fbm:c,perlin:d,voronoi:new NU('float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) \n\t\t{\n\t\t\t// Integer and fractional parts of this point\'s coordinates\n\t\t\tivec3 p = ivec3(floor(x));\n\t\t\tvec3 f = fract(x);\n\n\t\t\t// Different variables that we will use to construct noise:\n\t\t\t//\n\t\t\t// f1: distance to the closest feature point\n\t\t\t// f2: distance to the second closest feature point\n\t\t\t// e: distance to the closest edge (cell boundary)\n\t\t\t//\n\t\t\t// We also compute "smooth" versions of all of the above quantites, essentially\n\t\t\t// replacing "hard" minimums with "smooth" minimums (described by IQ)\n\t\t\tfloat f1_smooth = 8.0;\n\t\t\tfloat f1 = 8.0;\n\t\t\tfloat f2_smooth = 8.0;\n\t\t\tfloat f2 = 8.0;\n\t\t\tfloat e_smooth = 8.0;\n\t\t\tfloat e = 8.0;\n\n\t\t\t// Variables stored from closest cell\n\t\t\tivec3 mb;\n\t\t\tvec3 mr; \n\n\t\t\tint steps = quality;\n\t\t\t\n\t\t\tfor (int x = -steps; x <= steps; x++) \n\t\t\tfor (int y = -steps; y <= steps; y++)\n\t\t\tfor (int z = -steps; z <= steps; z++)\n\t\t\t{\n\t\t\t\tivec3 b = ivec3(x, y, z);\n\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\tfloat d = length(r);\n\t\t\t\t\n\t\t\t\tf1_smooth = smin(d, f1_smooth, smoothness);\n\n\t\t\t\t// Store un-smoothed distances too \n\t\t\t\tif (d < f1) \n\t\t\t\t{\n\t\t\t\t\tf2 = f1;\n\t\t\t\t\tf1 = d;\n\n\t\t\t\t\tmb = ivec3(x, y, z);\n\t\t\t\t\tmr = r;\n\t\t\t\t} \n\t\t\t\telse if (d < f2) \n\t\t\t\t{\n\t\t\t\t\tf2 = d;\n\t\t\t\t}\n\t\t\t}\t\n\t\t\t\n\t\t\t// Second pass for edge distance  \n\t\t\t// skip for styles don\'t need\n\t\t\tif (style != 0 &&  style != 5 && style != 7)\n\t\t\tfor (int x = -steps; x <= steps; x++) \n\t\t\tfor (int y = -steps; y <= steps; y++)\n\t\t\tfor (int z = -steps; z <= steps; z++)\n\t\t\t{\n\t\t\t\t// Start search at the cell that contains the closest point to "x" (found in 1st pass)\n\t\t\t\tivec3 b = mb + ivec3(x, y, z);\n\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\tfloat d1 = dot(0.5 * (mr + r), (r - mr)); \t\t\t\t// IQ normalizes "r - mr" but that breaks things for the smooth version?\n\t\t\t\tfloat d2 = dot(0.5 * (mr + r), normalize(r - mr));\n\n\t\t\t\te_smooth = smin(d1, e_smooth, smoothness);\n\n\t\t\t\te = min(e, d2);\n\n\t\t\t\t// Also compute a smooth version of F2 in this pass\n\t\t\t\t{\n\t\t\t\t\tivec3 b = ivec3(x, y, z);\n\t\t\t\t\tif (b != mb) \n\t\t\t\t\t{\n\t\t\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\t\t\tfloat d = length(r);\n\n\t\t\t\t\t\tf2_smooth = smin(d, f2_smooth, smoothness);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Different visualization modes \n\t\t\tif (style == 0) \n\t\t\t{\n\t\t\t\treturn f1_smooth;\n\t\t\t}\n\t\t\tif (style == 1) \n\t\t\t{\n\t\t\t\treturn f2_smooth;\n\t\t\t}\n\t\t\tif (style == 2) \n\t\t\t{\n\t\t\t\treturn f2_smooth - f1_smooth;\n\t\t\t\t\n\t\t\t\t// "Pebbles" also cool\n\t\t\t\t//return step(0.2, f2_smooth - f1_smooth);\n\t\t\t}\n\t\t\tif (style == 3) \n\t\t\t{\n\t\t\t\t// This one is really good for rock / stone effects\n\t\t\t\tfloat a = f1; \n\t\t\t\tfloat b = f2;\n\t\t\t\tfloat k = 3.0;\n\t\t\t\tfloat h = max(k - abs(a - b), 0.0) / k;\n\t\t\t\tfloat final = min(a, b) - h * h * k * (1.0 / 4.0);\n\t\t\t\treturn final;\n\t\t\t}\n\t\t\tif (style == 4) \n\t\t\t{\n\t\t\t\t// Some random adjustments to make this style stand out more \n\t\t\t\treturn exp(5.0 * e_smooth);\n\t\t\t}\n\t\t\tif (style == 5) \n\t\t\t{\n\t\t\t\treturn pow(f1_smooth, 3.0);\n\t\t\t}\n\t\t\tif (style == 6) \n\t\t\t{\t\t\t\t\n\t\t\t\tconst float eps = 0.0125;\n\n\t\t\t\t// Thicker lines as the user increases the smoothness slider\n\t\t\t\tfloat thickness = smoothness * 0.25 + eps;\n\n\t\t\t\t// Blurrier lines as the user increases the smoothness slider\n\t\t\t\tfloat blur = pow(smoothness, 3.0) * 0.25 + eps;\n\n\t\t\t\treturn smoothstep(\n\t\t\t\t\tthickness - thickness * blur, \n\t\t\t\t\tthickness + thickness * blur, \n\t\t\t\t\te\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (style == 7) \n\t\t\t{\n\t\t\t\treturn hashwithoutsine13(vec3(p + mb) + seed);\n\t\t\t}\n\t\t}\n\t',[p,f,m,g,v,y])}}(),WV=class extends kU{constructor(t,e,i,n,r,s,a,o,l,h,c,u,d,p,f,m,g,v,y){super("v3"),this.nodeType="Noise",this.scale=t,this.size=e,this.move=i,this.fA=n,this.fB=r,this.distortion=s,this.colorA=a,this.colorB=o,this.colorC=l,this.colorD=h,this.noiseType=u,this.voronoiStyle=p,this.highCut=f,this.lowCut=m,this.smoothness=g,this.seed=v,this.quality=y,this.isMask=d,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e,i,n,r){t.require("uv"),t.requires.uv=[!0],t.addFragmentVariable(this.calpha,"float");let s=["simplexFast","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseType.value],a=new NU(`vec3 ${s}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) \n\t\t\t{\n                // Prevent scale of zero \n\t\t\t\tscale = max(abs(scale), 0.001);\n\n\t\t\t\tvec3 st = position / size;\n\t\t\t\tst /= scale;\n\n\t\t\t\t${"voronoi"==s?`\n\t\tfloat v = ${s}(st + move, voronoiStyle, smoothness, seed, quality);\n\n\t\t// Apply clipping to colors\n\t\tv = remap(v, lowCut, highCut, 0.0, 1.0);\n\t\tv = smax(v, 0.0, smoothness * 0.25);\n\t\tv = smin(v, 1.0, smoothness * 0.25);\n\n\t\t// Note that the voronoi mode only uses colors "A" and "C" from the UI \n\t\tvec4 color = mix(colorA, colorC, v); \n\t\t`:`\n\t\tvec3 q = vec3(${s}(st),\n\t\t\t\t\t   ${s}(st + vec3(1.0)),\n\t\t\t\t\t   ${s}(st + vec3(1.0)));\n\t\tvec3 r = vec3(${s}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),\n\t\t\t\t\t  ${s}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), \n\t\t\t\t\t  ${s}(st * q));\n\t\tfloat f = ${s}(st + r);\n\t\tvec4 color;\n\t\tcolor = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));\n\t\tcolor = mix(color, colorC, clamp(length(q), 0.0, 1.0));\n\t\tcolor = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));\n\t\t`}\n\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn clamp(color, 0.0, 1.0).rgb;\n\t\t\t}`,[HV.simplexFast,HV.simplexFractal,HV.simplexAshima,HV.fbm,HV.perlin,HV.voronoi]),o=t.include(a),l=[];return l.push(this.scale.build(t,"f")),l.push(this.size.build(t,"v3")),l.push(this.move.build(t,"f")),l.push(this.fA.build(t,"v2")),l.push(this.fB.build(t,"v2")),l.push(this.distortion.build(t,"v2")),l.push(this.colorA.build(t,"v4")),l.push(this.colorB.build(t,"v4")),l.push(this.colorC.build(t,"v4")),l.push(this.colorD.build(t,"v4")),l.push(this.voronoiStyle.build(t,"i")),l.push(this.highCut.build(t,"f")),l.push(this.lowCut.build(t,"f")),l.push(this.smoothness.build(t,"f")),l.push(this.seed.build(t,"f")),l.push(this.quality.build(t,"i")),l.push(this.isMask.build(t,"b")),l.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),l.push(this.alpha.build(t,"f")),l.push(this.calpha),t.format(o+"("+l.join(",")+")",this.getType(t),e)}};WV.numOctaves=5;var qV=class extends kU{constructor(t,e,i,n,r,s,a,o,l,h,c,u,d,p,f,m){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=t,this.contourColor=e,this.outlineWidth=i,this.contourWidth=n,this.contourThreshold=r,this.outlineThreshold=s,this.contourFrequency=a,this.outlineSmoothing=o,this.contourDirection=l,this.positionalLines=h,this.compensation=c,this.resolution=u,this.normalMap=d,this.depthMap=p,this.pixelRatio=f,this.alpha=m,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){let i=`g${this.uuid.toString().replace(/-/g,"")}`;if(t.require("vWorldViewDir"),t.require("worldNormal"),t.extensions.derivatives=!0,this.compensation.value&&t.define("OUTLINE_COMPENSATION",`${i}_offset`),this.firstTime){let e=this.outlineWidth.build(t,"f"),n=this.resolution.build(t,"v2"),r=this.compensation.build(t,"b"),s=this.pixelRatio.build(t,"f");t.addVertexParsVariable("randomColor","attribute vec3"),t.addVertexParsVariable("extrudeNormal","attribute vec3"),t.addVertexParsVariable(e,"uniform float"),t.addVertexParsVariable(n,"uniform vec2"),t.addVertexParsVariable(r,"uniform bool"),t.addVertexParsVariable(s,"uniform float"),t.addVertexParsVariable("vID","flat out float"),t.addFragmentParsVariable("vID","flat in float"),t.addVertexFinalCode(`\n                vID = randomColor.r;\n                vec2 ${i}_offset = vec2(0.0);\n                if (${r}) {\n                    vec4 ${i}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));\n                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the\n                    // normals face the camera directly. So we hackily fix this by offsetting the normal\n                    // by a tiny amount.\n                    vec3 ${i}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;\n                    ${i}_offset = normalize(${i}_clipNormal.xy) / ${n} * (${e} / 2.0) * ${i}_clipPosition.w * 2.0 * ${s};\n                    ${i}_clipPosition.xy += ${i}_offset;\n                    // TODO(MAX): To handle multiple outline layers, we only want to extrude\n                    // if this offset is the biggest of all the potential offsets\n                    gl_Position = ${i}_clipPosition;\n                }\n            `)}if(t.isShader("fragment")){t.require("uv"),t.requires.uv=[!0],t.addFragmentVariable(this.calpha,"float");let i=t.include(qV.Nodes.outline),n=[];return n.push(this.outlineColor.build(t,"c")),n.push(this.contourColor.build(t,"c")),n.push(this.outlineWidth.build(t,"f")),n.push(this.contourWidth.build(t,"f")),n.push(this.contourThreshold.build(t,"f")),n.push(this.outlineThreshold.build(t,"f")),n.push(this.contourFrequency.build(t,"f")),n.push(this.outlineSmoothing.build(t,"f")),n.push(this.contourDirection.build(t,"v3")),n.push(this.positionalLines.build(t,"b")),n.push(this.resolution.build(t,"v2")),n.push(this.normalMap.getTexture(t,"t")),n.push(this.depthMap.getTexture(t,"t")),n.push(this.pixelRatio.build(t,"f")),n.push(this.compensation.build(t,"b")),n.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),n.push(this.alpha.build(t,"f")),n.push(this.calpha),this.firstTime=!this.firstTime,t.format(i+"("+n.join(",")+")",this.getType(t),e)}return console.warn("OutlineNode is not compatible with "+t.shader+" shader."),""}},YV=qV;YV.Nodes=function(){let t=new NU("\nfloat sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)\n{\n    vec2 halton = haltonSequence[frameIndex];\n    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n    float temporalAngle  = temporalOffset * PI2;\n\n    vec2 texelSize = (vec2(1.0) / resolution);\n    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;\n\n    vec2 uvSamples[9];\n    vec4 normalSamples[9];\n\n\tuvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);\n\tuvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);\n\tuvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);\n\tuvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);\n\tuvSamples[4] = uv;\n\tuvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);\n\tuvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);\n\tuvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);\n\tuvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);\n\n\n    normalSamples[0] = texture2D(t, uvSamples[0]);\n    normalSamples[1] = texture2D(t, uvSamples[1]);\n    normalSamples[2] = texture2D(t, uvSamples[2]);\n    normalSamples[3] = texture2D(t, uvSamples[3]);\n    normalSamples[4] = texture2D(t, uvSamples[4]);\n    normalSamples[5] = texture2D(t, uvSamples[5]);\n    normalSamples[6] = texture2D(t, uvSamples[6]);\n    normalSamples[7] = texture2D(t, uvSamples[7]);\n    normalSamples[8] = texture2D(t, uvSamples[8]);\n\n    float depthBias = 0.0001;\n    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!\n    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n\n    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);\n  \tvec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);\n\n    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));\n    return edgeNormal;\n}\n");return{outline:new NU("vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {\n                vec3 result = outlineColor;\n                float resultAlpha = 0.0;\n\n                vec3 N = normalize(vWNormal);\n                vec2 nuv = (gl_FragCoord.xy / resolution);\n                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);\n                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);\n\n                //resultAlpha = 1.0;\n                //result = vec3(sobelSample);\n\n                float t = 1.0 - contourThreshold;\n                if(positionalLines) {\n                    vec3 NDir = position * contourDirection;\n                    float NT = NDir.x + NDir.y + NDir.z;\n                    float f  = fract(NT * contourFrequency * 0.01);\n                    float df = fwidth(NT * contourFrequency);\n\n                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);\n                    if (g < 1.0 && resultAlpha == 0.0) {\n                        result = contourColor;\n                        resultAlpha = 1.0;\n                    }\n                 }\n                 else {\n                    vec3 NDir = N * contourDirection;\n                    float NT = NDir.x + NDir.y + NDir.z;\n                    float df = fwidth(NT * contourThreshold);\n                    float f = sin(NT * 1.0 * contourFrequency);\n                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);\n\n                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {\n                        result = contourColor;\n                        resultAlpha = 1.0 - g;\n                    }\n                 }\n\n                 float lalpha = alpha * resultAlpha * mask;\n                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\t\t\t\t \n                 return result;\n             }",[t])}}();var XV=class extends kU{constructor(t,e,i,n,r,s,a,o,l,h,c,u,d,p,f,m,g,v){super("v3"),this.nodeType="Pattern",this.style=t,this.projection=e,this.axis=i,this.blending=n,this.offset=r,this.colorA=s,this.colorB=a,this.frequency=o,this.size=l,this.variation=h,this.smoothness=c,this.zigzag=u,this.rotation=d,this.vertical=p,this.horizontal=f,this.sides=m,this.isMask=v,this.alpha=g,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.isShader("fragment")){let i;switch(t.require("position"),t.require("uv"),t.requires.uv=[!0],t.require("normal"),t.requires.normal=!0,t.addFragmentVariable(this.calpha,"float"),this.style.value){case 0:default:i="circle";break;case 1:i="ring";break;case 2:i="polygon";break;case 3:i="xcross";break;case 4:i="diamond";break;case 5:i="checkerboard";break;case 6:i="line";break;case 7:i="wave"}let n=`g${this.uuid.toString().replace(/-/g,"")}`,r=new NU("float hashwithoutsine12(vec2 p)\n\t\t\t\t{\n\t\t\t\t\tvec3 p3 = fract(vec3(p.xyx) * .1031);\n\t\t\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t\t\t}"),s=new NU("vec2 rotate_uv(in vec2 uv, float a, bool repeat) \n\t\t\t\t{\n\t\t\t\t\tconst float mid = 0.5;\n\t\t\t\t\tfloat radians = a * (PI / 180.0);\n\t\t\t\t\tvec2 rotated = vec2(\n\t\t\t\t\t\tcos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,\n\t\t\t\t\t\tcos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid\n\t\t\t\t\t);\n\t\t\t\t\treturn repeat ? fract(rotated): rotated;\n\t\t\t\t}"),a="";if(4===this.projection.value){a=`\n\t\t\t\tvec3 p = position;\n\t\t\t\tfloat factor = 0.0125;\n\t\t\t\tvec2 uv0 = fract(p.xy * factor);\n\t\t\t\tvec2 uv1 = fract(p.zy * factor);\n\t\t\t\tvec2 uv2 = fract(p.xz * factor);\n\t\t\t\t\n\t\t\t\tuv0 = rotate_uv(uv0 + offset, rotation, true);\n\t\t\t\tuv1 = rotate_uv(uv1 + offset, rotation, true);\n\t\t\t\tuv2 = rotate_uv(uv2 + offset, rotation, true);\n\t\n\t\t\t\tfloat d0 = ${2===this.style.value?`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`};\n\t\t\t\tfloat d1 = ${2===this.style.value?`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`};\n\t\t\t\tfloat d2 = ${2===this.style.value?`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`};\n\t\t\t\t\n\t\t\t\t// Range from 3 to 128 seems to be good\n\t\t\t\tfloat exponent = (1.0 - blending) * 125.0 + 3.0;\n\n\t\t\t\tvec3 n = vObjectNormal;\n\t\t\t\tvec3 weights = abs(normalize(n));\n\t\t\t\tweights = pow(weights, vec3(exponent));\n\t\t\t\tweights /= dot(weights, vec3(1.0));\n\t\t\t\td0 *= weights.z;\n\t\t\t\td1 *= weights.x;\n\t\t\t\td2 *= weights.y;\n\t\t\t\tfloat draw = d0 + d1 + d2;\n\t\n\t\t\t\tvec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;\n\t\t\t\t`}else{let t=2===this.style.value?`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,e="";0===this.axis.value?e="float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.y, p.z);\n\t\t\t\t\tfloat phi = acos(p.x / radius);":1===this.axis.value?e="float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.x, p.z);\n\t\t\t\t\tfloat phi = acos(p.y / radius);":(this.axis.value,e="float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.y, p.x);\n\t\t\t\t\tfloat phi = acos(p.z / radius);");let n="";switch(this.projection.value){case 0:n="custom_uv = vUv.st;";break;case 1:case 3:default:break;case 2:n=`\n\t\t\t\t\t\t\tvec3 p = position;\n\t\t\t\t\t\t\t${e}\n\t\t\t\t\t\t\tcustom_uv = vec2(theta, phi);\n\t\t\t\t\t\t\tcustom_uv /= PI;\n\t\t\t\t\t\t\t`}a=`\n\t\t\t\tvec2 custom_uv;\n\t\t\t\t${n}\n\t\n\t\t\t\tcustom_uv += offset;\n\t\t\t\tcustom_uv = fract(custom_uv);\n\t\t\t\tcustom_uv = rotate_uv(custom_uv, rotation, true);\n\t\n\t\t\t\tfloat draw = ${t};\n\t\t\t\t`}let o=new NU(`vec3 ${n}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\t\tconst float TWO_PI = PI * 2.0;\n\t\t\t\t\tfloat smoothness_remapped = pow(smoothness, 5.0);\t\n\n\t\t\t\t\t${a}\n\n\t\t\t\t\t// Construct final output color\n\t\t\t\t\tvec4 color = mix(colorA, colorB, draw);\n\t\t\t\t\tcolor.a = clamp(color.a, 0.0, 1.0);\n\n\t\t\t\t\t// Apply cuts\n\t\t\t\t\tcolor.a *= \n\t\t\t\t\t\tstep(vertical.x, custom_uv.y) * \n\t\t\t\t\t\tstep(custom_uv.y, vertical.y);\n\t\t\t\t\tcolor.a *= \n\t\t\t\t\t\tstep(horizontal.x, abs(custom_uv.x)) * \n\t\t\t\t\t\tstep(abs(custom_uv.x), horizontal.y);\n\n\t\t\t\t\t// Accumulate alpha \n\t\t\t\t\tfloat lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\t\treturn clamp(color, 0.0, 1.0).rgb;\n\t\t\t\t}`,[s,r,XV.DrawFunctions.circle,XV.DrawFunctions.ring,XV.DrawFunctions.polygon,XV.DrawFunctions.cross,XV.DrawFunctions.diamond,XV.DrawFunctions.checkerboard,XV.DrawFunctions.line,XV.DrawFunctions.wave]),l=t.include(o),h=[];return h.push("normal"),h.push(this.blending.build(t,"f")),h.push(this.style.build(t,"i")),h.push(this.offset.build(t,"v2")),h.push(this.colorA.build(t,"v4")),h.push(this.colorB.build(t,"v4")),h.push(this.frequency.build(t,"v2")),h.push(this.size.build(t,"f")),h.push(this.variation.build(t,"f")),h.push(this.smoothness.build(t,"f")),h.push(this.zigzag.build(t,"f")),h.push(this.rotation.build(t,"f")),h.push(this.vertical.build(t,"v2")),h.push(this.horizontal.build(t,"v2")),h.push(this.sides.build(t,"i")),h.push(this.isMask.build(t,"b")),h.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),h.push(this.alpha.build(t,"f")),h.push(this.calpha),t.format(l+"("+h.join(",")+")",this.getType(t),e)}return console.warn("PatterNode is not compatible with "+t.shader+" shader."),t.format("vec3(0.0)",this.getType(t),e)}},QV=XV;QV.DrawFunctions=function(){let t=new NU("float hashwithoutsine12(vec2 p) {\n\t\t\t\tvec3 p3 = fract(vec3(p.xyx) * 0.1031);\n\t\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t\t}"),e=new NU("vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {\n                // Create tiles in UV-space\n                uv *= frequency;\n\n                // Integer coords\n                vec2 i = floor(uv);\n\n                // Offset every other row based on zigzag param, then compute fractional coords\n                float row_offset = mod(i.y, 2.0);\n                uv.x += row_offset * zigzag;\n                vec2 f = fract(uv);\n\n\t\t\t\t// Rotate the tile itself:\n\t\t\t\t// const float mid = 0.5;\n\t\t\t\t// f = vec2(\n\t\t\t\t// \tcos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,\n\t\t\t\t// \tcos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid\n\t\t\t\t// );\n\t\t\t\t// f = fract(f);\n\n                f = f * 2.0 - 1.0;\n\n\t\t\t\t// Recompute integer coords after shifting - then, random value per tile \n\t\t\t\ti = floor(uv);\n\t\t\t\tfloat rand = (hashwithoutsine12(i) * 5.0 + 1.0);\n\t\t\t\tfloat jitter = mix(1.0, rand, variation);\n\t\t\t\tf *= jitter;\n\n                return f;\n            }",[t]);return{tileAndCenter:e,circle:new NU("float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(\n                    -smoothness, \n                     smoothness, \n                     length(f) - size\n                );\n            }",[e]),ring:new NU("float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n\n\t\t\t\tfloat d = length(f);\n                const float inner_width = 0.5;\n\n                float outer = smoothstep(-smoothness, smoothness, d - size);\n                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);\n\t\t\t\treturn outer + (1.0 - inner);   \n            }",[e]),polygon:new NU("float sdf_ngon(in vec2 p, in float r, in int n) {\n                float an = (PI * 2.0) / float(n);\n                float he = r * tan(0.5 * an);\n                \n                // Rotate to first sector\n                p = -p.yx; \n                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);\n                vec2  cs = vec2(cos(bn), sin(bn));\n                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;\n            \n                // Side of polygon\n                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);\n            }\n            \n            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));\n            }",[e]),cross:new NU("float sdf_cross(in vec2 p, in vec2 b, float r ) {\n                p = abs(p); \n\t\t\t\tp = (p.y > p.x) ? p.yx : p.xy;\n                vec2  q = p - b;\n                float k = max(q.y, q.x);\n                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);\n                return sign(k) * length(max(w, 0.0)) + r;\n            }\n            \n            // Avoid namespace conflicts \n            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));\n            }",[e]),diamond:new NU("float ndot(vec2 a, vec2 b) { \n                return a.x*b.x - a.y*b.y; \n            }\n            \n            float sdf_diamond(in vec2 p, in vec2 b) {\n                p = abs(p);\n                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);\n                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));\n                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);\n            }\n\n            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n\t            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));\n            }",[e]),checkerboard:new NU("float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                uv *= frequency;\n                vec2 i = floor(uv);\n\n                float offset = mod(i.y, 2.0);\n\n                uv.x += offset + zigzag * offset;\n                float x = floor(uv.x);\n                \n                return mod(x, 2.0);\n            }"),line:new NU("float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);\n\t\t\t\t\n\t\t\t\t// Different approach for variation param here\n\t\t\t\tfloat row = floor(uv * frequency).y;\n\t\t\t\tfloat rand = hashwithoutsine12(vec2(row));\n\t\t\t\tfloat s = mix(size, size * rand, variation);\n\n\t\t\t\treturn smoothstep(\n\t\t\t\t\ts - smoothness, \n\t\t\t\t\ts + smoothness, \n\t\t\t\t\tabs(f.y)\n\t\t\t\t);\n            }",[e]),wave:new NU("// Uses bisection \n            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {\n                // Convert all data to a primitive cosine wave\n                p = c * (p - vec2(d, a));\n                \n                const float TWO_PI = PI * 2.0;\n\n                // Reduce to principal half cycle\n                p.x = mod(p.x, TWO_PI); \n                if (p.x > PI) {\n                    p.x = TWO_PI - p.x;\n                }\n            \n                // Find zero of derivative (minimize distance)\n                float xa = 0.0;\n                float xb = TWO_PI;\n\n                // 24 bit precision\n                for (int i = 0; i < 24; i++) {\n                    float x = 0.5 * (xa + xb);\n                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));\n                    if (y < 0.0) xa = x; \n                    else xb = x;\n                }\n                float x = 0.5 * (xa + xb);\n                \n                // Compute distance    \n                vec2 q = vec2(x, b * c * cos(x));\n                return length(p - q) / c;\n            }\n\n            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                float repeat = frequency.x;\n                uv *= repeat;\n                vec2 i = floor(uv);\n                float row_offset = mod(i.y, 2.0);\n                uv.x += row_offset * zigzag;\n                vec2 f = vec2(uv.x, fract(uv.y));\n\n                // Generalized cosine: y(x) = a + b * cos(cx + d)\n                const float amplitude = 0.125;\n                float wave_frequency = frequency.y * 0.1;\n                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);\n\n\t\t\t\t// Different approach for variation param here\n\t\t\t\tfloat rand = hashwithoutsine12(vec2(i.y));\n\t\t\t\tfloat s = mix(size, size * rand, variation);\n\n                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);\n            }")}}();var KV=class extends kU{constructor(t,e,i,n,r,s,a,o){super("v3"),this.nodeType="Rainbow",this.filmThickness=t,this.movement=e,this.wavelengths=i,this.noiseStrength=n,this.noiseScale=r,this.offset=s,this.isMask=o,this.alpha=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.require("vWorldViewDir"),t.require("worldNormal"),t.isShader("fragment")){t.require("uv"),t.requires.uv=[!0],t.addFragmentVariable(this.calpha,"float");let i=t.include(KV.Nodes.rainbow),n=[];return n.push(this.filmThickness.build(t,"f")),n.push(this.movement.build(t,"f")),n.push(this.wavelengths.build(t,"v3")),n.push(this.noiseStrength.build(t,"f")),n.push(this.noiseScale.build(t,"f")),n.push(this.offset.build(t,"v3")),n.push(this.isMask.build(t,"b")),n.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),n.push(this.alpha.build(t,"f")),n.push(this.calpha),t.format(i+"("+n.join(",")+")",this.getType(t),e)}return console.warn("RainbowNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},ZV=KV;ZV.Nodes=function(){let t=new NU("vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {\n\t\t\t\tfloat f = 0.0;\n\t\t\t\t\n\t\t\t\tif (noiseStrength != 0.0) {\n\t\t\t\t\tvec3 st = position / noiseScale;\n\t\t\t\t\tfloat noise = simplexFast(1.6 * st + vec3(1.8, 1.5, 1.9) * simplexFast(st) + vec3(1.7, 9.2, 1.0));\n\t\t\t\t\tf = noise * noiseStrength;\n\t\t\t\t}\n\n\t\t\t\tvec3 waves = wavelengths * vec3(1.0, 0.8, 0.6) + 1.0;\n\t\t\t\tfloat angle = dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal));\n\n\t\t\t\tmediump vec3 color = cos((((filmThickness + f) / waves) * angle) + movement);\n\t\t\t\treturn .5 + .5 * color;\n\t\t\t }",[HV.simplexFast]);return{rainbow:new NU("vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\tmediump vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);\n\n\t\t\t\tfloat rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);\n\n\t\t\t\tfloat lalpha = alpha * rainbowContribution * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn res;\n\t\t\t }",[t])}}();var JV=class extends kU{constructor(t,e,i,n,r,s,a,o,l,h){super("v3"),this.nodeType="Toon",this.positioning=t,this.colors=e,this.steps=i,this.source=n,this.isWorldSpace=r,this.noiseStrength=s,this.noiseScale=a,this.shadowColor=o,this.offset=l,this.alpha=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.require("worldNormal"),t.require("worldPosition"),t.isShader("fragment")){t.define("COLORS_MAX",10),t.addFragmentVariable(this.calpha,"float");let i=t.include(JV.Nodes.toon),n=[];return n.push(this.positioning.build(t,"i")),n.push(this.colors.build(t,"v4[]")),n.push(this.steps.build(t,"f[]")),n.push(this.source.build(t,"v3")),n.push(this.isWorldSpace.build(t,"b")),n.push(this.noiseStrength.build(t,"f")),n.push(this.noiseScale.build(t,"f")),n.push(this.shadowColor.build(t,"v4")),n.push(this.offset.build(t,"v3")),n.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),n.push(this.alpha.build(t,"f")),n.push(this.calpha),t.format(i+"("+n.join(",")+")",this.getType(t),e)}return console.warn("ToonNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},$V=JV;$V.Nodes=function(){let t=new NU("float rand(float n) {\n\t\t\t\treturn fract(sin(n) * 43758.5453123);\n\t\t\t}"),e=new NU("float hash1(float p) { \n\t\t\t\tp = fract(p * 0.011); \n\t\t\t\tp *= p + 7.5; \n\t\t\t\tp *= p + p; \n\t\t\t\treturn fract(p); \n\t\t\t}"),i=new NU("float valueNoise(vec3 x) {\n\t\t\t\tconst vec3 step = vec3(110, 241, 171);\n\t\t\t\n\t\t\t\tvec3 i = floor(x);\n\t\t\t\tvec3 f = fract(x);\n\t\t\t \n\t\t\t\t// For performance, compute the base input to a 1D hash from the integer part of the argument and the \n\t\t\t\t// incremental change to the 1D based on the 3D -> 1D wrapping\n\t\t\t\tfloat n = dot(i, step);\n\t\t\t\n\t\t\t\tvec3 u = f * f * (3.0 - 2.0 * f);\n\t\t\t\treturn mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),\n\t\t\t\t\t\t\t   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),\n\t\t\t\t\t\t   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),\n\t\t\t\t\t\t\t   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);\n\t\t\t}",[e]),n=new NU("vec3 hash3(vec3 x) {\n\t\t\t\tx = vec3(dot(x,vec3(127.1, 311.7, 74.7)),\n\t\t\t\t\t\t dot(x,vec3(269.5, 183.3, 246.1)),\n\t\t\t\t\t\t dot(x,vec3(113.5, 271.9, 124.6)));\n\t\t\t\n\t\t\t\treturn fract(sin(x)*43758.5453123);\n\t\t\t}"),r=new NU('vec3 voronoiNoise(in vec3 x)\n\t\t\t{\n\t\t\t\tvec3 p = floor(x);\n\t\t\t\tvec3 f = fract(x);\n\n\t\t\t\tfloat id = 0.0;\n\t\t\t\tvec2 res = vec2(100.0);\n\n\t\t\t\tfor(int k=-1; k<=1; k++)\n\t\t\t\tfor(int j=-1; j<=1; j++)\n\t\t\t\tfor(int i=-1; i<=1; i++)\n\t\t\t\t{\n\t\t\t\t\tvec3 b = vec3(float(i), float(j), float(k));\n\n\t\t\t\t\t// Comment out the "+ hash(p + b);" part below to get "square" cells\n\t\t\t\t\tvec3 r = vec3(b) - f + hash3(p + b);\n\t\t\t\t\tfloat d = dot(r, r);\n\n\t\t\t\t\tif (d < res.x)\n\t\t\t\t\t{\n\t\t\t\t\t\tid = dot(p + b, vec3(1.0, 57.0, 113.0));\n\t\t\t\t\t\tres = vec2(d, res.x);\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\telse if (d < res.y)\n\t\t\t\t\t{\n\t\t\t\t\t\tres.y = d;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn vec3(sqrt(res), abs(id));\n\t\t\t}\n\t\t\t',[n]);return{toon:new NU('vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {\n\t\t\t\tfloat t = 0.0;\n\t\t\t\tfloat shadow = 1.0;\n\n\t\t\t\tif (positioning == 0) {\n\n\t\t\t\t\t// Can\'t do this mode if lighting is "none"\n\t\t\t\t\t#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))\n\n\t\t\t\t\t\t// Algorithm from Chapter 10 of Graphics Shaders\n\t\t\t\t\t\tconst vec3 weights = vec3(0.2125, 0.7154, 0.0721);\n\t\t\t\t\t\tvec3 lpos;\n\t\t\t\t\t\tvec3 l;\n\t\t\t\t\t\tfloat dproduct;\n\n\t\t\t\t\t\t#if (NUM_POINT_LIGHTS > 0)\n\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tPointLightShadow pointLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_POINT_LIGHTS; i++) {\n\t\t\t\t\t\t\t\t// Light positions are in view-space for some reason?\n\t\t\t\t\t\t\t\tlpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;\n\t\t\t\t\t\t\t\tl = normalize(lpos - worldPosition);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// TODO: we want to use "intensity" but it isn\'t available in the shader code\n\t\t\t\t\t\t\t\t//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);\n\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tpointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getPointShadow( \n\t\t\t\t\t\t\t\t\t\t\tpointShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowRadius,\n\t\t\t\t\t\t\t\t\t\t\tvPointShadowCoord[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowCameraNear, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowCameraFar);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#if NUM_DIR_LIGHTS > 0 \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tDirectionalLightShadow directionalLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n\t\t\t\t\t\t\t\t// Use the direction vector for directional lights instead\n\t\t\t\t\t\t\t\tl = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;\n\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tdirectionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getShadow( \n\t\t\t\t\t\t\t\t\t\tUNROLLED_LOOP_INDEX,\n\t\t\t\t\t\t\t\t\t\tdirectionalShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowRadius, \n\t\t\t\t\t\t\t\t\t\tvDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#if NUM_SPOT_LIGHTS > 0 \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tSpotLightShadow spotLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_SPOT_LIGHTS; i++) {\n\t\t\t\t\t\t\t\tlpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;\n\t\t\t\t\t\t\t\tl = normalize(lpos - worldPosition);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tspotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getShadow(\n\t\t\t\t\t\t\t\t\t\tUNROLLED_LOOP_INDEX,\n\t\t\t\t\t\t\t\t\t\tspotShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowRadius, \n\t\t\t\t\t\t\t\t\t\tvSpotLightCoord[UNROLLED_LOOP_INDEX]);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\tt = clamp(t, 0.0, 1.0);\n\t\t\t\t\n\t\t\t\t\t#endif\n\n\t\t\t\t} else if (positioning == 1) {\n\t\t\t\t\t\n\t\t\t\t\tvec3 origin = mix(position, worldPosition, float(isWorldSpace));\n\t\t\t\t\tvec3 direction = normalize(source - origin);\n\t\t\t\t\tt = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;\t\n\n\t\t\t\t} else {\n\n\t\t\t\t\tvec3 origin = worldPosition;\n\t\t\t\t\tvec3 source = cameraPosition - offset;\n\t\t\t\t\tvec3 direction = normalize(source - origin);\n\t\t\t\t\tt = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;\t\n\t\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\tif (noiseStrength > 0.0) {\n\t\t\t\t\t// Distort with noise\n\t\t\t\t\tvec3 st = position / noiseScale;\n\t\t\t\t\t\n\t\t\t\t\t// Voronoi "smooth" noise\n\t\t\t\t\tfloat noise = 1.0 - voronoiNoise(st).x;\n\n\t\t\t\t\t// Voronoi cellular noise\n\t\t\t\t\t//float noise = 1.0 - rand(voronoiNoise(st).z);\n\n\t\t\t\t\t// Position warp noise\n\t\t\t\t\t// vec3 offset = vec3(\n\t\t\t\t\t// \tsimplexFast(st),\n\t\t\t\t\t// \tsimplexFast(st + vec3(111.1, 143.89, 217.19)),\n\t\t\t\t\t// \tsimplexFast(st + vec3(171.1, 247.89, 117.23))\n\t\t\t\t\t// );\n\t\t\t\t\t// st += offset;\n\t\t\t\t\t// float noise = valueNoise(st);\n\n\t\t\t\t\tt += noise * noiseStrength;\n\t\t\t\t}\n\n\t\t\t\tt = clamp(t, 0.0, 1.0);\n\n\t\t\t\t// Compute ramp color\n\t\t\t\tfloat p;\n\t\t\t\tvec4 color = colors[0];\n\t\t\t\tfor (int i = 1; i < COLORS_MAX; i++) {\n\t\t\t\t\tp = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);\n\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t}\n\n\t\t\t\t// Incorporate custom shadow color\n\t\t\t\tif (positioning == 0) {\n\n\t\t\t\t\tvec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);\n\t\t\t\t\tcolor.rgb = mix(blendedShadow, color.rgb, shadow);\n\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\t// Accumulate alpha as usual\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha;\n\n\t\t\t\treturn color.xyz;\n\n            }',[HV.simplexFast,t,i,r])}}();var tj={textureBicubic:new NU("float w0( float a ) {\n            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n        }\n    \n        float w1( float a ) {\n            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n        }\n    \n        float w2( float a ){\n            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n        }\n    \n        float w3( float a ) {\n            return ( 1.0 / 6.0 ) * ( a * a * a );\n        }\n    \n        // g0 and g1 are the two amplitude functions\n        float g0( float a ) {\n            return w0( a ) + w1( a );\n        }\n    \n        float g1( float a ) {\n            return w2( a ) + w3( a );\n        }\n    \n        // h0 and h1 are the two offset functions\n        float h0( float a ) {\n            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n        }\n    \n        float h1( float a ) {\n            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n        }\n    \n        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n            uv = uv * texelSize.zw + 0.5;\n    \n            vec2 iuv = floor( uv );\n            vec2 fuv = fract( uv );\n    \n            float g0x = g0( fuv.x );\n            float g1x = g1( fuv.x );\n            float h0x = h0( fuv.x );\n            float h1x = h1( fuv.x );\n            float h0y = h0( fuv.y );\n            float h1y = h1( fuv.y );\n    \n            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n    \n            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + \n                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n        }\n\n        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n            vec2 fLodSizeInv = 1.0 / fLodSize;\n            vec2 cLodSizeInv = 1.0 / cLodSize;\n            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n            return mix( fSample, cSample, fract( lod ) );\n        }")};var ej=class extends kU{constructor(t,e,i,n,r,s,a,o){super("v3"),this.nodeType="Transmission",this.thickness=t,this.ior=e,this.roughness=i,this.transmissionSamplerSize=n,this.transmissionSamplerMap=r,this.transmissionDepthMap=s,this.aspectRatio=a,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.extensions.shaderTextureLOD=!0,t.extensions.derivatives=!0,t.isShader("fragment")){t.define("NUM_SAMPLES",6),t.define("BLUR_SLOD",Math.pow(2,aj.transmissionLod.value)),t.require("worldPosition"),t.requires.worldNormal=!0,t.requires.modelMatrix=!0,t.requires.projectionMatrix=!0,t.addFragmentVariable(this.calpha,"float");let i=t.include(ej.Nodes.transmission),n=[];return n.push(this.thickness.build(t,"f")),n.push(this.ior.build(t,"f")),n.push(this.roughness.build(t,"f")),n.push(this.transmissionSamplerSize.build(t,"v2")),n.push(this.transmissionSamplerMap.getTexture(t,"t")),n.push(this.transmissionDepthMap.getTexture(t,"t")),n.push(this.aspectRatio.build(t,"v2")),n.push("normal"),n.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),n.push(this.alpha.build(t,"f")),n.push(this.calpha),t.format(i+"("+n.join(",")+")",this.getType(t),e)}return console.warn("TransmissionNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},ij=ej;ij.Nodes=function(){let t=new NU("vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {\n                // Slightly modified version of this:\n                // https://www.shadertoy.com/view/ltScRG\n\n\t\t\t\t// Special case for blur == 0.0\n\t\t\t\tif (lod == 0.0) {\n\t\t\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\t\treturn texture2DLodEXT( sp, U, 0.0).rgb;\n\t\t\t\t\t#else\n\t\t\t\t\treturn textureLod( sp, U, 0.0).rgb;\n\t\t\t\t\t#endif\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvec2 texelSize = vec2(1.0) / resolution;\n                vec2 halton = haltonSequence[frameIndex];\n                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n                float temporalAngle  = temporalOffset * PI2;\n\t\t\t\tvec3 res = vec3(0.0);\n                vec2 uv = vec2(0.0);\n                vec2 offset = vec2(0.0);\n                vec2 vogelSample = vec2(0.0);\n                for (int i = 0; i < NUM_SAMPLES; i++) {\n                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;\n                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20\n                    uv = U + offset;\n                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));\n                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {\n                        uv = unrefractedU;\n                        lod = lod > 4.0 ? lod : lod / 2.0;\n                    }\n                    res += textureLod(sp, uv, lod).rgb;\n                }\n                return res / float(NUM_SAMPLES);\n            }"),e=new NU("vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\t        // Direction of refracted light.\n\t\t        vec3 refractionVector = refract( -v,  n, 1.0 / ior );\n\t\t        \n\t\t\t\t// Compute rotation-independant scaling of the model matrix.\n\t\t        vec3 modelScale;\n\t\t        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\t        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\t        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\n\t\t        // The thickness is specified in local space\n\t\t        return normalize( refractionVector ) * thickness * modelScale;\n\t        }"),i=new NU("float applyIorToRoughness( float roughness, float ior ) {\n\t\t\t\t// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and\n\t\t\t\t// an IOR of 1.5 results in the default amount of microfacet refraction.\n\t\t\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t\t\t}"),n=new NU('vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {\n\t\t\t\t// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see\n\t\t\t\t// also the code in convertTransmission.ts, which runs during export\n\t\t\t\t#ifdef IS_THREEJS_EXPORT\n\t\t\t\t\tfloat lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);\n\t\t\t\t\treturn textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;\n\t\t\t\t#else\n\t\t\t\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t\t\t\tfloat lod = applyIorToRoughness(roughness, ior);\n\t\t\t\t\treturn blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);\n\t\t\t\t#endif\n\t\t\t}',[tj.textureBicubic,i,t]),r=new NU("vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\n\t\t\t\t// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\n\t\t\t\tvec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );\n\t\t\t\tvec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;\n\t\t\t\tunrefractedCoords += 1.0;\n\t\t\t\tunrefractedCoords /= 2.0;\n\n\t\t\t\t// Sample framebuffer to get pixel the refracted ray hits.\n\t\t\t\treturn getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );\n    \t\t}",[n,e]);return{transmission:new NU("vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {\n                vec3 v = vec3(0.);\n                if (isOrthographic) {\n                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n                } else {\n                    v = normalize(vWPosition - cameraPosition);\n                }\n                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );\n                \n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * alpha;\n\n\t\t\t\treturn transmission;\n            }",[r])}}();var nj=(t=>(t.NOISE="noise",t.MAP="map",t))(nj||{}),rj=class extends kU{constructor(t,e,i,n,r,s,a,o,l,h,c){super("v3"),this.displacementTypeIndex=new bV(0),this.nodeType="VertexDisplacement",this.intensity=t,this.movementOrTexture=e,"map"===Object.values(nj)[this.displacementTypeIndex.value]&&(this.mat=new _V(this.movementOrTexture.value.matrix)),this.cropOrOffset=i,this.scale=h,this.noiseFunctionIndex=c,this.voronoiStyle=n,this.smoothness=r,this.seed=s,this.highCut=a,this.lowCut=o,this.quality=l}generate(t,e){if(t.isShader("vertex")){t.define("USE_LAYER_DISPLACE");let i,n=[];switch(n.push("displaced_position"),n.push("displaced_normal"),Object.values(nj)[this.displacementTypeIndex.value]){case"map":i=t.include(rj.Nodes.map),n.push(this.movementOrTexture.getTexture(t,"t")),n.push("uv"),n.push(this.cropOrOffset.build(t,"f")),this.mat&&n.push(this.mat.build(t,"mat3"));break;case"noise":{let e=["simplexPrecise","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseFunctionIndex.value],r=new NU("vec3 orthogonal(vec3 v) {\n\t\t\t\t\t\t\treturn normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));\n\t\t\t\t\t\t}"),s=new NU(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {\n\t\t\t\t\t\t\t${"voronoi"==e?`\n\t\t\t\t\tfloat v = ${e}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);\n\t\t\t\t\tv = remap(v, lowCut, highCut, 0.0, 1.0);\n\t\t\t\t\tv = smax(v, 0.0, smoothness * 0.25);\n\t\t\t\t\tv = smin(v, 1.0, smoothness * 0.25);\n\n\t\t\t\t\treturn p + n * v * intensity;\n\t\t\t\t\t`:`\n\t\t\t\t\treturn p + n * ${e}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;\n\t\t\t\t\t`}\n\t\t\t\t\t\t}`,[HV.simplexPrecise,HV.simplexFractal,HV.simplexAshima,HV.fbm,HV.perlin,HV.voronoi]),a=new NU("vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {\n\t\t\t\t\t\t\tvec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tvec3 tangent1 = orthogonal(normal);\n\t\t\t\t\t\t\tvec3 tangent2 = normalize(cross(normal, tangent1));\n\n                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.\n                            // This caused some small oval/circular visual artifacts in the lighting.\n                            // For now, simply using neighbors further away betters the problem,\n                            // but we should figure out the underlying cause when we have some time.\n                            // Maybe its related to how we calculate the tangent and bitangent?\n\t\t\t\t\t\t\tvec3 nearby1 = position + tangent1;\n\t\t\t\t\t\t\tvec3 nearby2 = position + tangent2;\n\t\t\t\t\t\t\tvec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tvec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tdisplaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));\n\t\t\t\t\t\t\treturn displaced_position;\n\t\t\t\t\t\t}",[s,r]);i=t.include(a),n.push(this.scale.build(t,"f")),n.push(this.cropOrOffset.build(t,"v3")),n.push(this.movementOrTexture.build(t,"f")),n.push(this.voronoiStyle.build(t,"i")),n.push(this.smoothness.build(t,"f")),n.push(this.seed.build(t,"f")),n.push(this.highCut.build(t,"f")),n.push(this.lowCut.build(t,"f")),n.push(this.quality.build(t,"i"));break}}return n.push(this.intensity.build(t,"f")),n.push("displaced_normal"),t.format(i+"("+n.join(",")+")",this.getType(t),e)}return console.warn("VertexDisplacementNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},sj=rj;sj.Nodes=function(){let t=new NU("vec3 orthogonal(vec3 v) {\n\t\t\t\treturn normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));\n\t\t\t}"),e=new NU("float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {\n\t\t\t\tvec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;\n\t\t\t\tvec4 tmp = texture2D(tex, uvs);\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tif (crop > 0.5) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\treturn 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn col.r;\n\t\t\t}");return{map:new NU("vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {\n\t\t\t\tvec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;\n\t\t\t\tvec3 tangent1 = normalize(orthogonal(normal));\n\t\t\t\tvec3 tangent2 = normalize(cross(normal, tangent1));\n\t\t\t\tvec3 nearby1 = position + tangent1 * 0.1;\n\t\t\t\tvec3 nearby2 = position + tangent2 * 0.1;\n\t\t\t\tvec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;\n\t\t\t\tvec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;\n\t\t\t\tdisplaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));\n\t\t\t\treturn displaced_position;\n\t\t\t}",[t,e])}}();var aj={normalRenderTarget:new KU,normalRenderTargetDepth:new KU,transmissionRenderTarget:new KU,aspectRatio:new RU,transmissionSize:new RU(2048,2048),transmissionRenderTargetDepth:new KU,aoRenderTarget:new KU,aoEnabled:new xV,pixelRatioNode:new ZU(1),resolution:new RU,penumbraSize:new wV(5,.5),frameIndex:new bV(0),transmissionLod:new bV(2)};for(let $2 of Object.values(aj))$2.isRenderGlobal=!0;var oj,lj={skiaWasmUrl:"https://unpkg.com/@splinetool/ui-wasm@1.9.72/build/ui.wasm"},hj=class extends PU{constructor(){super("basic"),this.nodeType="Basic",this.color=new yV(WI),this.shadingAlpha=new ZU(1),this.shadingBlend=new bV(0),this.previousModelViewMatrix=new CV,this.previouseProjectionMatrix=new CV}get category(){return"phong"}generate(t){let e;if(t.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:aj.frameIndex}),t.mergeUniform({resolution:aj.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(cv.merge([Tv.fog])),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#if defined( USE_LAYER_DISPLACE )\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif /* !USE_LAYER_DISPLACE */\n\t\t\t\t"];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","\tvNormal = transformedNormal;","#endif"),n.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=n.join("\n")}else{void 0===this.color&&(this.color=new yV(WI)),this.color.analyze(t,{slot:"color"}),this.alpha&&this.alpha.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"});let i=this.color.flow(t,"c",{slot:"color"}),n=this.alpha?this.alpha.flow(t,"f"):void 0,r=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0,s=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0;t.requires.transparent=void 0!==n,t.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join("\n"));let a=["#include <normal_fragment_begin>",i.code];n&&a.push(n.code,"#ifdef ALPHATEST"," if ( "+n.result+" <= ALPHATEST ) discard;","#endif"),s?a.push(s.code,`vec3 outgoingLight = ${i.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${s.result}, 1.0, SPE_BLENDING_NORMAL);`):a.push(`vec3 finalColor = ${i.result};`);let o="1.0";this.mask&&(this.mask.analyze(t),o=`luminance(${this.mask.flow(t,"v3").result})`),n?a.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${n.result} * ${o} );`):a.push("gl_FragColor = vec4("+i.result+", 1.0 );"),r&&a.push(`gl_FragColor.a *= ${r.result};`),a.push("#include <fog_fragment>","#include <dithering_fragment>"),e=a.join("\n")}return e}},cj=class extends PU{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new yV(WI),this.emissive=new yV(0),this.emissiveIntensity=new ZU(1),this.previousModelViewMatrix=new CV,this.previouseProjectionMatrix=new CV,this.shadingAlpha=new ZU(1),this.shadingBlend=new bV(0),this.occlusion=new xV(!0)}get category(){return"lambert"}build(t){let e;if(t.define("LAMBERT"),t.requires.lights=!0,t.extensions.derivatives=!0,t.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:aj.frameIndex}),t.mergeUniform({resolution:aj.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(cv.merge([Tv.fog,Tv.lights])),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","\tvarying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\n\t\t\t\t\tvec3 diffuse = vec3( 1.0 );\n\t\t\t\t\tGeometricContext geometry;\n\t\t\t\t\tgeometry.position = mvPosition.xyz;\n\t\t\t\t\tgeometry.normal = normalize( transformedNormal );\n\t\t\t\t\tgeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\n\t\t\t\t"),n.push("\n\t\t\t\t\tGeometricContext backGeometry;\n\t\t\t\t\tbackGeometry.position = geometry.position;\n\t\t\t\t\tbackGeometry.normal = -geometry.normal;\n\t\t\t\t\tbackGeometry.viewDir = geometry.viewDir;\n\t\t\t\t\tvLightFront = vec3( 0.0 );\n\t\t\t\t\tvIndirectFront = vec3( 0.0 );\n\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\tvLightBack = vec3( 0.0 );\n\t\t\t\t\t\tvIndirectBack = vec3( 0.0 );\n\t\t\t\t\t#endif\n\t\t\t\t\tIncidentLight directLight;\n\t\t\t\t\tfloat dotNL;\n\t\t\t\t\tvec3 directLightColor_Diffuse;\n\t\t\t\t\tvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\n\t\t\t\t\tvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\t\t\t\t\t\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_POINT_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_SPOT_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_DIR_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_HEMI_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=n.join("\n")}else{t.mergeUniform({penumbraSize:aj.penumbraSize}),t.mergeUniform({frameIndex:aj.frameIndex}),t.mergeUniform({aoMap:aj.aoRenderTarget}),t.mergeUniform({aoEnabled:aj.aoEnabled}),void 0===this.color&&(this.color=new yV(WI)),this.color.analyze(t,{slot:"color"}),this.shadingAlpha.analyze(t),this.shadingBlend.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(t);let i=this.color.flow(t,"c",{slot:"color"}),n=this.emissive.flow(t,"c",{slot:"emissive"}),r=this.emissiveIntensity.flow(t,"f",{slot:"emissive"}),s=this.occlusion.flow(t,"b",{slot:"occlusion"}),a=this.shadingAlpha.flow(t,"f"),o=this.shadingBlend.flow(t,"i"),l=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0,h=this.alpha?this.alpha.flow(t,"f"):void 0,c=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0;t.requires.transparent=void 0!==h,t.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","\tvarying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join("\n"));let u=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx, viewdy));\n\t\t\t\tbool isFrontFacing = (dot(normal, faceNormal) >= 0.0);\n\t\t\t\t","#include <clipping_planes_fragment>"];u.push(i.code,"vec3 diffuseColor = "+i.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),h&&u.push(h.code,"#ifdef ALPHATEST","if ( "+h.result+" <= ALPHATEST ) discard;","#endif"),u.push("#ifdef DOUBLE_SIDED","\treflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","\treflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","\treflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","\treflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),n&&u.push(n.code,"reflectedLight.directDiffuse += "+n.result+" * "+r.result+";"),u.push("vec3 ao = aoEnabled && "+s.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let d="1.0";this.mask&&(this.mask.analyze(t),d=`luminance(${this.mask.flow(t,"v3").result})`),u.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );\n\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t`),l&&u.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),h?u.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${h.result} );`):u.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c&&u.push(`gl_FragColor.a *= ${c.result};`),u.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),e=u.join("\n")}return e}},uj={dHdxy:new NU("vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {\n\n            // Gradient of UVs w.r.t. X coordinate (in screen-space)\n            vec2 dSTdx = dFdx(bumpMapUv);\n\n            // Gradient of UVs w.r.t. Y coordinate (in screen-space)\n            vec2 dSTdy = dFdy(bumpMapUv);\n            \n            // Forward differencing\n            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);\n            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;\n            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;\n            \n            return vec2( dBx, dBy );\n        }"),perturbNormalArb:new NU("vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n            vec3 vSigmaX = dFdx( surf_pos.xyz );\n            vec3 vSigmaY = dFdy( surf_pos.xyz );\n            vec3 vN = surf_norm; // normalized\n            \n            vN = normalize(vN);\n\n            vec3 R1 = cross( vSigmaY, vN );\n            vec3 R2 = cross( vN, vSigmaX );\n\n            R1 = normalize(R1);\n            R2 = normalize(R2);\n    \n            float fDet = dot( vSigmaX, R1 ) * faceDirection;\n    \n            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n            return normalize( abs( fDet ) * vN - vGrad );\n        }")},dj=class extends PU{constructor(){super("phong"),this.nodeType="Phong",this.color=new yV(WI),this.specular=new yV(1118481),this.shininess=new ZU(30),this.previousModelViewMatrix=new CV,this.previouseProjectionMatrix=new CV,this.shadingAlpha=new ZU(1),this.shadingBlend=new bV(0),this.occlusion=new xV(!0)}get category(){return"phong"}build(t){let e;if(t.define("PHONG"),t.requires.lights=!0,t.extensions.derivatives=!0,t.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:aj.frameIndex}),t.mergeUniform({resolution:aj.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(cv.merge([Tv.fog,Tv.lights])),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=n.join("\n")}else{t.mergeUniform({penumbraSize:aj.penumbraSize}),t.mergeUniform({frameIndex:aj.frameIndex}),t.mergeUniform({aoMap:aj.aoRenderTarget}),t.mergeUniform({aoEnabled:aj.aoEnabled}),void 0===this.color&&(this.color=new yV(WI)),this.color.analyze(t,{slot:"color"}),this.specular.analyze(t),this.shininess.analyze(t);let i=this.occlusion.flow(t,"b",{slot:"occlusion"});this.shadingAlpha.analyze(t),this.shadingBlend.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(t);let n=this.color.flow(t,"c",{slot:"color"}),r=this.specular.flow(t,"c"),s=this.shininess.flow(t,"f"),a=this.shadingAlpha.flow(t,"f"),o=this.shadingBlend.flow(t,"i"),l=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0,h=this.alpha?this.alpha.flow(t,"f"):void 0,c=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0;t.requires.transparent=void 0!==h,t.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join("\n"));let u=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tBlinnPhongMaterial material;"];if(this.bumpMap){t.include(uj.dHdxy),t.include(uj.perturbNormalArb);let e=this.bumpMap.texture.flow(t,"t"),i=this.bumpMap.flow(t,"v3"),n=this.bumpMapIntensity?this.bumpMapIntensity.flow(t,"f").result:"1.0",r="";r=4===this.bumpMap.projection.value?`\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(${e.result}, uv0, ${n});\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(${e.result}, uv1, ${n});\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(${e.result}, uv2, ${n});\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t`:`\n\t\t\t\t\tvec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(${e.result}, bumpMapCachedUv, ${n});\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t`,u.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t${i.result};\n\t\t\t\t\t${r}\n\t\t\t\t\t`)}u.push(n.code,"\tvec3 diffuseColor = "+n.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","\tvec3 totalEmissiveRadiance = emissive;",r.code,"\tvec3 specular = "+r.result+";",s.code,"\tfloat shininess = max( 0.0001, "+s.result+" );","\tfloat specularStrength = 1.0;"),h&&u.push(h.code,"#ifdef ALPHATEST","if ( "+h.result+" <= ALPHATEST ) discard;","#endif"),u.push("material.diffuseColor = diffuseColor;"),u.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),u.push("vec3 ao = aoEnabled && "+i.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let d="1.0";this.mask&&(this.mask.analyze(t),d=`luminance(${this.mask.flow(t,"v3").result})`),u.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );\n\t\t\t\t\t\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t`),l&&u.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),h?u.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${h.result});`):u.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c&&u.push(`gl_FragColor.a *= ${c.result};`),u.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),e=u.join("\n")}return e}},pj=class extends PU{constructor(){super("standard"),this.nodeType="Standard",this.color=new yV(WI),this.roughness=new ZU(.3),this.metalness=new ZU(0),this.reflectivity=new ZU(.5),this.previousModelViewMatrix=new CV,this.previouseProjectionMatrix=new CV,this.shadingAlpha=new ZU(1),this.shadingBlend=new bV(0),this.occlusion=new xV(!0)}get category(){return"physical"}build(t){let e;if(t.define("STANDARD"),t.requires.lights=!0,t.extensions.derivatives=!0,t.extensions.shaderTextureLOD=!0,t.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:aj.frameIndex}),t.mergeUniform({resolution:aj.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(cv.merge([Tv.fog,Tv.lights])),Tv.LTC_1&&(t.uniforms.ltc_1={value:void 0},t.uniforms.ltc_2={value:void 0}),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#if defined( USE_LAYER_DISPLACE )\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif /* !USE_LAYER_DISPLACE */\n\t\t\t\t"];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=n.join("\n")}else{t.mergeUniform({penumbraSize:aj.penumbraSize}),t.mergeUniform({frameIndex:aj.frameIndex}),t.mergeUniform({aoMap:aj.aoRenderTarget}),t.mergeUniform({aoEnabled:aj.aoEnabled});let i={gamma:!0};void 0===this.color&&(this.color=new yV(WI)),this.color.analyze(t,{slot:"color",context:i}),this.roughness.analyze(t),this.metalness.analyze(t);let n=this.occlusion.flow(t,"b",{slot:"occlusion"});this.shadingAlpha.analyze(t),this.shadingBlend.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(t),this.reflectivity&&this.reflectivity.analyze(t);let r=this.color.flow(t,"c",{slot:"color",context:i}),s=this.roughness.flow(t,"f"),a=this.metalness.flow(t,"f"),o=this.shadingAlpha.flow(t,"f"),l=this.shadingBlend.flow(t,"i"),h=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(t,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0,d=this.reflectivity?this.reflectivity.flow(t,"f"):void 0;t.requires.transparent=void 0!==c,t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join("\n"));let p=["#include <clipping_planes_fragment>","\t#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){t.include(uj.dHdxy),t.include(uj.perturbNormalArb);let e=this.bumpMap.texture.flow(t,"t"),i=this.bumpMap.flow(t,"v3"),n=this.bumpMapIntensity?this.bumpMapIntensity.flow(t,"f").result:"1.0",r="";r=4===this.bumpMap.projection.value?`\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(${e.result}, uv0, ${n});\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(${e.result}, uv1, ${n});\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(${e.result}, uv2, ${n});\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t`:`\n\t\t\t\t\tvec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(${e.result}, bumpMapCachedUv, ${n});\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t${i.result};\n\t\t\t\t\t${r}\n\t\t\t\t\t`)}if(p.push(r.code,"\tvec3 diffuseColor = "+r.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",a.code,"\tfloat metalnessFactor = "+a.result+";"),this.roughnessMap){let e=this.roughnessMap.texture.flow(t,"t"),i=this.roughnessMap.flow(t,"v3"),n="";n=4===this.roughnessMap.projection.value?`\n\t\t\t\t\tfloat roughnessChange = 1.0;\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;\n\n\t\t\t\t\t\tfloat r0 = luminance(texture(${e.result}, uv0).rgb) * roughnessScale;\n\t\t\t\t\t\tfloat r1 = luminance(texture(${e.result}, uv1).rgb) * roughnessScale;\n\t\t\t\t\t\tfloat r2 = luminance(texture(${e.result}, uv2).rgb) * roughnessScale;\n\n\t\t\t\t\t\troughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);\n\t\t\t\t\t}\n\t\t\t\t\tfloat roughnessFactor = roughnessChange * ${s.result};\n\t\t\t\t\t`:`\n\t\t\t\t\tvec2 roughnessMapCachedUv = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs;\n\n\t\t\t\t\tvec4 vals = texture(${e.result},  roughnessMapCachedUv);\n\t\t\t\t\tfloat roughnessFactor = luminance(vals.rgb) * ${s.result};\n\t\t\t\t\t`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t${i.result};\n\n\t\t\t\t\tconst float roughnessScale = 1.0;\n\n\t\t\t\t\t${n}\n\t\t\t\t`)}else p.push(s.code,"\tfloat roughnessFactor = "+s.result+";");c&&p.push(c.code,"#ifdef ALPHATEST","\tif ( "+c.result+" <= ALPHATEST ) discard;","#endif"),p.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),p.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),d?p.push(d.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+d.result+" ) ), diffuseColor, metalnessFactor );"):p.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),p.push("#include <lights_fragment_begin>"),p.push("#include <lights_fragment_end>"),p.push("vec3 ao = aoEnabled && "+n.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let f="1.0";this.mask&&(this.mask.analyze(t),f=`luminance(${this.mask.flow(t,"v3").result})`),p.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * ${f} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result} * ${f}, ${l.result} );\n\t\t\t\t\t\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t`),h&&p.push(h.code,`outgoingLight = spe_blend(outgoingLight, ${h.result}, 1.0, SPE_BLENDING_NORMAL);`),c?p.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result} );`):p.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&p.push(`gl_FragColor.a *= ${u.result};`),p.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),e=p.join("\n")}return e}},fj=class extends PU{constructor(){super("toon"),this.nodeType="Toon",this.color=new yV(WI),this.specular=new yV(1118481),this.shininess=new ZU(30),this.previousModelViewMatrix=new CV,this.previouseProjectionMatrix=new CV,this.shadingAlpha=new ZU(1),this.shadingBlend=new bV(0)}get category(){return"toon"}build(t){let e;if(t.define("TOON"),t.requires.lights=!0,t.extensions.derivatives=!0,t.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:aj.frameIndex}),t.mergeUniform({resolution:aj.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(cv.merge([Tv.fog,Tv.lights])),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=n.join("\n")}else{t.mergeUniform({penumbraSize:aj.penumbraSize}),t.mergeUniform({frameIndex:aj.frameIndex}),t.mergeUniform({aoMap:aj.aoRenderTarget}),t.mergeUniform({aoEnabled:aj.aoEnabled}),void 0===this.color&&(this.color=new yV(WI)),this.color.analyze(t,{slot:"color"}),this.specular.analyze(t),this.shininess.analyze(t),this.shadingAlpha.analyze(t),this.shadingBlend.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(t);let i=this.color.flow(t,"c",{slot:"color"}),n=this.specular.flow(t,"c"),r=this.shininess.flow(t,"f"),s=this.shadingAlpha.flow(t,"f"),a=this.shadingBlend.flow(t,"i"),o=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(t,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0;t.requires.transparent=void 0!==l,t.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>","\n\t\t\t\t\tvarying vec3 vViewPosition;\n\t\t\t\t\tstruct ToonMaterial {\n\t\t\t\t\t\tvec3\tdiffuseColor;\n\t\t\t\t\t\tvec3\tspecularColor;\n\t\t\t\t\t\tfloat\tspecularShininess;\n\t\t\t\t\t\tfloat\tspecularStrength;\n\t\t\t\t\t};\n\t\t\t\t\tvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\t\t\t\t\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t\t\t\n\t\t\t\t\t\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\t\t\t\t\t\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n\t\t\t\t\t}\n\t\t\t\t\tvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\t\t\t\t\t\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\t\t\t\t\t}\n\t\t\t\t\t#define RE_Direct\t\t\t\tRE_Direct_Toon\n\t\t\t\t\t#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n\t\t\t\t\t#define Material_LightProbeLOD( material )\t(0)\n\t\t\t\t\t","#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join("\n"));let c=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tToonMaterial material;"];if(this.bumpMap){t.include(uj.dHdxy),t.include(uj.perturbNormalArb);let e=this.bumpMap.texture.flow(t,"t"),i=this.bumpMap.flow(t,"v3"),n=this.bumpMapIntensity?this.bumpMapIntensity.flow(t,"f").result:"1.0",r="";r=4===this.bumpMap.projection.value?`\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(${e.result}, uv0, ${n});\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(${e.result}, uv1, ${n});\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(${e.result}, uv2, ${n});\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t`:`\n\t\t\t\t\tvec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(${e.result}, bumpMapCachedUv, ${n});\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t`,c.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t${i.result};\n\t\t\t\t\t${r}\n\t\t\t\t\t`)}c.push(i.code,"\tvec3 diffuseColor = "+i.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",n.code,"\tvec3 specular = "+n.result+";",r.code,"\tfloat shininess = max( 0.0001, "+r.result+" );","\tfloat specularStrength = 1.0;"),l&&c.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),c.push("material.diffuseColor = diffuseColor;"),c.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),c.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let u="1.0";this.mask&&(this.mask.analyze(t),u=`luminance(${this.mask.flow(t,"v3").result})`),c.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${s.result} * ${u} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${s.result} * ${u}, ${a.result} );\n\t\t\t\t}\n\t\t\t\t`),o&&c.push(o.code,`outgoingLight = spe_blend(outgoingLight, ${o.result}, 1.0, SPE_BLENDING_NORMAL);`),l?c.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):c.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&c.push(`gl_FragColor.a *= ${h.result};`),c.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),e=c.join("\n")}return e}},mj=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;this.timeout=t,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(){}remove(t){let e=this.cache.get(t);e&&(this.dispose(t,e.data),this.cache.delete(t),e.prev.next=e.next,e.next.prev=e.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout((()=>{this.hasClean=!1,this.log("cleaning");let t=Date.now(),e=this.head.next;for(;e.time<t-this.timeout;)this.dispose(e.src,e.data),this.cache.delete(e.src),e=e.next,e.prev=this.head,this.head.next=e;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")}),this.timeout+1e3))}has(t){return this.cache.get(t)?.data}load(t){let e=Date.now(),i=this.cache.get(t);return void 0===i?(i={data:this.create(t),src:t,time:e,next:null,prev:null},this.cache.set(t,i)):(i.time=e,i.prev.next=i.next,i.next.prev=i.prev),i.prev=this.tail.prev,i.next=this.tail,this.tail.prev.next=i,this.tail.prev=i,this.scheduleCleanup(),i.data}},gj=class extends mj{create(t){return URL.createObjectURL(new Blob([t]))}dispose(t,e){URL.revokeObjectURL(e)}};var vj=class{constructor(t,e){this.data=t,this.cache=e,this.refCount=0}deref(){this.refCount,this.refCount-=1,0===this.refCount&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount,0}},yj=class{constructor(){this.cache=new Map}remove(t){this.cache.delete(t.data),0}load(t){let e=this.cache.get(t);return void 0===e&&(e=this.create(t),this.cache.set(t,e)),e.refCount+=1,e}},bj=class extends vj{constructor(t,e){super(t,e.imageHolderCache),this.data=t,this.shared=e,this.loaded=!1,this.isVideo=!1,this.isBuffer=!1,this._cache={1e3:{},1001:{},1002:{}},this.isVideo="video"===t.type,this.isBuffer=!0===t.isWebGLRenderTarget,this.loadPromise=this.updateSrc(this.isBuffer?t:t.data)}async updateSrc(t){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let e=()=>{this.loaded=!0;for(let t of Object.values(this._cache))for(let e of Object.values(t))for(let t of Object.values(e))t&&(t.image=this.img,t.needsUpdate=!0);this.shared.requestRender()};if(this.isBuffer)this.img=t,this.loaded=!0;else if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,"string"!=typeof t){var i=new FileReader;let e;i.readAsDataURL(new Blob([t],{type:"video/mp4"})),await new Promise((t=>{i.onloadend=i=>{e=i.target?.result,t(null)}})),this.img.src=e}else this.img.src=t;this.img.onloadeddata=()=>{e()}}else this.img=new Image,this.img.src=function(t){return"string"==typeof t?t:(oj||(oj=new gj),oj.load(t))}(t),this.img.onload=e,await new Promise((t=>{this.img.onload=()=>{e(),t(null)}}))}getTexture(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1008,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1006,n=this._cache[t]?.[e]?.[i];if(n)return n;{let n;return n=this.isBuffer?this.img.texture:this.isVideo?new kx(this.img,void 0,t,t):new hm(this.img,void 0,t,t,i,e),this.loaded&&(n.needsUpdate=!0),void 0===this._cache[t]&&(this._cache[t]={}),void 0===this._cache[t][e]&&(this._cache[t][e]={}),this._cache[t][e][i]=n,n}}setNeedsUpdate(t){for(let e of Object.values(this._cache))for(let i of Object.values(e))for(let e of Object.values(i))e&&(e.needsUpdate=t)}disposeTextures(){for(let[t,e]of Object.entries(this._cache))for(let[i,n]of Object.entries(e))for(let[e,r]of Object.entries(n))r?.dispose(),void 0!==this._cache[t]&&void 0!==this._cache[t][i]&&(this._cache[t][i][e]=void 0)}dispose(){super.dispose(),this.disposeTextures()}},xj=class extends bj{};function wj(t,e){var i=function(t){if(!Aj[t]){var e=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:"America/New_York",year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),i="06/25/2014, 00:00:00"===e||"\u200e06\u200e/\u200e25\u200e/\u200e2014\u200e \u200e00\u200e:\u200e00\u200e:\u200e00"===e;Aj[t]=i?new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:t,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return Aj[t]}(e);return i.formatToParts?function(t,e){try{for(var i=t.formatToParts(e),n=[],r=0;r<i.length;r++){var s=Sj[i[r].type];s>=0&&(n[s]=parseInt(i[r].value,10))}return n}catch(gI){if(gI instanceof RangeError)return[NaN];throw gI}}(i,t):function(t,e){var i=t.format(e).replace(/\u200E/g,""),n=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(i);return[n[3],n[1],n[2],n[4],n[5],n[6]]}(i,t)}var Sj={year:0,month:1,day:2,hour:3,minute:4,second:5};var Aj={};function Ej(t,e,i,n,r,s,a){var o=new Date(0);return o.setUTCFullYear(t,e,i),o.setUTCHours(n,r,s,a),o}var _j=36e5,Cj={timezone:/([Z+-].*)$/,timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-]\d{2}):?(\d{2})$/};function Mj(t,e,i){var n,r,s;if(!t||(n=Cj.timezoneZ.exec(t)))return 0;if(n=Cj.timezoneHH.exec(t))return Tj(s=parseInt(n[1],10))?-s*_j:NaN;if(n=Cj.timezoneHHMM.exec(t)){s=parseInt(n[1],10);var a=parseInt(n[2],10);return Tj(s,a)?(r=Math.abs(s)*_j+6e4*a,s>0?-r:r):NaN}if(function(t){if(Dj[t])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:t}),Dj[t]=!0,!0}catch{return!1}}(t)){e=new Date(e||Date.now());var o=i?e:function(t){return Ej(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds())}(e),l=Pj(o,t),h=i?l:function(t,e,i){var n=t.getTime(),r=n-e,s=Pj(new Date(r),i);if(e===s)return e;r-=s-e;var a=Pj(new Date(r),i);return s===a?s:Math.max(s,a)}(e,l,t);return-h}return NaN}function Pj(t,e){var i=wj(t,e),n=Ej(i[0],i[1]-1,i[2],i[3]%24,i[4],i[5],0).getTime(),r=t.getTime(),s=r%1e3;return n-(r-=s>=0?s:1e3+s)}function Tj(t,e){return-23<=t&&t<=23&&(null==e||0<=e&&e<=59)}var Dj={};var kj=np(op(),1),Ij=np(lp(),1),Rj=36e5,Oj=6e4,Lj={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,plainTime:/:/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/};function Bj(t,e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(null===t)return new Date(NaN);var i=e||{},n=null==i.additionalDigits?2:(0,kj.default)(i.additionalDigits);if(2!==n&&1!==n&&0!==n)throw new RangeError("additionalDigits must be 0, 1 or 2");if(t instanceof Date||"object"==typeof t&&"[object Date]"===Object.prototype.toString.call(t))return new Date(t.getTime());if("number"==typeof t||"[object Number]"===Object.prototype.toString.call(t))return new Date(t);if("string"!=typeof t&&"[object String]"!==Object.prototype.toString.call(t))return new Date(NaN);var r=function(t){var e,i={},n=Lj.dateTimePattern.exec(t);if(n?(i.date=n[1],e=n[3]):(n=Lj.datePattern.exec(t),n?(i.date=n[1],e=n[2]):(i.date=null,e=t)),e){var r=Lj.timeZone.exec(e);r?(i.time=e.replace(r[1],""),i.timeZone=r[1].trim()):i.time=e}return i}(t),s=function(t,e){var i,n=Lj.YYY[e],r=Lj.YYYYY[e];if(i=Lj.YYYY.exec(t)||r.exec(t),i){var s=i[1];return{year:parseInt(s,10),restDateString:t.slice(s.length)}}if(i=Lj.YY.exec(t)||n.exec(t),i){var a=i[1];return{year:100*parseInt(a,10),restDateString:t.slice(a.length)}}return{year:null}}(r.date,n),a=s.year,o=function(t,e){if(null===e)return null;var i,n,r,s;if(0===t.length)return n=new Date(0),n.setUTCFullYear(e),n;if(i=Lj.MM.exec(t),i)return n=new Date(0),r=parseInt(i[1],10)-1,Vj(e,r)?(n.setUTCFullYear(e,r),n):new Date(NaN);if(i=Lj.DDD.exec(t),i){n=new Date(0);var a=parseInt(i[1],10);return function(t,e){if(e<1)return!1;var i=Uj(t);return!(i&&e>366||!i&&e>365)}(e,a)?(n.setUTCFullYear(e,0,a),n):new Date(NaN)}if(i=Lj.MMDD.exec(t),i){n=new Date(0),r=parseInt(i[1],10)-1;var o=parseInt(i[2],10);return Vj(e,r,o)?(n.setUTCFullYear(e,r,o),n):new Date(NaN)}if(i=Lj.Www.exec(t),i)return s=parseInt(i[1],10)-1,jj(e,s)?zj(e,s):new Date(NaN);if(i=Lj.WwwD.exec(t),i){s=parseInt(i[1],10)-1;var l=parseInt(i[2],10)-1;return jj(e,s,l)?zj(e,s,l):new Date(NaN)}return null}(s.restDateString,a);if(isNaN(o))return new Date(NaN);if(o){var l,h=o.getTime(),c=0;if(r.time&&(c=function(t){var e,i,n;if(e=Lj.HH.exec(t),e)return i=parseFloat(e[1].replace(",",".")),Gj(i)?i%24*Rj:NaN;if(e=Lj.HHMM.exec(t),e)return i=parseInt(e[1],10),n=parseFloat(e[2].replace(",",".")),Gj(i,n)?i%24*Rj+n*Oj:NaN;if(e=Lj.HHMMSS.exec(t),e){i=parseInt(e[1],10),n=parseInt(e[2],10);var r=parseFloat(e[3].replace(",","."));return Gj(i,n,r)?i%24*Rj+n*Oj+1e3*r:NaN}return null}(r.time),isNaN(c)))return new Date(NaN);if(r.timeZone||i.timeZone){if(l=Mj(r.timeZone||i.timeZone,new Date(h+c)),isNaN(l))return new Date(NaN)}else l=(0,Ij.default)(new Date(h+c)),l=(0,Ij.default)(new Date(h+c+l));return new Date(h+c+l)}return new Date(NaN)}function zj(t,e,i){e=e||0,i=i||0;var n=new Date(0);n.setUTCFullYear(t,0,4);var r=7*e+i+1-(n.getUTCDay()||7);return n.setUTCDate(n.getUTCDate()+r),n}var Fj=[31,28,31,30,31,30,31,31,30,31,30,31],Nj=[31,29,31,30,31,30,31,31,30,31,30,31];function Uj(t){return t%400===0||t%4===0&&t%100!==0}function Vj(t,e,i){if(e<0||e>11)return!1;if(null!=i){if(i<1)return!1;var n=Uj(t);if(n&&i>Nj[e]||!n&&i>Fj[e])return!1}return!0}function jj(t,e,i){return!(e<0||e>52||null!=i&&(i<0||i>6))}function Gj(t,e,i){return!(null!=t&&(t<0||t>=25)||null!=e&&(e<0||e>=60)||null!=i&&(i<0||i>=60))}function Hj(t,e){return e.color(t)}function Wj(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,e=arguments.length>1?arguments[1]:void 0,i=e.format,n=t.getSeconds(),r=t;e&&null!==e.timeZone&&(r=function(t,e,i){var n=Bj(t,i),r=Mj(e,n,!0),s=new Date(n.getTime()-r),a=new Date(0);return a.setFullYear(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()),a.setHours(s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds(),s.getUTCMilliseconds()),a}(new Date,e.timeZone));let s,a=r.getHours(),o=r.getMinutes();"12ampm"===e.format12h24h&&(s=a>=12?"PM":"AM");let l,h,c=a;switch("24"!==e.format12h24h&&(c=a%12,0===c&&(c=12)),i){case"HH:mm:ss":l=[c,o,n];break;case"HH:mm":l=[c,o];break;case"HH":l=[c],s=void 0;break;case"mm":l=[o],s=void 0;break;case"ss":l=[n],s=void 0;break;case"year":h=r.getFullYear();break;case"month":h=r.getMonth()+1;break;case"dayOfYear":h=Math.floor((r.getTime()-new Date(r.getFullYear(),0,0).getTime())/864e5);break;case"dayOfMonth":h=r.getDate();break;case"secondOfDay":h=60*a*60+60*o+n;break;default:console.error("Unknown time format",i),h=0}return void 0!==l?{textValue:l,suffix:s}:h}function qj(t,e){switch(t.type){case"fresnel":return function(t,e){let{bias:i,scale:n,intensity:r,factor:s,color:a}=t;return{...Xj(t,e),color:Hj(a,e),bias:i,scale:n,intensity:r,factor:s}}(t,e);case"gradient":return function(t,e){let{gradientType:i,smooth:n,colors:r,steps:s,angle:a,offset:o,morph:l}=t;return{...Xj(t,e),gradientType:i,smooth:n,colors:r.map((t=>new cm(t[0],t[1],t[2],t[3]))),num:r.length,steps:s,offset:new Uf(...o),morph:new Uf(...l),angle:a}}(t,e);case"depth":return function(t,e){let{gradientType:i,near:n,far:r,isVector:s,isWorldSpace:a,origin:o,direction:l,colors:h,steps:c,smooth:u}=t;return{...Xj(t,e),gradientType:i,near:n,far:r,isVector:s,isWorldSpace:a,origin:new mm(...o),direction:l?new mm(...l):new mm(1,0,0),colors:h.map((t=>void 0!==t?new cm(t[0],t[1],t[2],t[3]):new cm(0,0,0,0))),steps:c.slice(0,h.length),smooth:u}}(t,e);case"normal":return function(t,e){let{cnormal:i}=t;return{...Xj(t,e),cnormal:new mm(i[0],i[1],i[2])}}(t,e);case"noise":return function(t,e){return{...Xj(t,e),scale:t.scale,move:t.move,fA:new Uf(...t.fA),fB:new Uf(...t.fB),size:new mm(...t.size),distortion:new Uf(...t.distortion),colorA:Hj(t.colorA,e),colorB:Hj(t.colorB,e),colorC:Hj(t.colorC,e),colorD:Hj(t.colorD,e),noiseType:t.noiseType,voronoiStyle:t.voronoiStyle,highCut:t.highCut,lowCut:t.lowCut,smoothness:t.smoothness,seed:t.seed,quality:t.quality}}(t,e);case"rainbow":return function(t,e){return{...Xj(t,e),filmThickness:t.filmThickness,movement:t.movement,wavelengths:new mm(...t.wavelengths),noiseStrength:t.noiseStrength,noiseScale:t.noiseScale,offset:new mm(...t.offset)}}(t,e);case"toon":return function(t,e){return{...Xj(t,e),positioning:t.positioning,colors:t.colors.map((t=>new cm(t[0],t[1],t[2],t[3]))),num:t.colors.length,steps:t.steps,source:new mm(...t.source),isWorldSpace:t.isWorldSpace,noiseStrength:t.noiseStrength,noiseScale:t.noiseScale,shadowColor:Hj(t.shadowColor,e),offset:new mm(...t.offset)}}(t,e);case"outline":return function(t,e){return{...Xj(t,e),outlineColor:Hj(t.outlineColor,e),contourColor:Hj(t.contourColor,e),outlineWidth:t.outlineWidth,contourWidth:t.contourWidth,outlineThreshold:t.outlineThreshold,contourThreshold:t.contourThreshold,outlineSmoothing:t.outlineSmoothing,contourFrequency:t.contourFrequency,contourDirection:new mm(...t.contourDirection),positionalLines:t.positionalLines,compensation:t.compensation}}(t,e);case"transmission":return function(t,e){return{...Xj(t,e),thickness:t.thickness,ior:t.ior,roughness:t.roughness}}(t,e);case"color":return function(t,e){return{...Xj(t,e),color:Hj(t.color,e)}}(t,e);case"pattern":return function(t,e){return{...Xj(t,e),style:t.style,projection:t.projection,axis:t.axis,blending:t.blending,offset:new Uf(...t.offset),colorA:Hj(t.colorA,e),colorB:Hj(t.colorB,e),frequency:new Uf(...t.frequency),size:t.size,variation:t.variation,smoothness:t.smoothness,zigzag:t.zigzag,rotation:t.rotation,vertical:new Uf(...t.vertical),horizontal:new Uf(...t.horizontal),sides:t.sides}}(t,e)}}function Yj(t){return{type:t.type}}function Xj(t,e){let{alpha:i,mode:n,isMask:r}=t,s="string"==typeof i?(Number(e.getVariable(i))??100)/100:i;return{...Yj(t),alpha:s,mode:n,isMask:r}}var Qj=class extends LU{},Kj={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},Zj={depth:["colors"]};function Jj(t,e,i){if("isMask"===e)return!0;let n=Kj[t.type],r=Zj[t.type];if(void 0!==r){let n=t.color;if(r.includes(e)){let t=n[e]?.value?.length;if(void 0!==t&&t!==i.length)return!0}}return void 0!==n&&n.includes(e)}function $j(t,e,i){let n=i.uniforms[`f${i.id}_texture`];if(!n)return!1;let r=!1,s=t;if("image"in s){let t=s.image,i=e.image(t),r=n;r.image instanceof xj||r.image.deref(),r.image=i}if("video"in s){let t=s.video,i=e.video(t),r=n;r.image instanceof xj||r.image.deref(),r.image=i}if("wrapping"in s){n.wrap=s.wrapping}if("minFilter"in s){n.minFilter=s.minFilter}if("magFilter"in s){n.magFilter=s.magFilter}if("rotation"in s&&i.uniforms[`f${i.id}_rotation`])return i.uniforms[`f${i.id}_rotation`].value=(s.rotation??0)*Nf.DEG2RAD,r;if("repeat"in s||"offset"in s||"rotation"in s){let t="mat",e=i.uniforms[`f${i.id}_${t}`];"repeat"in s&&(e.repeat=s.repeat),"offset"in s&&(e.offset=s.offset),"rotation"in s&&(e.rotation=s.rotation??0),e.updateMatrix()}return r}var tG=(t,e,i)=>Math.max(0,Math.min(1,Number(e.getVariable("number"==typeof t?100*t:t,i)??100)/100))??1,eG=class{constructor(t,e,i,n,r){this.id=t,this.uuid=e,this.data=i,this.uniforms={};for(let s in n)this.uniforms[`f${this.id}_${s}`]=n[s];for(let s in i)aG(s,this,i,r)}get type(){return this.data.type}static create(t,e,i,n){if("light"===i.type)return rG.createLightLayer(t,e,i,n);if("texture"===i.type||"video"===i.type){let r="texture"===i.type?n.uiBuffer(i.texture.image)??n.image(i.texture.image):n.video(i.texture.video),s=new EV(r,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new AV(r),o=new PV(i.texture.repeat,i.texture.offset,i.texture.rotation??0),l=new ZU(i.crop?1:0),h=new bV(i.projection??0),c=new bV(["x","y","z"].indexOf(i.axis)??0),u=new bV(i.side??0),d=new RU(i.size?new Uf(i.size[0],i.size[1]):new Uf(100,100)),p=new ZU(i.blending??0),f=new ZU(tG(i.alpha,n)),m=new bV(i.mode??0),g=new xV(i.isMask??!1),v=new BV(s,a,l,h,c,u,d,p,o,f,m,g),y=new QU(v.calpha,"f");return new iG(t,e,i,{texture:s,textureSize:a,crop:l,projection:h,axis:c,side:u,size:d,blending:p,mat:o,alpha:f,mode:m,isMask:g},v,m,y,g,n)}if("matcap"===i.type){let r=n.image(i.texture.image),s=new EV(r,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new ZU(tG(i.alpha,n)),o=new bV(i.mode??0),l=new xV(i.isMask??!1),h=new ZU((i.texture.rotation??0)*Nf.DEG2RAD),c=new GV(s,a,o,l,h),u=new QU(c.calpha,"f");return new iG(t,e,i,{texture:s,alpha:a,mode:o,isMask:l,rotation:h},c,o,u,l,n)}if("displace"===i.type){if("noise"===i.displacementType){let r=new OU(new mm(...i.offset)),s=new ZU(i.scale??10),a=new ZU(i.intensity??8),o=new ZU(i.movement??1),l=new bV(i.noiseType??0),h=new bV(i.voronoiStyle??0),c=new ZU(i.smoothness??.5),u=new ZU(i.seed??0),d=new ZU(i.highCut??1),p=new ZU(i.lowCut??0),f=new bV(i.quality??1),m=new sj(a,o,r,h,c,u,d,p,f,s,l);return new nG(t,e,i,{offset:r,scale:s,intensity:a,movement:o,noiseType:l,voronoiStyle:h,smoothness:c,seed:u,highCut:d,lowCut:p,quality:f},m,n)}throw new Error}return function(t,e,i,n){let r=qj(i,n);return function(t,e,i,n,r){switch(t.type){case"color":{let s=new yV(n.color??WI),a=sG(n),o=new IV(s,a.alpha),l=new QU(o.calpha,"f");return new iG(e,i,t,{color:s,...a},o,a.mode,l,a.isMask,r)}case"fresnel":{let s=new yV(n.color??16777215),a=new ZU(n.bias??.1),o=new ZU(n.scale??1),l=new ZU(n.intensity??2),h=new ZU(n.factor??1),c=sG(n),u=new NV(s,a,o,l,h,c.alpha,c.mode,c.isMask),d=new QU(u.calpha,"f");return new iG(e,i,t,{color:s,bias:a,scale:o,intensity:l,factor:h,...c},u,c.mode,d,c.isMask,r)}case"rainbow":{let s=new ZU(n.filmThickness??30),a=new ZU(n.movement??0),o=new OU(n.wavelengths??new mm(0,0,0)),l=new ZU(n.noiseStrength??0),h=new ZU(n.noiseScale??1),c=new OU(n.offset??new mm(0,0,0)),u=sG(n),d=new ZV(s,a,o,l,h,c,u.alpha,u.isMask),p=new QU(d.calpha,"f");return new iG(e,i,t,{filmThickness:s,movement:a,wavelengths:o,noiseStrength:l,noiseScale:h,offset:c,...u},d,u.mode,p,u.isMask,r)}case"transmission":{let s=new ZU(n.thickness??10),a=new ZU(n.ior??1.5),o=new ZU(n.roughness??.5),l=aj.transmissionSize,h=aj.transmissionRenderTarget,c=aj.transmissionRenderTargetDepth,u=window.innerWidth,d=window.innerHeight,p=u>=d?new RU(d/u,1):new RU(1,u/d),f=sG(n),m=new ij(s,a,o,l,h,c,p,f.alpha),g=new QU(m.calpha,"f");return new iG(e,i,t,{thickness:s,ior:a,roughness:o,aspectRatio:p,...f},m,f.mode,g,f.isMask,r)}case"toon":{let s,a,o=new bV(n.positioning??0);n.colors?s=new TV(n.colors.length,n.colors):(s=new TV(10,new cm(0,0,0,1)),s.value[1]=new cm(1,1,1,1)),n.steps?a=new wV(n.steps.length,n.steps):(a=new wV(10,1),a.value[0]=0);let l=new OU(n.source??new mm(0,0,0)),h=new xV(n.isWorldSpace??!0),c=new ZU(n.noiseStrength??0),u=new ZU(n.noiseScale??1),d=new BU(n.shadowColor),p=new OU(n.offset??new mm(0,0,0)),f=sG(n),m=new $V(o,s,a,l,h,c,u,d,p,f.alpha),g=new QU(m.calpha,"f");return new iG(e,i,t,{positioning:o,colors:s,steps:a,source:l,isWorldSpace:h,noiseStrength:c,noiseScale:u,shadowColor:d,offset:p,...f},m,f.mode,g,f.isMask,r)}case"outline":{let s=new yV(n.outlineColor??16777215),a=new yV(n.contourColor??16777215),o=new ZU(n.outlineWidth??.1),l=new ZU(n.contourWidth??.1),h=new ZU(n.outlineThreshold??.1),c=new ZU(n.contourThreshold??.1),u=new ZU(n.outlineSmoothing??.1),d=new ZU(n.contourFrequency??.1),p=new OU(n.contourDirection??new mm(0,1,0)),f=new xV(n.positionalLines??!1),m=new xV(n.compensation??!0),g=aj.normalRenderTarget,v=aj.normalRenderTargetDepth,y=aj.pixelRatioNode,b=aj.resolution,x=sG(n),w=new YV(s,a,o,l,h,c,u,d,p,f,m,b,g,v,y,x.alpha),S=new QU(w.calpha,"f");return new iG(e,i,t,{outlineColor:s,contourColor:a,outlineWidth:o,contourWidth:l,outlineThreshold:h,contourThreshold:c,outlineSmoothing:u,contourFrequency:d,contourDirection:p,positionalLines:f,compensation:m,...x},w,x.mode,S,x.isMask,r)}case"depth":{let s,a,o=new bV(n.gradientType??0),l=new xV(n.smooth??!1),h=new ZU(n.near??50),c=new ZU(n.far??200),u=new ZU(n.isVector??1),d=new ZU(n.isWorldSpace??0),p=new OU(n.origin??new mm),f=new OU(n.direction??new mm);n.colors?s=new TV(n.colors.length,n.colors):(s=new TV(2,new cm(0,0,0,1)),s.value[1]=new cm(1,1,1,1)),n.steps?a=new wV(n.steps.length,n.steps):(a=new wV(2,1),a.value[0]=0);let m=sG(n),g=new FV(o,l,h,c,u,d,p,f,s,a,m.alpha,m.isMask),v=new QU(g.calpha,"f");return new iG(e,i,t,{gradientType:o,smooth:l,near:h,far:c,isVector:u,isWorldSpace:d,origin:p,direction:f,colors:s,steps:a,...m},g,m.mode,v,m.isMask,r)}case"noise":{let s=new ZU(n.scale??1),a=new OU(n.size??new mm(100,100,100)),o=new ZU(n.move??1),l=new RU(n.fA??new Uf(1.7,9.2)),h=new RU(n.fB??new Uf(8.3,2.8)),c=new RU(n.distortion??new Uf(1,1)),u=new BU(n.colorA),d=new BU(n.colorB),p=new BU(n.colorC),f=new BU(n.colorD),m=new bV(n.noiseType??0),g=new bV(n.voronoiStyle??0),v=new ZU(n.highCut??1),y=new ZU(n.lowCut??0),b=new ZU(n.smoothness??.5),x=new ZU(n.seed??.5),w=new bV(n.quality??1),S=sG(n),A=new WV(s,a,o,l,h,c,u,d,p,f,S.alpha,m,S.isMask,g,v,y,b,x,w),E=new QU(A.calpha,"f");return new iG(e,i,t,{scale:s,size:a,move:o,fA:l,fB:h,distortion:c,colorA:u,colorB:d,colorC:p,colorD:f,noiseType:m,...S,voronoiStyle:g,highCut:v,lowCut:y,smoothness:b,seed:x,quality:w},A,S.mode,E,S.isMask,r)}case"normal":{let s=new OU(n.cnormal??new mm(1,1,1)),a=sG(n),o=new OV(s,a.alpha),l=new QU(o.calpha,"f");return new iG(e,i,t,{cnormal:s,...a},o,a.mode,l,a.isMask,r)}case"gradient":{let s,a,o=new bV(n.gradientType??0),l=new xV(n.smooth??!1);n.colors?s=new TV(n.colors.length,n.colors):(s=new TV(10,new cm(0,0,0,1)),s.value[1]=new cm(1,1,1,1)),n.steps?a=new wV(n.steps.length,n.steps):(a=new wV(10,1),a.value[0]=0);let h=new RU(n.offset??new Uf(0,0)),c=new RU(n.morph??new Uf(0,0)),u=new ZU(n.angle??0),d=sG(n),p=new VV(o,l,s,a,h,c,u,d.alpha,d.isMask),f=new QU(p.calpha,"f");return new iG(e,i,t,{gradientType:o,smooth:l,colors:s,steps:a,offset:h,morph:c,angle:u,...d},p,d.mode,f,d.isMask,r)}case"pattern":{let s=new bV(n.style??0),a=new bV(n.projection??0),o=new bV(["x","y","z"].indexOf(n.axis)??0),l=new ZU(n.blending??0),h=new RU(n.offset??new Uf(0,0)),c=new BU(n.colorA),u=new BU(n.colorB),d=new RU(n.frequency??new Uf(10,10)),p=new ZU(n.size??.5),f=new ZU(n.variation??0),m=new ZU(n.smoothness??.5),g=new ZU(n.zigzag??0),v=new ZU(n.rotation??0),y=new RU(n.vertical??new Uf(0,1)),b=new RU(n.horizontal??new Uf(0,1)),x=new bV(n.sides??6),w=sG(n),S=new QV(s,a,o,l,h,c,u,d,p,f,m,g,v,y,b,x,w.alpha,w.isMask),A=new QU(S.calpha,"f");return new iG(e,i,t,{style:s,projection:a,axis:o,blending:l,offset:h,colorA:c,colorB:u,frequency:d,size:p,variation:f,smoothness:m,zigzag:g,rotation:v,vertical:y,horizontal:b,sides:x,...w},S,w.mode,A,w.isMask,r)}default:{let s=new yV(1,0,0,1),a=sG(n),o=new IV(s,a.alpha),l=new QU(o.calpha,"f");return new iG(e,i,t,{color:s,...a},o,a.mode,l,a.isMask,r)}}}(i,t,e,r,n)}(t,e,i,n)}updateByOp(t,e,i){let n=t;if(void 0===n.path[0]){if(0===n.type)return"type"in n.props||"category"in n.props||"visible"in n.props||"noiseType"in n.props?(i.scene.markNeedsUpdateRendererDirty(),!0):function(t,e,i,n){let r=!1;for(let[s,a]of Object.entries(t)){if("bumpMap"===s||"roughnessMap"===s){r=!0;continue}if(!s||void 0===a)continue;if(aG(s,i,n,e)){"visible"===s&&"light"===i.type&&(r=!0);continue}i.visible=n.visible;let t=i.uniforms[`f${i.id}_${s}`];if(t&&!(t instanceof SV))switch(r=r||Jj(i,s,a),t.constructor){case yV:if("string"==typeof a){let i=e.getColor(a);i&&(t.value=i);break}{let e=a;t.value instanceof Qj?t.value=new LU(e.r,e.g,e.b,e.a):t.setRGBA(e);break}case BU:if("string"==typeof a){let i=e.getColor(a);i&&(t.value=i);break}{let e=a;t.value instanceof Qj?t.value=new LU(e.r,e.g,e.b,e.a):t.value.setRGBA(e.r,e.g,e.b,e.a);break}case RU:{let e=a;t.value.setX(e[0]),t.value.setY(e[1]);break}case OU:{let e=a;t.value.setX(e[0]),t.value.setY(e[1]),t.value.setZ(e[2]);break}case KU:$j(a,e,i);break;case TV:t.value=a.map((t=>new cm(...t)));break;default:t.value=a}}return r}(n.props,i.shared,this,e)}else if("texture"===n.path[0])return!("texture"in e)&&!("video"in e)||$j(n.props,i.shared,this);return!1}dispose(){if(function(t){let e=t instanceof eG?t.type:t;return"texture"===e||"video"===e||"displace_map"===e||"matcap"===e}(this)){let t=this.uniforms[`f${this.id}_texture`];if(!t)return!1;let e=t;e.image instanceof xj||e.image.deref()}}hasValueByKey(t){return void 0!==this.uniforms[t]}hasValue(t){return this.hasValueByKey(`f${this.id}_${t}`)}setValue(t,e){let i=`f${this.id}_${t}`;this.hasValueByKey(i)&&void 0!==e&&(this.uniforms[i].value=e)}getNode(t){let e=`f${this.id}_${t}`;if(this.hasValueByKey(e))return this.uniforms[e]}getValue(t){let e=`f${this.id}_${t}`;if(this.hasValueByKey(e))return this.uniforms[e].value}getName(t){let e=/f\d+_(.*)/.exec(t);if(e&&e.length>1)return e[1];console.log(`Layer.getName: error ${t}`)}getNames(){let t=[];for(let e in this.uniforms){let i=this.getName(e);i&&t.push(i)}return t}},iG=class extends eG{constructor(t,e,i,n,r,s,a,o,l){super(t,e,i,n,l),this.params=n,this.color=r,this.mode=s,this.alpha=a,this.isMask=o}},nG=class extends eG{constructor(t,e,i,n,r,s){super(t,e,i,n,s),this.position=r}},rG=class extends eG{constructor(t,e,i,n,r,s){super(t,e,i,r,s),this.node=n}static createLightLayer(t,e,i,n){let r,s,a=new ZU(tG(i.alpha,n)),o=new bV(i.mode),l=new ZU(i.bumpMapIntensity),h=new ZU(tG(i.alphaOverride,n));if(i.visible)if("lambert"===i.category){r=new cj;let t=new yV(n.color(i.emissive)??0),e=new xV(i.occlusion??!0);s={emissive:t,occlusion:e},r.emissive=t,r.occlusion=e}else if("toon"===i.category){r=new fj;let t=new ZU(i.shininess??30),e=new yV(n.color(i.specular)??1118481);s={shininess:t,specular:e},r.shininess=t,r.specular=e}else if("physical"===i.category){r=new pj;let t=new ZU(i.roughness??.3),e=new ZU(i.metalness??0),n=new ZU(i.reflectivity??.5),a=new xV(i.occlusion??!0);s={roughness:t,metalness:e,reflectivity:n,occlusion:a},r.roughness=t,r.metalness=e,r.reflectivity=n,r.occlusion=a}else{r=new dj;let t=new ZU(i.shininess??30),e=new yV(void 0!==i.specular?n.color(i.specular)??1118481:1118481),a=new xV(i.occlusion??!0);s={shininess:t,specular:e,occlusion:a},r.shininess=t,r.specular=e,r.occlusion=a}else r=new hj,s={};return r.alpha=new ZU(1),r.shadingAlpha=a,r.shadingBlend=o,r.bumpMapIntensity=l,r.alphaOverride=h,s.alpha=r.shadingAlpha,s.mode=r.shadingBlend,s.bumpMapIntensity=r.bumpMapIntensity,s.alphaOverride=r.alphaOverride,new rG(t,e,i,r,s,n)}get category(){return this.node.category}};function sG(t){return{alpha:new ZU(t.alpha??1),mode:new bV(t.mode??0),isMask:new xV(t.isMask??!1)}}function aG(t,e,i,n){if("displace"===i.type&&("intensity"===t||"visible"===t)){let t=e.uniforms[`f${e.id}_intensity`];return t?(t.value=i.intensity*(i.visible?1:0),t):void 0}if("displace"!==i.type&&("alpha"===t||"visible"===t)){let r=e.uniforms[`f${e.id}_alpha`];if(!r)return;if(r.value=tG(i.alpha,n)*(i.visible?1:0),"outline"===i.type&&"visible"===t){let t=e.uniforms[`f${e.id}_compensation`];t&&(t.value=i.compensation&&i.visible)}return r}}function oG(t,e){let i=0,n=t.layers.find((t=>"light"===t.data.type));if(n){let t=n.data,i=Number(e.getVariable(t.alphaOverride));if(("string"==typeof t.alphaOverride?i/100:t.alphaOverride)<1)return!0}for(let r of t.layers){if("displace"!==r.data.type&&r.data.isMask)return!0;if("displace"!==r.data.type&&"alpha"in r.data&&"light"!==r.data.type&&"fresnel"!==r.data.type&&"texture"!==r.data.type&&"matcap"!==r.data.type&&"rainbow"!==r.data.type&&"outline"!==r.data.type&&"pattern"!==r.data.type){let t=r.data.visible?r.data.alpha:0;if("string"==typeof t&&(t=Math.max(0,Math.min(1,Number(e.getVariable(t)??100)/100))),1===t&&"depth"===r.data.type||"gradient"===r.data.type){for(let e of r.data.colors)if(e[3]<1){t=e[3];break}}else if(1===t&&"noise"===r.data.type){let i=e.color(r.data.colorA).a,n=e.color(r.data.colorB).a,s=e.color(r.data.colorC).a,a=e.color(r.data.colorD).a,o=Math.min(i,Math.min(n,Math.min(s,a)));o<1&&(t=o)}i+=(1-i)*t}}return i<1}var lG=class extends uv{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.shadersPatchedForShapeBlend=!1,this.nodeContextUuid=0,this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return""}},hG=class extends lG{constructor(t,e,i,n){super(),this.flatShading=t,this.side=e,this.wireframe=i,this.root=n}updateAfterBuild(){let t=this.root;this.lights=t.lights,this.vertexShader=t.vertexShader,this.fragmentShader=t.fragmentShader,Object.assign(this.defines,t.defines),Object.assign(this.uniforms,t.uniforms),this.extensions=t.extensions,this.transparent=t.transparent,this.cacheKey=t.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(t,e){this.root.onBeforeCompile(t)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(t,e,i,n){return this.root.getFlavor(t,e,i,n)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(t){return this.root.getLayersOfType(t)}getLayerByUuid(t){return this.root.getLayerByUuid(t)}updateByOp(t,e,i){this.root.updateByOp(t,e,i)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},cG=class extends lG{constructor(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(),this.data=t,this.allowVariableSaves=i,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],this.needsJitter=e.shared.needsJitter,PU.startContext(this),this.reset0(t,e),PU.endContext(this)}get nodeMaterial(){return this}getFlavor(t,e,i,n){let r=i?6:(t?3:0)+e;if(r+=7*((n?.resolutionLevel??0)-(n?.useChildrenColors?4:0)),0===r)return this;void 0===this.flavors&&(this.flavors=[]),r-=1;let s=this.flavors[r];return void 0===s&&(s=new hG(t,e,i,this),s.needsJitter=this.needsJitter,this.flavors[r]=s,s.flatShading=t,s.side=e,s.updateAfterBuild(),n&&(s.defines.SHAPEBLEND=n.resolutionLevel,s.defines.SHAPEBLEND_C=n.useChildrenColors?1:0)),s}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){return this.lightLayer.getNode("occlusion")?.value??!1}reset(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];PU.startContext(this),(this.data!==t||i)&&this.reset0(t,e),PU.endContext(this)}reset0(t,e){this.data=t;let i=t.layers??uR.defaultTwoLayerData("phong").layers;try{this.layers=i.map((t=>eG.create(this.layerIdGen++,t.id,t.data,e.shared)))}catch{this.layers=[]}this.layers.reverse(),this.name=t.name??"Untitled Material",this.onUpdate(e.shared),this.transparent=oG(t,e.shared),this.saveVariableLocations(e)}onVariableUpdate(t,e,i){if("alphaOverride"===t[0])this.transparent=oG(this.data,i.shared),this.lightLayer.setValue("alphaOverride",Math.max(0,Math.min(Number(e)/100,1)));else if("layer"===t[0]){let n=t[1],r=t[2];if(n&&r){let t=this.layers.find((t=>t.uuid===n));t?.hasValue(r)&&("alpha"===r?(this.transparent=oG(this.data,i.shared),t.setValue(r,Math.max(0,Math.min(Number(e)/100,1)))):t.setValue(r,e))}}}saveVariableLocations(t){if(!this.allowVariableSaves)return;let e=this.data.layers.find((t=>"light"===t.data.type));e&&t.shared.getVariable(e.data.alphaOverride,["material",this.uuid,"alphaOverride"]),this.data.layers.forEach((e=>{"alpha"in e.data&&"string"==typeof e.data.alpha&&t.shared.getVariable(e.data.alpha,["material",this.uuid,"layer",e.id,"alpha"])}))}getLayersOfType(t){return this.layers.filter((e=>e.type===t))}getLayerByUuid(t){return this.layers.find((e=>e.uuid===t))}onUpdate(t){this.lightLayer=this.layers.find((t=>t instanceof rG)),void 0===this.lightLayer&&(this.lightLayer=new rG(0,"",{...cR.defaultData("light","phong"),visible:!1},new hj,{},t)),this.dispose();for(let e of this.flavors)e&&e.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions(),this.build(),this.nodeContextUuid=0}applyTextureMaps(){let t=this.layers.find((t=>t instanceof rG));if(!t)return;let e=t.data,i=e.bumpMap,n=e.roughnessMap;t.node.bumpMap=void 0,t.node.roughnessMap=void 0;for(let r=0;r<this.layers.length;++r){let e=this.layers[r];e instanceof iG&&e.color instanceof BV&&(e.uuid===i&&(t.node.bumpMap=e.color),e.uuid===n&&(t.node.roughnessMap=e.color))}}updateByOp(t,e,i){if(PU.startContext(this),void 0!==e?this.data=e:e=this.data,this.transparent=oG(e,i.shared),"layers"===t.path[0]){let n=i.shared,r=t.path[1];if(void 0===r)i.scene.markNeedsUpdateRendererDirty(),this.reset0(e,i);else{0===t.type&&void 0!==t.props.occlusion&&i.scene.markNeedsUpdateRendererDirty();let s=this.layers.find((t=>t.uuid===r));if(s){let a,o=e.layers.data(r);0===t.type&&("alpha"in t.props||"alphaOverride"in t.props)&&(a="alpha"in t.props?{...t.props,alpha:tG(t.props.alpha,n,["material",this.uuid,"layer",r,"alpha"])}:{...t.props,alphaOverride:tG(t.props.alphaOverride,n,["material",this.uuid,"alphaOverride"])}),s.updateByOp({...t,...a?{props:a}:{},path:t.path.slice(2)},o,i)&&this.reset0(e,i)}}}else this.reset0(e,i);PU.endContext(this)}applyMasks(){for(let t=0;t<this.layers.length;++t){let e=this.layers[t];e instanceof iG?e.color.mask=void 0:e instanceof rG&&(e.node.mask=void 0)}for(let t=0;t<this.layers.length;++t){let e=this.layers[t];if(e instanceof iG&&e.isMask.value&&e.data.visible&&t>0){let i=t-1,n=this.layers[i];n instanceof rG?n.node.mask=new tV(e.color,e.alpha,tV.MUL):n instanceof iG&&(n.isMask.value||(n.color.mask=new tV(e.color,e.alpha,tV.MUL)))}}}blendColors(){let t=this.layers.findIndex((t=>t instanceof iG)),e=this.layers.findIndex((t=>t instanceof rG));if(-1!==t&&t<e){let i=this.layers[t].color;for(let n=t+1;n<e;++n){let t=this.layers[n];if(t instanceof iG){if(t.isMask.value)continue;i=new DV(i,t.color,t.alpha,t.mode)}}this.fragment.color=i}else this.fragment.color=void 0}blendAfterColors(){let t=new QU("outgoingLight","f"),e=this.layers.findIndex((t=>t instanceof rG));if(this.layers.length>e+1){for(let i=e+1;i<this.layers.length;++i){let e=this.layers[i];if(e instanceof iG){if(e.isMask.value)continue;t=new DV(t,e.color,e.alpha,e.mode)}}this.fragment.afterColor=t}else this.fragment.afterColor=void 0}blendPositions(){let t=this.layers.filter((t=>t instanceof nG));if(t.length>0){let e=t[0].position;for(let i=1;i<t.length;++i)t[i]&&(e=new tV(e,t[i].position,tV.ADD),e=new tV(e,new ZU(.5).setReadonly(!0),tV.MUL));this.fragment.position=e}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(t){this.shapeBlendhack&&this.shapeBlendhack(this),t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.extensionDerivatives=!0===this.extensions.derivatives,t.extensionFragDepth=!0===this.extensions.fragDepth,t.extensionDrawBuffers=!0===this.extensions.drawBuffers,t.extensionShaderTextureLOD=!0===this.extensions.shaderTextureLOD}clampUniformsForPreview(t,e){let i=(t,e,i)=>Math.min(Math.max(t,e),i);for(let n of this.layers)if("displace"===n.type){let r=i(n.uniforms[`f${n.id}_intensity`].value,t,e);n.uniforms[`f${n.id}_intensity`].value=r}}updateFrame(t){for(let e=0;e<this.updaters.length;++e)t.updateNode(this.updaters[e])}build(){let t=new vV;t.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,t.build(this.fragment,this.fragment),this.vertexShader=t.getCode("vertex"),this.fragmentShader=t.getCode("fragment"),this.defines=t.defines,this.uniforms=t.uniforms,this.extensions=t.extensions,this.updaters=t.updaters;for(let e of this.flavors)e&&e.updateAfterBuild();return this.shadersPatchedForShapeBlend=!1,this}nodeMaterialDispose(){this.layers.forEach((t=>t.dispose())),super.dispose();for(let t of this.flavors)t&&t.dispose()}assetsLoaded(){for(let t of this.layers)if(t instanceof iG){let e=t.params.texture;if(e instanceof EV&&!e.image.loaded)return!1}return!0}};Object.defineProperties(lG.prototype,{properties:{get:function(){return this.fragment.properties}}});var uG=class extends cG{constructor(t,e,i){super(t,e,!1),this.uuid=i,this.allowVariableSaves=!0,this.saveVariableLocations(e)}},dG=new Map;function pG(t){if("string"==typeof t)return t;let e=dG.get(t);return e||(e={url:URL.createObjectURL(new Blob([t]))},dG.set(t,e)),e.url}var fG,mG,gG,vG=new Promise((t=>{fG=t})),yG=!1;function bG(){if(!yG)return mG||(mG=async function(){await __webpack_require__.e(519).then(__webpack_require__.bind(__webpack_require__,519)),fG(void 0!==window?window:global),yG=!0}())}function xG(t){let e=!1;return t.scene.objects.traverse(((t,i)=>{if(void 0===i.events||!1===Array.isArray(i.events))return!0;let n=[];i.events.forEach((t=>{"dragDropActions"in t.data?(n.push(...t.data.dragDropActions.drag),n.push(...t.data.dragDropActions.drop)):"inActions"in t.data?(n.push(...t.data.inActions),n.push(...t.data.outActions)):"gameActions"in t.data?(n.push(...t.data.gameActions.idle),n.push(...t.data.gameActions.move),n.push(...t.data.gameActions.jump),n.push(...t.data.gameActions.run)):"breakpoints"in t.data?t.data.breakpoints.forEach((t=>{n.push(...t.data.actions)})):"actions"in t.data&&n.push(...t.data.actions),e=e||n.some((t=>"Audio"===t.data.type))}))})),e}vG.then((t=>gG=t));var wG,SG,AG=class{constructor(t){let e,{src:i,volume:n,delay:r,loop:s}=t;this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)},e="string"==typeof i?{src:i}:{src:pG(i),format:"wav"},this.sound=new gG.Howl(e),this.sound.on("end",this.onEnd),this.src=i,void 0!==n&&(this.volume=n),void 0!==r&&(this.delay=r),void 0!==s&&(this.loop=s)}get status(){return this._status}get volume(){return this._volume}set volume(t){this._volume=t,this.sound.volume(t)}get loop(){return this._loop}set loop(t){this._loop=t,this.loopsRemaining=t}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout((()=>{this.sound.play(),this.clearDelay()}),this.delay)}fade(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;t?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout((()=>{this.sound.fade(this._volume,0,e),this.clearFade()}),t)):this.sound.fade(this._volume,0,e)}on(t,e,i){this.sound.on(t,e,i)}off(t,e,i){this.sound.off(t,e,i)}play(){"playing"===this._status||this.sound.playing()||("paused"===this._status?(0===this.sound.seek()?this.replay():this.sound.play(),this._status="playing"):"stopped"===this._status&&(this.replay(),this._status="playing"))}pause(){"playing"===this._status&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},EG=class{constructor(){this.type="ShapePath",this.color=new nm,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new Zx,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath?.lineTo(t,e),this}quadraticCurveTo(t,e,i,n){return this.currentPath?.quadraticCurveTo(t,e,i,n),this}bezierCurveTo(t,e,i,n,r,s){return this.currentPath?.bezierCurveTo(t,e,i,n,r,s),this}splineThru(t){return this.currentPath?.splineThru(t),this}toShapes(){let t=0,e=1,i=2,n=3,r=4,s=5,a=6,o={loc:t,t:0};function l(e,n,r,s){let a=e.x,l=n.x,c=r.x,u=s.x,d=e.y,p=n.y,f=r.y,m=s.y,g=(u-c)*(d-f)-(m-f)*(a-c),v=(m-f)*(l-a)-(u-c)*(p-d),y=g/v,b=((l-a)*(d-f)-(p-d)*(a-c))/v;if(0===v&&0!==g||y<=0||y>=1||b<0||b>1)return null;if(0===g&&0===v){for(let c=0;c<2;c++){if(h(0===c?r:s,e,n),o.loc===t){let t=0===c?r:s;return{x:t.x,y:t.y,t:o.t}}if(o.loc===i){return{x:+(a+o.t*(l-a)).toPrecision(10),y:+(d+o.t*(p-d)).toPrecision(10),t:o.t}}}return null}for(let i=0;i<2;i++)if(h(0===i?r:s,e,n),o.loc===t){let t=0===i?r:s;return{x:t.x,y:t.y,t:o.t}}return{x:+(a+y*(l-a)).toPrecision(10),y:+(d+y*(p-d)).toPrecision(10),t:y}}function h(l,h,c){let u,d=c.x-h.x,p=c.y-h.y,f=l.x-h.x,m=l.y-h.y,g=d*m-f*p;return l.x===h.x&&l.y===h.y?(o.loc=t,void(o.t=0)):l.x===c.x&&l.y===c.y?(o.loc=e,void(o.t=1)):void(g<-Number.EPSILON?o.loc=n:g>Number.EPSILON?o.loc=r:d*f<0||p*m<0?o.loc=s:Math.sqrt(d*d+p*p)<Math.sqrt(f*f+m*m)?o.loc=a:(u=0!==d?f/d:m/p,o.loc=i,o.t=u))}function c(t,e,i){let n=new Uf;e.getCenter(n);let r=[];return i.forEach((e=>{e.boundingBox.containsPoint(n)&&function(t,e){let i=[],n=[];for(let r=1;r<t.length;r++){let s=t[r-1],a=t[r];for(let t=1;t<e.length;t++){let r=l(s,a,e[t-1],e[t]);null!==r&&void 0===i.find((t=>t.t<=r.t+Number.EPSILON&&t.t>=r.t-Number.EPSILON))&&(i.push(r),n.push(new Uf(r.x,r.y)))}}return n}(t,e.points).forEach((t=>{r.push({identifier:e.identifier,isCW:e.isCW,point:t})}))})),r.sort(((t,e)=>t.point.x-e.point.x)),r}let u=0,d=999999999,p=-999999999,f=[];this.subPaths.forEach((t=>{let e=t.getPoints(),i=-999999999,n=999999999,r=-999999999,s=999999999;for(let a=0;a<e.length;a++){let t=e[a];t.y>i&&(i=t.y),t.y<n&&(n=t.y),t.x>r&&(r=t.x),t.x<s&&(s=t.x)}p<=r&&(p=r+1),d>=s&&(d=s-1),e.length&&f.push({curves:t.curves,points:e,isCW:Tw.isClockWise(e),identifier:u++,boundingBox:new JS(new Uf(s,n),new Uf(r,i))})}));let m=f.map((t=>function(t,e,i,n,r){(null==r||""===r)&&(r="nonzero");let s=new Uf;t.boundingBox.getCenter(s);let a=c([new Uf(i,s.y),new Uf(n,s.y)],t.boundingBox,e);a.sort(((t,e)=>t.point.x-e.point.x));let o=[],l=[];a.forEach((e=>{e.identifier===t.identifier?o.push(e):l.push(e)}));let h=o[0].point.x,u=[],d=0;for(;d<l.length&&l[d].point.x<h;)u.length>0&&u[u.length-1]===l[d].identifier?u.pop():u.push(l[d].identifier),d++;if(u.push(t.identifier),"evenodd"===r){let e=u.length%2===0,i=u[u.length-2];return{identifier:t.identifier,isHole:e,for:i}}if("nonzero"===r){let i=!0,n=null,r=null;for(let t=0;t<u.length;t++){let s=u[t];e[s]&&(i?(r=e[s].isCW,i=!1,n=s):r!==e[s].isCW&&(r=e[s].isCW,i=!0))}return{identifier:t.identifier,isHole:i,for:n}}console.warn('fill-rule: "'+r+'" is currently not implemented.')}(t,f,d,p,this.userData?.style.fillRule))),g=[];return f.forEach((t=>{let e=m[t.identifier];if(e&&!e.isHole){let e=new nw;e.curves=t.curves,m.filter((e=>e?.isHole&&e.for===t.identifier)).forEach((t=>{if(t){let i=f[t.identifier],n=new Zx;n.curves=i.curves,e.holes.push(n)}})),g.push(e)}})),g}},_G=!1,CG=new Promise((t=>{wG=t})),MG=!1;function PG(){if(_G=!0,!MG)return SG||(SG=async function(){let t=await __webpack_require__.e(946).then(__webpack_require__.bind(__webpack_require__,946));wG(t),MG=!0}(),SG)}var TG=new class{async load(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{},{load:n}=await CG;n(t,((t,n)=>{t||!n?i(t??"Something went wrong"):e(n)}))}async parse(t){let{parse:e,Bidi:i}=await CG;try{let n=e(t),r=new i,s=t=>n.charToGlyphIndex(t.char);return r.registerModifier("glyphIndex",null,s),r.applyFeatures(n,n.defaultRenderOptions.features),{font:n,bidi:r}}catch(TI){console.error(TI)}}};async function DG(t){let e,i,n=!1;if(t.url?(e=await async function(t){return await(await fetch(t)).arrayBuffer()}(t.url),i=t.url,n=t.url.startsWith("/")):t.data&&(e=t.data.buffer.slice(t.data.byteOffset,t.data.byteOffset+t.data.byteLength)),e){if(!_G)return{font:void 0,url:i,intercepted:n,arr:e,bidi:null};{let t=await TG.parse(e);if(t)return{font:t.font,url:i,intercepted:n,arr:e,bidi:t.bidi}}}}function kG(t,e){return e.state.glyphIndex===t||e.state.fina===t||e.state.medi===t||e.state.init===t}var IG=class{constructor(t){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=t.isUserFont??!1,this._loadingPromise=DG(t).then((t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)}))}update(t){this._isLoaded=!1,this._isUserFont=t.isUserFont??!1,this._loadingPromise=DG(t).then((t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)}))}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(t,e,i){if(!this._bidi)return[];let n=this._bidi;n.getTextGlyphs(e);let r=n.tokenizer.tokens,s=[],a=0,o=i.length===r.length;for(let l=0;l<i.length;l++){let n=i[l].index,h=String.fromCharCode(i[l].unicode),c=r[a];if(kG(n,c)||o)s.push({char:h,index:n,replacements:[c.state.glyphIndex],replacementChars:[c.char]}),a++;else{let i=c.char,r="",o=[c.state.glyphIndex],l=[],u=!1;for(;!u;)a++,r=e.charAt(a),i+=r,o.push(t.charToGlyphIndex(r)),l=t.stringToGlyphs(i),1===l.length&&l[0].index===n&&(u=!0),a>e.length&&(u=!0);s.push({char:h,index:n,replacements:o,replacementChars:Array.from(i)}),a++}}return s}generateShapes(t,e){if(!this._isLoaded)return;let i,n=this.font,r=e.fontSize/this.unitsPerEm,s=e.fontSize*e.lineHeight,a=t.map((t=>this.getTextWidth(t,e))),o=e.width,l=this.getCharWidth("\n",e),h=1===e.horizontalAlign?l:0,c=this.computeSpaceWidthForLine(t,0,e),u=this.getLineInitialOffsetX(a[0],o,e.horizontalAlign,t[0],l),d=this.getLineInitialOffsetY(s,t.length,e.height,r,e.verticalAlign),p=[],f=t.map((t=>[])),m=t.map((t=>[]));for(let y=0;y<t.length;y++){let g=t[y],b={features:{liga:!0}},x=[];try{x=n.stringToGlyphs(g,b)}catch(v){console.warn(v)}u=this.getLineInitialOffsetX(a[y],o,e.horizontalAlign,g,l);let w=[];try{w=this.reverseLigaturesTable(n,g,x)}catch(v){console.warn(v)}c=this.computeSpaceWidthForLine(t,y,e);for(let t=0;t<x.length;t++){let s=x[t],a=0===s.index?"\n":s.unicode?String.fromCharCode(s.unicode):void 0,o=w[t],l=0,g=0;0===t&&2===e.horizontalAlign&&void 0!==s.leftSideBearing&&(g=-s.leftSideBearing*r),i&&(l=n.getKerningValue(s,i)*r),u+=g+l;let v=0;if("\n"===a)v=h;else if(" "===a)v=c;else{let t=this.createPath(s,r,u,d,e);t&&(v=t.offsetX-(l+g),p.push(t.path))}if(1===o.replacements.length)m[y].push([u,d]),f[y].push(v);else{let t=o.replacements.map((t=>(n.glyphs.get(t).advanceWidth??0)*r)),e=t.reduce(((t,e)=>t+e),0),i=t.map((t=>t/e)),s=u;for(let n=0;n<i.length;n++){let t=v*i[n];m[y].push([s,d]),f[y].push(t),s+=t}}u+=v,i=s}d-=s}let g=[];for(let y=0,b=p.length;y<b;y++)g.push(...p[y].toShapes());return{shapes:g,charWidths:f,lineWidths:a,charCoords:m}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){return this.font?.ascender??0}get descender(){return this.font?.descender??0}get familyName(){return this.font?.names.fontFamily??""}get subfamilyName(){return this.font?.names.fontSubfamily??""}get unitsPerEm(){return this.font?.unitsPerEm??1}getLineInitialOffsetX(t,e,i,n,r){return(3===i||2===i)&&n.indexOf("\n")>=0&&(t-=r),3===i?.5*e-.5*t:2===i?e-t:0}getLineInitialOffsetY(t,e,i,n,r){let s=e*t,a=t-Math.abs(this.ascender-this.descender)*n,o=-this.ascender*n-a/2;return 3===r?-(i-s-o):2===r?-(.5*i-.5*s-o):o}createPath(t,e,i,n,r){let s=t.getPath(i,-n,r.fontSize,{kerning:!1,letterSpacing:r.letterSpacing});if(!s)return void console.error('THREE.Font: character "'+t+'" does not exists in font family '+this.familyName+".");let a=new EG,o=(t.advanceWidth??1)*e;if(t)for(let l of s.commands){let t=a.currentPath?.currentPoint;if(!t||"Z"===l.type||t.x!==l.x||-t.y!==l.y)switch(l.type){case"M":a.moveTo(l.x,-l.y);break;case"L":a.lineTo(l.x,-l.y);break;case"Q":a.quadraticCurveTo(l.x1,-l.y1,l.x,-l.y);break;case"C":a.bezierCurveTo(l.x1,-l.y1,l.x2,-l.y2,l.x,-l.y)}}return a.subPaths.forEach((t=>{let e=function(t){if(t.length){let e=t[0];if(e instanceof Wx)return e.v1;if(e instanceof Gx||e instanceof Yx)return e.v0}}(t.curves);void 0!==e&&t.currentPoint.distanceTo(e)>0&&t.lineTo(e.x,e.y)})),{offsetX:o+r.fontSize*r.letterSpacing,path:a}}getCharWidth(t,e){return this.font?.getAdvanceWidth(t,e.fontSize,{kerning:!0,letterSpacing:e.letterSpacing})??0}getTextWidth(t,e){return this.font?.getAdvanceWidth(t,e.fontSize,{kerning:!0,letterSpacing:e.letterSpacing})??0}computeSpaceWidthForLine(t,e,i){let n=this.getCharWidth(" ",i),r=t[e];if(r){let s=this.countSpaces(r.trimEnd());if(4===i.horizontalAlign&&e<t.length-1&&s){return(i.width-(this.getTextWidth(r,i)-s*n))/s}}return n}countSpaces(t){return(t.match(/ /g)||[]).length}};var RG=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(t){return this.objects.get(t)}get size(){return this.objects.size}get(t,e,i){let n=this.objects.get(t);return void 0===n?(n=this.createObject(t,e,i),this.objects.set(t,n)):n.isShared=!0,n}forceDelete(t){let e=this.objects.get(t);e&&(this.disposeObject(e),this.objects.delete(t))}mutateIfUnique(t,e){let i=this.objects.get(t);if(i&&!0!==i.isShared)return this.objects.delete(t),this.objects.set(e,i),i}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(t,e){e===this.objects.get(t)&&this.unreachable.delete(t)}endGc(){this.unreachable.forEach((t=>{this.disposeObject(this.objects.get(t)),this.objects.delete(t)})),this.unreachable.clear()}dispose(){this.objects.forEach((t=>{this.disposeObject(t)})),this.objects.clear()}},OG=class extends RG{constructor(t){super(),this.flatShading=t}disposeObject(t){t.dispose()}createObject(t,e,i){let n=UN(t,e,this.flatShading,i);return n.computeBoundingSphere(),n}},LG={markNeedsUpdateRendererDirty:()=>{}},BG=1e3,zG=512e3;var FG="https://hooks.spline.design",NG=`${FG}/events?hashFile=`,UG=class{constructor(t,e){this.id=t,this.userWebhook=e,this.result=void 0,this._connected=!1,this.emitter=vN(),this.reconnectWaitFor=BG,this._onError=t=>{this.eventSource?.removeEventListener("message",this._onMessage),this.eventSource?.removeEventListener("error",this._onError),this.eventSource?.removeEventListener("open",this._onConnected),this._scheduleReconnect()},this._onConnected=t=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=BG,this._connected=!0},this._onDisconnected=()=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=BG,this._connected=!1},this._onMessage=t=>{let e,i=t.data;try{e=JSON.parse(i)}catch(TI){console.error("Error parsing webhook message",TI)}if(e){let t=!1;this.userWebhook.parametersSchemas.forEach((i=>{let{data:n}=i;void 0!==e[n.name]&&function(t,e){let i=typeof t;return!!(("string"===e||"number"===e)&&i===e||"boolean"===e&&("true"===t||"false"===t||!0===t||!1===t)||"image"===e&&"string"===i&&t.startsWith("http"))}(e[n.name],n.type)&&(void 0===this.result&&(this.result={}),this.result[n.name]=e[n.name],t=!0)})),t&&this.emitter.emit("message",{userWebhookId:this.id})}}}connect(){clearTimeout(this.scheduledReconnectHandle),this.userWebhook.url&&(this.eventSource=new EventSource(NG+this.userWebhook.url),this.eventSource.addEventListener("message",this._onMessage),this.eventSource.addEventListener("error",this._onError),this.eventSource.addEventListener("open",this._onConnected))}disconnect(){this.eventSource?.removeEventListener("message",this._onMessage),this.eventSource?.removeEventListener("error",this._onError),this.eventSource?.removeEventListener("open",this._onConnected),this.eventSource?.close(),this._onDisconnected(),clearTimeout(this.scheduledReconnectHandle)}_scheduleReconnect(){this.reconnectWaitFor*=2,this.reconnectWaitFor>zG&&(this.reconnectWaitFor=zG),clearTimeout(this.scheduledReconnectHandle),this.scheduledReconnectHandle=setTimeout((()=>{this.scheduledReconnectHandle=void 0,this.connect()}),this.reconnectWaitFor)}update(t){this.userWebhook=t}dispose(){this._connected&&this.disconnect()}get connected(){return this._connected}on(t,e){this.emitter.on(t,e)}off(t,e){this.emitter.off(t,e)}getParametersKeys(){return this.userWebhook.parametersSchemas.map((t=>t.data.name))}getParameterValue(t){if(this.getParametersKeys().includes(t)){if(this.result)return this.result?.[t];for(let e of this.userWebhook.parametersSchemas)if(e.data.name===t)return eO.defaultParameterValueByType(e.data.type)}}},VG=globalThis.atob,jG=globalThis.btoa,GG=class{static floatTo16BitPCM(t){let e=new ArrayBuffer(2*t.length),i=new DataView(e),n=0;for(let r=0;r<t.length;r++,n+=2){let e=Math.max(-1,Math.min(1,t[r]));i.setInt16(n,e<0?32768*e:32767*e,!0)}return e}static base64ToArrayBuffer(t){let e=VG(t),i=e.length,n=new Uint8Array(i);for(let r=0;r<i;r++)n[r]=e.charCodeAt(r);return n.buffer}static arrayBufferToBase64(t){t instanceof Float32Array?t=this.floatTo16BitPCM(t):t instanceof Int16Array&&(t=t.buffer);let e="",i=new Uint8Array(t);for(let n=0;n<i.length;n+=32768){let t=i.subarray(n,n+32768);e+=String.fromCharCode.apply(null,t)}return jG(e)}static mergeInt16Arrays(t,e){if(t instanceof ArrayBuffer&&(t=new Int16Array(t)),e instanceof ArrayBuffer&&(e=new Int16Array(e)),!(t instanceof Int16Array)||!(e instanceof Int16Array))throw new Error("Both items must be Int16Array");let i=new Int16Array(t.length+e.length);for(let n=0;n<t.length;n++)i[n]=t[n];for(let n=0;n<e.length;n++)i[t.length+n]=e[n];return i}static generateId(t){let e="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";return`${t}${Array((arguments.length>1&&void 0!==arguments[1]?arguments[1]:21)-t.length).fill(0).map((t=>e[Math.floor(58*Math.random())])).join("")}`}},HG=t=>new Promise((e=>setTimeout((()=>e()),t))),WG=class{constructor(){this.eventHandlers={},this.nextEventHandlers={}}clearEventHandlers(){return this.eventHandlers={},this.nextEventHandlers={},!0}on(t,e){return this.eventHandlers[t]=this.eventHandlers[t]||[],this.eventHandlers[t].push(e),e}onNext(t,e){return this.nextEventHandlers[t]=this.nextEventHandlers[t]||[],this.nextEventHandlers[t].push(e),e}off(t,e){let i=this.eventHandlers[t]||[];if(e){let n=i.indexOf(e);if(-1===n)throw new Error(`Could not turn off specified event listener for "${t}": not found as a listener`);i.splice(n,1)}else delete this.eventHandlers[t];return!0}offNext(t,e){let i=this.nextEventHandlers[t]||[];if(e){let n=i.indexOf(e);if(-1===n)throw new Error(`Could not turn off specified next event listener for "${t}": not found as a listener`);i.splice(n,1)}else delete this.nextEventHandlers[t];return!0}async waitForNext(t){let e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=Date.now();for(this.onNext(t,(t=>e=t));!e;){if(i&&Date.now()-n>i)return null;await HG(1)}return e}dispatch(t,e){let i=[].concat(this.eventHandlers[t]||[]);for(let r of i)r(e);let n=[].concat(this.nextEventHandlers[t]||[]);for(let r of n)r(e);return delete this.nextEventHandlers[t],!0}},qG=class extends WG{constructor(){let{url:t,apiKey:e,dangerouslyAllowAPIKeyInBrowser:i,debug:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(super(),this.defaultUrl="wss://api.openai.com/v1/realtime",this.url=t||this.defaultUrl,this.apiKey=e||null,this.debug=!!n,this.ws=null,globalThis.document&&this.apiKey&&!i)throw new Error('Can not provide API key in the browser without "dangerouslyAllowAPIKeyInBrowser" set to true')}isConnected(){return!!this.ws}log(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];let n=[`[Websocket/${(new Date).toISOString()}]`].concat(e).map((t=>"object"==typeof t&&null!==t?JSON.stringify(t,null,2):t));return this.debug&&console.log(...n),!0}async connect(){let{model:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{model:"gpt-4o-realtime-preview-2024-10-01"};if(!this.apiKey&&this.url===this.defaultUrl&&console.warn(`No apiKey provided for connection to "${this.url}"`),this.isConnected())throw new Error("Already connected");if(globalThis.document){this.apiKey&&console.warn("Warning: Connecting using API key in the browser, this is not recommended");let e=new(0,globalThis.WebSocket)(`${this.url}${t?`?model=${t}`:""}`,["realtime",`openai-insecure-api-key.${this.apiKey}`,"openai-beta.realtime-v1"]);return e.addEventListener("message",(t=>{let e=JSON.parse(t.data);this.receive(e.type,e)})),new Promise(((t,i)=>{let n=()=>{this.disconnect(e),i(new Error(`Could not connect to "${this.url}"`))};e.addEventListener("error",n),e.addEventListener("open",(()=>{this.log(`Connected to "${this.url}"`),e.removeEventListener("error",n),e.addEventListener("error",(()=>{this.disconnect(e),this.log(`Error, disconnected from "${this.url}"`),this.dispatch("close",{error:!0})})),e.addEventListener("close",(()=>{this.disconnect(e),this.log(`Disconnected from "${this.url}"`),this.dispatch("close",{error:!1})})),this.ws=e,t(!0)}))}))}}disconnect(t){if(!t||this.ws===t)return this.ws&&this.ws.close(),this.ws=null,!0}receive(t,e){return this.log("received:",t,e),this.dispatch(`server.${t}`,e),this.dispatch("server.*",e),!0}send(t,e){if(!this.isConnected())throw new Error("RealtimeAPI is not connected");if("object"!=typeof(e=e||{}))throw new Error("data must be an object");let i={event_id:GG.generateId("evt_"),type:t,...e};return this.dispatch(`client.${t}`,i),this.dispatch("client.*",i),this.log("sent:",t,i),this.ws.send(JSON.stringify(i)),!0}},YG=class{constructor(){rp(this,"defaultFrequency",24e3),rp(this,"EventProcessors",{"conversation.item.created":t=>{let{item:e}=t,i=JSON.parse(JSON.stringify(e));if(this.itemLookup[i.id]||(this.itemLookup[i.id]=i,this.items.push(i)),i.formatted={},i.formatted.audio=new Int16Array(0),i.formatted.text="",i.formatted.transcript="",this.queuedSpeechItems[i.id]&&(i.formatted.audio=this.queuedSpeechItems[i.id].audio,delete this.queuedSpeechItems[i.id]),i.content){let t=i.content.filter((t=>["text","input_text"].includes(t.type)));for(let e of t)i.formatted.text+=e.text}return this.queuedTranscriptItems[i.id]&&(i.formatted.transcript=this.queuedTranscriptItems.transcript,delete this.queuedTranscriptItems[i.id]),"message"===i.type?"user"===i.role?(i.status="completed",this.queuedInputAudio&&(i.formatted.audio=this.queuedInputAudio,this.queuedInputAudio=null)):i.status="in_progress":"function_call"===i.type?(i.formatted.tool={type:"function",name:i.name,call_id:i.call_id,arguments:""},i.status="in_progress"):"function_call_output"===i.type&&(i.status="completed",i.formatted.output=i.output),{item:i,delta:null}},"conversation.item.truncated":t=>{let{item_id:e,audio_end_ms:i}=t,n=this.itemLookup[e];if(!n)throw new Error(`item.truncated: Item "${e}" not found`);let r=Math.floor(i*this.defaultFrequency/1e3);return n.formatted.transcript="",n.formatted.audio=n.formatted.audio.slice(0,r),{item:n,delta:null}},"conversation.item.deleted":t=>{let{item_id:e}=t,i=this.itemLookup[e];if(!i)throw new Error(`item.deleted: Item "${e}" not found`);delete this.itemLookup[i.id];let n=this.items.indexOf(i);return n>-1&&this.items.splice(n,1),{item:i,delta:null}},"conversation.item.input_audio_transcription.completed":t=>{let{item_id:e,content_index:i,transcript:n}=t,r=this.itemLookup[e],s=n||" ";return r?(r.content[i].transcript=n,r.formatted.transcript=s,{item:r,delta:{transcript:n}}):(this.queuedTranscriptItems[e]={transcript:s},{item:null,delta:null})},"input_audio_buffer.speech_started":t=>{let{item_id:e,audio_start_ms:i}=t;return this.queuedSpeechItems[e]={audio_start_ms:i},{item:null,delta:null}},"input_audio_buffer.speech_stopped":(t,e)=>{let{item_id:i,audio_end_ms:n}=t;this.queuedSpeechItems[i]||(this.queuedSpeechItems[i]={audio_start_ms:n});let r=this.queuedSpeechItems[i];if(r.audio_end_ms=n,e){let t=Math.floor(r.audio_start_ms*this.defaultFrequency/1e3),i=Math.floor(r.audio_end_ms*this.defaultFrequency/1e3);r.audio=e.slice(t,i)}return{item:null,delta:null}},"response.created":t=>{let{response:e}=t;return this.responseLookup[e.id]||(this.responseLookup[e.id]=e,this.responses.push(e)),{item:null,delta:null}},"response.output_item.added":t=>{let{response_id:e,item:i}=t,n=this.responseLookup[e];if(!n)throw new Error(`response.output_item.added: Response "${e}" not found`);return n.output.push(i.id),{item:null,delta:null}},"response.output_item.done":t=>{let{item:e}=t;if(!e)throw new Error('response.output_item.done: Missing "item"');let i=this.itemLookup[e.id];if(!i)throw new Error(`response.output_item.done: Item "${e.id}" not found`);return i.status=e.status,{item:i,delta:null}},"response.content_part.added":t=>{let{item_id:e,part:i}=t,n=this.itemLookup[e];if(!n)throw new Error(`response.content_part.added: Item "${e}" not found`);return n.content.push(i),{item:n,delta:null}},"response.audio_transcript.delta":t=>{let{item_id:e,content_index:i,delta:n}=t,r=this.itemLookup[e];if(!r)throw new Error(`response.audio_transcript.delta: Item "${e}" not found`);return r.content[i].transcript+=n,r.formatted.transcript+=n,{item:r,delta:{transcript:n}}},"response.audio.delta":t=>{let{item_id:e,content_index:i,delta:n}=t,r=this.itemLookup[e];if(!r)throw new Error(`response.audio.delta: Item "${e}" not found`);let s=GG.base64ToArrayBuffer(n),a=new Int16Array(s);return r.formatted.audio=GG.mergeInt16Arrays(r.formatted.audio,a),{item:r,delta:{audio:a}}},"response.text.delta":t=>{let{item_id:e,content_index:i,delta:n}=t,r=this.itemLookup[e];if(!r)throw new Error(`response.text.delta: Item "${e}" not found`);return r.content[i].text+=n,r.formatted.text+=n,{item:r,delta:{text:n}}},"response.function_call_arguments.delta":t=>{let{item_id:e,delta:i}=t,n=this.itemLookup[e];if(!n)throw new Error(`response.function_call_arguments.delta: Item "${e}" not found`);return n.arguments+=i,n.formatted.tool.arguments+=i,{item:n,delta:{arguments:i}}}}),this.clear()}clear(){return this.itemLookup={},this.items=[],this.responseLookup={},this.responses=[],this.queuedSpeechItems={},this.queuedTranscriptItems={},this.queuedInputAudio=null,!0}queueInputAudio(t){return this.queuedInputAudio=t,t}processEvent(t){if(!t.event_id)throw console.error(t),new Error('Missing "event_id" on event');if(!t.type)throw console.error(t),new Error('Missing "type" on event');let e=this.EventProcessors[t.type];if(!e)throw new Error(`Missing conversation event processor for "${t.type}"`);for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return e.call(this,t,...n)}getItem(t){return this.itemLookup[t]||null}getItems(){return this.items.slice()}},XG=class extends WG{constructor(){let{url:t,apiKey:e,dangerouslyAllowAPIKeyInBrowser:i,debug:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.defaultSessionConfig={modalities:["text","audio"],instructions:"",voice:"alloy",input_audio_format:"pcm16",output_audio_format:"pcm16",input_audio_transcription:null,turn_detection:null,tools:[],tool_choice:"auto",temperature:.8,max_response_output_tokens:4096},this.sessionConfig={},this.transcriptionModels=[{model:"whisper-1"}],this.defaultServerVadConfig={type:"server_vad",threshold:.5,prefix_padding_ms:300,silence_duration_ms:200},this.realtime=new qG({url:t,apiKey:e,dangerouslyAllowAPIKeyInBrowser:i,debug:n}),this.conversation=new YG,this._resetConfig(),this._addAPIEventHandlers()}_resetConfig(){return this.sessionCreated=!1,this.tools={},this.sessionConfig=JSON.parse(JSON.stringify(this.defaultSessionConfig)),this.inputAudioBuffer=new Int16Array(0),!0}_addAPIEventHandlers(){var t=this;this.realtime.on("client.*",(t=>{let e={time:(new Date).toISOString(),source:"client",event:t};this.dispatch("realtime.event",e)})),this.realtime.on("server.*",(t=>{let e={time:(new Date).toISOString(),source:"server",event:t};this.dispatch("realtime.event",e)})),this.realtime.on("server.session.created",(()=>this.sessionCreated=!0));let e=function(e){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];let{item:s,delta:a}=t.conversation.processEvent(e,...n);return{item:s,delta:a}},i=function(i){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];let{item:a,delta:o}=e(i,...r);return a&&t.dispatch("conversation.updated",{item:a,delta:o}),{item:a,delta:o}},n=async t=>{try{let e=JSON.parse(t.arguments),i=this.tools[t.name];if(!i)throw new Error(`Tool "${t.name}" has not been added`);let n=await i.handler(e);this.realtime.send("conversation.item.create",{item:{type:"function_call_output",call_id:t.call_id,output:JSON.stringify(n)}})}catch(FI){this.realtime.send("conversation.item.create",{item:{type:"function_call_output",call_id:t.call_id,output:JSON.stringify({error:FI.message})}})}this.createResponse()};return this.realtime.on("server.response.created",e),this.realtime.on("server.response.output_item.added",e),this.realtime.on("server.response.content_part.added",e),this.realtime.on("server.input_audio_buffer.speech_started",(t=>{e(t),this.dispatch("conversation.interrupted")})),this.realtime.on("server.input_audio_buffer.speech_stopped",(t=>e(t,this.inputAudioBuffer))),this.realtime.on("server.conversation.item.created",(t=>{let{item:e}=i(t);this.dispatch("conversation.item.appended",{item:e}),"completed"===e.status&&this.dispatch("conversation.item.completed",{item:e})})),this.realtime.on("server.conversation.item.truncated",i),this.realtime.on("server.conversation.item.deleted",i),this.realtime.on("server.conversation.item.input_audio_transcription.completed",i),this.realtime.on("server.response.audio_transcript.delta",i),this.realtime.on("server.response.audio.delta",i),this.realtime.on("server.response.text.delta",i),this.realtime.on("server.response.function_call_arguments.delta",i),this.realtime.on("server.response.output_item.done",(async t=>{let{item:e}=i(t);"completed"===e.status&&this.dispatch("conversation.item.completed",{item:e}),e.formatted.tool&&n(e.formatted.tool)})),!0}isConnected(){return this.realtime.isConnected()}reset(){return this.disconnect(),this.clearEventHandlers(),this.realtime.clearEventHandlers(),this._resetConfig(),this._addAPIEventHandlers(),!0}async connect(){if(this.isConnected())throw new Error("Already connected, use .disconnect() first");return await this.realtime.connect(),this.updateSession(),!0}async waitForSessionCreated(){if(!this.isConnected())throw new Error("Not connected, use .connect() first");for(;!this.sessionCreated;)await new Promise((t=>setTimeout((()=>t()),1)));return!0}disconnect(){this.sessionCreated=!1,this.realtime.isConnected()&&this.realtime.disconnect(),this.conversation.clear()}getTurnDetectionType(){return this.sessionConfig.turn_detection?.type||null}addTool(t,e){if(!t?.name)throw new Error("Missing tool name in definition");let i=t?.name;if(this.tools[i])throw new Error(`Tool "${i}" already added. Please use .removeTool("${i}") before trying to add again.`);if("function"!=typeof e)throw new Error(`Tool "${i}" handler must be a function`);return this.tools[i]={definition:t,handler:e},this.updateSession(),this.tools[i]}removeTool(t){if(!this.tools[t])throw new Error(`Tool "${t}" does not exist, can not be removed.`);return delete this.tools[t],!0}deleteItem(t){return this.realtime.send("conversation.item.delete",{item_id:t}),!0}updateSession(){let{modalities:t,instructions:e,voice:i,input_audio_format:n,output_audio_format:r,input_audio_transcription:s,turn_detection:a,tools:o,tool_choice:l,temperature:h,max_response_output_tokens:c}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};void 0!==t&&(this.sessionConfig.modalities=t),void 0!==e&&(this.sessionConfig.instructions=e),void 0!==i&&(this.sessionConfig.voice=i),void 0!==n&&(this.sessionConfig.input_audio_format=n),void 0!==r&&(this.sessionConfig.output_audio_format=r),void 0!==s&&(this.sessionConfig.input_audio_transcription=s),void 0!==a&&(this.sessionConfig.turn_detection=a),void 0!==o&&(this.sessionConfig.tools=o),void 0!==l&&(this.sessionConfig.tool_choice=l),void 0!==h&&(this.sessionConfig.temperature=h),void 0!==c&&(this.sessionConfig.max_response_output_tokens=c);let u=[].concat((o||[]).map((t=>{let e={type:"function",...t};if(this.tools[e?.name])throw new Error(`Tool "${e?.name}" has already been defined`);return e})),Object.keys(this.tools).map((t=>({type:"function",...this.tools[t].definition})))),d={...this.sessionConfig};return d.tools=u,this.realtime.isConnected()&&this.realtime.send("session.update",{session:d}),!0}sendUserMessageContent(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(t.length){for(let e of t)"input_audio"===e.type&&(e.audio instanceof ArrayBuffer||e.audio instanceof Int16Array)&&(e.audio=GG.arrayBufferToBase64(e.audio));this.realtime.send("conversation.item.create",{item:{type:"message",role:"user",content:t}})}return this.createResponse(),!0}appendInputAudio(t){return t.byteLength>0&&(this.realtime.send("input_audio_buffer.append",{audio:GG.arrayBufferToBase64(t)}),this.inputAudioBuffer=GG.mergeInt16Arrays(this.inputAudioBuffer,t)),!0}createResponse(){return null===this.getTurnDetectionType()&&this.inputAudioBuffer.byteLength>0&&(this.realtime.send("input_audio_buffer.commit"),this.conversation.queueInputAudio(this.inputAudioBuffer),this.inputAudioBuffer=new Int16Array(0)),this.realtime.send("response.create"),!0}cancelResponse(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!t)return this.realtime.send("response.cancel"),{item:null};if(t){let i=this.conversation.getItem(t);if(!i)throw new Error(`Could not find item "${t}"`);if("message"!==i.type)throw new Error('Can only cancelResponse messages with type "message"');if("assistant"!==i.role)throw new Error('Can only cancelResponse messages with role "assistant"');this.realtime.send("response.cancel");let n=i.content.findIndex((t=>"audio"===t.type));if(-1===n)throw new Error("Could not find audio on item to cancel");return this.realtime.send("conversation.item.truncate",{item_id:t,content_index:n,audio_end_ms:Math.floor(e/this.conversation.defaultFrequency*1e3)}),{item:i}}}async waitForNextItem(){let t=await this.waitForNext("conversation.item.appended"),{item:e}=t;return{item:e}}async waitForNextCompletedItem(){let t=await this.waitForNext("conversation.item.completed"),{item:e}=t;return{item:e}}},QG=new Blob(["\nclass AudioProcessor extends AudioWorkletProcessor {\n\n  constructor() {\n    super();\n    this.port.onmessage = this.receive.bind(this);\n    this.initialize();\n  }\n\n  initialize() {\n    this.foundAudio = false;\n    this.recording = false;\n    this.chunks = [];\n  }\n\n  /**\n   * Concatenates sampled chunks into channels\n   * Format is chunk[Left[], Right[]]\n   */\n  readChannelData(chunks, channel = -1, maxChannels = 9) {\n    let channelLimit;\n    if (channel !== -1) {\n      if (chunks[0] && chunks[0].length - 1 < channel) {\n        throw new Error(\n          `Channel ${channel} out of range: max ${chunks[0].length}`\n        );\n      }\n      channelLimit = channel + 1;\n    } else {\n      channel = 0;\n      channelLimit = Math.min(chunks[0] ? chunks[0].length : 1, maxChannels);\n    }\n    const channels = [];\n    for (let n = channel; n < channelLimit; n++) {\n      const length = chunks.reduce((sum, chunk) => {\n        return sum + chunk[n].length;\n      }, 0);\n      const buffers = chunks.map((chunk) => chunk[n]);\n      const result = new Float32Array(length);\n      let offset = 0;\n      for (let i = 0; i < buffers.length; i++) {\n        result.set(buffers[i], offset);\n        offset += buffers[i].length;\n      }\n      channels[n] = result;\n    }\n    return channels;\n  }\n\n  /**\n   * Combines parallel audio data into correct format,\n   * channels[Left[], Right[]] to float32Array[LRLRLRLR...]\n   */\n  formatAudioData(channels) {\n    if (channels.length === 1) {\n      // Simple case is only one channel\n      const float32Array = channels[0].slice();\n      const meanValues = channels[0].slice();\n      return { float32Array, meanValues };\n    } else {\n      const float32Array = new Float32Array(\n        channels[0].length * channels.length\n      );\n      const meanValues = new Float32Array(channels[0].length);\n      for (let i = 0; i < channels[0].length; i++) {\n        const offset = i * channels.length;\n        let meanValue = 0;\n        for (let n = 0; n < channels.length; n++) {\n          float32Array[offset + n] = channels[n][i];\n          meanValue += channels[n][i];\n        }\n        meanValues[i] = meanValue / channels.length;\n      }\n      return { float32Array, meanValues };\n    }\n  }\n\n  /**\n   * Converts 32-bit float data to 16-bit integers\n   */\n  floatTo16BitPCM(float32Array) {\n    const buffer = new ArrayBuffer(float32Array.length * 2);\n    const view = new DataView(buffer);\n    let offset = 0;\n    for (let i = 0; i < float32Array.length; i++, offset += 2) {\n      let s = Math.max(-1, Math.min(1, float32Array[i]));\n      view.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7fff, true);\n    }\n    return buffer;\n  }\n\n  /**\n   * Retrieves the most recent amplitude values from the audio stream\n   * @param {number} channel\n   */\n  getValues(channel = -1) {\n    const channels = this.readChannelData(this.chunks, channel);\n    const { meanValues } = this.formatAudioData(channels);\n    return { meanValues, channels };\n  }\n\n  /**\n   * Exports chunks as an audio/wav file\n   */\n  export() {\n    const channels = this.readChannelData(this.chunks);\n    const { float32Array, meanValues } = this.formatAudioData(channels);\n    const audioData = this.floatTo16BitPCM(float32Array);\n    return {\n      meanValues: meanValues,\n      audio: {\n        bitsPerSample: 16,\n        channels: channels,\n        data: audioData,\n      },\n    };\n  }\n\n  receive(e) {\n    const { event, id } = e.data;\n    let receiptData = {};\n    switch (event) {\n      case 'start':\n        this.recording = true;\n        break;\n      case 'stop':\n        this.recording = false;\n        break;\n      case 'clear':\n        this.initialize();\n        break;\n      case 'export':\n        receiptData = this.export();\n        break;\n      case 'read':\n        receiptData = this.getValues();\n        break;\n      default:\n        break;\n    }\n    // Always send back receipt\n    this.port.postMessage({ event: 'receipt', id, data: receiptData });\n  }\n\n  sendChunk(chunk) {\n    const channels = this.readChannelData([chunk]);\n    const { float32Array, meanValues } = this.formatAudioData(channels);\n    const rawAudioData = this.floatTo16BitPCM(float32Array);\n    const monoAudioData = this.floatTo16BitPCM(meanValues);\n    this.port.postMessage({\n      event: 'chunk',\n      data: {\n        mono: monoAudioData,\n        raw: rawAudioData,\n      },\n    });\n  }\n\n  process(inputList, outputList, parameters) {\n    // Copy input to output (e.g. speakers)\n    // Note that this creates choppy sounds with Mac products\n    const sourceLimit = Math.min(inputList.length, outputList.length);\n    for (let inputNum = 0; inputNum < sourceLimit; inputNum++) {\n      const input = inputList[inputNum];\n      const output = outputList[inputNum];\n      const channelCount = Math.min(input.length, output.length);\n      for (let channelNum = 0; channelNum < channelCount; channelNum++) {\n        input[channelNum].forEach((sample, i) => {\n          output[channelNum][i] = sample;\n        });\n      }\n    }\n    const inputs = inputList[0];\n    // There's latency at the beginning of a stream before recording starts\n    // Make sure we actually receive audio data before we start storing chunks\n    let sliceIndex = 0;\n    if (!this.foundAudio) {\n      for (const channel of inputs) {\n        sliceIndex = 0; // reset for each channel\n        if (this.foundAudio) {\n          break;\n        }\n        if (channel) {\n          for (const value of channel) {\n            if (value !== 0) {\n              // find only one non-zero entry in any channel\n              this.foundAudio = true;\n              break;\n            } else {\n              sliceIndex++;\n            }\n          }\n        }\n      }\n    }\n    if (inputs && inputs[0] && this.foundAudio && this.recording) {\n      // We need to copy the TypedArray, because the `process`\n      // internals will reuse the same buffer to hold each input\n      const chunk = inputs.map((input) => input.slice(sliceIndex));\n      this.chunks.push(chunk);\n      this.sendChunk(chunk);\n    }\n    return true;\n  }\n}\n\nregisterProcessor('audio_processor', AudioProcessor);\n"],{type:"application/javascript"}),KG=URL.createObjectURL(QG),ZG=[4186.01,4434.92,4698.63,4978.03,5274.04,5587.65,5919.91,6271.93,6644.88,7040,7458.62,7902.13],JG=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],$G=[],tH=[];for(let $2=1;$2<=8;$2++)for(let t=0;t<ZG.length;t++){let e=ZG[t];$G.push(e/Math.pow(2,8-$2)),tH.push(JG[t]+$2)}var eH=[32,2e3],iH=$G.filter(((t,e)=>$G[e]>eH[0]&&$G[e]<eH[1])),nH=tH.filter(((t,e)=>$G[e]>eH[0]&&$G[e]<eH[1])),rH=class{static getFrequencies(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"frequency",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-100,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-30;i||(i=new Float32Array(t.frequencyBinCount),t.getFloatFrequencyData(i));let a,o,l,h=e/2,c=1/i.length*h;if("music"===n||"voice"===n){let t="voice"===n?iH:$G,e=Array(t.length).fill(r);for(let n=0;n<i.length;n++){let r=n*c,s=i[n];for(let i=t.length-1;i>=0;i--)if(r>t[i]){e[i]=Math.max(e[i],s);break}}a=e,o="voice"===n?iH:$G,l="voice"===n?nH:tH}else a=Array.from(i),o=a.map(((t,e)=>c*e)),l=o.map((t=>`${t.toFixed(2)} Hz`));let u=a.map((t=>Math.max(0,Math.min((t-r)/(s-r),1))));return{values:new Float32Array(u),frequencies:o,labels:l}}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.fftResults=[],e){let{length:i,sampleRate:n}=e,r=new OfflineAudioContext({length:i,sampleRate:n}),s=r.createBufferSource();s.buffer=e;let a=r.createAnalyser();a.fftSize=8192,a.smoothingTimeConstant=.1,s.connect(a);let o=1/60,l=i/n,h=t=>{let e=o*t;e<l&&r.suspend(e).then((()=>{let e=new Float32Array(a.frequencyBinCount);a.getFloatFrequencyData(e),this.fftResults.push(e),h(t+1)})),1===t?r.startRendering():r.resume()};s.start(0),h(1),this.audio=t,this.context=r,this.analyser=a,this.sampleRate=n,this.audioBuffer=e}else{let e=new AudioContext,i=e.createMediaElementSource(t),n=e.createAnalyser();n.fftSize=8192,n.smoothingTimeConstant=.1,i.connect(n),n.connect(e.destination),this.audio=t,this.context=e,this.analyser=n,this.sampleRate=this.context.sampleRate,this.audioBuffer=null}}getFrequencies(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"frequency",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-100,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-30,n=null;if(this.audioBuffer&&this.fftResults.length){let t=this.audio.currentTime/this.audio.duration,e=Math.min(t*this.fftResults.length|0,this.fftResults.length-1);n=this.fftResults[e]}return rH.getFrequencies(this.analyser,this.sampleRate,n,t,e,i)}async resumeIfSuspended(){return"suspended"===this.context.state&&await this.context.resume(),!0}},sH=class{static floatTo16BitPCM(t){let e=new ArrayBuffer(2*t.length),i=new DataView(e),n=0;for(let r=0;r<t.length;r++,n+=2){let e=Math.max(-1,Math.min(1,t[r]));i.setInt16(n,e<0?32768*e:32767*e,!0)}return e}static mergeBuffers(t,e){let i=new Uint8Array(t.byteLength+e.byteLength);return i.set(new Uint8Array(t),0),i.set(new Uint8Array(e),t.byteLength),i.buffer}_packData(t,e){return[new Uint8Array([e,e>>8]),new Uint8Array([e,e>>8,e>>16,e>>24])][t]}pack(t,e){if(!e?.bitsPerSample)throw new Error('Missing "bitsPerSample"');if(!e?.channels)throw new Error('Missing "channels"');if(!e?.data)throw new Error('Missing "data"');let{bitsPerSample:i,channels:n,data:r}=e,s=["RIFF",this._packData(1,52),"WAVE","fmt ",this._packData(1,16),this._packData(0,1),this._packData(0,n.length),this._packData(1,t),this._packData(1,t*n.length*i/8),this._packData(0,n.length*i/8),this._packData(0,i),"data",this._packData(1,n[0].length*n.length*i/8),r],a=new Blob(s,{type:"audio/mpeg"});return{blob:a,url:URL.createObjectURL(a),channelCount:n.length,sampleRate:t,duration:r.byteLength/(n.length*t*2)}}},aH=class{constructor(){let{sampleRate:t=44100,outputToSpeakers:e=!1,debug:i=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.scriptSrc=KG,this.sampleRate=t,this.outputToSpeakers=e,this.debug=!!i,this._deviceChangeCallback=null,this._devices=[],this.stream=null,this.processor=null,this.source=null,this.node=null,this.recording=!1,this._lastEventId=0,this.eventReceipts={},this.eventTimeout=5e3,this._chunkProcessor=()=>{},this._chunkProcessorSize=void 0,this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)}}static async decode(t){let e,i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=new AudioContext({sampleRate:arguments.length>1&&void 0!==arguments[1]?arguments[1]:44100});if(t instanceof Blob){if(-1!==n)throw new Error('Can not specify "fromSampleRate" when reading from Blob');i=t,e=await i.arrayBuffer()}else if(t instanceof ArrayBuffer){if(-1!==n)throw new Error('Can not specify "fromSampleRate" when reading from ArrayBuffer');e=t,i=new Blob([e],{type:"audio/wav"})}else{let r,s;if(t instanceof Int16Array){s=t,r=new Float32Array(t.length);for(let e=0;e<t.length;e++)r[e]=t[e]/32768}else if(t instanceof Float32Array)r=t;else{if(!(t instanceof Array))throw new Error('"audioData" must be one of: Blob, Float32Arrray, Int16Array, ArrayBuffer, Array<number>');r=new Float32Array(t)}if(-1===n)throw new Error('Must specify "fromSampleRate" when reading from Float32Array, In16Array or Array');if(n<3e3)throw new Error('Minimum "fromSampleRate" is 3000 (3kHz)');s||(s=sH.floatTo16BitPCM(r));let a={bitsPerSample:16,channels:[r],data:s};i=(new sH).pack(n,a).blob,e=await i.arrayBuffer()}let s=await r.decodeAudioData(e),a=s.getChannelData(0);return{blob:i,url:URL.createObjectURL(i),values:a,audioBuffer:s}}log(){return this.debug&&this.log(...arguments),!0}getSampleRate(){return this.sampleRate}getStatus(){return this.processor?this.recording?"recording":"paused":"ended"}async _event(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(i=i||this.processor,!i)throw new Error("Can not send events without recording first");let n={event:t,id:this._lastEventId++,data:e};i.port.postMessage(n);let r=(new Date).valueOf();for(;!this.eventReceipts[n.id];){if((new Date).valueOf()-r>this.eventTimeout)throw new Error(`Timeout waiting for "${t}" event`);await new Promise((t=>setTimeout((()=>t(!0)),1)))}let s=this.eventReceipts[n.id];return delete this.eventReceipts[n.id],s}listenForDeviceChange(t){if(null===t&&this._deviceChangeCallback)navigator.mediaDevices.removeEventListener("devicechange",this._deviceChangeCallback),this._deviceChangeCallback=null;else if(null!==t){let e=0,i=[],n=t=>t.map((t=>t.deviceId)).sort().join(","),r=async()=>{let r=++e,s=await this.listDevices();r===e&&n(i)!==n(s)&&(i=s,t(s.slice()))};navigator.mediaDevices.addEventListener("devicechange",r),r(),this._deviceChangeCallback=r}return!0}async requestPermission(){let t=await navigator.permissions.query({name:"microphone"});if("denied"===t.state)window.alert("You must grant microphone access to use this feature.");else if("prompt"===t.state)try{(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach((t=>t.stop()))}catch{window.alert("You must grant microphone access to use this feature.")}return!0}async listDevices(){if(!navigator.mediaDevices||!("enumerateDevices"in navigator.mediaDevices))throw new Error("Could not request user devices");await this.requestPermission();let t=(await navigator.mediaDevices.enumerateDevices()).filter((t=>"audioinput"===t.kind)),e=t.findIndex((t=>"default"===t.deviceId)),i=[];if(-1!==e){let n=t.splice(e,1)[0],r=t.findIndex((t=>t.groupId===n.groupId));-1!==r&&(n=t.splice(r,1)[0]),n.default=!0,i.push(n)}return i.concat(t)}async begin(t){if(this.processor)throw new Error("Already connected: please call .end() to start a new session");if(!navigator.mediaDevices||!("getUserMedia"in navigator.mediaDevices))throw new Error("Could not request user media");try{let e={audio:!0};t&&(e.audio={deviceId:{exact:t}}),this.stream=await navigator.mediaDevices.getUserMedia(e)}catch{throw new Error("Could not start media stream")}let e=new AudioContext({sampleRate:this.sampleRate}),i=e.createMediaStreamSource(this.stream);try{await e.audioWorklet.addModule(this.scriptSrc)}catch(_I){throw console.error(_I),new Error(`Could not add audioWorklet module: ${this.scriptSrc}`)}let n=new AudioWorkletNode(e,"audio_processor");n.port.onmessage=t=>{let{event:e,id:i,data:n}=t.data;if("receipt"===e)this.eventReceipts[i]=n;else if("chunk"===e)if(this._chunkProcessorSize){let t=this._chunkProcessorBuffer;this._chunkProcessorBuffer={raw:sH.mergeBuffers(t.raw,n.raw),mono:sH.mergeBuffers(t.mono,n.mono)},this._chunkProcessorBuffer.mono.byteLength>=this._chunkProcessorSize&&(this._chunkProcessor(this._chunkProcessorBuffer),this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)})}else this._chunkProcessor(n)};let r=i.connect(n),s=e.createAnalyser();return s.fftSize=8192,s.smoothingTimeConstant=.1,r.connect(s),this.outputToSpeakers&&(console.warn("Warning: Output to speakers may affect sound quality,\nespecially due to system audio feedback preventative measures.\nuse only for debugging"),s.connect(e.destination)),this.source=i,this.node=r,this.analyser=s,this.processor=n,!0}getFrequencies(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"frequency",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-100,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-30;if(!this.processor)throw new Error("Session ended: please call .begin() first");return rH.getFrequencies(this.analyser,this.sampleRate,null,t,e,i)}async pause(){if(!this.processor)throw new Error("Session ended: please call .begin() first");if(!this.recording)throw new Error("Already paused: please call .record() first");return this._chunkProcessorBuffer.raw.byteLength&&this._chunkProcessor(this._chunkProcessorBuffer),this.log("Pausing ..."),await this._event("stop"),this.recording=!1,!0}async record(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8192;if(!this.processor)throw new Error("Session ended: please call .begin() first");if(this.recording)throw new Error("Already recording: please call .pause() first");if("function"!=typeof t)throw new Error("chunkProcessor must be a function");return this._chunkProcessor=t,this._chunkProcessorSize=e,this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)},this.log("Recording ..."),await this._event("start"),this.recording=!0,!0}async clear(){if(!this.processor)throw new Error("Session ended: please call .begin() first");return await this._event("clear"),!0}async read(){if(!this.processor)throw new Error("Session ended: please call .begin() first");return this.log("Reading ..."),await this._event("read")}async save(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.processor)throw new Error("Session ended: please call .begin() first");if(!t&&this.recording)throw new Error("Currently recording: please call .pause() first, or call .save(true) to force");this.log("Exporting ...");let e=await this._event("export");return(new sH).pack(this.sampleRate,e.audio)}async end(){if(!this.processor)throw new Error("Session ended: please call .begin() first");let t=this.processor;this.log("Stopping ..."),await this._event("stop"),this.recording=!1,this.stream.getTracks().forEach((t=>t.stop())),this.log("Exporting ...");let e=await this._event("export",{},t);return this.processor.disconnect(),this.source.disconnect(),this.node.disconnect(),this.analyser.disconnect(),this.stream=null,this.processor=null,this.source=null,this.node=null,(new sH).pack(this.sampleRate,e.audio)}async quit(){return this.listenForDeviceChange(null),this.processor&&await this.end(),!0}},oH=new Blob(["\nclass StreamProcessor extends AudioWorkletProcessor {\n  constructor() {\n    super();\n    this.hasStarted = false;\n    this.hasInterrupted = false;\n    this.outputBuffers = [];\n    this.bufferLength = 128;\n    this.write = { buffer: new Float32Array(this.bufferLength), trackId: null };\n    this.writeOffset = 0;\n    this.trackSampleOffsets = {};\n    this.port.onmessage = (event) => {\n      if (event.data) {\n        const payload = event.data;\n        if (payload.event === 'write') {\n          const int16Array = payload.buffer;\n          const float32Array = new Float32Array(int16Array.length);\n          for (let i = 0; i < int16Array.length; i++) {\n            float32Array[i] = int16Array[i] / 0x8000; // Convert Int16 to Float32\n          }\n          this.writeData(float32Array, payload.trackId);\n        } else if (\n          payload.event === 'offset' ||\n          payload.event === 'interrupt'\n        ) {\n          const requestId = payload.requestId;\n          const trackId = this.write.trackId;\n          const offset = this.trackSampleOffsets[trackId] || 0;\n          this.port.postMessage({\n            event: 'offset',\n            requestId,\n            trackId,\n            offset,\n          });\n          if (payload.event === 'interrupt') {\n            this.hasInterrupted = true;\n          }\n        } else {\n          throw new Error(`Unhandled event \"${payload.event}\"`);\n        }\n      }\n    };\n  }\n\n  writeData(float32Array, trackId = null) {\n    let { buffer } = this.write;\n    let offset = this.writeOffset;\n    for (let i = 0; i < float32Array.length; i++) {\n      buffer[offset++] = float32Array[i];\n      if (offset >= buffer.length) {\n        this.outputBuffers.push(this.write);\n        this.write = { buffer: new Float32Array(this.bufferLength), trackId };\n        buffer = this.write.buffer;\n        offset = 0;\n      }\n    }\n    this.writeOffset = offset;\n    return true;\n  }\n\n  process(inputs, outputs, parameters) {\n    const output = outputs[0];\n    const outputChannelData = output[0];\n    const outputBuffers = this.outputBuffers;\n    if (this.hasInterrupted) {\n      this.port.postMessage({ event: 'stop' });\n      return false;\n    } else if (outputBuffers.length) {\n      this.hasStarted = true;\n      const { buffer, trackId } = outputBuffers.shift();\n      for (let i = 0; i < outputChannelData.length; i++) {\n        outputChannelData[i] = buffer[i] || 0;\n      }\n      if (trackId) {\n        this.trackSampleOffsets[trackId] =\n          this.trackSampleOffsets[trackId] || 0;\n        this.trackSampleOffsets[trackId] += buffer.length;\n      }\n      return true;\n    } else if (this.hasStarted) {\n      this.port.postMessage({ event: 'stop' });\n      return false;\n    } else {\n      return true;\n    }\n  }\n}\n\nregisterProcessor('stream_processor', StreamProcessor);\n"],{type:"application/javascript"}),lH=URL.createObjectURL(oH),hH=class{constructor(){let{sampleRate:t=44100}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.scriptSrc=lH,this.sampleRate=t,this.context=null,this.stream=null,this.analyser=null,this.trackSampleOffsets={},this.interruptedTrackIds={}}async connect(){this.context=new AudioContext({sampleRate:this.sampleRate}),"suspended"===this.context.state&&await this.context.resume();try{await this.context.audioWorklet.addModule(this.scriptSrc)}catch(Wk){throw console.error(Wk),new Error(`Could not add audioWorklet module: ${this.scriptSrc}`)}let t=this.context.createAnalyser();return t.fftSize=8192,t.smoothingTimeConstant=.1,this.analyser=t,!0}getFrequencies(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"frequency",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-100,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-30;if(!this.analyser)throw new Error("Not connected, please call .connect() first");return rH.getFrequencies(this.analyser,this.sampleRate,null,t,e,i)}_start(){let t=new AudioWorkletNode(this.context,"stream_processor");return t.connect(this.context.destination),t.port.onmessage=e=>{let{event:i}=e.data;if("stop"===i)t.disconnect(),this.stream=null;else if("offset"===i){let{requestId:t,trackId:i,offset:n}=e.data,r=n/this.sampleRate;this.trackSampleOffsets[t]={trackId:i,offset:n,currentTime:r}}},this.analyser.disconnect(),t.connect(this.analyser),this.stream=t,!0}add16BitPCM(t){let e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";if("string"!=typeof i)throw new Error("trackId must be a string");if(!this.interruptedTrackIds[i]){if(this.stream||this._start(),t instanceof Int16Array)e=t;else{if(!(t instanceof ArrayBuffer))throw new Error("argument must be Int16Array or ArrayBuffer");e=new Int16Array(t)}return this.stream.port.postMessage({event:"write",buffer:e,trackId:i}),e}}async getTrackSampleOffset(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.stream)return null;let e,i=crypto.randomUUID();for(this.stream.port.postMessage({event:t?"interrupt":"offset",requestId:i});!e;)e=this.trackSampleOffsets[i],await new Promise((t=>setTimeout((()=>t()),1)));let{trackId:n}=e;return t&&n&&(this.interruptedTrackIds[n]=!0),e}async interrupt(){return this.getTrackSampleOffset(!0)}},cH=class{constructor(t,e,i){this.data=t,this.id=e,this.shared=i,this.items=[],this.isConnected=!1,this.rafId=0,this.emitter=vN(),this.voice=0,this.frequencies=new Float32Array([0]),this.onRealTimeEvent=t=>{let{time:e,source:i,event:n}=t;"server"===i&&"spline.ready"===n.type?this.onSessionCreated(n):"server"===i&&"session.created"===n.type&&(this.client.createResponse(),this.client.on("realtime.event",this.onRealTimeEvent))},this.onSessionCreated=async t=>{let e=Object.values(this.client.tools).map((t=>({type:"function",...t.definition})));this.client.realtime.send("spline.tools",{tools:e}),this.client.realtime.send("spline.connect",{}),await this.wavRecorder.record((t=>this.client.isConnected()&&this.client.appendInputAudio(t.mono)))},this.animate=()=>{if(this.rafId=requestAnimationFrame(this.animate),this.isConnected){let t=this.wavStreamPlayer.analyser?this.wavStreamPlayer.getFrequencies("voice"):{values:new Float32Array([0])},e=t.values.reduce(((t,e)=>t+e),0)/t.values.length;this.voice=e,this.frequencies=t.values,this.emitter.emit("voice",{value:e,frequencies:t.values})}},this.client=new XG({url:"https://relayserver.spline.design/?uuidfile="+t.integration.hash}),this.wavRecorder=new aH({sampleRate:24e3}),this.wavStreamPlayer=new hH({sampleRate:24e3})}update(t){this.data=t,this.client=new XG({url:"https://relayserver.spline.design/?uuidfile="+t.integration.hash})}setColorByName(t,e){let i=this.shared.getColorByName(t);if(i){let{id:t}=i,{r:n,g:r,b:s}=dN.hexStringToRgb(e)??{r:0,g:0,b:0};this.shared.updateColor(t,{r:n/255,g:r/255,b:s/255})}}connect(){if(this.isConnected)return;this.isConnected=!0,this.client.updateSession({turn_detection:{type:"server_vad"}}),this.client.addTool({name:"set_personality_color",description:"returns a color based on the voice personality of the ai assistant. This should be called by the voice assistant each time it is asks to speak differently. If a color cannot be associated to the personality, the color should be a neutral color.",parameters:{type:"object",properties:{color:{type:"string",description:"css hex color string, reflecting the personality"},personality:{type:"string",description:"the personality of the voice assistant"}},required:["color","personality"]}},(t=>{let{color:e}=t;this.setColorByName("Voice Assistant Color",e)}));let t=this.shared.getVariablesNames().join(", ");this.client.addTool({name:"set_variable",description:"Sets a Spline variable value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the variable that needs to be set. Here's a list of available variables: ${t}. It the variable does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"The new value for this variable, should always be a string even for number and boolean variables, assume that the value will be cast to the proper type afterwards."}},required:["name","value","type"]}},(t=>{let{name:e,value:i}=t,n=this.shared.getVariableByName(e);if(n){let t,e=this.shared.getVariable(n.id);t="number"==typeof e?parseFloat(i):"boolean"==typeof e?"true"===i.toLowerCase():{textValue:i},this.shared.updateVariable(n.id,t)}}));let e=this.shared.getColorNames().join(", ");this.client.addTool({name:"set_color",description:"Sets a Spline color asset value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the color asset that needs to be set. Here's a list of available color assets: ${e}. It the color asset does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"css hex color string"}},required:["name","value"]}},(t=>{let{name:e,value:i}=t;this.setColorByName(e,i)}));let i=this.shared.scene,n=[];i.traverseEntity((t=>{t.data.events.forEach((t=>{if("AIAssistantTrigger"===t.data.type){let{description:e}=t.data;n.push(e)}}))})),this.client.addTool({name:"trigger_event",description:"Trigger an event by name, here are the available events, please match what the user is asking for to one of these if it applies, otherwise don't call the function and warn the user.",parameters:{type:"object",properties:{description:{type:"string",description:`The name of the event that needs to be triggered. Here's a list of available events: ${JSON.stringify(n)}.`},direction:{type:"string",description:"default is forward, but can be forward or backward. Always set to forward unless the user ask to reverse or cancel the event, then set to backward."}},required:["description","direction"]}},(t=>{let{description:e,direction:i}=t;this.emitter.emit("trigger_event",{description:e,direction:i})})),this.client.on("error",(t=>console.error(t))),this.client.on("conversation.interrupted",(async()=>{let t=await this.wavStreamPlayer.interrupt();if(t?.trackId){let{trackId:e,offset:i}=t;await this.client.cancelResponse(e,i)}})),this.client.on("conversation.updated",(async t=>{let{item:e,delta:i}=t,n=this.client.conversation.getItems();if(i?.audio&&this.wavStreamPlayer.add16BitPCM(i.audio,e.id),"completed"===e.status&&e.formatted.audio?.length){let t=await aH.decode(e.formatted.audio,24e3,24e3);e.formatted.file=t}this.items=n})),this.animate()}disconnect(){cancelAnimationFrame(this.rafId),this.voice=0,this.isConnected=!1}async start(){try{await this.wavRecorder.end()}catch{}await this.wavRecorder.begin(),this.client.on("realtime.event",this.onRealTimeEvent),await this.wavStreamPlayer.connect(),await this.client.connect()}async stop(){try{this.client.off("realtime.event",this.onRealTimeEvent)}catch(t){console.error(t)}this.client.disconnect(),await this.wavRecorder.end(),await this.wavStreamPlayer.interrupt()}computeAnalysisForListenerEvent(t){if("range"===t.analysis){let e=this.frequencies.slice(...t.analysisRange);return e.reduce(((t,e)=>t+e),0)/e.length}return"single"===t.analysis?this.frequencies[t.analysisSingle]:this.voice}on(t,e){this.emitter.on(t,e)}off(t,e){this.emitter.off(t,e)}};function uH(t){return"variable_"+t}var dH=class extends yj{constructor(t){super(),this.shared=t}create(t){return new bj(t,this.shared)}},pH=class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.data=t,this.needsJitter=i,this.enableLocalStorageForPersistentVariables=n,this.geometryCache=new OG(!0),this.geometryCache2=new OG(!1),this.imageHolderCache=new dH(this),this.thisContext={scene:LG,shared:this},this.deletedMaterial=new uG(uR.defaultTwoLayerData("phong"),this.thisContext,""),this.deletedImage=new xj(DO.emptyImage,this),this.deletedVideo=new xj(eR.defaultVideo,this),this.materials={},this.images={},this.uiBuffers={},this.videos={},this.colors={},this.audios={},this.particles={},this.fonts={},this.variables={},this.userAPIs={},this.userWebhooks={},this.mouseProperty=null,this.raycastProperty=null,this.requestRender=()=>{this._requestRender&&this._requestRender()},e.images)for(let[r,s]of Object.entries(e.images))this.addImage(r,s);if(e.videos)for(let[r,s]of Object.entries(e.videos))this.addVideo(r,s);if(e.audios)for(let[r,s]of Object.entries(e.audios))this.addAudio(r,s);if(e.particles)for(let[r,s]of Object.entries(e.particles))this.addParticle(r,s);this.reset(t)}setRequestRender(t){this._requestRender=t}getImageLoadPromises(){return Object.values(this.images).map((t=>t.loadPromise))}setEntityOpContext(t){this.entityOpContext=t}reset(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.data=t,this.resetLib(t.lib);for(let{id:i,data:n}of t.variables)this.addVariableHolder(i,n),e&&this.updateVariableHolder(i,n);for(let[i,n]of Object.entries(t.userAPIs))this.addUserAPI(i,n);for(let[i,n]of Object.entries(t.userWebhooks))this.addUserWebhook(i,n);for(let[i,n]of Object.entries(t.images))this.addImage(i,n);for(let[i,n]of Object.entries(t.videos))this.addVideo(i,n);for(let[i,n]of Object.entries(t.colors))this.addColor(i,n);for(let[i,n]of Object.entries(t.materials))this.addMaterial(i,n);for(let[i,n]of Object.entries(t.audios))this.addAudio(i,n);for(let[i,n]of Object.entries(t.particles))this.addParticle(i,n);for(let[i,n]of Object.entries(t.fonts))this.addFont(i,n)}addMaterial(t,e){if(this.materials[t]){let i=this.materials[t];i.reset(e,this.thisContext),i.dispose()}else{let i=new uG(e,this.thisContext,t);this.materials[t]=i}}deleteMaterial(t){this.materials[t]&&(this.materials[t].nodeMaterialDispose(),delete this.materials[t])}getMaterial(t){return this.materials[t]}getMaterialOrDeletedPlaceholder(t){return this.materials[t]??this.deletedMaterial}material(t){return"string"==typeof t?this.getMaterialOrDeletedPlaceholder(t):null==t?(console.error("material is undefined or null"),this.deletedMaterial):new cG(t,this.thisContext)}getMaterials(){return this.materials}addImage(t,e){return this.images[t]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[t].updateSrc(e.data),!0):(this.images[t]=new xj(e,this),!1)}deleteImage(t){let e=this.images[t];e&&(e.dispose(),delete this.images[t])}getDefaultImage(){return this.images.image_0}getImage(t){return this.images[t]??this.deletedImage}image(t){return"string"==typeof t?this.getImage(t):this.imageHolderCache.load(t)}addUIBuffer(t,e){return this.uiBuffers[t]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.uiBuffers[t].updateSrc(e),!0):(this.uiBuffers[t]=new xj(e,this),!1)}uiBuffer(t){return this.uiBuffers[t]}addVideo(t,e){return this.videos[t]?(this.videos[t].updateSrc(e.data),!0):(this.videos[t]=new xj(e,this),!1)}deleteVideo(t){let e=this.videos[t];e&&(e.dispose(),delete this.videos[t])}getVideo(t){return this.videos[t]??this.deletedVideo}video(t){return"string"==typeof t?this.getVideo(t):this.imageHolderCache.load(t)}addColor(t,e){return this.colors[t]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in e?this.colors[t].setRGBA(e.r,e.g,e.b,e.a):this.colors[t].setRGBA(e.r,e.g,e.b,1),!0):(this.colors[t]=new Qj(e.r,e.g,e.b,"a"in e?e.a:1),!1)}updateColor(t,e){if(this.colors[t]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let i=this.colors[t];return this.colors[t].r=e.r??i.r,this.colors[t].g=e.g??i.g,this.colors[t].b=e.b??i.b,this.colors[t].a=e.a??i.a,!0}return!1}deleteColor(t){this.colors[t]&&delete this.colors[t]}getColor(t){return this.colors[t]}getColorNames(){return Object.values(this.data.colors).map((t=>t.name))}getColorByName(t){for(let e in this.data.colors)if(this.data.colors[e].name===t)return{color:this.colors[e],id:e}}color(t){let e;if("string"!=typeof t)return new LU(t.r,t.g,t.b,"a"in t?t.a:1);{let i=this.getColor(t);i?e=i:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),e=new LU(0,0,0,0))}return e}addAudio(t,e){this.audios[t]=e}getAudio(t){let e=this.audios[t];if(e instanceof AG)return e;{let i=new AG({src:e.data});return this.audios[t]=i,i}}addParticle(t,e){this.particles[t]=e}getParticle(t){return this.particles[t]}deleteParticle(t){this.particles[t]&&delete this.particles[t]}deleteAudio(t){let e=this.audios[t];e&&(e instanceof AG&&e.dispose(),delete this.audios[t])}addFont(t,e){this.fonts[t]=new IG(e),this.fonts[t].loadingPromise.then((()=>this.requestRender()))}getFont(t){return this.fonts[t]}deleteFont(t){this.fonts[t]&&delete this.fonts[t]}dispose(){Object.keys(this.materials).forEach((t=>this.deleteMaterial(t))),this._requestRender=void 0,Object.values(this.audios).forEach((t=>{t instanceof AG&&t.dispose()})),this.audios={},this.particles={},this.geometryCache.dispose(),this.geometryCache2.dispose()}addVariableHolder(t,e){if(void 0===this.variables[t]){let i=e.value;if(this.enableLocalStorageForPersistentVariables&&e.persistent){let n=localStorage.getItem(uH(t));i=null!==n?JSON.parse(n):e.value}return this.variables[t]={value:i,locations:[],persistent:e.persistent},"dynamicVariableType"in e&&(this.variables[t].dynamicVariablePlayState="Playing",this.variables[t].dynamicVariableToggleIsForward=void 0),!0}return this.variables[t].value=e.value,!1}resetDynamicVariablePlayState(){for(let t in this.variables)void 0!==this.variables[t].dynamicVariablePlayState&&(this.variables[t].dynamicVariablePlayState="Playing",this.variables[t].dynamicVariableToggleIsForward=void 0)}updateVariableHolder(t,e){this.updateVariable(t,e.value)}updateVariable(t,e){if(void 0===this.variables[t])return!1;this.variables[t].value=e,this.enableLocalStorageForPersistentVariables&&this.variables[t].persistent&&localStorage.setItem(uH(t),JSON.stringify(e));let i=e;for(;"string"==typeof i;)i=this.variables[i].value;let n=this.entityOpContext.scene;for(let r=this.variables[t].locations.length-1;r>=0;r--){let e=this.variables[t].locations[r];if("material"===e[0]){let t=e[1],r=i,s={scene:n,shared:this},a=e.slice(2);n.traverseMaterial((e=>{let i=e.root??e;i.uuid===t&&i.onVariableUpdate(a,r,s)}));let o=this.materials[t];o&&o.onVariableUpdate(a,r,s)}else{let s=n.find(e[0]);if(void 0===s){this.variables[t].locations.splice(r,1);continue}if("geometry"!==e[1]&&"particles"!==e[1]){for(let t=1;t<e.length-1;t++)s=s[e[t]];"rotation"===e[1]?s[e[e.length-1]]=i*Nf.DEG2RAD:s[e[e.length-1]]=i}if(s=n.find(e[0]),"ParticleEmitter"===s.type&&s.updateVariableState(i,e),IB.is(s))if("position"===e[1]||"rotation"===e[1]||"scale"===e[1])s.onVariableUpdate();else if("geometry"===e[1]){let t=s;s.component&&(t=s.component);let e=t.dataPatched;t.chooseGeoemtryCache(this).forceDelete(e.geometry),t.createGeometryDelayed(this.entityOpContext),t.onVariableUpdate(!0),t.invalidateDownstreamBooleanData(),t.instances.forEach((t=>{let e=t.dataPatched;t.chooseGeoemtryCache(this).forceDelete(e.geometry),t.createGeometryDelayed(this.entityOpContext),t.onVariableUpdate(!0),t.invalidateDownstreamBooleanData()}))}else"morphTargetInfluences"===e[1]&&s.updateMorphInfluences(e[2],i)}}return this.requestRender(),!0}deleteVariable(t){this.variables[t]&&delete this.variables[t]}getVariable(t,e){if(Array.isArray(t)){if("mouse"===t[0])return this.mouseProperty?.[t[1]]??0;if("raycast"===t[0])return this.raycastProperty?.[t[1]]??0;let e=this.entityOpContext.scene.find(t[0]);if("width"===t[1]||"height"===t[1]||"depth"===t[1])return e.geometry.userData.parameters[t[1]];for(let i=1;i<t.length;i++)e=e[t[i]];return"rotation"===t[1]&&(e*=Nf.RAD2DEG),e}for(let i in this.variables){if(void 0===e)break;let t=this.variables[i],n=t.locations?.findIndex((t=>yD.equal(t,e)));void 0!==n&&-1!==n&&t.locations.splice(n,1)}if("string"==typeof t){let i=t,n=t;do{if(n=i,void 0===this.variables[i])break;let t=this.variables[i].value;e&&void 0!==this.variables[n]&&this.variables[n].locations.push(e),i=t}while("string"==typeof i);return i}return t}getVariables(){return this.variables}getVariablesNames(){return this.data.variables.map((t=>t.data.name))}getVariableByName(t){for(let e of this.data.variables)if(e.data.name===t)return{variable:e.data,id:e.id}}getDynamicVariablePlayState(t){return this.variables[t]?.dynamicVariablePlayState}setDynamicVariablePlayState(t,e){void 0!==this.variables[t]&&(this.variables[t].dynamicVariablePlayState=e)}getDynamicVariableToggleIsForward(t){return this.variables[t]?.dynamicVariableToggleIsForward}setDynamicVariableToggleIsForward(t,e){void 0!==this.variables[t]&&(this.variables[t].dynamicVariableToggleIsForward=e)}resetLib(t){for(let[e,i]of Object.entries(t.images))this.addImage(e,i.asset);for(let[e,i]of Object.entries(t.audios))this.addAudio(e,i.asset);for(let[e,i]of Object.entries(t.particles))this.addParticle(e,i.asset);for(let[e,i]of Object.entries(t.colors))this.addColor(e,i.asset);for(let[e,i]of Object.entries(t.fonts))this.addFont(e,i.asset);for(let[e,i]of Object.entries(t.materials))this.addMaterial(e,i.asset);for(let[e,i]of Object.entries(t.videos))this.addVideo(e,i.asset);for(let[e,i]of Object.entries(t.variables))this.addVariableHolder(e,i.asset)}updateLibByOp(t,e){"images"===t.path[0]?1===t.path.length&&1===t.type?this.addImage(t.id,t.data.asset):1===t.path.length&&2===t.type&&this.deleteImage(t.id):"videos"===t.path[0]?1===t.path.length&&1===t.type?this.addVideo(t.id,t.data.asset):1===t.path.length&&2===t.type&&this.deleteVideo(t.id):"audios"===t.path[0]?1===t.path.length&&1===t.type?this.addAudio(t.id,t.data.asset):1===t.path.length&&2===t.type&&this.deleteAudio(t.id):"particles"===t.path[0]?1===t.path.length&&1===t.type?this.addParticle(t.id,t.data.asset):1===t.path.length&&2===t.type&&this.deleteParticle(t.id):"colors"===t.path[0]?1===t.path.length&&1===t.type?this.addColor(t.id,t.data.asset):1===t.path.length&&2===t.type&&this.deleteColor(t.id):"materials"===t.path[0]?1===t.path.length&&1===t.type?this.addMaterial(t.id,t.data.asset):1===t.path.length&&2===t.type&&this.deleteMaterial(t.id):"fonts"===t.path[0]?1===t.path.length&&1===t.type?this.addFont(t.id,t.data.asset):1===t.path.length&&2===t.type&&this.deleteFont(t.id):"variables"===t.path[0]?1===t.path.length&&1===t.type?this.addVariableHolder(t.id,t.data.asset):1===t.path.length&&2===t.type&&this.deleteVariable(t.id):"components"===t.path[0]&&e.updateByLibOp(t,this)}updateByOp(t,e,i){if(this.data=e,"images"===t.path[0])2===t.path.length&&0===t.type?t.props.data&&this.getImage(t.path[1]).updateSrc(t.props.data):1===t.path.length&&1===t.type?this.addImage(t.id,t.data):1===t.path.length&&2===t.type&&this.deleteImage(t.id);else if("videos"===t.path[0])2===t.path.length&&0===t.type?t.props.data&&this.getVideo(t.path[1]).updateSrc(t.props.data):1===t.path.length&&1===t.type?this.addVideo(t.id,t.data):1===t.path.length&&2===t.type&&this.deleteVideo(t.id);else if("audios"===t.path[0])2===t.path.length&&0===t.type?t.props.data&&this.addAudio(t.path[1],e.audios[t.path[1]]):1===t.path.length&&1===t.type?this.addAudio(t.id,t.data):1===t.path.length&&2===t.type&&this.deleteAudio(t.id);else if("particles"===t.path[0])2===t.path.length&&0===t.type?t.props.data&&this.addParticle(t.path[1],e.particles[t.path[1]]):1===t.path.length&&1===t.type?this.addParticle(t.id,t.data):1===t.path.length&&2===t.type&&this.deleteParticle(t.id);else if("colors"===t.path[0])2===t.path.length&&0===t.type?this.updateColor(t.path[1],t.props):1===t.path.length&&1===t.type?this.addColor(t.id,t.data):1===t.path.length&&2===t.type&&this.deleteColor(t.id);else if("materials"===t.path[0])1===t.path.length&&1===t.type?this.addMaterial(t.id,t.data):1===t.path.length&&2===t.type?this.deleteMaterial(t.id):t.path.length>1&&this.getMaterial(t.path[1]).updateByOp(QT.drop(t,2),e.materials[t.path[1]],{shared:this,scene:i});else if("fonts"===t.path[0])2===t.path.length&&0===t.type?this.updateFont(t.path[1],t,i):1===t.path.length&&1===t.type?this.addFont(t.id,t.data):1===t.path.length&&2===t.type&&this.deleteFont(t.id);else if("variables"===t.path[0])2===t.path.length&&0===t.type?"value"in t.props?this.updateVariable(t.path[1],t.props.value):"persistent"in t.props&&(this.variables[t.path[1]].persistent=t.props.persistent):1===t.path.length&&4===t.type?this.addVariableHolder(t.id,t.data):1===t.path.length&&5===t.type&&this.deleteVariable(t.id);else if("userAPIs"===t.path[0]){if(1===t.path.length&&1===t.type)this.addUserAPI(t.id,t.data);else if(1===t.path.length&&2===t.type)this.deleteUserAPI(t.id);else if("string"==typeof t.path[1]){let i=e.userAPIs[t.path[1]];if(i){let e=0===t.type&&void 0===t.props.debounce,n=this.getUserAPI(t.path[1]);n instanceof cH?n.update(i):n?.update(i,this,e)}}}else if("userWebhooks"===t.path[0]){if(1===t.path.length&&1===t.type)this.addUserWebhook(t.id,t.data);else if(1===t.path.length&&2===t.type)this.deleteUserWebhook(t.id);else if("string"==typeof t.path[1]){let i=e.userWebhooks[t.path[1]];i&&this.getUserWebhook(t.path[1])?.update(i)}}else"lib"===t.path[0]&&this.updateLibByOp(QT.drop(t,1),i)}updateFont(t,e,i){if(e.props.url){let n=this.getFont(t),r={...this.data.fonts[t],url:e.props.url};n.update(r),n.loadingPromise.then((()=>this.requestRender())),i.updateFont(t,this)}}addUserAPI(t,e){return this.userAPIs[t]?(this.userAPIs[t].update(e,this),!0):this.openAIRealtime?.id===t?(this.openAIRealtime.update(e),!0):"VoiceAssistant"===e.integration?.type?(this.openAIRealtime=new cH(e,t,this),!1):(this.userAPIs[t]=new yN(t,e,this),!1)}getUserAPI(t){return this.openAIRealtime?.id===t?this.openAIRealtime:this.userAPIs[t]}getUserAPIs(){return this.userAPIs}deleteUserAPI(t){let e=this.userAPIs[t];e&&(e.dispose(),delete this.userAPIs[t])}addUserWebhook(t,e){return this.userWebhooks[t]?(this.userWebhooks[t].update(e),!0):(this.userWebhooks[t]=new UG(t,e),!1)}getUserWebhook(t){return this.userWebhooks[t]}getUserWebhooks(){return this.userWebhooks}deleteUserWebhook(t){let e=this.userWebhooks[t];e&&(e.dispose(),delete this.userWebhooks[t])}get scene(){return this.entityOpContext.scene}},fH=(new pH(lO.emptyData()),class extends CU{updateByPatchedOp(t,e,i){if(super.updateByPatchedOp(t,e,i),null!==function(t,e){let i=[];if(e.length!==t.length)return null;for(var n=0;n<t.length;){if("*"===e[n])i.push(t[n]);else if(t[n]!==e[n])return null;n+=1}return i}(t.path,["materials"])&&0===t.type&&Array.isArray(this.material))for(let[n,r]of Object.entries(t.props)){let t=i.shared.material(r);this.material[Number(n)]=t}else if(ED(t.path,["material"])&&this.material instanceof lG)"material"in e&&"string"!=typeof e.material&&this.material.updateByOp(QT.drop(t,1),e.material,i);else if(ED(t.path,["materials","*"])&&Array.isArray(this.material)){let n=t.path[1];if("materials"in e&&n<this.material.length){let r=e.materials[n];"string"!=typeof r&&this.material[n].updateByOp(QT.drop(t,2),r,i)}}}get needsAO(){return void 0!==this.material&&(Array.isArray(this.material)?this.material[0]:this.material).hasAO}updateState(t,e){super.updateState(t,e),void 0!==t.castShadow&&(this.castShadow=t.castShadow),void 0!==t.receiveShadow&&(this.receiveShadow=t.receiveShadow);let i,n=this.dataPatched;if("Mesh"===this.dataPatched.type&&this.dataPatched.geometry.shapeBlendNode&&this.layers.set(9),"Mesh"===this.dataPatched.type&&"ShapeBlendGeometry"===this.dataPatched.geometry.type&&(i={resolutionLevel:this.dataPatched.geometry.resolutionLevel,useChildrenColors:this.dataPatched.geometry.useChildrenColors}),"NonParametricGeometry"!==t.geometry?.type&&"material"in t&&void 0!==t.material&&(this.disposeMaterial(),this.material=e.shared.material(t.material).getFlavor(n.flatShading,n.side,n.wireframe,i),e.scene.markNeedsUpdateRendererDirty()),("NonParametricGeometry"===t.geometry?.type||"materials"in t)&&("materials"in t&&void 0!==t.materials?(this.disposeMaterial(),this.material=t.materials.map((t=>e.shared.material(t).getFlavor(n.flatShading,n.side,n.wireframe))),e.scene.markNeedsUpdateRendererDirty()):"material"in t&&void 0!==t.material&&(this.disposeMaterial(),this.material=[e.shared.material(t.material).getFlavor(n.flatShading,n.side,n.wireframe)],e.scene.markNeedsUpdateRendererDirty())),void 0!==t.flatShading||void 0!==t.wireframe||void 0!==t.side)if(Array.isArray(this.material))for(let r=0;r<this.material.length;r++)this.material[r]=this.material[r].getFlavor(n.flatShading,n.side,n.wireframe);else this.material=this.material.getFlavor(n.flatShading,n.side,n.wireframe,i)}disposeMaterial(){this.material&&pT(this.material).forEach((t=>{t instanceof lG&&(t instanceof uG||t.nodeMaterialDispose())}))}dispose(){this.disposeMaterial(),super.dispose()}}),mH=new mm,gH=new cm,vH=new cm,yH=new mm,bH=new Wm,xH=class extends fH{constructor(t,e,i){super(t,e),this.data=e,this.isSkinnedMesh=!1,this.localGeometry=void 0,e.bindMode&&e.bindMatrix&&(this.bindMode=e.bindMode,this.bindMatrix=(new Wm).fromArray(e.bindMatrix),this.bindMatrixInverse=new Wm)}chooseGeoemtryCache(t){return t.geometryCache}markGeometryAsReachable(t){this.geometryCreateDeleyed instanceof Hg&&this.chooseGeoemtryCache(t).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(void 0!==this.localGeometry)return this.localGeometry;if(this.geometryCreateDeleyed instanceof pH){let t=this.geometryCreateDeleyed,e=this.chooseGeoemtryCache(t);this.geometryCreateDeleyed=e.get(this.dataPatched.geometry,t,this)}return this.geometryCreateDeleyed}set geometry(t){this.localGeometry=t}get is2DAndNoDepth(){let t=this.dataPatched.geometry;return yR.is2DParametricMesh(t.type)&&0===t.depth}get is2DType(){return yR.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return"NonParametricGeometry"===this.geometry.userData.type}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),ED(t.path,["geometry"])&&this.updateByPatchedOpGeometry(QT.drop(t,1),e.geometry,i)}removeInteractionGeometry(t){this.localGeometry?.dispose(),this.localGeometry=void 0}updateGeometryInteractions(t,e){this.invalidateDownstreamBooleanData();let i=this.data.geometry.type;if("NonParametricGeometry"===i||"SubdivGeometry"===i){let i,n,r,s=t;if(void 0===this.localGeometry){let t={...this.data.geometry,...s};this.localGeometry=UN(t,e,this.data.flatShading,this)}s.scaleBaked?[i,n,r]=s.scaleBaked:({width:i,height:n,depth:r}=s);let a=this.localGeometry.userData;void 0!==a.sxPrev&&jN(this.localGeometry.attributes,i/a.sxPrev,n/a.syPrev,r/a.szPrev),a.sxPrev=i,a.syPrev=n,a.szPrev=r}else{let i={...this.data.geometry,...t};this.localGeometry?.dispose(),this.localGeometry=UN(i,e,this.data.flatShading,this)}}refreshAttachedClonersInteractions(){for(let t of this.attachedSurfaceCloners)t.update()}refreshAttachedCloners(t){for(let e of this.attachedSurfaceCloners)t.scene.addPendingUpdateCloner(e.object)}refreshAttachedPaths(t){for(let e of this.attachedPaths)t.scene.addPendingCommand((()=>e.updateShape()))}createGeometryDelayed(t){this.geometryCreateDeleyed=t.shared,this.refreshAttachedCloners(t),this.refreshAttachedPaths(t)}updateByPatchedOpGeometry(t,e,i){let n=!1;0===t.type&&0===t.path.length&&Object.keys(t.props).includes("scaleBaked")&&this.geometryCreateDeleyed instanceof QN&&this.chooseGeoemtryCache(i.shared).mutateIfUnique(this.geometryCreateDeleyed.data,e)===this.geometryCreateDeleyed&&(n=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(e,t.props.scaleBaked),this.refreshAttachedCloners(i),this.refreshAttachedPaths(i)),n||(i.scene?.markGeometryCacheDirty(),this.createGeometryDelayed(i)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(t,e){this.createGeometryDelayed(e)}updateState(t,e){void 0!==t.geometry&&this.updateGeometryOnStateUpdate(t.geometry,e);let i=t.morphTargetInfluences;if(i){this.updateMorphTargets(),this.geometry.morphTargetsRelative=!0;for(let{data:{name:t,value:n}}of i)this.updateMorphInfluences(t,e.shared.getVariable(n,[this.uuid,"morphTargetInfluences",t]))}super.updateState(t,e)}updateMorphInfluences(t,e){if(void 0===this.morphTargetDictionary)return;let i=this.morphTargetDictionary[t];void 0!==i&&(this.morphTargetInfluences[i]=e)}updateGeometryGroupsIfNeeded(){Array.isArray(this.material)&&0===this.geometry.groups.length&&this.geometry.addGroup(0,Math.max(this.geometry.getIndex()?.count??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(t,e){let i=this.geometry.userData.parameters;this.is2DType?t.set(0,0,.5*i.depth):this.isNonParametric?(t.setScalar(0),this.geometry.boundingSphere&&t.copy(this.geometry.boundingSphere.center),e.set(i.width,i.height,i.depth??0).multiplyScalar(.5)):i.centerOffset?t.fromArray(i.centerOffset):t.setScalar(0),e.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(t,e){this.skeleton=t,this.isSkinnedMesh=!0,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(t){let e=new cm,i=this.geometry.attributes.skinWeight;for(let n=0,r=i.count;n<r;n++){e.fromBufferAttribute(i,n);let t=1/e.manhattanLength();t!==1/0?e.multiplyScalar(t):e.set(1,0,0,0),i.setXYZW(n,e.x,e.y,e.z,e.w)}}boneTransform(t,e){let i=this.skeleton;if(void 0===i)return;let n=this.geometry;gH.fromBufferAttribute(n.attributes.skinIndex,t),vH.fromBufferAttribute(n.attributes.skinWeight,t),mH.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let r=0;r<4;r++){let t=vH.getComponent(r);if(0!==t){let n=gH.getComponent(r);bH.multiplyMatrices(i.bones[n].matrixWorld,i.boneInverses[n]),e.addScaledVector(yH.copy(mH).applyMatrix4(bH),t)}}return e.applyMatrix4(this.bindMatrixInverse)}};function wH(t){if(Array.isArray(t.material)){for(let e of t.material)if(0===e.getLayersOfType("outline").length)return}else if(!(t.material instanceof lG)||0===t.material.getLayersOfType("outline").length)return;t instanceof xH&&t.is2DAndNoDepth?function(t){if(t.geometry.attributes.extrudeNormals||!t.geometry.attributes.position)return;let e=t.geometry.attributes.position.array,i=new Float32Array(e.length),n=new mm;for(let r=0;r<e.length;r+=3)n.set(e[r],e[r+1],e[r+2]).normalize(),i[r]=n.x,i[r+1]=n.y,i[r+2]=n.z;t.geometry.setAttribute("extrudeNormal",new Bg(i,3))}(t):function(t){if(t.geometry.attributes.extrudeNormal||!t.geometry.attributes.position||!t.geometry.attributes.normal)return;let e=new Map,i=t.geometry.attributes,n=i.position.array,r=i.normal.array,s=new Float32Array(n.length);for(let a=0;a<n.length;a+=3){let t=`${n[a]}_${n[a+1]}_${n[a+2]}`,i=new mm(r[a],r[a+1],r[a+2]);e.has(t)?e.get(t)?.normals.push(i):e.set(t,{normals:[i],result:new mm})}e.forEach(((t,e)=>{for(let i of t.normals)t.result.add(i);t.result.divideScalar(t.normals.length)}));for(let a=0;a<n.length;a+=3){let t=`${n[a]}_${n[a+1]}_${n[a+2]}`,i=e.get(t)?.result;i&&(s[a]=i.x,s[a+1]=i.y,s[a+2]=i.z)}t.geometry.setAttribute("extrudeNormal",new Bg(s,3))}(t)}function SH(t){if(!t.geometry.attributes.position)return;let e=t.geometry.attributes.position.array,i=new Float32Array(e.length),n=parseInt(t.uuid.replace(/\D/g,"")),r=[Nf.seededRandom(n),Nf.seededRandom(n+1e4),Nf.seededRandom(n+2e4)];for(let s=0;s<e.length;s++)i[s]=r[s%3];t.geometry.setAttribute("randomColor",new Rg(i,3))}var AH=new ym,EH=new mm;function _H(t){let e=!1;return t.scene.objects.traverse(((t,i)=>{"Mesh"===i.type&&"SubdivGeometry"===i.geometry.type&&(e=!0)})),e}var CH=class extends xH{constructor(t,e,i){super(t,e,i),this.data=e,this.hiddenMatrixOld=new Wm,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(t){return this.dataPatched.flatShading?t.geometryCache:t.geometryCache2}get subdivPointerNew(){return void 0!==this.localGeometry?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return void 0!==this.localGeometry?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(t,e){let i=this.geometry.userData.parameters;t.copy(this.originalGeometryNew.boundingSphere.center),e.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}createGeometryByControls(t){if(!0===this.skipReactionUpdate)return;let e=this.localGeometry?.uuid,{originalGeometry:i,subdividedGeometry:n,subdivPointer:r}=QN.build(t,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=r,void 0!==i&&(this.originalGeometry?.dispose(),this.originalGeometry=i),void 0!==n&&(this.subdividedGeometry?.dispose(),this.subdividedGeometry=n??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,wH(this),SH(this),this.calcBoundingBox(),e&&(this.localGeometry.uuid=e)}updateState(t,e){if(super.updateState(t,e),void 0!==t.flatShading){let i=this.material;this.material=Array.isArray(i)?i.map((t=>t.getFlavor(!1,t.side,t.wireframe))):i.getFlavor(!1,i.side,i.wireframe),this.smoothShading=!t.flatShading,this.createGeometryDelayed(e)}}updateMesh(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];QN.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,t&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&QN.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,t&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=QN.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=QN.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(t,e){let i=this.localGeometry;this.localGeometry=this.originalGeometryNew,CU.prototype.raycast.call(this,t,e),this.localGeometry=i}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let t=this.originalGeometry;null===t.boundingSphere&&(t.boundingSphere=new Bm,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=t.boundingSphere));let e=t.attributes.position,i=t.boundingSphere.center;AH.setFromBufferAttribute(e),AH.getCenter(i),t.boundingSphere.radius=i.distanceTo(AH.max),isNaN(t.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),AH.getSize(EH),this.hasNonUniformScale&&EH.divide(this.scale);let n={width:EH.x,height:EH.y,depth:EH.z};return this.geometry.userData.parameters=n,n}updateBoundingSphere(t){let e=this.originalGeometry;AH.min.set(t[0],t[2],t[4]),AH.max.set(t[1],t[3],t[5]),this.hasNonUniformScale&&(AH.min.applyMatrix4(this.shearScaleInv),AH.max.applyMatrix4(this.shearScaleInv)),null===e.boundingSphere&&(e.boundingSphere=new Bm);let i=e.boundingSphere.center;AH.getCenter(i),e.boundingSphere.radius=i.distanceTo(AH.max)}freeSubdivPointer(){this.subdivPointer&&(QN.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,this.originalGeometry?.dispose(),this.subdividedGeometry?.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(t,e,i){super.updateByPatchedOpGeometry(t,e,i),this.localGeometry&&this.createGeometryByControls(e)}},MH={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},PH={polygon_center:0,edge:1,vertex:2},TH=(t,e)=>(i,n)=>e&&0!==i&&0!==t?t*n/100:0,DH=(t,e)=>{let i=Math.abs(e),n=-1*i;return(t- -1)*(i-n)/2+n},kH=new mm,IH=new mm,RH=new mm,OH=new mm;function LH(t,e){let i=RH.fromArray(t),n=OH.fromArray(e);IH.copy(n).sub(i);let r=IH.length();return IH.normalize().multiplyScalar(.5*r),kH.copy(i).add(IH).toArray()}var BH=new Mg,zH=new mm,FH=new mm,NH=new mm;var UH=t=>.5*(1-Math.cos(t*Math.PI)),VH=class{constructor(){this.perlin=new Array(4096)}noise(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(null==this.perlin){this.perlin=new Array(4096);for(let t=0;t<4096;t++)this.perlin[t]=Math.random()}t<0&&(t=-t),e<0&&(e=-e),i<0&&(i=-i);let n,r,s,a,o,l=Math.floor(t),h=Math.floor(e),c=Math.floor(i),u=t-l,d=e-h,p=i-c,f=0,m=.5;for(let g=0;g<4;g++){let t=l+(h<<4)+(c<<8);n=UH(u),r=UH(d),s=this.perlin[4095&t],s+=n*(this.perlin[t+1&4095]-s),a=this.perlin[t+16&4095],a+=n*(this.perlin[t+16+1&4095]-a),s+=r*(a-s),t+=256,a=this.perlin[4095&t],a+=n*(this.perlin[t+1&4095]-a),o=this.perlin[t+16&4095],o+=n*(this.perlin[t+16+1&4095]-o),a+=r*(o-a),s+=UH(p)*(a-s),f+=s*m,m*=.5,l<<=1,u*=2,h<<=1,d*=2,c<<=1,p*=2,u>=1&&(l++,u--),d>=1&&(h++,d--),p>=1&&(c++,p--)}return f}noiseSeed(t){let e=(()=>{let t,e;return{setSeed(i){e=t=(i??4294967296*Math.random())>>>0},getSeed:()=>t,rand:()=>(e=(1664525*e+1013904223)%4294967296,e/4294967296)}})();e.setSeed(t),this.perlin=new Array(4096);for(let i=0;i<4096;i++)this.perlin[i]=e.rand()}},jH=new mm,GH=new Wm,HH=new Hm;function WH(t){let e=!1;return t.scene.objects.traverse(((t,i)=>{"Mesh"===i.type&&("TextGeometry"===i.geometry.type||"InputGeometry"===i.geometry.type)&&(e=!0)})),e}var qH,YH,XH,QH,KH=class extends xH{constructor(t,e,i){super(t,e,i),this.data=e}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){let t=this.dataPatched;return this.font?.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,t.geometry.height,this.fontScale,t.geometry.verticalAlign)??0}get fontScale(){let t=this.dataPatched;return this.font?t.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){return(this.font?.ascender??1)*this.fontScale}get descender(){return(this.font?.descender??1)*this.fontScale}get lineHeight(){let t=this.dataPatched;return t.geometry.fontSize*t.geometry.lineHeight}raycast(t,e){let{matrixWorld:i}=this;if(!isNaN(t.ray.origin.x)&&0!==this.scale.x&&0!==this.scale.y&&0!==this.scale.z&&(GH.copy(i).invert(),HH.copy(t.ray).applyMatrix4(GH),HH.intersectBox(this.singleBBox,jH))){let n=jH.applyMatrix4(i),r=t.ray.origin.distanceTo(n);e.push({distance:r,point:n.clone(),object:this})}}},ZH=1e-4,JH=new mm,$H=new mm;BN.then((t=>{YH=[(qH=t).get_face_center,qH.get_edge_midpoint,qH.get_vertex_position],XH=[qH.get_face_normal,qH.get_edge_normal,qH.get_vertex_normal],QH=[qH.face_count,qH.edge_count,qH.vertex_count]}));var tW=new Wm,eW=new Wm,iW=new mm,nW=new mm,rW=new mm,sW=new mm,aW=new mm,oW=new mm,lW=class{constructor(t,e){this.data=t,this.is3D=e,this.perlin=new VH,"perlin"===t.noiseType?(this.perlin.noiseSeed(t.seed),this.noise=e?(t,e,i)=>this.perlin.noise(t,e,i):t=>this.perlin.noise(t)):this.noise=e?function(){let t=EB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random),e=new Float64Array(t).map((t=>AB[t%12*3])),i=new Float64Array(t).map((t=>AB[t%12*3+1])),n=new Float64Array(t).map((t=>AB[t%12*3+2]));return function(r,s,a){let o,l,h,c,u,d,p,f,m,g,v=(r+s+a)*bB,y=wB(r+v),b=wB(s+v),x=wB(a+v),w=(y+b+x)*xB,S=r-(y-w),A=s-(b-w),E=a-(x-w);S>=A?A>=E?(u=1,d=0,p=0,f=1,m=1,g=0):S>=E?(u=1,d=0,p=0,f=1,m=0,g=1):(u=0,d=0,p=1,f=1,m=0,g=1):A<E?(u=0,d=0,p=1,f=0,m=1,g=1):S<E?(u=0,d=1,p=0,f=0,m=1,g=1):(u=0,d=1,p=0,f=1,m=1,g=0);let _=S-u+xB,C=A-d+xB,M=E-p+xB,P=S-f+2*xB,T=A-m+2*xB,D=E-g+2*xB,k=S-1+.5,I=A-1+.5,R=E-1+.5,O=255&y,L=255&b,B=255&x,z=.6-S*S-A*A-E*E;if(z<0)o=0;else{let r=O+t[L+t[B]];z*=z,o=z*z*(e[r]*S+i[r]*A+n[r]*E)}let F=.6-_*_-C*C-M*M;if(F<0)l=0;else{let r=O+u+t[L+d+t[B+p]];F*=F,l=F*F*(e[r]*_+i[r]*C+n[r]*M)}let N=.6-P*P-T*T-D*D;if(N<0)h=0;else{let r=O+f+t[L+m+t[B+g]];N*=N,h=N*N*(e[r]*P+i[r]*T+n[r]*D)}let U=.6-k*k-I*I-R*R;if(U<0)c=0;else{let r=O+1+t[L+1+t[B+1]];U*=U,c=U*U*(e[r]*k+i[r]*I+n[r]*R)}return 32*(o+l+h+c)}}((0,gB.default)(t.seed)):function(){let t=EB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random),e=new Float64Array(t).map((t=>SB[t%12*2])),i=new Float64Array(t).map((t=>SB[t%12*2+1]));return function(n,r){let s,a,o=0,l=0,h=0,c=(n+r)*vB,u=wB(n+c),d=wB(r+c),p=(u+d)*yB,f=n-(u-p),m=r-(d-p);f>m?(s=1,a=0):(s=0,a=1);let g=f-s+yB,v=m-a+yB,y=f-1+2*yB,b=m-1+2*yB,x=255&u,w=255&d,S=.5-f*f-m*m;if(S>=0){let n=x+t[w];S*=S,o=S*S*(e[n]*f+i[n]*m)}let A=.5-g*g-v*v;if(A>=0){let n=x+s+t[w+a];A*=A,l=A*A*(e[n]*g+i[n]*v)}let E=.5-y*y-b*b;if(E>=0){let n=x+1+t[w+1];E*=E,h=E*E*(e[n]*y+i[n]*b)}return 70*(o+l+h)}}((0,gB.default)(t.seed))}},hW=class extends(RB(gg)){constructor(t,e){super(),this.parameters=e,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.random=null,this.object=t}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(t){if(null===this.parent)this.updateState(this.parameters,t);else for(let e of this.children)e instanceof LB&&e.expand()}invalidateTransform(t){this.matrixWorldNeedsUpdate=!0,this.traverse((e=>{e instanceof LB&&e.object===t&&(e.matrixWorldNeedsUpdate=!0)}))}onObjUpdateMatrix(){"toObject"!==this.parameters.type&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let t of this.children)t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD())}_updateCount(t){let e;if(e=void 0!==t?t:"grid"===this.parameters.type?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,"toObject"===this.parameters.type)if(this.parameters.toObject.object){if(void 0===t&&"random"!==this.parameters.toObject.spreadType)return}else e=0;if("toObject"===this.parameters.type&&this.objectForSample){let t=this.children;if(t.length===e)return;if(t.length<e)for(let i=0,n=e-t.length;i<n;++i){let t=new LB(this.object);t.expand(),this.add(t)}else for(let i=0,n=t.length-e;i<n;++i)this.remove(t[i])}else{if(this.children.length===e)return;if(this.children.length<e)for(let t=0,i=e-this.children.length;t<i;++t){let t=new LB(this.object);t.expand(),this.add(t)}else for(let t=0,i=this.children.length-e;t<i;++t)this.remove(this.children[t])}}getRandom(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(null===this.random||this.random.data.seed!==t.seed||this.random.is3D!==e)&&(this.random=new lW(t,e)),this.random}_updateRadial(t){let e,i=t.radial,n=i.start*Nf.DEG2RAD,r=n-i.end*Nf.DEG2RAD,s=new eg(i.rotation[0],i.rotation[1],i.rotation[2]);switch(i.axis){case"z":e=new mm(0,0,1);break;case"y":e=new mm(0,1,0);break;default:e=new mm(1,0,0)}let a=t.randomnessObject??VI.defaultData([1,1,1]).randomnessObject,o=this.getRandom(a),l=TH(a.strength,this.parameters.randomness);for(let[h,c]of this.children.entries()){let u=h*(a.freqScale/10)+a.movement,d=o.noise(u,u,u),p=h+1;c.scale.x=i.scale[0]+l(p,DH(d,a.scale[0]))||ZH,c.scale.y=i.scale[1]+l(p,DH(d,a.scale[1]))||ZH,c.scale.z=i.scale[2]+l(p,DH(d,a.scale[2]))||ZH,c.position.setScalar(0);let f=r/t.count*h-n;switch(i.axis){case"x":c.rotation.set(0,f,0);break;case"y":c.rotation.set(0,0,f);break;case"z":c.rotation.set(f,0,0)}c.translateOnAxis(e,i.radius),c.position.x+=i.position[0]+l(p,DH(d,a.position[0])),c.position.y+=i.position[1]+l(p,DH(d,a.position[1])),c.position.z+=i.position[2]+l(p,DH(d,a.position[2]));let m=l(p,DH(d,a.rotation[0])),g=l(p,DH(d,a.rotation[1])),v=l(p,DH(d,a.rotation[2]));!0===i.alignment?(c.rotation.x+=s.x+m,c.rotation.y+=s.y+g,c.rotation.z+=s.z+v):c.rotation.set(s.x+m,s.y+g,s.z+v)}}_updateLinear(t){if("linear"!==t.type)throw new Error;let e=t.linear,i=new eg(e.rotation[0],e.rotation[1],e.rotation[2]),n=t.randomnessObject??VI.defaultData([1,1,1]).randomnessObject,r=this.getRandom(n),s=TH(n.strength,this.parameters.randomness);for(let[a,o]of this.children.entries()){let t=a*(n.freqScale/10)+n.movement,l=r.noise(t,t,t),h=a+1,c=s(h,DH(l,n.rotation[0])),u=s(h,DH(l,n.rotation[1])),d=s(h,DH(l,n.rotation[2]));o.scale.x=1+(e.scale[0]-1)*a+s(h,DH(l,n.scale[0]))||ZH,o.scale.y=1+(e.scale[1]-1)*a+s(h,DH(l,n.scale[1]))||ZH,o.scale.z=1+(e.scale[2]-1)*a+s(h,DH(l,n.scale[2]))||ZH,o.rotation.x=i.x*a+c,o.rotation.y=i.y*a+u,o.rotation.z=i.z*a+d,o.position.x=e.position[0]*a+s(h,DH(l,n.position[0])),o.position.y=e.position[1]*a+s(h,DH(l,n.position[1])),o.position.z=e.position[2]*a+s(h,DH(l,n.position[2]))}}_updateGrid(t){let e=0,i=t.grid,n=t.randomnessObject??VI.defaultData([1,1,1]).randomnessObject,r=this.getRandom(n,!0),s=TH(n.strength,this.parameters.randomness);if(!0===i.useCenter){let t={x:i.count[0]%2===0?2:1,y:i.count[1]%2===0?2:1,z:i.count[2]%2===0?2:1},a=new mm(i.size[0]*(i.count[0]-t.x)*.5,i.size[1]*(i.count[1]-t.y)*.5,i.size[2]*(i.count[2]-t.z)*.5);for(let o=0;o<i.count[0];o++)for(let t=0;t<i.count[1];t++)for(let l=0;l<i.count[2];l++){let h=r.noise((o+1)*(n.freqScale/10)+n.movement,(t+1)*(n.freqScale/10)+n.movement,(l+1)*(n.freqScale/10)+n.movement),c=this.children[e++];c.scale.x=1+s(e,DH(h,n.scale[0]))||ZH,c.scale.y=1+s(e,DH(h,n.scale[1]))||ZH,c.scale.z=1+s(e,DH(h,n.scale[2]))||ZH;let u=s(e,DH(h,n.rotation[0])),d=s(e,DH(h,n.rotation[1])),p=s(e,DH(h,n.rotation[2]));c.rotation.set(u,d,p),c.position.x=i.size[0]*o-a.x+s(e,DH(h,n.position[0])),c.position.y=i.size[1]*t-a.y+s(e,DH(h,n.position[1])),c.position.z=i.size[2]*l-a.z+s(e,DH(h,n.position[2]))}}else for(let a=0;a<i.count[0];a++)for(let t=0;t<i.count[1];t++)for(let o=0;o<i.count[2];o++){let l=r.noise((a+1)*(n.freqScale/10)+n.movement,(t+1)*(n.freqScale/10)+n.movement,(o+1)*(n.freqScale/10)+n.movement),h=this.children[e++];h.scale.x=1+s(e,DH(l,n.scale[0]))||ZH,h.scale.y=1+s(e,DH(l,n.scale[1]))||ZH,h.scale.z=1+s(e,DH(l,n.scale[2]))||ZH;let c=s(e,DH(l,n.rotation[0])),u=s(e,DH(l,n.rotation[1])),d=s(e,DH(l,n.rotation[2]));h.rotation.set(c,u,d),h.position.x=i.size[0]*a+s(e,DH(l,n.position[0])),h.position.y=-i.size[1]*t+s(e,DH(l,n.position[1])),h.position.z=-i.size[2]*o+s(e,DH(l,n.position[2]))}}_updateToObject(t){if("toObject"!==t.type)throw new Error;let{toObject:e}=t,i=new eg(e.rotation[0],e.rotation[1],e.rotation[2]),n=t.randomnessObject??VI.defaultData([1,1,1]).randomnessObject,r=this.getRandom(n),s=TH(n.strength,this.parameters.randomness);if(!e.object){for(let[,t]of this.children.entries())t.position.set(0,0,0),t.scale.setScalar(1),t.rotation.set(0,0,0);return void(this.objectForSample=void 0)}if(!this.objectForSample)return;if(this.objectForSample instanceof KH){if(!this.objectForSample.font?.isLoaded||void 0===this.objectForSample.geometry.attributes.position)return void(this._pendingMediaLoad=!0);this._pendingMediaLoad=!1}if(void 0===this.objectForSample.geometry&&this.objectForSample.isAncestorOf(this.object.uuid))return void console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);let a=this.getSubdivData();if(a.length>0){let t=Math.round(a.length*e.count/100);this._updateCount(t)}else{let t=this.objectForSample.geometry.getAttribute("position");if(!t||isNaN(t.count)||0===t.count)return void console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) cannot be cloned on the surface of "${this.objectForSample.name}" (${this.objectForSample.uuid}) because the latter does not have a valid geometry.`)}this.objectForSample.updateMatrixWorld();let o=new MB(this.objectForSample).build(),l=MH[e.axis],h=this.children;o.setRandomGenerator((0,gB.default)(this.object.uuid+e.seed));for(let[c,u]of h.entries()){let t=c*(n.freqScale/10)+n.movement,h=r.noise(t,t,t),d=c+1,p=s(d,DH(h,n.rotation[0])),f=s(d,DH(h,n.rotation[1])),m=s(d,DH(h,n.rotation[2]));"random"===e.spreadType?o.sample(rW,sW):(a.length&&(rW.fromArray(a[c].pos),sW.fromArray(a[c].norm)),this.objectForSample instanceof CH&&rW.applyMatrix4(tW.copy(this.objectForSample.matrixWorld).invert())),rW.applyMatrix4(this.object.hiddenMatrix.clone().invert()),u.position.copy(rW),iW.fromArray(l);let g="normal"===e.align?sW:this.object.getWorldDirection(oW),v=nW.fromArray(e.position);nW.x+=s(d,DH(h,n.position[0])),nW.y+=s(d,DH(h,n.position[1])),nW.z+=s(d,DH(h,n.position[2]));let y=Math.acos(g.dot(iW)),b=aW.crossVectors(iW,g).normalize(),x=eW.makeRotationAxis(b,y),w=g.clone().cross(this.object.up).normalize(),S=w.clone().cross(g).normalize(),A=(new Wm).makeBasis(w,g,S),E=new mm(iW.y,iW.z,iW.x).normalize(),_=E.clone().cross(iW).normalize(),C=(new Wm).makeBasis(E,iW,_).invert(),M=(new Wm).multiplyMatrices(A,C);u.rotation.setFromRotationMatrix(M),v.applyMatrix4(x),u.position.add(v),u.rotation.x=u.rotation.x+i.x+p,u.rotation.y=u.rotation.y+i.y+f,u.rotation.z=u.rotation.z+i.z+m,u.scale.setScalar(1),u.scale.x=u.scale.x+e.scale[0]+s(d,DH(h,n.scale[0]))||ZH,u.scale.y=u.scale.y+e.scale[1]+s(d,DH(h,n.scale[1]))||ZH,u.scale.z=u.scale.z+e.scale[2]+s(d,DH(h,n.scale[2]))||ZH,u.scale.multiply(this.object.scale),u.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let t=this.parameters.toObject.spreadType,e=new Map,i=(t,i)=>{let n=Math.round(1e4*t[0])+"_"+Math.round(1e4*t[1])+"_"+Math.round(1e4*t[2]),r=e.get(n);r?(r.pos[0]+=t[0],r.pos[1]+=t[1],r.pos[2]+=t[2],r.norm[0]+=i[0],r.norm[1]+=i[1],r.norm[2]+=i[2],r.count+=1):e.set(n,{pos:[...t],norm:[...i],count:1})};if("random"===t)return[];if(this.objectForSample instanceof CH){let e=this.objectForSample,n=PH[t],r=QH[n],s=YH[n],a=XH[n],o=r(e.subdivPointerNew);for(let t=0;t<=o-1;t++){let n=s(e.subdivPointerNew,t),r=a(e.subdivPointerNew,t);JH.fromArray(n).applyMatrix4(e.matrixWorld),$H.fromArray(r),i(JH.toArray(),$H.toArray())}}else(this.objectForSample.geometry.index?function(t){let e=[];for(let i=0;i<=t.index.count;i++)if(zH.fromArray(t.index.array,3*i),BH.setFromAttributeAndIndices(t.attributes.position,zH.x,zH.y,zH.z),BH.getNormal(FH),BH.getMidpoint(NH),!(isNaN(NH.x)||isNaN(NH.y)||isNaN(NH.z))){let{a:t,b:i,c:n}=BH,r=t.toArray(),s=i.toArray(),a=n.toArray(),o=t.distanceTo(i),l=i.distanceTo(n),h=n.distanceTo(t),c=LH(r,s),u=LH(s,a),d=LH(a,r),p=[o,l,h],f=Math.max(...p),m=p.filter((t=>Math.round(t)===Math.round(f))).length>1,g=[],v=BH.getMidpoint(NH).toArray();f===o&&!m&&(g=[u,d,d],v=c),f===l&&!m&&(g=[c,d,d],v=u),f===h&&!m&&(g=[c,u,u],v=d),m&&(g=[c,u,d]),e.push({vertices:[r,s,a],faceCenters:g,midpoint:v,norm:BH.getNormal(FH).toArray()})}return e}(this.objectForSample.geometry):function(t){let e=[],{position:i}=t.attributes;for(let n=0;n<i.count;n++){BH.setFromAttributeAndIndices(i,3*n,3*n+1,3*n+2),BH.getNormal(FH),BH.getMidpoint(NH);let t=BH.a.toArray(),r=BH.b.toArray(),s=BH.c.toArray();e.push({vertices:[t,r,s],faceCenters:[LH(t,r),LH(r,s),LH(s,t)],midpoint:NH.toArray(),norm:FH.toArray()})}return e}(this.objectForSample.geometry)).forEach(((e,n)=>{"polygon_center"===t&&i(e.midpoint,e.norm),"vertex"===t&&(i(e.vertices[0],e.norm),i(e.vertices[1],e.norm),i(e.vertices[2],e.norm)),"edge"===t&&(i(e.faceCenters[0],e.norm),i(e.faceCenters[1],e.norm),i(e.faceCenters[2],e.norm))}));let n=Array.from(e.values());for(let r of n)r.pos[0]/=r.count,r.pos[1]/=r.count,r.pos[2]/=r.count,r.norm[0]/=r.count,r.norm[1]/=r.count,r.norm[2]/=r.count;return n}updateState(t,e){if(this.parameters=fP(t),"toObject"!==this.parameters.type)(null===this.parent||this.parent!==this.object)&&(this.removeFromParent(),this.object.parent?.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(null===this.parent||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let t=e.find(this.parameters.toObject.object);this.objectForSample=t instanceof CU?t:void 0,this.matrix=new Wm,this.hiddenMatrix=new Wm,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,t&&t.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},cW=t=>{var e;return(e=class extends t{}).geometryHelper=new av(30,30,30),e},uW=new Hm,dW=new Bm,pW=new Wm,fW=function(t,e,i,n){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t,a=e,o=s.matrixWorld;if(null===a.boundingSphere&&a.computeBoundingSphere(),dW.copy(a.boundingSphere),dW.applyMatrix4(o),!1===i.ray.intersectsSphere(dW)||(pW.copy(o).invert(),uW.copy(i.ray).applyMatrix4(pW),null!==a.boundingBox&&!1===uW.intersectsBox(a.boundingBox)))return;let l,h,c,u,d,p,f=a.index,m=a.attributes.position,g=a.drawRange;if(!1===r){for(d=Math.max(0,g.start),p=Math.min(f.count,g.start+g.count);d<p;d+=3)if(h=f.getX(d),c=f.getX(d+1),u=f.getX(d+2),l=v(t,i,uW,m,h,c,u),l)return l.faceIndex=Math.floor(d/3),void n.push(l)}else{let e=a.attributes.position,r=new mm,o=new mm,l=new mm,h=new mm,c=2,u=1/((s.scale.x+s.scale.y+s.scale.z)/3),d=u*u;for(let a=Math.max(0,g.start),p=Math.min(e.count,g.start+g.count)-1;a<p;a+=c){if(r.fromBufferAttribute(e,a),o.fromBufferAttribute(e,a+1),uW.distanceSqToSegment(r,o,h,l)>d)continue;h.applyMatrix4(s.matrixWorld);let c=i.ray.origin.distanceTo(h);c<i.near||c>i.far||n.push({distance:c,point:l.clone().applyMatrix4(s.matrixWorld),object:t})}}function v(t,e,i,n,r,s,a){let o=new mm,l=new mm,h=new mm,c=new mm,u=new mm;if(o.fromBufferAttribute(n,r),l.fromBufferAttribute(n,s),h.fromBufferAttribute(n,a),null===i.intersectTriangle(o,l,h,!1,c))return null;u.copy(c),u.applyMatrix4(t.matrixWorld);let d=e.ray.origin.distanceTo(u);return d<e.near||d>e.far?null:{faceIndex:1,distance:d,point:u.clone(),object:t}}},mW=new mm,gW=new dv,vW=class extends Dx{constructor(t){let e=new Hg,i=new wx({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],r=[],s={},a=new nm(15711266),o=new nm(15711266),l=new nm(2857471);function h(t,e,i){c(t,i),c(e,i)}function c(t,e){n.push(0,0,0),r.push(e.r,e.g,e.b),void 0===s[t]&&(s[t]=[]),s[t].push(n.length/3-1)}h("n1","n2",a),h("n2","n4",a),h("n4","n3",a),h("n3","n1",a),h("f1","f2",a),h("f2","f4",a),h("f4","f3",a),h("f3","f1",a),h("n1","f1",a),h("n2","f2",a),h("n3","f3",a),h("n4","f4",a),h("p","n1",o),h("p","n2",o),h("p","n3",o),h("p","n4",o),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),e.setAttribute("position",new Bg(n,3)),e.setAttribute("color",new Bg(r,3)),super(e,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){let t=this.geometry,e=this.pointMap;gW.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let i=.8;yW("n1",e,t,gW,-1,-1,i),yW("n2",e,t,gW,1,-1,i),yW("n3",e,t,gW,-1,1,i),yW("n4",e,t,gW,1,1,i);let n=i;yW("f1",e,t,gW,-1,-1,n),yW("f2",e,t,gW,1,-1,n),yW("f3",e,t,gW,-1,1,n),yW("f4",e,t,gW,1,1,n);let r=n;yW("u1",e,t,gW,.35,1.1,r),yW("u2",e,t,gW,-.35,1.1,r),yW("u3",e,t,gW,0,1.55,r),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function yW(t,e,i,n,r,s,a){mW.set(r,s,a).unproject(n);let o=e[t];if(void 0!==o){let t=i.getAttribute("position");for(let e=0,i=o.length;e<i;e++)t.setXYZ(o[e],mW.x,mW.y,mW.z)}}var bW,xW=class extends(cW(vW)){constructor(t){super(t),this.object=t,this.object=t,this.name=`CombinedCameraHelper: ${t.uuid}`}updateMatrixWorld(t){super.updateMatrixWorld(t),this.updateTarget()}updateTarget(){let t=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(t)}raycast(t,e){fW(this.object,this.geometry,t,e,!0)}};(t=>{t.is=t=>"objectHelper"in t})(bW||(bW={}));var wW=(t,e)=>class extends(ez(t)){constructor(){super(...arguments),this.objectHelper=new e(this),this.gizmos={}}get geometryHelper(){return e.geometryHelper}raycast(t,e){this.objectHelper.raycast(t,e)}showGizmos(){for(let t in this.gizmos){let e=this.gizmos[t];e instanceof pA&&(e.visible=!0)}}updateEntityBoxSize(t,e){this.objectHelper.visible&&this.geometryHelper instanceof av?(t.setScalar(0),e.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(t,e)}hideGizmos(){for(let t in this.gizmos){let e=this.gizmos[t];e instanceof pA&&(e.visible=!1)}}},SW=new mm,AW=new mm,EW=new fm,_W=new mm,CW=new mm,MW=new mm,PW=class extends(wW(dv,xW)){constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{...UR.defaultData,name:""};super(),this._cameraType="OrthographicCamera",this.targetOffset=UI.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(t,e),this.previousProjectionMatrix=new Wm,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let i=this.width,n=this.height;this.orthoCamera=new Fv(-.5*i,.5*i,.5*n,-.5*n,-5e4,1e4),this.perspCamera=new pv(45,i/n,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return"PerspectiveCamera"===this.cameraType}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(t){this.perspCamera.fov=t}get fov(){return this.perspCamera.fov}setNear(t,e){"PerspectiveCamera"===t?this.perspCamera.near=e:this.orthoCamera.near=e}setZoom(t,e){e>=0&&("PerspectiveCamera"===t?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}set cameraType(t){"PerspectiveCamera"===t?this.toPerspective():"OrthographicCamera"===t&&this.toOrthographic()}get near(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.near:this.orthoCamera.near}set near(t){"PerspectiveCamera"===this._cameraType?this.perspCamera.near=t:this.orthoCamera.near=t}get zoom(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(t){t>=0&&("PerspectiveCamera"===this._cameraType?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}lookAt(t,e,i){"number"==typeof t&&(t=new mm(t,e,i)),super.lookAt(t),this.getWorldPosition(SW),this.targetOffset=SW.distanceTo(t)}getTarget(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new mm;return this.getWorldDirection(AW),this.getWorldPosition(SW),AW.multiplyScalar(this.targetOffset),t.copy(SW).add(AW),t}getDistanceToTarget(){let t=this.getTarget();return this.getWorldPosition(SW),SW.distanceTo(t)}updateUp(){this.getWorldQuaternion(EW),_W.set(0,0,1).applyQuaternion(EW),CW.copy(gg.DEFAULT_UP),this.isUpVectorFlipped&&CW.negate(),CW.applyQuaternion(EW),MW.copy(gg.DEFAULT_UP).projectOnPlane(_W),this.angleOffsetFromUp=MW.angleTo(CW),this.angleOffsetFromUp*=MW.cross(CW).dot(_W)>=0?1:-1}updateTransformState(t,e){let i=super.updateTransformState(t,e);return void 0!==t.isUpVectorFlipped&&(this.isUpVectorFlipped=t.isUpVectorFlipped),this.updateUp(),i}getViewFrontToObject(t){let e=t.getWorldPosition(new mm),i=t.getWorldDirection(new mm).multiplyScalar(this.targetOffset);return{position:e.clone().add(i),target:e}}getViewToTarget(t){let e=this.getWorldDirection(new mm).multiplyScalar(this.targetOffset);return{position:t.clone().sub(e),target:t}}getViewToObject(t){let e=new mm;t.getWorldPosition(e);return this.getViewToTarget(e)}setViewplaneSize(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.aspect=t/e,i){let i=t>e?this.aspect:1,n=t>e?1:this.aspect;this.left=-395*i,this.right=395*i,this.top=1/n*395,this.bottom=1/n*-395}else this.left=.5*-t,this.right=.5*t,this.top=.5*e,this.bottom=.5*-e;this.updateProjectionMatrix()}copyViewPlaneSize(t){this.aspect=t.aspect,this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(t){this.perspCamera.setFocalLength(t),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(t,e,i,n,r,s){"PerspectiveCamera"===this._cameraType?this.perspCamera.setViewOffset(t,e,i,n,r,s):this.orthoCamera.setViewOffset(t,e,i,n,r,s)}clearViewOffset(){"PerspectiveCamera"===this._cameraType?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){"PerspectiveCamera"===this._cameraType?this.toPerspective():"OrthographicCamera"===this._cameraType&&this.toOrthographic()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(t,e){return super.copy(t,e),this.parent=t.parent,this.orthoCamera.copy(t.orthoCamera),this.perspCamera.copy(t.perspCamera),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.far=t.far,this.view=null===t.view?null:Object.assign({},t.view),this._cameraType=t._cameraType,this.aspect=t.aspect,this.fov=t.fov,this.focus=t.focus,this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this.targetOffset=t.targetOffset,this.updateProjectionMatrix(),this}toCameraState(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return ZP(e,t)}updateCameraSubtype(t,e){let i="perspective"===t?"PerspectiveCamera":"OrthographicCamera";void 0!==e.zoom&&this.setZoom(i,e.zoom),void 0!==e.near&&this.setNear(i,e.near),void 0!==e.fov&&"PerspectiveCamera"===i&&(this.fov=e.fov)}updateState(t,e){this.updateCameraState(t,e)}updateCameraState(t,e){this.updateState_Entity(t,e),void 0!==t.far&&(this.far=t.far),void 0!==t.orthographic&&this.updateCameraSubtype("orthographic",t.orthographic),void 0!==t.perspective&&this.updateCameraSubtype("perspective",t.perspective),void 0!==t.type&&(this.cameraType=t.type),void 0!==t.up&&this.up.fromArray(t.up),void 0!==t.targetOffset&&(this.targetOffset=t.targetOffset),void 0!==t.isUpVectorFlipped&&(this.isUpVectorFlipped=t.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),1===t.path.length&&0===t.type&&this.updateCameraSubtype(t.path[0],t.props)}toState(t){return{...super.toState(t),...this.toCameraState(t),type:this.cameraType}}},TW=new Wm,DW=new Wm;function kW(t){let e=!1;return t.scene.objects.traverse(((t,i)=>{"BooleanGeometry"===i.geometry?.type&&(e=!0)})),e}var IW,RW=class extends fH{constructor(t,e,i){super(t,e),this.data=e,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new Hg,this.onAfterRender=(t,e,i,n,r,s)=>{super.onAfterRender(t,e,i,n,r,s),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),1===t.path.length&&"geometry"===t.path[0]&&0===t.type&&void 0!==t.props.operation&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(-1!==this.booleanMeshSetAddress&&!t)return;for(let n=0;n<this.children.length;n++){let i=this.children[n];i instanceof RW&&!0===i.dataPatched.visible&&i.recomputeBoolean(!0===t,e)}this.meshSetAddresses=[];for(let n=0;n<this.children.length;n++){let i=this.children[n];if(i instanceof CU&&!0===i.dataPatched.visible&&i.geometry.attributes.position?.count>0&&i.geometry.drawRange.count>0&&0!==i.booleanMeshSetAddress){TW.multiplyMatrices(i.hiddenMatrix,i.matrix);try{if(-1===i.booleanMeshSetAddress){if((i.geometry.index??i.geometry.getAttribute("position")).count/3<15e5&&(i.booleanMeshSetAddress=nU.getMeshSet(i.geometry,!0===t,e)),-1===i.booleanMeshSetAddress)return;nU.transformMeshSet(i.booleanMeshSetAddress,TW),i.booleanMatrixInvOld.copy(TW).invert(),i.booleanWasTransformed=!1}else i instanceof RW&&!0===i.needsTransformForDownstream?(nU.transformMeshSet(i.booleanMeshSetAddress,TW),i.needsTransformForDownstream=!1):!0===i.booleanWasTransformed&&(nU.transformMeshSet(i.booleanMeshSetAddress,DW.multiplyMatrices(TW,i.booleanMatrixInvOld)),i.booleanMatrixInvOld.copy(TW).invert(),i.booleanWasTransformed=!1)}catch(_I){console.error(_I),i.booleanMeshSetAddress=0,i.geometry.userData.booleanOperationDidFail=!0;continue}!1===nU.hasOpenEdges(i.booleanMeshSetAddress)||n===this.children.length-1&&2===this.booleanOp?(this.meshSetAddresses.push(i.booleanMeshSetAddress),i.geometry.userData.booleanOperationDidFail=!1):i.geometry.userData.booleanOperationDidFail="openEdges"}}if(0===this.meshSetAddresses.length)return this.geometry.setAttribute("position",new Bg([],0)),void this.geometry.setDrawRange(0,0);if(!0===t)return nU.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let i=this.geometry;i.dispose(),this.geometry=new Hg,this.geometry.userData=i.userData,this.geometry.boundingSphere=i.boundingSphere;try{this.booleanMeshSetAddress=nU.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(FI){this.booleanMeshSetAddress=0,this.geometry.userData.booleanOperationDidFail=!0,console.error(FI)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,wH(this),SH(this)}dispose(){super.dispose(),this.geometry.dispose()}};(t=>{t.is=function(t){return IB.is(t)&&t instanceof dS}})(IW||(IW={}));var OW=(t,e)=>class extends(wW(t,e)){updateState_Light(t,e){this.updateState_Entity(t,e),void 0!==t.color&&(this.color=e.shared.color(t.color)),void 0!==t.intensity&&(this.intensity=t.intensity),void 0!==t.depth&&(this.shadow.camera.far=t.depth,this.shadow.needsUpdate=!0),void 0!==t.shadows&&(this.castShadow=t.shadows)}},LW=t=>t instanceof CU,BW=t=>null!==t&&t instanceof RW,zW=t=>bW.is(t),FW=new mm(1,1,1),NW=new mm,UW=new mm,VW=new fm,jW=class extends(cW(fA)){constructor(t){super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:15),this.object=t,this.dummy=new Kb,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${t.uuid}`,this.matrix=this.dummy.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(t,e){fW(this.object,jW.geometryHelper,t,e,!1,this.dummy)}update(){}updateMatrix(){}updateMatrixWorld(t){this.object.matrixWorld.decompose(NW,VW,UW),this.matrix.compose(NW,VW,FW),super.updateMatrixWorld(t)}updateWorldMatrix(t,e){}},GW=class extends(wW(Kb,jW)){constructor(t,e){super(),this.super_Entity(t,e),this.objectHelper.update()}updateState(t,e){this.updateState_Entity(t,e),"buffer"in t&&1===Object.keys(t).length&&e.scene.reloadSplats()}},HW=class extends(wW(Kb,jW)){constructor(t,e,i){super(),this.super_Entity(t,e),this.context=i,this.objectHelper.update()}updateState(t,e){this.updateState_Entity(t,e)}},WW=0,qW=1,YW="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",XW=class extends uv{constructor(){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super({name:"BokehMaterial",defines:{PASS:arguments.length>0&&void 0!==arguments[0]&&arguments[0]?"2":"1"},uniforms:{kernel64:new qS(null),kernel16:new qS(null),inputBuffer:new qS(null),cocBuffer:new qS(null),texelSize:new qS(new Uf),scale:new qS(1)},blending:0,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;uniform vec4 kernel64[32];varying vec2 vUv;void main(){\n#ifdef FOREGROUND\nvec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;\n#else\nfloat CoC=texture2D(cocBuffer,vUv).g*scale;\n#endif\nif(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{\n#ifdef FOREGROUND\nvec2 step=texelSize*max(CoC,CoCNearFar.g*scale);\n#else\nvec2 step=texelSize*CoC;\n#endif\nvec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;}}",vertexShader:YW}),this.toneMapped=!1,t&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}set cocBuffer(t){this.uniforms.cocBuffer.value=t}setCoCBuffer(t){this.uniforms.cocBuffer.value=t}get scale(){return this.uniforms.scale.value}set scale(t){this.uniforms.scale.value=t}getScale(t){return this.uniforms.scale.value=t}setScale(t){this.uniforms.scale.value=t}generateKernel(){let t=new Float32Array(128),e=new Float32Array(32),i=0,n=0;for(let a=0;a<80;++a){let r=2.39996323*a,s=Math.sqrt(a)/Math.sqrt(80),o=s*Math.cos(r),l=s*Math.sin(r);a%5===0?(e[n++]=o,e[n++]=l):(t[i++]=o,t[i++]=l)}let r=[],s=[];for(let a=0;a<128;)r.push(new cm(t[a++],t[a++],t[a++],t[a++]));for(let a=0;a<32;)s.push(new cm(e[a++],e[a++],e[a++],e[a++]));this.uniforms.kernel64.value=r,this.uniforms.kernel16.value=s}setTexelSize(t,e){this.uniforms.texelSize.value.set(t,e)}setSize(t,e){this.uniforms.texelSize.value.set(1/t,1/e)}};function QW(t,e,i){return t*(e-i)-e}function KW(t,e,i){return Math.min(Math.max((t+e)/(e-i),0),1)}var ZW=class extends uv{constructor(t){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new qS(null),focusDistance:new qS(0),focusRange:new qS(0),cameraNear:new qS(.3),cameraFar:new qS(1e3)},blending:0,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#include <packing>\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}void main(){float depth=readDepth(vUv);\n#ifdef PERSPECTIVE_CAMERA\nfloat viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);\n#else\nfloat linearDepth=depth;\n#endif\nfloat signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}",vertexShader:YW}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(t)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(t){this.uniforms.depthBuffer.value=t}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yf;this.depthBuffer=t,this.depthPacking=e}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(t){this.uniforms.focusDistance.value=t}get worldFocusDistance(){return-QW(this.focusDistance,this.near,this.far)}set worldFocusDistance(t){this.focusDistance=KW(-t,this.near,this.far)}getFocusDistance(t){this.uniforms.focusDistance.value=t}setFocusDistance(t){this.uniforms.focusDistance.value=t}get focalLength(){return this.focusRange}set focalLength(t){this.focusRange=t}get focusRange(){return this.uniforms.focusRange.value}set focusRange(t){this.uniforms.focusRange.value=t}get worldFocusRange(){return-QW(this.focusRange,this.near,this.far)}set worldFocusRange(t){this.focusRange=KW(-t,this.near,this.far)}getFocalLength(t){return this.focusRange}setFocalLength(t){this.focusRange=t}adoptCameraSettings(t){t&&(this.uniforms.cameraNear.value=t.near,this.uniforms.cameraFar.value=t.far,t instanceof pv?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},JW=class extends uv{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uf;super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new qS(null),texelSize:new qS(new Uf),halfTexelSize:new qS(new Uf),kernel:new qS(0),scale:new qS(1)},blending:0,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#include <dithering_pars_fragment>\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nvarying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;\n#include <encodings_fragment>\n#include <dithering_fragment>\n}",vertexShader:"uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}"}),this.toneMapped=!1,this.setTexelSize(t.x,t.y)}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.inputBuffer=t}get scale(){return this.uniforms.scale.value}set scale(t){this.uniforms.scale.value=t}getScale(){return this.uniforms.scale.value}setScale(t){this.uniforms.scale.value=t}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(t){this.uniforms.kernel.value=t}setKernel(t){this.kernel=t}setTexelSize(t,e){this.uniforms.texelSize.value.set(t,e),this.uniforms.halfTexelSize.value.set(t,e).multiplyScalar(.5)}setSize(t,e){let i=this.uniforms;i.texelSize.value.set(1/t,1/e),i.halfTexelSize.value.copy(i.texelSize.value).multiplyScalar(.5)}},$W=class extends uv{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new qS(null),opacity:new qS(1)},blending:0,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;\n#include <encodings_fragment>\n}",vertexShader:YW}),this.toneMapped=!1}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}getOpacity(t){return this.uniforms.opacity.value}setOpacity(t){this.uniforms.opacity.value=t}},tq={DEPTH:0,LUMA:1,COLOR:2},eq={DISABLED:0,DEPTH:1,CUSTOM:2},iq=class extends uv{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uf,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tq.COLOR;super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:dp.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new qS(null),depthBuffer:new qS(null),predicationBuffer:new qS(null),texelSize:new qS(t)},blending:0,depthWrite:!1,depthTest:!1,fragmentShader:"varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#if EDGE_DETECTION_MODE != 0\nvarying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;\n#endif\n#if EDGE_DETECTION_MODE == 1\n#include <common>\n#endif\n#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nfloat readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}\n#elif PREDICATION_MODE == 2\nuniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}\n#endif\n#if PREDICATION_MODE != 0\nvec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}\n#endif\n#if EDGE_DETECTION_MODE != 0\nuniform sampler2D inputBuffer;\n#endif\nvoid main(){\n#if EDGE_DETECTION_MODE == 0\nconst vec2 threshold=vec2(DEPTH_THRESHOLD);\n#elif PREDICATION_MODE != 0\nvec2 threshold=calculatePredicatedThreshold();\n#else\nconst vec2 threshold=vec2(EDGE_THRESHOLD);\n#endif\n#if EDGE_DETECTION_MODE == 0\nvec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);\n#elif EDGE_DETECTION_MODE == 1\nfloat l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);\n#elif EDGE_DETECTION_MODE == 2\nvec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);\n#endif\n}",vertexShader:"uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;\n#if EDGE_DETECTION_MODE != 0\nvarying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;\n#endif\nvoid main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);\n#if EDGE_DETECTION_MODE != 0\nvUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);\n#endif\ngl_Position=vec4(position.xy,1.0,1.0);}"}),this.toneMapped=!1,this.edgeDetectionMode=e}set depthBuffer(t){this.uniforms.depthBuffer.value=t}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yf;this.depthBuffer=t,this.depthPacking=e}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(t){this.defines.EDGE_DETECTION_MODE=t.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(t){this.edgeDetectionMode=t}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(t){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=t.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(t){this.localContrastAdaptationFactor=t}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(t){this.defines.EDGE_THRESHOLD=t.toFixed("6"),this.defines.DEPTH_THRESHOLD=(.1*t).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(t){this.edgeDetectionThreshold=t}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(t){this.defines.PREDICATION_MODE=t.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(t){this.predicationMode=t}set predicationBuffer(t){this.uniforms.predicationBuffer.value=t}setPredicationBuffer(t){this.uniforms.predicationBuffer.value=t}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(t){this.defines.PREDICATION_THRESHOLD=t.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(t){this.predicationThreshold=t}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(t){this.defines.PREDICATION_SCALE=t.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(t){this.predicationScale=t}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(t){this.defines.PREDICATION_STRENGTH=t.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(t){this.predicationStrength=t}setSize(t,e){this.uniforms.texelSize.value.set(1/t,1/e)}},nq="#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#define packFloatToRGBA(v) packDepthToRGBA(v)\n#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#if THREE_REVISION >= 137\nvec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}\n#endif\nfloat readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}float getViewZ(const in float depth){\n#ifdef PERSPECTIVE_CAMERA\nreturn perspectiveDepthToViewZ(depth,cameraNear,cameraFar);\n#else\nreturn orthographicDepthToViewZ(depth,cameraNear,cameraFar);\n#endif\n}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;\n#ifdef ENCODE_OUTPUT\n#include <encodings_fragment>\n#endif\n#include <dithering_fragment>\n}",rq={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},sq=class extends uv{constructor(t,e,i,n){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super({name:"EffectMaterial",defines:{THREE_REVISION:dp.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new qS(null),depthBuffer:new qS(null),resolution:new qS(new Uf),texelSize:new qS(new Uf),cameraNear:new qS(.3),cameraFar:new qS(1e3),aspect:new qS(1),time:new qS(0)},blending:0,depthWrite:!1,depthTest:!1,dithering:r}),this.toneMapped=!1,t&&this.setShaderParts(t),e&&this.setDefines(e),i&&this.setUniforms(i),this.adoptCameraSettings(n)}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(t){this.uniforms.depthBuffer.value=t}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yf;this.depthBuffer=t,this.depthPacking=e}setShaderParts(t){return this.fragmentShader=nq.replace(rq.FRAGMENT_HEAD,t.get(rq.FRAGMENT_HEAD)).replace(rq.FRAGMENT_MAIN_UV,t.get(rq.FRAGMENT_MAIN_UV)).replace(rq.FRAGMENT_MAIN_IMAGE,t.get(rq.FRAGMENT_MAIN_IMAGE)),this.vertexShader="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}".replace(rq.VERTEX_HEAD,t.get(rq.VERTEX_HEAD)).replace(rq.VERTEX_MAIN_SUPPORT,t.get(rq.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(t){for(let e of t.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(t){for(let e of t.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(t){this.extensions={};for(let e of t)this.extensions[e]=!0;return this}get encodeOutput(){return void 0!==this.defines.ENCODE_OUTPUT}set encodeOutput(t){this.encodeOutput!==t&&(t?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(t){return this.encodeOutput}setOutputEncodingEnabled(t){this.encodeOutput=t}get time(){return this.uniforms.time.value}set time(t){this.uniforms.time.value=t}setDeltaTime(t){this.uniforms.time.value+=t}adoptCameraSettings(t){t&&(this.uniforms.cameraNear.value=t.near,this.uniforms.cameraFar.value=t.far,t instanceof pv?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(t,e){let i=this.uniforms;i.resolution.value.set(t,e),i.texelSize.value.set(1/t,1/e),i.aspect.value=t/e}static get Section(){return rq}},aq=class extends uv{constructor(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super({name:"LuminanceMaterial",defines:{THREE_REVISION:dp.replace(/\D+/g,"")},uniforms:{inputBuffer:new qS(null),threshold:new qS(0),smoothing:new qS(1),range:new qS(null)},blending:0,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef RANGE\nuniform vec2 range;\n#elif defined(THRESHOLD)\nuniform float threshold;uniform float smoothing;\n#endif\nvarying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);\n#ifdef RANGE\nfloat low=step(range.x,l);float high=step(l,range.y);l*=low*high;\n#elif defined(THRESHOLD)\nl=smoothstep(threshold,threshold+smoothing,l);\n#endif\n#ifdef COLOR\ngl_FragColor=vec4(texel.rgb*l,l);\n#else\ngl_FragColor=vec4(l);\n#endif\n}",vertexShader:YW}),this.toneMapped=!1,this.colorOutput=t,this.luminanceRange=e}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}get threshold(){return this.uniforms.threshold.value}set threshold(t){this.smoothing>0||t>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=t}getThreshold(){return this.threshold}setThreshold(t){this.threshold=t}get smoothing(){return this.uniforms.smoothing.value}set smoothing(t){this.threshold>0||t>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=t}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(t){this.smoothing=t}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(t){}get colorOutput(){return void 0!==this.defines.COLOR}set colorOutput(t){t?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(t){return this.colorOutput}setColorOutputEnabled(t){this.colorOutput=t}get useRange(){return null!==this.luminanceRange}set useRange(t){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(t){null!==t?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=t,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(t){this.luminanceRange=t}},oq=0,lq=1,hq=class extends uv{constructor(){super({name:"MaskMaterial",uniforms:{maskTexture:new qS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null),inputBuffer:new qS(null),strength:new qS(1)},blending:0,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef MASK_PRECISION_HIGH\nuniform mediump sampler2D maskTexture;\n#else\nuniform lowp sampler2D maskTexture;\n#endif\n#if MASK_FUNCTION != 0\nuniform float strength;\n#endif\nvarying vec2 vUv;void main(){\n#if COLOR_CHANNEL == 0\nfloat mask=texture2D(maskTexture,vUv).r;\n#elif COLOR_CHANNEL == 1\nfloat mask=texture2D(maskTexture,vUv).g;\n#elif COLOR_CHANNEL == 2\nfloat mask=texture2D(maskTexture,vUv).b;\n#else\nfloat mask=texture2D(maskTexture,vUv).a;\n#endif\n#if MASK_FUNCTION == 0\n#ifdef INVERTED\nmask=step(mask,0.0);\n#else\nmask=1.0-step(mask,0.0);\n#endif\n#else\nmask=clamp(mask*strength,0.0,1.0);\n#ifdef INVERTED\nmask=1.0-mask;\n#endif\n#endif\n#if MASK_FUNCTION == 2\ngl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);\n#else\ngl_FragColor=mask*texture2D(inputBuffer,vUv);\n#endif\n}",vertexShader:YW}),this.toneMapped=!1,this.setColorChannel(WW),this.setMaskFunction(oq)}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}set maskTexture(t){this.uniforms.maskTexture.value=t,delete this.defines.MASK_PRECISION_HIGH,t.type!==qp&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(t){this.maskTexture=t}set colorChannel(t){this.defines.COLOR_CHANNEL=t.toFixed(0),this.needsUpdate=!0}setColorChannel(t){this.colorChannel=t}set maskFunction(t){this.defines.MASK_FUNCTION=t.toFixed(0),this.needsUpdate=!0}setMaskFunction(t){this.maskFunction=t}get inverted(){return void 0!==this.defines.INVERTED}set inverted(t){this.inverted&&!t?delete this.defines.INVERTED:t&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(t){this.inverted=t}get strength(){return this.uniforms.strength.value}set strength(t){this.uniforms.strength.value=t}getStrength(){return this.strength}setStrength(t){this.strength=t}},cq=class extends uv{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uf,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Uf;super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new qS(null),searchTexture:new qS(null),areaTexture:new qS(null),resolution:new qS(e),texelSize:new qS(t)},blending:0,depthWrite:!1,depthTest:!1,fragmentShader:"#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)\n#if __VERSION__ < 300\n#define round(v) floor(v + 0.5)\n#endif\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){\n#if !defined(DISABLE_CORNER_DETECTION)\nvec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);\n#endif\n}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){\n#if !defined(DISABLE_CORNER_DETECTION)\nvec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);\n#endif\n}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){\n#if !defined(DISABLE_DIAG_DETECTION)\nweights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){\n#endif\nvec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);\n#if !defined(DISABLE_DIAG_DETECTION)\n}else{e.r=0.0;}\n#endif\n}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}",vertexShader:"uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}"}),this.toneMapped=!1}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(t){this.uniforms.searchTexture.value=t}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(t){this.uniforms.areaTexture.value=t}setLookupTextures(t,e){this.searchTexture=t,this.areaTexture=e}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(t){let e=Math.min(Math.max(t,0),112);this.defines.MAX_SEARCH_STEPS_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(t){this.orthogonalSearchSteps=t}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(t){let e=Math.min(Math.max(t,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(t){this.diagonalSearchSteps=t}get diagonalDetection(){return void 0===this.defines.DISABLE_DIAG_DETECTION}set diagonalDetection(t){t?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(t){this.diagonalDetection=t}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(t){let e=Math.min(Math.max(t,0),100);this.defines.CORNER_ROUNDING=e.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(e/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(t){this.cornerRounding=t}get cornerDetection(){return void 0===this.defines.DISABLE_CORNER_DETECTION}set cornerDetection(t){t?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(t){this.cornerDetection=t}setSize(t,e){let i=this.uniforms;i.texelSize.value.set(1/t,1/e),i.resolution.value.set(t,e)}},uq=new dv,dq=null;var pq=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Pass",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new sx,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:uq;this.name=t,this.renderer=null,this.scene=e,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(t){if(this.rtt===t){let e=this.getFullscreenMaterial();null!==e&&(e.needsUpdate=!0),this.rtt=!t}}setRenderer(t){this.renderer=t}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}get fullscreenMaterial(){return null!==this.screen?this.screen.material:null}set fullscreenMaterial(t){let e=this.screen;null!==e?e.material=t:(e=new rv(function(){if(null===dq){let t=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]);void 0!==(dq=new Hg).setAttribute?(dq.setAttribute("position",new Rg(t,3)),dq.setAttribute("uv",new Rg(e,2))):(dq.addAttribute("position",new Rg(t,3)),dq.addAttribute("uv",new Rg(e,2)))}return dq}(),t),e.frustumCulled=!1,null===this.scene&&(this.scene=new sx),this.scene.add(e),this.screen=e)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(t){this.fullscreenMaterial=t}getDepthTexture(){return null}setDepthTexture(t){}render(t,e,i,n,r){throw new Error("Render method not implemented!")}setSize(t,e){}initialize(t,e,i){}dispose(){for(let t of Object.keys(this)){let e=this[t];if(null!==e&&"object"==typeof e&&"function"==typeof e.dispose){if(e instanceof sx||e===this.renderer)continue;this[t].dispose()}}}},fq=class extends pq{constructor(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super("CopyPass"),this.fullscreenMaterial=new $W,this.needsSwap=!1,this.renderTarget=t,void 0===t&&(this.renderTarget=new um(1,1,{minFilter:Gp,magFilter:Gp,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(t){this.autoResize=t}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(t){this.autoResize=t}render(t,e,i,n,r){this.fullscreenMaterial.inputBuffer=e.texture,t.setRenderTarget(this.renderToScreen?null:this.renderTarget),t.render(this.scene,this.camera)}setSize(t,e){this.autoResize&&this.renderTarget.setSize(t,e)}initialize(t,e,i){void 0!==i&&(this.renderTarget.texture.type=i,i!==qp?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":t.outputEncoding===vf&&(this.renderTarget.texture.encoding=vf))}},mq=class extends pq{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(t,e,i,n,r){let s=t.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},gq=new nm,vq=class extends pq{constructor(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super("ClearPass",null,null),this.needsSwap=!1,this.color=t,this.depth=e,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(t,e,i){this.color=t,this.depth=e,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(t){this.overrideClearColor=t}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(t){this.overrideClearAlpha=t}render(t,e,i,n,r){let s=this.overrideClearColor,a=this.overrideClearAlpha,o=t.getClearAlpha(),l=null!==s,h=a>=0;l?(gq.copy(t.getClearColor(gq)),t.setClearColor(s,h?a:o)):h&&t.setClearAlpha(a),t.setRenderTarget(this.renderToScreen?null:e),t.clear(this.color,this.depth,this.stencil),l?t.setClearColor(gq,o):h&&t.setClearAlpha(o)}},yq=-1,bq=class extends _f{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yq,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:yq,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.resizable=t,this.base=new Uf(1,1),this.preferred=new Uf(e,i),this.target=this.preferred,this.s=n}get width(){let t,{base:e,preferred:i,scale:n}=this;return t=i.width!==yq?i.width:i.height!==yq?Math.round(i.height*(e.width/Math.max(e.height,1))):Math.round(e.width*n),t}set width(t){this.preferredWidth=t}get height(){let t,{base:e,preferred:i,scale:n}=this;return t=i.height!==yq?i.height:i.width!==yq?Math.round(i.width/Math.max(e.width/Math.max(e.height,1),1)):Math.round(e.height*n),t}set height(t){this.preferredHeight=t}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(t){this.s!==t&&(this.s=t,this.preferred.setScalar(yq),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(t){this.scale=t}get baseWidth(){return this.base.width}set baseWidth(t){this.base.width!==t&&(this.base.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(t){this.base.width!==t&&(this.base.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(t){this.base.height!==t&&(this.base.height=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(t){this.baseHeight=t}setBaseSize(t,e){(this.base.width!==t||this.base.height!==e)&&(this.base.set(t,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(t){this.preferred.width!==t&&(this.preferred.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(t){this.preferredWidth=t}get preferredHeight(){return this.preferred.height}set preferredHeight(t){this.preferred.height!==t&&(this.preferred.height=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(t){this.preferredHeight=t}setPreferredSize(t,e){(this.preferred.width!==t||this.preferred.height!==e)&&(this.preferred.set(t,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(t){this.base.set(t.getBaseWidth(),t.getBaseHeight()),this.preferred.set(t.getPreferredWidth(),t.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return yq}},xq=!1,wq=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(t),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let e;if(t.material.flatShading)switch(t.material.side){case 2:e=this.materialsFlatShadedDoubleSide;break;case 1:e=this.materialsFlatShadedBackSide;break;default:e=this.materialsFlatShaded}else switch(t.material.side){case 2:e=this.materialsDoubleSide;break;case 1:e=this.materialsBackSide;break;default:e=this.materials}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=e[2]:t.isInstancedMesh?t.material=e[1]:t.material=e[0],++this.meshCount}}}setMaterial(t){if(this.disposeMaterials(),this.material=t,null!==t){let e=this.materials=[t.clone(),t.clone(),t.clone()];for(let i of e)i.uniforms=Object.assign({},t.uniforms),i.side=0;e[2].skinning=!0,this.materialsBackSide=e.map((e=>{let i=e.clone();return i.uniforms=Object.assign({},t.uniforms),i.side=1,i})),this.materialsDoubleSide=e.map((e=>{let i=e.clone();return i.uniforms=Object.assign({},t.uniforms),i.side=2,i})),this.materialsFlatShaded=e.map((e=>{let i=e.clone();return i.uniforms=Object.assign({},t.uniforms),i.flatShading=!0,i})),this.materialsFlatShadedBackSide=e.map((e=>{let i=e.clone();return i.uniforms=Object.assign({},t.uniforms),i.flatShading=!0,i.side=1,i})),this.materialsFlatShadedDoubleSide=e.map((e=>{let i=e.clone();return i.uniforms=Object.assign({},t.uniforms),i.flatShading=!0,i.side=2,i}))}}render(t,e,i){let n=t.shadowMap.enabled;if(t.shadowMap.enabled=!1,xq){let n=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),t.render(e,i);for(let t of n)t[0].material=t[1];this.meshCount!==n.size&&n.clear()}else{let n=e.overrideMaterial;e.overrideMaterial=this.material,t.render(e,i),e.overrideMaterial=n}t.shadowMap.enabled=n}disposeMaterials(){if(null!==this.material){let t=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let e of t)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return xq}static set workaroundEnabled(t){xq=t}},Sq=class extends pq{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super("RenderPass",t,e),this.needsSwap=!1,this.clearPass=new vq,this.overrideMaterialManager=null===i?null:new wq(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(t){super.renderToScreen=t,this.clearPass.renderToScreen=t}get overrideMaterial(){let t=this.overrideMaterialManager;return null!==t?t.material:null}set overrideMaterial(t){let e=this.overrideMaterialManager;null!==t?null!==e?e.setMaterial(t):this.overrideMaterialManager=new wq(t):null!==e&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(t){this.overrideMaterial=t}get clear(){return this.clearPass.enabled}set clear(t){this.clearPass.enabled=t}getSelection(){return this.selection}setSelection(t){this.selection=t}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(t){this.ignoreBackground=t}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(t){this.skipShadowMapUpdate=t}getClearPass(){return this.clearPass}render(t,e,i,n,r){let s=this.scene,a=this.camera,o=this.selection,l=a.layers.mask,h=s.background,c=t.shadowMap.autoUpdate,u=this.renderToScreen?null:e;null!==o&&a.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(t.shadowMap.autoUpdate=!1),(this.ignoreBackground||null!==this.clearPass.overrideClearColor)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(t,e),t.setRenderTarget(u),null!==this.overrideMaterialManager?this.overrideMaterialManager.render(t,s,a):t.render(s,a),a.layers.mask=l,s.background=h,t.shadowMap.autoUpdate=c}},Aq=class extends pq{constructor(t,e){let{resolutionScale:i=1,width:n=bq.AUTO_SIZE,height:r=bq.AUTO_SIZE,renderTarget:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super("DepthPass"),this.needsSwap=!1,this.renderPass=new Sq(t,e,new Gb({depthPacking:3201}));let a=this.renderPass;a.skipShadowMapUpdate=!0,a.ignoreBackground=!0;let o=a.getClearPass();o.overrideClearColor=new nm(16777215),o.overrideClearAlpha=1,this.renderTarget=s,void 0===this.renderTarget&&(this.renderTarget=new um(1,1,{minFilter:Up,magFilter:Up,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let l=this.resolution=new bq(this,n,r,i);l.addEventListener("change",(t=>this.setSize(l.baseWidth,l.baseHeight)))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}render(t,e,i,n,r){let s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(t,s)}setSize(t,e){let i=this.resolution;i.setBaseSize(t,e),this.renderTarget.setSize(i.width,i.height)}},Eq=(new Float32Array([255/256/256**3,255/256/65536,255/256/256,255/256]),{SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18}),_q=new Map([[Eq.SKIP,null],[Eq.ADD,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}"],[Eq.ALPHA,"vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}"],[Eq.AVERAGE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}"],[Eq.COLOR_BURN,"float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[Eq.COLOR_DODGE,"float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[Eq.DARKEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}"],[Eq.DIFFERENCE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}"],[Eq.EXCLUSION,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}"],[Eq.LIGHTEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}"],[Eq.MULTIPLY,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}"],[Eq.DIVIDE,"float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[Eq.NEGATION,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}"],[Eq.NORMAL,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}"],[Eq.OVERLAY,"float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[Eq.REFLECT,"float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[Eq.SCREEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}"],[Eq.SOFT_LIGHT,"float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[Eq.SUBTRACT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}"]]),Cq=class extends _f{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.f=t,this.opacity=new qS(e)}getOpacity(){return this.opacity.value}setOpacity(t){this.opacity.value=t}get blendFunction(){return this.f}set blendFunction(t){this.f=t,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(t){this.blendFunction=t}getShaderCode(){return _q.get(this.blendFunction)}},Mq={NONE:0,DEPTH:1,CONVOLUTION:2},Pq=class extends _f{constructor(t,e){let{attributes:i=Mq.NONE,blendFunction:n=Eq.SCREEN,defines:r=new Map,uniforms:s=new Map,extensions:a=null,vertexShader:o=null}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.name=t,this.renderer=null,this.attributes=i,this.fragmentShader=e,this.vertexShader=o,this.defines=r,this.uniforms=s,this.extensions=a,this.blendMode=new Cq(n),this.blendMode.addEventListener("change",(t=>this.setChanged()))}getName(){return this.name}setRenderer(t){this.renderer=t}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(t){this.attributes=t,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(t){this.fragmentShader=t,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(t){this.vertexShader=t,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(t){}update(t,e,i){}setSize(t,e){}initialize(t,e,i){}dispose(){for(let t of Object.keys(this)){let e=this[t];if(null!==e&&"object"==typeof e&&"function"==typeof e.dispose){if(e instanceof sx||e===this.renderer)continue;this[t].dispose()}}}};function Tq(t,e,i){for(let n of e){let e="$1"+t+n.charAt(0).toUpperCase()+n.slice(1),r=new RegExp("([^\\.])(\\b"+n+"\\b)","g");for(let t of i.entries())null!==t[1]&&i.set(t[0],t[1].replace(r,e))}}function Dq(t,e,i,n,r,s,a){let o=new Map([["fragment",e.getFragmentShader()],["vertex",e.getVertexShader()]]),l=void 0!==o.get("fragment")&&/mainImage/.test(o.get("fragment")),h=void 0!==o.get("fragment")&&/mainUv/.test(o.get("fragment")),c=[],u=[],d=!1,p=!1;if(void 0===o.get("fragment"))console.error("Missing fragment shader",e);else if(h&&0!==(a&Mq.CONVOLUTION))console.error("Effects that transform UV coordinates are incompatible with convolution effects",e);else if(l||h){let f=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,m=sq.Section;if(h){let e=`\t${t}MainUv(UV);\n`;i.set(m.FRAGMENT_MAIN_UV,i.get(m.FRAGMENT_MAIN_UV)+e),d=!0}if(null!==o.get("vertex")&&/mainSupport/.test(o.get("vertex"))){let e=`\t${t}MainSupport(`;e+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(o.get("vertex"))?"vUv);\n":");\n",i.set(m.VERTEX_MAIN_SUPPORT,i.get(m.VERTEX_MAIN_SUPPORT)+e),c=c.concat([...o.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map((t=>t[1]))),u=u.concat(c).concat([...o.get("vertex").matchAll(f)].map((t=>t[1])))}u=u.concat([...o.get("fragment").matchAll(f)].map((t=>t[1]))),u=u.concat([...e.defines.keys()].map((t=>t.replace(/\([\w\s,]*\)/g,"")))),u=u.concat([...e.uniforms.keys()]),e.uniforms.forEach(((e,i)=>s.set(t+i.charAt(0).toUpperCase()+i.slice(1),e))),e.defines.forEach(((e,i)=>r.set(t+i.charAt(0).toUpperCase()+i.slice(1),e))),Tq(t,u,r),Tq(t,u,o);let g=e.blendMode;if(n.set(g.blendFunction,g),l){let e=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/,n=`${t}MainImage(color0, UV, `;0!==(a&Mq.DEPTH)&&e.test(o.get("fragment"))&&(n+="depth, ",p=!0),n+="color1);\n\t";let r=t+"BlendOpacity";s.set(r,g.opacity),n+=`color0 = blend${g.blendFunction}(color0, color1, ${r});\n\n\t`,i.set(m.FRAGMENT_MAIN_IMAGE,i.get(m.FRAGMENT_MAIN_IMAGE)+n),n=`uniform float ${r};\n\n`,i.set(m.FRAGMENT_HEAD,i.get(m.FRAGMENT_HEAD)+n)}i.set(m.FRAGMENT_HEAD,i.get(m.FRAGMENT_HEAD)+o.get("fragment")+"\n"),null!==o.get("vertex")&&i.set(m.VERTEX_HEAD,i.get(m.VERTEX_HEAD)+o.get("vertex")+"\n")}else console.error("The fragment shader contains neither a mainImage nor a mainUv function",e);return{varyings:c,transformedUv:d,readDepth:p}}var kq=class extends pq{constructor(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];super("EffectPass"),this.fullscreenMaterial=new sq(null,null,null,t),this.effects=i.sort(((t,e)=>e.attributes-t.attributes)),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(t){this.fullscreenMaterial.encodeOutput=t}get dithering(){return this.fullscreenMaterial.dithering}set dithering(t){let e=this.fullscreenMaterial;e.dithering=t,e.needsUpdate=!0}verifyResources(){let t=this.renderer.capabilities,e=Math.min(t.maxFragmentUniforms,t.maxVertexUniforms);this.uniformCount>e&&console.warn("The current rendering context doesn't support more than "+e+" uniforms, but "+this.uniformCount+" were defined"),e=t.maxVaryings,this.varyingCount>e&&console.warn("The current rendering context doesn't support more than "+e+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let t=sq.Section,e=new Map([[t.FRAGMENT_HEAD,""],[t.FRAGMENT_MAIN_UV,""],[t.FRAGMENT_MAIN_IMAGE,""],[t.VERTEX_HEAD,""],[t.VERTEX_MAIN_SUPPORT,""]]),i=new Map,n=new Map,r=new Map,s=new Set,a=0,o=0,l=0,h=!1,c=!1;for(let d of this.effects)if(d.blendMode.blendFunction===Eq.SKIP)l|=d.getAttributes()&Mq.DEPTH;else if(0!==(l&d.getAttributes()&Mq.CONVOLUTION))console.error("Convolution effects cannot be merged",d);else{l|=d.getAttributes();let t=Dq("e"+a++,d,e,i,n,r,l);if(o+=t.varyings.length,h=h||t.transformedUv,c=c||t.readDepth,null!==d.extensions)for(let e of d.extensions)s.add(e)}let u=/\bblend\b/g;for(let d of i.values()){let i=d.getShaderCode().replace(u,`blend${d.blendFunction}`);e.set(t.FRAGMENT_HEAD,e.get(t.FRAGMENT_HEAD)+i+"\n")}if(0!==(l&Mq.DEPTH)){if(c){let i="float depth = readDepth(UV);\n\n\t";e.set(t.FRAGMENT_MAIN_IMAGE,i+e.get(t.FRAGMENT_MAIN_IMAGE))}this.needsDepthTexture=null===this.getDepthTexture()}else this.needsDepthTexture=!1;if(h){let i="vec2 transformedUv = vUv;\n";e.set(t.FRAGMENT_MAIN_UV,i+e.get(t.FRAGMENT_MAIN_UV)),n.set("UV","transformedUv")}else n.set("UV","vUv");e.forEach(((t,e,i)=>i.set(e,t.trim().replace(/^#/,"\n#")))),this.uniformCount=r.size,this.varyingCount=o,this.skipRendering=0===a,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(e).setExtensions(s).setUniforms(r).setDefines(n)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yf;this.fullscreenMaterial.depthBuffer=t,this.fullscreenMaterial.depthPacking=e;for(let i of this.effects)i.setDepthTexture(t,e)}render(t,e,i,n,r){for(let s of this.effects)s.update(t,e,n);if(!this.skipRendering||this.renderToScreen){let r=this.fullscreenMaterial;r.inputBuffer=e.texture,r.time+=n,t.setRenderTarget(this.renderToScreen?null:i),t.render(this.scene,this.camera)}}setSize(t,e){this.fullscreenMaterial.setSize(t,e);for(let i of this.effects)i.setSize(t,e)}initialize(t,e,i){this.renderer=t;for(let n of this.effects)n.initialize(t,e,i),n.addEventListener("change",(t=>this.handleEvent(t)));this.updateMaterial(),this.verifyResources(),void 0!==i&&i!==qp&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(let t of this.effects)t.dispose()}handleEvent(t){if("change"===t.type)this.recompile()}},Iq=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],Rq=class extends pq{constructor(){let{resolutionScale:t=.5,width:e=bq.AUTO_SIZE,height:i=bq.AUTO_SIZE,kernelSize:n=Nq.LARGE}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("KawaseBlurPass"),this.renderTargetA=new um(1,1,{minFilter:Gp,magFilter:Gp,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let r=this.resolution=new bq(this,e,i,t);r.addEventListener("change",(t=>this.setSize(r.baseWidth,r.baseHeight))),this.blurMaterial=new JW,this.ditheredBlurMaterial=new JW,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=n}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(t){this.resolution.preferredWidth=t}get height(){return this.resolution.height}set height(t){this.resolution.preferredHeight=t}get scale(){return this.blurMaterial.scale}set scale(t){this.blurMaterial.scale=t}getScale(){return this.blurMaterial.scale}setScale(t){this.blurMaterial.scale=t}getKernelSize(){return this.kernelSize}setKernelSize(t){this.kernelSize=t}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}render(t,e,i,n,r){let s,a,o=this.scene,l=this.camera,h=this.renderTargetA,c=this.renderTargetB,u=Iq[this.kernelSize],d=this.blurMaterial,p=e;for(this.fullscreenMaterial=d,s=0,a=u.length-1;s<a;++s){let e=0===(1&s)?h:c;d.kernel=u[s],d.inputBuffer=p.texture,t.setRenderTarget(e),t.render(o,l),p=e}this.dithering&&(d=this.ditheredBlurMaterial,this.fullscreenMaterial=d),d.kernel=u[s],d.inputBuffer=p.texture,t.setRenderTarget(this.renderToScreen?null:i),t.render(o,l)}setSize(t,e){let i=this.resolution;i.setBaseSize(t,e);let n=i.width,r=i.height;this.renderTargetA.setSize(n,r),this.renderTargetB.setSize(n,r),this.blurMaterial.setSize(n,r),this.ditheredBlurMaterial.setSize(n,r)}initialize(t,e,i){void 0!==i&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==qp?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):t.outputEncoding===vf&&(this.renderTargetA.texture.encoding=vf,this.renderTargetB.texture.encoding=vf))}static get AUTO_SIZE(){return bq.AUTO_SIZE}},Oq=class extends pq{constructor(){let{width:t=bq.AUTO_SIZE,height:e=bq.AUTO_SIZE,renderTarget:i,luminanceRange:n,colorOutput:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("LuminancePass"),this.fullscreenMaterial=new aq(r,n),this.needsSwap=!1,this.renderTarget=i,void 0===this.renderTarget&&(this.renderTarget=new um(1,1,{minFilter:Gp,magFilter:Gp,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let s=this.resolution=new bq(this,t,e);s.addEventListener("change",(t=>this.setSize(s.baseWidth,s.baseHeight)))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(t,e,i,n,r){this.fullscreenMaterial.inputBuffer=e.texture,t.setRenderTarget(this.renderToScreen?null:this.renderTarget),t.render(this.scene,this.camera)}setSize(t,e){let i=this.resolution;i.setBaseSize(t,e),this.renderTarget.setSize(i.width,i.height)}initialize(t,e,i){void 0!==i&&i!==qp&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Lq=class extends pq{constructor(t,e){super("MaskPass",t,e),this.needsSwap=!1,this.clearPass=new vq(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(t){this.inverse=t}get clear(){return this.clearPass.enabled}set clear(t){this.clearPass.enabled=t}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(t){this.inverted=t}render(t,e,i,n,r){let s=t.getContext(),a=t.state.buffers,o=this.scene,l=this.camera,h=this.clearPass,c=this.inverted?0:1,u=1-c;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),a.stencil.setFunc(s.ALWAYS,c,4294967295),a.stencil.setClear(u),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?h.render(t,null):(h.render(t,e),h.render(t,i))),this.renderToScreen?(t.setRenderTarget(null),t.render(o,l)):(t.setRenderTarget(e),t.render(o,l),t.setRenderTarget(i),t.render(o,l)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(s.EQUAL,1,4294967295),a.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),a.stencil.setLocked(!0)}},Bq=class extends pq{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"inputBuffer";super("ShaderPass"),this.fullscreenMaterial=t,this.inputBufferUniform=null,this.setInput(e)}setInput(t){if(this.inputBufferUniform=null,null!==this.fullscreenMaterial){let e=this.fullscreenMaterial.uniforms;void 0!==e&&void 0!==e[t]&&(this.inputBufferUniform=e[t])}}render(t,e,i,n,r){null!==this.inputBufferUniform&&null!==e&&(this.inputBufferUniform.value=e.texture),t.setRenderTarget(this.renderToScreen?null:i),t.render(this.scene,this.camera)}initialize(t,e,i){void 0!==i&&i!==qp&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},zq=.001,Fq=class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(t){return this.fixedDeltaEnabled=t,this}isAutoResetEnabled(t){return this.autoReset}setAutoResetEnabled(t){return typeof document<"u"&&void 0!==document.hidden&&(t?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=t),this}getDelta(){return this.delta*zq}getFixedDelta(){return this.fixedDelta*zq}setFixedDelta(t){return this.fixedDelta=1e3*t,this}getElapsed(){return this.elapsed*zq}getTimescale(){return this.timescale}setTimescale(t){return this.timescale=t,this}update(t){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=void 0!==t?t:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(t){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}},Nq={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},Uq=class extends Pq{constructor(){let{blendFunction:t=Eq.SCREEN,luminanceThreshold:e=.9,luminanceSmoothing:i=.025,resolutionScale:n=.5,intensity:r=1,width:s=bq.AUTO_SIZE,height:a=bq.AUTO_SIZE,kernelSize:o=Nq.LARGE}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("BloomEffect","#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D map;\n#else\nuniform lowp sampler2D map;\n#endif\nuniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}",{blendFunction:t,uniforms:new Map([["map",new qS(null)],["intensity",new qS(r)]])}),this.renderTarget=new um(1,1,{minFilter:Gp,magFilter:Gp,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new Oq({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothingFactor=i,this.blurPass=new Rq({resolutionScale:n,width:s,height:a,kernelSize:o});let l=this.blurPass.getResolution();l.addEventListener("change",(t=>this.setSize(l.baseWidth,l.baseHeight)))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(t){this.resolution.preferredWidth=t}get height(){return this.resolution.height}set height(t){this.resolution.preferredHeight=t}get dithering(){return this.blurPass.dithering}set dithering(t){this.blurPass.dithering=t}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(t){this.blurPass.kernelSize=t}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(t){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(t){this.uniforms.get("intensity").value=t}getIntensity(){return this.intensity}setIntensity(t){this.intensity=t}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}update(t,e,i){let n=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(t,e,n),this.blurPass.render(t,n,n)):this.blurPass.render(t,e,n)}setSize(t,e){let i=this.resolution;i.setBaseSize(t,e),this.renderTarget.setSize(i.width,i.height),this.luminancePass.resolution.copy(i)}initialize(t,e,i){this.blurPass.initialize(t,e,i),void 0!==i&&(this.renderTarget.texture.type=i,t.outputEncoding===vf&&(this.renderTarget.texture.encoding=vf))}},Vq=class extends Pq{constructor(){let{blendFunction:t=Eq.NORMAL,brightness:e=0,contrast:i=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("BrightnessContrastEffect","uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",{blendFunction:t,uniforms:new Map([["brightness",new qS(e)],["contrast",new qS(i)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(t){this.uniforms.get("brightness").value=t}getBrightness(t){return this.brightness}setBrightness(t){this.brightness=t}get contrast(){return this.uniforms.get("contrast").value}set contrast(t){this.uniforms.get("contrast").value=t}getContrast(t){return this.contrast}setContrast(t){this.contrast=t}},jq=class extends Pq{constructor(){super("ColorAverageEffect","void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",{blendFunction:arguments.length>0&&void 0!==arguments[0]?arguments[0]:Eq.NORMAL})}},Gq=class extends Pq{constructor(){let{blendFunction:t=Eq.NORMAL,offset:e=new Uf(.001,5e-4)}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("ChromaticAberrationEffect","varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",{vertexShader:"uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",blendFunction:t,attributes:Mq.CONVOLUTION,uniforms:new Map([["offset",new qS(e)]])})}get offset(){return this.uniforms.get("offset").value}set offset(t){this.uniforms.get("offset").value=t}getOffset(){return this.offset}setOffset(t){this.offset=t}},Hq=class extends Pq{constructor(t){let{blendFunction:e=Eq.NORMAL,worldFocusDistance:i,worldFocusRange:n,focusDistance:r=0,focalLength:s=.1,focusRange:a=s,bokehScale:o=1,width:l=bq.AUTO_SIZE,height:h=bq.AUTO_SIZE}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super("DepthOfFieldEffect","#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;\n#else\nuniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;\n#endif\nuniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}",{blendFunction:e,attributes:Mq.DEPTH,uniforms:new Map([["nearColorBuffer",new qS(null)],["farColorBuffer",new qS(null)],["nearCoCBuffer",new qS(null)],["scale",new qS(1)]])}),this.camera=t,this.renderTarget=new um(1,1,{minFilter:Gp,magFilter:Gp,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new Bq(new ZW(t));let c=this.cocMaterial;c.focusDistance=r,c.focusRange=a,void 0!==i&&(c.worldFocusDistance=i),void 0!==n&&(c.worldFocusRange=n),this.blurPass=new Rq({kernelSize:Nq.MEDIUM,width:l,height:h});let u=this.blurPass.getResolution();u.addEventListener("change",(t=>this.setSize(u.getBaseWidth(),u.getBaseHeight()))),this.maskPass=new Bq(new hq(this.renderTargetCoC.texture));let d=this.maskPass.fullscreenMaterial;d.maskFunction=lq,d.colorChannel=qW,this.bokehNearBasePass=new Bq(new XW(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new Bq(new XW(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new Bq(new XW(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new Bq(new XW(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=o}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(t){let e=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let i of e)i.fullscreenMaterial.setScale(t);this.maskPass.fullscreenMaterial.setStrength(t),this.uniforms.get("scale").value=t}getBokehScale(){return this.bokehScale}setBokehScale(t){this.bokehScale=t}getTarget(){return this.target}setTarget(t){this.target=t}calculateFocusDistance(t){let e=this.camera;return KW(-e.position.distanceTo(t),e.near,e.far)}setDepthTexture(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yf;this.circleOfConfusionMaterial.depthBuffer=t,this.circleOfConfusionMaterial.depthPacking=e}update(t,e,i){let n=this.renderTarget,r=this.renderTargetCoC,s=this.renderTargetCoCBlurred,a=this.renderTargetMasked;if(null!==this.target){let t=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=t}this.cocPass.render(t,null,r),this.blurPass.render(t,r,s),this.maskPass.render(t,e,a),this.bokehFarBasePass.render(t,a,n),this.bokehFarFillPass.render(t,n,this.renderTargetFar),this.bokehNearBasePass.render(t,e,n),this.bokehNearFillPass.render(t,n,this.renderTargetNear)}setSize(t,e){let i=this.resolution;i.setBaseSize(t,e);let n=i.width,r=i.height,s=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];s.push(this.renderTargetCoC,this.renderTargetMasked),s.forEach((i=>i.setSize(t,e))),s=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred],s.forEach((t=>t.setSize(n,r))),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach((t=>t.fullscreenMaterial.setSize(n,r)))}initialize(t,e,i){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach((n=>n.initialize(t,e,i))),this.blurPass.initialize(t,e,qp),void 0!==i&&(this.renderTarget.texture.type=i,this.renderTargetNear.texture.type=i,this.renderTargetFar.texture.type=i,this.renderTargetMasked.texture.type=i,t.outputEncoding===vf&&(this.renderTarget.texture.encoding=vf,this.renderTargetNear.texture.encoding=vf,this.renderTargetFar.texture.encoding=vf,this.renderTargetMasked.texture.encoding=vf))}},Wq=(new mm,new Wm,class extends Pq{constructor(){let{blendFunction:t=Eq.NORMAL,hue:e=0,saturation:i=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("HueSaturationEffect","uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",{blendFunction:t,uniforms:new Map([["hue",new qS(new mm)],["saturation",new qS(i)]])}),this.hue=e}get saturation(){return this.uniforms.get("saturation").value}set saturation(t){this.uniforms.get("saturation").value=t}getSaturation(){return this.saturation}setSaturation(t){this.saturation=t}get hue(){let t=this.uniforms.get("hue").value;return Math.acos((3*t.x-1)/2)}set hue(t){let e=Math.sin(t),i=Math.cos(t);this.uniforms.get("hue").value.set((2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3)}getHue(){return this.hue}setHue(t){this.hue=t}}),qq=(new nm,class extends Pq{constructor(){let{blendFunction:t=Eq.SCREEN,premultiply:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("NoiseEffect","void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));\n#ifdef PREMULTIPLY\noutputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);\n#else\noutputColor=vec4(noise,inputColor.a);\n#endif\n}",{blendFunction:t}),this.premultiply=e}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(t){this.premultiply!==t&&(t?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(t){this.premultiply=t}}),Yq=class extends Pq{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;super("PixelationEffect","uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",{uniforms:new Map([["active",new qS(!1)],["d",new qS(new Uf)]])}),this.resolution=new Uf,this.d=0,this.granularity=t}get granularity(){return this.d}set granularity(t){let e=Math.floor(t);e%2>0&&(e+=1),this.d=e,this.uniforms.get("active").value=e>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(t){this.granularity=t}setSize(t,e){this.resolution.set(t,e),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}},Xq=(Math.PI,new mm,new mm,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC"),Qq="data:image/png;base64,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",Kq={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},Zq=class extends Pq{constructor(){let t,e,{preset:i=Kq.MEDIUM,edgeDetectionMode:n=tq.COLOR,predicationMode:r=eq.DISABLED}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("SMAAEffect","uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",{vertexShader:"varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",blendFunction:Eq.NORMAL,attributes:Mq.CONVOLUTION|Mq.DEPTH,uniforms:new Map([["weightMap",new qS(null)]])}),arguments.length>1&&(t=arguments[0],e=arguments[1],arguments.length>2&&(i=arguments[2]),arguments.length>3&&(n=arguments[3])),this.renderTargetEdges=new um(1,1,{minFilter:Gp,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new vq(!0,!1,!1),this.clearPass.overrideClearColor=new nm(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new Bq(new iq),this.edgeDetectionMaterial.edgeDetectionMode=n,this.edgeDetectionMaterial.predicationMode=r,this.weightsPass=new Bq(new cq);let s=new rS;s.onLoad=()=>{let i=new hm(t);i.name="SMAA.Search",i.magFilter=Up,i.minFilter=Up,i.generateMipmaps=!1,i.needsUpdate=!0,i.flipY=!0,this.weightsMaterial.searchTexture=i;let n=new hm(e);n.name="SMAA.Area",n.magFilter=Gp,n.minFilter=Gp,n.generateMipmaps=!1,n.needsUpdate=!0,n.flipY=!1,this.weightsMaterial.areaTexture=n,this.dispatchEvent({type:"load"})},s.itemStart("search"),s.itemStart("area"),void 0!==t&&void 0!==e?(s.itemEnd("search"),s.itemEnd("area")):typeof Image<"u"&&(t=new Image,e=new Image,t.addEventListener("load",(()=>s.itemEnd("search"))),e.addEventListener("load",(()=>s.itemEnd("area"))),t.src=Xq,e.src=Qq),this.applyPreset(i)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(t){this.edgeDetectionMaterial.edgeDetectionThreshold=t}setOrthogonalSearchSteps(t){this.weightsMaterial.orthogonalSearchSteps=t}applyPreset(t){let e=this.edgeDetectionMaterial,i=this.weightsMaterial;switch(t){case Kq.LOW:e.edgeDetectionThreshold=.15,i.orthogonalSearchSteps=4,i.diagonalDetection=!1,i.cornerDetection=!1;break;case Kq.MEDIUM:e.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=8,i.diagonalDetection=!1,i.cornerDetection=!1;break;case Kq.HIGH:e.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=16,i.diagonalSearchSteps=8,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break;case Kq.ULTRA:e.edgeDetectionThreshold=.05,i.orthogonalSearchSteps=32,i.diagonalSearchSteps=16,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0}}setDepthTexture(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yf;this.edgeDetectionMaterial.depthBuffer=t,this.edgeDetectionMaterial.depthPacking=e}update(t,e,i){this.clearPass.render(t,this.renderTargetEdges),this.edgeDetectionPass.render(t,e,this.renderTargetEdges),this.weightsPass.render(t,this.renderTargetEdges,this.renderTargetWeights)}setSize(t,e){this.edgeDetectionMaterial.setSize(t,e),this.weightsMaterial.setSize(t,e),this.renderTargetEdges.setSize(t,e),this.renderTargetWeights.setSize(t,e)}dispose(){let{searchTexture:t,areaTexture:e}=this.weightsMaterial;null!==t&&null!==e&&(t.dispose(),e.dispose()),super.dispose()}static get searchImageDataURL(){return Xq}static get areaImageDataURL(){return Qq}},Jq={DEFAULT:0,ESKIL:1},$q=class extends Pq{constructor(){let{blendFunction:t=Eq.NORMAL,technique:e=Jq.DEFAULT,eskil:i=!1,offset:n=.5,darkness:r=.5}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("VignetteEffect","uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;\n#if VIGNETTE_TECHNIQUE == 0\nfloat d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));\n#else\nvec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));\n#endif\noutputColor=vec4(color,inputColor.a);}",{blendFunction:t,defines:new Map([["VIGNETTE_TECHNIQUE",e.toFixed(0)]]),uniforms:new Map([["offset",new qS(n)],["darkness",new qS(r)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(t){this.technique!==t&&(this.defines.set("VIGNETTE_TECHNIQUE",t.toFixed(0)),this.setChanged())}get eskil(){return this.technique===Jq.ESKIL}set eskil(t){this.technique=t?Jq.ESKIL:Jq.DEFAULT}getTechnique(){return this.technique}setTechnique(t){this.technique=t}get offset(){return this.uniforms.get("offset").value}set offset(t){this.uniforms.get("offset").value=t}getOffset(){return this.offset}setOffset(t){this.offset=t}get darkness(){return this.uniforms.get("darkness").value}set darkness(t){this.uniforms.get("darkness").value=t}getDarkness(){return this.darkness}setDarkness(t){this.darkness=t}};new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([0,1,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([0,1,1]),new Float32Array([1,1,1]),new Float32Array(2),new Float32Array(2),new Float32Array([0,-.25,.25,-.125,.125,-.375,.375]),new Float32Array([0,0]),new Float32Array([.25,-.25]),new Float32Array([-.25,.25]),new Float32Array([.125,-.125]),new Float32Array([-.125,.125]),new Uint8Array([0,0]),new Uint8Array([3,0]),new Uint8Array([0,3]),new Uint8Array([3,3]),new Uint8Array([1,0]),new Uint8Array([4,0]),new Uint8Array([1,3]),new Uint8Array([4,3]),new Uint8Array([0,1]),new Uint8Array([3,1]),new Uint8Array([0,4]),new Uint8Array([3,4]),new Uint8Array([1,1]),new Uint8Array([4,1]),new Uint8Array([1,4]),new Uint8Array([4,4]),new Uint8Array([0,0]),new Uint8Array([1,0]),new Uint8Array([0,2]),new Uint8Array([1,2]),new Uint8Array([2,0]),new Uint8Array([3,0]),new Uint8Array([2,2]),new Uint8Array([3,2]),new Uint8Array([0,1]),new Uint8Array([1,1]),new Uint8Array([0,3]),new Uint8Array([1,3]),new Uint8Array([2,1]),new Uint8Array([3,1]),new Uint8Array([2,3]),new Uint8Array([3,3]),new Map([[eY(0,0,0,0),new Float32Array([0,0,0,0])],[eY(0,0,0,1),new Float32Array([0,0,0,1])],[eY(0,0,1,0),new Float32Array([0,0,1,0])],[eY(0,0,1,1),new Float32Array([0,0,1,1])],[eY(0,1,0,0),new Float32Array([0,1,0,0])],[eY(0,1,0,1),new Float32Array([0,1,0,1])],[eY(0,1,1,0),new Float32Array([0,1,1,0])],[eY(0,1,1,1),new Float32Array([0,1,1,1])],[eY(1,0,0,0),new Float32Array([1,0,0,0])],[eY(1,0,0,1),new Float32Array([1,0,0,1])],[eY(1,0,1,0),new Float32Array([1,0,1,0])],[eY(1,0,1,1),new Float32Array([1,0,1,1])],[eY(1,1,0,0),new Float32Array([1,1,0,0])],[eY(1,1,0,1),new Float32Array([1,1,0,1])],[eY(1,1,1,0),new Float32Array([1,1,1,0])],[eY(1,1,1,1),new Float32Array([1,1,1,1])]]);function tY(t,e,i){return t+(e-t)*i}function eY(t,e,i,n){let r=tY(t,e,.75),s=tY(i,n,.75);return tY(r,s,.875)}var iY=class{constructor(t,e){this.enabled=!1,this.effect=new t(e),Object.defineProperty(this,"opacity",{enumerable:!0,set(t){this.effect.blendMode.opacity.value=t},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(t){this.effect.blendMode.setBlendFunction(Number(t))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=Eq.NORMAL}},nY=class extends iY{constructor(){super(Uq),this.blendFunction=Eq.SCREEN}set intensity(t){this.effect.intensity=t}get intensity(){return this.effect.intensity}set luminanceThreshold(t){this.effect.luminanceMaterial.threshold=t}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(t){this.effect.luminanceMaterial.smoothing=t}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(t){this.effect.blurPass.scale=t}get blurScale(){return this.effect.blurPass.scale}set kernelSize(t){this.effect.blurPass.kernelSize=t}get kernelSize(){return this.effect.blurPass.kernelSize}},rY=class extends iY{constructor(){super(Vq)}set contrast(t){this.effect.uniforms.get("contrast").value=t}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(t){this.effect.uniforms.get("brightness").value=t}get brightness(){return this.effect.uniforms.get("brightness").value}},sY=class extends iY{constructor(){super(Gq),this.effect.offset=new Uf(.01,.01)}set offset(t){this.effect.offset.set(t[0]/1e3,t[1]/1e3)}get offset(){return[1e3*this.effect.offset.x,1e3*this.effect.offset.y]}},aY=class extends iY{constructor(){super(jq)}},oY=class extends iY{constructor(){super(Wq),this._hue=0}set hue(t){this._hue=t,this.effect.setHue(t)}get hue(){return this._hue}set saturation(t){this.effect.uniforms.get("saturation").value=t}get saturation(){return this.effect.uniforms.get("saturation").value}},lY=class extends iY{constructor(){super(qq),this.blendFunction=Eq.OVERLAY}},hY=class extends iY{constructor(){super($q)}get eskil(){return this.effect.eskil}set eskil(t){this.effect.eskil=t}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(t){this.effect.uniforms.get("darkness").value=t}get offset(){return this.effect.uniforms.get("offset").value}set offset(t){this.effect.uniforms.get("offset").value=t}},cY=class extends iY{constructor(t){super(Hq)}set focalLength(t){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=t/2e3}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(t){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=this.isPerspectiveCamera?t/2e3:(t+992)/2e3}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(t){this.effect.bokehScale=t}setCamera(t){let e=!1;(t.isPerspectiveCamera&&!1===this.isPerspectiveCamera||!t.isPerspectiveCamera&&!0===this.isPerspectiveCamera)&&(e=!0),t.isPerspectiveCamera?(this.effect.circleOfConfusionMaterial.adoptCameraSettings(t.perspCamera),this.isPerspectiveCamera=!0):(this.effect.circleOfConfusionMaterial.adoptCameraSettings(t),this.isPerspectiveCamera=!1),e&&this.effect.setChanged()}},uY=class extends iY{constructor(){super(Yq)}get granularity(){return this.effect.getGranularity()}set granularity(t){this.effect.setGranularity(t)}},dY=class extends uv{constructor(){super({name:"PassthroughMaterial",uniforms:{inputBuffer:new qS(null)},blending:0,depthWrite:!1,depthTest:!1,vertexShader:"#define GLSLIFY 1\nvarying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}",fragmentShader:"#define GLSLIFY 1\nlayout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}"})}set inputBuffer(t){this.uniforms.inputBuffer.value=t}},pY=class extends pq{constructor(){super("TAAResolvePass"),this.MRTCompatible=!0,this.needsSwap=!1,this.passThroughMaterial=new dY,this.resolutionVector=new Uf,this.resolveMaterial=new uv({name:"TAAResolveMaterial",uniforms:{inputBuffer:new qS(null),historyBuffer:new qS(null),velocityBuffer:new qS(null),depthBuffer:new qS(null),resolution:new qS(new Uf)},blending:0,depthWrite:!1,depthTest:!1,vertexShader:"#define GLSLIFY 1\nvarying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}",fragmentShader:"#define GLSLIFY 1\n#include <common>\nvarying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;\n#define USE_YCOCG\n#define USE_CATMULL_ROM\nconst float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){\n#ifdef USE_YCOCG\nvec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);\n#else\nreturn texture(tex,uv);\n#endif\n}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){\n#ifdef CHOOSE_LONGEST_MOTION_VECTOR\nfloat longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;\n#else\nfloat closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;\n#endif\n}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg;vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);\n#ifdef USE_CATMULL_ROM\nvec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);\n#else\nvec4 previousColor=sample_color(historyBuffer,previousPixelPos);\n#endif\n#ifdef USE_YCOCG\npreviousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);\n#endif\nvec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);\n#ifdef USE_YCOCG\nvec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;\n#endif\nvec4 previousColorClipped=clamp(previousColor,cmin,cmax);\n#ifdef LUMINANCE_DIFFERENCES\n#ifdef USE_YCOCG\nfloat lum0=currentColor.r;float lum1=previousColorClipped.r;\n#else\nfloat lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);\n#endif\nfloat unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));\n#else\nconst float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);\n#endif\n#ifdef USE_YCOCG\ngl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);\n#else\ngl_FragColor=result;\n#endif\n}"}),this.historyRenderTarget=new um(1024,1024,{minFilter:Gp,stencilBuffer:!1,depthBuffer:!1}),this.historyRenderTarget.texture.name="TAA.History",this.resultRenderTarget=new um(1024,1024,{minFilter:Gp,stencilBuffer:!1,depthBuffer:!1}),this.resultRenderTarget.texture.name="TAA.Output"}setSize(t,e){this.historyRenderTarget.setSize(t,e),this.resultRenderTarget.setSize(t,e)}render(t,e){this.fullscreenMaterial=this.resolveMaterial,this.resolveMaterial.uniforms.inputBuffer.value=e.texture[0],this.resolveMaterial.uniforms.velocityBuffer.value=e.texture[1],this.resolveMaterial.uniforms.depthBuffer.value=e.depthTexture,this.resolveMaterial.uniforms.historyBuffer.value=this.historyRenderTarget.texture,this.resolveMaterial.uniforms.resolution.value.set(e.width,e.height),t.setRenderTarget(this.resultRenderTarget),t.render(this.scene,this.camera),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,t.setRenderTarget(this.historyRenderTarget),t.render(this.scene,this.camera);let i=this.renderToScreen?null:e;this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,t.setRenderTarget(i),t.render(this.scene,this.camera)}dispose(){this.resultRenderTarget.dispose(),this.historyRenderTarget.dispose(),this.resolveMaterial.dispose(),this.passThroughMaterial.dispose()}},fY=class extends pq{constructor(t,e,i){super("TransmissionPass",void 0,e),this.MRTCompatible=!0,this.depthPass=new Aq(t,e,{renderTarget:i.transmissionDepthTarget}),this.passThroughMaterial=new dY,this.splineScene=t,this.needsSwap=!1}updatePasses(t){this.passThroughMaterial=new dY,this.depthPass=new Aq(this.splineScene,this.camera,{renderTarget:t.transmissionDepthTarget})}setCamera(t){this.camera=t}setScene(t){this.splineScene=t}render(t,e,i){let n=this.camera.layers.mask,r=t;r.setRenderTarget(r.transmissionRenderTarget),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=e.texture[0],r.clear(),r.render(this.scene,this.camera),this.camera.layers.disable(3),this.depthPass.render(t,e,i),r.shadowMap.needsUpdate=!1,r.shadowMap.autoUpdate=!1;let s=this.renderToScreen?null:e;this.camera.layers.set(3),t.setRenderTarget(s),t.render(this.splineScene,this.camera),this.camera.layers.mask=n}},mY=new sx,gY=new uv({transparent:!0,vertexShader:"\n        void main() {\n            gl_Position = vec4(0.0);\n        }\n    ",fragmentShader:"\n        layout(location = 1) out vec4 gVelocity;\n\n        void main() {\n            gl_FragColor = vec4(0.0);\n\t\t\tgVelocity = vec4(0.0);\n        }\n    "}),vY=class extends pq{constructor(t,e,i){super("OpaquePass",e??mY,i),this.MRTCompatible=!0,this.originalMaterials=[],this.hasTransmissionPass=!1,this.clear=!0,this.clearColorOnly=!1,this.clearDepth=!1,this.needsSwap=!1,this.MRTCompatible=t}setCamera(t){this.camera=t}setScene(t){this.scene=t??mY}getScene(){return this.scene}render(t,e){this.camera.layers.enable(3),this.hasTransmissionPass&&(this.originalMaterials.length=0,this.scene.traverse((t=>{t.layers.isEnabled(3)&&t instanceof CU&&(this.originalMaterials.push([t,t.material]),t.material=gY)})),t.shadowMap.needsUpdate=!0,t.shadowMap.autoUpdate=!0),this.camera.layers.enable(8);let i=this.renderToScreen?null:e;t.setRenderTarget(i),this.clearColorOnly&&t.clear(!0,!1,!0),this.clear&&t.clear(),t.render(this.scene,this.camera),this.clearDepth&&t.clear(!1,!0,!1),this.hasTransmissionPass&&this.originalMaterials.forEach((t=>{t[0].material=t[1]}))}},yY=class{constructor(t){let{depthBuffer:e=!0,stencilBuffer:i=!1,multisampling:n=0,frameBufferType:r=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.renderer=t,this.helperStartIndex=0,this.copyPass=new fq,this.depthTexture=null,this.timer=new Fq,this._width=1,this._height=1,this.passes=[],this.helperPasses=[],this.autoRenderToScreen=!0,this.inputBuffer=this.createBuffer(e,i,r,n,!0,"input buffer mrt"),this.inputBufferSingle=this.createBuffer(e,i,r,n,!1," input buffer single"),this.inputBufferSingle.texture.dispose(),this.inputBufferSingle.depthTexture.dispose(),this.inputBufferSingle.texture=this.inputBuffer.texture[0],this.inputBufferSingle.depthTexture=this.inputBuffer.depthTexture,this.outputBuffer=this.inputBuffer.clone(),this.outputBuffer.name="output buffer mrt",this.outputBufferSingle=this.createBuffer(e,i,r,n,!1,"output buffer single"),this.outputBufferSingle.texture.dispose(),this.outputBufferSingle.depthTexture.dispose(),this.outputBufferSingle.texture=this.outputBuffer.texture[0],this.outputBufferSingle.depthTexture=this.outputBuffer.depthTexture,this.setRenderer(t)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(t){let e=this.inputBuffer,i=this.multisampling;i>0&&t>0?(this.inputBuffer.samples=t,this.outputBuffer.samples=t,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==t&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("creating new input buffer"),this.inputBuffer=this.createBuffer(e.depthBuffer,e.stencilBuffer,e.texture.type,t,!0,"new input buffer"),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(t){if(this.renderer=t,null!==t){let e=t.getSize(new Uf),i=t.getContext().getContextAttributes()?.alpha??!1,n=this.inputBuffer.texture[0].type;n===qp&&t.outputEncoding===vf&&(this.inputBuffer.texture[0].encoding=vf,this.outputBuffer.texture[0].encoding=vf,this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("doing some kinda dispose??")),t.autoClear=!1,this.setSize(e.width,e.height,!1);for(let r of this.passes)r.initialize(t,i,n)}}replaceRenderer(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.renderer,n=i.domElement.parentNode;return this.setRenderer(t),e&&null!==n&&(n.removeChild(i.domElement),n.appendChild(t.domElement)),i}createDepthTexture(){let t=this.depthTexture=new $b(this._width,this._height);return this.inputBuffer.depthTexture=t,this.inputBuffer.stencilBuffer?(t.format=$p,t.type=Kp):t.type=Yp,t}deleteDepthTexture(){if(null!==this.depthTexture){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(let t of this.passes)t.setDepthTexture(null)}}createBuffer(t,e,i,n,r,s){let a,o=this.renderer,l=null===o?new Uf:o.getDrawingBufferSize(new Uf),h={minFilter:Gp,magFilter:Gp,wrapS:Fp,wrapT:Fp,stencilBuffer:e,depthBuffer:t};return n>0?(a=new um(l.width,l.height,h),a.samples=n):(r?(a=new pm(l.width,l.height,2,h),a.texture[1].type=Qp):a=new um(l.width,l.height,h),a.depthTexture=new $b(2048,2048),a.depthTexture.type=Xp),i===qp&&null!==o&&o.outputEncoding===vf&&(Array.isArray(a.texture)?a.texture.forEach((t=>t.encoding=vf)):a.texture.encoding=vf),Array.isArray(a.texture)?a.texture.forEach(((t,e)=>{t.name=`EffectComposer.Buffer ${r} ${e}`,t.generateMipmaps=!1})):(a.texture.name=`EffectComposer.Buffer ${r}`,a.texture.generateMipmaps=!1),a.name=s,a}addPass(t,e){let i,n=this.passes,r=this.renderer,s=r.getDrawingBufferSize(new Uf),a=r.getContext().getContextAttributes()?.alpha??!1;if(t.MRTCompatible&&(i=this.inputBuffer.texture[0].type),t.MRTCompatible||(i=this.inputBuffer.texture.type),t.setRenderer(r),t.setSize(s.width,s.height),t.initialize(r,a,i),this.autoRenderToScreen&&(n.length>0&&(n[n.length-1].renderToScreen=!1),t.renderToScreen&&(this.autoRenderToScreen=!1)),void 0!==e?n.splice(e,0,t):n.push(t),this.autoRenderToScreen&&(n[n.length-1].renderToScreen=!0),t.needsDepthTexture||null!==this.depthTexture)if(null===this.depthTexture){let e=this.createDepthTexture();for(t of n)t.setDepthTexture(e)}else t.setDepthTexture(this.depthTexture)}setHelperStartIndex(t){this.helperStartIndex=t}removePass(t){let e=this.passes,i=e.indexOf(t);if(-1!==i&&e.splice(i,1).length>0){if(null!==this.depthTexture){let i=(t,e)=>t||e.needsDepthTexture;e.reduce(i,!1)||t.getDepthTexture()===this.depthTexture&&t.setDepthTexture(null)}this.autoRenderToScreen&&i===e.length&&(t.renderToScreen=!1,e.length>0&&(e[e.length-1].renderToScreen=!0))}}removeAllPasses(){let t=this.passes;t.length>0&&(this.autoRenderToScreen&&(t[t.length-1].renderToScreen=!1),this.passes=[])}render(t){let e,i,n,r,s=this.renderer,a=this.copyPass,o=this.inputBuffer,l=this.outputBuffer,h=this.inputBufferSingle,c=this.outputBufferSingle,u=!1;void 0===t&&(t=this.timer.update().getDelta());for(let d of this.passes)d.enabled&&(d.MRTCompatible?d.render(s,o,l,t,u):d.render(s,h,c,t,u),d.needsSwap&&(u&&(a.renderToScreen=d.renderToScreen,e=s.getContext(),i=s.state.buffers.stencil,i.setFunc(e.NOTEQUAL,1,4294967295),a.render(s,o,l,t,u),i.setFunc(e.EQUAL,1,4294967295)),n=o,r=h,o=l,h=c,l=n,c=r),d instanceof Lq?u=!0:d instanceof mq&&(u=!1))}setSize(t,e,i){let n=this.renderer;if(this._width=t,this._height=e,void 0===t||void 0===e){let i=n.getSize(new Uf);t=i.width,e=i.height}n.setSize(t,e,i);let r=n.getDrawingBufferSize(new Uf);this.inputBuffer.setSize(r.width,r.height),this.outputBuffer.setSize(r.width,r.height),this.inputBufferSingle.setSize(r.width,r.height),this.outputBufferSingle.setSize(r.width,r.height);for(let s of this.passes)s.setSize(r.width,r.height)}reset(){let t=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(t)}dispose(){for(let t of this.passes)t.dispose();this.passes=[],null!==this.inputBuffer&&this.inputBuffer.dispose(),null!==this.outputBuffer&&this.outputBuffer.dispose(),null!==this.inputBufferSingle&&this.inputBufferSingle.dispose(),null!==this.outputBufferSingle&&this.outputBufferSingle.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},bY=new uv({name:"CombineMaterial",uniforms:{inputBufferA:new qS(null),inputBufferB:new qS(null)},blending:0,depthWrite:!1,depthTest:!1,vertexShader:"\nvarying vec2 vUv;\nvoid main() {\n    gl_Position = vec4(position.xy, 1.0, 1.0);\n    vUv = position.xy * 0.5 + 0.5;\n}\n",fragmentShader:"\n    varying vec2 vUv;\n    uniform sampler2D inputBufferA;\n    uniform sampler2D inputBufferB;\n\n    // TODO: Why do we need these when postpro of framemode is enabled???\n    layout(location = 1) out vec4 gVelocity;\n\n    void main() {\n\tvec4 resA = texture2D(inputBufferA, vUv);\n\tvec4 resB = texture2D(inputBufferB, vUv);\n    float a = resA.a + resB.a * ( 1.0 - resA.a );\n\n\tvec4 res;\n\tres.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));\n\tres.a = resA.a + resB.a * (1.0 - resA.a);\n\tgl_FragColor = res;\n    gVelocity = vec4(0.0);\n    }\n"}),xY=class extends pq{constructor(t){super("HelperPass",void 0,t),this.MRTCompatible=!1,this.fullscreenMaterial=bY,this.helperPass=new vY(!1,void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperPass.renderToScreen=!1,this.helperPassOnTop=new vY(!1,void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this.helperPassOnTop.renderToScreen=!1;let e=new Zq({preset:Kq.LOW,edgeDetectionMode:tq.COLOR});this.effectPass=new kq(this.camera,e),this.rt=new um(10,10,{minFilter:Gp,magFilter:Gp,wrapS:Fp,wrapT:Fp,depthBuffer:!0})}setSize(t,e){this.rt.setSize(t,e),this.effectPass.setSize(t,e)}set sceneHelpers(t){this.helperPass.setScene(t)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(t){this.helperPassOnTop.setScene(t)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}setCamera(t){this.helperPass.setCamera(t),this.helperPassOnTop.setCamera(t)}initialize(t,e,i){super.initialize(t,e,i),this.effectPass.initialize(t,e,i)}dispose(){super.dispose(),this.rt.dispose(),this.effectPass.dispose()}render(t,e,i){this.rt.depthTexture=e.depthTexture;let n=t.getClearAlpha();t.setClearAlpha(0),this.helperPass.clearDepth=!0,this.helperPass.clearColorOnly=!0,this.helperPass.render(t,this.rt),this.helperPassOnTop.render(t,this.rt),this.effectPass.renderToScreen=!1,this.effectPass.render(t,this.rt,i),this.fullscreenMaterial.uniforms.inputBufferA.value=i.texture,this.fullscreenMaterial.uniforms.inputBufferB.value=e.texture,t.setClearAlpha(n),t.setRenderTarget(null),t.clear(),t.render(this.scene,this.camera)}},wY=[[.478712,.875764],[-.337956,-.793959],[-.955259,-.028164],[.864527,.325689],[.209342,-.395657],[-.106779,.672585],[.156213,.235113],[-.413644,-.082856],[-.415667,.323909],[.141896,-.93998],[.954932,-.182516],[-.766184,.410799],[-.434912,-.458845],[.415242,-.078724],[.728335,-.491777],[-.058086,-.066401],[.20299,.686837],[-.808362,-.556402],[.507386,-.640839],[-.723494,-.22924],[.48974,.317826],[-.622663,.765301],[-.01064,.929347],[.663146,.647618],[-.096674,-.413835],[.525945,-.321063],[-.122533,.366019],[.195235,-.687983],[-.563203,.098748],[.418563,.561335],[-.378595,.800367],[.826922,.001024],[-.085372,-.766651],[-.92192,.183673],[-.590008,-.721799],[.167751,-.164393],[.032961,-.56253],[.6329,-.107059],[-.46408,.569669],[-.173676,-.958758],[-.242648,-.234303],[-.275362,.157163],[.382295,-.795131],[.562955,.115562],[.190586,.470121],[.770764,-.297576],[.237281,.93105],[-.666642,-.455871],[-.905649,-.298379],[.33952,.157829],[.701438,-.7041],[-.062758,.160346],[-.220674,.957141],[.642692,.432706],[-.77339,-.015272],[-.671467,.24688],[.158051,.062859],[.806009,.527232],[-.05762,-.247071],[.333436,-.51671],[-.550658,-.315773],[-.652078,.589846],[.008818,.530556],[-.210004,.519896]],SY=new uv({vertexShader:"#define GLSLIFY 1\n#include <skinning_pars_vertex>\n#include <morphtarget_pars_vertex>\nout vec3 n;void main(){\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\nvec4 view_space=viewMatrix*modelMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*view_space;n=normalize(transformedNormal);}",fragmentShader:"#define GLSLIFY 1\nin vec3 n;void main(){gl_FragColor=vec4(n,1.0);}"}),AY=new uv({vertexShader:"#define GLSLIFY 1\nout vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}",fragmentShader:"#define GLSLIFY 1\nin vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){\n#ifdef DEBUG\nfloat d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);\n#else\nvec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;\n#endif\n}",uniforms:{texture_ao_lrez:new qS(null),texture_depth_lrez:new qS(null),texture_depth_hrez:new qS(null),near:new qS(null),far:new qS(null)}}),EY=class extends pq{constructor(t,e){super("AmbientOcclusionPass",void 0,e),this.fogEnabled=!1,this.fogNear=1,this.fogFar=1e3,this.frameIndex=0,this._runHalfRes=!0,this._width=1,this._height=1;let i=1024,n=1024;this.gBuffer=new um(i,n,{type:lT?Qp:Xp,depthTexture:new $b(i,n),minFilter:Gp,magFilter:Gp}),this.depthBufferHighRes=new um(i,n,{depthTexture:new $b(i,n)}),this.aoBuffer=new um(i,n,{minFilter:Gp,magFilter:Gp}),this.splineScene=t,this.splineCamera=e;let r=new Float32Array(2*wY.length);for(let a=0;a<wY.length;a++){let t=2*a;r[t+0]=wY[a][0],r[t+1]=wY[a][1]}this.blueNoiseInDiskTexture=new cx(r,wY.length,1,ef,Xp),this.blueNoiseInDiskTexture.wrapS=zp,this.blueNoiseInDiskTexture.wrapT=zp,this.blueNoiseInDiskTexture.needsUpdate=!0,this.hbaoMaterial=new uv({vertexShader:"#define GLSLIFY 1\nout vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}",fragmentShader:"#define GLSLIFY 1\nin vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}\n#define USE_GBUFFER_NORMALS\nvoid main(){vec3 view_space_p=get_view_position(v_uv);\n#ifdef USE_GBUFFER_NORMALS\nvec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;\n#else\nvec3 view_space_n=-rebuild_normal(v_uv,view_space_p);\n#endif\nfloat radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}",uniforms:{near:new qS(null),far:new qS(null),fov:new qS(null),proj_info:new qS(new cm),is_ortho:new qS(!1),resolution:new qS(new Uf),radius_of_influence:new qS(8),radius_in_screen_space:new qS(1),exponent:new qS(1),ao_color:new qS(new mm),bias:new qS(.5),texture_depth:new qS(null),texture_normals:new qS(null),texture_blue_noise:new qS(null),texture_blue_noise_in_disk:new qS(this.blueNoiseInDiskTexture),frame_index:new qS(0),fog_enabled:new qS(!1),fog_near:new qS(1),fog_far:new qS(1e3)}}),this.radius=128,this.aoColor={r:0,g:0,b:0},this.bias=.5,this.hbaoMaterial.uniforms.texture_depth.value=this.gBuffer.depthTexture,this.hbaoMaterial.uniforms.texture_normals.value=this.gBuffer.texture,this.needsSwap=!0,this.aaBuffer=new um(i,n,{minFilter:Gp,magFilter:Gp,wrapS:Fp,wrapT:Fp,depthBuffer:!1,type:Xp});let s=new Zq({preset:Kq.ULTRA,edgeDetectionMode:tq.COLOR});this.effectPass=new kq(this.camera,s)}initialize(t,e,i){super.initialize(t,e,i),this.effectPass.initialize(t,e,i)}setBlueNoiseTexture(t){this.hbaoMaterial.uniforms.texture_blue_noise.value=t}setSize(t,e){this._width=t,this._height=e,this.depthBufferHighRes.setSize(t,e);let i=this._runHalfRes?.5:1,n=t*i,r=e*i;this.gBuffer.setSize(n,r),this.aoBuffer.setSize(n,r),this.hbaoMaterial.uniforms.resolution.value.set(n,r),this.aaBuffer.setSize(n,r),this.effectPass.setSize(n,r)}get runHalfRes(){return this._runHalfRes}set runHalfRes(t){this._runHalfRes=t,this.setSize(this._width,this._height)}setCamera(t){this.splineCamera=t}setScene(t){this.splineScene=t}setDepthTexture(t){this.depthBufferHighRes.depthTexture=t,AY.uniforms.texture_depth_hrez.value=t,AY.needsUpdate=!0}render(t,e,i){this.splineScene.overrideMaterial=SY;let n=this.splineCamera.layers.mask;if(this.splineCamera.layers.set(5),t.setRenderTarget(this.gBuffer),t.clear(),t.render(this.splineScene,this.splineCamera),t.setRenderTarget(this.depthBufferHighRes),t.clear(),t.render(this.splineScene,this.splineCamera),this.splineScene.overrideMaterial=null,this.splineCamera.layers.mask=n,this.hbaoMaterial.uniforms.radius_of_influence.value=this.radius,this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r,this.aoColor.g,this.aoColor.b),this.hbaoMaterial.uniforms.bias.value=this.bias,this.hbaoMaterial.uniforms.fog_enabled.value=this.fogEnabled,this.hbaoMaterial.uniforms.fog_near.value=this.fogNear,this.hbaoMaterial.uniforms.fog_far.value=this.fogFar,this.hbaoMaterial.uniforms.frame_index.value=this.frameIndex,this.frameIndex++,this.splineCamera.isPerspectiveCamera){this.hbaoMaterial.uniforms.near.value=this.splineCamera.perspCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.perspCamera.far;let t=this.splineCamera.perspCamera.projectionMatrix.elements,e=2/t[0],i=2/t[5],n=-(1-t[8])/t[0],r=-(1+t[9])/t[5];this.hbaoMaterial.uniforms.proj_info.value.set(e,i,n,r);let s=this.splineCamera.perspCamera.fov*(Math.PI/180),a=this.hbaoMaterial.uniforms.resolution.value.y/(2*Math.tan(.5*s)),o=.5*this.hbaoMaterial.uniforms.radius_of_influence.value*a;this.hbaoMaterial.uniforms.radius_in_screen_space.value=o,this.hbaoMaterial.uniforms.is_ortho.value=!1}else{this.hbaoMaterial.uniforms.near.value=this.splineCamera.orthoCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.orthoCamera.far;let t=this.splineCamera.orthoCamera.projectionMatrix.elements,e=2/t[0],i=2/t[5],n=-(1+t[12])/t[0],r=-(1-t[13])/t[5];this.hbaoMaterial.uniforms.proj_info.value.set(e,i,n,r);let s=this.hbaoMaterial.uniforms.resolution.value.y/i*.5,a=this.hbaoMaterial.uniforms.radius_of_influence.value*s;this.hbaoMaterial.uniforms.radius_in_screen_space.value=a,this.hbaoMaterial.uniforms.is_ortho.value=!0}this.runHalfRes?(this.fullscreenMaterial=this.hbaoMaterial,t.setRenderTarget(this.aoBuffer),t.clear(),t.render(this.scene,this.camera),this.fullscreenMaterial=AY,AY.uniforms.texture_ao_lrez.value=this.aoBuffer.texture,AY.uniforms.texture_depth_lrez.value=this.gBuffer.depthTexture,AY.uniforms.texture_depth_hrez.value=this.depthBufferHighRes.depthTexture,t.setRenderTarget(t.aoRenderTarget),t.clear(),t.render(this.scene,this.camera)):(this.fullscreenMaterial=this.hbaoMaterial,t.setRenderTarget(this.aaBuffer),t.clear(),t.render(this.scene,this.camera),this.effectPass.renderToScreen=!1,this.effectPass.render(t,this.aaBuffer,t.aoRenderTarget))}dispose(){this.gBuffer.dispose(),this.depthBufferHighRes.dispose(),this.aoBuffer.dispose()}},_Y=class extends Bq{constructor(){super(new uv({vertexShader:"\nvarying vec2 vUv;\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tInput;\nuniform sampler2D tMap;\nuniform vec2 resolution;\nvarying vec2 vUv;\n\nuniform vec2 uResolution;\nuniform vec2 uCoords;\n\n// Draws a rectangle at center <st> with size <size>\nfloat rectangle(vec2 st, vec2 size) {\n    size = vec2(0.5) - size * 0.5;\n    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));\n    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));\n\n    return uv.x * uv.y;\n}\n\nuniform vec2 uSize;\nuniform float uScale;\nuniform float uDPR;\nuniform float uCurrent;\nuniform vec3 uSceneColor;\n\nvoid main() {\n    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;\n    screenUv *= 1.0 / uDPR;\n\n    vec2 center = vec2(0.5, -0.5);\n    vec2 outsideUv = screenUv;\n    outsideUv += center;\n    outsideUv -= uCoords.xy / uResolution.xy;\n    outsideUv = (outsideUv - 0.5) + 0.5;\n    outsideUv -= center;\n    vec2 s = (uSize / uResolution) * uScale;\n    float isOutside = 1.0 - rectangle(outsideUv, s);\n    \n    vec2 mid = vec2(0.5);\n    vec2 insideUv = (screenUv - mid + s * mid) / s;\n    vec4 background = texture2D(tInput, screenUv);\n    vec4 image = texture2D(tMap, insideUv);\n    gl_FragColor = mix(image, background, isOutside);\n}\n",uniforms:{tInput:new qS(null),tMap:new qS(null),uResolution:new qS(new Uf),uSize:new qS(new Uf),uCoords:new qS(new Uf),uScale:new qS(1),uSceneColor:new qS(new nm(16711680)),uDPR:new qS(1),uCurrent:new qS(0)}}),"tInput"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tMap.value}set texture(t){this.uniforms.tMap.value=t}},CY=[],MY=class extends Bq{constructor(){super(new uv({vertexShader:"\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D toScene;\nuniform sampler2D fromScene;\nuniform vec2 resolution;\n\nuniform vec2 uResolution;\nuniform float uDPR;\n\nuniform float mixRatio;\nuniform sampler2D tMixTexture;\nuniform int useTexture;\nuniform float threshold;\n\nvoid main() {\n\tvec2 screenUv = gl_FragCoord.xy / uResolution.xy;\n\tscreenUv *= 1.0 / uDPR;\n\n\tvec4 texel1 = texture2D( fromScene, screenUv );\n\tvec4 texel2 = texture2D( toScene, screenUv );\n\n\tif (useTexture==1) {\n\t\t\n\t\tvec4 transitionTexel = texture2D( tMixTexture, screenUv );\n\t\tfloat r = mixRatio * (1.0 + threshold * 2.0) - threshold;\n\t\tfloat mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);\n\t\t\n\t\tgl_FragColor = mix( texel1, texel2, mixf );\n\t} else {\n\t\t\n\t\tgl_FragColor = mix( texel1, texel2, mixRatio );\n\t\t\n\t}\n}\n",uniforms:{toScene:new qS(null),fromScene:new qS(null),uResolution:new qS(new Uf),uDPR:new qS(1),mixRatio:new qS(0),threshold:new qS(.1),useTexture:new qS(0),tMixTexture:{value:CY[0]}}}),"toScene"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.fromScene.value}set texture(t){this.uniforms.fromScene.value=t}},PY=class extends Bq{constructor(){super(new uv({vertexShader:"\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D inputBuffer;\nuniform sampler2D blurredInputBuffer;\nuniform sampler2D overlay;\nuniform float blurIntensity;\n\nuniform vec2 uResolution;\nuniform float uDPR;\n\nvoid main() {\n\tvec2 screenUv = gl_FragCoord.xy / uResolution.xy;\n\tscreenUv *= 1.0 / uDPR;\n\n\tvec4 texel1 = texture2D( overlay, screenUv );\n\tvec4 texel2 = texture2D( inputBuffer, screenUv );\n\tvec4 texel3 = texture2D( blurredInputBuffer, screenUv );\n\n\tfloat blurMask2 = max(sign(texel1.a), 0.0) * blurIntensity;\n    gl_FragColor = mix( mix(texel2, texel3, blurMask2), texel1, texel1.a );\n}\n",uniforms:{inputBuffer:new qS(null),blurredInputBuffer:new qS(null),overlay:new qS(null),uResolution:new qS(new Uf),uDPR:new qS(1),blurIntensity:new qS(0)}})),this._blurEnabled=!1,this.blurTarget=new um(1,1,{minFilter:Gp,magFilter:Gp,wrapS:Fp,wrapT:Fp}),this.blurPass=new Rq({width:window.innerWidth,height:window.innerHeight,kernelSize:Nq.HUGE,resolutionScale:.25}),this.blurPass.renderToScreen=!1,this.uniforms.blurredInputBuffer.value=this.blurTarget.texture}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.overlay.value}set texture(t){this.uniforms.overlay.value=t}setResolution(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.uniforms.uResolution.value.set(t,e),this.uniforms.uDPR.value=i,this.blurPass.setSize(t,e),this.blurTarget.setSize(t,e),this.blurPass.setSize(t,e)}get uiCanvas(){return this._uiCanvas}set uiCanvas(t){this._uiCanvas=t,t.texture&&(this.uniforms.overlay.value=t.texture);let e=t.frame;if(e){let t=e.data.backgroundBlur,i=t.radius;this._blurEnabled=t.enabled,this.uniforms.blurIntensity.value=this._blurEnabled?1:0,this.blurPass.scale=i/3}}render(t,e,i,n,r){this._blurEnabled&&(this.blurPass.setDepthTexture(this.getDepthTexture()),this.blurPass.render(t,e,this.blurTarget,n,r)),super.render(t,e,i,n,r)}},TY=class extends Bq{constructor(){super(new uv({vertexShader:"\nvarying vec2 vUv;\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tInput;\nuniform sampler2D tOverlayImage;\nvarying vec2 vUv;\nuniform vec2 uResolution;\nuniform vec2 uRightBottom;\nuniform vec2 uImageSize;\nuniform float uScale;\nuniform float uDPR;\n\nvec3 blendNormal(vec3 base, vec3 blend) {\n\treturn blend;\n}\n\nvec3 blendNormal(vec3 base, vec3 blend, float opacity) {\n\treturn (blendNormal(base, blend) * opacity + base * (1.0 - opacity));\n}\n\nvec4 drawFixedSizeImage(sampler2D image, vec2 screenUV, vec2 imageSize, vec2 imageCoords, vec2 screenSize, float dpr) {\n\tvec2 uv = (screenUV * screenSize * dpr - imageCoords) / (imageSize * dpr);\n\tif (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {\n\t\treturn vec4(0.0);\n\t}\n\treturn texture2D(image, uv);\n}\n\nvoid main() {\n    vec2 screenUV = gl_FragCoord.xy / (uResolution.xy * uDPR);\n\tvec2 imageCoords = vec2(uResolution.x * uDPR - uImageSize.x * uScale * uDPR - uRightBottom.x * uDPR, uRightBottom.y * uDPR);\n    vec4 background = texture2D(tInput, screenUV);\n    vec4 image = drawFixedSizeImage(tOverlayImage, screenUV, uImageSize * uScale, imageCoords, uResolution, uDPR);\n    gl_FragColor = vec4(blendNormal(background.rgb, image.rgb, image.a), max(background.a, image.a));\n}\n",uniforms:{tInput:new qS(null),tOverlayImage:new qS(null),uResolution:new qS(new Uf),uImageSize:new qS(new Uf),uRightBottom:new qS(new Uf(20,20)),uScale:new qS(.25),uDPR:new qS(1)}}),"tInput")}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tOverlayImage.value}set texture(t){this.uniforms.tOverlayImage.value=t,this.uniforms.uImageSize.value.set(t.image.width,t.image.height)}};function DY(t,e){return e&&e.enabled&&t.push(e.effect),t}var kY=t=>Object.values(Eq).includes(t)?t:Eq.NORMAL,IY=class extends _f{constructor(t,e){super(),this._needsDOFResize=e,this.postprocessingState=ER.defaultData,this._scene=new sx,this._camera=new PW,this.effects=new Map,this.blueNoiseTexture=new cx,this._renderToScreen=!0,this._isUIOverlayEnabled=!1,this.clock=new TS,this.renderer=t,this.debug=!1,this.effects.set("bloom",new nY),this.effects.set("chromaticAberration",new sY),this.effects.set("vignette",new hY),this.effects.set("noise",new lY),this.effects.set("colorAverage",new aY),this.effects.set("hueSaturation",new oY),this.effects.set("brightnessContrast",new rY),this.effects.set("depthOfField",new cY),this.effects.set("pixelation",new uY),this.effectComposer=new yY(this.renderer),this.effectComposer.autoRenderToScreen=!1,this.opaquePass=new vY(!0,this.scene,this.camera),this.opaquePass.clear=!0,this.transmissionPass=new fY(this.scene,this.camera,this.renderer),this.aoPass=new EY(this.scene,this.camera),this.taaPass=new pY,this.taaPass.renderToScreen=!1,this.helperPass=new xY(this.camera),this.helperPass.renderToScreen=!1,this.stylesOverlayPass=new _Y,this.stylesOverlayPass.enabled=!1,this.uiOverlayPass=new PY,this.uiOverlayPass.enabled=!1,this.logoOverlayPass=new TY,this.logoOverlayPass.enabled=!1,this.sceneTransitionPass=new MY,this.sceneTransitionPass.enabled=!1,this._initCopyPass(),this._initPasses()}set overlayTexture(t){void 0!==t?(this.stylesOverlayPass.texture=t,this.stylesOverlayPass.enabled=!0):this.stylesOverlayPass.enabled=!1}get overlayTexture(){return this.stylesOverlayPass.texture}set sceneHelpers(t){this.helperPass.sceneHelpers=t}get sceneHelpers(){return this.helperPass.sceneHelpers}set sceneHelpersOnTop(t){this.helperPass.sceneHelpersOnTop=t}get sceneHelpersOnTop(){return this.helperPass.sceneHelpersOnTop}get scene(){return this._scene}set scene(t){this._scene=t,this.opaquePass.setScene(t),this.transmissionPass.setScene(t),this.aoPass.setScene(t)}get camera(){return this._camera}set camera(t){let e=this._camera!==t;this._camera=t,this.opaquePass.setCamera(t),this.transmissionPass.setCamera(t),e&&this.transmissionPass.updatePasses(this.renderer),this.aoPass.setCamera(t),this.helperPass.setCamera(t),this.effects.get("depthOfField").setCamera(t)}updateRenderToScreen(){let t=!1;for(let e=this.effectComposer.passes.length-1;e>=0;e--){let i=this.effectComposer.passes[e];!0!==i.enabled||t||!this._renderToScreen?i.renderToScreen=!1:(i.renderToScreen=!0,t=!0)}}get isUIOverlayEnabled(){return this._isUIOverlayEnabled}disableUIOverlay(){this._isUIOverlayEnabled=!1}enableUIOverlay(){this._isUIOverlayEnabled=!0}disableHelpers(){this.helperPass.enabled=!1,this.updateRenderToScreen()}enableHelpers(){this.helperPass.enabled=!0,this.updateRenderToScreen()}updateBlueNoiseTexture(t){this.blueNoiseTexture=new cx(t,128,128),this.blueNoiseTexture.wrapS=zp,this.blueNoiseTexture.wrapT=zp,this.blueNoiseTexture.minFilter=Up,this.blueNoiseTexture.magFilter=Up,this.blueNoiseTexture.needsUpdate=!0}setAmbientOcclusionParams(t,e,i,n,r,s,a,o){this.aoPass.enabled=t,this.aoPass.radius=e,this.aoPass.bias=i,this.aoPass.aoColor=n,this.aoPass.fogEnabled=r,this.aoPass.fogNear=s,this.aoPass.fogFar=a,this.aoPass.runHalfRes!==!o&&(this.aoPass.runHalfRes=!o)}setTransmissionPassEnabled(t){this.transmissionPass.enabled=t,this.opaquePass.hasTransmissionPass=t}_initPasses(){if(this.uvEffectPass?.dispose(),this.effectPass?.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.aoPass),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.effectComposer.addPass(this.taaPass),this.postprocessingState.enabled){let t=[this.effects.get("pixelation")].reduce(DY,[]);t.length>0&&(this.uvEffectPass=new kq(this.camera,...t),this.uvEffectPass.renderToScreen=!1,this.effectComposer.addPass(this.uvEffectPass));let e=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("depthOfField"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(DY,[]);if(e.length>0&&(this.effectPass=new kq(this.camera,...e),this.effectPass.renderToScreen=!1,this.effectComposer.addPass(this.effectPass),this._needsDOFResize&&this.effects.get("depthOfField")?.enabled&&void 0!==window)){let t=this.renderer.viewportWidth,e=this.renderer.viewportHeight;this.renderer.setSize(t-1,e-1),this.renderer.setSize(t,e)}}this.effectComposer.addPass(this.stylesOverlayPass),this.effectComposer.addPass(this.uiOverlayPass),this.effectComposer.addPass(this.sceneTransitionPass),this.effectComposer.addPass(this.helperPass),this.effectComposer.addPass(this.logoOverlayPass)}_initCopyPass(){if(this._savePass)return;let t=new Uf;this.renderer.getDrawingBufferSize(t),this._rt=new um(t.x,t.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:zp,wrapT:zp}),this._rt.samples=0,this._savePass=new fq(this._rt,!1),this._savePass.renderToScreen=!1}setCopyPass(t){this._rt=t,this._savePass=new fq(this._rt,!1),this.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(t){if(this._renderToScreen===t)return;let e=this.effectComposer;!e||(!0===t?e.removePass(this._savePass):e.addPass(this._savePass),this._renderToScreen=t,this.updateRenderToScreen())}set sceneTransitionFromTexture(t){t!==this.sceneTransitionPass.texture&&(null!==t?this.sceneTransitionPass.enabled=!0:(this.sceneTransitionPass.enabled=!1,this.updateRenderToScreen()),this.sceneTransitionPass.texture=t)}setWatermark(t){this.logoOverlayPass.enabled=null!==t,t&&(this.logoOverlayPass.texture=t)}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(t){let{enabled:e,...i}=t,n=!1;e!==this.postprocessingState.enabled&&(n=!0);for(let r of Object.entries(i)){let t=r[1],e=this.effects.get(r[0]);if(e){e.enabled!==t.enabled&&(n=!0),e.enabled=t.enabled;for(let[i,n]of Object.entries(t))"blendFunction"===i?e.blendFunction=kY(n):e[i]=n}}this.postprocessingState=t,n&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(t,e,i,n){t instanceof cm?(this.effectComposer.inputBuffer.scissor.set(t.x,t.y,t.z,t.w),this.effectComposer.outputBuffer.scissor.set(t.x,t.y,t.z,t.w)):(this.effectComposer.inputBuffer.scissor.set(t,e,i,n),this.effectComposer.outputBuffer.scissor.set(t,e,i,n));let r=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(r),this.effectComposer.outputBuffer.scissor.multiplyScalar(r),this.renderer.setScissor(t,e,i,n)}setScissorTest(t){this.effectComposer.inputBuffer.scissorTest=t,this.effectComposer.outputBuffer.scissorTest=t,this.renderer.setScissorTest(t)}setViewport(t,e,i,n){t instanceof cm?(this.effectComposer.inputBuffer.viewport.copy(t),this.effectComposer.outputBuffer.viewport.copy(t)):(this.effectComposer.inputBuffer.viewport.set(t,e,i,n),this.effectComposer.outputBuffer.viewport.set(t,e,i,n))}resize(t,e,i){if(this.effectComposer.setSize(t,e,i),this._rt){let i=this.renderer.getPixelRatio();this._rt.setSize(t*i,e*i)}}dispose(){this.uvEffectPass?.dispose(),this.effectPass?.dispose(),this.effectComposer.dispose()}},RY=Pv.lights_fragment_begin,OY=Pv.shadowmask_pars_fragment,LY=null,BY=new uv({vertexShader:"\nattribute vec3 randomColor;\nvarying vec3 vNormal;\nflat out vec3 vColor;\n#include <skinning_pars_vertex>\n#include <morphtarget_pars_vertex>\n\t\nvoid main()\n{\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\nvec3 transformed = vec3(position);\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n\nvNormal = normal;\nvColor = randomColor;\ngl_Position = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));\n}\n",fragmentShader:"\nuniform float depthContrast;\nvarying vec3 vNormal;\nflat in vec3 vColor;\nvoid main()\n{\nvec3 normal = (normalize(vNormal)).rgb;\n\nfloat contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;\n\nvec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);\ngl_FragColor = vec4(resultColor, vColor.r);\ngl_FragColor = vec4(resultColor, vColor.r);\n}\n",uniforms:{depthContrast:{value:1}}}),zY=new hm,FY=new Uf,NY=class extends nx{constructor(t){var e;super(t),e=this,this._pixelRatio=this.getPixelRatio(),this.viewportWidth=1,this.viewportHeight=1,this.resolution=new Uf,this.dummyCamera=new PW,this.sceneTransitionDuration=0,this.sceneTransitionTimeRemaining=-1,this.isXRCopyPassSet=!1,this.clear=function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=e.getContext(),s=0;t&&(s|=r.COLOR_BUFFER_BIT),i&&(s|=r.DEPTH_BUFFER_BIT),n&&(s|=r.STENCIL_BUFFER_BIT),r.clear(s),r.clearBufferfv(r.COLOR,1,[0,0,0,1])},this.pipeline=new IY(this,t?.needsDOFResize??!1),this.autoClear=!1;let i=this.setPixelRatio.bind(this),n=this.setSize.bind(this);this.shadowMap.enabled=!0,this.shadowMap.type=1,this.dummyCamera.matrixAutoUpdate=!1,this.domElement.removeAttribute("data-engine");let r=this.getContext();if(r&&"drawingBufferColorSpace"in r)try{r.drawingBufferColorSpace="display-p3"}catch(gI){console.warn(gI)}this.setPixelRatio=t=>{this._pixelRatio!==t&&(this._pixelRatio=t,i(t))},this.setSize=function(t,i){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];(e.viewportWidth!==t||e.viewportHeight!==i)&&(e.viewportWidth=t,e.viewportHeight=i,n(t,i,r),e.normalRenderTarget?.setSize(t*e._pixelRatio,i*e._pixelRatio),e._resizeTransmission(t,i),e.transmissionDepthTarget?.setSize(t*e._pixelRatio/2,i*e._pixelRatio/2),e.pipeline.resize(t,i,r))},this._superDispose=this.dispose,this.dispose=this._currentDispose}createAORenderTarget(){void 0===this.aoRenderTarget&&(this.aoRenderTarget=new um(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:Gp,magFilter:Gp,wrapS:Fp,wrapT:Fp,depthBuffer:!1}))}_resizeTransmission(t,e){this.transmissionRenderTarget?.setSize(t*this._pixelRatio/(this.hdTransmission?1:2),e*this._pixelRatio/(this.hdTransmission?1:2)),this.aoRenderTarget?.setSize(t*this._pixelRatio/1,e*this._pixelRatio/1)}get hdTransmission(){return 1===aj.transmissionLod.value}set hdTransmission(t){aj.transmissionLod.value=!0===t?1:2,this._resizeTransmission(this.viewportWidth,this.viewportHeight)}createTransmissionRenderTarget(){void 0===this.transmissionRenderTarget&&(this.transmissionRenderTarget=new um(this.viewportWidth*this._pixelRatio/(this.hdTransmission?1:2),this.viewportHeight*this._pixelRatio/(this.hdTransmission?1:2),{generateMipmaps:!0,minFilter:Wp,magFilter:Gp,wrapS:Fp,wrapT:Fp,depthBuffer:!1}),this.transmissionDepthTarget=new um(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:Up,magFilter:Up,depthBuffer:!1}))}createNormalRenderTarget(){void 0===this.normalRenderTarget&&(this.normalRenderTarget=new um(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:Up,magFilter:Up,type:Xp,depthTexture:new $b(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(t,e,i){this.normalRenderTarget&&(this.setClearColor(0),i.layers.enable(8),i.layers.disable(0),i.layers.disable(3),e.traverseEntity((t=>{t.layers.isEnabled(8)&&(t.copyPreviousMatrix=!1)})),this.setRenderTarget(this.normalRenderTarget),this.clear(),BY.uniforms.depthContrast.value=i instanceof PW?(i.far-i.near)/1e4:1,e.overrideMaterial=BY,this.render(e,i),this.setClearColor(e.bgColor,e.bgColor.a),this.setRenderTarget(null),e.overrideMaterial=t.wireframeState?hK:null,i.layers.enable(0),i.layers.enable(3),e.traverseEntity((t=>{t.layers.isEnabled(8)&&(t.copyPreviousMatrix=!0)})))}renderSplineSceneWithDummyCamera(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.dummyCamera.updateCameraState(e.dataPatched),this.dummyCamera.matrix.copy(e.matrixWorld);let n=e.height,r=e.width,s=this.viewportWidth/this.viewportHeight;r<n?r=n*s:n=r/s,this.dummyCamera.setViewplaneSize(r,n);for(let a=0;a<i;a++)this.renderSplineScene(t,this.dummyCamera)}renderSplineScene(t,e){let{sceneHelpers:i=this.sceneHelpers,sceneHelpersOnTop:n=this.sceneHelpersOnTop,overrideTransmission:r,overrideNormal:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=t instanceof uK?t.activePage:t,o=a.visible;a.visible=!0;let l=a.scene;this.xr.enabled&&(!1===this.isXRCopyPassSet&&null!==this.getRenderTarget()&&(this.pipeline.setCopyPass(this.getRenderTarget()),this.isXRCopyPassSet=!0),this.xr.updateCamera(e)),this.setClearColor(a.bgColor,a.bgColor.a),a.penumbraSizeArray.forEach(((t,e)=>{aj.penumbraSize.value[e]=t})),aj.pixelRatioNode.value=this.getPixelRatio(),0!==this.resolution.x&&0!==this.resolution.y?aj.resolution.value.set(this.resolution.x,this.resolution.y):aj.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),void 0!==s?(aj.normalRenderTarget.value=s,aj.normalRenderTargetDepth.value=zY):l.needsNormal()&&(this.createNormalRenderTarget(),aj.normalRenderTarget.value=this.normalRenderTarget.texture,aj.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(l,a,e));let h=a.data.ao,c=h.occlusion;if(c&&(this.createAORenderTarget(),aj.aoRenderTarget.value=this.aoRenderTarget.texture),aj.aoEnabled.value=c,this.pipeline.setAmbientOcclusionParams(h.occlusion,h.radius,h.bias,a.aoColor,null!==a.fog,a.backupFog.near,a.backupFog.far,h.aoFullRes&&!lT),this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture),this.pipeline.isUIOverlayEnabled&&a.uiCanvas?.enabled&&a.uiCanvas.texture&&a.uiCanvas.texture.image.width>0){let t=this.getSize(FY),e=this.getPixelRatio();(a.uiCanvas.width!==this.viewportWidth||a.uiCanvas.height!==this.viewportHeight||a.uiCanvas.dpr!==e)&&a.uiCanvas.applySize({width:this.viewportWidth,height:this.viewportHeight},e),a.uiCanvas.render(this),this.pipeline.uiOverlayPass.uiCanvas=a.uiCanvas,this.pipeline.uiOverlayPass.enabled=!0,this.pipeline.uiOverlayPass.setResolution(t.x,t.y,e),this.pipeline.updateRenderToScreen()}else this.pipeline.uiOverlayPass.enabled=!1,this.pipeline.updateRenderToScreen();if(this.pipeline.logoOverlayPass.enabled){let t=this.getSize(FY),e=this.getPixelRatio();this.pipeline.logoOverlayPass.uniforms.uResolution.value.set(t.x,t.y),this.pipeline.logoOverlayPass.uniforms.uDPR.value=e}let u=!1;if(void 0!==r)aj.transmissionRenderTarget.value=r,aj.transmissionRenderTargetDepth.value=zY,this.pipeline.setTransmissionPassEnabled(!1);else{let t=l.needsTransmission();t&&(void 0===this.transmissionRenderTarget&&(u=!0),this.createTransmissionRenderTarget(),aj.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,aj.aspectRatio.value=function(t,e){return t>=e?new Uf(e/t,1):new Uf(1,t/e)}(this.viewportWidth,this.viewportHeight),aj.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(t)}e.layers.enable(3),e.layers.enable(8),this.pipeline.sceneHelpers=i,this.pipeline.sceneHelpersOnTop=n,this.pipeline.scene=a,this.pipeline.camera=e,u&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==a.postprocessing&&(this.pipeline.updatePostprocessing(a.postprocessing),!i&&!n&&this.pipeline.disableHelpers()),void 0!==this.clearAlphaOverride&&this.setClearAlpha(this.clearAlphaOverride),l.shapeBlendIntances.forEach((t=>{t.onBeforeShadowPass(this)})),a.overrideMaterial=l.wireframeState?hK:null,this.pipeline.render(),aj.frameIndex.value=(aj.frameIndex.value+1)%16,e instanceof PW&&e.copyHistory(),a.visible=o}renderFromSceneForSceneTransitionPass(t,e,i){this.pipeline.renderToScreen=!1,this.pipeline.renderTarget,this.renderSplineScene(t,e),this.pipeline.sceneTransitionFromTexture=this.pipeline.renderTarget.texture,this.sceneTransitionDuration=i,this.sceneTransitionTimeRemaining=i,this.pipeline.renderToScreen=!0;let n=this.pipeline.sceneTransitionPass.uniforms;n.uDPR.value=window.devicePixelRatio,n.uResolution.value.set(this.domElement.width,this.domElement.height).divideScalar(window.devicePixelRatio)}_currentDispose(){this._superDispose(),this.pipeline.dispose(),this.aoRenderTarget?.dispose(),this.transmissionRenderTarget?.dispose(),this.transmissionDepthTarget?.dispose(),this.normalRenderTarget?.dispose(),this.normalRenderTarget?.depthTexture?.dispose()}},UY=class extends(cW(lA)){constructor(t){super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,arguments.length>2&&void 0!==arguments[2]?arguments[2]:10066329),this.object=t,this.added=!1,this.name=`DirectionalLightHelper: ${t.uuid}`}raycast(t,e){fW(this.object,UY.geometryHelper,t,e)}},VY=class extends(cW(rA)){constructor(t){super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,arguments.length>2&&void 0!==arguments[2]?arguments[2]:6710886),this.object=t,this.name=`PointLightHelper: ${t.uuid}`}raycast(t,e){fW(this.object,VY.geometryHelper,t,e)}},jY=class extends(cW(nA)){constructor(t){super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:6710886),this.object=t,this.name=`SpotLightHelper: ${t.uuid}`}raycast(t,e){fW(this.object,jY.geometryHelper,t,e)}update(){if(void 0!==this.object){let t=jY._vector,e=this.object.distance?this.object.distance:1e3,i=e*Math.tan(this.object.angle);this.cone.scale.set(i,i,e),t.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(t);let n=void 0!==this.color?this.color:this.light.color;if(this.cone.material instanceof Array)for(let r=0,s=this.cone.material.length;r<s;r++)this.cone.material[r].color.set(n);else this.cone.material.color.set(n)}}},GY=jY;GY._vector=new mm;var HY=class extends Kb{constructor(){super(),this.caretIndex=0,this._caretVisibleAlpha=1,this._selectionVisibleAlpha=.3,this.current={start:0,end:void 0},this.matrixAutoUpdate=!1,this.caretMesh=new rv(new Mv(1,1),new Dg({transparent:!0,opacity:0,side:2})),this.add(this.caretMesh),this.selectionMesh=new rv(new Mv(1,1),new Dg({color:2857471,transparent:!0,depthTest:!1,depthWrite:!1,opacity:0,side:2})),this.add(this.selectionMesh),this.hide()}get caretHeight(){return this.object?.AD??0}show(t){this.visible=!0,this.object=t,this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.y=.5*-this.caretHeight,this.setCaretPosition(this.caretIndex),this.update()}hide(){this.visible=!1}update(){if(void 0===this.object)return;this.updateHelperMatrix();let{depth:t}=this.object.geometry.userData.parameters;this.caretMesh.position.z=t,this.selectionMesh.position.z=t}updateHelperMatrix(){if(void 0===this.object)return;let t=this.object,e=t.parent;null!==e&&e.updateWorldMatrix(!0,!1),t.matrixAutoUpdate&&t.updateMatrix(),null!==e?(this.matrixWorld.multiplyMatrices(e.matrixWorld,t.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,t.matrix)):this.matrixWorld.multiplyMatrices(t.hiddenMatrix,t.matrix),this.matrix.copy(this.matrixWorld);for(let i of this.children)i.matrixWorld.copy(this.matrixWorld);t.updateWorldMatrix(!0,!0)}setCaretColor(t){let e=this.caretMesh.material;e.color.setRGB(t.r,t.g,t.b);let i=this._caretVisibleAlpha===e.opacity;this._caretVisibleAlpha=t.a,i&&(e.opacity=this._caretVisibleAlpha)}setSelectionColor(t){this.selectionMesh.material.color.setRGB(t.r,t.g,t.b)}setCaretPosition(t){if(void 0===this.object)return;this.caretIndex=t;let e=this.object.wrappedText,[i,n]=qY(e,t),[r,s]=t>0?qY(e,t-1):[null,null];"\n"===(t>0&&e.length?e[r].charAt(s):null)&&(i++,n=0),this.current.start=t,this.current.end=void 0;let[a,o]=WY(this.object,i,n),{AD:l,descender:h}=this.object,c=h+.5*l,{width:u,height:d,depth:p}=this.object.geometry.userData.parameters,f="string"==typeof u?0:u,m="string"==typeof d?0:d;this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.set(a-.5*f,o+c+.5*m,p),this.hideSelectionMesh(),this.showCaretMesh()}setSelection(t,e){if(void 0===this.object)return;let i=this.object.wrappedText;this.current.start=t,this.current.end=e;let n=[],r=[],s=function(t,e,i){let[n,r]=qY(t,e),[s,a]=qY(t,i),o=[];r>=t[n].length&&(n++,r=0);for(let l=n;l<=s;l++){let e=t[l],i=l===n?r:0,h=l===s?a:e.length;o.push([l,i,h])}return o}(i,t,e),{lineHeight:a,AD:o,descender:l}=this.object,h=l+.5*o-.5*a;for(let[g,v,y]of s)if(v!==y){let[t,e]=WY(this.object,g,v),[i,s]=WY(this.object,g,y);e+=h,s+=h,s+=a;let o=n.length/3;n.push(t,e,0),n.push(i,e,0),n.push(i,s,0),n.push(t,s,0),r.push(o+0,o+1,o+2),r.push(o+2,o+3,o+0)}let c=new Hg;c.setIndex(r),c.setAttribute("position",new Bg(n,3));let{width:u,height:d,depth:p}=this.object.geometry.userData.parameters,f="string"==typeof u?0:u,m="string"==typeof d?0:d;this.selectionMesh.geometry.dispose(),this.selectionMesh.geometry=c,this.selectionMesh.position.x=.5*-f,this.selectionMesh.position.y=.5*m,this.selectionMesh.position.z=p,this.showSelectionMesh(),this.hideCaretMesh()}getSelectionFromPosition(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"previous";if(void 0===this.object||void 0===this.object.font)return;let n=this.object.wrappedText,r=n.length,s=this.object.lineHeight,a=r*s,{height:o,verticalAlign:l}=this.object.geometry.userData.parameters,h="string"==typeof o?0:o,c=0;3===l?c=h-a:2===l&&(c=.5*h-.5*a);let u=Math.min(Math.floor(Math.max(Math.min(-e-c,a),0)/s),r-1),d=this.object.charCoords[u],p=this.object.charWidths[u],f=0,m=!1;if("previous"===i){for(let g=0;g<d.length;g++)if(d[g][0]+.5*p[g]-t>0){f=g,m=!0;break}}else if("closest"===i){let e=1/0;for(let i=0;i<d.length;i++){let n=d[i][0]+.5*p[i],r=Math.abs(n-t);r<e&&(e=r,f=i,m=!0)}}else for(let g=0;g<d.length;g++){let e=d[g][0],i=d[g][0]+p[g];if(t>=e&&t<i){f=g,m=!0;break}}return m||(f=d.length),{index:this.getGlobalIndexFromLineAndCharIndexes(n,u,f),lineIndex:u,characterIndex:f}}getGlobalIndexFromLineAndCharIndexes(t,e,i){return t.slice(0,e).reduce(((t,e)=>t+e.length),0)+i}showSelectionMesh(){this.selectionMesh.material.opacity=this._selectionVisibleAlpha}hideSelectionMesh(){this.selectionMesh.material.opacity=0}showCaretMesh(){this.caretMesh.material.opacity=this._caretVisibleAlpha}hideCaretMesh(){this.caretMesh.material.opacity=0}};function WY(t,e,i){let{charCoords:n,charWidths:r,initialOffsetY:s,lineHeight:a}=t;if(n[e]&&0===n[e].length||0===n.length){let i=0,{horizontalAlign:n}=t.data.geometry,r=t.wrappedText,{width:o}=t.geometry.userData.parameters;return 1===r.length&&0===r[0].length&&(3===n?i=.5*o:2===n&&(i=o)),[i,s-a*e]}let o=n[e];if(void 0===o||0===o.length)return[0,0];let[l,h]=o[Math.min(i,o.length-1)];return i>=o.length&&(l+=r[e][i-1]),[l,h]}function qY(t,e){let i=0;for(let n=0;n<t.length;n++){let r=t[n],s=e-i;if(s<=r.length)return[n,s];i+=r.length}return[Math.max(0,t.length-1),t[t.length-1]?.length??0]}function YY(t,e){return"string"==typeof t?e.data.colors[t]:t}function XY(t){return t.colors[0]}var QY,KY=class extends(OW(CS,UY)){constructor(t,e,i){super(),this.super_Entity(t,e),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let n=this.shadow.camera;n.top=1250,n.bottom=-1250,n.right=1250,n.left=-1250,n.near=-1e4,n.far=2500;let r=new uA(this.shadow.camera);r.visible=!1,this.gizmos.shadowmap=r}update(){this.shadow.camera.updateProjectionMatrix();for(let t in this.gizmos){let e=this.gizmos[t];e instanceof uA&&e.update()}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.objectHelper&&this.objectHelper.update()}updateState(t,e){this.updateState_Light(t,e);let i=void 0!==t.depth&&t.depth!==this.shadow.camera.far||void 0!==t.size&&t.size/2!==this.shadow.camera.right;void 0!==t.size&&function(t,e){t.shadow.camera.right=e/2,t.shadow.camera.left=-e/2,t.shadow.camera.top=e/2,t.shadow.camera.bottom=-e/2,t.shadow.needsUpdate=!0}(this,t.size),void 0!==t.shadowRadius&&(this.shadow.radius=t.shadowRadius),void 0!==t.shadowResolution&&(this.shadow.mapSize.set(t.shadowResolution,t.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),void 0!==t.penumbraSize&&e.scene.markPenumbraSizeDirty(),i&&this.update()}},ZY=new mm,JY=new mm,$Y=new fm,tX=class extends(OW(bS,GY)){constructor(t,e,i){super(),this.super_Entity(t,e),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let n=this.shadow.camera;n.fov=2*Nf.RAD2DEG*this.angle,n.aspect=1,n.near=100,n.far=2500;let r=new uA(this.shadow.camera);r.visible=!1,this.gizmos.shadowmap=r,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let t in this.gizmos){let e=this.gizmos[t];e instanceof uA&&e.update()}}updateMatrixWorld(t){super.updateMatrixWorld(t),JY.setFromMatrixPosition(this.matrixWorld),$Y.setFromRotationMatrix(this.matrixWorld),ZY.copy(this.up).applyQuaternion($Y).negate().multiplyScalar(this.distance),this.target.position.copy(JY).add(ZY),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(t,e){this.updateState_Light(t,e),void 0!==t.distance&&(this.distance=t.distance),void 0!==t.decay&&(this.decay=t.decay),void 0!==t.angle&&(this.angle=t.angle),void 0!==t.penumbra&&(this.penumbra=t.penumbra),void 0!==t.shadowRadius&&(this.shadow.radius=t.shadowRadius),void 0!==t.penumbraSize&&e.scene.markPenumbraSizeDirty(),void 0!==t.shadowResolution&&(this.shadow.mapSize.set(t.shadowResolution,t.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}};function eX(t,e){return[[t[0][0]*e[0][0]+t[0][1]*e[1][0],t[0][0]*e[0][1]+t[0][1]*e[1][1]],[t[1][0]*e[0][0]+t[1][1]*e[1][0],t[1][0]*e[0][1]+t[1][1]*e[1][1]]]}function iX(t){return[[t[0][0],t[1][0]],[t[0][1],t[1][1]]]}function nX(t){let[e,i,n]=function(t){let e=(t[0][0]+t[1][1])/2,i=(t[0][0]-t[1][1])/2,n=(t[1][0]+t[0][1])/2,r=(t[1][0]-t[0][1])/2,s=Math.sqrt(e*e+r*r),a=Math.sqrt(i*i+n*n),o=s+a,l=s-a,h=Math.atan2(n,i),c=Math.atan2(r,e),u=(c-h)/2,d=(c+h)/2,p=[[Math.cos(d),Math.sin(d)],[-Math.sin(d),Math.cos(d)]],f=[[o,0],[0,l]],m=[[Math.cos(u),Math.sin(u)],[-Math.sin(u),Math.cos(u)]];return p[0][0]*=-1,p[0][1]*=-1,m[0][0]*=-1,m[1][0]*=-1,[p,f,m]}(t),r=eX(e,iX(n)),s=eX(eX(n,i),iX(n));return{rotation:Math.atan2(r[1][0],r[0][0]),scale:[s[0][0],s[1][1]],shear:[s[0][1]/s[1][1],s[1][0]/s[0][0]]}}(t=>{function e(t){return[t[0],t[3],t[1],t[4],t[2],t[5]]}t.identity=function(){return[1,0,0,0,1,0,0,0,1]},t.copy=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.identity();for(let t=0,n=e.length;t<n;t++)i[t]=e[t];return i},t.create=function(e,i,n,r,s,a){return t.setAbcdef(t.identity(),e,i,n,r,s,a)},t.setAbcdef=function(t,e,i,n,r,s,a){return t[0]=e,t[1]=n,t[2]=s,t[3]=i,t[4]=r,t[5]=a,t},t.append=function(i,n){let[r,s,a,o,l,h]=e(i),[c,u,d,p,f,m]=e(n),g=c*r+u*a,v=c*s+u*o,y=d*r+p*a,b=d*s+p*o,x=f*r+m*a+l,w=f*s+m*o+h;return t.create(g,v,y,b,x,w)},t.prepend=function(i,n){let[r,s,a,o,l,h]=e(i),[c,u,d,p,f,m]=e(n),g=r,v=s,y=a,b=o;(1!==c||0!==u||0!==d||1!==p)&&(g=r*c+s*d,v=r*u+s*p,y=a*c+o*d,b=a*u+o*p);let x=l*c+h*d+f,w=l*u+h*p+m;return t.create(g,v,y,b,x,w)},t.getAbcdef=e,t.invert=function(e){let[i,n,r,s,a,o]=t.getAbcdef(e),l=i*s-n*r,h=s/l,c=-n/l,u=-r/l,d=i/l,p=(r*o-s*a)/l,f=-(i*o-n*a)/l;return t.create(h,c,u,d,p,f)},t.apply=function(e,i){let[n,r]=e,[s,a,o,l,h,c]=t.getAbcdef(i);return[s*n+o*r+h,a*n+l*r+c]},t.applyInverse=function(e,i){let[n,r,s,a,o,l]=t.getAbcdef(i),h=1/(n*a+s*-r),[c,u]=e;return[a*h*c+-s*h*u+(l*s-o*a)*h,n*h*u+-r*h*c+(-l*n+o*r)*h]},t.scale=function(e,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i,[r,s,a,o,l,h]=t.getAbcdef(e);return t.setAbcdef(e,r*i,s*n,a*i,o*n,l*i,h*n),e},t.rotate=function(e,i){let n=Math.cos(i),r=Math.sin(i),[s,a,o,l,h,c]=t.getAbcdef(e);return t.setAbcdef(e,s*n-a*r,s*r+a*n,o*n-l*r,o*r+l*n,h*n-c*r,h*r+c*n),e},t.rotateAround=function(e,i,n){let[r,s]=n,a=t.translate(e,-r,-s);return a=t.rotate(a,i),a=t.translate(a,r,s),a},t.translate=function(e,i,n){let[r,s,a,o,l,h]=t.getAbcdef(e);return t.setAbcdef(e,r,s,a,o,l+i,h+n),e},t.setTranslate=function(e,i,n){let[r,s,a,o]=t.getAbcdef(e);return t.setAbcdef(e,r,s,a,o,i,n),e},t.setPosition=function(e,i,n){let[r,s,a,o]=t.getAbcdef(e);return t.setAbcdef(e,r,s,a,o,i,n),e},t.getScale=function(e){let[i,n,r,s]=t.getAbcdef(e);return[Math.sqrt(i*i+n*n),Math.sqrt(r*r+s*s)]},t.getPosition=function(e){let[,,,,i,n]=t.getAbcdef(e);return[i,n]},t.getRotation=function(e,i){return t.decompose(e,i).rotation},t.decompose=function(e,i){let[n,r,s,a,o,l]=t.getAbcdef(e),{rotation:h,scale:c,shear:u}=nX([[n,s],[r,a]]);return{position:[o+(i[0]*n+i[1]*s)-i[0],l+(i[0]*r+i[1]*a)-i[1]],scale:c,rotation:h,shear:u,pivot:i}},t.compose=function(e,i,n,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0,0],[a,o]=e,[l,h]=r,[c,u,d,p]=function(t){let{rotation:e,scale:i,shear:n}=t,r=Math.cos(e),s=Math.sin(e),a=eX([[r,-s],[s,r]],[[i[0],n[0]*i[1]],[n[1]*i[0],i[1]]]);return[a[0][0],a[1][0],a[0][1],a[1][1]]}({rotation:n,scale:i,shear:s}),f=a-(l*c+h*d)+l,m=o-(l*u+h*p)+h;return t.create(c,u,d,p,f,m)}})(QY||(QY={}));var rX=Math.PI/180;Math.PI;var sX=class{constructor(t,e,i){this.uuid=t,this.data=e,this.localMatrix=QY.identity(),this.worldMatrix=QY.identity(),this.ignoreCameraZoom=!1,this.visible=!0,this._singleBBox=new mX,this._recursiveBBox=new mX,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this.stateSelection=null,this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this.name="",this.position=[0,0],this.scale=[1,1],this.rotation=0,this.shear=[0,0],this.emitter=vN(),this.dpr=i.dpr??1,this.dataPatched=e}project(t,e){let i=this.worldMatrix;return e&&(i=QY.append(e.worldMatrix,i)),QY.applyInverse(t,i)}intersects(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.visible&&!this.data.raycastLock&&this.intersectsInLocalSpace(...this.project([t,e],i),n)}intersectsInLocalSpace(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{min:n,max:r}=i?this.recursiveBBox:this.singleBBox;return t>=n[0]&&t<=r[0]&&e>=n[1]&&e<=r[1]}applyTransforms(t){t.setTransform(this.worldMatrix,this.ignoreCameraZoom)}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges()),this._recursiveBBox}updateLocalMatrix(){this.localMatrix=QY.compose(this.position,this.scale,function(t){return t*rX}(this.rotation),YO.getPivot(this.dataPatched),this.shear)}updateWorldMatrix(t,e,i){let n=this.parent;e&&null!==n&&void 0!==n&&n.updateWorldMatrix(t,!0,!1),t&&this.updateLocalMatrix(),this.parent?this.worldMatrix=QY.append(this.parent.worldMatrix,this.localMatrix):this.worldMatrix=QY.copy(this.localMatrix),this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}get pivot(){return YO.getPivot(this.data)}getCenter(){return[0,0]}getHalfSize(){return[0,0]}get id(){return this.uuid}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors((t=>{t.resetBBoxNeedsUpdateSelf()}))}updateTransformState(t){let e=!1;void 0!==t.position&&(e=!0,this.position=t.position),void 0!==t.rotation&&(e=!0,this.rotation=t.rotation),void 0!==t.scale&&(e=!0,this.scale=t.scale),void 0!==t.shear&&(e=!0,this.shear=t.shear),e&&(this.updateWorldMatrix(!0,!1,!0),this.resetBBoxNeedsUpdate())}updateByOp(t,e,i){0===t.type&&void 0!==t.props.visible&&(this.visible=t.props.visible),this.data=e,this.data=e;let n=t,r=ED(t.path,["states","*"]);if(null!==r){if(0===t.type){let[e]=r;if(this?.stateSelection===e){let e={...t.props};if(delete e.name,Object.values(t.props).some((t=>void 0===t))){let i=this.data;if(void 0!==i){let n=yD.zoom(i,t.path.slice(2));if(n)for(let i in t.props)void 0===t.props[i]&&i in n&&(e[i]=n[i])}}n={...t,props:e,path:t.path.slice(2)}}}}else if(0===t.type){let e=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(void 0!==e){if(void 0!==t.props.name&&e.name){let{name:t,...i}=e;e=i}let i=yD.removeOverridden(t.path,t.props,e);n={...t,props:i}}}this.updateByPatchedOpBase(n,BO.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),i)}changeSelectedState(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0!==this.data.states.length||i){for(let t of this.data.states)BO.toOps(this.data,t.data).forEach((t=>{let i=XT.replaceProps(t,this.data);this.dataPatched=this.data,this.updateByPatchedOp(i,this.data,e)}));if(null!==t){let i=this.data.states.data(t);i&&(this.dataPatched=BO.patch(this.data,i),BO.toOps(this.data,i).forEach((t=>{this.updateByPatchedOp(t,this.dataPatched,e)})))}i&&this.updateTransformState(this.dataPatched),this.stateSelection=t}}updateState(t,e){void 0!==t.name&&(this.name=t.name),void 0!==t.visible&&(this.visible=t.visible),this.updateTransformState(t)}updateByPatchedOpBase(t,e,i){this.dataPatched=e,this.updateByPatchedOp(t,e,i)}updateByPatchedOp(t,e,i){0===t.path.length&&0===t.type&&this.updateState(t.props,i),this.requestRender()}traverseFrameAncestors(t){this.traverseAncestors((e=>{"frame2d"===e.data.type&&t(e)}))}traverseAncestors(t){let e=this.parent;for(;e;)t(e),e=e.parent}requestRender(){this.traverseFrameAncestors((t=>{t.requestRender()}))}clone(t){let e=new sX(this.uuid,this.data,t);return e.parent=void 0,e}addEventListener(t,e){this.emitter.on(t,e)}removeEventListener(t,e){this.emitter.off(t,e)}dispatchEvent(t){this.emitter.emit(t.type,{...t,target:t.target??this})}traverseSortNextHelper(){let t=this.parent;if(t){let e=t.children;if(e){let i=e.indexOf(this)+1;return e[i]?e[i]:t.traverseSortNextHelper()}}}sortNext(){let t=this.children;return t&&t.length>0&&t[0]?t[0]:this.traverseSortNextHelper()}isDescendantOf(t){t instanceof sX&&(t=t.uuid);let e=this;for(;e.parent;){if(e.parent.uuid===t)return!0;e=e.parent}return!1}},aX=class extends sX{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this.context=i,this.children=[]}add(t){t.parent&&t.parent instanceof aX&&t.parent.remove(t),this.children.push(t),t.parent=this}remove(t){let e=this.children.indexOf(t);e>=0&&(this.children.splice(e,1),t.parent=void 0)}traverse(t){let e=t(this);if(!0!==e)for(let i of this.children)i instanceof aX?i.traverse(t):e=t(i)}intersectsChildrenHelper(t,e,i,n,r){for(let s of this.children)if(s.intersects(t,e,i,!1)&&(r.push(s),n)||s instanceof aX&&s.intersectsChildrenHelper(t,e,i,n,r))return!0;return!1}intersectsChildren(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return this.intersectsChildrenHelper(t,e,i,n,r),r}intersectsChildrenHelperReverse(t,e,i,n,r){for(let s of this.children)if(s instanceof aX&&s.intersectsChildrenHelperReverse(t,e,i,n,r)||s.intersects(t,e,i,!1)&&(r.push(s),n))return!0;return!1}intersectsChildrenReverse(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return this.intersectsChildrenHelperReverse(t,e,i,n,r),r}updateWorldMatrix(t,e,i){if(super.updateWorldMatrix(t,e,i),i&&this.children)for(let n of this.children)n.updateWorldMatrix(t,!1,!0)}find(t){let e;return this.traverse((i=>{i.uuid===t&&(e=i)})),e}innerDrawChildren(t){for(let e=this.children.length-1;e>=0;e--)this.children[e].draw(t)}resetBBoxNeedsUpdate(){super.resetBBoxNeedsUpdate(),this.traverse((t=>{t.resetBBoxNeedsUpdateSelf()}))}clone(t){let e=new aX(this.uuid,this.data,t);e.parent=void 0;for(let i of this.children)e.add(i.clone(t));return e}},oX=class extends aX{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this.updateState(e,i)}draw(t){!this.visible||(t.save(),this.applyTransforms(t),this.innerDrawChildren(t),t.restore())}clone(t){let e=new oX(this.uuid,this.data,t);e.parent=void 0;for(let i of this.children)e.add(i.clone(t));return e}};function lX(t,e){let[[i,n],[r,s]]=t,[[a,o],[l,h]]=e,c=(i-r)*(o-h)-(n-s)*(a-l);if(0===c)return!1;let u=((i-a)*(o-h)-(n-o)*(a-l))/c,d=-((i-r)*(n-o)-(n-s)*(i-a))/c;return u>=0&&u<=1&&d>=0&&d<=1}var hX,cX,uX,dX,pX=[[-1,1],[-1,-1],[1,-1],[1,1]],fX=(t,e,i)=>{let n=t.getCenter(),r=t.getHalfSize(),s=QY.append(e,t.worldMatrix);0===r[0]&&0===r[1]?i.push(QY.apply(n,s)):pX.forEach((t=>{let e=[t[0]*r[0]+n[0],t[1]*r[1]+n[1]];i.push(QY.apply(e,s))}))},mX=class{constructor(){this.matrix=QY.identity(),this.min=[1/0,1/0],this.max=[-1/0,-1/0],this.vertices=[],this.edges=[]}setFromObjectSize(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.updateWorldMatrix(),this.makeEmpty(),QY.copy(t.worldMatrix,this.matrix);let i=QY.invert(t.worldMatrix);this.expandByObjectSize(t,i,e)}expandByObjectSize(t,e){let i=[];!0===(arguments.length>2&&void 0!==arguments[2]&&arguments[2])&&t instanceof aX?t.traverse((t=>{t.visible&&fX(t,e,i)})):fX(t,e,i),this.setFromPoints(i)}setFromSize(t,e,i){this.makeEmpty(),QY.copy(i,this.matrix),this.expandBySize(t,e,i)}expandBySize(t,e,i){[QY.apply([0,0],i),QY.apply([0,e],i),QY.apply([t,e],i),QY.apply([t,0],i)].forEach((t=>this.expandByPoint(t)))}getCenter(){let[t,e]=this.min,[i,n]=this.getHalfSize();return QY.apply([t+i,e+n],this.matrix)}getSize(){return[this.max[0]-this.min[0],this.max[1]-this.min[1]]}getHalfSize(){return[.5*(this.max[0]-this.min[0]),.5*(this.max[1]-this.min[1])]}makeEmpty(){this.min=[1/0,1/0],this.max=[-1/0,-1/0]}setFromPoints(t){this.makeEmpty();for(let e of t)this.expandByPoint(e)}expandByPoint(t){this.min=[Math.min(this.min[0],t[0]),Math.min(this.min[1],t[1])],this.max=[Math.max(this.max[0],t[0]),Math.max(this.max[1],t[1])]}computeVertices(){let[t,e]=this.getHalfSize(),i=this.getCenter(),[n,r,s,a]=QY.getAbcdef(this.matrix),o=QY.create(n,r,s,a,i[0],i[1]);this.vertices=pX.map((i=>{let[n,r]=i;return QY.apply([n*t,r*e],o)}))}computeEdges(){this.edges=[];for(let t=0,e=this.vertices.length;t<e;++t)this.edges.push([this.vertices[t],this.vertices[(t+1)%e]])}project(t,e){let i=this.matrix;return e&&(i=QY.append(e.worldMatrix,i)),QY.applyInverse(t,i)}intersects(t,e,i){return this.intersectsInLocalSpace(...this.project([t,e],i))}intersectsInLocalSpace(t,e){let{min:i,max:n}=this;return t>=i[0]&&t<=n[0]&&e>=i[1]&&e<=n[1]}containsPoint(t){let[e,i]=t,[n,r]=this.min,[s,a]=this.max;return e>=n&&e<=s&&i>=r&&i<=a}intersectsBBox2D(t){for(let e=0,i=this.edges.length;e<i;e++){let i=this.edges[e];for(let e=0,n=t.edges.length;e<n;e++){if(lX(i,t.edges[e]))return!0}}for(let e=0,i=t.vertices.length;e<i;e++){let i=t.vertices[e];if(this.containsPoint(i))return!0}return!1}ensureMinMax(){let t=this.min,e=this.max;this.min=[Math.min(t[0],e[0]),Math.min(t[1],e[1])],this.max=[Math.max(t[0],e[0]),Math.max(t[1],e[1])]}copy(t){this.min=[...t.min],this.max=[...t.max],QY.copy(t.matrix,this.matrix),this.computeVertices(),this.computeEdges()}clone(){let t=new mX;return t.copy(this),t}},gX=new Promise((t=>{hX=t})),vX=!1;function yX(){if(!vX)return cX||(cX=async function(){let t=await __webpack_require__.e(160).then(__webpack_require__.bind(__webpack_require__,160));hX(t.default??t),vX=!0}(),cX)}function bX(t){let e=!1;return t.scene.objects.traverse(((t,i)=>{("Mesh"===i.type&&"UIGeometry"===i.geometry.type||"Page"===i.type&&void 0!==i.uiFrame)&&(e=!0)})),e}var xX=QY.identity(),wX=class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.canvas=t,this._dpr=e,this._width=0,this._height=0,this._strokeMode="inside",this._layerBlur=0,this._backgroundBlur=0,this._dropShadowBlur=0,this._dropShadowOffsetX=0,this._dropShadowOffsetY=0,this._dropShadowColor=II.transparent,this._innerShadowBlur=0,this._innerShadowOffsetX=0,this._innerShadowOffsetY=0,this._innerShadowSpread=0,this._innerShadowColor=II.transparent,this._fonts=new Map,this._isSizeDirty=!1;try{let i=t.getBoundingClientRect();t.width=i.width*e,t.height=i.height*e}catch{console.log(t.width,e)}this._currentM3Transform=xX,this._currentTransform=new Float32Array(xX)}get dpr(){return this._dpr}set dpr(t){this._dpr=t,this._isSizeDirty=!0}async init(){if(!this.wasmURL)throw Error("Your must set the wasm binary url with renderer.wasmURL = ... before you can call renderer.init");await async function(t){let e=await gX;uX||(dX||(dX=e({locateFile:()=>t})),uX=await dX)}(this.wasmURL),this._surface=uX.MakeWebGLCanvasSurface(this.canvas),this.ctx=this._surface?.getCanvas(),this._paint=new uX.Paint,this._paint.setAntiAlias(!0),this._paintFill=this._paint.copy(),this._paintFill.setStyle(uX.PaintStyle.Fill),this._paintStroke=this._paint.copy(),this._paintStroke.setStyle(uX.PaintStyle.Stroke),this.ctx?.scale(this.dpr,this.dpr)}get currentTransform(){return this._currentM3Transform}get currentTransformBuffer(){return this._currentTransform}set currentTransform(t){this._currentM3Transform=t,this._currentTransform.set(t)}async loadFont(t,e){let i=await(await fetch(t)).arrayBuffer();this.registerFont(i,e)}registerFont(t,e){if(this._fonts.has(e))return;let i=uX.FontMgr.FromData(t);if(!i)throw new Error("Invalid font data for "+e);this._fonts.set(e,i)}get width(){return this._width}get height(){return this._height}set strokeColor(t){this._paintStroke&&this._paintStroke.setColor(AX(t),uX.ColorSpace.DISPLAY_P3)}set fillColor(t){this._paintFill&&this._paintFill.setColor(AX(t),uX.ColorSpace.DISPLAY_P3)}set lineWidth(t){this._paintStroke&&this._paintStroke.setStrokeWidth("center"===this._strokeMode?t:2*t)}set strokeMode(t){this._strokeMode=t}set dropShadowBlur(t){this._dropShadowBlur=t}set dropShadowColor(t){this._dropShadowColor=t}set dropShadowOffsetX(t){this._dropShadowOffsetX=t}set dropShadowOffsetY(t){this._dropShadowOffsetY=t}set innerShadowBlur(t){this._innerShadowBlur=t}set innerShadowColor(t){this._innerShadowColor=t}set innerShadowOffsetX(t){this._innerShadowOffsetX=t}set innerShadowOffsetY(t){this._innerShadowOffsetY=t}set innerShadowSpread(t){this._innerShadowSpread=t}set layerBlur(t){this._layerBlur=t}set backgroundBlur(t){this._backgroundBlur=t}clear(){this.ctx?.clear(uX.TRANSPARENT)}save(){this.ctx?.save()}restore(){this.ctx?.restore()}beginPath(){this._currentPath?.delete(),this._currentPath=new uX.Path}closePath(){let t=this._currentPath;if(t){if(t.isEmpty())return;let e=t.getBounds();(e[3]-e[1]||e[2]-e[0])&&t.close()}}fill(){this._paintInner(this._paintFill,!0)}stroke(){this._paintInner(this._paintStroke,!1)}clipRect(t,e,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=uX.XYWHRect(t,e,i,n);if(0===r&&0===s&&0===o&&0===a)this.ctx?.clipRect(l,uX.ClipOp.Intersect,!0);else{let t=uX.RRectXY(l,r,r);t[4]=t[5]=r,t[6]=t[7]=s,t[8]=t[9]=a,t[10]=t[11]=o,this.ctx?.clipRRect(t,uX.ClipOp.Intersect,!0)}}_applyShadowOffsetMatrix(){if(this.ctx){let t=QY.invert(this.currentTransform);this.ctx.concat(t);let e=QY.translate(QY.identity(),this._dropShadowOffsetX,this._dropShadowOffsetY);this.ctx.concat(e),this.ctx.concat(this._currentTransform)}}_applyEffectsToPaint(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.ctx&&this._currentPath){let n,r=!1;if(i&&this._hasDropShadow()){let i,n=t.copy();n.setColor(AX(this._dropShadowColor)),this._dropShadowBlur>0&&(i=uX.MaskFilter.MakeBlur(uX.BlurStyle.Normal,this._dropShadowBlur*this.dpr*(this.camera?.scale??1),!1),n.setMaskFilter(i)),this.ctx.save(),this.ctx.clipPath(this._currentPath,uX.ClipOp.Difference,!0),this._applyShadowOffsetMatrix(),e(n),this.ctx.restore(),n.delete(),i?.delete()}if(this._backgroundBlur>0&&i){this.ctx.save(),this.ctx.clipPath(this._currentPath,uX.ClipOp.Intersect,!0);let e=uX.ImageFilter.MakeBlur(this._backgroundBlur,this._backgroundBlur,uX.TileMode.Clamp,null),i=t.copy();i.setImageFilter(e),i.setAlphaf(1);let n=this._currentPath.computeTightBounds();this.ctx.saveLayer(i,n,null,uX.SaveLayerInitWithPrevious),this.ctx.drawColor(t.getColor()),this.ctx.restore(),this.ctx.restore(),i.delete(),e.delete(),r=!0}if(this._layerBlur>0){let i=t.copy();n=uX.MaskFilter.MakeBlur(uX.BlurStyle.Normal,this._layerBlur*this.dpr*(this.camera?.scale??1),!1),i.setMaskFilter(n),e(i),i.delete(),n.delete(),r=!0}if(r||e(t),i&&this._hasInnerShadow()){let t,e=new uX.Paint;e.setAntiAlias(!0),e.setStyle(uX.PaintStyle.Fill),e.setColor(AX(this._innerShadowColor)),this._innerShadowBlur>0&&(t=uX.MaskFilter.MakeBlur(uX.BlurStyle.Normal,this._innerShadowBlur*this.dpr*(this.camera?.scale??1),!1),e.setMaskFilter(t));let i=this._currentPath.computeTightBounds(),[n,r,s,a]=i,o=s-n,l=a-r;this.ctx.save(),this.ctx.clipPath(this._currentPath,uX.ClipOp.Intersect,!0),this.ctx.saveLayer(e,i,null,uX.SaveLayerInitWithPrevious),this.ctx?.translate(this._innerShadowOffsetX,this._innerShadowOffsetY),this.ctx.drawRect(uX.XYWHRect(-1e3-this._innerShadowOffsetX,-1e3-this._innerShadowOffsetY,2e3+o+Math.abs(2*this._innerShadowOffsetX),2e3+l+Math.abs(2*this._innerShadowOffsetY)),e),e.setBlendMode(uX.BlendMode.Clear),this.ctx.drawPath(this._currentPath,e),this.ctx.restore(),this.ctx.restore(),e.delete(),t?.delete()}}}_paintInner(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.ctx&&this._currentPath&&t){let i=this.ctx,n=this._currentPath;this._applyEffectsToPaint(t,(t=>{let r=!1;!e&&"center"!==this._strokeMode&&(i.save(),i.clipPath(n,"outside"===this._strokeMode?uX.ClipOp.Difference:uX.ClipOp.Intersect,!0),r=!0),i.drawPath(n,t),r&&i.restore()}),e)}}_hasDropShadow(){return this._dropShadowColor?.a>0}_hasInnerShadow(){return this._innerShadowColor?.a>0}path(t){this._currentPath?.addPath(uX.Path.MakeFromSVGString(t))}ellipse(t,e,i,n,r,s,a,o){if(!SX([t,e,i,n])||!this._currentPath)return;if(i<0||n<0)throw Error("radii cannot be negative");let l=uX.XYWHRect(t-i,e-n,2*i,2*n);this._currentPath?.addOval(l)}rect(t,e,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=uX.XYWHRect(t,e,i,n);if(SX(l))if(0===r&&0===s&&0===o&&0===a)this._currentPath?.addRect(l);else{let t=uX.RRectXY(l,r,r);t[4]=t[5]=r,t[6]=t[7]=s,t[8]=t[9]=a,t[10]=t[11]=o,this._currentPath?.addRRect(t)}}getHorizontalAlign(t){switch(t){case 2:return uX.TextAlign.Right;case 3:return uX.TextAlign.Center;case 4:return uX.TextAlign.Justify;default:return uX.TextAlign.Left}}drawTextInner(t,e,i,n,r,s){let[a,o,l,h]=n,c=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],u=0,{ctx:d}=this;if(!d)return u;let p=s.copy(),f=s.copy();return f.setAlphaf(0),this._applyEffectsToPaint(p,(n=>{e.pushPaintStyle(i,n,f),e.addText(t);let s=e.build();s.layout(l);let c=o;2===r?c+=(h-s.getHeight())/2:3===r&&(c+=h-s.getHeight()),d.drawParagraph(s,a,c),u=s.getHeight(),e.reset(),s.delete()}),c),p.delete(),f.delete(),u}drawText(t,e){let i=0,n=this._fonts.get(e.font),{ctx:r,_paintFill:s,_paintStroke:a}=this;if(n&&r){let r=new uX.TextStyle({fontFamilies:[e.font],fontSize:e.fontSize,heightMultiplier:e.lineHeight,letterSpacing:e.letterSpacing}),o=new uX.ParagraphStyle({textStyle:r,textAlign:this.getHorizontalAlign(e.horizontalAlign)}),l=uX.XYWHRect(e.x,e.y,e.width,e.height),h=uX.ParagraphBuilder.Make(o,n);s&&(i=this.drawTextInner(t,h,r,l,e.verticalAlign,s,!0)),a&&(i=this.drawTextInner(t,h,r,l,e.verticalAlign,a,!1)),h.delete()}return{height:i}}render(){this._surface?.flush()}moveTo(t,e){this._currentPath?.moveTo(t,e)}lineTo(t,e){this._currentPath?.lineTo(t,e)}bezierCurveTo(t,e,i,n,r,s){this._currentPath?.cubicTo(t,e,i,n,r,s)}quadraticCurveTo(t,e,i,n){this._currentPath?.quadTo(t,e,i,n)}setTransform(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.ctx)return;let i=this.ctx.getTotalMatrix(),n=QY.invert(i);if(n&&this.ctx.concat(n),this.ctx?.scale(this.dpr,this.dpr),this.camera?.enabled&&(this.ctx?.concat(this.camera.worldMatrix),e)){let t=QY.getScale(this.camera.worldMatrix);this.ctx?.scale(1/t[0],1/t[1])}this.ctx?.concat(t),this.currentTransform=t}transform(t){this.ctx?.concat(t)}setSize(t,e){!this._isSizeDirty&&t===this._width&&e===this._height||(this._isSizeDirty=!1,this._width=t,this._height=e,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",this.canvas.width=t*this.dpr,this.canvas.height=e*this.dpr,this._surface&&(this._surface=uX.MakeWebGLCanvasSurface(this.canvas),this.ctx=this._surface?.getCanvas()))}};function SX(t){for(let e=0;e<t.length;e++)if(void 0!==t[e]&&!Number.isFinite(t[e]))return!1;return!0}function AX(t){let{r:e,g:i,b:n,a:r}=t;return uX.Color4f(e,i,n,r)}var EX,_X,CX,MX=class{constructor(t,e,i){this.uuid=t,this.data=e,this.enabled=!1,this.color=II.transparent,this.blurRadius=0,this.offset=[0,0],this.spread=0,this.update(e)}update(t){void 0!==t.color&&(this.color=t.color),void 0!==t.enabled&&(this.enabled=t.enabled),void 0!==t.blurRadius&&(this.blurRadius=t.blurRadius),void 0!==t.offset&&(this.offset=t.offset),void 0!==t.spread&&(this.spread=t.spread)}},PX=class{constructor(t,e,i){this.uuid=t,this.data=e,this.enabled=!1,this.radius=0,this.update(e)}update(t){void 0!==t.enabled&&(this.enabled=t.enabled),void 0!==t.radius&&(this.radius=t.radius)}},TX=class{constructor(t,e,i){this.uuid=t,this.data=e,this.enabled=!1,this.color=II.transparent,this.update(e)}update(t){void 0!==t.enabled&&(this.enabled=t.enabled),void 0!==t.color&&(this.color=t.color)}},DX=class{constructor(t,e,i){this.uuid=t,this.data=e,this.enabled=!1,this.color=II.transparent,this.thickness=0,this.mode="inside",this.update(e)}update(t){void 0!==t.enabled&&(this.enabled=t.enabled),void 0!==t.color&&(this.color=t.color),void 0!==t.thickness&&(this.thickness=t.thickness),void 0!==t.mode&&(this.mode=t.mode)}},kX=class extends sX{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this.autoClose=!0,this.fill=new TX(t+"-fill",e.fill,i),this.stroke=new DX(t+"-stroke",e.stroke,i),this.dropShadow=new MX(t+"-dropShadow",e.dropShadow,i),this.innerShadow=new MX(t+"-innerShadow",e.innerShadow,i),this.backgroundBlur=new PX(t+"-backgroundBlur",e.backgroundBlur,i),this.layerBlur=new PX(t+"-layerBlur",e.layerBlur,i)}applyFillStroke(t){t.fillColor=this.fill.enabled?this.fill.color:II.transparent,t.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:II.transparent,t.strokeMode=this.stroke.mode,t.lineWidth=this.stroke.thickness}applyFilters(t){this.layerBlur.enabled?t.layerBlur=5*this.layerBlur.radius:t.layerBlur=0,this.backgroundBlur.enabled?t.backgroundBlur=5*this.backgroundBlur.radius:t.backgroundBlur=0,this.dropShadow.enabled?(t.dropShadowBlur=5*this.dropShadow.blurRadius,t.dropShadowColor=this.dropShadow.color,t.dropShadowOffsetX=this.dropShadow.offset[0],t.dropShadowOffsetY=this.dropShadow.offset[1]):t.dropShadowColor=II.transparent,this.innerShadow.enabled?(t.innerShadowSpread=this.innerShadow.spread,t.innerShadowBlur=5*this.innerShadow.blurRadius,t.innerShadowColor=this.innerShadow.color,t.innerShadowOffsetX=this.innerShadow.offset[0],t.innerShadowOffsetY=this.innerShadow.offset[1]):t.innerShadowColor=II.transparent}innerDraw(t){}draw(t){!this.visible||(t.save(),this.applyTransforms(t),this.applyFilters(t),this.applyFillStroke(t),t.beginPath(),this.innerDraw(t),this.autoClose&&t.closePath(),this.fill.enabled&&t.fill(),this.stroke.enabled&&t.stroke(),t.restore())}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),0===t.type&&(ED(t.path,["fill"])?this.fill.update(t.props):ED(t.path,["stroke"])?this.stroke.update(t.props):ED(t.path,["dropShadow"])?this.dropShadow.update(t.props):ED(t.path,["innerShadow"])?this.innerShadow.update(t.props):ED(t.path,["layerBlur"])?this.layerBlur.update(t.props):ED(t.path,["backgroundBlur"])?this.backgroundBlur.update(t.props):this.resetBBoxNeedsUpdate())}updateState(t,e){super.updateState(t,e),void 0!==t.fill&&this.fill.update(t.fill),void 0!==t.stroke&&this.stroke.update(t.stroke),void 0!==t.dropShadow&&this.dropShadow.update(t.dropShadow),void 0!==t.innerShadow&&this.innerShadow.update(t.innerShadow),void 0!==t.layerBlur&&this.layerBlur.update(t.layerBlur),void 0!==t.backgroundBlur&&this.backgroundBlur.update(t.backgroundBlur)}clone(t){let e=new kX(this.uuid,this.data,t);return e.parent=void 0,e}},IX=class extends kX{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this.width=0,this.height=0,this.updateState(e,i)}innerDraw(t){t.ellipse(.5*this.width,.5*this.height,.5*this.width,.5*this.height,0,0,2*Math.PI)}intersectsInLocalSpace(t,e){return function(t,e,i,n,r,s){let a=t-i,o=e-n;return a*a/(r*r)+o*o/(s*s)<=1}(t,e,.5*this.width,.5*this.height,.5*this.width,.5*this.height)}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateSizeState(t){let e=!1;void 0!==t.width&&(this.width="number"==typeof t.width?t.width:this.width,e=!0),void 0!==t.height&&(this.height="number"==typeof t.height?t.height:this.height,e=!0),e&&this.updateWorldMatrix(!0,!1,!0)}updateState(t,e){super.updateState(t,e),this.updateSizeState(t)}clone(t){let e=new IX(this.uuid,this.data,t);return e.parent=void 0,e}},RX=class extends kX{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this.width=0,this.height=0,this.cornerRadius=[0,0,0,0],this.updateState(e,i)}innerDraw(t){t.rect(0,0,this.width,this.height,...this.cornerRadius)}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateCornerState(t){void 0!==t.cornerRadius&&(this.cornerRadius=t.cornerRadius)}updateSizeState(t){let e=!1;void 0!==t.width&&(this.width="number"==typeof t.width?t.width:this.width,e=!0),void 0!==t.height&&(this.height="number"==typeof t.height?t.height:this.height,e=!0),e&&this.updateWorldMatrix(!0,!1,!0)}updateState(t,e){super.updateState(t,e),this.updateSizeState(t),this.updateCornerState(t)}clone(t){let e=new RX(this.uuid,this.data,t);return e.parent=void 0,e}},OX=class extends kX{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this._textHeight=0,this._textHeightDirty=!0,this.width=0,this.height=0,this.updateState(e,i)}get textHeight(){return this._textHeight}applyFillStroke(t){t.fillColor=this.fill.enabled?this.fill.color:II.transparent,t.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:II.transparent,t.strokeMode="center",t.lineWidth=this.stroke.thickness}innerDraw(t){this._fontHolder?.arrayBuffer&&this._fontHolder.arrayBuffer.byteLength>1&&this.data.font&&t.registerFont(this._fontHolder.arrayBuffer,this.data.font);let e=this.data.textTransform,i=this.data.text.textValue.toString(),n=2===e?i.toUpperCase():3===e?i.toLowerCase():i,{height:r}=t.drawText(n,{x:0,y:0,width:this.width,height:this.height,fontSize:this.data.fontSize,lineHeight:this.data.lineHeight??1,letterSpacing:this.data.letterSpacing??0,horizontalAlign:this.data.horizontalAlign,verticalAlign:this.data.verticalAlign,font:this.data.font});this._textHeight=r}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateSizeState(t){let e=!1;void 0!==t.width&&(this.width="number"==typeof t.width?t.width:this.width,e=!0),void 0!==t.height&&(this.height="number"==typeof t.height?t.height:this.height,e=!0),e&&this.updateWorldMatrix(!0,!1,!0)}updateFontState(t,e){let{shared:i}=e;void 0!==t.font&&(this._fontHolder=i.getFont(t.font),this._fontHolder&&!this._fontHolder.isLoaded&&this._fontHolder.loadingPromise.then((()=>{this.requestRender()})))}updateState(t,e){super.updateState(t,e),this.updateSizeState(t),this.updateFontState(t,e)}clone(t){let e=new OX(this.uuid,this.data,t);return e.parent=void 0,e}},LX=class extends kX{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this.curves=[],this.extremasBBox={min:[0,0],max:[0,0]},this.updateState(e,i)}computeExtremas(){0===this.curves.length&&this.computeCurves();let t=this.curves.map((t=>EX.extremas(t))),e=[1/0,1/0],i=[-1/0,-1/0];for(let n=0,r=t.length;n<r;n++){let r=t[n];r[0][0]<e[0]&&(e[0]=r[0][0]),r[0][1]<e[1]&&(e[1]=r[0][1]),r[1][0]>i[0]&&(i[0]=r[1][0]),r[1][1]>i[1]&&(i[1]=r[1][1])}return this.extremasBBox.min=[e[0],e[1]],this.extremasBBox.max=[i[0],i[1]],this.extremasBBox}computeCurves(){this.curves=[];for(let i=1,n=this.data.points.length;i<n;i++){let t=this.data.points[i].data,e=this.data.points[i-1].data,n={start:e.position,cp1:e.controlNext.position,cp2:t.controlPrevious.position,end:t.position};this.curves.push(n)}let t=this.data.points[0].data,e=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let i={start:e.position,cp1:e.controlNext.position,cp2:t.controlPrevious.position,end:t.position};this.curves.push(i)}}getCenter(){let[t,e]=this.extremasBBox.min,[i,n]=this.getHalfSize();return[t+i,e+n]}getHalfSize(){let{min:t,max:e}=this.extremasBBox;return[.5*(e[0]-t[0]),.5*(e[1]-t[1])]}innerDraw(t){for(let n=0,r=this.data.points.length;n<r;n++){let e=this.data.points[n].data;if(0===n){let[i,n]=e.position;t.moveTo(i,n)}else{let i=this.data.points[n-1].data,[r,s]=i.controlNext.position,[a,o]=e.controlPrevious.position,[l,h]=e.position,c={start:i.position,cp1:i.controlNext.position,cp2:e.controlPrevious.position,end:e.position};EX.derive(c),t.bezierCurveTo(r,s,a,o,l,h)}}let e=this.data.points[0].data,i=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let[n,r]=i.controlNext.position,[s,a]=e.controlPrevious.position,[o,l]=e.position;t.bezierCurveTo(n,r,s,a,o,l)}}updateState(t,e){super.updateState(t,e),this.computeExtremas()}clone(t){let e=new LX(this.uuid,this.data,t);return e.parent=void 0,e}};(t=>{function e(t,e,i){let n=t-2*e+i;if(0!==n){let r=-Math.sqrt(Math.abs(e*e-t*i)),s=-t+e;return[-(r+s)/n,-(-r+s)/n]}return e!==i&&0===n?[(2*e-i)/(2*(e-i))]:[]}t.derive=function(t){let e=t.start,i=t.cp1,n=t.cp2,r=t.end,s={start:[3*(i[0]-e[0]),3*(i[1]-e[1])],cp:[3*(n[0]-i[0]),3*(n[1]-i[1])],end:[3*(r[0]-n[0]),3*(r[1]-n[1])]};return t.derivative=s,s.derivative=_X.derive(s),s},t.droot=function(i){let n=i.derivative??t.derive(i),r=n.start,s=n.cp,a=n.end;return[e(r[0],s[0],a[0]),e(r[1],s[1],a[1])]},t.extremas=function(e){let[i,n]=t.droot(e),r=[e.start[0],e.end[0]],s=[e.start[1],e.end[1]];for(let a of i)r.push(t.compute(e,Math.min(1,Math.max(0,a)))[0]);for(let a of n)s.push(t.compute(e,Math.min(1,Math.max(0,a)))[1]);return r.sort(((t,e)=>t-e)),s.sort(((t,e)=>t-e)),[[r[0],s[0]],[r[r.length-1],s[s.length-1]]]},t.compute=function(t,e){if(0===e)return[...t.start];if(1===e)return[...t.end];let i=1-e,n=i*i,r=e*e,s=n*i,a=n*e*3,o=i*r*3,l=e*r;return[s*t.start[0]+a*t.cp1[0]+o*t.cp2[0]+l*t.end[0],s*t.start[1]+a*t.cp1[1]+o*t.cp2[1]+l*t.end[1]]}})(EX||(EX={})),(t=>{t.derive=function(t){let e=t.start,i=t.cp,n=t.end,r={start:[2*(i[0]-e[0]),2*(i[1]-e[1])],end:[2*(n[0]-i[0]),2*(n[1]-i[1])]};return r.derivative=CX.derive(r),t.derivative=r,r},t.droot=function(e){let i=e.derivative??t.derive(e),n=i.start,r=i.end;return[n[0]!==r[0]?n[0]/(n[0]-r[0]):0,n[1]!==r[1]?n[1]/(n[1]-r[1]):0]},t.compute=function(t,e){if(0===e)return[...t.start];if(1===e)return[...t.end];let i=1-e,n=i*i,r=i*e*2,s=e*e;return[n*t.start[0]+r*t.cp[0]+s*t.end[0],n*t.start[1]+r*t.cp[1]+s*t.end[1]]}})(_X||(_X={})),(t=>{t.derive=function(t){let e=t.start,i=t.end,n=[i[0]-e[0],i[1]-e[1]];return t.derivative=n,t.derivative},t.compute=function(t,e){if(0===e)return[...t.start];if(1===e)return[...t.end];let i=t.start,n=t.end;return[i[0]+(n[0]-i[0])*e,i[1]+(n[1]-i[1])*e]}})(CX||(CX={}));var BX=class extends aX{constructor(t,e,i){super(t,e,i),this.uuid=t,this.width=0,this.height=0,this.clipped=!0,this.background=new RX(t+"-background",VO.defaultData,i),this.background.parent=this,this.updateState(e,i)}get fill(){return this.background.fill}get stroke(){return this.background.stroke}get backgroundBlur(){return this.background.backgroundBlur}get layerBlur(){return this.background.layerBlur}get dropShadow(){return this.background.dropShadow}get innerShadow(){return this.background.innerShadow}get cornerRadius(){return this.background.cornerRadius}set cornerRadius(t){this.background.cornerRadius=t}updateLocalMatrix(){super.updateLocalMatrix(),this.background?.updateLocalMatrix()}updateWorldMatrix(t,e,i){super.updateWorldMatrix(t,e,i),this.background?.updateWorldMatrix(t,e,i)}draw(t){if(!this.visible)return;t.save();let e=this.width,i=this.height;this.applyTransforms(t),this.background.width=e,this.background.height=i,this.background.draw(t),this.clipped&&t.clipRect(0,0,e,i,...this.cornerRadius),this.innerDrawChildren(t),t.restore()}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateCornerState(t){void 0!==t.cornerRadius&&(this.cornerRadius=t.cornerRadius)}updateSizeState(t){let e=!1;void 0!==t.width&&(this.width="number"==typeof t.width?t.width:this.width,e=!0),void 0!==t.height&&(this.height="number"==typeof t.height?t.height:this.height,e=!0),e&&this.updateWorldMatrix(!0,!1,!0)}updateState(t,e){super.updateState(t,e),this.updateSizeState(t),this.updateCornerState(t),void 0!==t.fill&&this.fill.update(t.fill),void 0!==t.stroke&&this.stroke.update(t.stroke),void 0!==t.dropShadow&&this.dropShadow.update(t.dropShadow),void 0!==t.innerShadow&&this.innerShadow.update(t.innerShadow),void 0!==t.layerBlur&&this.layerBlur.update(t.layerBlur),void 0!==t.backgroundBlur&&this.backgroundBlur.update(t.backgroundBlur),void 0!==t.clipped&&(this.clipped=t.clipped)}requestRender(){super.requestRender(),this.dispatchEvent({type:"render"})}dispose(){this.removeEventListener("render")}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),0===t.type&&(ED(t.path,["fill"])?this.fill.update(t.props):ED(t.path,["stroke"])?this.stroke.update(t.props):ED(t.path,["dropShadow"])?this.dropShadow.update(t.props):ED(t.path,["innerShadow"])?this.innerShadow.update(t.props):ED(t.path,["layerBlur"])?this.layerBlur.update(t.props):ED(t.path,["backgroundBlur"])?this.backgroundBlur.update(t.props):this.resetBBoxNeedsUpdate())}clone(t){let e=new BX(this.uuid,this.data,t);e.parent=void 0;for(let i of this.children)e.add(i.clone(t));return e}},zX=np(cp(),1),FX=class extends kX{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this._pathBBox=new DOMRect,this.path="",this.updateState(e,i),this.autoClose=!1,this.computeSVGBBox()}computeSVGBBox(){let t=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","path");document.body.appendChild(t),e.setAttribute("d",this.path),t.appendChild(e),this._pathBBox=e.getBBox(),t.remove()}innerDraw(t){t.path(this.path)}intersectsInLocalSpace(t,e){return t>=this._pathBBox.x&&t<=this._pathBBox.x+this._pathBBox.width&&e>=this._pathBBox.y&&e<=this._pathBBox.y+this._pathBBox.height}getCenter(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}getHalfSize(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}updateState(t,e){super.updateState(t,e),void 0!==t.path&&(this.path=t.path,this.computeSVGBBox())}clone(t){let e=new FX(this.uuid,this.data,t);return e.parent=void 0,e}};var NX=class{constructor(t,e,i){this.uuid=t,this.data=e,this.group=new oX(NX.GROUP_ID,{...WO.defaultData},i),this.createChildrenObjects(e.objects,this.group,i)}createObject(t,e,i,n,r,s){let a=function(t,e,i){switch(e.type){case"ellipse2d":return new IX(t,e,i);case"rectangle2d":return new RX(t,e,i);case"text2d":return new OX(t,e,i);case"vector2d":return new LX(t,e,i);case"path2d":return new FX(t,e,i);case"frame2d":return new BX(t,e,i);default:return new oX(t,e,i)}}(t,e,s);a&&(n.add(a),n.children.splice(r,0,n.children.pop()),a.updateWorldMatrix(),i.length>0&&(a instanceof oX||a instanceof BX)&&this.createChildrenObjects(i,a,s))}createChildrenObjects(t,e,i){let n=0;for(let r of t)this.createObject(r.id,r.data,r.children,e,n,i),n+=1}draw(t){this.group.draw(t)}updateEntityByOp(t,e,i,n){let r=this.find(t);if(r)try{r.updateByOp(e,i,{shared:n})}catch(gI){console.error(gI)}}updateTreeByOp(t,e){if(0===t.path.length&&7===t.type){let i=null===t.parent?this.group:this.find(t.parent);void 0!==i&&i instanceof aX&&(this.createObject(t.id,t.data,t.children,i,t.localIndex,e),i.requestRender())}else if(0===t.path.length&&8===t.type){let e=this.find(t.id);if(void 0!==e&&void 0!==e.parent&&e.parent instanceof aX){let t=e.parent;e.resetBBoxNeedsUpdate(),t?.remove(e),t?.requestRender()}}else if(0===t.path.length&&9===t.type){let e=this.find(t.id);if(void 0!==e){let i=e.parent,n=null===t.parent?this:this.find(t.parent);if(n instanceof aX||n===this){n.add(e);let r=t.localIndex;n.children.splice(r,0,n.children.pop()),e.updateWorldMatrix(!0,!1,!0),i?.requestRender(),e.requestRender()}e.resetBBoxNeedsUpdate()}}}add(t){this.group.add(t)}remove(t){this.group.remove(t)}traverse(t){this.group.traverse((e=>{e!==this.group&&t(e)}))}intersectsChildren(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return this.group.intersectsChildren(t,e,i,n,r,!0)}intersectsChildrenReverse(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return this.group.intersectsChildrenReverse(t,e,i,n,r,!0)}find(t){return this.group.find(t)}get children(){return this.group.children}project(t,e){return this.group.project(t,e)}getWithSortKey(t){let e=this.find(t);if(void 0===e)return;let i=[],n=e;for(;n!==this.group;){let t=n;n=n.parent;let e=n.children.indexOf(t);i.splice(0,0,e)}return{entity:e,sortKey:i}}getAllSorted(t){let e=[];for(let i of t){let t=this.getWithSortKey(i.id);void 0!==t&&e.push(t)}return e.sort(((t,e)=>fT(t.sortKey,e.sortKey))),e.map((t=>t.entity))}},UX=NX;function VX(t){let{constraints:e,newParentWidth:i,newParentHeight:n,initialParentWidth:r,initialParentHeight:s,objectInitialWidth:a,objectInitialHeight:o,objectInitialPosition:l}=t,{horizontalConstraint:h,verticalConstraint:c}=e,u=i-r,d=n-s,p=a,f=o,m=l[0],g=l[1];if(0!==h)if(1===h)m+=u;else if(3===h)m+=u/2;else if(2===h)p=Math.max(1,p+u);else if(4===h){let t=i/r;p*=t,m*=t}if(0!==c)if(1===c)g+=d;else if(3===c)g+=d/2;else if(2===c)f=Math.max(1,f+d);else if(4===c){let t=n/s;f*=t,g*=t}return{width:p,height:f,position:[m,g]}}UX.GROUP_ID="scene2d";np(cp(),1);var jX=new Fv(-1,1,1,-1,0,1),GX=new class extends Hg{constructor(){super(),this.setAttribute("position",new Bg([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Bg([0,2,0,0,2,0],2))}},HX=new uv({defines:{},uniforms:{tDiffuse:new qS(null)},vertexShader:"\n\tvarying vec2 vUv;\n\tvoid main() {\n\t\tvUv = uv;\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t}",fragmentShader:"\n\tuniform sampler2D tDiffuse;\n\tvarying vec2 vUv;\n\tvoid main() {\n\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\tgl_FragColor = texel;\n\t}"}),WX=new class{constructor(t){this._mesh=new rv(GX,t)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,jX)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}}(HX),qX=null,YX=null,XX=QY.identity(),QX=class{constructor(t,e,i,n){this.uuid=t,this.width=e,this.height=i,this.context=n,this.enabled=!0,this.isScreenSpace=!1,this.dpr=window.devicePixelRatio,this.isFrameDirty=!1,this.onRenderRequestedDownstream=()=>{this.isFrameDirty=!0,this.context.shared.requestRender()},this._innerApplySize=()=>{let t=this.width,e=this.height,i=this.dpr;this.renderer.dpr=this.isScreenSpace?i:Math.floor(2048/Math.max(t,e)),this.renderer.setSize(t,e)},this.onFrameOverrideObjectEvent=t=>{if(void 0!==t.target?.uuid){let e=this.frameRoot?.find(t.target.uuid);e&&e.dispatchEvent({...t,target:e})}},this.scene2d=new UX(Nf.generateUUID(),XO.defaultData,{dpr:window.devicePixelRatio,shared:n.shared}),this.canvas=(null===qX&&(qX=document.createElement("canvas")),qX),this.renderer=(t=>(null===YX&&(YX=new wX(t)),YX))(this.canvas),this.promise=this.init(),this.renderTarget=new um(1,1,{type:Qp,stencilBuffer:!1,depthBuffer:!1}),n.shared.addUIBuffer(this.uuid,this.renderTarget),this.textureHolder=n.shared.uiBuffer(this.uuid)}get canvasTexture(){return this._canvasTexture||(this._canvasTexture=new Ix(this.canvas)),this._canvasTexture}async init(){this.renderer instanceof wX&&(this.renderer.wasmURL=lj.skiaWasmUrl),await this.renderer.init()}render(t){if(this.isFrameDirty){this.isFrameDirty=!1,this._innerApplySize(),this.renderer.clear(),this.frameOverride?.draw(this.renderer),this.renderer.render(),HX.uniforms.tDiffuse.value=this.canvasTexture,this.canvasTexture.needsUpdate=!0;let e=t.getRenderTarget();t.setRenderTarget(this.renderTarget),t.clear(),WX.render(t),t.setRenderTarget(e),this.textureHolder?.setNeedsUpdate(!0)}}updateEntity2DByOp(t,e,i,n){this.scene2d.updateEntityByOp(t,e,i,n),this.applySize()}updateTreeByOp(t,e){this.scene2d.updateTreeByOp(t,e),this.applySize()}applyOverrides(t){if(this.frameOverride&&this.frameRoot){this.frameOverride.position=[0,0],this.frameOverride.rotation=0;let e=t?.width??this.width,i=t?.height??this.height;this.frameOverride.width=e,this.frameOverride.height=i,this.frameOverride.localMatrix=XX,this.isScreenSpace&&(this.frameOverride.fill.color=II.from0to1([0,0,0,0])),this.frameOverride.data={...this.frameOverride.data,width:e,height:i},KX({objectOverride:this.frameOverride,objectRoot:this.frameRoot,newParentWidth:this.frameOverride.width,newParentHeight:this.frameOverride.height,initialParentWidth:this.frameRoot.width,initialParentHeight:this.frameRoot.height}),this.frameOverride.updateWorldMatrix(!0,!1,!0)}}applySize(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.devicePixelRatio,i=Math.max(1,t?.width??this.width),n=Math.max(1,t?.height??this.height);this.dpr=e,this.width=i,this.height=n,this._innerApplySize();let r=1;(i*e<512||n*e<512)&&(r=Math.max(512/(i*e),512/(n*e))),this.renderTarget.setSize(i*e*r,n*e*r),this._canvasTexture?.dispose(),this._canvasTexture=void 0,this.applyOverrides(t),this.frameOverride?.requestRender()}applyFrame(t){let e=this.context.scene.find2D(t);if(e&&e instanceof BX)return this.disposeFrameOverride(),this.frameRoot=e,this.frameOverride=e.clone({dpr:this.renderer.dpr,shared:this.context.shared}),this.scene2d.add(this.frameOverride),this.applySize(),this.frame?.addEventListener("render",this.onRenderRequestedDownstream),this.frameOverride.traverse((t=>{t.addEventListener("beginState",this.onFrameOverrideObjectEvent)})),this.frameOverride.traverse((t=>{t.addEventListener("completeState",this.onFrameOverrideObjectEvent)})),this.frame?.requestRender(),e}get frame(){return this.frameOverride}get frameId(){return this.frame?.uuid}find(t){return this.scene2d.find(t)}get texture(){return this.textureHolder?.getTexture(1001)}disposeFrameOverride(){this.frameOverride?.removeEventListener("render",this.onRenderRequestedDownstream),this.frameOverride?.traverse((t=>{t.removeEventListener("beginStateChange",this.onFrameOverrideObjectEvent)})),this.frameOverride?.traverse((t=>{t.removeEventListener("completeState",this.onFrameOverrideObjectEvent)})),this.frameOverride&&this.scene2d.remove(this.frameOverride)}};function KX(t){let{objectOverride:e,objectRoot:i,newParentWidth:n,newParentHeight:r,initialParentWidth:s,initialParentHeight:a}=t;if(e instanceof BX&&i instanceof BX||e instanceof oX&&i instanceof oX)for(let o=0,l=e.children.length;o<l;o++){let t=e.children[o],l=i.children[o];t&&l&&t.uuid===l.uuid&&ZX({objectOverride:t,objectRoot:l,newParentWidth:n,newParentHeight:r,initialParentWidth:s,initialParentHeight:a})}}function ZX(t){let{objectOverride:e,objectRoot:i,newParentWidth:n,newParentHeight:r,initialParentWidth:s,initialParentHeight:a}=t,[o,l]=function(t){if($X(t))return[t.width,t.height];if(t instanceof FX){let[e,i]=t.getHalfSize();return[2*e,2*i]}if(t instanceof oX){let[e,i]=t.recursiveBBox.getHalfSize();return[2*e,2*i]}return[0,0]}(i),{width:h,height:c,position:u}=VX({constraints:e.data,newParentWidth:n,newParentHeight:r,initialParentWidth:s,initialParentHeight:a,objectInitialWidth:o,objectInitialHeight:l,objectInitialPosition:i.position});if(e.position=u,e.data={...e.data,position:u},e.states)for(let d in e.states)JX({stateId:d,objectOverride:e,objectRoot:i,newParentWidth:n,newParentHeight:r,initialParentWidth:s,initialParentHeight:a});if($X(e)||e instanceof oX)$X(e)&&(e.width=h,e.height=c,e.data={...e.data,width:h,height:c}),KX({objectOverride:e,objectRoot:i,newParentWidth:h,newParentHeight:c,initialParentWidth:o,initialParentHeight:l});else if(e instanceof FX){let t=i,n=0!==o?h/o:1,r=0!==l?c/l:1;e.path=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(e<=0||i<=0)return t;let n=(0,zX.parseSVG)(t).map((t=>{let n={...t};return"x"in n&&(n.x=n.x*e),"y"in n&&(n.y=n.y*i),"x1"in n&&(n.x1=n.x1*e),"x2"in n&&(n.x2=n.x2*e),"y1"in n&&(n.y1=n.y1*i),"y2"in n&&(n.y2=n.y2*i),"rx"in n&&(n.rx=n.rx*e),"ry"in n&&(n.ry=n.ry*i),n}));return function(t){let e,i=["rx","ry","xAxisRotation","largeArc","sweep","x1","y1","x2","y2","x","y"];return t.map((t=>{let n=[];i.forEach((e=>{if(e in t){let i=1*t[e];n.length&&i>=0&&n.push(","),n.push(i)}}));let r=(e===t.code?n[0]<0?"":",":t.code)+n.join("");return e=t.code,r})).join("")}(n)}(t.path,n,r),e.data={...e.data,path:e.path}}}function JX(t){let{stateId:e,objectOverride:i,objectRoot:n,newParentWidth:r,newParentHeight:s,initialParentWidth:a,initialParentHeight:o}=t,l=i.states?.[e],h=n.states?.[e];if(l&&h){let{width:t,height:n,position:c}=VX({constraints:i.data,newParentWidth:r,newParentHeight:s,initialParentWidth:a,initialParentHeight:o,objectInitialWidth:YO.isResizeable(h)?h.width:0,objectInitialHeight:YO.isResizeable(h)?h.height:0,objectInitialPosition:h.position});Object.assign(i.states[e],{position:c}),YO.isResizeable(l)&&Object.assign(i.states[e],{width:t,height:n})}}function $X(t){return t instanceof RX||t instanceof BX||t instanceof IX||t instanceof OX}var tQ=class extends(ez(sx)){constructor(t,e,i){super(),this.data=e,this.bgColor=new LU(1,1,1,1),this.fog=null,this.backupFog=new rx(16777215,.1,2e3),this.fogUseBGColor=!1,this.isActive=!1,this.aoColor=new nm,this.penumbraSizeArrayCache=null,this.super_Entity(t,e),this.personalCamera=new PW(GI,{...UR.defaultData,...e.camera,name:"Personal Camera"}),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new pS(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight),e.uiScene?this.uiScene=new UX((Array.isArray(t)?t[0]:t)+"-ui",e.uiScene,{dpr:window.devicePixelRatio,shared:i.shared}):e.uiFrame&&this.createUICanvas(e.uiFrame,i)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}get frameId(){return this.data.uiFrame}get frame(){return this.uiCanvas?.frame}createUICanvas(t,e){this.uiCanvas=new QX(this.uuid+"-uiscreen",window.innerWidth,window.innerHeight,e),this.uiCanvas.isScreenSpace=!0,this.uiCanvas.promise.then((()=>{this.uiCanvas?.applyFrame(t),this.uiCanvas?.applySize()}))}updateVisible(){}setBackgroundColor(t){this.bgColor=t,!0===this.fogUseBGColor&&(this.backupFog.color=t)}entityChildrenCount(){return this.uiScene?this.uiScene.children.length:super.entityChildrenCount()}updateAmbientLight(t,e){void 0!==t.color&&(this.ambientLight.color=Hj(t.color,e)),void 0!==t.intensity&&(this.ambientLight.intensity=t.intensity),void 0!==t.enabled&&(t.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(t){this.isActive=!0,t.fog=this.fog,this.traverseEntity((t=>{t instanceof RW&&t.recomputeBoolean()})),this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity((t=>{if(t instanceof fH)if(Array.isArray(t.material))for(let e of t.material)e.needsUpdate=!0;else t.material.needsUpdate=!0,t.material.dispose()}))}updateShadow(t){void 0!==t.softShadowQuality&&this.isActive&&function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"medium";if(LY===t)return!1;LY=t;let e=(t=>{switch(t){case"low":return 8;case"medium":default:return 16;case"high":return 32}})(t);Pv.shadowmap_pars_fragment=(t=>`\n\n// PCSS implementation based on:\n// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/\n// NOTE: This number affects how big the shadow blur can\n// possibly get. Bigger number == bigger blur, but less precise results\n\nconst float  gPenumbraFilterSize = 80.0;\nconst int   gPenumbraSamples = ${t};\nconst int gShadowSamples = ${t};\nconst float gShadowSamplesRpc = 1.0f / float(gShadowSamples);\n\n#ifdef USE_SHADOWMAP\n    #if NUM_DIR_LIGHT_SHADOWS > 0\n\n        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n        struct DirectionalLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n        };\n\n        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n    #endif\n\n    #if NUM_SPOT_LIGHT_SHADOWS > 0\n\n        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n        struct SpotLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n        };\n\n        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n    #endif\n\n    #if NUM_POINT_LIGHT_SHADOWS > 0\n\n        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n        struct PointLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n            float shadowCameraNear;\n            float shadowCameraFar;\n        };\n\n        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n    #endif\n\n    /*\n    #if NUM_RECT_AREA_LIGHTS > 0\n\n        // TODO (abelnation): create uniforms for area light shadows\n\n    #endif\n    */\n\nfloat computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)\n{\n    float penumbra = 1.0;\n    float blockerDepthAvg = 0.0;\n    float blockerCount = 0.0;\n\n    #pragma unroll_loop_start\n    for(int i = 0; i < gPenumbraSamples; i ++)\n    {\n        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;\n        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );\n\n        if(depth < compare + 0.0001)\n        {\n            blockerDepthAvg += depth;\n            blockerCount++;\n        }\n    }\n    #pragma unroll_loop_end\n\n    if (blockerCount > 0.0)\n    {\n        blockerDepthAvg /= blockerCount;\n\n        // Compute penumbra\n        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);\n        penumbra *= penumbra;\n        penumbra *= 200.0 * penumbraSize[min(index, 5 - 1)]; // Magic number that affects how quickly the penumbra grows\n\n        return clamp(penumbra, 0.00, 1.0);\n    }\n    return 0.0;\n}\n\nfloat vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)\n{\n    float shadow         = 0.0f;\n\n    // NOTE: When using TAA, we should use screen space interleaved gradient noise\n    vec2 halton = haltonSequence[frameIndex];\n    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n    float temporalAngle  = temporalOffset * PI2;\n\n    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);\n    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);\n    if (penumbra == -1.0) {\n        return 1.0;\n    }\n\n    #pragma unroll_loop_start\n    for (int i = 0; i < gShadowSamples; i++)\n    {\n        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n        // Overall blurring offset\n        vec2 offset = vogelSample * (shadowRadius * 2.);\n\n        // Penumbra offset\n        offset += vogelSample * (penumbra * texelScalar);\n\n        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );\n    }\n    #pragma unroll_loop_end\n\n    return shadow * gShadowSamplesRpc;\n}\n\n\n    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\n    }\n\n    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\n        return unpackRGBATo2Half( texture2D( shadow, uv ) );\n\n    }\n\n    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\n        float occlusion = 1.0;\n\n        vec2 distribution = texture2DDistribution( shadow, uv );\n\n        float hard_shadow = step( compare , distribution.x ); // Hard Shadow\n\n        if (hard_shadow != 1.0 ) {\n\n            float distance = compare - distribution.x ;\n            float variance = max( 0.00000, distribution.y * distribution.y );\n            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\n            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\n            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\n        }\n        return occlusion;\n\n    }\n\n    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n        float shadow = 1.0;\n\n        shadowCoord.xyz /= shadowCoord.w;\n        shadowCoord.z += shadowBias;\n\n        // if ( something && something ) breaks ATI OpenGL shader compiler\n        // if ( all( something, something ) ) using this instead\n\n        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n        bool inFrustum = all( inFrustumVec );\n\n        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n        bool frustumTest = all( frustumTestVec );\n\n        if ( frustumTest ) {\n\n        #if defined( SHADOWMAP_TYPE_PCF )\n\n            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );\n\n        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n            float dx = texelSize.x;\n            float dy = texelSize.y;\n\n            vec2 uv = shadowCoord.xy;\n            vec2 f = fract( uv * shadowMapSize + 0.5 );\n            uv -= f * texelSize;\n\n            shadow = (\n                texture2DCompare( shadowMap, uv, shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n                     f.x ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n                     f.x ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n                     f.y ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n                     f.y ) +\n                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n                          f.x ),\n                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n                          f.x ),\n                     f.y )\n            ) * ( 1.0 / 9.0 );\n\n        #elif defined( SHADOWMAP_TYPE_VSM )\n\n            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n        #else // no percentage-closer filtering:\n\n            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n        #endif\n\n        }\n\n        return shadow;\n\n    }\n\n    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n    // vector suitable for 2D texture mapping. This code uses the following layout for the\n    // 2D texture:\n    //\n    // xzXZ\n    //  y Y\n    //\n    // Y - Positive y direction\n    // y - Negative y direction\n    // X - Positive x direction\n    // x - Negative x direction\n    // Z - Positive z direction\n    // z - Negative z direction\n    //\n    // Source and test bed:\n    // https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n    vec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n        // Number of texels to avoid at the edge of each square\n\n        vec3 absV = abs( v );\n\n        // Intersect unit cube\n\n        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n        absV *= scaleToCube;\n\n        // Apply scale to avoid seams\n\n        // two texels less per square (one texel will do for NEAREST)\n        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n        // Unwrap\n\n        // space: -1 ... 1 range for each square\n        //\n        // #X##         dim    := ( 4 , 2 )\n        //  # #         center := ( 1 , 1 )\n\n        vec2 planar = v.xy;\n\n        float almostATexel = 1.5 * texelSizeY;\n        float almostOne = 1.0 - almostATexel;\n\n        if ( absV.z >= almostOne ) {\n\n            if ( v.z > 0.0 )\n                planar.x = 4.0 - v.x;\n\n        } else if ( absV.x >= almostOne ) {\n\n            float signX = sign( v.x );\n            planar.x = v.z * signX + 2.0 * signX;\n\n        } else if ( absV.y >= almostOne ) {\n\n            float signY = sign( v.y );\n            planar.x = v.x + 2.0 * signY + 2.0;\n            planar.y = v.z * signY - 2.0;\n\n        }\n\n        // Transform to UV space\n\n        // scale := 0.5 / dim\n        // translate := ( center + 0.5 ) / dim\n        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n    }\n\n    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\n        float shadow = 1.0;\n        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\n        // for point lights, the uniform @vShadowCoord is re-purposed to hold\n        // the vector from the light to the world-space position of the fragment.\n        vec3 lightToPosition = shadowCoord.xyz;\n\n        // dp = normalized distance from light to fragment position\n        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\n        compare += shadowBias;\n\n        // bd3D = base direction 3D\n        vec3 bd3D = normalize( lightToPosition );\n\n        vec2 halton = haltonSequence[frameIndex];\n        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n        float temporalAngle  = temporalOffset * PI2;\n\n        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )\n            for (int i = 0; i < gShadowSamples; i++) {\n                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n\n                // Overall blurring offset\n                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);\n\n                // NOTE: Removed for now\n                // Penumbra offset\n                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);\n\n                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );\n\n            }\n            return shadow * gShadowSamplesRpc;\n\n        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n            for (int i = 0; i < 16; i++) {\n                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n\n                // Overall blurring offset\n                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);\n\n                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );\n\n            }\n            return shadow * (1.0 / 16.0);\n        #else // no percentage-closer filtering\n\n            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );\n\n        #endif\n\n    }\n\n#endif\n`)(e);let i=RY.slice();i=i.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + 3, spotShadowMap[ i ]"),i=i.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),Pv.lights_fragment_begin=i;let n=OY.slice();return n=n.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),Pv.shadowmask_pars_fragment=n,!0}(t.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(t,e){if(t.enabled?this.fog=this.backupFog:this.fog=null,this.isActive){this.scene.fog=this.fog}this.fogUseBGColor=t.useBackgroundColor,t.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=Hj(t.color,e),this.backupFog.near=t.near,this.backupFog.far=t.far}updateAo(t,e){void 0!==t.aoColor&&(this.aoColor=Hj(t.aoColor,e))}updateByOp(t,e,i,n){let r=this.data.uiFrame;super.updateByOp(t,e,i,n);let s=e;ED(t.path,["fog"])?this.updateFog(s.fog,i.shared):ED(t.path,["ao"])?this.updateAo(s.ao,i.shared):ED(t.path,["ambient"])?this.updateAmbientLight(s.ambient,i.shared):ED(t.path,["shadow"])?this.updateShadow(s.shadow):0===t.type&&0===t.path.length&&(void 0!==t.props.uiFrame||r!==s.uiFrame)&&this.updateUIFrame(t.props.uiFrame,i)}updateUIFrame(t,e){t?(this.uiCanvas||this.createUICanvas(t,e),this.uiCanvas.enabled=!0,this.uiCanvas.applyFrame(t)):this.uiCanvas&&(this.uiCanvas.enabled=!1)}updateState(t,e){this.updateState_Entity(t,e),void 0!==t.backgroundColor&&this.setBackgroundColor(Hj(t.backgroundColor,e.shared)),void 0!==t.fog&&this.updateFog(t.fog,e.shared),void 0!==t.ambient&&this.updateAmbientLight(t.ambient,e.shared),void 0!==t.ao&&this.updateAo(t.ao,e.shared),void 0!==t.shadow&&this.updateShadow(t.shadow)}createFrame(t,e){}raycast(t,e){super.raycast(t,e)}switchActiveCamera(t){t&&t.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=t,t.objectHelper.visible=!1)}get playCamera(){return this.scene?.find(this.data.publish.playCamera)??this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return null===this.penumbraSizeArrayCache&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=new Array(5).fill(.5);let t=0,e=0;this.traverseEntity((i=>{if(!i.visible)return!0;i instanceof KY&&i.visible&&t<3&&(this.penumbraSizeArrayCache[t]=i.data.penumbraSize??.5,t+=1),i instanceof tX&&i.visible&&t<2&&(this.penumbraSizeArrayCache[3+e]=i.data.penumbraSize??.5,e+=1)}))}raycastWithClones(t){let e=[],i=n=>{for(let r of n.children){let n=r.cloner;IB.is(r)&&(r.visible||n?.object.data.visible)&&((LW(r)||zW(r)&&this.scene.enableHelpers&&r.objectHelper.visible)&&(t.intersectObject(r,!1,e),YQ(r,t,e,!0)),i(r))}};return i(this),e}updateEntity2DByOp(t,e,i,n){this.uiCanvas?.updateEntity2DByOp(t,e,i,n)}},eQ=class extends(OW(ES,VY)){constructor(t,e,i){super(),this.super_Entity(t,e),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let n=this.shadow.camera;n.fov=90,n.aspect=1,n.near=100,n.far=2500;let r=new mm(-n.far+this.position.x,-n.far+this.position.y,-n.far+this.position.z),s=new mm(n.far+this.position.x,n.far+this.position.y,n.far+this.position.z),a=new ym(r,s),o=new pA(a,new nm(16755200));o.visible=!1,this.gizmos.shadowmap=o,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let t in this.gizmos){let e=this.gizmos[t];if(e instanceof pA){let t=this.shadow.camera,i=new mm(-t.far+this.position.x,-t.far+this.position.y,-t.far+this.position.z),n=new mm(t.far+this.position.x,t.far+this.position.y,t.far+this.position.z);e.box.set(i,n),e.updateMatrixWorld(!0)}}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.objectHelper&&this.objectHelper.update()}updateState(t,e){this.updateState_Light(t,e),void 0!==t.distance&&(this.distance=t.distance),void 0!==t.decay&&(this.decay=t.decay),void 0!==t.shadowRadius&&(this.shadow.radius=t.shadowRadius),void 0!==t.shadowResolution&&(this.shadow.mapSize.set(t.shadowResolution,t.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},iQ=class extends xH{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(t,e){let i=this.geometry.getAttribute("position");void 0!==i?AU(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,t,e):super.updateEntityBoxSize(t,e)}},nQ=class extends xH{constructor(t,e,i){super(t,e,i),this._shapeId=null,this._context=i}updateState(t,e){super.updateState(t,e),this.updateShape(),this.refreshAttachedCloners(e)}updateShape(){let t,e={...this.data.geometry.extrusion.shape};for(let n in e)"string"==typeof e[n]&&(e[n]=this._context.shared.getVariable(e[n],[this.uuid,"geometry","extrusion","shape",n]));if("Custom"===e.type){let i=e.shapeId;if(i!==this._shapeId&&this.detachShape(),i){this._shapeId=i;let e=this._context.scene.find(i);e?.data&&(e.attachedPaths.add(this),t=e.geometry.userData?.shape),t||this._context.scene.addPendingCommand((()=>this.updateShape()))}}else{let i;switch(e.type){case"Rectangle":i=hN;break;case"Ellipse":i=PF;break;case"Polygon":i=rN;break;case"Star":i=uN;break;default:throw new Error(`Unknown shape type: ${e.type}`)}t=i.create({parameters:e}).userData.shape}let i=this.geometry;t&&i.inputs&&(i.inputs.shapeData=t,i.build())}detachShape(){null!==this._shapeId&&this._context.scene.find(this._shapeId)?.attachedPaths.delete(this)}createGeometryDelayed(t){this.geometryCreateDeleyed=t.shared,this.updateShape(),this.refreshAttachedPaths(t)}updateTransformState(t,e){return super.updateTransformState(t,e)}updateGeometryInteractions(t,e){super.updateGeometryInteractions(t,e),this.updateShape()}updateEntityBoxSize(t,e){let i=this.geometry.getAttribute("position");void 0!==i?AU(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,t,e):super.updateEntityBoxSize(t,e)}},rQ=class extends KH{constructor(t,e,i){super(t,e,i),this.data=e}},sQ=class extends(wW(Kb,jW)){constructor(t,e,i){super(),"Instance"===e.type&&"string"==typeof t&&(e=this.transformAssignData(e,i)),this.super_Entity(t,e),this.objectHelper.update()}get isComponentRoot(){return"Component"===this.data.type&&"string"==typeof this.identity}get isInstanceRoot(){return"Instance"===this.data.type&&"string"==typeof this.identity}transformAssignData(t,e){let i=TO.getComponentData({scene:e.scene.data,shared:e.shared.data},t.component);if(i){let e,n;for(let r of GR.rootOverrideProps)void 0===t[r]?(void 0===e&&(e={...t}),e[r]=i.data[r]):(void 0===n&&(n={}),n[r]=t[r],void 0===e&&(e={...t}),e[r]=qT.apply(i.data[r],t[r]));return this.overrideData=n,e}return{...OR.defaultData,...t,...iT(OR.defaultData,GR.rootOverrideProps)}}updateByOp(t,e,i,n){let r;if(this.isInstanceRoot&&!n)if(e=this.transformAssignData(e,i),0===t.type&&0===t.path.length&&this.component)for(let s of GR.rootOverrideProps)s in t.props&&void 0===t.props[s]&&(void 0===r&&(r={...t,props:{...t.props}}),r.props[s]=this.component.data[s]);else if(0===t.type&&t.path.length>0&&GR.rootOverrideProps.includes(t.path[0])){let i=t.path[0];void 0===r&&(r={...t,path:[],props:{[i]:e[i]}})}super.updateByOp(r??t,e,i,n)}updateState(t,e){this.updateState_Entity(t,e)}expandInstanceChildren(t){let e=this.data;if(void 0===this.component){let i=t.scene.find(e.component)??null,n=!1;if(i!==this.oldComponent){if(this.oldComponent){let e=0;for(let i of this.children){if(!IB.is(i))break;t.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(i),aQ(i),e+=1}this.children.splice(0,e)}n=!0}if(i){let r={};lQ(t,[this.uuid],e.overrides,this,i,i,0,n,r);for(let e of this.children)if(IB.is(e)){let i=e.data;"Empty"===i.type&&i.animations&&e.traverseEntity((e=>{let i=e.dataPatched;if(e instanceof xH&&i.bones&&i.boneInverses){let i=e.dataPatched;if(i.bones&&i.boneInverses){let n=i.bones.map((e=>t.scene.find(r[e]))),s=i.boneInverses.map((t=>(new Wm).fromArray(t))),a=new px(n,s);e.bind(a,e.bindMatrix)}}else e.matrixAutoUpdate=!0}))}}this.oldComponent=this.component}}};function aQ(t){if(t.component){let e=t.component.instances.indexOf(t);e>=0&&t.component.instances.splice(e,1);for(let i of t.children)IB.is(i)&&aQ(i)}}function oQ(t,e,i,n){return t.component===e&&WP(t.identity,n)?t.overrideData===i?2:1:0}function lQ(t,e,i,n,r,s,a,o,l){if(a>50)return!1;if(n.component!==r){if(n.component){let t=n.component.instances.indexOf(n);t>=0&&n.component.instances.splice(t,1)}r.instances.find((t=>t===n))||r.instances.push(n),n.component=r}r instanceof sQ&&r.isInstanceRoot&&r.expandInstanceChildren(t);let h=0;for(let c of r.children)if(IB.is(c)){let r=[...e,..."string"==typeof c.identity?[c.identity]:c.identity],u=jR.resolve(i,r,1);null==u||u instanceof ZT||(Object.setPrototypeOf(u,ZT.prototype),console.error("wrong prototype"));let d,p=null;if(!o){let e=n.children[h];if(p=IB.is(e)?e:null,null!==p){let t=oQ(p,c,u,r);d=t>=1?p.stateSelection:void 0,2!==t&&(p=null)}if(null===p&&(p=t.scene.findInstance(r)??null,null!==p)){let e=oQ(p,c,u,r);if(d=e>=1?p.stateSelection:void 0,2!==e)p=null;else{let e=p.parent.children.indexOf(p);p.parent.children.splice(e,1),n.children.splice(h,0,p),p.parent===n?e<=h&&console.error("not possible"):(p.parent=n,p.matrixWorldNeedsUpdate=!0,p.resetBBoxNeedsUpdate(),p.updateVisible(),t.pendingDeletes.delete(p))}}}if(null===p){let e=u?qT.apply(c.data,u):c.data;NI.is(e.type)&&(e={...e,type:"Empty"}),p=HB.createEntity(r,e,t),p.overrideData=u,n.add(p),n.children.splice(n.children.length-1,1),n.children.splice(h,0,p),p.updateState(p.data,t),d&&p.changeSelectedState(d,t),t.scene.registerInstanceAndSetUuid(p)}if(p.isBone){l[p.identity[p.identity.length-1]]=p.uuid}h+=1,lQ(t,e,i,p,c,s,a+1,o,l)}if(!o){let e=h;for(;;){let e=n.children[h];if(!IB.is(e))break;t.pendingDeletes.add(e),h+=1}n.children.splice(e,h-e)}return!0}var hQ=class extends(wW(hx,jW)){constructor(t,e){super(),this.super_Entity(t,e),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(t,e){this.updateState_Entity(t,e)}},cQ=class extends xH{constructor(t,e,i){super(t,e,i),this.onBeforeRender=t=>{this.uiCanvas.render(t)},this.uiCanvas=new QX(t+"-canvas",e.geometry.width,e.geometry.height,i),this.uiCanvas.promise.then((()=>{this.applyFrame(this.dataPatched.geometry.frame,i.shared)}))}updateByPatchedOpGeometry(t,e,i){super.updateByPatchedOpGeometry(t,e,i),0===t.type&&(void 0!==t.props.frame&&this.applyFrame(t.props.frame,i.shared),(void 0!==t.props.width||void 0!==t.props.height)&&this.applySize(t.props,i.shared))}applySize(t,e){let i=t?.width??this.dataPatched.geometry.width,n=t?.height??this.dataPatched.geometry.height;this.uiCanvas.applySize({width:i,height:n}),this.applyGeometryParametersFromFrame(e)}applyFrame(t,e){this.uiCanvas.applyFrame(t),this.applyGeometryParametersFromFrame(e),this.applyMaterialParametersFromFrame({shared:e})}applyGeometryParametersFromFrame(t){let e=this.frame;e&&(Object.assign(this.data,{geometry:Object.assign(this.data.geometry,{cornerRadius:e.cornerRadius,cornerType:0})}),Object.assign(this.dataPatched,{geometry:Object.assign(this.dataPatched.geometry,{cornerRadius:e.cornerRadius,cornerType:0})}),this.localGeometry?.dispose(),this.localGeometry=UN(this.dataPatched.geometry,t,this.data.flatShading,this))}applyMaterialParametersFromFrame(t){let e=this.frame;if(e){let i=e.data.backgroundBlur;Object.assign(this.data.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.data.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),Object.assign(this.dataPatched.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.dataPatched.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),this.material.reset(this.dataPatched.material,t,!0)}}updateEntity2DByOp(t,e,i,n){this.uiCanvas.updateEntity2DByOp(t,e,i,n),t===this.frameId&&0===e.type&&(void 0!==e.props.cornerRadius?this.applyGeometryParametersFromFrame(n):ED(e.path,["backgroundBlur"])&&this.applyMaterialParametersFromFrame({shared:n}))}get frame(){return this.uiCanvas.frame}get frameId(){return this.frame?.uuid}removeInteractionGeometry(t){super.removeInteractionGeometry(t),this.applySize({},t)}updateGeometryInteractions(t,e){super.updateGeometryInteractions(t,e),this.applySize({width:t.width,height:t.height},e)}},uQ=class{constructor(t,e,i){this.variables=[],this.currentTextureIndex=0;let n=Xp,r=new sx,s=new dv;s.position.z=1;let a={passThruTexture:{value:null}},o=c("uniform sampler2D passThruTexture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( passThruTexture, uv );\n\n}\n",a),l=new rv(new Mv(2,2),o);function h(i){i.defines.resolution="vec2( "+t.toFixed(1)+", "+e.toFixed(1)+" )"}function c(t,e){let i=new uv({uniforms:e=e||{},vertexShader:"void main()\t{\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:t});return h(i),i}r.add(l),this.setDataType=function(t){return n=t,this},this.addVariable=function(t,e,i){let n={name:t,initialValueTexture:i,material:this.createShaderMaterial(e),dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:Up,magFilter:Up};return this.variables.push(n),n},this.setVariableDependencies=function(t,e){t.dependencies=e},this.init=function(){if(!1===i.capabilities.isWebGL2&&!1===i.extensions.has("OES_texture_float"))return"No OES_texture_float support for float textures.";if(0===i.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(let i=0;i<this.variables.length;i++){let n=this.variables[i];n.renderTargets[0]=this.createRenderTarget(t,e,n.wrapS,n.wrapT,n.minFilter,n.magFilter),n.renderTargets[1]=this.createRenderTarget(t,e,n.wrapS,n.wrapT,n.minFilter,n.magFilter),this.renderTexture(n.initialValueTexture,n.renderTargets[0]),this.renderTexture(n.initialValueTexture,n.renderTargets[1]);let r=n.material,s=r.uniforms;if(null!==n.dependencies)for(let t=0;t<n.dependencies.length;t++){let e=n.dependencies[t];if(e.name!==n.name){let t=!1;for(let i=0;i<this.variables.length;i++)if(e.name===this.variables[i].name){t=!0;break}if(!t)return"Variable dependency not found. Variable="+n.name+", dependency="+e.name}s[e.name]={value:null},r.fragmentShader="\nuniform sampler2D "+e.name+";\n"+r.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){let t=this.currentTextureIndex,e=0===this.currentTextureIndex?1:0;for(let i=0,n=this.variables.length;i<n;i++){let n=this.variables[i];if(null!==n.dependencies){let e=n.material.uniforms;for(let i=0,r=n.dependencies.length;i<r;i++){let r=n.dependencies[i];e[r.name].value=r.renderTargets[t].texture}}this.doRenderTarget(n.material,n.renderTargets[e])}this.currentTextureIndex=e},this.getCurrentRenderTarget=function(t){return t.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(t){return t.renderTargets[0===this.currentTextureIndex?1:0]},this.dispose=function(){l.geometry.dispose(),l.material.dispose();let t=this.variables;for(let e=0;e<t.length;e++){let i=t[e];i.initialValueTexture&&i.initialValueTexture.dispose();let n=i.renderTargets;for(let t=0;t<n.length;t++)n[t].dispose()}},this.addResolutionDefine=h,this.createShaderMaterial=c,this.createRenderTarget=function(i,r,s,a,o,l){return new um(i=i||t,r=r||e,{wrapS:s=s||Fp,wrapT:a=a||Fp,minFilter:o=o||Up,magFilter:l=l||Up,format:Zp,type:n,depthBuffer:!1})},this.createTexture=function(){let i=new Float32Array(t*e*4),n=new cx(i,t,e,Zp,Xp);return n.needsUpdate=!0,n},this.renderTexture=function(t,e){a.passThruTexture.value=t,this.doRenderTarget(o,e),a.passThruTexture.value=null},this.doRenderTarget=function(t,e){let n=i.getRenderTarget(),a=i.xr.enabled,h=i.shadowMap.autoUpdate,c=i.outputEncoding,u=i.toneMapping;i.xr.enabled=!1,i.shadowMap.autoUpdate=!1,i.outputEncoding=gf,i.toneMapping=0,l.material=t,i.setRenderTarget(e),i.render(r,s),l.material=o,i.xr.enabled=a,i.shadowMap.autoUpdate=h,i.outputEncoding=c,i.toneMapping=u,i.setRenderTarget(n)}}},dQ=new Mg,pQ=new mm,fQ=class{constructor(t){let e=t.geometry;if(!e.isBufferGeometry||3!==e.attributes.position.itemSize)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");e.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),e=e.toNonIndexed()),this.geometry=e,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(t){return this.weightAttribute=t?this.geometry.getAttribute(t):null,this}build(){let t=this.positionAttribute,e=this.weightAttribute,i=new Float32Array(t.count/3);for(let r=0;r<t.count;r+=3){let n=1;e&&(n=e.getX(r)+e.getX(r+1)+e.getX(r+2)),dQ.a.fromBufferAttribute(t,r),dQ.b.fromBufferAttribute(t,r+1),dQ.c.fromBufferAttribute(t,r+2),n*=dQ.getArea(),i[r/3]=n}this.distribution=new Float32Array(t.count/3);let n=0;for(let r=0;r<i.length;r++)n+=i[r],this.distribution[r]=n;return this}setRandomGenerator(t){return this.randomFunction=t,this}sample(t,e,i){let n=this.distribution[this.distribution.length-1],r=this.binarySearch(this.randomFunction()*n);return this.sampleFace(r,t,e,i)}binarySearch(t){let e=this.distribution,i=0,n=e.length-1,r=-1;for(;i<=n;){let s=Math.ceil((i+n)/2);if(0===s||e[s-1]<=t&&e[s]>t){r=s;break}t<e[s]?n=s-1:i=s+1}return r}sampleFace(t,e,i,n){let r=this.randomFunction(),s=this.randomFunction();return r+s>1&&(r=1-r,s=1-s),dQ.a.fromBufferAttribute(this.positionAttribute,3*t),dQ.b.fromBufferAttribute(this.positionAttribute,3*t+1),dQ.c.fromBufferAttribute(this.positionAttribute,3*t+2),e.set(0,0,0).addScaledVector(dQ.a,r).addScaledVector(dQ.b,s).addScaledVector(dQ.c,1-(r+s)),void 0!==i&&dQ.getNormal(i),void 0!==n&&void 0!==this.colorAttribute&&(dQ.a.fromBufferAttribute(this.colorAttribute,3*t),dQ.b.fromBufferAttribute(this.colorAttribute,3*t+1),dQ.c.fromBufferAttribute(this.colorAttribute,3*t+2),pQ.set(0,0,0).addScaledVector(dQ.a,r).addScaledVector(dQ.b,s).addScaledVector(dQ.c,1-(r+s)),n.r=pQ.x,n.g=pQ.y,n.b=pQ.z),this}};function mQ(t,e){let i=t,n=new Float32Array(4*e*e);for(let s=0;s<e*e;s++)n[4*s]=i[3*s],n[4*s+1]=i[3*s+1],n[4*s+2]=i[3*s+2],n[4*s+3]=0;let r=new cx(n,e,e,Zp,Xp);return r.needsUpdate=!0,r}var gQ="\n\n  // Linear Fade In\n  float linearFadeIn(float t) {\n    return t;\n  }\n\n\n  // linear fade out\n  float linearFadeOut(float t) {\n    return 1.0 - t;\n  }\n  \n  float linearInOut(float t) {\n    return t < 0.5 ? t :  (1.0 - t);  \n  }\n\n    // lerp\n    float lerp(float a, float b, float t) {\n      return a + (b - a) * t;\n    }\n\n  // Ease In Out Quart\n  float exponentialInOut(float t) {\n    return t < 0.4 ? lerp(0.0, 1.0, t / 0.4) :\n    t > 0.6 ? lerp(1.0, 0.0, (t - 0.6) / 0.4) :\n    1.0;\n   }\n\n  // constant\n  float constant(float t) {\n    return 1.0;\n  } \n",vQ=`\n  uniform sampler2D uPosition;\n  uniform float uSize;\n  uniform float uSizeEnd;\n  uniform vec3 uWorldOffset;\n  uniform vec4 uWorldQuaternion;\n  // Billboard Behavior - Currently at Zero, but we can change that\n  uniform float uRotation;\n  uniform float uRotationEnd;\n  uniform vec2 center;\n\n  // Randomness\n  uniform float uRandScaleFactor;\n  uniform float uRandRotationFactor;\n\n  attribute vec2 ref;\n\n  varying float v_LifeLeft;    // normalized lifetime 1 to 0\n  varying vec2 vUv;\n  varying vec2 vRef;\n\n  \n\nfloat rand(vec3 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 applyQuaternionToVector( vec4 q, vec3 v ){\n  return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n}\n\nvec3 applyForce(vec3 force, float mass) {\n  vec3 acceleration = force / mass;\n    \n  return acceleration;\n}\n\n  ${gQ}\n`,yQ="\n  uniform vec4 uColor;                // start color\n  uniform vec4 uColor2;               // end color\n  uniform sampler2D uTexture;         // texture\n  varying float v_LifeLeft;   // normalized lifetime 1 to 0\n  varying vec2 vUv;\n  varying vec2 vRef;\n\n  float random(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n  }\n  "+gQ+"  \n  \nvec3 rgb2xyz (in vec3 rgb) {\n    float r = rgb.r;\n\tfloat g = rgb.g;\n\tfloat b = rgb.b;\n\n\tr = r > 0.04045 ? pow(((r + 0.055) / 1.055), 2.4) : (r / 12.92);\n\tg = g > 0.04045 ? pow(((g + 0.055) / 1.055), 2.4) : (g / 12.92);\n\tb = b > 0.04045 ? pow(((b + 0.055) / 1.055), 2.4) : (b / 12.92);\n\n\tfloat x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);\n\tfloat y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);\n\tfloat z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);\n    \n    vec3 xyz = vec3(\n        (r * 0.4124) + (g * 0.3576) + (b * 0.1805) * 100.0,\n        (r * 0.2126) + (g * 0.7152) + (b * 0.0722) * 100.0,\n        (r * 0.0193) + (g * 0.1192) + (b * 0.9505) * 100.0\n    );\n    return(xyz);\n}\n\nvec3 xyz2lab (in vec3 xyz) {\n\tfloat x = xyz.x / 95.047;\n\tfloat y = xyz.y / 100.0;\n\tfloat z = xyz.z / 108.883;\n\n\tx = x > 0.008856 ? pow(x, 1.0 / 3.0) : (7.787 * x) + (16.0 / 116.0);\n\ty = y > 0.008856 ? pow(y, 1.0 / 3.0) : (7.787 * y) + (16.0 / 116.0);\n\tz = z > 0.008856 ? pow(z, 1.0 / 3.0) : (7.787 * z) + (16.0 / 116.0);\n\n    vec3 lab = vec3((116.0 * y) - 16.0, 500.0 * (x - y), 200.0 * (y - z));\n    return(lab);\n}\n\nvec3 rgb2lab(in vec3 rgb) {\n    vec3 xyz = rgb2xyz(rgb);\n    vec3 lab = xyz2lab(xyz);\n    return(lab);\n}\n\nvec3 xyz2rgb (in vec3 xyz) {\n\tfloat x = xyz.x / 100.0;\n\tfloat y = xyz.y / 100.0;\n\tfloat z = xyz.z / 100.0;\n\t\n    \n\tfloat r = (x *  3.2406) + (y * -1.5372) + (z * -0.4986);\n\tfloat g = (x * -0.9689) + (y *  1.8758) + (z *  0.0415);\n\tfloat b = (x *  0.0557) + (y * -0.2040) + (z *  1.0570);\n\n\tr = r > 0.0031308 ? ((1.055 * pow(r, 1.0 / 2.4)) - 0.055) : r * 12.92;\n\tg = g > 0.0031308 ? ((1.055 * pow(g, 1.0 / 2.4)) - 0.055) : g * 12.92;\n\tb = b > 0.0031308 ? ((1.055 * pow(b, 1.0 / 2.4)) - 0.055) : b * 12.92;\n\n\tr = min(max(0.0, r), 1.0);\n\tg = min(max(0.0, g), 1.0);\n\tb = min(max(0.0, b), 1.0);\n\n\treturn(vec3(r, g, b));\n}\n\nvec3 lab2xyz (in vec3 lab) {\n    float l = lab.x;\n\tfloat a = lab.y;\n\tfloat b = lab.z;\n\n  \tfloat y = (l + 16.0) / 116.0;\n\tfloat x = a / 500.0 + y;\n\tfloat z = y - b / 200.0;\n\n\tfloat y2 = pow(y, 3.0);\n\tfloat x2 = pow(x, 3.0);\n\tfloat z2 = pow(z, 3.0);\n\n  \ty = y2 > 0.008856 ? y2 : (y - 16.0 / 116.0) / 7.787;\n\tx = x2 > 0.008856 ? x2 : (x - 16.0 / 116.0) / 7.787;\n\tz = z2 > 0.008856 ? z2 : (z - 16.0 / 116.0) / 7.787;\n\n\tx *= 95.047;\n\ty *= 100.0;\n\tz *= 108.883;\n\n\treturn(vec3(x, y, z));\n}\nvec3 lab2rgb (in vec3 lab) {\n    vec3 xyz = lab2xyz(lab);\n    vec3 rgb = xyz2rgb(xyz);\n    return(rgb);\n}\n\n\n\n",bQ=class extends uv{constructor(t,e){super(),this.needsJitter=!0,this.type="ParticleMaterial",this.easeOpacity="linearFadeIn",this.easeSize="linearFadeIn",this.useSizeEnd=!1,this.isColoringRandom=!1,this.init(t,e),this.context=e}reset(){}init(t,e){this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.easeOpacity=t.ease,this.easeSize=t.easeSize,this.layers=[],PU.startContext(PU.globalContext),this.lightLayer=new rG(0,"",{...cR.defaultData("light","phong"),visible:!1},new hj,{},e.shared),PU.endContext(PU.globalContext),this.build()}updateState(t){void 0!==t.coloring&&(this.isColoringRandom="random"===t.coloring),void 0!==t.color&&(t.color instanceof Array?this.uniforms.uColor.value=t.color:this.uniforms.uColor.value=this.context.shared.color(t.color)),void 0!==t.color2&&(t.color2 instanceof Array?this.uniforms.uColor2.value=t.color2:this.uniforms.uColor2.value=this.context.shared.color(t.color2)),void 0!==t.size&&(this.uniforms.uSize.value=t.size[0],this.uniforms.uSizeEnd.value=t.size[1],t.size[0]!==t.size[1]?this.useSizeEnd=!0:this.useSizeEnd=!1),void 0!==t.ease&&(this.easeOpacity=t.ease,this.build()),void 0!==t.easeSize&&(this.easeSize=t.easeSize,this.build()),this.needsUpdate=!0}onBeforeCompile(t){this.build(),t.defines=this.defines,t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader}build(){let t=new vV;return t.needsJitter=this.needsJitter,t.addFragmentParsCode("\nlayout(location = 1) out vec4 gVelocity;\n"),t.buildShader("vertex",this.fragment),t.buildShader("fragment",this.fragment),t.addFragmentFinalCode("\n    // Discard fully transparent pixels \n    if (gl_FragColor.a <= 0.0) discard;\n\n    gVelocity = vec4(0.0, 0.0, 0.0, 1.0);\n"),this.isColoringRandom&&t.define("USE_RANDOM_COLORING"),this.useSizeEnd&&t.define("USE_SIZE_END"),t.addVertexParsCode(vQ),t.addFragmentParsCode(yQ),t.addVertexFinalCode((t=>{let{easeSize:e="linearFadeOut"}=t;return`\n  vUv = uv;  \n  vRef = ref;\n  // Normalized LifeTime 1 to 0\n  float lifeLeft = texture2D(uPosition, ref).w;\n  v_LifeLeft = lifeLeft;\n  // Position From DataTexture Simulation\n  vec3 pos = texture2D(uPosition, ref).rgb - uWorldOffset;\n  // Apply World Quaternion\n  pos = applyQuaternionToVector(uWorldQuaternion, pos);  \n            \n  #ifdef  USE_SIZE_END\n    // Scaled Over Time\n    float t = 1. - lifeLeft;\n    float currentSize = mix(uSize, uSizeEnd, t); // Linearly interpolate between uSize and uSizeEnd\n    vec3 scaledPosition = position * vec3(currentSize);\n  #else\n    // Change Size Behavior over LifeTime\n    float easeSize = ${e}(1. - lifeLeft);\n    // Scaled Over Time\n    vec3 scaledPosition = position * vec3(uSize * easeSize);\n  #endif\n\n  // Billboard Behavior\n  vec2 scale;\n  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );    \n  // Randomness \n  float randRef = rand(ref);\n  scale *= (1.0 - (uRandScaleFactor * randRef));\n  // Rotation\n  float randRotation =  2.0 * PI * ( uRandRotationFactor * randRef);\n  float originalRotation = (1.0 - uRotation) * 2.0 * PI;\n  float originalRotationEnd = (1.0 - uRotationEnd) * 2.0 * PI;\n  // OverTime\n  float finalRotation = mix(originalRotation + randRotation, originalRotationEnd + randRotation, lifeLeft);\n\n  vec2 alignedPosition = ( scaledPosition.xy - ( center - vec2( 0.5 ) ) ) * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos( finalRotation ) * alignedPosition.x - sin( finalRotation ) * alignedPosition.y;\n  rotatedPosition.y = sin( finalRotation ) * alignedPosition.x + cos( finalRotation ) * alignedPosition.y;\n  \n  mat4 instanceMatrix = mat4(\n    vec4(1.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 1.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 1.0, 0.0),\n    vec4(pos.x, pos.y, pos.z, 1.0)\n  );  \n\n  mvPosition = modelViewMatrix * instanceMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n  mvPosition.xy += rotatedPosition;\n  gl_Position = projectionMatrix  * mvPosition;   \n`})({easeSize:this.easeSize})),t.addFragmentFinalCode((t=>{let{easeOpacity:e="linearFadeOut"}=t;return`  \n  // if Particle is dead, hide it\n  if (v_LifeLeft <= 0.005 ) {\n    discard;\n  }\n\n  #ifdef USE_RANDOM_COLORING\n    float randVal = random(vRef); // Generate a random value based on the reference\n    vec4 color = mix(uColor, uColor2, randVal); // Interpolate between the two colors\n  #else\n    vec4 color = mix(uColor, uColor2, 1. - v_LifeLeft);\n  #endif\n\n  // Opacity over Life Time\n  float finalAlpha = ${e}(1. - v_LifeLeft);  \n  vec4 textureColor = texture2D(uTexture, vUv).rgba; \n  finalColor = textureColor.rgb * color.rgb;\n  finalAlpha = color.a * textureColor.a * finalAlpha;\n  \n  gl_FragColor = vec4(finalColor, finalAlpha);     \n\n`})({easeOpacity:this.easeOpacity})),this.vertexShader=t.getCode("vertex"),this.fragmentShader=t.getCode("fragment"),this.defines=t.defines,this.uniforms={...t.uniforms,...this.uniforms},this.extensions=t.extensions,this}get nodeMaterial(){return this}get fragment(){return this.lightLayer.node}getDefines(){return this.defines}nodeMaterialDispose(){this.layers.forEach((t=>t.dispose())),super.dispose()}},xQ=class{constructor(t,e,i,n){this.type="SphereEmitterShape",this.targetMesh=void 0,this.size=t,this.type=i,this.textureSize=function(t){let e=Math.ceil(Math.sqrt(t));return Math.max(e,1)}(e);this.targetMesh="Mesh"===n?.type&&n?n:this.getMesh(i,1);let{positions:r,dataTexture:s,dataTextureNormals:a}=this.createPositions(this.textureSize,this.targetMesh??this.getMesh(i,1));this.positionsTexture=s,this.positionsAttribute=r,this.directionsTexture=a}createPositions(t,e){let{positions:i,normals:n}=function(t,e){let i=new rv(t.geometry,t.material),n=[],r=[],s=new mm,a=new mm;null!==i.geometry.index&&(i.geometry=i.geometry.toNonIndexed());let o=new fQ(i).build();for(let l=0;l<e;l++)o.sample(s,a),n.push(s.x,s.y,s.z),r.push(a.x,a.y,a.z);return{positions:new Float32Array(n),normals:new Float32Array(r)}}(e,t*t);return{dataTexture:mQ(i,t),positions:i,dataTextureNormals:mQ(n,t)}}getMesh(t,e){let i=null;switch(t){case"SphereEmitterShape":i=new Rw(.5*e,32,32);break;case"TorusEmitterShape":i=new Ow(.5*e,.3,15,40);break;case"ConeEmitterShape":i=new tw(e,e,15);break;case"BoxEmitterShape":i=new av(e,e,e);break;case"PlaneEmitterShape":i=new Mv(e,e),i.rotateX(-Math.PI/2);break;default:i=new Rw(e,32,32)}return new rv(i,new Dg({color:16711680}))}applyToShader(t,e){this.size=(new mm).fromArray(e.size),t.uEmitterSize.value=this.size}dispose(){this.positionsTexture.dispose(),this.directionsTexture.dispose(),this.positionsAttribute=new Float32Array}};function wQ(t){let e={...t},i=QI.defaultData;e.forceFieldObjectId&&(e.colliderEntityId=e.forceFieldObjectId);let n={...i.shape,...e.shape},r={...i.renderMaterial,...e.renderMaterial};return{...i,...e,shape:n,renderMaterial:r}}var SQ=class extends gg{constructor(t,e){super(),this.type="ParticleEmitter",this.debugMode=!1,this.worldSpace=!0,this.rootObject=null,this.gpuCompute=null,this.positionSimRT=null,this.velocitySimRT=null,this.emissionRateSimRT=null,this.emitterShape=void 0,this.isEmitting=!1,this.hasBeenReset=!1,this.emittedParticlesAmount=0,this.lastEmitTime=0,this.globalTime=0,this.targetFPS=60,this.previousRatio=1,this.lerpFactor=.4,this.particlesAmount=0,this.noiseStrength=0,this.noiseScale=0,this.isBillboardBased=!0,this.simFeaturesDefinition={USE_COLLIDER:!1,USE_ATTRACTOR:!1,USE_VORTEX:!1,USE_SPHERE_COLLIDER:!1,USE_BOX_COLLIDER:!1,USE_FORCE_LOCAL_SPACE:!1,USE_NORMALS:!1,USE_CURL_NOISE:!0,USE_SIMPLEX_NOISE:!1,USE_FBM_NOISE:!1},this.textureLoader=new uS,this.currentWorldPosition=new mm,this.systemQuaternion=new fm,this.worldGravity=new mm(0,0,0),this.directionAxis=new mm(0,0,0),this.colliderV3=new mm(0,0,0),this.colliderQuaternion=new fm(0,0,0,1),this.matrixAutoUpdate=!0,this.renderer=t,this.system=e,this.shared=e.context.shared;let i=e.data;this.material=new bQ(i.renderMaterial,e.context),this.material.uniforms={uSize:{value:0},uSizeEnd:{value:0},uColor:{value:i.renderMaterial.color},uColor2:{value:i.renderMaterial.color2},uPosition:{value:new mm(0,0,0)},uEmissionData:{value:new mm(0,0,0)},uTexture:{value:this.defaultTexture},uWorldOffset:{value:new mm(0,0,0)},uWorldQuaternion:{value:new cm(0,0,0,1)},uRandScaleFactor:{value:i.randomScale??0},uRandRotationFactor:{value:i.randomRotation??0},uRotation:{value:i.renderMaterial.spriteRotation[0]??0},uRotationEnd:{value:i.renderMaterial.spriteRotation[1]??0}},this.setTexture(this.material.uniforms,i.renderMaterial.texture),this.init(i)}setTexture(t,e){let i=e.data;if("string"==typeof e){let i=this.shared.image(e),n=new hm(i.img);return n.needsUpdate=!0,void(t.uTexture.value=n)}if("string"!=typeof i){let e=new Image;e.onload=()=>{let i=new hm(e);i.needsUpdate=!0,t.uTexture.value=i};let n=new Blob([i],{type:"image/*"}),r=URL.createObjectURL(n);e.src=r}}updateGeometryAttributes(t,e){let i=function(t){let e=new Float32Array(t*t*2);for(let i=0;i<t;i++)for(let n=0;n<t;n++){let r=i*t+n;e[2*r+0]=i/(t-1),e[2*r+1]=n/(t-1)}return e}(e);!this.emitterShape?.positionsAttribute||t.geometry.setAttribute("ref",new fx(i,2))}applyWorldSpace(){if(!this.system.started||!this.worldSpace||!this.positionSimRT||!this.velocitySimRT)return;let t=this.system;t.getWorldQuaternion(this.systemQuaternion),this.systemQuaternion.invert(),t.getWorldPosition(this.currentWorldPosition),this.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.positionSimRT.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.systemQuaternion.invert(),this.positionSimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.velocitySimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize())}update(t,e){if(!this.gpuCompute||!this.positionSimRT||!this.velocitySimRT||!this.emissionRateSimRT||this.hasBeenReset)return;if(this.checkIfAllParticlesAreDead()&&!this.hasBeenReset)return void this.reset();this.applyWorldSpace(),this.globalTime=t,this.positionSimRT.material.uniforms.uTime.value=t,this.emissionRateSimRT.material.uniforms.uTime.value=t;let i=1e3/e,n=this.targetFPS/i,r=this.previousRatio+(n-this.previousRatio)*this.lerpFactor;this.positionSimRT.material.uniforms.uFPSRatio.value=r,this.previousRatio=r;let s=this.isEmitting?this.GoEmitSomeParticles(t,this.system.data.birthRatePerSec):0;this.emissionRateSimRT.material.uniforms.uLastIndexEmitted.value=this.emittedParticlesAmount,this.emissionRateSimRT.material.uniforms.uParticlesToEmit.value=s,this.material.uniforms.uPosition.value=this.gpuCompute.getCurrentRenderTarget(this.positionSimRT)?.texture,this.system.colliderEntities.length>0&&this.renderColliders(),this.gpuCompute.compute()}renderColliders(){if(!this.velocitySimRT)return;let t=this.system.colliderEntities[0],e=this.simFeaturesDefinition.USE_COLLIDER||this.simFeaturesDefinition.USE_ATTRACTOR||this.simFeaturesDefinition.USE_VORTEX;if(t.destroyedInAction&&e&&this.init(wQ({...this.system.data,colliderEntityId:null})),!t||t.destroyedInAction)return;t.getWorldPosition(this.colliderV3),0===this.colliderV3.y&&(this.colliderV3.y=1e-4),this.velocitySimRT.material.uniforms.uColliderPos.value.copy(this.colliderV3);let i=t.data.size;this.colliderV3.fromArray(i),this.velocitySimRT.material.uniforms.uColliderSize.value.copy(this.simFeaturesDefinition.USE_SPHERE_COLLIDER?this.colliderV3.multiplyScalar(.5):this.colliderV3),t.getWorldQuaternion(this.colliderQuaternion),this.velocitySimRT.material.uniforms.uColliderQuaternion.value.copy(this.colliderQuaternion.normalize()),this.velocitySimRT.material.uniforms.uColliderQuaternionInvert.value.copy(this.colliderQuaternion.normalize().invert())}updateState(t){!this.velocitySimRT||!this.positionSimRT||(t.renderMaterial&&this.updateMaterialState(t.renderMaterial),this.updateParticleState(t))}updateVariableState(t,e){if(!this.velocitySimRT||!this.positionSimRT)return;"size"===e[2]&&this.material.updateState({size:[t,this.material.uniforms.uSizeEnd.value]}),"sizeEnd"===e[2]&&this.material.updateState({size:[this.material.uniforms.uSize.value,t]});let i=(t,e)=>{let i=[...this.system.data.shape.size];i[t]=e,this.updateParticleState({shape:{...this.system.data.shape,size:i}})};"shape_size_0"===e[2]&&i(0,t),"shape_size_1"===e[2]&&i(1,t),"shape_size_2"===e[2]&&i(2,t),"speed"===e[2]&&(this.velocitySimRT.material.uniforms.uSpeed.value=t/10),"gravity"===e[2]&&this.worldGravity.set(0,t/100,0),"noiseStrength"===e[2]&&(this.noiseStrength=t,this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),"noiseScale"===e[2]&&(this.noiseScale=t,this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),"direction_x"===e[2]&&(this.directionAxis=this.getDirectionAxis([Number(t),this.system.data.direction[1],this.system.data.direction[2]])),"direction_y"===e[2]&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],Number(t),this.system.data.direction[2]])),"direction_z"===e[2]&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],this.system.data.direction[1],Number(t)]))}updateMaterialState(t){this.material.updateState({...t,size:t.size?[Number(this.shared.getVariable(t.size[0],[this.uuid,"particles","size"])),Number(this.shared.getVariable(t.size[1],[this.uuid,"particles","sizeEnd"]))]:[0,0]}),t.texture&&(this.setTexture(this.material.uniforms,t.texture),this.material.needsUpdate=!0)}updateParticleState(t){if(this.positionSimRT&&this.velocitySimRT){if(this.shouldReInitGPUCompute(t)&&this.init(wQ(this.system.data)),void 0!==t.life&&(this.positionSimRT.material.uniforms.uMaxLifeTime.value=t.life),void 0!==t.speed&&(this.velocitySimRT.material.uniforms.uSpeed.value=Number(this.shared.getVariable(t.speed,[this.uuid,"particles","speed"]))/10),void 0!==t.collisionBounce&&(this.velocitySimRT.material.uniforms.uBounce.value=t.collisionBounce),void 0!==t.noiseStrength&&(this.noiseStrength=Number(this.shared.getVariable(t.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),void 0!==t.noiseScale&&(this.noiseScale=Number(this.shared.getVariable(t.noiseScale,[this.uuid,"particles","noiseScale"])),this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),void 0!==t.noiseSeed&&(this.velocitySimRT.material.uniforms.uNoiseSeed.value=t.noiseSeed),void 0!==t.randomMass&&(this.velocitySimRT.material.uniforms.uRandomMassFactor.value=t.randomMass),void 0!==t.renderMaterial?.size){let e=this.shared.getVariable(t.renderMaterial.size[0],[this.uuid,"particles","size"]);this.velocitySimRT.material.uniforms.particleSize.value=Number(e)}if(void 0!==t.renderMaterial?.spriteRotation&&(this.material.uniforms.uRotation.value=t.renderMaterial.spriteRotation[0],this.material.uniforms.uRotationEnd.value=t.renderMaterial.spriteRotation[1]),void 0!==t.shape){let e=t.shape.size??this.system.data.shape.size,i=[Number(this.shared.getVariable(e[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e[2],[this.uuid,"particles","shape_size_2"]))],n={...wQ(this.system.data).shape,size:i};this.emitterShape?.applyToShader(this.positionSimRT.material.uniforms,n)}if(void 0!==t.gravity&&(this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.velocitySimRT.material.uniforms.uGravity={value:this.worldGravity}),void 0!==t.direction){let e=this.getDirectionFromVariable(t.direction);this.directionAxis=this.getDirectionAxis(e),this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis}void 0!==t.randomRotation&&(this.material.uniforms.uRandRotationFactor.value=t.randomRotation),void 0!==t.randomScale&&(this.material.uniforms.uRandScaleFactor.value=t.randomScale)}}updateForceFieldParameters(t){!this.velocitySimRT||(void 0!==t.forceIntensity&&(this.velocitySimRT.material.uniforms.uForceIntensity.value=t.forceIntensity),void 0!==t.forceDambing&&(this.velocitySimRT.material.uniforms.uForceDamping.value=t.forceDambing))}getDirectionAxis(t){let e=[Number(t[0])*Nf.DEG2RAD,Number(t[1])*Nf.DEG2RAD,Number(t[2])*Nf.DEG2RAD],i=new eg(e[0],e[1],e[2],"XYZ");return this.directionAxis.set(0,1,0).applyEuler(i).normalize(),this.velocitySimRT&&(this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis),this.directionAxis}shouldReInitGPUCompute(t){let{birthRatePerSec:e,rootObjectType:i,colliderEntityId:n,shape:r,emitTimeDuration:s,emitTimeCycle:a,life:o,directionMode:l,noiseType:h}=t;return void 0!==e||void 0!==i||n||null===n||void 0!==a||void 0!==r||void 0!==o||void 0!==s||void 0!==l||void 0!==h}init(t){this.dispose(),this.particlesAmount=this.getMaxParticlesAmount({birthRatePerSecond:t.birthRatePerSec,particleMaxLifeTime:t.life,loopDuration:"infinity"===t.emitTimeCycle?0:t.emitTimeDuration}),this.particlesAmount>1e5&&(console.warn("The maximum number of particles is limited to 100000."),this.particlesAmount=1e5),this.emitterShape=this.createShape(t.shape,this.particlesAmount);let e=setInterval((()=>{if(this.emitterShape){if(isNaN(this.emitterShape.positionsTexture.source.data.data[0]))return void this.init(t);clearInterval(e)}}),100);if(!this.emitterShape)return;let i=new uQ(this.emitterShape.textureSize,this.emitterShape.textureSize,this.renderer),n=this.updateSimulationDefinition(t),r=i.addVariable("uCurrentPosition",n+"\n// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU\nuniform sampler2D uOriginalPosition;\nuniform float uTime;\nuniform float uSpeed;     // update speed of the particles\nuniform vec3 uWorldOffset;    \nuniform vec4 uWorldQuaternion;\nuniform float uMaxLifeTime;\nuniform vec3 uEmitterSize;\nuniform float uFPSRatio;     // 1  for 60 FPS\n\nfloat random (vec2 st) {\n    return fract(sin(dot(st.xy,\n        vec2(12.9898,78.233)))*\n        43758.5453123);\n}\nvec3 applyQuaternionToVector( vec4 q, vec3 v ){\n    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n}\n\nvec3 applyForce(vec3 force, float mass) {\n    vec3 acceleration = force / mass;\n    \n    return acceleration;\n  }\n  \n\nvoid main() {\n    vec2 vUv = gl_FragCoord.xy / resolution.xy;\n    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;\n    float currentLife = texture2D( uCurrentPosition, vUv ).w;   // from 1 to 0\n    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).r;        // 1. = spawning, 0. = not spawning\n    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;          // 1. = active, 0. = not active\n    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;         // timeStart in seconds when the particle was emitted\n    vec3 originalPosition = ((texture2D( uOriginalPosition, vUv ).xyz) * uEmitterSize);\n    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;\n    float collisionFlag = texture2D( uCurrentVelocity, vUv ).w;             // 1. = collided, 0. = not collided\n    float lifeTime = uMaxLifeTime;\n\n    // Calculate the position adjustment based on collision\n    //     if (collisionFlag > .5) {  \n    float isColliding = step(0.5, collisionFlag); // 1.0 if collisionFlag > 0.5, otherwise 0.0\n    float bounceOffset = 3.0 * isColliding; // Becomes 3.0 if colliding, 0.0 otherwise\n    vec3 collisionAdjustedVelocity = velocity * (1.0 + bounceOffset);\n\n    // Update position based on collision or normal movement\n    vec3 fpsVelocity = velocity * min(uFPSRatio, 5.0);\n    position += mix(fpsVelocity, collisionAdjustedVelocity, isColliding);\n\n    // EMISSION RATE - BIRTH\n    // if (isSpawning == 1.0) {\n    // Better Approach to avoid If statement\n    vec3 newPosition = applyQuaternionToVector(uWorldQuaternion, originalPosition) + uWorldOffset;\n    originalPosition = mix(originalPosition, newPosition, isSpawning);\n    position = mix(position, originalPosition, isSpawning);;\n    timeStart = mix(timeStart, uTime, isSpawning);\n\n    // Calculate timeLeft for life normalization\n    float timeLeft = max(lifeTime - (uTime - timeStart), 0.0);\n    float life_Normalize = timeLeft / lifeTime;\n\n    // Use isActive to blend between the calculated color and black\n    vec4 activeColor = vec4(position, life_Normalize);\n    // if (isActive == 1.0) {\n    gl_FragColor = mix(vec4(0.0), activeColor, isActive);\n\n}\n",this.emitterShape.positionsTexture),s=i.addVariable("uCurrentVelocity",n+"\n// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU\nuniform sampler2D uOriginalPosition;\nuniform sampler2D uDirections;     \nuniform vec3 uDirectionsAxis;\nuniform vec4 uWorldQuaternion;\nuniform vec3 uGravity;        \nuniform float uNoiseStrength;     // Variation of the noise\nuniform float uNoiseScale;        // Scale of the noise\nuniform float uNoiseSeed;         // Seed of the noise\nuniform float particleSize;\nuniform float uSpeed;     // update speed of the particles\nuniform float uRandomMassFactor;\n\n// COLLIDER\nuniform vec3 uColliderPos;                // Collider Position\nuniform vec3 uColliderSize;               // Collider Dimension\nuniform vec4 uColliderQuaternion;         // Collider Rotation\nuniform vec4 uColliderQuaternionInvert;   // Collider Rotation\nuniform float uBounce;                    // Bounce factor\nuniform float uForceDamping;\nuniform float uForceIntensity;\n\n\n\n\n    vec3 mod289(vec3 x) {\n      return x - floor(x * (1.0 / 289.0)) * 289.0;\n    }\n    \n    vec4 mod289(vec4 x) {\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n    }\n    \n    vec4 permute(vec4 x) {\n        return mod289(((x*34.0)+1.0)*x);\n    }\n    \n    vec4 taylorInvSqrt(vec4 r)\n    {\n    return 1.79284291400159 - 0.85373472095314 * r;\n    }\n    \n    vec3 fade(vec3 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\n    float snoise(vec3 v)\n    {\n    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n    vec3 i  = floor(v + dot(v, C.yyy) );\n    vec3 x0 =   v - i + dot(i, C.xxx) ;\n    vec3 g = step(x0.yzx, x0.xyz);\n    vec3 l = 1.0 - g;\n    vec3 i1 = min( g.xyz, l.zxy );\n    vec3 i2 = max( g.xyz, l.zxy );\n    vec3 x1 = x0 - i1 + C.xxx;\n    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n    \n    // Permutations\n    i = mod289(i);\n    vec4 p = permute( permute( permute(\n                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n              + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n              + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n    \n    // Gradients: 7x7 points over a square, mapped onto an octahedron.\n    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n    float n_ = 0.142857142857; // 1.0/7.0\n    vec3  ns = n_ * D.wyz - D.xzx;\n    \n    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n    \n    vec4 x_ = floor(j * ns.z);\n    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n    \n    vec4 x = x_ *ns.x + ns.yyyy;\n    vec4 y = y_ *ns.x + ns.yyyy;\n    vec4 h = 1.0 - abs(x) - abs(y);\n    \n    vec4 b0 = vec4( x.xy, y.xy );\n    vec4 b1 = vec4( x.zw, y.zw );\n    \n    vec4 s0 = floor(b0)*2.0 + 1.0;\n    vec4 s1 = floor(b1)*2.0 + 1.0;\n    vec4 sh = -step(h, vec4(0.0));\n    \n    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n    \n    vec3 p0 = vec3(a0.xy,h.x);\n    vec3 p1 = vec3(a0.zw,h.y);\n    vec3 p2 = vec3(a1.xy,h.z);\n    vec3 p3 = vec3(a1.zw,h.w);\n    \n    //Normalise gradients\n    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n    p0 *= norm.x;\n    p1 *= norm.y;\n    p2 *= norm.z;\n    p3 *= norm.w;\n    \n    // Mix final noise value\n    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n    m = m * m;\n    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                  dot(p2,x2), dot(p3,x3) ) );\n    }\n    \n    vec3 snoiseVec3( vec3 x ){\n    \n      float s  = snoise(vec3( x ));\n      float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n      float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n      vec3 c = vec3( s , s1 , s2 );\n      return c;\n    \n    }\n    \n      \n    vec3 curlNoise( vec3 p, float seed){\n      p += seed;\n      const float e = .1;\n      vec3 dx = vec3( e   , 0.0 , 0.0 );\n      vec3 dy = vec3( 0.0 , e   , 0.0 );\n      vec3 dz = vec3( 0.0 , 0.0 , e   );\n    \n      vec3 p_x0 = snoiseVec3( p - dx );\n      vec3 p_x1 = snoiseVec3( p + dx );\n      vec3 p_y0 = snoiseVec3( p - dy );\n      vec3 p_y1 = snoiseVec3( p + dy );\n      vec3 p_z0 = snoiseVec3( p - dz );\n      vec3 p_z1 = snoiseVec3( p + dz );\n    \n      float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n      float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n      float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n    \n      const float divisor = 1.0 / ( 2.0 * e );\n      return normalize( vec3( x , y , z ) * divisor );\n    \n    }\n\n\n// Classic Perlin noise\nfloat cnoise(vec3 P)\n{\n  vec3 Pi0 = floor(P); // Integer part for indexing\n  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n  Pi0 = mod289(Pi0);\n  Pi1 = mod289(Pi1);\n  vec3 Pf0 = fract(P); // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 * (1.0 / 7.0);\n  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 * (1.0 / 7.0);\n  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n  return 2.2 * n_xyz;\n}\n\n\nvec3 fbm_vec3(vec3 p, float frequency, float offset)\n{\n  return vec3(\n    cnoise((p+vec3(offset))*frequency),\n    cnoise((p+vec3(offset+20.0))*frequency),\n    cnoise((p+vec3(offset-30.0))*frequency)\n  );\n}\n\n\nfloat rand(vec2 co){\n    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);\n}\nvec3 applyQuaternionToVector( vec4 q, vec3 v ){\n    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n } \nvec3 applyForce(vec3 force, float mass) {\n  vec3 acceleration = force / mass;\n  \n  return acceleration;\n}\n\nvec4 conjugate(vec4 q) {\n  return vec4(q.w, -q.x, -q.y, -q.z);\n}\n\n// Function to compute the normal of the ellipsoid at a given point\nvec3 ellipsoidNormal(vec3 p, vec3 radii) {\n  return normalize(p / (radii * radii));\n}\n\nfloat friction = .3;\n\nvoid main() {\n    vec2 vUv = gl_FragCoord.xy / resolution.xy;\n    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;\n    vec3 originalPosition = texture2D( uOriginalPosition, vUv ).xyz;\n    float timeLeft = texture2D( uCurrentPosition, vUv ).w;\n    vec3 directions = texture2D( uDirections, vUv ).xyz;    \n    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;\n    float mass = rand(originalPosition.xy) * 0.5 + 0.5;\n    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).x;        // 1. = spawning, 0. = not spawning\n    float isActive = texture2D( uCurrentEmissionRate, vUv ).y;          // 1. = active, 0. = not active\n    float collisionFlag =texture2D( uCurrentVelocity, vUv ).w;          // Indicate collision\n\n    // Randomness Mass\n    mass = (1.0 - (uRandomMassFactor * mass));\n    \n    if (isActive == 1.0) {\n      // **************************************************************\n      // FORCES NOISES\n      // **************************************************************\n      #ifdef USE_CURL_NOISE\n        if (uNoiseScale > 0.0 ) {\n          velocity = curlNoise(position * uNoiseScale * .002, uNoiseSeed) * ( uNoiseStrength + 1.0) * .05 * uSpeed;\n        }\n        // Variation of the noise Over Time\n        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {\n          velocity += curlNoise( position, uNoiseSeed)  * uNoiseStrength * 0.05 * uSpeed;\n        }\n      #endif\n      // **************************************************************\n      #ifdef USE_SIMPLEX_NOISE\n        if (uNoiseScale > 0.0 ) {\n          velocity = vec3(snoise(position * uNoiseScale * .001) * ( uNoiseStrength + 1.0) * .1);\n          velocity *= uSpeed;\n        }\n        // Variation of the noise Over Time\n        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0) {\n          velocity += vec3(snoise(position * uNoiseStrength * .001) * .05 * uSpeed);\n        }\n      #endif\n      // ************************************************************** \n      #ifdef USE_FBM_NOISE\n        if (uNoiseScale > 0.0 ) {\n          velocity = fbm_vec3(position * uNoiseScale * .001, ( uNoiseStrength + 1.0), uNoiseSeed);\n          velocity *= uSpeed;\n        }\n        // Variation of the noise Over Time\n        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {      \n          velocity += fbm_vec3(position * uNoiseStrength * .001, ( uNoiseStrength + 1.0), uNoiseSeed) * .1 * uSpeed;\n        }\n      #endif\n\n      // COLLIDER\n      \n  #ifdef USE_COLLIDER\n    float restitution = max(uBounce * 2., .01); // Energy Loss\n    // SPHERE COLLIDER\n    // **************************************************************\n    #ifdef USE_SPHERE_COLLIDER       \n      // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)\n      vec3 radii = uColliderSize;\n      // Adjust position relative to collider\n      vec3 relPos = position - uColliderPos;\n      // Apply rotation of the collider to the relative position\n      relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            \n      // Scale relative position by radii (for ellipsoid collision detection)\n      vec3 scaledPos = relPos / radii;\n      // Calculate ellipsoidal distance\n      float dist = length(scaledPos); // Distance in terms of ellipsoid\n      \n      // Check for collision\n      if (dist <= 1. + particleSize / length(radii) && collisionFlag == 0.0) {\n          // Compute the normal at the collision point, accounting for particle size\n        vec3 adjustedPos = scaledPos * (1.0 + particleSize / length(radii));          \n        // Compute the normal at the collision point\n        vec3 normal = ellipsoidNormal(adjustedPos, radii);\n        // Rotate the normal back to world space\n        normal = applyQuaternionToVector(uColliderQuaternion, normal);\n        // Reflect the velocity vector off the normal\n        velocity = reflect(velocity, normal) * restitution;\n\n        collisionFlag = 1.0;\n      } else {\n        collisionFlag = 0.0;\n      }\n    #endif\n\n    // BOX COLLIDER or PLANE COLLIDER \n    // **************************************************************\n    #ifdef USE_BOX_COLLIDER\n      // Box dimensions and repulsion variables\n      vec3 boxHalfSize = uColliderSize / 2.0;\n      // Convert world position to box's local space\n      vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      \n      // Collision detection\n      vec3 localDistance = abs(localPos) - boxHalfSize;\n      float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));    \n\n      // Collision Detected\n      if (distToSurface <= particleSize * 0.5 && collisionFlag == 0.0) {      \n        // Find the nearest face normal for bounce direction\n        vec3 normal;\n        if (localDistance.x > localDistance.y && localDistance.x > localDistance.z) {\n            normal = vec3(sign(localPos.x), 0.0, 0.0);\n        } else if (localDistance.y > localDistance.z) {\n            normal = vec3(0.0, sign(localPos.y), 0.0);\n        } else {\n            normal = vec3(0.0, 0.0, sign(localPos.z));\n        }            \n        // Rotate normal back to world space\n        normal = applyQuaternionToVector(uColliderQuaternion, normal);      \n        // Reflect velocity and apply repulsion force\n        velocity = reflect(velocity, normal) * restitution;\n        \n        collisionFlag = 1.0;\n      } else {\n        collisionFlag = 0.0;\n      }\n    #endif      \n  #endif      \n  // END COLLIDER    \n\n      // ATTRACTION\n      \n  #ifdef USE_ATTRACTOR\n\n      #ifdef USE_SPHERE_COLLIDER      \n        // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)\n        vec3 radii = uColliderSize;\n        // Adjust position relative to collider\n        vec3 relPos = position - uColliderPos;\n        // Apply rotation of the collider to the relative position\n        relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            \n        // Scale relative position by radii (for ellipsoid collision detection)\n        vec3 scaledPos = relPos / radii;\n        // Calculate ellipsoidal distance\n        float distToSurface = length(scaledPos); // Distance in terms of ellipsoid\n        float insideCheck = 1.0;\n\n      #endif\n\n\n      #ifdef USE_BOX_COLLIDER\n        // Box dimensions\n        vec3 boxHalfSize = uColliderSize / 2.0;\n        // Convert world position to box's local space\n        vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      \n        vec3 localDistance = abs(localPos) - boxHalfSize;\n        float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));\n        float insideCheck = particleSize;\n      #endif      \n  \n      // Apply vortex force inside the Helper\n      #ifdef USE_FORCE_LOCAL_SPACE\n        if (distToSurface <= insideCheck ) {    \n            // Define parameters for the attractor field\n            #ifdef USE_SPHERE_COLLIDER      \n              float attractorStrength = (1.0 - distToSurface ) * uForceIntensity; // Adjust as needed\n            #endif\n\n            #ifdef USE_BOX_COLLIDER\n              float attractorStrength = max((1.0 - insideCheck / distToSurface), 0.) * uForceIntensity; // Adjust as needed\n              #endif\n\n            float attractorDamping = uForceDamping;  // Adjust as needed (higher values will attenuate velocity more)\n          \n            // Use the same radii calculation code as for the collider\n            vec3 attractorRadii = uColliderSize;\n            // Adjust position relative to attractor center\n            vec3 relPos = position - uColliderPos;\n            // Apply rotation of the collider to the relative position\n            relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            \n            // Scale relative position by radii (for ellipsoid attraction)\n            vec3 scaledPos = relPos / attractorRadii;\n\n            // Calculate ellipsoidal distance as attractor radius\n            float attractorRadius = length(scaledPos);\n            // Calculate the distance from the attractor center\n            vec3 relativePosition = position - uColliderPos;\n            // Calculate the force vector towards the attractor center\n            vec3 attractorForce = normalize(relativePosition) * attractorStrength;\n            // Apply the attractor force to the particle\n            velocity -= attractorForce;\n            // Attenuate the particle's velocity\n            velocity *= attractorDamping;\n        }\n      #else \n            // Calculate the distance from the attractor center\n            vec3 relativePosition = position - uColliderPos;\n            // Calculate the force vector towards the attractor center\n            vec3 attractorForce = normalize(relativePosition) * uForceIntensity;\n            // Apply the attractor force to the particle\n            velocity -= attractorForce;\n            // Attenuate the particle's velocity\n            velocity *= uForceDamping;\n      #endif    \n  #endif      \n  \n      // VORTEX\n      \n  #ifdef USE_VORTEX\n    // Box dimensions\n    vec3 boxHalfSize = uColliderSize / 2.0;\n    // Convert world position to box's local space\n    vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      \n    vec3 localDistance = abs(localPos) - boxHalfSize;\n    float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));\n\n    // Apply vortex force inside the box\n    if (distToSurface <= particleSize) {\n      float vortexStrength = uForceIntensity;\n      vec3 localTopCenter = vec3(0.0, 0., 0.0);\n\n      // Transform the local top center to the world space\n      vec3 vortexCenter = uColliderPos + applyQuaternionToVector(uColliderQuaternion, localTopCenter);\n      // Calculate the vector from particle to vortex center\n      vec3 vortexVector = vortexCenter - position;\n\n      // Calculate the rotation axis from the inverse of the collider's quaternion and the fixed up vector\n      // Note: important to add a tiny z component to the up vector to avoid instability\n      vec3 upVector = vec3(0.0, 1.0, 0.01);\n      vec3 rotationAxis = cross(upVector, applyQuaternionToVector(uColliderQuaternion, vortexVector));\n      rotationAxis = normalize(rotationAxis);\n\n      // Add rotational component to velocity\n      float rotationSpeed = length(vortexVector * vortexStrength * 3.0) ; \n\n      vec3 rotationVelocity = rotationAxis * rotationSpeed;\n      // velocity += rotationVelocity * 0.005 ;\n      velocity = rotationVelocity * 0.005 ;\n\n      // Calculate vortex force\n      // vec3 vortexForce = normalize(vortexVector) * uSpeed * .1 ;\n      // Apply the vortex force to the particle\n      vec3 originDirection = applyQuaternionToVector(uWorldQuaternion, directions);\n      velocity += applyForce( originDirection * uSpeed * (1. - uForceDamping) , mass * .5);\n    }\n  #endif      \n\n    } \n    // End isActive\n\n    // SPAWN BIRTH \n    // **************************************************************\n    // if (isSpawning == 1.)\n    #ifdef USE_NORMALS\n      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, directions) * uSpeed, isSpawning);\n    #else\n      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, uDirectionsAxis) * uSpeed, isSpawning);    \n    #endif\n    \n    // if (collisionFlag == 0.0)\n    velocity += applyForce(uGravity, mass * .5) * (1.0 - collisionFlag);\n\n    gl_FragColor = vec4(velocity, collisionFlag);\n}\n",this.emitterShape.directionsTexture),a=i.addVariable("uCurrentEmissionRate","\n// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU\n\nuniform sampler2D uIndex; // Texture with corresponding index\nuniform float uLastIndexEmitted; // Last emitted index\nuniform float uParticlesToEmit; // Number of particles to emit on that frame\nuniform float uTime;\n\nvoid main() {\n    vec2 vUv = gl_FragCoord.xy / resolution.xy;\n    float particleIndex = texture(uIndex, vUv).x;\n    float timeLeft = texture2D( uCurrentPosition, vUv ).w;\n    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;    // 1. = active, 0. = not active\n    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;\n\n\n    // ********** Detect Colision to Create a flag and use it in position **********\n    // We are doing this here, so\n\n    // ********** Emit Particles **********\n    // X = isSpawning 0.0 or 1.0\n    // Y = isActive 0.0 or 1.0\n    // Check if the vertex index is between the first value and the last value\n    // if (particleIndex >= uLastIndexEmitted && particleIndex < uLastIndexEmitted + uParticlesToEmit) {\n    //     // Emit a particle by writing 1 to the red channel of the color output\n    //     // r: 1. == emit the particle\n    //     // g: 1. == particle is now active\n    //     timeStart = uTime;\n    //     gl_FragColor = vec4(1.0, 1.0, timeStart, 1.0);\n    // } else {\n    //     // The Particle is either already emitted or not in the range of the particles to emit\n    //     // Do not emit a particle by writing 0 to the red channel of the color output        \n    //     gl_FragColor = vec4(0.0, isActive, timeStart, 1.0);\n    // }\n    // Determine if the particle is within the emission range\n    float emitLowerBound = step(uLastIndexEmitted, particleIndex);\n    float emitUpperBound = step(particleIndex, uLastIndexEmitted + uParticlesToEmit - 1.0);\n    float emitParticle = emitLowerBound * emitUpperBound; // 1.0 if in range, 0.0 otherwise\n\n    // Set timeStart and color\n    timeStart = mix(timeStart, uTime, emitParticle);\n    gl_FragColor = vec4(emitParticle, mix(isActive, 1.0, emitParticle), timeStart, 1.0);\n\n\n}\n",function(t){let e=new Float32Array(4*t*t);for(let n=0;n<t*t;n++)e[4*n]=0,e[4*n+1]=0,e[4*n+2]=0,e[4*n+3]=0;let i=new cx(e,t,t,Zp,Xp);return i.needsUpdate=!0,i}(this.emitterShape.textureSize));i.setVariableDependencies(r,[r,s,a]),i.setVariableDependencies(s,[r,s,a]),i.setVariableDependencies(a,[r,s,a]);let o=function(t){let{size:e}=t,i=new Float32Array(4*e*e);for(let r=0;r<e*e;r++)i[4*r]=r,i[4*r+1]=0,i[4*r+2]=0,i[4*r+3]=0;let n=new cx(i,e,e,Zp,Xp);return n.needsUpdate=!0,n}({size:this.emitterShape.textureSize}),l={uOriginalPosition:{value:this.emitterShape.positionsTexture},uWorldOffset:{value:new mm(0,0,0)},uWorldQuaternion:{value:new cm(0,0,0,1)},uTime:{value:0},uFPSRatio:{value:1},uMaxLifeTime:{value:t.life},uEmitterSize:{value:new mm(Number(this.shared.getVariable(t.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(t.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(t.shape.size[2],[this.uuid,"particles","shape_size_2"])))},particleSize:{value:0}};r.material.uniforms=l;let h=this.getDirectionFromVariable(t.direction);this.directionAxis=this.getDirectionAxis(h),this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.noiseStrength=Number(this.shared.getVariable(t.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.noiseScale=Number(this.shared.getVariable(t.noiseScale,[this.uuid,"particles","noiseScale"]));let c=t.colliderEntityId&&this.system.getColliderData(t.colliderEntityId),u={uOriginalPosition:{value:this.emitterShape.positionsTexture},uDirections:{value:this.emitterShape.directionsTexture},uDirectionsAxis:{value:this.directionAxis},uWorldQuaternion:{value:new cm(0,0,0,1)},uColliderPos:{value:new mm(0,0,0)},uColliderSize:{value:new mm(0,0,0)},uForceIntensity:{value:c?c.forceIntensity:0},uForceDamping:{value:c?c.forceDambing:0},uColliderQuaternion:{value:new cm(0,0,0,1)},uColliderQuaternionInvert:{value:new cm(0,0,0,1)},particleSize:{value:0},uGravity:{value:this.worldGravity},uNoiseStrength:{value:this.noiseStrength},uNoiseScale:{value:this.noiseScale},uNoiseSeed:{value:t.noiseSeed},uRandomMassFactor:{value:t.randomMass},uBounce:{value:t.collisionBounce},uSpeed:{value:Number(this.shared.getVariable(t.speed,[this.uuid,"particles","speed"]))/10}};s.material.uniforms=u;let d={uIndex:{value:o},uTime:{value:0},uLastIndexEmitted:{value:0},uParticlesToEmit:{value:0}};a.material.uniforms=d;let p=[Number(this.shared.getVariable(t.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(t.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(t.shape.size[2],[this.uuid,"particles","shape_size_2"]))],f={...wQ(this.system.data).shape,size:p};this.emitterShape.applyToShader(r.material.uniforms,f),i.init(),this.gpuCompute=i,this.positionSimRT=r,this.velocitySimRT=s,this.emissionRateSimRT=a,this.rootObject=this.createPrimaryEmitter(this.emitterShape.textureSize),this.add(this.rootObject),this.material.needsUpdate=!0}getDirectionFromVariable(t){return[Number(this.shared.getVariable(t[0],[this.uuid,"particles","direction_x"])),Number(this.shared.getVariable(t[1],[this.uuid,"particles","direction_y"])),Number(this.shared.getVariable(t[2],[this.uuid,"particles","direction_z"]))]}updateSimulationDefinition(t){if(this.simFeaturesDefinition.USE_COLLIDER=!1,this.simFeaturesDefinition.USE_ATTRACTOR=!1,this.simFeaturesDefinition.USE_VORTEX=!1,this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!1,this.simFeaturesDefinition.USE_BOX_COLLIDER=!1,this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!1,this.simFeaturesDefinition.USE_NORMALS=!1,this.simFeaturesDefinition.USE_CURL_NOISE=!1,this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!1,this.simFeaturesDefinition.USE_FBM_NOISE=!1,t.colliderEntityId&&this.system.colliderEntities.length>0){let e=this.system.getColliderData(t.colliderEntityId);switch(e?.forceType){case"attractor":this.simFeaturesDefinition.USE_ATTRACTOR=!0;break;case"collider":this.simFeaturesDefinition.USE_COLLIDER=!0;break;case"vortex":this.simFeaturesDefinition.USE_VORTEX=!0}let i=e?.colliderType;"sphere"===i&&(this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!0),"box"===i&&(this.simFeaturesDefinition.USE_BOX_COLLIDER=!0),"helper"===e?.forceRange&&(this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!0)}"normals"===t.directionMode&&(this.simFeaturesDefinition.USE_NORMALS=!0),"curl"===t.noiseType&&(this.simFeaturesDefinition.USE_CURL_NOISE=!0),"simplex"===t.noiseType&&(this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!0),"fbm"===t.noiseType&&(this.simFeaturesDefinition.USE_FBM_NOISE=!0);let e="";for(let[i,n]of Object.entries(this.simFeaturesDefinition))n&&(e+=`#define ${i}\n`);return e}createShape(t,e){this.emitterShape&&this.emitterShape.dispose();let i=new mm(Number(this.shared.getVariable(t.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(t.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(t.size[2],[this.uuid,"particles","shape_size_2"])));if("MeshEmitterShape"===t.type){let n=null;return this.system.context.scene.traverseEntity((e=>{e.uuid===t.fromMeshId&&(n=e)})),n?new xQ(i,e,t.type,n):new xQ(i,e,"SphereEmitterShape")}return new xQ(i,e,t.type)}createPrimaryEmitter(t){let e,i=t*t;return e=new xx(new Mv(1,1,1),this.material,i),this.updateGeometryAttributes(e,t),this.material.needsUpdate=!0,e.onBeforeRender=()=>{this.applyWorldSpace()},e}getMaxParticlesAmount(t){let{birthRatePerSecond:e,particleMaxLifeTime:i,loopDuration:n=0}=t;return Math.ceil(e*(i+n))}dispose(){!this.gpuCompute||(this.rootObject?.parent?.remove(this.rootObject),this.gpuCompute.dispose(),this.material.nodeMaterialDispose(),this.emitterShape?.dispose())}GoEmitSomeParticles(t,e){let i=t-this.lastEmitTime,n=1/e;if(i>=n){let e=Math.max(1,Math.floor(i/n));return this.lastEmitTime=t,this.emittedParticlesAmount+e>this.particlesAmount&&(this.emittedParticlesAmount=0),this.emittedParticlesAmount+=e,e}return 0}checkIfAllParticlesAreDead(){return this.lastEmitTime+this.system.data.life+1<this.globalTime}reset(){this.hasBeenReset=!0,this.lastEmitTime=0,this.emittedParticlesAmount=0,this.gpuCompute&&this.init(wQ(this.system.data))}startEmitting(t){this.isEmitting=!0,this.hasBeenReset=!1,this.lastEmitTime=t}stopEmitting(){this.isEmitting=!1}},AQ=class extends CU{constructor(t,e,i){super(t,e),this.type="ParticleSystem",this.geometry=new Hg,this.actualTime=0,this.currentLoopTime=0,this.started=!1,this.stopped=!1,this.timeoutId=void 0,this.isFrozen=!1,this.isIdle=!0,this.emitter=null,this.colliderEntities=[],this.renderer=null,this.isPreWarm=!1,this._hasOnAfterRenderBeenCalled=!1,this.onAfterRender=t=>{this._hasOnAfterRenderBeenCalled||(this._hasOnAfterRenderBeenCalled=!0,this.init(t))},this.context=i,this.data={...e,...wQ(e)},this.geometry.setAttribute("position",new Bg([],3)),this.material=new Dg({colorWrite:!1}),this.frustumCulled=!1}init(t){this.renderer=t,this.emitter=new SQ(t,this),this.add(this.emitter),this.updateParticleState(this.data)}update(t){if(!this.isReady||!this.started||this.isFrozen||this.isIdle)return;this.actualTime+=t,this.stopped||(this.currentLoopTime+=t);let e="one_time"===this.data.emitTimeCycle;if(("loop"===this.data.emitTimeCycle||e)&&this.currentLoopTime>1e3*this.data.emitTimeDuration&&(this.stopped||(this.stop(),e||this.start(1e3*this.data.emitTimeDelay))),this.emitter&&this.started){let e=this.actualTime/1e3;this.emitter.update(e,t)}this.scale.set(1,1,1),this.updateMatrix()}isReady(){return!!this.emitter}hasCollider(t){return this.colliderEntities.some((e=>e.identity===t))}getColliderData(t){let e=this.colliderEntities.find((e=>e.identity===t));return e?e.data:null}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),ED(t.path,["renderMaterial"])&&this.updateParticleState({renderMaterial:{...this.data.renderMaterial,...QT.drop(t,1).props}}),ED(t.path,["shape"])&&this.updateParticleState({shape:{...this.data.shape,...QT.drop(t,1).props}})}updateState(t,e){super.updateState(t,e),this.updateParticleState(t)}updateParticleState(t){if(this.emitter){if(void 0!==t.colliderEntityId&&null!==t.colliderEntityId){let e=this.context.scene.find(t.colliderEntityId);this.colliderEntities=e?[e]:[]}null===t.colliderEntityId&&(this.colliderEntities=[]),this.emitter.updateState(t),t.emitTimeCycle&&this.started&&this.start()}}updateFromColliderEntity(t){!this.emitter||(this.emitter.updateForceFieldParameters(t),this.stop(),this.start())}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.currentLoopTime=0,t?this.timeoutId=window.setTimeout((()=>{this.start(0)}),t):(this.started=!0,this.stopped=!1,this.isFrozen=!1,this.emitter?.startEmitting(this.actualTime/1e3))}froze(){this.isFrozen=!0}unFroze(){this.isFrozen=!1}stop(){this.stopped=!0,this.currentLoopTime=0,this.emitter?.stopEmitting(),clearTimeout(this.timeoutId)}reset(){this.started=!1,this.stopped=!1,this.emitter?.reset()}wakeUp(){this.isIdle=!1}sleep(){this.isIdle=!0,this.reset()}};var EQ=function(){try{let t=window.location.href;if(t.includes("reducesubdiv=")){let e=t.indexOf("reducesubdiv=")+13;return parseInt(t.slice(e,e+1))}}catch{}}();function _Q(t,e,i){return console.assert(void 0!==e.type),"Mesh"===e.type?function(t,e,i){let n;return void 0!==EQ&&(e?.geometry?.subdivisions??0)>EQ&&(console.log("reducing subdivisions",e.name,e.geometry.subdivisions),e.geometry.subdivisions=EQ),"TextGeometry"===e.geometry.type?new KH(t,e,i):"InputGeometry"===e.geometry.type?new rQ(t,e,i):(n="SubdivGeometry"===e.geometry.type?new CH(t,e,i):"PathGeometry"===e.geometry.type?new nQ(t,e,i):"VectorGeometry"===e.geometry.type?new iQ(t,e,i):"BooleanGeometry"===e.geometry.type?new RW(t,e,i):"ShapeBlendGeometry"===e.geometry.type?new IQ(t,e,i):"UIGeometry"===e.geometry.type?new cQ(t,e,i):new xH(t,e,i),n)}(t,e,i):"Empty"===e.type?new GW(t,e):"Particle"===e.type?new AQ(t,e,i):"ParticleCollider"===e.type?new HW(t,e,i):"Splat"===e.type?new GW(t,e):"Bone"===e.type?new hQ(t,e):"Page"===e.type?new tQ(t,e,i):"PointLight"===e.type?new eQ(t,e,i):"SpotLight"===e.type?new tX(t,e,i):"DirectionalLight"===e.type?new KY(t,e,i):"Component"===e.type||"Instance"===e.type?new sQ(t,e,i):NI.is(e.type)?new PW(t,e):(console.error(e),new GW(t,e))}HB.createEntity=_Q,HB.changeEntityProptotype=function(t,e,i){let n=_Q(t.identity,e,i),r=t.children,s=t.attachedPaths,a=t.parent,o=t.component,l=t.instances,h=t.overrideData,c=t.uuid,u=t.stateSelection;t.dispose();for(let d of Object.keys(t))delete t[d];Object.setPrototypeOf(t,Object.getPrototypeOf(n));for(let d of Object.keys(n))t[d]=n[d];t.children=[...t.children,...r],t.attachedPaths=s,t.parent=a,t.component=o,t.instances=l,t.uuid=c,t.overrideData=h,t.updateState(t.data,i),u&&t.changeSelectedState(u,i),t.resetBBoxNeedsUpdate()},HB.Cloner=hW;var CQ=new Hg;CQ.setAttribute("position",new Rg(new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),3));var MQ=class extends Bw{constructor(t){super({...t,depthTest:!1,depthWrite:!1,glslVersion:Af,vertexShader:"\n\t\t\t\tprecision highp float;\n\t\t\t\tin vec3 position;\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_Position = vec4(position, 1);\n\t\t\t\t}\n\t\t\t"})}customProgramCacheKey(){return""}};var PQ=new dv,TQ=96,DQ={shapeInput:()=>"\n\t\t\tconst float posRowCoord = 0.1;  // vec4: px py pz opType\n\t\t\tconst float quatRowCoord = 0.3;  // vec4: qx qy qz qw\n\t\t\tconst float param1RowCoord = 0.5;// vec4: type param1 param2 param3\n\t\t\tconst float param2RowCoord = 0.7;// vec4: blendRange roundness scale param4\n\t\t\tconst float colorRowCoord = 0.9; // vec4: r g b a\n\t\t\tuniform sampler2D shapesDataTexture;\n\t\t\tvec4 shapePos(float iin) { \n\t\t\t\tvec4 r = texture(shapesDataTexture, vec2(iin, posRowCoord));\n\t\t\t\treturn r;\n\t\t\t}\n\t\t\tvec4 shapeQuat(float iin) {\n\t\t\t\tvec4 r = texture(shapesDataTexture, vec2(iin, quatRowCoord));\n\t\t\t\treturn r;\n\t\t\t}\n\t\t\tvec4 shapeParams1(float iin) {\n\t\t\t\tvec4 r = texture(shapesDataTexture, vec2(iin, param1RowCoord));\n\t\t\t\treturn r;\n\t\t\t}\n\t\t\tvec4 shapeParams2(float iin) {\n\t\t\t\tvec4 r = texture(shapesDataTexture, vec2(iin, param2RowCoord));\n\t\t\t\treturn r;\n\t\t\t}\n\t\t\tvec4 shapeColor(float iin) {\n\t\t\t\tvec4 r = texture(shapesDataTexture, vec2(iin, colorRowCoord));\n\t\t\t\treturn r;\n\t\t\t}\n\t\t",getxyzi:"\n\t\t\t// this code must complement lookup\n\t\t\tfloat xi = mod(gl_FragCoord.x - 0.5, VOXEL_RESOLUTION);\n\t\t\tfloat yi = mod(gl_FragCoord.y - 0.5, VOXEL_RESOLUTION);\n\t\t\tfloat zi = floor((gl_FragCoord.x - 0.5) * INV_VOXEL_RESOLUTION) + floor((gl_FragCoord.y - 0.5) * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;\n\t\t",lookup:"\n\t\t\tuniform sampler2D potentialPassTexture;\n\t\t\tuniform sampler2D voxelPassTexture; // includes normal (in xyz) and key (in w)\n\t\t\t\n\t\t\t// box or marching cube lookup value in value texture, integer box coord inputs\n\t\t\t// this code must complement codebits.getxyzi\n\t\t\tvec4 look(float xi, float yi, float zi, sampler2D rt) {// range 0 .. numv etc\n\t\t\t\tvec2 uv = vec2(\n\t\t\t\t\tmod(zi, Z_LAYERS_PER_ROW) + (xi + 0.5) / VOXEL_RESOLUTION,\n\t\t\t\t\tfloor(zi / Z_LAYERS_PER_ROW) + (yi + 0.5) / VOXEL_RESOLUTION\n\t\t\t\t); \n\t\t\t\tuv /= Z_LAYERS_PER_ROW;\n\t\t\t\treturn texture(rt, uv);\n\t\t\t}\n\t\t",getpart:"\n\t\t\tfloat getpart(inout float a, float b) {\n\t\t\t\tfloat t = floor(a/b);\n\t\t\t\tfloat r = a - t*b;\n\t\t\t\ta = t;\n\t\t\t\treturn r;\n\t\t\t}\n\t\t",triTable:new Float32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,1,8,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,9,9,2,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,2,8,10,2,8,9,10,-1,-1,-1,-1,-1,-1,-1,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,0,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,1,11,9,1,11,8,9,-1,-1,-1,-1,-1,-1,-1,1,10,3,3,10,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,10,0,10,8,0,10,11,8,-1,-1,-1,-1,-1,-1,-1,0,9,3,9,11,3,9,10,11,-1,-1,-1,-1,-1,-1,-1,10,8,9,11,8,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,4,3,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,4,1,7,4,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,2,1,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,3,4,0,3,10,2,1,-1,-1,-1,-1,-1,-1,-1,10,2,9,2,0,9,7,4,8,-1,-1,-1,-1,-1,-1,-1,9,10,2,7,9,2,3,7,2,4,9,7,-1,-1,-1,-1,7,4,8,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,11,4,2,11,4,0,2,-1,-1,-1,-1,-1,-1,-1,1,0,9,7,4,8,11,3,2,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,9,2,11,9,1,2,9,-1,-1,-1,-1,1,10,3,10,11,3,4,8,7,-1,-1,-1,-1,-1,-1,-1,10,11,1,11,4,1,4,0,1,4,11,7,-1,-1,-1,-1,8,7,4,11,0,9,10,11,9,3,0,11,-1,-1,-1,-1,11,7,4,9,11,4,10,11,9,-1,-1,-1,-1,-1,-1,-1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,9,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,0,0,5,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,8,5,3,8,5,1,3,-1,-1,-1,-1,-1,-1,-1,10,2,1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,10,2,1,5,9,4,-1,-1,-1,-1,-1,-1,-1,10,2,5,2,4,5,2,0,4,-1,-1,-1,-1,-1,-1,-1,5,10,2,5,2,3,4,5,3,8,4,3,-1,-1,-1,-1,4,5,9,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,11,8,0,5,9,4,-1,-1,-1,-1,-1,-1,-1,4,5,0,5,1,0,11,3,2,-1,-1,-1,-1,-1,-1,-1,5,1,2,8,5,2,11,8,2,5,8,4,-1,-1,-1,-1,11,3,10,3,1,10,4,5,9,-1,-1,-1,-1,-1,-1,-1,5,9,4,1,8,0,1,10,8,10,11,8,-1,-1,-1,-1,0,4,5,11,0,5,10,11,5,3,0,11,-1,-1,-1,-1,8,4,5,10,8,5,11,8,10,-1,-1,-1,-1,-1,-1,-1,8,7,9,9,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,9,3,5,9,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,7,0,7,1,0,7,5,1,-1,-1,-1,-1,-1,-1,-1,3,5,1,7,5,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,9,7,5,9,2,1,10,-1,-1,-1,-1,-1,-1,-1,2,1,10,0,5,9,0,3,5,3,7,5,-1,-1,-1,-1,2,0,8,5,2,8,7,5,8,2,5,10,-1,-1,-1,-1,5,10,2,3,5,2,7,5,3,-1,-1,-1,-1,-1,-1,-1,5,9,7,9,8,7,2,11,3,-1,-1,-1,-1,-1,-1,-1,7,5,9,2,7,9,0,2,9,11,7,2,-1,-1,-1,-1,11,3,2,8,1,0,8,7,1,7,5,1,-1,-1,-1,-1,1,2,11,7,1,11,5,1,7,-1,-1,-1,-1,-1,-1,-1,8,5,9,7,5,8,3,1,10,11,3,10,-1,-1,-1,-1,0,7,5,9,0,5,0,11,7,10,0,1,0,10,11,-1,0,10,11,3,0,11,0,5,10,7,0,8,0,7,5,-1,5,10,11,5,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,0,9,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,8,9,1,6,10,5,-1,-1,-1,-1,-1,-1,-1,5,6,1,1,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,1,6,2,1,8,0,3,-1,-1,-1,-1,-1,-1,-1,5,6,9,6,0,9,6,2,0,-1,-1,-1,-1,-1,-1,-1,8,9,5,2,8,5,6,2,5,8,2,3,-1,-1,-1,-1,11,3,2,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,11,0,2,11,5,6,10,-1,-1,-1,-1,-1,-1,-1,9,1,0,11,3,2,6,10,5,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,9,1,2,11,9,11,8,9,-1,-1,-1,-1,11,3,6,3,5,6,3,1,5,-1,-1,-1,-1,-1,-1,-1,11,8,0,5,11,0,1,5,0,6,11,5,-1,-1,-1,-1,6,11,3,6,3,0,5,6,0,9,5,0,-1,-1,-1,-1,9,5,6,11,9,6,8,9,11,-1,-1,-1,-1,-1,-1,-1,6,10,5,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,3,7,4,10,5,6,-1,-1,-1,-1,-1,-1,-1,0,9,1,6,10,5,7,4,8,-1,-1,-1,-1,-1,-1,-1,5,6,10,7,9,1,3,7,1,4,9,7,-1,-1,-1,-1,2,1,6,1,5,6,8,7,4,-1,-1,-1,-1,-1,-1,-1,5,2,1,6,2,5,4,0,3,7,4,3,-1,-1,-1,-1,7,4,8,5,0,9,5,6,0,6,2,0,-1,-1,-1,-1,9,3,7,4,9,7,9,2,3,6,9,5,9,6,2,-1,2,11,3,4,8,7,5,6,10,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,7,4,0,2,4,11,7,2,-1,-1,-1,-1,9,1,0,8,7,4,11,3,2,6,10,5,-1,-1,-1,-1,1,2,9,2,11,9,11,4,9,4,11,7,6,10,5,-1,7,4,8,5,11,3,1,5,3,6,11,5,-1,-1,-1,-1,11,1,5,6,11,5,11,0,1,4,11,7,11,4,0,-1,9,5,0,5,6,0,6,3,0,3,6,11,7,4,8,-1,9,5,6,11,9,6,9,7,4,9,11,7,-1,-1,-1,-1,9,4,10,10,4,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,4,10,9,4,3,8,0,-1,-1,-1,-1,-1,-1,-1,1,0,10,0,6,10,0,4,6,-1,-1,-1,-1,-1,-1,-1,1,3,8,6,1,8,4,6,8,10,1,6,-1,-1,-1,-1,9,4,1,4,2,1,4,6,2,-1,-1,-1,-1,-1,-1,-1,8,0,3,9,2,1,9,4,2,4,6,2,-1,-1,-1,-1,4,2,0,6,2,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,4,2,8,6,2,4,-1,-1,-1,-1,-1,-1,-1,9,4,10,4,6,10,3,2,11,-1,-1,-1,-1,-1,-1,-1,2,8,0,11,8,2,10,9,4,6,10,4,-1,-1,-1,-1,2,11,3,6,1,0,4,6,0,10,1,6,-1,-1,-1,-1,1,4,6,10,1,6,1,8,4,11,1,2,1,11,8,-1,4,6,9,6,3,9,3,1,9,3,6,11,-1,-1,-1,-1,1,11,8,0,1,8,1,6,11,4,1,9,1,4,6,-1,6,11,3,0,6,3,4,6,0,-1,-1,-1,-1,-1,-1,-1,8,4,6,8,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,7,10,8,7,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,7,0,7,10,0,10,9,0,10,7,6,-1,-1,-1,-1,7,6,10,7,10,1,8,7,1,0,8,1,-1,-1,-1,-1,7,6,10,1,7,10,3,7,1,-1,-1,-1,-1,-1,-1,-1,6,2,1,8,6,1,9,8,1,7,6,8,-1,-1,-1,-1,9,6,2,1,9,2,9,7,6,3,9,0,9,3,7,-1,0,8,7,6,0,7,2,0,6,-1,-1,-1,-1,-1,-1,-1,2,3,7,2,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,3,2,8,6,10,9,8,10,7,6,8,-1,-1,-1,-1,7,0,2,11,7,2,7,9,0,10,7,6,7,10,9,-1,0,8,1,8,7,1,7,10,1,10,7,6,11,3,2,-1,1,2,11,7,1,11,1,6,10,1,7,6,-1,-1,-1,-1,6,9,8,7,6,8,6,1,9,3,6,11,6,3,1,-1,1,9,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,6,0,7,0,11,3,0,6,11,-1,-1,-1,-1,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,8,1,3,8,6,7,11,-1,-1,-1,-1,-1,-1,-1,2,1,10,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,8,0,3,7,11,6,-1,-1,-1,-1,-1,-1,-1,0,9,2,9,10,2,7,11,6,-1,-1,-1,-1,-1,-1,-1,7,11,6,3,10,2,3,8,10,8,9,10,-1,-1,-1,-1,3,2,7,7,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,7,0,6,7,0,2,6,-1,-1,-1,-1,-1,-1,-1,6,7,2,7,3,2,9,1,0,-1,-1,-1,-1,-1,-1,-1,2,6,1,6,8,1,8,9,1,6,7,8,-1,-1,-1,-1,6,7,10,7,1,10,7,3,1,-1,-1,-1,-1,-1,-1,-1,6,7,10,10,7,1,7,8,1,8,0,1,-1,-1,-1,-1,7,3,0,10,7,0,9,10,0,7,10,6,-1,-1,-1,-1,10,6,7,8,10,7,9,10,8,-1,-1,-1,-1,-1,-1,-1,4,8,6,6,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,3,6,0,3,6,4,0,-1,-1,-1,-1,-1,-1,-1,11,6,8,6,4,8,1,0,9,-1,-1,-1,-1,-1,-1,-1,6,4,9,3,6,9,1,3,9,6,3,11,-1,-1,-1,-1,4,8,6,8,11,6,1,10,2,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,0,3,11,6,0,6,4,0,-1,-1,-1,-1,8,11,4,11,6,4,9,2,0,9,10,2,-1,-1,-1,-1,3,9,10,2,3,10,3,4,9,6,3,11,3,6,4,-1,3,2,8,2,4,8,2,6,4,-1,-1,-1,-1,-1,-1,-1,2,4,0,2,6,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,4,3,2,6,4,2,8,3,4,-1,-1,-1,-1,4,9,1,2,4,1,6,4,2,-1,-1,-1,-1,-1,-1,-1,3,1,8,1,6,8,6,4,8,1,10,6,-1,-1,-1,-1,0,1,10,6,0,10,4,0,6,-1,-1,-1,-1,-1,-1,-1,3,6,4,8,3,4,3,10,6,9,3,0,3,9,10,-1,4,9,10,4,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,9,4,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,5,9,4,6,7,11,-1,-1,-1,-1,-1,-1,-1,1,0,5,0,4,5,11,6,7,-1,-1,-1,-1,-1,-1,-1,6,7,11,4,3,8,4,5,3,5,1,3,-1,-1,-1,-1,4,5,9,2,1,10,11,6,7,-1,-1,-1,-1,-1,-1,-1,7,11,6,10,2,1,3,8,0,5,9,4,-1,-1,-1,-1,11,6,7,10,4,5,10,2,4,2,0,4,-1,-1,-1,-1,8,4,3,4,5,3,5,2,3,2,5,10,6,7,11,-1,3,2,7,2,6,7,9,4,5,-1,-1,-1,-1,-1,-1,-1,4,5,9,6,8,0,2,6,0,7,8,6,-1,-1,-1,-1,2,6,3,6,7,3,0,5,1,0,4,5,-1,-1,-1,-1,8,2,6,7,8,6,8,1,2,5,8,4,8,5,1,-1,4,5,9,6,1,10,6,7,1,7,3,1,-1,-1,-1,-1,10,6,1,6,7,1,7,0,1,0,7,8,4,5,9,-1,10,0,4,5,10,4,10,3,0,7,10,6,10,7,3,-1,10,6,7,8,10,7,10,4,5,10,8,4,-1,-1,-1,-1,5,9,6,9,11,6,9,8,11,-1,-1,-1,-1,-1,-1,-1,11,6,3,3,6,0,6,5,0,5,9,0,-1,-1,-1,-1,8,11,0,11,5,0,5,1,0,11,6,5,-1,-1,-1,-1,3,11,6,5,3,6,1,3,5,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,5,9,8,11,9,6,5,11,-1,-1,-1,-1,3,11,0,11,6,0,6,9,0,9,6,5,10,2,1,-1,5,8,11,6,5,11,5,0,8,2,5,10,5,2,0,-1,3,11,6,5,3,6,3,10,2,3,5,10,-1,-1,-1,-1,9,8,5,8,2,5,2,6,5,2,8,3,-1,-1,-1,-1,6,5,9,0,6,9,2,6,0,-1,-1,-1,-1,-1,-1,-1,8,5,1,0,8,1,8,6,5,2,8,3,8,2,6,-1,6,5,1,6,1,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,3,1,10,6,1,6,8,3,9,6,5,6,9,8,-1,0,1,10,6,0,10,0,5,9,0,6,5,-1,-1,-1,-1,8,3,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,5,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,11,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,5,7,11,0,3,8,-1,-1,-1,-1,-1,-1,-1,7,11,5,11,10,5,0,9,1,-1,-1,-1,-1,-1,-1,-1,5,7,10,7,11,10,1,8,9,1,3,8,-1,-1,-1,-1,2,1,11,1,7,11,1,5,7,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,2,1,5,7,1,11,2,7,-1,-1,-1,-1,5,7,9,7,2,9,2,0,9,7,11,2,-1,-1,-1,-1,2,5,7,11,2,7,2,9,5,8,2,3,2,8,9,-1,10,5,2,5,3,2,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,2,8,2,5,8,5,7,8,5,2,10,-1,-1,-1,-1,1,0,9,3,10,5,7,3,5,2,10,3,-1,-1,-1,-1,2,8,9,1,2,9,2,7,8,5,2,10,2,5,7,-1,5,3,1,5,7,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,1,7,0,5,7,1,-1,-1,-1,-1,-1,-1,-1,3,0,9,5,3,9,7,3,5,-1,-1,-1,-1,-1,-1,-1,7,8,9,7,9,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,5,8,10,5,8,11,10,-1,-1,-1,-1,-1,-1,-1,4,0,5,0,11,5,11,10,5,0,3,11,-1,-1,-1,-1,9,1,0,10,4,8,11,10,8,5,4,10,-1,-1,-1,-1,4,11,10,5,4,10,4,3,11,1,4,9,4,1,3,-1,1,5,2,5,8,2,8,11,2,8,5,4,-1,-1,-1,-1,11,4,0,3,11,0,11,5,4,1,11,2,11,1,5,-1,5,2,0,9,5,0,5,11,2,8,5,4,5,8,11,-1,5,4,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,2,2,5,3,5,4,3,4,8,3,-1,-1,-1,-1,2,10,5,4,2,5,0,2,4,-1,-1,-1,-1,-1,-1,-1,2,10,3,10,5,3,5,8,3,8,5,4,9,1,0,-1,2,10,5,4,2,5,2,9,1,2,4,9,-1,-1,-1,-1,5,4,8,3,5,8,1,5,3,-1,-1,-1,-1,-1,-1,-1,5,4,0,5,0,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,4,8,3,5,8,5,0,9,5,3,0,-1,-1,-1,-1,5,4,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,11,4,11,9,4,11,10,9,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,9,4,7,11,9,11,10,9,-1,-1,-1,-1,11,10,1,4,11,1,0,4,1,11,4,7,-1,-1,-1,-1,4,1,3,8,4,3,4,10,1,11,4,7,4,11,10,-1,7,11,4,4,11,9,11,2,9,2,1,9,-1,-1,-1,-1,4,7,9,7,11,9,11,1,9,1,11,2,3,8,0,-1,4,7,11,2,4,11,0,4,2,-1,-1,-1,-1,-1,-1,-1,4,7,11,2,4,11,4,3,8,4,2,3,-1,-1,-1,-1,10,9,2,9,7,2,7,3,2,9,4,7,-1,-1,-1,-1,7,10,9,4,7,9,7,2,10,0,7,8,7,0,2,-1,10,7,3,2,10,3,10,4,7,0,10,1,10,0,4,-1,2,10,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,3,1,7,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,1,8,0,1,7,8,-1,-1,-1,-1,3,0,4,3,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,10,9,8,11,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,10,9,11,-1,-1,-1,-1,-1,-1,-1,10,1,0,8,10,0,11,10,8,-1,-1,-1,-1,-1,-1,-1,10,1,3,10,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,1,9,11,1,8,11,9,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,9,2,1,9,11,2,-1,-1,-1,-1,11,2,0,11,0,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,9,8,10,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,8,1,0,8,10,1,-1,-1,-1,-1,2,10,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),numTrisTable:new Float32Array([0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,2,3,4,4,3,3,4,4,3,4,5,5,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,2,3,3,4,3,4,2,3,3,4,4,5,4,5,3,2,3,4,4,3,4,5,3,2,4,5,5,4,5,2,4,1,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,2,4,3,4,3,5,2,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,3,4,4,3,4,5,5,4,4,3,5,2,5,4,2,1,2,3,3,4,3,4,4,5,3,4,4,5,2,3,3,2,3,4,4,5,4,5,5,2,4,3,5,4,3,2,4,1,3,4,4,5,4,5,3,4,4,5,5,2,3,4,2,1,2,3,3,2,3,4,2,1,3,2,4,1,2,1,1,0])},kQ=class extends xH{constructor(t,e,i){super(t,e,i),this.data=e,this.needsRebuild=!0,this.customDepthMaterialNeedsUpdate=!1,this._npart=-1,this.spatialn=1,this.drawRangeNeedsForceUpdate=!0,this._resolutionLevel=-1,this.resolution=64,this.spatialDivisions=25,this.zLayersPerRow=8,this.basePyramidSize=512,this.pyramidTexture1Width=341,this.pyramidTexture1Height=256,this.pyramidTexture2Width=170,this.pyramidTexture2Height=128,this.numLevels=9,this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=0,this.bboxOffset=0,this.shapesDataTexture={value:void 0},this.spatialscene=new sx,this.potentialPassScene=new sx,this.voxelPassScene=new sx,this._spatialPassRenderTargets=[],this._potentialPassRenderTargets=[],this._voxelPassRenderTargets=[],this._pyramidRenderTargets=[],this.geometry=new Hg,this.geometry.drawRange.count=0,this.spatialPassUniforms={span:{value:-1},shapesDataTexture:this.shapesDataTexture,npart:{value:this.npart},spatialn:{value:this.spatialn}},this.spatialMesh=new rv(CQ,this.spatialPassMaterial()),this.spatialMesh.frustumCulled=!1,this.spatialscene.add(this.spatialMesh);let n=new cx(DQ.triTable,16,256,tf,Xp);n.needsUpdate=!0;let r=new cx(DQ.numTrisTable,256,1,tf,Xp);r.needsUpdate=!0,this.voxelPassUniforms={potentialPassTexture:{value:void 0},numTrisTable:{value:r}},this.voxelMesh=new rv(CQ,this.voxelPassMaterial()),this.voxelMesh.frustumCulled=!1,this.voxelPassScene.add(this.voxelMesh),this.potentialPassUniforms={shapesDataTexture:this.shapesDataTexture,spatialPassTexture:{value:void 0},npart:{value:this.npart},spatialn:{value:this.spatialn}},this.potentialMesh=new rv(CQ,this.potentialPassMaterial()),this.potentialMesh.frustumCulled=!1,this.potentialPassScene.add(this.potentialMesh),this.marchPassUniforms={triTable:{value:n},potentialPassTexture:{value:void 0},voxelPassTexture:{value:void 0},pyramidTexture1:{value:void 0},pyramidTexture1Size:{value:void 0},pyramidTexture2:{value:void 0},pyramidTexture2Size:{value:void 0}},this.frustumCulled=!1,this.onBeforeShadowPass=t=>{if(VQ.call(this),0===this.npart)return void(this.geometry.drawRange.count=0);let e=this.material.root;if(e.shadersPatchedForShapeBlend){if(this.customDepthMaterialNeedsUpdate){this.customDepthMaterialNeedsUpdate=!1,this.customDepthMaterial=new uv({vertexShader:e.vertexShader,fragmentShader:"\n\t\t\t\t\t\t#include <packing>\n\t\t\t\t\t\tvoid main()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tgl_FragColor = packDepthToRGBA(gl_FragCoord.z);\n\t\t\t\t\t\t}\n\t\t\t\t\t",uniforms:e.uniforms,defines:this.material.defines}),this.isMeshDepthMaterial=!0,this.customDistanceMaterial=new uv({vertexShader:e.vertexShader,fragmentShader:"\n\t\t\t\t\t#include <common>\n\t\t\t\t\t#include <packing>\n\t\t\t\t\tuniform vec3 referencePosition;\n\t\t\t\t\tuniform float nearDistance;\n\t\t\t\t\tuniform float farDistance;\n\t\t\t\t\t// World-space position\n\t\t\t\t\tvarying vec3 vWPosition;\n\t\t\t\t\tvoid main()\n\t\t\t\t\t{\n\t\t\t\t\t\tfloat dist = length(vWPosition - referencePosition);\n\t\t\t\t\t\tdist = (dist - nearDistance) / (farDistance - nearDistance);\n\t\t\t\t\t\tdist = saturate(dist);\n\t\t\t\t\t\t// Required by Three.js for this to work\n\t\t\t\t\t\tgl_FragColor = packDepthToRGBA( dist );\n\t\t\t\t\t}",uniforms:{nearDistance:{value:0},farDistance:{value:0},referencePosition:{value:new mm},opacity:{value:0},...e.uniforms},defines:this.material.defines});let t=this.customDistanceMaterial;t.referencePosition=new mm,t.nearDistance=0,t.farDistance=0,t.opacity=1,t.isMeshDistanceMaterial=!0}}else this.patchVertexShaderForShapeBlend(e),e.shadersPatchedForShapeBlend=!0,this.customDepthMaterialNeedsUpdate=!0;if(this.spatialPassUniforms.npart.value=this.npart,this.spatialPassUniforms.spatialn.value=this.spatialn,this.potentialPassUniforms.npart.value=this.npart,this.potentialPassUniforms.spatialn.value=this.spatialn,this.needsRebuild){this.needsRebuild=!1,this.spatialMesh.material.defines.RES=this.resolutionLevel,this.spatialMesh.material.needsUpdate=!0,this.potentialMesh.material.defines.RES=this.resolutionLevel,this.potentialPassUniforms.spatialPassTexture.value=this.spatialPassRenderTarget.texture,this.potentialMesh.material.needsUpdate=!0,this.voxelMesh.material.defines.RES=this.resolutionLevel,this.voxelMesh.material.needsUpdate=!0,this.voxelPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.voxelPassTexture.value=this.voxelPassRenderTarget.texture[0],this.material.defines.RES=this.resolutionLevel,this.material.defines.LEVELS=this.pyramidLevelSizes.length,this.material.defines.LOOP=this.pyramidLevelSizes.length%2===0?this.pyramidLevelSizes.length-3:this.pyramidLevelSizes.length-2,this.material.defines.HALF=this.pyramidLevelSizes.length%2===0?1:0,this.material.needsUpdate=!0;let t=this.pyramidLevelSizes.length%2===0?0:1,e=this.pyramidLevelSizes.length%2===0?1:0;this.marchPassUniforms.pyramidTexture2.value=this.pyramidRenderTarget[t].texture,this.marchPassUniforms.pyramidTexture2Size.value=new Uf(this.pyramidRenderTarget[t].width,this.pyramidRenderTarget[t].height),this.marchPassUniforms.pyramidTexture1.value=this.pyramidRenderTarget[e].texture,this.marchPassUniforms.pyramidTexture1Size.value=new Uf(this.pyramidRenderTarget[e].width,this.pyramidRenderTarget[e].height),Object.assign(this.material.uniforms,this.marchPassUniforms)}let i=t.shadowMap.enabled;t.shadowMap.enabled=!1;let n=t.getRenderTarget();t.setRenderTarget(this.spatialPassRenderTarget),t.render(this.spatialscene,PQ),t.setRenderTarget(this.potentialPassRenderTarget),t.render(this.potentialPassScene,PQ),t.setRenderTarget(this.voxelPassRenderTarget),t.render(this.voxelPassScene,PQ),kQ.streamCompaction.renderPyramid(this.resolutionLevel,this.pyramidLevelSizes,t,this.voxelPassRenderTarget,this.pyramidRenderTarget).then((t=>{this.material.wireframe&&(3*t>this.geometry.attributes.position.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.dispose(),this.geometry=new Hg,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.geometry.attributes.position=new Rg(new Float32Array(3*t*2),3)),(3*t>this.geometry.drawRange.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.drawRange.count=3*Math.floor(1.2*t)),this.drawRangeNeedsForceUpdate=!1})),t.shadowMap.enabled=i,t.setRenderTarget(n)}}set npart(t){t!==this._npart&&(this.drawRangeNeedsForceUpdate=!0,this._npart=t,this.spatialn=Math.ceil(t/96))}get npart(){return this._npart}set resolutionLevel(t){let e=Math.min(8,Math.max(5,t));if(e!==this._resolutionLevel){switch(this._resolutionLevel=e,this.resolution=Math.pow(2,e),this.resolutionLevel){case 5:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192],this.bboxSize=496,this.bboxOffset=-8;break;case 6:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=504,this.bboxOffset=-4;break;case 7:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192,384,768,1536],this.bboxSize=508,this.bboxOffset=-2;break;case 8:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096],this.bboxSize=510,this.bboxOffset=-1}this.pyramidTexture1Width=0,this.pyramidTexture2Width=0,this.pyramidTexture1Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-2],this.pyramidTexture2Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-3];for(let t=this.pyramidLevelSizes.length-2;t>=0;t--)(this.pyramidLevelSizes.length-2)%2===t%2?this.pyramidTexture1Width+=this.pyramidLevelSizes[t]:this.pyramidTexture2Width+=this.pyramidLevelSizes[t];this.basePyramidSize=this.pyramidLevelSizes[this.pyramidLevelSizes.length-1],this.zLayersPerRow=this.basePyramidSize/this.resolution,this.numLevels=this.pyramidLevelSizes.length-1,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.needsRebuild=!0}}get resolutionLevel(){return this._resolutionLevel}get spatialPassRenderTarget(){let t=this._spatialPassRenderTargets[this.resolutionLevel];return t||(t=new um(this.spatialDivisions*this.spatialn,this.spatialDivisions**2,{format:Zp,type:Xp,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:Up,magFilter:Up}),this._spatialPassRenderTargets[this.resolutionLevel]=t),t}get potentialPassRenderTarget(){let t=this._potentialPassRenderTargets[this.resolutionLevel];return t||(t=new um(this.basePyramidSize,this.basePyramidSize,{format:Zp,type:Xp,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:Up,magFilter:Up}),this._potentialPassRenderTargets[this.resolutionLevel]=t),t}get voxelPassRenderTarget(){let t=this._voxelPassRenderTargets[this.resolutionLevel];return t||(t=new pm(this.basePyramidSize,this.basePyramidSize,2,{stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:Up,magFilter:Up}),t.texture[0].format=Zp,t.texture[0].type=Xp,t.texture[1].format=tf,t.texture[1].type=Xp,this._voxelPassRenderTargets[this.resolutionLevel]=t),t}get pyramidRenderTarget(){let t=this._pyramidRenderTargets[this.resolutionLevel];if(!t){t=[new um(this.pyramidTexture1Width,this.pyramidTexture1Height,{format:Zp,type:Xp,stencilBuffer:!1,depthBuffer:!1,magFilter:Up,minFilter:Up}),new um(this.pyramidTexture2Width,this.pyramidTexture2Height,{format:Zp,type:Xp,stencilBuffer:!1,depthBuffer:!1,magFilter:Up,minFilter:Up})],this._pyramidRenderTargets[this.resolutionLevel]=t}return t}updateState(t,e){let i=this.material;super.updateState(t,e),i!==this.material&&(this.needsRebuild=!0),t.geometry&&(this.resolutionLevel=t.geometry.resolutionLevel,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]}),t.wireframe&&!this.geometry.getAttribute("position")?this.geometry.setAttribute("position",new Rg(new Float32Array(3*this.geometry.drawRange.count),3)):!t.wireframe&&this.geometry.getAttribute("position")&&this.geometry.deleteAttribute("position")}spatialPassMaterial(){let t=`\n\t\t\tprecision highp float;\n\t\t\tout vec4 pc_FragColor;\n\t\t\tconst float spatialDivisions = ${this.spatialDivisions}.;\n\t\t\tuniform float span;\n\t\t\tuniform float npart;\n\t\t\tuniform float spatialn;\n\t\t\t${DQ.shapeInput()}\n\n\t\t\tvec3 low, high;     // range of current div; subset of -1 .. 1 with span border\n\n\t\t\t// lookup one element/channel's worth of spheres for current division\n\t\t\t// stating with low sphere number lowi\n\t\t\t// gives a key to which spheres from lowi..lowi+23 are active within given div (low..high)\n\t\t\tfloat spatialKey(float lowi) {\n\t\t\t\tfloat t = 0.;\n\t\t\t\tfor (float ii = 23.; ii >= 0.; ii--) {\n\t\t\t\t\tfloat i = ii + lowi;\n\t\t\t\t\tfloat iin = (i + 0.5) / 96.;\n\t\t\t\t\tvec4 shape = shapePos(iin);\n\t\t\t\t\tvec3 d = shape.xyz;\n\t\t\t\t\tfloat op = shape.w;\n\t\n\t\t\t\t\tt *= 2.;\n\t\t\t\t\tt += (\n\t\t\t\t\t\tlow.x < d.x && d.x < high.x &&\n\t\t\t\t\t\tlow.y < d.y && d.y < high.y &&\n\t\t\t\t\t\tlow.z < d.z && d.z < high.z &&\n\t\t\t\t\t\ti < npart || op == -2. // always include if op is -2, which is the intersection operation\n\t\t\t\t\t) ? 1. : 0.;\n\t\t\t\t}\n\t\t\t\treturn t;\n\t\t\t}\n\n\t\t\t${DQ.getpart}\n\n\t\t\tvoid main() {               // spatialial fragment shader\n\t\t\t\t// find active div\n\t\t\t\tvec3 div;                               // which div is current\n\t\t\t\t// out holds x=> x, lowi faster moving and y=> z, y faster moving\n\t\t\t\tfloat yz = float(gl_FragCoord.y - 0.5);     // contains  z, y faster moving\n\t\t\t\tdiv.y = getpart(yz, spatialDivisions);\n\t\t\t\tdiv.z = yz; // getpart(yz, spatialDivisions.z); // what's left, should be the same as getpart\n\n\t\t\t\tfloat lx = float(gl_FragCoord.x - 0.5);     // contains x, lowi faster moving\n\t\t\t\tfloat lowi = getpart(lx, spatialn) * 96.;\n\t\t\t\tdiv.x = lx;\n\n\t\t\t\tlow = div / spatialDivisions * 2. - 1. - span;\n\t\t\t\thigh = (div+1.) / spatialDivisions * 2. - 1. + span;\n\n\t\t\t\t// find active range of spheres\n\t\t\t\tpc_FragColor.x = spatialKey(lowi);\n\t\t\t\tpc_FragColor.y = spatialKey(lowi+24.);\n\t\t\t\tpc_FragColor.z = spatialKey(lowi+48.);\n\t\t\t\tpc_FragColor.w = spatialKey(lowi+72.);\n\t\t\t}\n\t\t`;return new MQ({name:"Spatial Pass",fragmentShader:t,uniforms:this.spatialPassUniforms})}potentialPassMaterial(){let t=`\n\t\t\tprecision highp float;\n\t\t\tout vec4 pc_FragColor;\n\n\t\t\t${DQ.shapeInput()}\n\t\t\tuniform sampler2D spatialPassTexture;\n\n\t\t\tconst float res = float(RES);\n\t\t\tconst float VOXEL_RESOLUTION = pow(2., res);\n\t\t\tconst float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));\n\t\t\tconst float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.;\n\t\t\tconst float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;\n\n\t\t\tuniform float npart;\n\t\t\tuniform float spatialn;\n\t\t\tconst float spatialDivisions = ${this.spatialDivisions}.;\n\t\t\tconst float spatialDivisions2 = spatialDivisions * spatialDivisions;\n\t\t\tconst float spatialDivisionsSub1 = spatialDivisions - 1.;\n\n\t\t\t${DQ.getpart}\n\n\t\t\tvec3 packRGBAToVec3(vec4 color) {\n\t\t\t\tuint r = uint(color.r * 255.);\n\t\t\t\tuint g = uint(color.g * 255.);\n\t\t\t\tuint combined = (r << 8) | g; \n\t\t\t\treturn vec3(float(combined) * 0.00001525902, color.b, color.a); // 1/65535\n\t\t\t}\n\n\t\t\tvoid applyQuaternionToVector(in vec4 q, inout vec3 v) {\n\t\t\t\tv += 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * SDF functions (reference: https://iquilezles.org/articles/distfunctions/)\n\t\t\t */\n\n\t\t\t// branchless version of "Smooth Union, Subtraction and Intersection - bound, bound, bound" in above reference\n\t\t\tfloat smoothOperation(float op, float sdf, float d, float k) {\n\t\t\t  //        union: op =  1 => signSubtract =  1, signIntersection =  1\n\t\t\t  //     subtract: op = -1 => signSubtract = -1, signIntersection =  1\n\t\t\t\t// intersection: op = -2 => signSubtract = -1, signIntersection = -1\n\n\t\t\t\tfloat signSubtract = clamp(op, -1., 1.);\n\t\t\t\tfloat signIntersection = 2. * (op - signSubtract) + 1.;\n\t\t\t\tfloat h = clamp(\n\t\t\t\t\t0.5 + signSubtract * 0.5 * (sdf - signSubtract * signIntersection * d) / k,\n\t\t\t\t\t0.0,\n\t\t\t\t\t1.0\n\t\t\t\t);\n\t\t\t\treturn mix(sdf, signSubtract * signIntersection * d, h) - \n\t\t\t\t\t\t\t signSubtract * k * h * (1.0 - h);\n\t\t\t}\n\n\t\t\tfloat sdSphere( vec3 p, float s )\n\t\t\t{\n\t\t\t\treturn length(p)-s;\n\t\t\t}\n\n\t\t\tfloat sdEllipsoid( vec3 p, vec3 r )\n\t\t\t{\n\t\t\t\tfloat k0 = length(p/r);\n\t\t\t\tfloat k1 = length(p/(r*r));\n\t\t\t\treturn k0*(k0-1.0)/k1;\n\t\t\t}\n\n\t\t\tfloat sdBox( vec3 p, vec3 b )\n\t\t\t{\n\t\t\t\tvec3 q = abs(p) - b;\n\t\t\t\treturn length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);\n\t\t\t}\n\n\t\t\tfloat sdTorus( vec3 p, vec2 t )\n\t\t\t{\n\t\t\t\tvec2 q = vec2(length(p.xy)-t.x,p.z);\n\t\t\t\treturn length(q)-t.y;\n\t\t\t}\n\n\t\t\tfloat sdCappedTorus( vec3 p, vec2 sc, float ra, float rb)\n\t\t\t{\n\t\t\t\tp.x = abs(p.x);\n\t\t\t\tfloat k = (sc.y*p.x>sc.x*p.y) ? dot(p.xy,sc) : length(p.xy);\n\t\t\t\treturn sqrt( dot(p,p) + ra*ra - 2.0*ra*k ) - rb;\n\t\t\t}\n\n\t\t\tfloat dot2( in vec2 v ) { return dot(v,v); }\n\t\t\tfloat sdCappedCone( vec3 p, float h, float r1, float r2 )\n\t\t\t{\n\t\t\t\tvec2 q = vec2( length(p.xz), p.y );\n\t\t\t\tvec2 k1 = vec2(r2,h);\n\t\t\t\tvec2 k2 = vec2(r2-r1,2.0*h);\n\t\t\t\tvec2 ca = vec2(q.x-min(q.x,(q.y<0.0)?r1:r2), abs(q.y)-h);\n\t\t\t\tvec2 cb = q - k1 + k2*clamp( dot(k1-q,k2)/dot2(k2), 0.0, 1.0 );\n\t\t\t\tfloat s = (cb.x<0.0 && ca.y<0.0) ? -1.0 : 1.0;\n\t\t\t\treturn s*sqrt( min(dot2(ca),dot2(cb)) );\n\t\t\t}\n\n\t\t\tfloat sdCappedCylinder( vec3 p, float h, float r )\n\t\t\t{\n\t\t\t\tvec2 d = abs(vec2(length(p.xz),p.y)) - vec2(r,h);\n\t\t\t\treturn min(max(d.x,d.y),0.0) + length(max(d,0.0));\n\t\t\t}\n\n\t\t\tfloat maxBlend = 0.0;\n\t\t\t// compute potential from A (=24) spheres, using the bit flags in 'activeKey'\n\t\t\t// to avoid lookup/compute for inactive spheres\n\t\t\t// return field potential, side effect updates track,\n\t\t\t// compute and return +ve and -ve values separately\n\t\t\tvoid fillSpatialInner(\n\t\t\t\tfloat ii,\n\t\t\t\tfloat activeKey,\n\t\t\t\tvec3 corner,\n\t\t\t\tinout float sdf,\n\t\t\t\tinout float colorDivisor,\n\t\t\t\tinout vec4 trackColor\n\t\t\t) {\n\t\t\t\tfor (float i = 0.; i < 24.; i++) {\n\t\t\t\t\tif (activeKey < 1.) break; // activeKey exhausted, no more active spheres\n\t\t\t\t\tactiveKey *= 0.5;\n\t\t\t\t\tif (fract(activeKey) < 0.5) continue;\n\n\t\t\t\t\tfloat iin = (i + ii + 0.5) * ${1/TQ};\n\t\t\t\t\tvec4 shape = shapePos(iin);\n\t\t\t\t\tvec4 quat = shapeQuat(iin);\n\t\t\t\t\tvec4 params1 = shapeParams1(iin);\n\t\t\t\t\tvec4 params2 = shapeParams2(iin);\n\n\t\t\t\t\tvec3 p = corner - shape.xyz;\n\t\t\t\t\tapplyQuaternionToVector(quat, p);\n\t\t\t\t\tp /= params2.z; // scale\n\t\t\t\t\tfloat d; // d in -1..1 coordinates\n\t\t\t\t\tswitch (int(params1.x)) {\n\t\t\t\t\t\tcase 0: d = sdSphere(p, params1.y); break;\n\t\t\t\t\t\tcase 1: d = sdEllipsoid(p, params1.yzw); break;\n\t\t\t\t\t\tcase 2: d = sdBox(p, params1.yzw); break;\n\t\t\t\t\t\tcase 3: d = sdCappedCylinder(p, params1.y, params1.z); break;\n\t\t\t\t\t\tcase 4: d = sdCappedCone(p, params1.y, params1.z, params1.w); break;\n\t\t\t\t\t\tcase 5: d = sdTorus(p, params1.yz); break;\n\t\t\t\t\t\tcase 6: d = sdCappedTorus(p, params1.yz, params1.w, params2.w); break;\n\t\t\t\t\t}\n\t\t\t\t\td -= params2.y; // rounded edge\n\t\t\t\t\td *= params2.z; // scale\n\n\t\t\t\t\tfloat k = params2.x;\n\t\t\t\t\tfloat op = shape.w;\n\n\t\t\t\t\tsdf = smoothOperation(shape.w, sdf, d, k);\n\n\t\t\t\t\tfloat isNegativeOne = step(-1.5, op) * step(op, -0.5); // 1 when op == -1, 0 otherwise\n\t\t\t\t\tfloat colorCull = smoothstep(maxBlend, 0., -d);\n\t\t\t\t\tfloat cullFactor = mix(1.0, colorCull, isNegativeOne);\n\t\t\t\t\ttrackColor *= cullFactor;\n\t\t\t\t\tcolorDivisor *= cullFactor;\n\n\t\t\t\t\tmaxBlend = max(maxBlend, k);\n\n\t\t\t\t\tk += 2. * INV_VOXEL_RESOLUTION; // avoid division by zero, and other color artifacts with very small k\n\t\t\t\t\tfloat nearness = smoothstep(k, 0., d);\n\n\t\t\t\t\tvec4 color = shapeColor(iin);\n\t\t\t\t\tnearness *= float(color.a >= 0.);\n\n\t\t\t\t\tcolorDivisor += nearness;\n\t\t\t\t\ttrackColor += color * nearness;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvec3 div;\n\t\t\t// compute potential from all spheres; collect +ve and =ve values separately\n\t\t\t// work in blocks of A*4 (=96) spheres, using the bit flags in 4 float channel 'activeKey' values\n\t\t\t// TODO check if extra vec3 output useful, not really used at present\n\t\t\tfloat fillSpatial(vec3 corner, inout vec4 trackColor) {\n\t\t\t\tfloat sdf = 1e3; // hack: initialize to large value\n\t\t\t\tfloat colorDivisor = 0.;\n\t\t\t\t// spatialPassTexture holds x=> lowi, x faster moving and y=> z, y faster moving\n\t\t\t\tfloat divyz = (div.y + div.z * spatialDivisions + 0.5) / (spatialDivisions2);\n\t\t\t\tfor (float ii = 0.; ii < spatialn; ii++) {\n\t\t\t\t\tfloat i = ii * 96.;\n\n\t\t\t\t\tvec4 activeKey = texture(spatialPassTexture, vec2((div.x * spatialn + ii + 0.5)/(spatialn * spatialDivisions), divyz));\n\t\t\t\t\tfillSpatialInner(i, activeKey.x, corner, sdf, colorDivisor, trackColor);\n\t\t\t\t\tfillSpatialInner(i+24., activeKey.y, corner, sdf, colorDivisor, trackColor);\n\t\t\t\t\tfillSpatialInner(i+48., activeKey.z, corner, sdf, colorDivisor, trackColor);\n\t\t\t\t\tfillSpatialInner(i+72., activeKey.w, corner, sdf, colorDivisor, trackColor);\n\t\t\t\t}\n\n\t\t\t\ttrackColor /= colorDivisor;\n\t\t\t\treturn mix(sdf, 0.0, step(1e20 - 0.1, sdf));\n\t\t\t}\n\n\t\t\tvoid main() {\n\t\t\t\t${DQ.getxyzi}    // get xi yi zi from 2d position\n\n\t\t\t\tvec3 xyzi = vec3(xi,yi,zi);\n\t\t\t\tvec3 corner = xyzi / VOXEL_RESOLUTION_SUB1 * 2. - 1.;  // -1..1 coords\n\n\t\t\t\tdiv = floor(xyzi / VOXEL_RESOLUTION_SUB1 * spatialDivisionsSub1);\n\n\t\t\t\tvec4 c = vec4(0.);\n\t\t\t\tfloat t = fillSpatial(corner, c);\n\n\t\t\t\tpc_FragColor = vec4(t, packRGBAToVec3(c)); // RGB texture\n\t\t\t}\n\t\t`;return new MQ({name:"PotentialPass",fragmentShader:t,uniforms:this.potentialPassUniforms})}voxelPassMaterial(){let t=`\n\t\t\tprecision highp float;\n\t\t\tlayout(location = 0) out vec4 pc_FragColor;\n\t\t\tlayout(location = 1) out vec4 numTris;\n\n\t\t\tconst float res = float(RES);\n\t\t\tconst float VOXEL_RESOLUTION = pow(2., res);\n\t\t\tconst float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.; \n\t\t\tconst float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));\n\t\t\tconst float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;\n\t\t\tuniform sampler2D numTrisTable; // 256 x 1\n\n\t\t\tfloat keyi(float f000, float f100, float f010, float f110, float f001, float f101, float f011, float f111) {\n\t\t\t\treturn (float(f000 < 0.) * 1.) +\n\t\t\t\t\t\t\t (float(f100 < 0.) * 2.) +\n\t\t\t\t\t\t\t (float(f010 < 0.) * 8.) +\n\t\t\t\t\t\t\t (float(f110 < 0.) * 4.) +\n\t\t\t\t\t\t\t (float(f001 < 0.) * 16.) +\n\t\t\t\t\t\t\t (float(f101 < 0.) * 32.) +\n\t\t\t\t\t\t\t (float(f011 < 0.) * 128.) +\n\t\t\t\t\t\t\t (float(f111 < 0.) * 64.);\n\t\t\t}\n\n\t\t\t${DQ.lookup}\n\n\t\t\tvec3 compNormi(float xi, float yi, float zi) {\n\t\t\t\tfloat dx = look(xi + 1., yi, zi, potentialPassTexture).r - look(xi - 1., yi, zi, potentialPassTexture).r;\n\t\t\t\tfloat dy = look(xi, yi + 1., zi, potentialPassTexture).r - look(xi, yi - 1., zi, potentialPassTexture).r;\n\t\t\t\tfloat dz = look(xi, yi, zi + 1., potentialPassTexture).r - look(xi, yi, zi - 1., potentialPassTexture).r;\n\t\t\t\t// if we allow (common) 0,0,0 case through then NaN can spread\n\t\t\t\t// eg r = vec4(compNorm i(???), 1.) will pollute r.w\n\t\t\t\tif (dx == 0.0 && dy == 0.0 && dz == 0.0) {\n\t\t\t\t\treturn vec3(0.199, 0.299, 0.399);\n\t\t\t\t}\n\t\t\t\treturn normalize(vec3(dx, dy, dz));\n\t\t\t}\n\n\t\t\tvoid main() {\n\t\t\t\t${DQ.getxyzi}    // get xi yi zi from 2d\n\n\t\t\t\tvec3 normal = compNormi(xi, yi, zi);  // even if our key is -1 this may be needed by a neighbouring voxel\n\n\t\t\t\tif (xi >= VOXEL_RESOLUTION_SUB1 || yi >= VOXEL_RESOLUTION_SUB1 || zi >= VOXEL_RESOLUTION_SUB1) {\n\t\t\t\t\tpc_FragColor = vec4(normal, 0.);\n\t\t\t\t\tnumTris = vec4(0.);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfloat\n\t\t\t\t\tf000 = look(xi, yi, zi, potentialPassTexture).r,\n\t\t\t\t\tf100 = look(xi+1., yi, zi, potentialPassTexture).r,\n\t\t\t\t\tf010 = look(xi, yi+1., zi, potentialPassTexture).r,\n\t\t\t\t\tf110 = look(xi+1., yi+1., zi, potentialPassTexture).r,\n\t\t\t\t\tf001 = look(xi, yi, zi+1., potentialPassTexture).r,\n\t\t\t\t\tf101 = look(xi+1., yi, zi+1., potentialPassTexture).r,\n\t\t\t\t\tf011 = look(xi, yi+1., zi+1., potentialPassTexture).r,\n\t\t\t\t\tf111 = look(xi+1., yi+1., zi+1., potentialPassTexture).r;\n\t\t\t\tfloat key = keyi(f000, f100, f010, f110, f001, f101, f011, f111);\n\n\t\t\t\tpc_FragColor = vec4(normal, key);\n\n\t\t\t\tnumTris = texture(numTrisTable, vec2((key + 0.5) / 256., 0.5));\n\t\t\t}\n\t\t`;return new MQ({name:"VoxelPass",fragmentShader:t,uniforms:this.voxelPassUniforms})}patchVertexShaderForShapeBlend(t){let e=`\n\t\t#ifdef SHAPEBLEND \n\t\t\tprecision highp sampler2D;\n\n\t\t\tuniform float isol;\n\n\t\t\tuniform sampler2D triTable;     // 256 x 16\n\t\t\tuniform sampler2D pyramidTexture1;\n\t\t\tuniform vec2 pyramidTexture1Size;\n\t\t\tuniform sampler2D pyramidTexture2;\n\t\t\tuniform vec2 pyramidTexture2Size;\n\n\t\t\tconst vec2 halfPixelOffset = vec2(0.5, 0.5);\n\n\t\t\tconst vec2 rShift = vec2(0., 1.);\n\t\t\tconst vec2 gShift = vec2(1., 1.);\n\t\t\tconst vec2 bShift = vec2(1., 0.);\n\n\t\t\tconst float res = float(RES);\n\t\t\tconst float VOXEL_RESOLUTION = pow(2., res);\n\t\t\tconst float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));\n\t\t\tconst float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;\n\n\t\t\tconst float scale_factor = 2.;\n\n\t\t\t#if SHAPEBLEND == 5\n\t\t\t\tconst float levelShiftX[7] = float[7](4., 6., 12., 24., 48., 96., 192.);\n\t\t\t\tconst float scale = 8. * scale_factor;\n\t\t\t\tconst vec3 originOffset = vec3(16.);\n\t\t\t#elif SHAPEBLEND == 7\n\t\t\t\tconst float levelShiftX[10] = float[10](4., 6., 12., 24., 48., 96., 192., 384., 768., 1536.); \n\t\t\t\tconst float scale = 2. * scale_factor;\n\t\t\t\tconst vec3 originOffset = vec3(64.);\n\t\t\t#elif SHAPEBLEND == 8\n\t\t\t\tconst float levelShiftX[11] = float[11](4., 8., 16., 32., 64., 128., 256., 512., 1024., 2048., 4096.);\n\t\t\t\tconst float scale = scale_factor;\n\t\t\t\tconst vec3 originOffset = vec3(128.);\n\t\t\t#else\n\t\t\t\tconst float levelShiftX[8] = float[8](4., 8., 16., 32., 64., 128., 256., 512.);\n\t\t\t\tconst float scale = 4. * scale_factor;\n\t\t\t\tconst vec3 originOffset = vec3(32.);\n\t\t\t#endif\n\n\t\t\t${DQ.lookup}\n\n\t\t\tconst vec3 offsets[24] = vec3[](\n\t\t\t\tvec3(0., 0., 0.), vec3(1., 0., 0.),\n\t\t\t\tvec3(1., 0., 0.), vec3(1., 1., 0.),\n\t\t\t\tvec3(0., 1., 0.), vec3(1., 1., 0.),\n\t\t\t\tvec3(0., 0., 0.), vec3(0., 1., 0.),\n\t\t\t\tvec3(0., 0., 1.), vec3(1., 0., 1.),\n\t\t\t\tvec3(1., 0., 1.), vec3(1., 1., 1.),\n\t\t\t\tvec3(0., 1., 1.), vec3(1., 1., 1.),\n\t\t\t\tvec3(0., 0., 1.), vec3(0., 1., 1.),\n\t\t\t\tvec3(0., 0., 0.), vec3(0., 0., 1.),\n\t\t\t\tvec3(1., 0., 0.), vec3(1., 0., 1.),\n\t\t\t\tvec3(1., 1., 0.), vec3(1., 1., 1.),\n\t\t\t\tvec3(0., 1., 0.), vec3(0., 1., 1.)\n\t\t\t);\n\n\t\t\tvec2 computeShiftedPosition1(vec2 xy, float levelOriginX) {\n\t\t\t\tvec2 xyShifted = xy;\n\t\t\t\txyShifted.x += levelOriginX;\n\t\t\t\treturn (xyShifted + halfPixelOffset) / pyramidTexture1Size;\n\t\t\t}\n\n\t\t\tvec2 computeShiftedPosition2(vec2 xy, float levelOriginX) {\n\t\t\t\tvec2 xyShifted = xy;\n\t\t\t\txyShifted.x += levelOriginX;\n\t\t\t\treturn (xyShifted + halfPixelOffset) / pyramidTexture2Size;\n\t\t\t}\n\n\t\t\tvec4 unpackVec3ToRGBA(vec3 vec) {\n\t\t\t\tuint combined = uint(vec.x * 65535.0 + 0.5); // Add 0.5 for rounding\n\t\t\t\tfloat g = float(combined & uint(0xFF)) * 0.00392156862; // 1/255\n\t\t\t\tfloat r = float((combined >> 8) & uint(0xFF)) * 0.00392156862; \n\t\t\n\t\t\t\treturn vec4(r, g, vec.y, vec.z);\n\t\t\t}\n\n\t\t\tout vec4 marchColor;\n\t\t\t// end of marchvertPre\n\t\t#endif\n\t\t`;t.vertexShader=e+t.vertexShader.replace("#include <project_vertex>","\n\t\t#ifdef SHAPEBLEND\n\t\t\tfloat triIndex = floor(float(gl_VertexID/3));\n\t\t\tfloat vertexIndex = float(gl_VertexID);\n\t\t\t\n\t\t\t// Initial pyramid lookup\n\t\t\tfloat levelOriginX1 = pyramidTexture1Size.x - 2.;\n\t\t\tfloat levelOriginX2 = pyramidTexture2Size.x - 1.;\n\t\t\tvec2 xy = vec2(0.);\n\t\t\tvec4 lookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));\n\t\t\t\n\t\t\t// Early exit check\n\t\t\tif (triIndex >= lookUp.r) return;\n\t\t\t\n\t\t\t// Optimize loop variables\n\t\t\tfloat start = 0.;\n\t\t\tvec4 triIndexVec = vec4(triIndex);\n\t\t\t\n\t\t\t// Main position computation loop\n\t\t\tfor (int i = 0; i < LOOP;) {\n\t\t\t\t// Compute boundaries\n\t\t\t\tvec4 ends = lookUp + vec4(start);\n\t\t\t\tvec4 starts = vec4(ends.gba, start);\n\t\t\t\tvec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * \n\t\t\t\t\t\t\t\t\t\t\tvec4(lessThan(triIndexVec, ends));\n\t\t\t\t\n\t\t\t\t// Update position\n\t\t\t\txy *= 2.;\n\t\t\t\txy += check.r * rShift + check.g * gShift + check.b * bShift;\n\t\t\t\t\n\t\t\t\t// Update loop variables\n\t\t\t\tstart = dot(check, starts);\n\t\t\t\tlevelOriginX2 -= levelShiftX[i];\n\t\t\t\t\n\t\t\t\t// Update lookup\n\t\t\t\tlookUp = texture(pyramidTexture1, computeShiftedPosition1(xy, levelOriginX1));\n\t\t\t\ti++;\n\n\t\t\t\tends = lookUp + vec4(start);\n\t\t\t\tstarts = vec4(ends.gba, start);\n\t\t\t\tcheck = vec4(greaterThanEqual(triIndexVec, starts)) * \n\t\t\t\t\t\t\t\t\t\t\tvec4(lessThan(triIndexVec, ends));\n\t\t\t\t\n\t\t\t\t// Update position\n\t\t\t\txy *= 2.;\n\t\t\t\txy += check.r * rShift + check.g * gShift + check.b * bShift;\n\t\t\t\t\n\t\t\t\t// Update loop variables\n\t\t\t\tstart = dot(check, starts);\n\t\t\t\tlevelOriginX1 -= levelShiftX[i];\n\t\t\t\t\n\t\t\t\t// Update lookup\n\t\t\t\tlookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));\n\n\t\t\t\ti++;\n\t\t\t}\n\n\t\t\t#if HALF == 1\n\t\t\t\tvec4 ends = lookUp + vec4(start);\n\t\t\t\tvec4 starts = vec4(ends.gba, start);\n\t\t\t\tvec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * vec4(lessThan(triIndexVec, ends));\n\t\t\t\n\t\t\t\t// Update position\n\t\t\t\txy *= 2.;\n\t\t\t\txy += check.r * rShift + check.g * gShift + check.b * bShift;\n\t\t\t\n\t\t\t\t// Update loop variables\n\t\t\t\tstart = dot(check, starts);\n\t\t\t#endif\n\t\t\t\n\t\t\t// Compute final coordinates\n\t\t\tvec3 gridPos;\n\t\t\tgridPos.x = mod(xy.x, VOXEL_RESOLUTION);\n\t\t\tgridPos.y = mod(xy.y, VOXEL_RESOLUTION);\n\t\t\tgridPos.z = floor(xy.x * INV_VOXEL_RESOLUTION) + \n\t\t\t\t\t\t\t\t\tfloor(xy.y * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;\n\t\t\t\n\t\t\t// Vertex key computation\n\t\t\tvertexIndex -= start * 3.;\n\t\t\tfloat vk = vertexIndex * 0.0625 + 0.03125; // Optimized division by 16 and addition of 1/32\n\t\t\t\n\t\t\t// Voxel lookup and edge computation\n\t\t\tvec4 voxel = look(gridPos.x, gridPos.y, gridPos.z, voxelPassTexture);\n\t\t\tfloat key = (voxel.w + 0.5) * 0.00390625; // Optimized division by 256\n\t\t\t\n\t\t\t// Edge lookup and offset computation\n\t\t\tfloat edgeNum = texture(triTable, vec2(vk, key)).x;\n\t\t\tint edgeIndex = int(edgeNum) * 2;\n\t\t\t\n\t\t\t// Compute edge positions\n\t\t\tvec3 p1 = gridPos + offsets[edgeIndex];\n\t\t\tvec3 p2 = gridPos + offsets[edgeIndex + 1];\n\t\t\t\n\t\t\t// Compute potentials and normals\n\t\t\tvec4 potential1 = look(p1.x, p1.y, p1.z, potentialPassTexture);\n\t\t\tvec4 potential2 = look(p2.x, p2.y, p2.z, potentialPassTexture);\n\t\t\t\n\t\t\t// Final position and normal computation\n\t\t\tfloat mu = potential1.r / (potential1.r - potential2.r);\n\n\t\t\tmarchColor = mix(\n\t\t\t\tunpackVec3ToRGBA(potential1.gba),\n\t\t\t\tunpackVec3ToRGBA(potential2.gba),\n\t\t\t\tmu\n\t\t\t);\n\n\t\t\ttransformed = p1 + (p2 - p1) * mu;\n\t\t\ttransformed -= originOffset;\n\t\t\ttransformed *= scale;\n\t\t\tvec4 data1 = look(p1.x, p1.y, p1.z, voxelPassTexture);\n\t\t\tvec4 data2 = look(p2.x, p2.y, p2.z, voxelPassTexture);\n\t\t\tobjectNormal = normalize(mix(data1.xyz, data2.xyz, mu));\n\t\t\ttransformedNormal = normalMatrix * objectNormal;\n\t\t\t#ifndef FLAT_SHADED\n\t\t\t\tvNormal = transformedNormal;\n\t\t\t#endif\n\t\t#endif\n\t\t\n#include <project_vertex>");let i=t.fragmentShader.match(/vec3 diffuseColor[^\n]*\n/);if(!i)return;let n=`\n\t\t#ifdef SHAPEBLEND_C\n\t\t\t#if SHAPEBLEND_C == 1\n\t\t\t\t${i[0].replace(/nodeU0,/g,"marchColor.rgb,").replace(/nodeU\d+(?=,g_uid\d+_calpha\))/g,"marchColor.a")}\n\t\t\t#else\n\t\t\t\t${i[0]}\n\t\t\t#endif\n\t\t#else\n\t\t\t${i[0]}\n\t\t#endif\n\t\t`;t.fragmentShader="in vec4 marchColor;\n"+t.fragmentShader.replace(i[0],n),Object.assign(t.uniforms,this.marchPassUniforms)}initDebugPass(t){console.log("fboToDebug.width",t.width,t.height),this.geometry=new Mv(t.width,t.height),this.geometry.userData={parameters:{width:4,height:4}};let e={inputTexture:{value:Array.isArray(t.texture)?t.texture[1]:t.texture},pyramidTextureSize:{value:void 0}},i=t=>{t.vertexShader="\n\t\t\t\tprecision highp float;\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t\t\tvUv = uv;\n\t\t\t\t}\n\t\t\t",t.fragmentShader="\n\t\t\t\tlayout(location = 1) out vec4 gVelocity;\n\n\t\t\t\tprecision highp float;\n\t\t\t\t\n\t\t\t\tuniform sampler2D inputTexture;\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\tuniform vec2 pyramidTextureSize;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\t\t// Sample the input texture using UV coordinates\n\t\t\t\t\t\tgl_FragColor = texture(inputTexture, vUv);\n\t\t\t\t\t\tgVelocity = vec4(0.0);\n\t\t\t\t}\n\t\t\t",e.pyramidTextureSize.value=new Uf(this.pyramidRenderTarget.width,this.pyramidRenderTarget.height),Object.assign(t.uniforms,e)};this.material.shapeBlendhack=i,this.material.root.shapeBlendhack=i}},IQ=kQ;IQ.streamCompaction=new class{constructor(){this.pyramidPassScene=new sx,this.pyramidPassMaterial=new MQ({name:"PyramidPass"}),this.pyramidPassUniforms={inputTexture:{value:void 0},inputWidth:{value:0},inputHeight:{value:0},inputShiftX:{value:0},outputShiftX:{value:0}},this.pyramidTopLevelReadPixelBuffer=new Float32Array(4);this.pyramidPassMaterial.fragmentShader="\n\t\t\tprecision highp float;\n\t\t\tprecision highp sampler2D;\n\t\t\tlayout(location = 0) out vec4 pc_FragColor;\n\t\t\tuniform sampler2D inputTexture;\n\t\t\tuniform float inputWidth;\n\t\t\tuniform float inputHeight;\n\t\t\tuniform float inputShiftX;\n\t\t\tuniform float outputShiftX;\n\t\t\tconst vec2 half_unit_coord = vec2(0.5);\n\t\t\tconst vec4 one = vec4(1.0);\n\t\t\tvoid main() {\n\t\t\t\tvec2 inputSize = vec2(inputWidth, inputHeight);\n\t\t\t\tvec2 input_pixel_uv = 1. / inputSize;\n\t\t\t\tvec2 coord = gl_FragCoord.xy - half_unit_coord;\n\t\t\t\tcoord.x -= outputShiftX;\n\t\t\t\tcoord = coord * 2. + half_unit_coord;\n\t\t\t\tcoord.x += inputShiftX;\n\n\t\t\t\t// sample bottom left corner\n\t\t\t\tvec2 input_uv = coord / inputSize;\n\t\t\t\tfloat bl = texture(inputTexture, input_uv).r;\n\n\t\t\t\t// sample bottom right corner\n\t\t\t\tinput_uv.x += input_pixel_uv.x;\n\t\t\t\tfloat br = texture(inputTexture, input_uv).r;\n\n\t\t\t\t// sample top right corner\n\t\t\t\tinput_uv.y += input_pixel_uv.y;\n\t\t\t\tfloat tr = texture(inputTexture, input_uv).r;\n\n\t\t\t\t// sample top left corner\n\t\t\t\tinput_uv.x -= input_pixel_uv.x;\n\t\t\t\tfloat tl = texture(inputTexture, input_uv).r;\n\n\t\t\t\tpc_FragColor.a = bl;\n\t\t\t\tpc_FragColor.b = pc_FragColor.a + br;\n\t\t\t\tpc_FragColor.g = pc_FragColor.b + tr;\n\t\t\t\tpc_FragColor.r = pc_FragColor.g + tl; \n\t\t\t}\n\t\t",this.pyramidPassMaterial.uniforms=this.pyramidPassUniforms,this.pyramidPassMaterial.depthTest=!1,this.pyramidPassMaterial.depthWrite=!1;let t=new rv(CQ,this.pyramidPassMaterial);t.frustumCulled=!1,this.pyramidPassScene.add(t)}renderPyramid(t,e,i,n,r){(new JS).min.setScalar(0);let s=e.length-1,a=new cm;i.getViewport(a),this.pyramidPassUniforms.inputShiftX.value=0,this.pyramidPassUniforms.outputShiftX.value=0;let o=s-1;for(let h=o;h>=0;h--){let s=h%2===o%2?r[0]:r[1],a=h===o?n:h%2===o%2?r[1]:r[0];this.pyramidPassUniforms.inputTexture.value=Array.isArray(a.texture)?a.texture[1]:a.texture,this.pyramidPassUniforms.inputWidth.value=a.width,this.pyramidPassUniforms.inputHeight.value=a.height,i.setRenderTarget(s);let l=e[h],c=i.getPixelRatio();i.setViewport(this.pyramidPassUniforms.outputShiftX.value/c,0,l/c,l/c),2===h&&t%2!==0&&i.setViewport(this.pyramidPassUniforms.outputShiftX.value/c,0,3/c,3/c),i.render(this.pyramidPassScene,PQ);let u=this.pyramidPassUniforms.inputShiftX.value;this.pyramidPassUniforms.inputShiftX.value=this.pyramidPassUniforms.outputShiftX.value,this.pyramidPassUniforms.outputShiftX.value=u,h<o&&(this.pyramidPassUniforms.outputShiftX.value+=e[h+1])}i.setViewport(a);let l=e.length%2===0?0:1;return i.readRenderTargetPixelsAsync(r[l],r[l].width-1,0,1,1,this.pyramidTopLevelReadPixelBuffer).then((()=>this.pyramidTopLevelReadPixelBuffer[0]))}};var RQ=new Wm,OQ=new Wm,LQ=new fm,BQ=new mm,zQ=new mm,FQ=new fm;function NQ(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.children.length;for(;i--;){let n=this.children[i];_B.is(n)&&UQ.call(n,t,e+1)}}function UQ(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!0!==t(this,e)){let i=this.children.length;for(;i--;){let n=this.children[i];_B.is(n)&&UQ.call(n,t,e+1)}}}function VQ(){if(void 0===this.shapesDataTexture.value){let t=new cx(new Float32Array(1920),TQ,5,Zp,Xp);this.shapesDataTexture.value=t}let t=this.shapesDataTexture.value,e=t.image.data;t.needsUpdate=!0;let i=0,n=this.data.geometry.blendRange,r=RQ.copy(this.matrixWorld).invert(),s=0;NQ.call(this,(t=>{if(!1===t.visible)return!0;let a;if(t instanceof hW)return;if(t instanceof HW||t instanceof AQ)return;a=t instanceof LB?t.object:t;let o=t.data?.cloner;if(IB.is(t)&&o&&!o.hideBase&&"radial"!==o.type&&!0!==o.disabled||!(a instanceof xH))return;let l=a.geometry.userData.parameters,h=l.shapeBlendNode;if(void 0===h)return;if(OQ.multiplyMatrices(r,t.matrixWorld).decompose(zQ,LQ,BQ),"TorusGeometry"===l.type&&360!==l.arc){let t=l.arc*Math.PI/180;t/=4,LQ.multiply(FQ.set(0,0,Math.sin(t),Math.cos(t)))}let c=h.overrideGlobalBlend?h.blendRange:n;c=c/this.bboxSize*2,e[4*s]=(zQ.x-this.bboxOffset)/this.bboxSize*2,e[4*s+1]=(zQ.y-this.bboxOffset)/this.bboxSize*2,e[4*s+2]=(zQ.z-this.bboxOffset)/this.bboxSize*2,e[4*s+3]=0===h.operation?1:2===h.operation?-1:-2,e[384+4*s]=-LQ.x,e[384+4*s+1]=-LQ.y,e[384+4*s+2]=-LQ.z,e[384+4*s+3]=LQ.w;let u=new Float32Array(4),d=0;if("SphereGeometry"===l.type)l.width===l.height&&l.width===l.depth?u[0]=0:u[0]=1,u[1]=l.width/this.bboxSize,u[2]=l.height/this.bboxSize,u[3]=l.depth/this.bboxSize,i=Math.max(i,u[1]*BQ.x+c,u[2]*BQ.x+c,u[3]*BQ.x+c);else if("CubeGeometry"===l.type){d=l.cornerRadius;let t=l.width,e=l.height,n=l.depth;u[0]=2,u[1]=(t-2*d)/this.bboxSize,u[2]=(e-2*d)/this.bboxSize,u[3]=(n-2*d)/this.bboxSize,i=Math.max(i,Math.sqrt(t**2+e**2+n**2)/this.bboxSize*BQ.x+c)}else if("CylinderGeometry"===l.type){d=l.cornerRadius;let t=l.height,e=l.radiusBottom,n=l.radiusTop;if(n>=e){let i=Math.atan2(n-e,t),r=(Math.PI/2-i)/2;n-=d/Math.tan(r),e-=d*Math.tan(r)}else if(e>n){let i=Math.atan2(e-n,t),r=(Math.PI/2-i)/2;n-=d*Math.tan(r),e-=d/Math.tan(r)}u[1]=(l.height-2*d)/this.bboxSize,e===n?(u[0]=3,u[2]=e/this.bboxSize*2):(u[0]=4,u[2]=e/this.bboxSize*2,u[3]=n/this.bboxSize*2),i=Math.max(i,4*u[1]*BQ.x+c)}else if("TorusGeometry"===l.type){if(u[0]=5,u[1]=(l.width-l.depth)/this.bboxSize,u[2]=l.depth/this.bboxSize,360!==l.arc){u[0]=6,u[3]=u[1],e[1152+4*s+3]=u[2];let t=2*Math.atan2(u[2]/2,u[1]),i=l.arc*Math.PI/180/2-t;u[1]=Math.sin(i),u[2]=Math.cos(i)}i=Math.max(i,l.width*BQ.x/this.bboxSize+c)}e.set(u,768+4*s),e[1152+4*s]=c,e[1152+4*s+1]=d/this.bboxSize*2,e[1152+4*s+2]=BQ.x;let p=a.material,f=p.uniforms.nodeU0.node.value,m=p.uniforms.nodeU1.value;0!==h.operation&&!h.useColor&&(m=-1),e[1536+4*s]=f.r,e[1536+4*s+1]=f.g,e[1536+4*s+2]=f.b,e[1536+4*s+3]=m,m<1&&1===this.material.defines.SHAPEBLEND_C&&(this.material.transparent=!0),s++})),this.npart=s,this.spatialPassUniforms.span.value=1.4*i}function jQ(t,e){let i=!1,n=512&t.layers.mask,r=e.getLayersOfType("transmission"),s=e.getLayersOfType("outline");return s.length>0&&(t.layers.set(8),r.length>0&&t.layers.enable(3),i=!0,SH(t),wH(t)),0===r.length&&0===s.length&&t.layers.set(0),n&&t.layers.set(9),t instanceof fH&&t.needsAO&&t.layers.enable(5),i}function GQ(t,e){if(!e.layers)return!1;let i=512&t.layers.mask,n=!1,r=e.getLayersOfType("transmission").filter((t=>t.data.visible)),s=e.getLayersOfType("outline").filter((t=>t.data.visible));return r.length>0&&(t.layers.set(3),s.length>0&&t.layers.enable(8),n=!0),0===r.length&&0===s.length&&t.layers.set(0),i&&t.layers.set(9),t.needsAO&&t.layers.enable(5),n}var HQ=new YS,WQ=new Wm,qQ=new Hm;function YQ(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=t.cloner;if(r)for(let s of r.children){let r=WQ.copy(s.matrixWorld).invert(),a=qQ.copy(e.ray).applyMatrix4(r),o=t.matrixWorld;a.applyMatrix4(o);let l=HQ;l.set(a.origin,a.direction),l.near=e.near,l.far=e.far;let h=l.intersectObject(t,!1);h.length>0&&i.push({...h[0],object:n?s:t})}}var XQ=class{constructor(){this._constraints=new Map}setConstraint(t,e){null===e?this._constraints.delete(t):this._constraints.set(t,e)}removeDependencies(t){this._constraints.delete(t)}applyConstraints(t){let e=new Set;this._constraints.forEach(((i,n)=>{let r=[n,i],s=i;for(;this._constraints.has(s);){if(s=this._constraints.get(s),r.includes(s)){console.warn(`circular dependency detected: ${r.join(" -> ")}`);break}e.has(s)||r.push(s)}for(let a=r.length-2;a>=0;a--)if(!e.has(r[a])){let i=t.find(r[a]);i?i.applyPathSnapping(t):console.warn(`missing entity ${r[a]}`),e.add(r[a])}}))}findDependency(t,e){let i=t;for(;this._constraints.has(i);)if(i=this._constraints.get(i),i===e)return!0;return!1}},QQ=class{};function KQ(t){let e,i,n,r,s,a,o,l,h,c,u,d,p,f,m,g;function v(t,e,a){let o=new Float32Array(c,s,3*i);n=0;let l=new Uint32Array(c,r,i);for(let i=0;i<a.length-1;i++){let r=e[i],s=t[i].elements,h=r.filter((t=>t.enabled&&"Include"===t.mode)).map((t=>"Box"===t.type?b(t):w(t))),c=r.filter((t=>t.enabled&&"Exclude"===t.mode)).map((t=>"Box"===t.type?b(t):w(t)));for(let t=a[i];t<a[i+1];t++){let e=p[3*t],i=p[3*t+1],r=p[3*t+2];if((0===h.length||y(e,i,r,h))&&(0===c.length||!y(e,i,r,c))){let a=1/(s[3]*e+s[7]*i+s[11]*r+s[15]);o[3*n]=(s[0]*e+s[4]*i+s[8]*r+s[12])*a,o[3*n+1]=(s[1]*e+s[5]*i+s[9]*r+s[13])*a,o[3*n+2]=(s[2]*e+s[6]*i+s[10]*r+s[14])*a,l[n]=t,n++}}}}function y(t,e,i,n,r){return n["Intersect"===r?"every":"some"]((n=>{let r=function(t,e,i,n,r){let s=t-r[0],a=e-r[1],o=i-r[2],l=1/(n[3]*s+n[7]*a+n[11]*o+n[15]);return{x:(n[0]*s+n[4]*a+n[8]*o+n[12])*l+r[0],y:(n[1]*s+n[5]*a+n[9]*o+n[13])*l+r[1],z:(n[2]*s+n[6]*a+n[10]*o+n[14])*l+r[2]}}(t,e,i,n.invRotationMatrix,n.cropCenter);return Array.isArray(n)?function(t,e,i,n){return t>=n[0]&&t<=n[3]&&e>=n[1]&&e<=n[4]&&i>=n[2]&&i<=n[5]}(r.x,r.y,r.z,n):function(t,e,i,n){let r=(t-n.cropCenter[0])*n.invRadiusX,s=(e-n.cropCenter[1])*n.invRadiusY,a=(i-n.cropCenter[2])*n.invRadiusZ;return r*r+s*s+a*a<=1}(r.x,r.y,r.z,n)}))}function b(t){let e=t.cropSize[0]/2,i=t.cropSize[1]/2,n=t.cropSize[2]/2,r=[t.cropCenter[0]-e,t.cropCenter[1]-i,t.cropCenter[2]-n,t.cropCenter[0]+e,t.cropCenter[1]+i,t.cropCenter[2]+n],s=x(t.cropRotation);return Object.assign(r,{invRotationMatrix:s,cropCenter:t.cropCenter})}function x(t){let e=[],i=t[0]*Math.PI/180,n=t[1]*Math.PI/180,r=t[2]*Math.PI/180,s=Math.cos(i),a=Math.sin(i),o=Math.cos(n),l=Math.sin(n),h=Math.cos(r),c=Math.sin(r),u=s*h,d=s*c,p=a*h,f=a*c;return e[0]=o*h,e[1]=-o*c,e[2]=l,e[4]=d+p*l,e[5]=u-f*l,e[6]=-a*o,e[8]=f-u*l,e[9]=p+d*l,e[10]=s*o,e[12]=0,e[13]=0,e[14]=0,e[3]=0,e[7]=0,e[11]=0,e[15]=1,e}function w(t){let e=2/t.cropSize[0],i=2/t.cropSize[1],n=2/t.cropSize[2],r=x(t.cropRotation);return{invRadiusX:e,invRadiusY:i,invRadiusZ:n,cropCenter:t.cropCenter,invRotationMatrix:r}}t.onmessage=x=>{if(x.data.getCroppedIndexes){let e=new Uint32Array(function(t,e){let i=[],n=e.filter((t=>t.enabled&&"Include"===t.mode)).map((t=>"Box"===t.type?b(t):w(t))),r=e.filter((t=>t.enabled&&"Exclude"===t.mode)).map((t=>"Box"===t.type?b(t):w(t))),s=t.length;for(let a=0;a<s;a+=3){let e=t[a],s=t[a+1],o=t[a+2];(0===n.length||y(e,s,o,n))&&(0===r.length||!y(e,s,o,r))||i.push(a/3)}return i}(new Float32Array(x.data.positions),x.data.crops)).buffer;t.postMessage({outOfBoundsIndexes:e},[e])}else if(x.data.positions)u=x.data.positions,p=new Float32Array(u),m=x.data.meshMatrixWorlds,g=x.data.cropsArray,f=x.data.meshIndexIntervals,v(m,g,f),t.postMessage({sortSetupComplete:!0});else if(x.data.sort||x.data.newMatrixWorlds||x.data.newCropsArray)(x.data.newMatrixWorlds||x.data.newCropsArray)&&(g=x.data.newCropsArray||g,m=x.data.newMatrixWorlds||m,v(m,g,f)),function(u){let p,f=new Float64Array(c,a,16);for(let t=0;t<16;t++)f[t]=u[t];if(n>1){e.exports.sortIndexes(r,s,h,a,o,l,d.DepthMapRange,n);let t=new Uint32Array(n);p=t.buffer,t.set(new Uint32Array(c,l,n))}else if(1===n){let t=new Uint32Array(n);t[0]=new Uint32Array(c,r,i)[0],p=t.buffer}else p=new ArrayBuffer(0);t.postMessage({sortDone:!0,indexesBuffer:p},[p])}(x.data.sort.view,x.data.sort.cameraPosition);else if(x.data.init){d=x.data.init.Constants,i=x.data.init.splatCount;let n=d.BytesPerInt,u=3*d.BytesPerFloat,p=new Uint8Array(x.data.init.sorterWasmBytes),f=i*(n+u)+(i*d.BytesPerInt*2+d.DepthMapRange*d.BytesPerInt*2)+32*d.MemoryPageSize,m=Math.floor(f/d.MemoryPageSize)+1,g={module:{},env:{memory:new WebAssembly.Memory({initial:2*m,maximum:3*m,shared:!0})}};WebAssembly.compile(p).then((t=>WebAssembly.instantiate(t,g))).then((p=>{e=p,r=0,s=i*n,a=s+i*u,h=a+16*d.BytesPerFloat*2,o=h+i*d.BytesPerInt,l=o+d.DepthMapRange*d.BytesPerInt,c=g.env.memory.buffer,t.postMessage({sortSetupPhase1Complete:!0})}))}}}rp(QQ,"DepthMapRange",65536),rp(QQ,"MemoryPageSize",65536),rp(QQ,"BytesPerFloat",4),rp(QQ,"BytesPerInt",4);var ZQ=function(){let t=new Float32Array(1),e=new Int32Array(t.buffer);return function(i){return t[0]=i,e[0]}}(),JQ=function(t,e,i,n){return t+(e<<8)+(i<<16)+(n<<24)},$Q=new Uf;function tK(t){let e=!1;return t.scene.objects.traverse(((t,i)=>{if(!1===i.visible)return!0;"Splat"===i.type&&(e=!0)})),e}var eK,iK,nK,rK=class extends rv{constructor(t,e,i,n){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=arguments.length>6?arguments[6]:void 0,o=arguments.length>7?arguments[7]:void 0;super(i,n),this.splatCount=e,this.meshIndexIntervals=a,this.meshMatrixWorlds=o,this.splatBuffers=t,this.geometry=i,this.material=n,this.splatDataTextures=null,this.halfPrecisionCovariancesOnGPU=r,this.devicePixelRatio=s,this.resetLocalSplatDataAndTexturesFromSplatBuffer()}static buildMesh(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,a=rK.buildGeomtery(e),o=rK.buildMaterial(r);return new rK(t,e,a,o,i,n,r,s)}static buildMaterial(t){let e={covariancesTexture:{type:"t",value:null},centersColorsTexture:{type:"t",value:null},meshIndexIntervals:{value:t},meshMatrixWorldsTexture:{type:"t",value:null},focal:{type:"v2",value:new Uf},viewport:{type:"v2",value:new Uf},basisViewport:{type:"v2",value:new Uf},debugColor:{type:"v3",value:new nm},covariancesTextureSize:{type:"v2",value:new Uf(1024,1024)},centersColorsTextureSize:{type:"v2",value:new Uf(1024,1024)},orthoZoom:{type:"f",value:-1}};return new uv({uniforms:e,vertexShader:"\n            precision highp float;\n            #include <common>\n\n            attribute uint splatIndex;\n\n            uniform highp sampler2D covariancesTexture;\n            uniform highp usampler2D centersColorsTexture;\n            uniform vec2 focal;\n            uniform vec2 viewport;\n            uniform vec2 basisViewport;\n            uniform vec2 covariancesTextureSize;\n            uniform vec2 centersColorsTextureSize;\n\t\t\t\t\t\tuniform highp sampler2D meshMatrixWorldsTexture;\n\t\t\t\t\t\tuniform uint meshIndexIntervals[257];\n\t\t\t\t\t\tuniform float orthoZoom;\n\n            varying vec4 vColor;\n            varying vec2 vUv;\n\n            varying vec2 vPosition;\n\n            const vec4 encodeNorm4 = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);\n            const uvec4 mask4 = uvec4(uint(0x000000FF), uint(0x0000FF00), uint(0x00FF0000), uint(0xFF000000));\n            const uvec4 shift4 = uvec4(0, 8, 16, 24);\n            vec4 uintToRGBAVec (uint u) {\n               uvec4 urgba = mask4 & u;\n               urgba = urgba >> shift4;\n               vec4 rgba = vec4(urgba) * encodeNorm4;\n               return rgba;\n            }\n\n            vec2 getDataUV(in int stride, in int offset, in vec2 dimensions) {\n                vec2 samplerUV = vec2(0.0, 0.0);\n                float d = float(splatIndex * uint(stride) + uint(offset)) / dimensions.x;\n                samplerUV.y = float(floor(d)) / dimensions.y;\n                samplerUV.x = fract(d);\n                return samplerUV;\n            }\n\n            void main () {\n                uvec4 sampledCenterColor = texture(centersColorsTexture, getDataUV(1, 0, centersColorsTextureSize));\n                vec3 splatCenter = uintBitsToFloat(uvec3(sampledCenterColor.gba));\n                vColor = uintToRGBAVec(sampledCenterColor.r);\n\n                vPosition = position.xy * 2.0;\n\n\t\t\t\t\t\t\t\tuint meshIndex;\n\t\t\t\t\t\t\t\tfor (int i = 1; i < 257; i++) {\n\t\t\t\t\t\t\t\t\tif (splatIndex < meshIndexIntervals[i]) {\n\t\t\t\t\t\t\t\t\t\tmeshIndex = uint(i - 1);\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfloat strideMulmeshIndex = float(4u*meshIndex);\n\t\t\t\t\t\t\t\tfloat meshMatrixWorldsTextureLength = float(256*4);\n\n\t\t\t\t\t\t\t\tmat4 modelMat = mat4(\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+0.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+1.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+2.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+3.0)/meshMatrixWorldsTextureLength, 0))\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tmat4 modelViewMat = viewMatrix * modelMat;\n\t\t\t\t\t\t\t\tvec4 viewCenter = modelViewMat * vec4(splatCenter, 1.0); \n                vec4 clipCenter = projectionMatrix * viewCenter;\n\n                vec2 sampledCovarianceA = texture(covariancesTexture, getDataUV(3, 0, covariancesTextureSize)).rg;\n                vec2 sampledCovarianceB = texture(covariancesTexture, getDataUV(3, 1, covariancesTextureSize)).rg;\n                vec2 sampledCovarianceC = texture(covariancesTexture, getDataUV(3, 2, covariancesTextureSize)).rg;\n\n                vec3 cov3D_M11_M12_M13 = vec3(sampledCovarianceA.rg, sampledCovarianceB.r);\n                vec3 cov3D_M22_M23_M33 = vec3(sampledCovarianceB.g, sampledCovarianceC.rg);\n\n                // Compute the 2D covariance matrix from the upper-right portion of the 3D covariance matrix\n                mat3 Vrk = mat3(\n                    cov3D_M11_M12_M13.x, cov3D_M11_M12_M13.y, cov3D_M11_M12_M13.z,\n                    cov3D_M11_M12_M13.y, cov3D_M22_M23_M33.x, cov3D_M22_M23_M33.y,\n                    cov3D_M11_M12_M13.z, cov3D_M22_M23_M33.y, cov3D_M22_M23_M33.z\n                );\n                float s = 1.0 / (viewCenter.z * viewCenter.z);\n\n                mat3 W = transpose(mat3(modelViewMat));\n                mat3 T = orthoZoom > 0.0 ? W : W * mat3(\n\t\t\t\t\t\t\t\t\tfocal.x / viewCenter.z, 0., -(focal.x * viewCenter.x) * s,\n\t\t\t\t\t\t\t\t\t0., focal.y / viewCenter.z, -(focal.y * viewCenter.y) * s,\n\t\t\t\t\t\t\t\t\t0., 0., 0.\n\t\t\t\t\t\t\t\t);\n                mat3 cov2Dm = transpose(T) * Vrk * T;\n                cov2Dm[0][0] += 0.3;\n                cov2Dm[1][1] += 0.3;\n\n                // We are interested in the upper-left 2x2 portion of the projected 3D covariance matrix because\n                // we only care about the X and Y values. We want the X-diagonal, cov2Dm[0][0],\n                // the Y-diagonal, cov2Dm[1][1], and the correlation between the two cov2Dm[0][1]. We don't\n                // need cov2Dm[1][0] because it is a symetric matrix.\n                vec3 cov2Dv = vec3(cov2Dm[0][0], cov2Dm[0][1], cov2Dm[1][1]);\n\n                vec3 ndcCenter = clipCenter.xyz / clipCenter.w;\n\n                // We now need to solve for the eigen-values and eigen vectors of the 2D covariance matrix\n                // so that we can determine the 2D basis for the splat. This is done using the method described\n                // here: https://people.math.harvard.edu/~knill/teaching/math21b2004/exhibits/2dmatrices/index.html\n                //\n                // This is a different approach than in the original work at INRIA. In that work they compute the\n                // max extents of the 2D covariance matrix in screen space to form an axis aligned bounding rectangle\n                // which forms the geometry that is actually rasterized. They then use the inverse 2D covariance\n                // matrix (called 'conic') to determine fragment opacity.\n                float a = cov2Dv.x;\n                float d = cov2Dv.z;\n                float b = cov2Dv.y;\n                float D = a * d - b * b;\n                float trace = a + d;\n                float traceOver2 = 0.5 * trace;\n                float term2 = sqrt(trace * trace / 4.0 - D);\n                float eigenValue1 = traceOver2 + term2;\n\t\t\t\t\t\t\t\tfloat eigenValue2 = max(traceOver2 - term2, 0.00); // prevent negative eigen value\n\n                const float maxSplatSize = 1024.0;\n                vec2 eigenVector1 = normalize(vec2(b, eigenValue1 - a));\n                // since the eigen vectors are orthogonal, we derive the second one from the first\n                vec2 eigenVector2 = vec2(eigenVector1.y, -eigenVector1.x);\n                vec2 basisVector1 = eigenVector1 * min(sqrt(2.0 * eigenValue1), maxSplatSize);\n                vec2 basisVector2 = eigenVector2 * min(sqrt(2.0 * eigenValue2), maxSplatSize);\n\n                vec2 ndcOffset = vec2(vPosition.x * basisVector1 + vPosition.y * basisVector2) * basisViewport;\n\n\t\t\t\t\t\t\t\tif (orthoZoom > 0.0) {\n\t\t\t\t\t\t\t\t\tndcOffset *= orthoZoom;\n\t\t\t\t\t\t\t\t}\n\n                gl_Position = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);\n            }",fragmentShader:"\n            precision highp float;\n            #include <common>\n\n            uniform vec3 debugColor;\n\n            varying vec4 vColor;\n            varying vec2 vUv;\n\n            varying vec2 vPosition;\n\t\t\t\t\t\tlayout(location = 1) out vec4 gVelocity; \n\n            void main () {\n                // compute the negative squared distance from the center of the splat to the\n                // current fragment in the splat's local space.\n                float A = -dot(vPosition, vPosition);\n                if (A < -4.0) discard;\n                vec3 color = vColor.rgb;\n                A = exp(A) * vColor.a;\n                gl_FragColor = vec4(color.rgb, A);\n\t\t\t\t\t\t\t\tgVelocity = vec4(0.0); // so it is ignored by TAA\n            }",transparent:!0,alphaTest:1,blending:1,depthTest:!0,depthWrite:!1,side:2})}static buildGeomtery(t){let e=new Hg;e.setIndex([0,1,2,0,2,3]);let i=new Float32Array(12),n=new Rg(i,3);e.setAttribute("position",n),n.setXYZ(0,-1,-1,0),n.setXYZ(1,-1,1,0),n.setXYZ(2,1,1,0),n.setXYZ(3,1,-1,0),n.needsUpdate=!0;let r=(new MS).copy(e),s=new Uint32Array(t),a=new fx(s,1,!1);return a.setUsage(35048),r.setAttribute("splatIndex",a),r.instanceCount=t,r}resetLocalSplatDataAndTexturesFromSplatBuffer(){this.updateLocalSplatDataFromSplatBuffer(),this.allocateAndStoreLocalSplatDataInTextures()}updateLocalSplatDataFromSplatBuffer(){this.splatBuffers.forEach((t=>t.buildPreComputedBuffers())),this.covariances=new Float32Array(6*this.splatCount),this.colors=new Uint8Array(4*this.splatCount),this.centers=new Float32Array(3*this.splatCount);let t=0,e=0,i=0;for(let n of this.splatBuffers){let r=n.nsplats;this.colors.subarray(t,t+4*r).set(n.colorsA),t+=4*r,this.centers.subarray(e,e+3*r).set(n.decoded.xyz.denormDequant().data),e+=3*r,this.covariances.subarray(i,i+6*r).set(new Float32Array(n.precomputedCovarianceBufferData)),i+=6*r}}allocateAndStoreLocalSplatDataInTextures(){let t=this.splatCount,e=new Uf(4096,1024);for(;e.x*e.y*2<6*t;)e.y*=2;let i,n,r=new Uf(4096,1024);for(;r.x*r.y*4<4*t;)r.y*=2;if(this.halfPrecisionCovariancesOnGPU){n=new Uint16Array(e.x*e.y*2);for(let t=0;t<this.covariances.length;t++)n[t]=gA.toHalfFloat(this.covariances[t]);i=new cx(n,e.x,e.y,ef,Qp)}else n=new Float32Array(e.x*e.y*2),n.set(this.covariances),i=new cx(n,e.x,e.y,ef,Xp);i.needsUpdate=!0,this.material.uniforms.covariancesTexture.value=i,this.material.uniforms.covariancesTextureSize.value.copy(e);let s=new Uint32Array(r.x*r.y*4);for(let h=0;h<t;h++){let t=4*h,e=3*h,i=4*h;s[i]=JQ(this.colors[t],this.colors[t+1],this.colors[t+2],this.colors[t+3]),s[i+1]=ZQ(this.centers[e]),s[i+2]=ZQ(this.centers[e+1]),s[i+3]=ZQ(this.centers[e+2])}let a=new cx(s,r.x,r.y,1033,Yp);a.internalFormat="RGBA32UI",a.needsUpdate=!0,this.material.uniforms.centersColorsTexture.value=a,this.material.uniforms.centersColorsTextureSize.value.copy(r);let o=new Float32Array(4096);for(let h=0;h<this.meshMatrixWorlds.length;h++)o.set(this.meshMatrixWorlds[h].elements,16*h);let l=new cx(o,1024,1,Zp,Xp);l.needsUpdate=!0,this.material.uniforms.meshMatrixWorldsTexture.value=l,this.material.uniformsNeedUpdate=!0,this.splatDataTextures={covariances:{data:n,texture:i,size:e},centerColors:{data:s,texture:a,size:r},meshMatrixWorlds:{data:o,texture:l}}}updateIndexes(t){let e=this.geometry;e.attributes.splatIndex.set(t),e.attributes.splatIndex.needsUpdate=!0,e.instanceCount=t.length}updateUniforms(t,e,i,n){this.splatCount>0&&($Q.set(t.x*this.devicePixelRatio,t.y*this.devicePixelRatio),this.material.uniforms.viewport.value.copy($Q),this.material.uniforms.basisViewport.value.set(2/$Q.x,2/$Q.y),this.material.uniforms.focal.value.set(e,i),this.material.uniforms.orthoZoom.value=n,this.material.uniformsNeedUpdate=!0)}getSplatDataTextures(){return this.splatDataTextures}getSplatCount(){return this.splatCount}getCenters(){return this.centers}getColors(){return this.colors}getCovariances(){return this.covariances}dispose(){this.geometry.dispose(),this.material.dispose(),this.splatDataTextures&&(this.splatDataTextures.covariances.texture.dispose(),this.splatDataTextures.centerColors.texture.dispose(),this.splatDataTextures.meshMatrixWorlds.texture.dispose()),this.removeFromParent()}},sK=new Promise((t=>{eK=t})),aK=!1;function oK(){if(!aK)return iK||(iK=async function(){let t=await __webpack_require__.e(23).then(__webpack_require__.bind(__webpack_require__,23));eK(t),aK=!0}(),iK)}sK.then((t=>nK=t));var lK=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};rp(this,"updateView",function(){let t=new Wm,e=[],i=new mm(0,0,-1),n=new mm(0,0,-1),r=new mm,s=new mm;return function(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1?arguments[1]:void 0,l=this.updateMatrixWorldsInWorkerIfNeeded(),h=this.cropsChanged();if(!a){n.set(0,0,-1).applyQuaternion(o.quaternion);let t=!1,e=!1;if(n.dot(i)<=.95&&(t=!0),s.copy(o.position).sub(r).length()>=1&&(e=!0),!t&&!e&&!l&&!h&&!this.needsInitialRender)return}this.needsInitialRender=!1,r.copy(o.position),i.copy(n),t.copy(o.matrixWorld).invert(),t.premultiply(this.dummyPerspectiveMatrix),e[0]=o.position.x,e[1]=o.position.y,e[2]=o.position.z;let c={sort:{view:t.elements,cameraPosition:e,splatRenderCount:this.splatRenderCount,splatSortCount:this.splatRenderCount},...l?{newMatrixWorlds:this.meshMatrixWorlds}:{},...h?{newCropsArray:this.cropsArray}:{}};this.sortRunning?this.queuedMessage=c:(this.queuedMessage=null,this.sortRunning=!0,this.sortWorker.postMessage(c))}}()),this.scene=t.scene,this.currentPage=null,this.devicePixelRatio=window.devicePixelRatio,this.sortWorker=null,this.splatRenderCount=0,this.splatSortCount=0,this.splatMesh=null,this.sortRunning=!1,this.meshMatrixWorlds=null,this.meshMatrixWorldsOld=null,this.cropsArray=null,this.splatEntries=null,this.queuedMessage=null,this.needsInitialRender=!0,this.dummyPerspectiveMatrix=(new Wm).makePerspective(-1,1,-1,1,.1,1e3)}updateSplatMeshUniforms(t,e){let i=new Uf;null!==this.splatMesh&&this.splatMesh.getSplatCount()>0&&(t.getSize(i),this.cameraFocalLengthX=e.projectionMatrix.elements[0]*this.devicePixelRatio*i.x*.45,this.cameraFocalLengthY=e.projectionMatrix.elements[5]*this.devicePixelRatio*i.y*.45,this.splatMesh.updateUniforms(i,this.cameraFocalLengthX,this.cameraFocalLengthY,e.isPerspectiveCamera?-1:e.zoom*this.devicePixelRatio))}loadSplat(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.activePage=this.scene.activePage,t.position&&(t.position=(new mm).fromArray(t.position)),t.orientation&&(t.orientation=(new fm).fromArray(t.orientation)),t.halfPrecisionCovariances=!!t.halfPrecisionCovariances;let e=[];if(this.splatEntries=e,this.activePage.traverseVisibleEntity((t=>{"Splat"===t.data.type&&e.push(t)})),this.splatMesh&&this.splatMesh.dispose(),0===e.length)return this.splatMesh=null,!1;this.meshMatrixWorlds=e.map((t=>t.matrixWorld)),this.meshMatrixWorldsOld=e.map((t=>t.matrixWorld.clone())),this.cropsArray=e.map((t=>t.data.crops.map((t=>t.data))));let i=e.map((t=>new nK.GSplineBuffer(new Uint8Array(t.data.buffer).buffer))),n=0,r=[0];for(let s of i)n+=s.getSplatCount(),r.push(n);return this.setupSplatMesh(i,n,t.position,t.orientation,t.halfPrecisionCovariances,this.devicePixelRatio,r,this.meshMatrixWorlds),this.setupSortWorker(n),!0}updateMatrixWorldsInWorkerIfNeeded(){let t=this.splatDataTextures.meshMatrixWorlds.data;for(let e=0;e<this.meshMatrixWorlds.length;e++)t.set(this.meshMatrixWorlds[e].elements,16*e);return this.splatDataTextures.meshMatrixWorlds.texture.needsUpdate=!0,!this.meshMatrixWorlds.every(((t,e)=>t.equals(this.meshMatrixWorldsOld[e])))&&(this.meshMatrixWorldsOld=this.meshMatrixWorlds.map((t=>t.clone())),!0)}cropsChanged(){let t=!1;return this.splatEntries.forEach(((e,i)=>{e.data.crops.forEach(((e,n)=>{void 0===this.cropsArray[i][n]?(t=!0,this.cropsArray[i][n]=e.data):Object.entries(e.data).forEach((e=>{let[r,s]=e;(Array.isArray(s)&&s.some(((t,e)=>t!==this.cropsArray[i][n][r][e]))||s!==this.cropsArray[i][n]?.[r])&&(t=!0,this.cropsArray[i][n][r]=s)}))})),e.data.crops.length!==this.cropsArray[i]?.length&&(this.cropsArray[i].length=e.data.crops.length,t=!0)})),t}setupSplatMesh(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new mm,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new fm,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=arguments.length>6?arguments[6]:void 0,o=arguments.length>7?arguments[7]:void 0;this.splatMesh=rK.buildMesh(t,e,r,s,a,o),this.splatMesh.position.copy(i),this.splatMesh.quaternion.copy(n),this.splatMesh.frustumCulled=!1,this.splatMesh.renderOrder=99999,this.splatRenderCount=e,this.splatMesh.onBeforeRender=(t,e,i)=>this.update(t,i)}setupSortWorker(t){this.sortWorker=function(t){let e=new Worker(URL.createObjectURL(new Blob(["(",KQ.toString(),")(self)"],{type:"application/javascript"}))),i=atob("AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAETA2AAAGAIf39/f39/f38AYAABfwISAQNlbnYGbWVtb3J5AgMAgIAEAwQDAAECBzkDEV9fd2FzbV9jYWxsX2N0b3JzAAALc29ydEluZGV4ZXMAARNlbXNjcmlwdGVuX3Rsc19pbml0AAIK3gMDAwABC9IDAwF/BnwBfgJAIAdFDQAgAysDUCEMIAMrAzAhDSADKwMQIQ5BACEDRP///////+9/IQtEAAAAAAAAEAAhCgNAIAIgA0ECdGoCfyAOIAEgA0EMbGoiCCoCALuiIA0gCCoCBLuioCAMIAgqAgi7oqBEAAAAAAAAsECiIgmZRAAAAAAAAOBBYwRAIAmqDAELQYCAgIB4CzYCACAJIAsgCSALYxshCyAJIAogCSAKZBshCiADQQFqIgMgB0cNAAsgB0UNACAGuCAKIAuhoyEJQQAhAwNAAn8gCSACIANBAnRqIgEoAgC3IAuhoiIKmUQAAAAAAADgQWMEQCAKqgwBC0GAgICAeAshCCABIAg2AgAgBCAIQQJ0aiIBIAEoAgBBAWo2AgAgA0EBaiIDIAdHDQALCyAGQQJPBEAgBCgCACEIQQEhAwNAIAQgA0ECdGoiASABKAIAIAhqIgg2AgAgA0EBaiIDIAZHDQALCyAHQQFrIgGtIQ8DQCAEIAIgD6dBAnQiA2ooAgBBAnRqIgcgBygCAEEBayIHNgIAIAUgASAHa0ECdGogACADaigCADYCACAPUCEDIA9CAX0hDyADRQ0ACyAGBEAgBEEAIAZBAnT8CwALCwQAQQAL"),n=new Uint8Array(i.length);for(let r=0;r<i.length;r++)n[r]=i.charCodeAt(r);return e.postMessage({init:{sorterWasmBytes:n.buffer,splatCount:t,Constants:{BytesPerFloat:QQ.BytesPerFloat,BytesPerInt:QQ.BytesPerInt,DepthMapRange:QQ.DepthMapRange,MemoryPageSize:QQ.MemoryPageSize}}}),e}(t),this.sortWorker.onmessage=t=>{t.data.sortDone?(this.sortRunning=!1,this.splatMesh?.updateIndexes(new Uint32Array(t.data.indexesBuffer)),this.lastSortTime=t.data.sortTime,this.queuedMessage&&(this.sortWorker.postMessage(this.queuedMessage),this.queuedMessage=null)):t.data.sortCanceled?this.sortRunning=!1:t.data.sortSetupPhase1Complete?this.sortWorker.postMessage({positions:this.splatMesh.getCenters().buffer,meshMatrixWorlds:this.splatMesh.meshMatrixWorlds,meshIndexIntervals:this.splatMesh.meshIndexIntervals,cropsArray:this.cropsArray}):t.data.sortSetupComplete&&(this.splatDataTextures=this.splatMesh.getSplatDataTextures(),this.scene.activePage.add(this.splatMesh),this.needsInitialRender=!0)}}update(t,e){null!==this.splatMesh&&(this.updateSplatMeshUniforms(t,e),this.updateView(!1,e))}getSplatMesh(){return this.splatMesh}},hK=new Dg;hK.wireframe=!0;var cK=new mm,uK=class extends sx{constructor(t,e){super(),this.data=t,this.sharedAssets=e,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.splatViewer=null,this.shapeBlendIntances=[],this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new XQ,this.invisibleObjects=new GW("jflkdsafjasdifjaslk",{...LR.defaultData,visible:!1,name:"buildin invisible"}),this.needsRecomputeInstances=!1,this.init(t,e),this.matrixAutoUpdate=!1,this.errorPage=new tQ("fdasfa",{...HR.defaultData,name:""},{shared:e,scene:this})}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=function(t){let e=!1;return t.traverseEntity((t=>{if(t instanceof fH)if(Array.isArray(t.material))for(let i=0;i<t.material.length;i++)GQ(t,t.material[i])&&(e=!0);else GQ(t,t.material)&&(e=!0)})),e}(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=function(t){let e=!1;return t.traverseEntity((t=>{if(t instanceof fH)if(Array.isArray(t.material))for(let i=0;i<t.material.length;i++)jQ(t,t.material[i])&&(e=!0);else jQ(t,t.material)&&(e=!0)})),e}(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(t){let e=t.identity.join("-"),i=this.entityIdentityToEntity[e];i&&(t.uuid=i.uuid),this.entityIdentityToEntity[e]=t,this.entityByUuid[t.uuid]=t}markPenumbraSizeDirty(){for(let t of this.children)t instanceof tQ&&(t.penumbraSizeArrayCache=null)}findInstance(t){return this.entityIdentityToEntity[t.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(t){let e=this.find(t);if(void 0===e)return;let i=[],n=e;for(;n!==this;){let t=n;n=n.parent;let e=n.children.indexOf(t);i.splice(0,0,e)}return{entity:e,sortKey:i}}getAllSorted(t){let e=[];for(let i of t){let t=this.getWithSortKey(i.id);void 0!==t&&e.push(t)}return e.sort(((t,e)=>fT(t.sortKey,e.sortKey))),e.map((t=>t.entity))}nonExistOrDescendantOf(t,e){let i=this.find(t);if(void 0===i)return!0;for(;i;){if(i.uuid===e)return!0;i=i.parent}return!1}find(t){if(this.activePage&&this.activePage.personalCamera.parent){if("f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera"===t)return this.activePage.personalCamera;if(t===GI)return this.activePage.personalCamera}if(""===t||void 0===t)return;let e=this.entityByUuid[t];return void 0===e?this.getObjectByProperty("uuid",t):e}find2D(t){for(let e of this.children)if(e instanceof tQ&&e.uiScene){let i=e.uiScene.find(t);if(i)return i}}findScene2DfromObject2D(t){for(let e of this.children)if(e instanceof tQ&&e.uiScene&&e.uiScene.find(t))return e.uiScene}find2DInUIObjects(t){let e;return this.traverseEntity((i=>{void 0===e&&i instanceof cQ&&(e=i.uiCanvas.find(t))})),e}traverse2D(t){for(let e of this.children)e instanceof tQ&&e.uiScene&&e.uiScene.traverse(t)}debugEnsureEntity(t){let e=this.find(t);e?Array.isArray(e.identity)&&void 0===this.findInstance(e.identity)&&console.error("not found instance"):console.error("not found")}addPendingExpandCloner(t){this.toExpandCloner.add(t)}addPendingUpdateCloner(t){this.toUpdateCloner.add(t)}markToExpandCloner(t){this.toExpandCloner.add(t),t.traverseEntityAncestors((t=>{this.toExpandCloner.add(t)}))}doPendingExpandCloner(){this.toExpandCloner.forEach((t=>{t.expandCloner(this)})),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach((t=>{t.cloner?.update()})),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(t){this.pendingCommands.push(t)}applyPendingCommands(){this.pendingCommands.forEach((t=>t())),this.pendingCommands.length=0}updateByLibOp(t,e){1===t.path.length&&"components"===t.path[0]&&1===t.type&&this.createChildrenObjects([{...t.data.asset,id:t.id}],this.invisibleObjects,e)}updateTreeByOp(t,e){if(0===t.path.length&&7===t.type){let i=null===t.parent?this:this.find(t.parent);if(void 0===i)throw new Error("unexpected");let n=this.createObject(t.id,t.data,t.children,i,t.localIndex,e);n.updateVisible(this),n.resetBBoxNeedsUpdate(),LW(n)&&BW(n.parent)&&(n.invalidateUpstreamBooleanData(),n.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(i),this.markNeedsRecomputeInstancesForChildren(n),this.markToExpandCloner(n),this.markPenumbraSizeDirty(),n.updatePathSnapping()}else if(0===t.path.length&&8===t.type){let e=this.find(t.id);if(void 0===e)throw new Error("unexpected");e.traverseEntity((t=>{t instanceof IQ&&(this.shapeBlendIntances=this.shapeBlendIntances.filter((e=>e!==t)))})),this.markToExpandCloner(e),e.resetBBoxNeedsUpdate(),this.unregisterObject(e);let i=e.parent;this.markNeedsRecomputeInstancesForAncessors(i),this.markNeedsRecomputeInstancesForChildren(e),this.markPenumbraSizeDirty(),e.parent.remove(e),BW(e.parent)&&(e.parent.invalidateUpstreamBooleanData(),e.parent.invalidateDownstreamBooleanData().recomputeBoolean()),LW(e)&&(e.freeBooleanPointer(),i instanceof RW&&i.invalidateDownstreamBooleanData().recomputeBoolean()),e instanceof nQ&&e.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(e),this.pathConstraints.removeDependencies(e.uuid),e.updatePathSnapping()}else if(0===t.path.length&&9===t.type){let e=this.find(t.id);if(void 0===e)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(e);let i=e.parent;this.markNeedsRecomputeInstancesForAncessors(i),e.cloner?.resetOnMove(),this.markToExpandCloner(e);let n=null===t.parent?this:this.find(t.parent);if(void 0===n)throw new Error("unexpected");n.add(e),this.markNeedsRecomputeInstancesForAncessors(n),this.markToExpandCloner(e),e.invalidateClonerTransform(e),e.updateVisible(this),e.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty();let r=t.localIndex;n.children.splice(r,0,n.children.pop()),LW(e)&&(e.invalidateUpstreamBooleanData(),BW(e.parent)?e.parent.invalidateDownstreamBooleanData().recomputeBoolean():i instanceof RW&&i.invalidateDownstreamBooleanData().recomputeBoolean()),e.updatePathSnapping()}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}get playPage(){return this.find(this.data.publish.playPage)??this.errorPage}updatePage(t){this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage;for(let e of this.children)e instanceof tQ&&(e.visible=e.uuid===t,e.visible&&(this.activePage=e,this.activePage.onActive(this)));this.activePage!==this.splatViewer?.activePage&&this.reloadSplats()}updateEntityByOp(t,e,i,n){if(0===e.type){if(("overrides"in e.props||"component"in e.props)&&this.markNeedsRecomputeInstances(),"visible"in e.props&&this.markPenumbraSizeDirty(),e.path.includes("overrides")&&"states"in e.props){let{rest:t}=e.props;e={...e,props:t},this.markNeedsRecomputeInstances()}"pathSnapping"===e.path[0]&&void 0!==e.props.pathId&&this.pathConstraints.setConstraint(t,e.props.pathId)}let r=this.find(t);if(r)try{(function(t,e,i,n){t.updateByOp(e,i,n,!1)})(r,e,i,{scene:this,shared:n}),r instanceof xH&&r.updateGeometryGroupsIfNeeded()}catch(_I){console.error(_I)}}updateEntity2DByOp(t,e,i,n,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];t.updateEntityByOp(e,i,n,r),this.traverseEntity((t=>{(t instanceof cQ||t instanceof tQ)&&(s.includes(t.frameId??"")||t.frameId===e)&&t.updateEntity2DByOp(e,i,n,r)}))}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(t){this.activePage.switchActiveCamera(t)}isInvisibleObjects(t){return t===this.invisibleObjects||t.hasAnccestor(this.invisibleObjects)}init(t,e){let i=Object.entries(e.data.lib.components).map(((t,e)=>({data:t[1].asset.data,children:t[1].asset.children,id:t[0],fi:e})));this.invisibleObjects.updateState(this.invisibleObjects.data,{scene:this,shared:e}),this.add(this.invisibleObjects),this.createChildrenObjects(i,this.invisibleObjects,e),this.createChildrenObjects(t.objects,this,e),this.updatePage(t.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(e,!0),this.traverseEntity((t=>{t instanceof PW&&t.updateUp()})),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(t){t.traverseEntity((t=>{("Component"===t.data.type||"Instance"===t.data.type)&&this.markNeedsRecomputeInstances()}))}markNeedsRecomputeInstancesForAncessors(t){IB.is(t)&&("Component"===t.data.type&&this.markNeedsRecomputeInstances(),t.traverseAncestors((t=>{IB.is(t)&&"Component"===t.data.type&&this.markNeedsRecomputeInstances()})))}relativeizeInner(t,e,i,n,r,s,a){if(t){let o=n.find(t);o&&o!==n&&r.forInstancesRec((n=>{n.data=SD(n.data,(r=>{let o=r.events.data(a.id),l=n.goUp(s);if(l){let n=[...pT(l.identity),t].join("-"),r=this.entityIdentityToEntity[n];if(r){let t=r.uuid;yD.zoom(o,e)[i]=t}else console.warn("cannot find instance")}})).data}))}}rewriteActions(t,e,i,n,r,s){t.forEach((t=>{"Transition"===t.data.type||"Animation"===t.data.type?this.relativeizeInner(t.data.object,[...e,t.id],"object",i,n,r,s):"Conditional"===t.data.type&&(this.rewriteActions(t.data.ifActions,[...e,t.id,"ifActions"],i,n,r,s),this.rewriteActions(t.data.elseActions,[...e,t.id,"elseActions"],i,n,r,s))}))}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity((t=>{if(t instanceof sQ&&"string"==typeof t.identity&&"Component"===t.data.type)return t.traverseEntity(((e,i)=>{e.data.events.forEach((n=>{if("GameControl"===n.data.type){let r=!1;if(e.forInstancesRec((t=>{t.data=SD(t.data,(e=>{t.isInstanceRoot||(e.events.delete(n.id),r=!0)})).data})),!1===r)for(let s of hO.list)this.rewriteActions(n.data.gameActions[s],["gameActions",s],t,e,i,n)}else"Conditional"===n.data.type?("Distance"===n.data.condition.type?(this.relativeizeInner(n.data.condition.fromObject,["condition"],"fromObject",t,e,i,n),this.relativeizeInner(n.data.condition.toObject,["condition"],"toObject",t,e,i,n)):"State"===n.data.condition.type?this.relativeizeInner(n.data.condition.object,["condition"],"object",t,e,i,n):"Comparison"===n.data.condition.type&&("Property"===n.data.condition.lOperand.type&&this.relativeizeInner(n.data.condition.lOperand.value[0],["condition","lOperand","value"],0,t,e,i,n),"Property"===n.data.condition.rOperand.type&&this.relativeizeInner(n.data.condition.rOperand.value[0],["condition","rOperand","value"],0,t,e,i,n)),this.rewriteActions(n.data.inActions,["inActions"],t,e,i,n),this.rewriteActions(n.data.outActions,["outActions"],t,e,i,n)):"actions"in n.data&&this.rewriteActions(n.data.actions,["actions"],t,e,i,n)}))})),!0}))}expandInstances(t,e,i){let n=new Set;this.traverseEntity((r=>{if(r instanceof sQ&&r.isInstanceRoot)return r.expandInstanceChildren({scene:this,shared:t,pendingDeletes:n}),e||r.resetBBoxNeedsUpdate(),i&&r.traverseEntity((t=>{i.addClip(t)})),!0}));for(let r of n)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(r),aQ(r)}recomputeInstances(t,e){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity((t=>{t instanceof sQ&&t.isInstanceRoot&&(t.component=void 0)})),this.expandInstances(t,!1,e))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(t){t.traverseEntity((t=>{let e="string"==typeof t.identity?t.identity:t.identity.join("-");this.entityIdentityToEntity[e]===t&&(delete this.entityByUuid[t.uuid],delete this.entityIdentityToEntity[e]),t.dispose()}))}clearScene(){for(let t of this.children)IB.is(t)&&t.disposeRecursively();this.children.length=0}resetAfterClear(t,e){this.init(t,e)}raycast(t){return this.raycast1(t,!1)}raycast1(t,e){let i=[],n=r=>{for(let s of r.children){let r=s.cloner;if(IB.is(s)&&!s.raycastLock&&(s.visible||r?.object.data.visible))if(!0===e&&s.isInstanceRoot){let e=[];if(t.intersectObject(s,!0,e),e.length){let t=e[0];t.object=s,t.point.applyMatrix4(t.object.matrixWorld);let n=s.matrixWorld.clone().invert();t.point.applyMatrix4(n),i.push(t)}}else(LW(s)||zW(s)&&this.enableHelpers&&s.objectHelper.visible)&&(t.intersectObject(s,!1,i),YQ(s,t,i)),n(s)}};return n(this.activePage),i}raycastWithClones(t){let e=[],i=n=>{for(let r of n.children){let n=r.cloner;IB.is(r)&&(r.visible||n?.object.data.visible)&&((LW(r)||zW(r)&&this.enableHelpers&&r.objectHelper.visible)&&(t.intersectObject(r,!1,e),YQ(r,t,e,!0)),i(r))}};return i(this),e}forEachEntity(t){for(let e of this.children)IB.is(e)&&t(e)}traverseConcreteEntity(t){for(let e of this.children)IB.is(e)&&e.isConcreteEntity&&e.traverseEntity(t)}traverseEntity(t){for(let e of this.children)IB.is(e)&&e.traverseEntity(t)}updateFont(t,e){this.traverseEntity((i=>{if(i instanceof xH&&"Mesh"===i.data.type&&("TextGeometry"===i.data.geometry.type||"InputGeometry"===i.data.geometry.type)&&i.data.geometry.font===t){let n=i.geometry,r=i.data.geometry;n.updateFont(t,e).then((()=>{n.update(r);let t=i.invalidateDownstreamBooleanData();BW(t)&&t.recomputeBoolean()}))}}))}traverseObject(t){for(let e of this.children)_B.is(e)&&e.traverseObject(t)}traverseVisibleEntity(t){for(let e of this.children)IB.is(e)&&e.visible&&e.traverseVisibleEntity(t)}dispose(){this.clearScene()}createChildrenObjects(t,e,i){let n=0;for(let r of t)this.createObject(r.id,r.data,r.children,e,n,i),n+=1}registerObjectCreatedInLegacy(t){this.entityByUuid[t.uuid]=t}unregisterObject(t){delete this.entityByUuid[t.uuid];for(let e of t.children)this.unregisterObject(e)}createObject(t,e,i,n,r,s){let a={scene:this,shared:s},o=_Q(t,e,a);return o instanceof IQ&&this.shapeBlendIntances.push(o),o&&(this.entityByUuid[t]=o,n.add(o),n.children.splice(r,0,n.children.pop()),i.length>0&&(o.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(i,o,s)),o.updateState(e,a),o instanceof xH&&o.updateGeometryGroupsIfNeeded(),o.updateVisible(this),o.cloner&&this.toExpandCloner.add(o),e.pathSnapping?.pathId&&this.pathConstraints.setConstraint(t,e.pathSnapping.pathId)),"Empty"===e.type&&e.animations&&o.traverseEntity((t=>{let e=t.dataPatched;if(t instanceof xH&&e.bones&&e.boneInverses){let i=e.bones.map((t=>this.find(t))),n=e.boneInverses.map((t=>(new Wm).fromArray(t))),r=new px(i,n);t.bind(r,t.bindMatrix)}else t.matrixAutoUpdate=!0})),o}getCenter(t){let e=[];for(let n=0,r=t.length;n<r;++n){let{id:i,recursive:r}=t[n],s=this.find(i),a=r?s.recursiveBBox:s.singleBBox;e.push(...a.vertices)}let i=new ym;return i.setFromPoints(e),i.getCenter(cK),cK}copyMatrixWorld(t,e){if(null===t)return void e.identity();let i=this.find(t);i?e.copy(i.matrixWorld):e.identity()}copyParentMatrixWorld(t,e){if(null===t)return void e.identity();let i=this.find(t)?.parent;i?e.copy(i.matrixWorld):e.identity()}traverseMaterial(t){this.traverseEntity((e=>{if(e instanceof CU)if(Array.isArray(e.material))for(let i=0;i<e.material.length;i++)e.material[i]instanceof lG&&t(e.material[i]);else e.material instanceof lG&&t(e.material)}))}updateViewPlaneSize(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.traverseConcreteEntity((n=>{n instanceof PW&&n.setViewplaneSize(t,e,i)}))}initializeSplatViewer(){this.splatViewer=new lK({scene:this}),this.reloadSplats()}reloadSplats(){this.splatViewer?.loadSplat()}},dK=(t,e)=>{let i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i*i+n*n)},pK=t=>t*(Math.PI/180),fK=t=>t*(180/Math.PI),mK=new Map,gK=t=>{mK.has(t)&&clearTimeout(mK.get(t)),mK.set(t,setTimeout(t,100))},vK=(t,e,i)=>{let n,r=e.split(/[ ,]+/g);for(let s=0;s<r.length;s+=1)n=r[s],t.addEventListener?t.addEventListener(n,i,!1):t.attachEvent&&t.attachEvent(n,i)},yK=(t,e,i)=>{let n,r=e.split(/[ ,]+/g);for(let s=0;s<r.length;s+=1)n=r[s],t.removeEventListener?t.removeEventListener(n,i):t.detachEvent&&t.detachEvent(n,i)},bK=t=>(t.preventDefault(),t.type.match(/^touch/)?t.changedTouches:t),xK=()=>{if(typeof window>"u")return;return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},wK=(t,e)=>{e.top||e.right||e.bottom||e.left?(t.style.top=e.top,t.style.right=e.right,t.style.bottom=e.bottom,t.style.left=e.left):(t.style.left=e.x+"px",t.style.top=e.y+"px")},SK=(t,e,i)=>{let n=AK(t);for(let r in n)if(n.hasOwnProperty(r))if("string"==typeof e)n[r]=e+" "+i;else{let t="";for(let n=0,r=e.length;n<r;n+=1)t+=e[n]+" "+i+", ";n[r]=t.slice(0,-2)}return n},AK=t=>{let e={};return e[t]="",["webkit","Moz","o"].forEach((function(i){e[i+t.charAt(0).toUpperCase()+t.slice(1)]=""})),e},EK=(t,e)=>{for(let i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},_K=(t,e)=>{if(t.length)for(let i=0,n=t.length;i<n;i+=1)e(t[i]);else e(t)};typeof window<"u"&&(CK="ontouchstart"in window,MK=!!window.PointerEvent,PK=!!window.MSPointerEvent);var CK,MK,PK,TK,DK={start:"mousedown",move:"mousemove",end:"mouseup"},kK={};function IK(){}MK?TK={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:PK?TK={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:CK?(TK={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},kK=DK):TK=DK,IK.prototype.on=function(t,e){var i,n=this,r=t.split(/[ ,]+/g);n._handlers_=n._handlers_||{};for(var s=0;s<r.length;s+=1)i=r[s],n._handlers_[i]=n._handlers_[i]||[],n._handlers_[i].push(e);return n},IK.prototype.off=function(t,e){var i=this;return i._handlers_=i._handlers_||{},void 0===t?i._handlers_={}:void 0===e?i._handlers_[t]=null:i._handlers_[t]&&i._handlers_[t].indexOf(e)>=0&&i._handlers_[t].splice(i._handlers_[t].indexOf(e),1),i},IK.prototype.trigger=function(t,e){var i,n=this,r=t.split(/[ ,]+/g);n._handlers_=n._handlers_||{};for(var s=0;s<r.length;s+=1)i=r[s],n._handlers_[i]&&n._handlers_[i].length&&n._handlers_[i].forEach((function(t){t.call(n,{type:i,target:n},e)}))},IK.prototype.config=function(t){var e=this;e.options=e.defaults||{},t&&(e.options=((t,e)=>{let i={};for(let n in t)t.hasOwnProperty(n)&&e.hasOwnProperty(n)?i[n]=e[n]:t.hasOwnProperty(n)&&(i[n]=t[n]);return i})(e.options,t))},IK.prototype.bindEvt=function(t,e){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[e]=function(){"function"==typeof i["on"+e]?i["on"+e].apply(i,arguments):console.warn('[WARNING] : Missing "on'+e+'" handler.')},vK(t,TK[e],i._domHandlers_[e]),kK[e]&&vK(t,kK[e],i._domHandlers_[e]),i},IK.prototype.unbindEvt=function(t,e){var i=this;return i._domHandlers_=i._domHandlers_||{},yK(t,TK[e],i._domHandlers_[e]),kK[e]&&yK(t,kK[e],i._domHandlers_[e]),delete i._domHandlers_[e],this};var RK=IK;function OK(t,e){return this.identifier=e.identifier,this.position=e.position,this.frontPosition=e.frontPosition,this.collection=t,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(e),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=OK.id,OK.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}OK.prototype=new RK,OK.constructor=OK,OK.id=0,OK.prototype.buildEl=function(t){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},OK.prototype.stylize=function(){if(this.options.dataOnly)return this;var t=this.options.fadeTime+"ms",e=((t,e)=>{let i=AK(t);for(let n in i)i.hasOwnProperty(n)&&(i[n]=e);return i})("borderRadius","50%"),i=SK("transition","opacity",t),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},EK(n.el,i),"circle"===this.options.shape&&EK(n.back,e),EK(n.front,e),this.applyStyles(n),this},OK.prototype.applyStyles=function(t){for(var e in this.ui)if(this.ui.hasOwnProperty(e))for(var i in t[e])this.ui[e].style[i]=t[e][i];return this},OK.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},OK.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},OK.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},OK.prototype.show=function(t){var e=this;return e.options.dataOnly||(clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.addToDom(),e.restCallback(),setTimeout((function(){e.ui.el.style.opacity=1}),0),e.showTimeout=setTimeout((function(){e.trigger("shown",e.instance),"function"==typeof t&&t.call(this)}),e.options.fadeTime)),e},OK.prototype.hide=function(t){var e=this;if(e.options.dataOnly)return e;if(e.ui.el.style.opacity=e.options.restOpacity,clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.removeTimeout=setTimeout((function(){var i="dynamic"===e.options.mode?"none":"block";e.ui.el.style.display=i,"function"==typeof t&&t.call(e),e.trigger("hidden",e.instance)}),e.options.fadeTime),e.options.restJoystick){let i=e.options.restJoystick,n={};n.x=!0===i||!1!==i.x?0:e.instance.frontPosition.x,n.y=!0===i||!1!==i.y?0:e.instance.frontPosition.y,e.setPosition(t,n)}return e},OK.prototype.setPosition=function(t,e){var i=this;i.frontPosition={x:e.x,y:e.y};var n=i.options.fadeTime+"ms",r={};r.front=SK("transition",["top","left"],n);var s={front:{}};s.front={left:i.frontPosition.x+"px",top:i.frontPosition.y+"px"},i.applyStyles(r),i.applyStyles(s),i.restTimeout=setTimeout((function(){"function"==typeof t&&t.call(i),i.restCallback()}),i.options.fadeTime)},OK.prototype.restCallback=function(){var t=this,e={};e.front=SK("transition","none",""),t.applyStyles(e),t.trigger("rested",t.instance)},OK.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},OK.prototype.computeDirection=function(t){var e,i,n,r=t.angle.radian,s=Math.PI/4,a=Math.PI/2;if(r>s&&r<3*s&&!t.lockX?e="up":r>-s&&r<=s&&!t.lockY?e="left":r>3*-s&&r<=-s&&!t.lockX?e="down":t.lockY||(e="right"),t.lockY||(i=r>-a&&r<a?"left":"right"),t.lockX||(n=r>0?"up":"down"),t.force>this.options.threshold){var o,l={};for(o in this.direction)this.direction.hasOwnProperty(o)&&(l[o]=this.direction[o]);var h={};for(o in this.direction={x:i,y:n,angle:e},t.direction=this.direction,l)l[o]===this.direction[o]&&(h[o]=!0);if(h.x&&h.y&&h.angle)return t;(!h.x||!h.y)&&this.trigger("plain",t),h.x||this.trigger("plain:"+i,t),h.y||this.trigger("plain:"+n,t),h.angle||this.trigger("dir dir:"+e,t)}else this.resetDirection();return t};var LK=OK;function BK(t,e){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=t,i.id=BK.id,BK.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(e),("static"===i.options.mode||"semi"===i.options.mode)&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);let n=getComputedStyle(i.options.zone.parentElement);return n&&"flex"===n.display&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}BK.prototype=new RK,BK.constructor=BK,BK.id=0,BK.prototype.prepareNipples=function(){var t=this,e=t.nipples;e.on=t.on.bind(t),e.off=t.off.bind(t),e.options=t.options,e.destroy=t.destroy.bind(t),e.ids=t.ids,e.id=t.id,e.processOnMove=t.processOnMove.bind(t),e.processOnEnd=t.processOnEnd.bind(t),e.get=function(t){if(void 0===t)return e[0];for(var i=0,n=e.length;i<n;i+=1)if(e[i].identifier===t)return e[i];return!1}},BK.prototype.bindings=function(){var t=this;t.bindEvt(t.options.zone,"start"),t.options.zone.style.touchAction="none",t.options.zone.style.msTouchAction="none"},BK.prototype.begin=function(){var t=this,e=t.options;if("static"===e.mode){var i=t.createNipple(e.position,t.manager.getIdentifier());i.add(),t.idles.push(i)}},BK.prototype.createNipple=function(t,e){var i=this,n=i.manager.scroll,r={},s=i.options,a=i.parentIsFlex?n.x:n.x+i.box.left,o=i.parentIsFlex?n.y:n.y+i.box.top;if(t.x&&t.y)r={x:t.x-a,y:t.y-o};else if(t.top||t.right||t.bottom||t.left){var l=document.createElement("DIV");l.style.display="hidden",l.style.top=t.top,l.style.right=t.right,l.style.bottom=t.bottom,l.style.left=t.left,l.style.position="absolute",s.zone.appendChild(l);var h=l.getBoundingClientRect();s.zone.removeChild(l),r=t,t={x:h.left+n.x,y:h.top+n.y}}var c=new LK(i,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:e,position:t,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(wK(c.ui.el,r),wK(c.ui.front,c.frontPosition)),i.nipples.push(c),i.trigger("added "+c.identifier+":added",c),i.manager.trigger("added "+c.identifier+":added",c),i.bindNipple(c),c},BK.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},BK.prototype.bindNipple=function(t){var e,i=this,n=function(t,n){e=t.type+" "+n.id+":"+t.type,i.trigger(e,n)};t.on("destroyed",i.onDestroyed.bind(i)),t.on("shown hidden rested dir plain",n),t.on("dir:up dir:right dir:down dir:left",n),t.on("plain:up plain:right plain:down plain:left",n)},BK.prototype.pressureFn=function(t,e,i){var n=this,r=0;clearInterval(n.pressureIntervals[i]),n.pressureIntervals[i]=setInterval(function(){var i=t.force||t.pressure||t.webkitForce||0;i!==r&&(e.trigger("pressure",i),n.trigger("pressure "+e.identifier+":pressure",i),r=i)}.bind(n),100)},BK.prototype.onstart=function(t){var e=this,i=e.options,n=t;t=bK(t),e.updateBox();return _K(t,(function(r){e.actives.length<i.maxNumberOfNipples?e.processOnStart(r):n.type.match(/^touch/)&&(Object.keys(e.manager.ids).forEach((function(i){if(Object.values(n.touches).findIndex((function(t){return t.identifier===i}))<0){var r=[t[0]];r.identifier=i,e.processOnEnd(r)}})),e.actives.length<i.maxNumberOfNipples&&e.processOnStart(r))})),e.manager.bindDocument(),!1},BK.prototype.processOnStart=function(t){var e,i=this,n=i.options,r=i.manager.getIdentifier(t),s=t.force||t.pressure||t.webkitForce||0,a={x:t.pageX,y:t.pageY},o=i.getOrCreate(r,a);o.identifier!==r&&i.manager.removeIdentifier(o.identifier),o.identifier=r;var l=function(e){e.trigger("start",e),i.trigger("start "+e.id+":start",e),e.show(),s>0&&i.pressureFn(t,e,e.identifier),i.processOnMove(t)};if((e=i.idles.indexOf(o))>=0&&i.idles.splice(e,1),i.actives.push(o),i.ids.push(o.identifier),"semi"!==n.mode)l(o);else{if(!(dK(a,o.position)<=n.catchDistance))return o.destroy(),void i.processOnStart(t);l(o)}return o},BK.prototype.getOrCreate=function(t,e){var i,n=this,r=n.options;return/(semi|static)/.test(r.mode)?(i=n.idles[0])?(n.idles.splice(0,1),i):"semi"===r.mode?n.createNipple(e,t):(console.warn("Coudln't find the needed nipple."),!1):i=n.createNipple(e,t)},BK.prototype.processOnMove=function(t){var e=this,i=e.options,n=e.manager.getIdentifier(t),r=e.nipples.get(n),s=e.manager.scroll;if((t=>isNaN(t.buttons)?0!==t.pressure:0!==t.buttons)(t)){if(!r)return console.error("Found zombie joystick with ID "+n),void e.manager.removeIdentifier(n);if(i.dynamicPage){var a=r.el.getBoundingClientRect();r.position={x:s.x+a.left,y:s.y+a.top}}r.identifier=n;var o=r.options.size/2,l={x:t.pageX,y:t.pageY};i.lockX&&(l.y=r.position.y),i.lockY&&(l.x=r.position.x);var h,c,u=dK(l,r.position),d=((t,e)=>{let i=e.x-t.x,n=e.y-t.y;return fK(Math.atan2(n,i))})(l,r.position),p=pK(d),f=u/o,m={distance:u,position:l};if("circle"===r.options.shape?(h=Math.min(u,o),c=((t,e,i)=>{let n={x:0,y:0};return i=pK(i),n.x=t.x-e*Math.cos(i),n.y=t.y-e*Math.sin(i),n})(r.position,h,d)):(c=((t,e,i)=>({x:Math.min(Math.max(t.x,e.x-i),e.x+i),y:Math.min(Math.max(t.y,e.y-i),e.y+i)}))(l,r.position,o),h=dK(c,r.position)),i.follow){if(u>o){let t=l.x-c.x,i=l.y-c.y;r.position.x+=t,r.position.y+=i,r.el.style.top=r.position.y-(e.box.top+s.y)+"px",r.el.style.left=r.position.x-(e.box.left+s.x)+"px",u=dK(l,r.position)}}else l=c,u=h;var g=l.x-r.position.x,v=l.y-r.position.y;r.frontPosition={x:g,y:v},i.dataOnly||wK(r.ui.front,r.frontPosition);var y={identifier:r.identifier,position:l,force:f,pressure:t.force||t.pressure||t.webkitForce||0,distance:u,angle:{radian:p,degree:d},vector:{x:g/o,y:-v/o},raw:m,instance:r,lockX:i.lockX,lockY:i.lockY};(y=r.computeDirection(y)).angle={radian:pK(180-d),degree:180-d},r.trigger("move",y),e.trigger("move "+r.id+":move",y)}else this.processOnEnd(t)},BK.prototype.processOnEnd=function(t){var e=this,i=e.options,n=e.manager.getIdentifier(t),r=e.nipples.get(n),s=e.manager.removeIdentifier(r.identifier);!r||(i.dataOnly||r.hide((function(){"dynamic"===i.mode&&(r.trigger("removed",r),e.trigger("removed "+r.id+":removed",r),e.manager.trigger("removed "+r.id+":removed",r),r.destroy())})),clearInterval(e.pressureIntervals[r.identifier]),r.resetDirection(),r.trigger("end",r),e.trigger("end "+r.id+":end",r),e.ids.indexOf(r.identifier)>=0&&e.ids.splice(e.ids.indexOf(r.identifier),1),e.actives.indexOf(r)>=0&&e.actives.splice(e.actives.indexOf(r),1),/(semi|static)/.test(i.mode)?e.idles.push(r):e.nipples.indexOf(r)>=0&&e.nipples.splice(e.nipples.indexOf(r),1),e.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(e.manager.ids[s.id]=s.identifier))},BK.prototype.onDestroyed=function(t,e){var i=this;i.nipples.indexOf(e)>=0&&i.nipples.splice(i.nipples.indexOf(e),1),i.actives.indexOf(e)>=0&&i.actives.splice(i.actives.indexOf(e),1),i.idles.indexOf(e)>=0&&i.idles.splice(i.idles.indexOf(e),1),i.ids.indexOf(e.identifier)>=0&&i.ids.splice(i.ids.indexOf(e.identifier),1),i.manager.removeIdentifier(e.identifier),i.manager.unbindDocument()},BK.prototype.destroy=function(){var t=this;for(var e in t.unbindEvt(t.options.zone,"start"),t.nipples.forEach((function(t){t.destroy()})),t.pressureIntervals)t.pressureIntervals.hasOwnProperty(e)&&clearInterval(t.pressureIntervals[e]);t.trigger("destroyed",t.nipples),t.manager.unbindDocument(),t.off()};var zK=BK;function FK(t){var e=this;e.ids={},e.index=0,e.collections=[],e.scroll=xK(),e.config(t),e.prepareCollections();var i=function(){var t;e.collections.forEach((function(i){i.forEach((function(i){t=i.el.getBoundingClientRect(),i.position={x:e.scroll.x+t.left,y:e.scroll.y+t.top}}))}))};if(typeof window>"u")return e.collections;vK(window,"resize",(function(){gK(i)}));var n=function(){e.scroll=xK()};return vK(window,"scroll",(function(){gK(n)})),e.collections}FK.prototype=new RK,FK.constructor=FK,FK.prototype.prepareCollections=function(){var t=this;t.collections.create=t.create.bind(t),t.collections.on=t.on.bind(t),t.collections.off=t.off.bind(t),t.collections.destroy=t.destroy.bind(t),t.collections.get=function(e){var i;return t.collections.every((function(t){return!(i=t.get(e))})),i}},FK.prototype.create=function(t){return this.createCollection(t)},FK.prototype.createCollection=function(t){var e=this,i=new zK(e,t);return e.bindCollection(i),e.collections.push(i),i},FK.prototype.bindCollection=function(t){var e,i=this,n=function(t,n){e=t.type+" "+n.id+":"+t.type,i.trigger(e,n)};t.on("destroyed",i.onDestroyed.bind(i)),t.on("shown hidden rested dir plain",n),t.on("dir:up dir:right dir:down dir:left",n),t.on("plain:up plain:right plain:down plain:left",n)},FK.prototype.bindDocument=function(){var t=this;t.binded||(t.bindEvt(document,"move").bindEvt(document,"end"),t.binded=!0)},FK.prototype.unbindDocument=function(t){var e=this;(!Object.keys(e.ids).length||!0===t)&&(e.unbindEvt(document,"move").unbindEvt(document,"end"),e.binded=!1)},FK.prototype.getIdentifier=function(t){var e;return t?void 0===(e=void 0===t.identifier?t.pointerId:t.identifier)&&(e=this.latest||0):e=this.index,void 0===this.ids[e]&&(this.ids[e]=this.index,this.index+=1),this.latest=e,this.ids[e]},FK.prototype.removeIdentifier=function(t){var e={};for(var i in this.ids)if(this.ids[i]===t){e.id=i,e.identifier=this.ids[i],delete this.ids[i];break}return e},FK.prototype.onmove=function(t){return this.onAny("move",t),!1},FK.prototype.onend=function(t){return this.onAny("end",t),!1},FK.prototype.oncancel=function(t){return this.onAny("end",t),!1},FK.prototype.onAny=function(t,e){var i,n=this,r="processOn"+t.charAt(0).toUpperCase()+t.slice(1);e=bK(e);var s=function(t,e,i){i.ids.indexOf(e)>=0&&(i[r](t),t._found_=!0)};return _K(e,(function(t){i=n.getIdentifier(t),_K(n.collections,s.bind(null,t,i)),t._found_||n.removeIdentifier(i)})),!1},FK.prototype.destroy=function(){var t=this;t.unbindDocument(!0),t.ids={},t.index=0,t.collections.forEach((function(t){t.destroy()})),t.off()},FK.prototype.onDestroyed=function(t,e){var i=this;if(i.collections.indexOf(e)<0)return!1;i.collections.splice(i.collections.indexOf(e),1)};var NK=new FK,UK=function(t){return NK.create(t)},VK=new Map,jK=new Map,GK=class{constructor(t,e,i,n){this.data=e;let{audio:r,volume:s,delay:a,loop:o}=e;if(!r)throw new Error("Missing property");let l="string"==typeof r?n.getAudio(r).src:r.data;this.audioPlayer=new AG({src:l,volume:s,delay:a,loop:o}),jK.has(i.uuid)?jK.get(i.uuid).push(this):jK.set(i.uuid,[this]),VK.set(t,this)}playByToggle(){"stop"===this.data.toggle?"playing"===this.audioPlayer.status?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):"pause"===this.data.toggle?"playing"===this.audioPlayer.status?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.stop()}},HK=class{constructor(t){this.data=t}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(t){let e=VK.get(t);!e||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{e.audioPlayer[this.data.interaction](),this.disposeDelay()}),this.data.delay)):e.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(t){let e=jK.get(t);!e?.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{e.forEach((t=>t.audioPlayer[this.data.interaction]())),this.disposeDelay()}),this.data.delay)):e.forEach((t=>t.audioPlayer[this.data.interaction]())))}pauseAllAudios(){let t=[...jK.values()];!t.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{t.forEach((t=>{t.forEach((t=>{t.audioPlayer[this.data.interaction]()}))})),this.disposeDelay()}),this.data.delay)):t.forEach((t=>{t.forEach((t=>{t.audioPlayer[this.data.interaction]()}))})))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},WK=class{constructor(t,e,i,n,r){if(this.data=e,this.shared=n,this.condition=r,"play"===e.interaction)this.interaction=new GK(t,e,i,n);else{if("pause"!==e.interaction&&"stop"!==e.interaction)throw new Error("Missing property");this.interaction=new HK(e)}}dispatchBasic(){if(!1===ZJ(this.shared,this.condition))return!1;this.interaction instanceof GK?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(!1===ZJ(this.shared,this.condition))return!1;this.interaction instanceof GK?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(t){if(!1===ZJ(this.shared,this.condition))return!1;this.interaction instanceof GK&&("start"===t?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}},qK=class{constructor(t,e,i,n){this.data=t,this.page=e,this.shared=i,this.condition=n,this.delay=0,this.emission=t.emission,void 0!==t.delay&&(this.delay=t.delay),this.particleSystem=this.page.scene.find(this.data.emitterObjectId)}toggleEmitting(){this.particleSystem.started&&!this.particleSystem.stopped?this.stop(this.delay):this.start(this.delay)}toggleFroze(){this.particleSystem.started&&!this.particleSystem.isFrozen?this.freeze(this.delay):this.unFreeze(this.delay)}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;t?this.delayTimerId=window.setTimeout((()=>{this.start(0),this.clearDelay()}),t):this.particleSystem.start()}stop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;t?this.delayTimerId=window.setTimeout((()=>{this.stop(0),this.clearDelay()}),t):this.particleSystem.stop()}freeze(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;t?this.delayTimerId=window.setTimeout((()=>{this.freeze(0),this.clearDelay()}),t):this.particleSystem.froze()}unFreeze(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;t?this.delayTimerId=window.setTimeout((()=>{this.unFreeze(0),this.clearDelay()}),t):this.particleSystem.unFroze()}reset(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;t?this.delayTimerId=window.setTimeout((()=>{this.reset(0),this.clearDelay()}),t):this.particleSystem.reset()}reverseFromCurrent(){switch(this.emission){case"emitToggle":this.toggleEmitting();break;case"pauseToggle":this.toggleFroze()}}dispatchBasic(){if(!1===ZJ(this.shared,this.condition)||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"emitToggle":this.toggleEmitting();break;case"pause":this.freeze(this.delay);break;case"pauseToggle":this.toggleFroze();break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay)}}dispatchConditional(){if(!1===ZJ(this.shared,this.condition)||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay)}}dispatchGameControl(t){if(!1===ZJ(this.shared,this.condition)||!this.particleSystem)return!1;"start"===t?this.start(this.delay):this.stop(this.delay)}dispose(){!this.particleSystem||(this.particleSystem.reset(),this.clearDelay())}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}},YK=(t,e)=>e.some((e=>e instanceof RegExp?e.test(t):e===t));function XK(t,e){if(e={defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0,...e},t=t.trim(),/^data:/i.test(t))return((t,e)=>{let{stripHash:i}=e,n=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(t);if(!n)throw new Error(`Invalid URL: ${t}`);let{type:r,data:s,hash:a}=n.groups,o=r.split(";");a=i?"":a;let l=!1;"base64"===o[o.length-1]&&(o.pop(),l=!0);let h=(o.shift()||"").toLowerCase(),c=[...o.map((t=>{let[e,i=""]=t.split("=").map((t=>t.trim()));return"charset"===e&&(i=i.toLowerCase(),"us-ascii"===i)?"":`${e}${i?`=${i}`:""}`})).filter(Boolean)];return l&&c.push("base64"),(c.length>0||h&&"text/plain"!==h)&&c.unshift(h),`data:${c.join(";")},${l?s.trim():s}${a?`#${a}`:""}`})(t,e);if(/^view-source:/i.test(t))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let i=t.startsWith("//");!i&&/^\.*\//.test(t)||(t=t.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,e.defaultProtocol));let n=new URL(t);if(e.forceHttp&&e.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(e.forceHttp&&"https:"===n.protocol&&(n.protocol="http:"),e.forceHttps&&"http:"===n.protocol&&(n.protocol="https:"),e.stripAuthentication&&(n.username="",n.password=""),e.stripHash?n.hash="":e.stripTextFragment&&(n.hash=n.hash.replace(/#?:~:text.*?$/i,"")),n.pathname){let t=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,e=0,i="";for(;;){let r=t.exec(n.pathname);if(!r)break;let s=r[0],a=r.index;i+=n.pathname.slice(e,a).replace(/\/{2,}/g,"/"),i+=s,e=a+s.length}i+=n.pathname.slice(e,n.pathname.length).replace(/\/{2,}/g,"/"),n.pathname=i}if(n.pathname)try{n.pathname=decodeURI(n.pathname)}catch{}if(!0===e.removeDirectoryIndex&&(e.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(e.removeDirectoryIndex)&&e.removeDirectoryIndex.length>0){let t=n.pathname.split("/"),i=t[t.length-1];YK(i,e.removeDirectoryIndex)&&(t=t.slice(0,-1),n.pathname=t.slice(1).join("/")+"/")}if(n.hostname&&(n.hostname=n.hostname.replace(/\.$/,""),e.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(n.hostname)&&(n.hostname=n.hostname.replace(/^www\./,""))),Array.isArray(e.removeQueryParameters))for(let s of[...n.searchParams.keys()])YK(s,e.removeQueryParameters)&&n.searchParams.delete(s);if(!0===e.removeQueryParameters&&(n.search=""),e.sortQueryParameters){n.searchParams.sort();try{n.search=decodeURIComponent(n.search)}catch{}}e.removeTrailingSlash&&(n.pathname=n.pathname.replace(/\/$/,""));let r=t;return t=n.toString(),!e.removeSingleSlash&&"/"===n.pathname&&!r.endsWith("/")&&""===n.hash&&(t=t.replace(/\/$/,"")),(e.removeTrailingSlash||"/"===n.pathname)&&""===n.hash&&e.removeSingleSlash&&(t=t.replace(/\/$/,"")),i&&!e.normalizeProtocol&&(t=t.replace(/^http:\/\//,"//")),e.stripProtocol&&(t=t.replace(/^(?:https?:)?\/\//,"")),t}var QK=class{constructor(t,e,i,n){let{url:r,context:s}=t;if(this.controlsManager=e,this.shared=i,this.condition=n,!r)throw new Error("Missing property");this.url=r.startsWith("mailto:")?r:XK(r,{removeTrailingSlash:!1,removeSingleSlash:!1,stripWWW:!1}),this.context=s??"tab"}dispatch(){if(!1===ZJ(this.shared,this.condition))return!1;lT?window.location.assign(this.url):("tab"===this.context||aT&&"none"===this.context?window.open(this.url,"_blank"):"window"===this.context?window.open(this.url,"_blank",`width=${window.innerWidth}, height=${window.innerHeight}`):window.open(this.url,"_parent"),this.controlsManager.orbitControls?.onPointerUp(gT[0]),gT.splice(0,gT.length))}},KK=class{constructor(t,e,i,n,r){this.data=t,this.page=e,this.controlsManager=i,this.shared=n,this.condition=r,this.timeoutIdQueue=[],this.dispatchInner=()=>{this.objects.forEach(this.destroyCallback)},this.destroyCallback=t=>{this.timeoutIdQueue.shift();let e=this.page.scene.find(t);if(void 0===e)return;let i=this.controlsManager.sharedGameControlGlobals.rapierWorld,n=!i||e.dataPatched.physics?.fusedBody;if(e.cloner){for(let t of e.cloner.children)n?(t.playModeVisible=!1,t.rigidBody&&"positioned"===e.dataPatched.physics?.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(t.rigidBody.collider(0).handle),i.removeRigidBody(t.rigidBody),t.rigidBody=void 0),t.bvhGeometry&&(t.bvhGeometry=void 0)):void 0===this.clone||this.clone===t?(t.playModeVisible=!1,t.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(t.rigidBody.collider(0).handle),i.removeRigidBody(t.rigidBody),t.rigidBody=void 0)):void 0===t.playModeVisible&&(t.playModeVisible=!0);(n||void 0===this.clone||!1===this.clone)&&(e.visible=!1,e.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(e.rigidBody.collider(0).handle),i.removeRigidBody(e.rigidBody),e.rigidBody=void 0),e.bvhGeometry&&(e.bvhGeometry=void 0))}else e.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(e.rigidBody.collider(0).handle),i.removeRigidBody(e.rigidBody),e.rigidBody=void 0),e.bvhGeometry&&(e.bvhGeometry=void 0),e.visible=!1;this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=void 0===i?this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter((t=>void 0!==t.bvhGeometry)):this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter((t=>void 0!==t.rigidBody)),e.destroyedInAction=!0,this.controlsManager.requestRender()},this.objects=[...t.objects]}dispatch(t){if(!1===ZJ(this.shared,this.condition))return!1;this.clone=t,this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay)):this.dispatchInner()}dispatchFromStart(){if(!1===ZJ(this.shared,this.condition))return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay))}dispose(){this.timeoutIdQueue.forEach((t=>window.clearTimeout(t)))}},ZK=class{constructor(t,e,i,n,r){this.data=t,this.page=e,this.shared=i,this.eventManager=n,this.condition=r,this.shared=i}dispatch(){if(!1===ZJ(this.shared,this.condition))return!1;clearTimeout(this.timeoutId),delete this.timeoutId,this.timeoutId=window.setTimeout((()=>{this.shared.reset(this.shared.data,!0),DJ(this.page,this.shared,!0),this.eventManager.reset(),this.eventManager.controlsManager.gameControl?.reset(!0),this.page.switchToPlayCamera(),this.eventManager.controlsManager.requestRender(),delete this.timeoutId}),1e3*(this.data.delay??0))}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},JK={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,timelineChangeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},$K={duration:1e3,delay:0,endDelay:0,startOnceDelay:0,pingPongDelayCorrection:0,pingPongEndDelayCorrection:0,easing:"easeOutElastic(1, .5)",round:0},tZ=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],eZ={CSS:{},springs:{}};function iZ(t,e,i){return Math.min(Math.max(t,e),i)}function nZ(t,e){return t.indexOf(e)>-1}function rZ(t,e){return t.apply(null,e)}var sZ={arr:function(t){return Array.isArray(t)},obj:function(t){return nZ(Object.prototype.toString.call(t),"Object")},pth:function(t){return sZ.obj(t)&&t.hasOwnProperty("totalLength")},svg:function(t){return t instanceof SVGElement},inp:function(t){return t instanceof HTMLInputElement},dom:function(t){return!("isNode"in t)&&(t.nodeType||sZ.svg(t))},str:function(t){return"string"==typeof t},fnc:function(t){return"function"==typeof t},und:function(t){return typeof t>"u"},hex:function(t){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t)},rgb:function(t){return/^rgb/.test(t)},hsl:function(t){return/^hsl/.test(t)},col:function(t){return sZ.hex(t)||sZ.rgb(t)||sZ.hsl(t)},key:function(t){return!JK.hasOwnProperty(t)&&!$K.hasOwnProperty(t)&&"targets"!==t&&"keyframes"!==t}};function aZ(t){var e=/\(([^)]+)\)/.exec(t);return e?e[1].split(",").map((function(t){return parseFloat(t)})):[]}function oZ(t,e){var i=aZ(t),n=iZ(sZ.und(i[0])?1:i[0],.1,100),r=iZ(sZ.und(i[1])?100:i[1],.1,100),s=iZ(sZ.und(i[2])?10:i[2],.1,100),a=iZ(sZ.und(i[3])?0:i[3],.1,100),o=Math.sqrt(r/n),l=s/(2*Math.sqrt(r*n)),h=l<1?o*Math.sqrt(1-l*l):0,c=l<1?(l*o-a)/h:-a+o;function u(t){var i=e?e*t/1e3:t;return i=l<1?Math.exp(-i*l*o)*(1*Math.cos(h*i)+c*Math.sin(h*i)):(1+c*i)*Math.exp(-i*o),0===t||1===t?t:1-i}return e?u:function(){var e=eZ.springs[t];if(e)return e;for(var i=1/6,n=0,r=0;;)if(1===u(n+=i)){if(++r>=16)break}else r=0;var s=n*i*1e3;return eZ.springs[t]=s,s}}function lZ(t){return void 0===t&&(t=10),function(e){return Math.ceil(iZ(e,1e-6,1)*t)*(1/t)}}var hZ=function(){var t=.1;function e(t,e){return 1-3*e+3*t}function i(t,e){return 3*e-6*t}function n(t){return 3*t}function r(t,r,s){return((e(r,s)*t+i(r,s))*t+n(r))*t}function s(t,r,s){return 3*e(r,s)*t*t+2*i(r,s)*t+n(r)}return function(e,i,n,a){if(0<=e&&e<=1&&0<=n&&n<=1){var o=new Float32Array(11);if(e!==i||n!==a)for(var l=0;l<11;++l)o[l]=r(l*t,e,n);return function(t){return e===i&&n===a||0===t||1===t?t:r(h(t),i,a)}}function h(i){for(var a=0,l=1;10!==l&&o[l]<=i;++l)a+=t;--l;var h=a+(i-o[l])/(o[l+1]-o[l])*t,c=s(h,e,n);return c>=.001?function(t,e,i,n){for(var a=0;a<4;++a){var o=s(e,i,n);if(0===o)return e;e-=(r(e,i,n)-t)/o}return e}(i,h,e,n):0===c?h:function(t,e,i,n,s){var a,o,l=0;do{(a=r(o=e+(i-e)/2,n,s)-t)>0?i=o:e=o}while(Math.abs(a)>1e-7&&++l<10);return o}(i,a,a+t,e,n)}}}(),cZ=function(){var t={linear:function(){return function(t){return t}}},e={Sine:function(){return function(t){return 1-Math.cos(t*Math.PI/2)}},Circ:function(){return function(t){return 1-Math.sqrt(1-t*t)}},Back:function(){return function(t){return t*t*(3*t-2)}},Bounce:function(){return function(t){for(var e,i=4;t<((e=Math.pow(2,--i))-1)/11;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*e-2)/22-t,2)}},Elastic:function(t,e){void 0===t&&(t=1),void 0===e&&(e=.5);var i=iZ(t,1,10),n=iZ(e,.1,2);return function(t){return 0===t||1===t?t:-i*Math.pow(2,10*(t-1))*Math.sin((t-1-n/(2*Math.PI)*Math.asin(1/i))*(2*Math.PI)/n)}}};return["Quad","Cubic","Quart","Quint","Expo"].forEach((function(t,i){e[t]=function(){return function(t){return Math.pow(t,i+2)}}})),Object.keys(e).forEach((function(i){var n=e[i];t["easeIn"+i]=n,t["easeOut"+i]=function(t,e){return function(i){return 1-n(t,e)(1-i)}},t["easeInOut"+i]=function(t,e){return function(i){return i<.5?n(t,e)(2*i)/2:1-n(t,e)(-2*i+2)/2}}})),t}();function uZ(t,e){if(sZ.fnc(t))return t;var i=t.split("(")[0],n=cZ[i],r=aZ(t);switch(i){case"spring":return oZ(t,e);case"cubicBezier":return rZ(hZ,r);case"steps":return rZ(lZ,r);default:return rZ(n,r)}}function dZ(t){try{return document.querySelectorAll(t)}catch{return}}function pZ(t,e){for(var i=t.length,n=arguments.length>=2?arguments[1]:void 0,r=[],s=0;s<i;s++)if(s in t){var a=t[s];e.call(n,a,s,t)&&r.push(a)}return r}function fZ(t){return t.reduce((function(t,e){return t.concat(sZ.arr(e)?fZ(e):e)}),[])}function mZ(t){return sZ.arr(t)?t:(sZ.str(t)&&(t=dZ(t)||t),t instanceof NodeList||t instanceof HTMLCollection?[].slice.call(t):[t])}function gZ(t,e){return t.some((function(t){return t===e}))}function vZ(t){var e={};for(var i in t)e[i]=t[i];return e}function yZ(t,e){var i=vZ(t);for(var n in t)i[n]=e.hasOwnProperty(n)?e[n]:t[n];return i}function bZ(t,e){var i=vZ(t);for(var n in e)i[n]=sZ.und(t[n])?e[n]:t[n];return i}function xZ(t){return sZ.rgb(t)?function(t){var e=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(t);return e?"rgba("+e[1]+",1)":t}(t):sZ.hex(t)?function(t){var e=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(t,e,i,n){return e+e+i+i+n+n})),i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return"rgba("+parseInt(i[1],16)+","+parseInt(i[2],16)+","+parseInt(i[3],16)+",1)"}(t):sZ.hsl(t)?function(t){var e,i,n,r=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(t),s=parseInt(r[1],10)/360,a=parseInt(r[2],10)/100,o=parseInt(r[3],10)/100,l=r[4]||1;function h(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}if(0==a)e=i=n=o;else{var c=o<.5?o*(1+a):o+a-o*a,u=2*o-c;e=h(u,c,s+1/3),i=h(u,c,s),n=h(u,c,s-1/3)}return"rgba("+255*e+","+255*i+","+255*n+","+l+")"}(t):void 0}function wZ(t){var e=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(t);if(e)return e[1]}function SZ(t,e){return sZ.fnc(t)?t(e.target,e.id,e.total):t}function AZ(t,e){return t.getAttribute(e)}function EZ(t,e,i){if(gZ([i,"deg","rad","turn"],wZ(e)))return e;var n=eZ.CSS[e+i];if(!sZ.und(n))return n;var r=document.createElement(t.tagName),s=t.parentNode&&t.parentNode!==document?t.parentNode:document.body;s.appendChild(r),r.style.position="absolute",r.style.width=100+i;var a=100/r.offsetWidth;s.removeChild(r);var o=a*parseFloat(e);return eZ.CSS[e+i]=o,o}function _Z(t,e,i){if(e in t.style){var n=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),r=t.style[e]||getComputedStyle(t).getPropertyValue(n)||"0";return i?EZ(t,r,i):r}}function CZ(t,e){return sZ.dom(t)&&!sZ.inp(t)&&(AZ(t,e)||sZ.svg(t)&&t[e])?"attribute":sZ.dom(t)&&gZ(tZ,e)?"transform":sZ.dom(t)&&"transform"!==e&&_Z(t,e)?"css":null!=t[e]?"object":void 0}function MZ(t){if(sZ.dom(t)){for(var e,i=t.style.transform||"",n=/(\w+)\(([^)]*)\)/g,r=new Map;e=n.exec(i);)r.set(e[1],e[2]);return r}}function PZ(t,e,i,n){var r=nZ(e,"scale")?1:0+function(t){return nZ(t,"translate")||"perspective"===t?"px":nZ(t,"rotate")||nZ(t,"skew")?"deg":void 0}(e),s=MZ(t).get(e)||r;return i&&(i.transforms.list.set(e,s),i.transforms.last=e),n?EZ(t,s,n):s}function TZ(t,e,i,n){switch(CZ(t,e)){case"transform":return PZ(t,e,n,i);case"css":return _Z(t,e,i);case"attribute":return AZ(t,e);default:return t[e]||0}}function DZ(t,e){var i=/^(\*=|\+=|-=)/.exec(t);if(!i)return t;var n=wZ(t)||0,r=parseFloat(e),s=parseFloat(t.replace(i[0],""));switch(i[0][0]){case"+":return r+s+n;case"-":return r-s+n;case"*":return r*s+n}}function kZ(t,e){if(sZ.col(t))return xZ(t);if(/\s/g.test(t))return t;var i=wZ(t),n=i?t.substr(0,t.length-i.length):t;return e?n+e:n}function IZ(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function RZ(t){for(var e,i=t.points,n=0,r=0;r<i.numberOfItems;r++){var s=i.getItem(r);r>0&&(n+=IZ(e,s)),e=s}return n}function OZ(t){if(t.getTotalLength)return t.getTotalLength();switch(t.tagName.toLowerCase()){case"circle":return function(t){return 2*Math.PI*AZ(t,"r")}(t);case"rect":return function(t){return 2*AZ(t,"width")+2*AZ(t,"height")}(t);case"line":return function(t){return IZ({x:AZ(t,"x1"),y:AZ(t,"y1")},{x:AZ(t,"x2"),y:AZ(t,"y2")})}(t);case"polyline":return RZ(t);case"polygon":return function(t){var e=t.points;return RZ(t)+IZ(e.getItem(e.numberOfItems-1),e.getItem(0))}(t)}}function LZ(t,e){var i=e||{},n=i.el||function(t){for(var e=t.parentNode;sZ.svg(e)&&sZ.svg(e.parentNode);)e=e.parentNode;return e}(t),r=n.getBoundingClientRect(),s=AZ(n,"viewBox"),a=r.width,o=r.height,l=i.viewBox||(s?s.split(" "):[0,0,a,o]);return{el:n,viewBox:l,x:l[0]/1,y:l[1]/1,w:a/l[2],h:o/l[3]}}function BZ(t,e){function i(i){void 0===i&&(i=0);var n=e+i>=1?e+i:0;return t.el.getPointAtLength(n)}var n=LZ(t.el,t.svg),r=i(),s=i(-1),a=i(1);switch(t.property){case"x":return(r.x-n.x)*n.w;case"y":return(r.y-n.y)*n.h;case"angle":return 180*Math.atan2(a.y-s.y,a.x-s.x)/Math.PI}}function zZ(t,e){var i=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,n=kZ(sZ.pth(t)?t.totalLength:t,e)+"";return{original:n,numbers:n.match(i)?n.match(i).map(Number):[0],strings:sZ.str(t)||e?n.split(i):[]}}function FZ(t){return pZ(t?fZ(sZ.arr(t)?t.map(mZ):mZ(t)):[],(function(t,e,i){return i.indexOf(t)===e}))}function NZ(t){var e=FZ(t);return e.map((function(t,i){return{target:t,id:i,total:e.length,transforms:{list:MZ(t)}}}))}function UZ(t,e){var i=vZ(e);if(/^spring/.test(i.easing)&&(i.duration=oZ(i.easing)),sZ.arr(t)){var n=t.length;2===n&&!sZ.obj(t[0])?t={value:t}:sZ.fnc(e.duration)||(i.duration=e.duration/n)}var r=sZ.arr(t)?t:[t];return r.map((function(t,i){var n=sZ.obj(t)&&!sZ.pth(t)?t:{value:t};return sZ.und(n.delay)&&(n.delay=i?0:e.delay),sZ.und(n.endDelay)&&(n.endDelay=i===r.length-1?e.endDelay:0),n})).map((function(t){return bZ(t,i)}))}function VZ(t,e){var i=[],n=e.keyframes;for(var r in n&&(e=bZ(function(t){for(var e=pZ(fZ(t.map((function(t){return Object.keys(t)}))),(function(t){return sZ.key(t)})).reduce((function(t,e){return t.indexOf(e)<0&&t.push(e),t}),[]),i={},n=function(n){var r=e[n];i[r]=t.map((function(t){var e={};for(var i in t)sZ.key(i)?i==r&&(e.value=t[i]):e[i]=t[i];return e}))},r=0;r<e.length;r++)n(r);return i}(n),e)),e)sZ.key(r)&&i.push({name:r,tweens:UZ(e[r],t)});return i}function jZ(t,e){var i;return t.tweens.map((function(n){var r=function(t,e){var i={};for(var n in t){var r=SZ(t[n],e);sZ.arr(r)&&(r=r.map((function(t){return SZ(t,e)})),1===r.length&&(r=r[0])),i[n]=r}return i.duration=parseFloat(i.duration),i.delay=parseFloat(i.delay),i}(n,e),s=r.value,a=sZ.arr(s)?s[1]:s,o=wZ(a),l=TZ(e.target,t.name,o,e),h=i?i.to.original:l,c=sZ.arr(s)?s[0]:h,u=wZ(c)||wZ(l),d=o||u;return sZ.und(a)&&(a=h),r.from=zZ(c,d),r.to=zZ(DZ(a,c),d),r.start=i?i.end:0,r.end=r.start+r.delay+r.duration+r.endDelay,r.easing=uZ(r.easing,r.duration),r.isPath=sZ.pth(s),r.isColor=sZ.col(r.from.original),r.isColor&&(r.round=1),i=r,r}))}var GZ={css:function(t,e,i){return t.style[e]=i},attribute:function(t,e,i){return t.setAttribute(e,i)},object:function(t,e,i){return t[e]=i},transform:function(t,e,i,n,r){if(n.list.set(e,i),e===n.last||r){var s="";n.list.forEach((function(t,e){s+=e+"("+t+") "})),t.style.transform=s}}};function HZ(t,e){NZ(t).forEach((function(t){for(var i in e){var n=SZ(e[i],t),r=t.target,s=wZ(n),a=TZ(r,i,s,t),o=DZ(kZ(n,s||wZ(a)),a),l=CZ(r,i);GZ[l](r,i,o,t.transforms,!0)}}))}function WZ(t,e){return pZ(fZ(t.map((function(t){return e.map((function(e){return function(t,e){var i=CZ(t.target,e.name);if(i){var n=jZ(e,t),r=n[n.length-1];return{type:i,property:e.name,animatable:t,tweens:n,duration:r.end,delay:n[0].delay,endDelay:r.endDelay}}}(t,e)}))}))),(function(t){return!sZ.und(t)}))}function qZ(t,e){var i=t.length,n=function(t){return t.timelineOffset?t.timelineOffset:0},r={};return r.duration=i?Math.max.apply(Math,t.map((function(t){let e=t.startOnceDelay??0,i=t.pingPongDelayCorrection??0,r=t.pingPongEndDelayCorrection??0;return n(t)+e+i+r+t.duration*(t.loop??1)}))):e.duration,r.delay=i?Math.min.apply(Math,t.map((function(t){let e=t.startOnceDelay??0,i=t.pingPongDelayCorrection??0;return n(t)+e+i+t.delay}))):e.delay,r.endDelay=i?r.duration-Math.max.apply(Math,t.map((function(t){let e=t.startOnceDelay??0,i=t.pingPongDelayCorrection??0,r=t.pingPongEndDelayCorrection??0;return n(t)+e+i+t.duration*(t.loop??1)-t.endDelay-r}))):e.endDelay,r}var YZ=0;var XZ,QZ=[],KZ=[],ZZ=function(){function t(){XZ=requestAnimationFrame(e)}function e(e){var i=QZ.length;if(i){for(var n=0;n<i;){var r=QZ[n];r.paused?(QZ.splice(n,1),i-=1):(r.tick(e),n++)}t()}else XZ=cancelAnimationFrame(XZ)}return t}();function JZ(t){void 0===t&&(t={});var e,i,n=0,r=0,s=0,a=0,o=null;function l(t){var e=window.Promise&&new Promise((function(t){return o=t}));return t.finished=e,e}var h=function(t){var e=yZ(JK,t),i=yZ($K,t),n=VZ(i,t),r=NZ(t.targets),s=WZ(r,n),a=qZ(s,i),o=YZ;return YZ++,bZ(e,{id:o,children:[],animatables:r,animations:s,duration:a.duration,delay:a.delay,endDelay:a.endDelay,startOnceDelay:i.startOnceDelay,pingPongDelayCorrection:i.pingPongDelayCorrection,pingPongEndDelayCorrection:i.pingPongEndDelayCorrection})}(t);l(h);function c(){var t=h.direction;"alternate"!==t&&(h.direction="normal"!==t?"normal":"reverse"),h.reversed=!h.reversed,i.forEach((function(t){(1===t.loop||t.loop%2===0)&&(t.reversed=h.reversed)}))}function u(t){return h.reversed?h.duration-t:t}function d(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e&&(h.reversed?e.seek(e.duration*e.loop-(t-e.timelineOffset-e.pingPongDelayCorrection),i):e.seek(t-e.timelineOffset-e.startOnceDelay-e.pingPongDelayCorrection,i))}function p(t){var e=0,i=h.animations,n=i.length;for("alternate"!==h.direction&&"alternate"===h.parent?.direction?!1===h.parent?.rewind&&!0===h.reversePlayback&&!1===h.rewind&&(t=h.parent?.reversed&&"alternate"===h.direction?h.duration-h.delay+h.endDelay-t:h.duration+h.delay-h.endDelay-t):g(!1,h.parent?.rewind,h.rewind,h.parent?.reversePlayback,h.reversePlayback)&&(t=h.parent?.reversed&&"alternate"===h.direction?h.duration-h.delay+h.endDelay-t:h.duration+h.delay-h.endDelay-t);e<n;){var r=i[e],s=r.animatable,a=r.tweens,o=a.length-1,l=a[o];let n;o&&(l=pZ(a,(function(e){return t<e.end}))[0]||l),n=h.parent?.reversed&&"alternate"===h.direction?iZ(t-l.start-l.endDelay,0,l.duration)/l.duration:iZ(t-l.start-l.delay,0,l.duration)/l.duration;for(var c=isNaN(n)?1:l.easing(n),u=l.to.strings,d=l.round,p=[],f=l.to.numbers.length,m=void 0,v=0;v<f;v++){var y=void 0;let t,e;"alternate"!==h.direction?!1===h.parent?.rewind&&!0===h.reversePlayback&&!1===h.rewind?(t=l.to.numbers[v],e=l.from.numbers[v]||0):(e=l.to.numbers[v],t=l.from.numbers[v]||0):g(!0,h.parent?.rewind,h.rewind,h.parent?.reversePlayback,h.reversePlayback)?(t=l.to.numbers[v],e=l.from.numbers[v]||0):(e=l.to.numbers[v],t=l.from.numbers[v]||0),y=l.isPath?BZ(l.value,c*e):t+c*(e-t),d&&(l.isColor&&v>2||(y=Math.round(y*d)/d)),p.push(y)}var b=u.length;if(b){m=u[0];for(var x=0;x<b;x++){u[x];var w=u[x+1],S=p[x];isNaN(S)||(m+=w?S+w:S+" ")}}else m=p[0];GZ[r.type](s.target,r.property,m,s.transforms),r.currentValue=m,e++}}function f(t){h[t]&&!h.passThrough&&h[t](h)}let m={0:!1,1:!0,2:!1,3:!0,4:!1,5:!1,6:!1,7:!1,8:!1,9:!0,10:!0,11:!1,12:!1,13:!1,14:!0,15:!0,16:!1,17:!0,18:!0,19:!1,20:!1,21:!1,22:!0,23:!0,24:!1,25:!0,26:!1,27:!0,28:!1,29:!1,30:!1,31:!1};function g(t,e,i,n,r){return m[t<<4|e<<3|i<<2|n<<1|r]}function v(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var r=h.duration;let s=h.delay,m=r-h.endDelay;h.parent?.reversed&&"alternate"===h.direction&&(s=h.endDelay,m=r-h.delay);var g=u(t);if(h.progress=iZ(g/r*100,0,100),e||(h.reversePlayback=g<h.currentTime),a&&function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(h.reversed)for(var n=a;n--;)d(t,i[n],e);else for(var r=0;r<a;r++)d(t,i[r],e)}(g,e),!h.began&&h.currentTime>=0&&(h.began=!0,f("begin")),!h.loopBegan&&h.currentTime>0&&(h.loopBegan=!0,f("loopBegin")),(h.reversed||g>=0)&&g<=s&&0!==h.currentTime&&(p(0),f("change")),(g>=m&&h.currentTime!==r+h.pingPongDelayCorrection||!r)&&(p(r),f("change")),g>s&&g<m?(h.changeBegan||(h.changeBegan=!0,h.changeCompleted=!1,f("changeBegin")),p(g),f("change")):h.changeBegan?(h.changeCompleted=!0,h.changeBegan=!1,f("change"),a&&f("timelineChangeComplete")):h.began&&g>m&&f("changeComplete"),h.currentTime=iZ(g,0,r+h.pingPongDelayCorrection),h.began&&f("update"),t>=r)if(h.remaining&&!0!==h.remaining&&h.remaining--,h.remaining){n+=a?h.duration/JZ.speed:h.duration;for(let t of i)t.setStartTime(0),t.remaining=t.loop;f("loopComplete"),h.loopBegan=!1,"alternate"===h.direction?c():a&&(h.direction="normal",h.reversed=!1,i.forEach((function(t){return t.reversed=!1})))}else h.paused=!0,h.completed||(h.completed=!0,f("loopComplete"),f("complete"),!h.passThrough&&"Promise"in window&&(o(),l(h)))}return h.reset=function(){var t=h.direction;h.passThrough=!1,h.currentTime=0,h.progress=0,h.paused=!0,h.began=!1,h.loopBegan=!1,h.changeBegan=!1,h.completed=!1,h.changeCompleted=!1,h.reversePlayback=!1,h.reversed="reverse"===t,h.remaining=h.loop,i=h.children;for(var e=a=i.length;e--;)h.children[e].reset();p(h.reversed?h.duration:0)},h.setStartTime=function(t){n=t},h.set=function(t,e){return HZ(t,e),h},h.tick=function(t){s=t,n||(n=s),v((s+(r-n))*JZ.speed)},h.seek=function(t){v(t-n,arguments.length>1&&void 0!==arguments[1]&&arguments[1])},h.pause=function(t){h.paused=!0,a&&(e=t??performance.now())},h.play=function(t){!h.paused||(h.completed&&h.reset(),h.paused=!1,QZ.push(h),a&&void 0!==e&&(n+=(t??performance.now())-e),XZ||ZZ())},h.reverse=function(){c(),h.completed=!h.reversed,n=0,r=u(h.currentTime)*(1/JZ.speed)},h.restart=function(){h.reset(),h.play()},h.reset(),h.autoplay&&h.play(),h}function $Z(t,e){for(var i=e.length;i--;)gZ(t,e[i].animatable.target)&&e.splice(i,1)}typeof document<"u"&&document.addEventListener("visibilitychange",(function(t){document.hidden?(QZ.forEach((function(e){return e.pause(t.timeStamp)})),KZ=QZ.slice(0),JZ.running=QZ=[]):KZ.forEach((function(e){return e.play(t.timeStamp)}))})),JZ.version="3.2.0",JZ.speed=1,JZ.running=QZ,JZ.remove=function(t){for(var e=FZ(t),i=QZ.length;i--;){var n=QZ[i],r=n.animations,s=n.children;$Z(e,r);for(var a=s.length;a--;){var o=s[a],l=o.animations;$Z(e,l),!l.length&&!o.children.length&&s.splice(a,1)}!r.length&&!s.length&&n.pause()}},JZ.get=TZ,JZ.set=HZ,JZ.convertPx=EZ,JZ.path=function(t,e){var i=sZ.str(t)?dZ(t)[0]:t,n=e||100;return function(t){return{property:t,el:i,svg:LZ(i),totalLength:OZ(i)*(n/100)}}},JZ.setDashoffset=function(t){var e=OZ(t);return t.setAttribute("stroke-dasharray",e),e},JZ.stagger=function(t,e){void 0===e&&(e={});var i=e.direction||"normal",n=e.easing?uZ(e.easing):null,r=e.grid,s=e.axis,a=e.from||0,o="first"===a,l="center"===a,h="last"===a,c=sZ.arr(t),u=parseFloat(c?t[0]:t),d=c?parseFloat(t[1]):0,p=wZ(c?t[1]:t)||0,f=e.start||0+(c?u:0),m=[],g=0;return function(t,e,v){if(o&&(a=0),l&&(a=(v-1)/2),h&&(a=v-1),!m.length){for(var y=0;y<v;y++){if(r){var b=l?(r[0]-1)/2:a%r[0],x=l?(r[1]-1)/2:Math.floor(a/r[0]),w=b-y%r[0],S=x-Math.floor(y/r[0]),A=Math.sqrt(w*w+S*S);"x"===s&&(A=-w),"y"===s&&(A=-S),m.push(A)}else m.push(Math.abs(a-y));g=Math.max.apply(Math,m)}n&&(m=m.map((function(t){return n(t/g)*g}))),"reverse"===i&&(m=m.map((function(t){return s?t<0?-1*t:-t:Math.abs(g-t)})))}return f+(c?(d-u)/g:u)*(Math.round(100*m[e])/100)+p}},JZ.timeline=function(t){void 0===t&&(t={});var e=JZ(t);return e.duration=0,e.add=function(i,n){var r=QZ.indexOf(e),s=e.children;function a(t){t.passThrough=!0}r>-1&&QZ.splice(r,1);for(var o=0;o<s.length;o++)a(s[o]);var l=bZ(i,yZ($K,t));l.targets=l.targets||t.targets;var h=e.duration;l.autoplay=!1,l.timelineOffset=sZ.und(n)?h:DZ(n,h),a(e);var c=JZ(l);a(c),s.push(c),c.parent=e;var u=qZ(s,t);return e.delay=u.delay,e.endDelay=u.endDelay,e.duration=u.duration,!0===c.loop&&(e.duration=1/0),e.seek(0),e.reset(),e.autoplay&&e.play(),e},e},JZ.easing=uZ,JZ.penner=cZ,JZ.random=function(t,e){return Math.floor(Math.random()*(e-t+1))+t};var tJ=JZ,eJ=new mm,iJ=new mm,nJ=new fm;function rJ(t,e,i,n,r,s){let a=void 0!==i[t]?i[t]:void 0,o=n[t];if(null==o)return;let l=null!=a?"string"==typeof a?Number(r.getVariable(a)??0):a:e[t],h="string"==typeof o?Number(r.getVariable(o)??0):o;return l!==h?{update:i=>{let n=Nf.lerp(l,h,i);e[t]=s?Math.trunc(n):n},start:()=>{e[t]=l},end:()=>{e[t]=h}}:void 0}function sJ(t,e,i,n,r,s){let a=i[t]?i[t]:void 0,o=n[t];if(!o)return;let l=e[t],h=[...a??l].map((t=>"string"==typeof t?Number(r.getVariable(t)??0):t)),c=[...o].map((t=>"string"==typeof t?Number(r.getVariable(t)??0):t));return h.length!==c.length||WP(h,c)?void 0:{update:i=>{h.forEach(((n,r)=>{let a=Nf.lerp(n,c[r],i);e[t][r]=s?Math.trunc(a):a}))},start:()=>{Object.assign(e[t],h)},end:()=>{Object.assign(e[t],c)}}}function aJ(t,e,i){return e.forEach(((e,n)=>{t.setComponent(n,"string"==typeof e?Number(i.getVariable(e)??0):e)})),t}function oJ(t,e,i,n,r){let s=i[t]?i[t]:void 0,a=n[t];if(!a)return;let o=e[t],l=s?aJ(new mm,s,r):o.clone(),h=aJ(new mm,a,r);return l.equals(h)?void 0:{update:t=>{o.lerpVectors(l,h,t)},start:()=>{o.copy(l)},end:()=>{o.copy(h)}}}function lJ(t,e,i){return e.forEach(((e,n)=>{t.setComponent(n,"string"==typeof e?Number(i.getVariable(e)??0):e)})),t}function hJ(t,e,i,n,r){let s=i[t]?i[t]:void 0,a=n[t];if(!a)return;let o=e[t],l=!(o instanceof Uf),h=o instanceof Uf?o:(new Uf).fromArray(o),c=s?lJ(new Uf,s,r):h.clone(),u=lJ(new Uf,a,r);return c.equals(u)?void 0:{update:i=>{h.lerpVectors(c,u,i),l&&(e[t]=h.toArray())},start:()=>{h.copy(c),l&&(e[t]=h.toArray())},end:()=>{h.copy(u),l&&(e[t]=h.toArray())}}}function cJ(t,e,i,n,r){let s=i[t]?i[t]:void 0,a=n[t];if(!a)return;let o=e[t],l=new LU(o.r,o.g,o.b,o.a),h=s?"string"==typeof s?r.getColor(s).clone():new LU(s.r,s.g,s.b,s.a):l.clone(),c="string"==typeof a?r.getColor(a).clone():new LU(a.r,a.g,a.b,a.a);return h.equals(c)?void 0:{update:i=>{l.lerpColors(h,c,i);let n=Nf.lerp(h.a,c.a,i);l.a=n,e[t]={r:l.r,g:l.g,b:l.b,a:l.a}},start:()=>{l.copy(h)},end:()=>{l.copy(c)}}}function uJ(t,e,i,n,r){return"number"==typeof e[t]?rJ(t,e,i??{},n,r):Array.isArray(e[t])?sJ(t,e,i??{},n,r):void 0}function dJ(t,e,i,n){let r=[];if(!("geometry"in i))return r;let s=t.geometry.userData.parameters,a="geometry"in e?e.geometry:{},o=i.geometry;if(t instanceof CH){let e=function(t,e,i,n){if(void 0===i.scaleBaked)return;let r=(e.scaleBaked??t.data.geometry.scaleBaked).map((t=>"string"==typeof t?Number(n.getVariable(t)??0):t)),s=i.scaleBaked.map((t=>"string"==typeof t?Number(n.getVariable(t)??0):t));if(EI.isEqual(r,s))return;let a=[];return a.push({update:e=>{t.updateGeometryInteractions({scaleBaked:[Nf.lerp(r[0],s[0],e),Nf.lerp(r[1],s[1],e),Nf.lerp(r[2],s[2],e)]},n),t.invalidateDownstreamBooleanData(),t.refreshAttachedClonersInteractions()},start:()=>{t.updateGeometryInteractions({scaleBaked:r},n),t.invalidateDownstreamBooleanData(),t.refreshAttachedClonersInteractions()},end:()=>{t.updateGeometryInteractions({scaleBaked:s},n),t.invalidateDownstreamBooleanData(),t.refreshAttachedClonersInteractions()}}),a}(t,a,o,n);e&&r.push(...e)}else{let e={};if(Object.assign(e,iT(s,uO),iT(a,uO)),uO.forEach((t=>{let i=uJ(t,e,a,o,n);i&&r.push(i)})),t instanceof nQ){Object.assign(e,{extrusion:{...s.extrusion}});let t=function(t,e,i,n){if(!i.extrusion)return;let r=t.extrusion,s=e.extrusion??{},a=i.extrusion,o=[];return SR.forEach((t=>{let e=uJ(t,r,s,a,n);e&&o.push(e)})),o}(e,a,o,n);t&&r.push(...t)}r.length&&r.push({update:i=>{t.updateGeometryInteractions(e,n),t.updateGeometryGroupsIfNeeded(),t.refreshAttachedClonersInteractions()},start:i=>{t.updateGeometryInteractions(e,n),t.updateGeometryGroupsIfNeeded(),t.refreshAttachedClonersInteractions()},end:i=>{t.updateGeometryInteractions(e,n),t.updateGeometryGroupsIfNeeded(),t.refreshAttachedClonersInteractions()}})}return r}function pJ(t,e,i,n){let r=[];if(void 0!==i.intensity){let s=rJ("intensity",t,e,i,n);s&&r.push(s)}if(void 0!==i.color){let s=function(t,e,i,n,r){let s=i[t]?i[t]:void 0,a=n[t];if(!a)return;let o=e[t],l=s?"string"==typeof s?r.getColor(s).clone():(new nm).setRGB(s.r,s.g,s.b):o.clone(),h="string"==typeof a?r.getColor(a).clone():(new nm).setRGB(a.r,a.g,a.b);if(l.equals(h))return;let c=o.clone();return{update:i=>{c.lerpColors(l,h,i),e[t]?.copy?.(c)},start:()=>{c.copy(l)},end:()=>{c.copy(h)}}}("color",t,e,i,n);s&&r.push(s)}return r}function fJ(t,e,i,n){let r=[],s=oG(i,n)||!!e.layers&&oG(e,n);r.push(function(t,e){return{update:()=>{t.transparent=e}}}(t,s));for(let a of t.layers){let t=e.layers?.data(a.uuid),s=i.layers.data(a.uuid);if(!s||"light"!==a.type&&(!(a.visible??1)||!(s.visible??1)))continue;let o=a.getNames().filter((t=>!fR.some((e=>t.includes(e)))));for(let e of o)try{let i,o=a.getValue(e);if("colors"===e)i=wJ(a,t,s,e);else if(Array.isArray(o))"steps"===e&&(i=xJ(a,t,s,e));else if("number"==typeof o)i=mJ(a,t,s,e,n);else{if("boolean"==typeof o)continue;o instanceof Uf?i=gJ(a,t,s,e):o instanceof mm?i=vJ(a,t,s,e,n):o instanceof LU?i=bJ(a,t,s,e,n):o instanceof nm?i=yJ(a,t,s,e,n):"isTexture"in o&&(i=SJ(a,t,s,e))}i&&(Array.isArray(i)?r.push(...i):r.push(i))}catch(kI){console.error(`lerpMaterial: unexpected material layer for ${e}`,kI)}}return r}function mJ(t,e,i,n,r){if(!t.hasValue(n)||!(n in i))return;let s=e?e[n]:t.getValue(n),a=i[n],o="string"==typeof s?Number(r.getVariable(s)??0):s,l="string"==typeof a?Number(r.getVariable(a)??0):a;return o!==l?{update:e=>{t.setValue(n,Nf.lerp(o,l,e))},start:()=>{t.setValue(n,o)},end:()=>{t.setValue(n,l)}}:void 0}function gJ(t,e,i,n){if(!t.hasValue(n)||!(n in i))return;let r=t.getValue(n),s=e?(new Uf).fromArray(e[n]):r.clone(),a=(new Uf).fromArray(i[n]);return s.equals(a)?void 0:{update:t=>{r.lerpVectors(s,a,t)},start:()=>{r.copy(s)},end:()=>{r.copy(a)}}}function vJ(t,e,i,n,r){if(!t.hasValue(n)||!(n in i))return;let s=t.getValue(n),a=e?e[n]:void 0,o=i[n],l=a?aJ(new mm,a,r):s.clone(),h=aJ(new mm,o,r);return l.equals(h)?void 0:{update:t=>{s.lerpVectors(l,h,t)},start:()=>{s.copy(l)},end:()=>{s.copy(h)}}}function yJ(t,e,i,n,r){if(!t.hasValue(n)||!(n in i))return;let s=e?e[n]:void 0,a=i[n],o=t.getValue(n),l=s?"string"==typeof s?r.getColor(s).clone():(new nm).setRGB(s.r,s.g,s.b):o.clone(),h="string"==typeof a?r.getColor(a).clone():(new nm).setRGB(a.r,a.g,a.b);if(l.equals(h))return;let c=o.clone();return{update:e=>{t.getValue(n)!==c&&t.setValue(n,c),c.lerpColors(l,h,e)},start:()=>{c.copy(l)},end:()=>{c.copy(h)}}}function bJ(t,e,i,n,r){if(!t.hasValue(n)||!(n in i))return;let s=e?e[n]:void 0,a=i[n],o=t.getValue(n),l=s?"string"==typeof s?r.getColor(s).clone():(new nm).setRGB(s.r,s.g,s.b):o.clone(),h="string"==typeof a?r.getColor(a).clone():new LU(a.r,a.g,a.b,a.a);if(l.equals(h))return;let c=o.clone();return{update:e=>{t.getValue(n)!==c&&t.setValue(n,c),c.lerpColors(l,h,e)},start:()=>{c.copy(l)},end:()=>{c.copy(h)}}}function xJ(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(!t.hasValue(n)||!(n in i))return;let r=[],s=t.getValue(n),a=e?e[n]:s,o=i[n];return WP(a,o)||r.push({update:e=>{let i=[...s];for(let t=0;t<s.length;++t){let n=a[t],r=o[t];i[t]=Nf.lerp(n,r,e)}t.setValue(n,i)},start:()=>{t.setValue(n,a)},end:()=>{t.setValue(n,o)}}),r.length?r:void 0}function wJ(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"colors";if(!t.hasValue(n)||!(n in i))return;let r=[],s=t.getValue(n),a=e?e[n]:s.map((t=>t.toArray())),o=i[n];for(let l=0;l<s.length;++l){let t=[...a[l]],e=[...o[l]];CI.isEqual(t,e)||r.push({update:i=>{s[l].fromArray(CI.lerp(t,e,i))},start:()=>{s[l].fromArray(t)},end:()=>{s[l].fromArray(e)}})}return r.length?r:void 0}function SJ(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"texture";if(!t.hasValue(n)||!(n in i))return;let r=t.getNode("rotation"),s=e?.[n]?.rotation??0,a=i[n]?.rotation??0;if(r&&s!==a)return{update:t=>{r.value=Nf.lerp(s,a,t)*Nf.DEG2RAD},start:()=>{r.value=s*Nf.DEG2RAD},end:()=>{r.value=a*Nf.DEG2RAD}};let o=t.getNode("mat");if(!o)return;let l=e?e[n]:o,h=i[n],c=[...l.repeat],u=[...l.offset],d=[...h.repeat],p=[...h.offset],f=l.rotation??0,m=h.rotation??0;return AI.isEqual(c,d)&&AI.isEqual(u,p)&&f===m?void 0:{update:t=>{o.repeat=AI.lerp(c,d,t),o.offset=AI.lerp(u,p,t),o.rotation=Nf.lerp(f,m,t),o.updateMatrix()},start:()=>{o.repeat=[...c],o.offset=[...u],o.rotation=f,o.updateMatrix()},end:()=>{o.repeat=[...d],o.offset=[...p],o.rotation=m,o.updateMatrix()}}}var AJ=new mm,EJ=new eg;function _J(t,e,i,n,r){let s,a,o,l,h,c,u,d,p=[];if(t instanceof sX?(s=hJ("position",t,e,i,r),s&&p.push(s),o=rJ("rotation",t,e,i,r),o&&p.push(o),l=hJ("shear",t,e,i,r),l&&p.push(l)):(d={slide:e.pathSnapping?.slide??t.updatedPathSnapping?.slide??t.dataPatched.pathSnapping?.slide??0,offset:e.pathSnapping?.offset??t.updatedPathSnapping?.offset??t.dataPatched.pathSnapping?.offset??0},c=rJ("slide",d,e.pathSnapping??t.updatedPathSnapping??t.dataPatched.pathSnapping,i.pathSnapping??t.dataPatched.pathSnapping,r),c&&p.push(c),u=rJ("offset",d,e.pathSnapping??t.updatedPathSnapping??t.dataPatched.pathSnapping,i.pathSnapping??t.dataPatched.pathSnapping,r),u&&p.push(u),!c&&!u&&(s=oJ("position",t,e,i,r),s&&p.push(s),a=oJ("scale",t,e,i,r),a&&p.push(a),o=function(t,e,i,n,r){let s=e?.rotation?e.rotation.map((t=>("string"==typeof t?Number(r.getVariable(t)??0):t)*Nf.DEG2RAD)):void 0,a=i.rotation?.map((t=>("string"==typeof t?Number(r.getVariable(t)??0):t)*Nf.DEG2RAD));if(!a)return;let o=s?(new mm).fromArray(s):(new mm).setFromEuler(t.rotation),l=(new mm).fromArray(a);if(o.equals(l))return;let h=AJ.subVectors(l,o);if(n&&h.toArray().every((t=>Math.abs(t)<2*Math.PI))){let e=(new fm).setFromEuler(EJ.setFromVector3(o)),i=(new fm).setFromEuler(EJ.setFromVector3(l));return{update:n=>{!function(t,e,i,n){if(0===n)return i.copy(t);if(1===n)return i.copy(e);let r=t.w*e.w+t.x*e.x+t.y*e.y+t.z*e.z;if(r>=1)return i.copy(t);let s=1-r*r;if(s<=Number.EPSILON){let r=1-n;return i.w=r*t.w+n*e.w,i.x=r*t.x+n*e.x,i.y=r*t.y+n*e.y,i.z=r*t.z+n*e.z,i.normalize(),i}let a=Math.sqrt(s),o=Math.atan2(a,r),l=Math.sin((1-n)*o)/a,h=Math.sin(n*o)/a;i.w=t.w*l+e.w*h,i.x=t.x*l+e.x*h,i.y=t.y*l+e.y*h,i.z=t.z*l+e.z*h}(e,i,t.quaternion,n)},start:()=>{t.rotation.setFromVector3(o)},end:()=>{t.rotation.setFromVector3(l)}}}return{update:e=>{AJ.lerpVectors(o,l,e),t.rotation.setFromVector3(AJ)},start:()=>{t.rotation.setFromVector3(o)},end:()=>{t.rotation.setFromVector3(l)}}}(t,e,i,n,r),o&&p.push(o),h=function(t,e,i,n){let r=i[t]?i[t]:void 0,s=n[t];if(!s)return;let a=e[t],o=r?(new Wm).fromArray(r):a.clone(),l=new mm,h=new fm,c=new mm;o.decompose(l,h,c);let u=(new Wm).fromArray(s),d=new mm,p=new fm,f=new mm;return u.decompose(d,p,f),o.equals(u)?void 0:{update:t=>{nJ.slerpQuaternions(h,p,t),eJ.lerpVectors(l,d,t),iJ.lerpVectors(c,f,t),a.compose(eJ,nJ,iJ)},start:()=>{a.compose(l,h,c)},end:()=>{a.compose(d,p,f)}}}("hiddenMatrix",t,e,i),h&&p.push(h))),s||a||o||h||c||u){let i=t instanceof sX?()=>{t.updateWorldMatrix(!0,!1,!0),t.resetBBoxNeedsUpdate()}:()=>{t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD()),t.parent?.matrixWorldFusedFalse&&(t.matrixWorld.multiplyMatrices(t.parent.matrixWorldFusedFalse,t.matrix),t.matrixWorldNeedsUpdate=!1),LW(t)&&BW(t.parent)&&t.invalidateDownstreamBooleanData(!0),t.updatePathSnapping(Object.assign({},e.pathSnapping,d))};p.push({update:i,start:i,end:i})}return p}function CJ(t,e,i,n){let r=[];if(!("cloner"in i)||!t.cloner)return r;let s=t.cloner,a="cloner"in e?e.cloner:{},o=i.cloner;rR.forEach((t=>{let e;e="count"===t?rJ("count",s.parameters,a,o,n,!0):uJ(t,s.parameters,a??{},o,n),e&&r.push(e)}));let l=function(t,e,i,n){if("radial"!==t.parameters.type)return;let r=e.radial,s=i.radial;if(!s)return;let a=t.parameters.radial,o=[];return sR.forEach((t=>{let e=uJ(t,a,r??{},s,n);e&&o.push(e)})),o}(s,a,o,n);l?.length&&r.push(...l);let h=function(t,e,i,n){if("linear"!==t.parameters.type)return;let r=e.linear,s=i.linear;if(!s)return;let a=[],o=t.parameters.linear;return aR.forEach((t=>{let e=uJ(t,o,r??{},s,n);e&&a.push(e)})),a}(s,a,o,n);h?.length&&r.push(...h);let c=function(t,e,i,n){if("grid"!==t.parameters.type)return;let r=e.grid,s=i.grid;if(!s)return;let a=[],o=t.parameters.grid;return oR.forEach((t=>{let e;e="count"===t?sJ(t,o,r??{},s,n,!0):uJ(t,o,r??{},s,n),e&&a.push(e)})),a}(s,a,o,n);c?.length&&r.push(...c);let u=function(t,e,i,n){if("toObject"!==t.parameters.type)return;let r=e.toObject,s=i.toObject;if(!s)return;let a=[],o=t.parameters.toObject;return lR.forEach((t=>{let e;e="count"===t?rJ(t,o,r??{},s,n,!0):uJ(t,o,r??{},s,n),e&&a.push(e)})),a}(s,a,o,n);u?.length&&r.push(...u);let d=function(t,e,i,n){if(!t.parameters.randomness)return;let r=e.randomnessObject,s=i.randomnessObject;if(!s)return;let a=[],o=t.parameters.randomnessObject;return hR.forEach((t=>{let e=uJ(t,o,r??{},s,n);e&&a.push(e)})),a}(s,a,o,n);return d?.length&&r.push(...d),r.length&&r.push({update:()=>{s.update()}}),r}function MJ(t,e,i,n,r){let s,a,o,l,h,c,u,d,p,f,m,g,v,y,b,x=[];if("width"in t&&(s=rJ("width",t,e,i,r),s&&x.push(s)),"height"in t&&(a=rJ("height",t,e,i,r),a&&x.push(a)),t instanceof kX||t instanceof BX){let n={...e.fill},s={...i.fill};void 0!==n.enabled&&n.enabled!==s.enabled&&(x.push(function(t,e){return{update:()=>{t instanceof kX&&(t.fill.enabled=e)}}}(t,!0)),n.enabled||Object.assign(n,{enabled:!0,color:{...n.color,a:0}}),s.enabled||Object.assign(s,{enabled:!0,color:{...s.color,a:0}})),o=cJ("color",t.fill,n,s,r),o&&x.push(o)}if(t instanceof kX){let n={...e.stroke},s={...i.stroke};(n.enabled||s.enabled)&&(x.push(function(t,e){return{update:()=>{t instanceof kX&&(t.stroke.enabled=e)}}}(t,!0)),n.enabled||Object.assign(n,{enabled:!0,color:{...n.color,a:0}}),s.enabled||Object.assign(s,{enabled:!0,color:{...s.color,a:0}})),l=cJ("color",t.stroke,n,s,r),l&&x.push(l),h=rJ("thickness",t.stroke,n,s,r),h&&x.push(h)}if(t instanceof kX){let n={...e.dropShadow},s={...i.dropShadow};(n.enabled||s.enabled)&&(x.push(function(t,e){return{update:()=>{t instanceof kX&&(t.dropShadow.enabled=e)}}}(t,!0)),n.enabled||Object.assign(n,{enabled:!0,color:{...n.color,a:0}}),s.enabled||Object.assign(s,{enabled:!0,color:{...s.color,a:0}})),c=cJ("color",t.dropShadow,n,s,r),c&&x.push(c),u=rJ("blurRadius",t.dropShadow,n,s,r),u&&x.push(u),p=rJ("spread",t.dropShadow,n,s,r),p&&x.push(p),d=hJ("offset",t.dropShadow,n,s,r),d&&x.push(d)}if(t instanceof kX){let n={...e.innerShadow},s={...i.innerShadow};(n.enabled||s.enabled)&&(x.push(function(t,e){return{update:()=>{t instanceof kX&&(t.innerShadow.enabled=e)}}}(t,!0)),n.enabled||Object.assign(n,{enabled:!0,color:{...n.color,a:0}}),s.enabled||Object.assign(s,{enabled:!0,color:{...s.color,a:0}})),f=cJ("color",t.innerShadow,n,s,r),f&&x.push(f),m=rJ("blurRadius",t.innerShadow,n,s,r),m&&x.push(m),v=rJ("spread",t.innerShadow,n,s,r),v&&x.push(v),g=hJ("offset",t.innerShadow,n,s,r),g&&x.push(g)}if(t instanceof kX||t instanceof BX){let n={...e.backgroundBlur},s={...i.backgroundBlur};(n.enabled||s.enabled)&&(x.push(function(t,e){return{update:()=>{t instanceof kX&&(t.backgroundBlur.enabled=e)}}}(t,!0)),n.enabled||Object.assign(n,{enabled:!0,radius:0}),s.enabled||Object.assign(s,{enabled:!0,radius:0})),y=rJ("radius",t.backgroundBlur,n,s,r),y&&x.push(y)}if(t instanceof kX){let n={...e.layerBlur},s={...i.layerBlur};(n.enabled||s.enabled)&&(x.push(function(t,e){return{update:()=>{t instanceof kX&&(t.layerBlur.enabled=e)}}}(t,!0)),n.enabled||Object.assign(n,{enabled:!0,radius:0}),s.enabled||Object.assign(s,{enabled:!0,radius:0})),b=rJ("radius",t.layerBlur,n,s,r),b&&x.push(b)}if(t instanceof BX||t instanceof RX){let n=sJ("cornerRadius",t,e,i,r);n&&x.push(n)}return x}function PJ(t,e,i,n,r){let s=[];return t.data.visible&&s.push(..._J(t,e,i,r,n)),t instanceof sX?s.push(...MJ(t,e,i,0,n)):(t.data.visible&&s.push(...CJ(t,e,i,n)),LW(t)?(t instanceof xH&&t.data.visible&&s.push(...dJ(t,e,i,n)),t.data.visible&&s.push(...function(t,e,i,n){let r=[];if(Array.isArray(t.material)){if(!("materials"in i)||!i.materials)return r;let s="materials"in e&&e.materials?e.materials:[],a=i.materials;t.material.forEach(((t,e)=>{if(!a[e])return;let i=s[e]??{},o=a[e];"string"==typeof i||"string"==typeof o||r.push(...fJ(t,i,o,n))}))}else{if(!("material"in i)||!i.material)return r;let s="material"in e&&e.material?e.material:{},a=i.material;if("string"==typeof s||"string"==typeof a)return r;r.push(...fJ(t.material,s,a,n))}return r}(t,e,i,n))):(t=>IW.is(t))(t)?t.data.visible&&s.push(...pJ(t,e,i,n)):(t=>t instanceof PW)(t)&&s.push(...function(t,e,i,n){let r=[],s="OrthographicCamera"===t.cameraType?e.orthographic?.zoom:e.perspective?.zoom,a="OrthographicCamera"===t.cameraType?i.orthographic?.zoom:i.perspective?.zoom;if(void 0!==a){let e=s??t.zoom,i=a;e!==i&&r.push({update:n=>{t.zoom=Nf.lerp(e,i,n),t.updateProjectionMatrix()},start:()=>{t.zoom=e,t.updateProjectionMatrix()},end:()=>{t.zoom=i,t.updateProjectionMatrix()}})}if(void 0!==i.targetOffset){let s=rJ("targetOffset",t,e,i,n);s&&r.push(s)}return r}(t,e,i,n))),s.length?{update:t=>{s.forEach((e=>e.update(t)))},start:t=>{s.forEach((e=>e.start?.(t)))},end:t=>{s.forEach((e=>e.end?.(t)))}}:void 0}var TJ=new mm;function DJ(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=[],r=i=>{let n=i.data;delete i.states,i.currentState=null,i.reversibleToState=null,i.currentTransitionEvent=null;for(let t of n.states){let e={...t.data};i.states||(i.states={}),i.states[t.id]=BO.patch(n,e)}IJ(t.scene,i,null,e,void 0!==n.events.find((t=>"Follow"===t.data.type||"LookAt"===t.data.type))),kJ(t)};t.scene.traverse2D(r),t.traverseChildren((s=>{if(i&&(s.rigidBody?.setTranslation(s.position0,!0),s.rigidBody?.setRotation(s.rotation0,!0),s.rigidBody?.setLinvel(TJ,!0),s.rigidBody?.setAngvel(TJ,!0)),!IB.is(s))return;let a=s.uuid,o=s.data;if(delete s.states,s.uuid===GI)return;let l=!1;n.some((e=>t.scene.find(a)?.isDescendantOf(e)))?l=!0:!0===o.physics?.fusedBody&&"dynamic"===o.physics.rigidBody&&n.push(a),s.data=o,s.currentState=null,s.reversibleToState=null,s.currentTransitionEvent=null;for(let e of o.states){let i={...e.data};!0===t.data.globalPhysics.usePhysics&&o.physics&&("dynamic"===o.physics.rigidBody||l)&&(void 0!==e.data.position&&delete i.position,void 0!==e.data.rotation&&delete i.rotation,void 0!==e.data.hiddenMatrix&&delete i.hiddenMatrix),s.states||(s.states={}),s.states[e.id]=qR.patch(o,i)}IJ(t.scene,s,null,e,void 0!==o.events.find((t=>"Follow"===t.data.type||"LookAt"===t.data.type))),s instanceof cQ&&s.frame&&(s.frame.traverse((t=>r(t))),s.uiCanvas?.applySize())})),kJ(t),t.frame&&(t.frame.traverse((t=>r(t))),t.uiCanvas?.applySize())}function kJ(t){t.traverseEntity((e=>{for(let i of e.data.events){let e=[];switch(i.data.type){case"Follow":case"MouseHover":case"Scroll":case"MouseDown":case"MouseUp":case"MousePress":case"KeyUp":case"KeyDown":case"KeyPress":case"Collision":e.push(...i.data.actions);break;case"GameControl":for(let t of Object.values(i.data.gameActions))e.push(...t);break;case"DragDrop":e.push(...i.data.dragDropActions.drag,...i.data.dragDropActions.drop);break;case"Conditional":e.push(...i.data.inActions,...i.data.outActions)}for(let i of e)if("Create"===i.data.type&&"Yes"===i.data.hideBase){let e=t.scene.find(i.data.object);e&&(e.visible=!1)}}}))}function IJ(t,e,i,n){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(e instanceof xH&&!(e instanceof IQ)&&e.removeInteractionGeometry(n),e instanceof sX?e.changeSelectedState(i,{shared:n},r):e.changeSelectedState(i,{scene:t,shared:n},r),e instanceof xH&&e.updateGeometryGroupsIfNeeded(),e instanceof PW&&e.updateCameraState(e.dataPatched,{scene:t,shared:n}),!(e instanceof sX)){if(e.cloner)for(let t of e.cloner.children)t.playModeVisible=void 0;e.updateVisible()}}function RJ(t){let e;if(5===t.easing){let{control1:i,control2:n}=t;e=`cubicBezier(\n\t\t\t${i[0]}, ${i[1]}, ${n[0]}, ${n[1]}\n\t\t)`}else if(6===t.easing){let{mass:i,stiffness:n,damping:r,velocity:s}=t;e=`spring( ${i}, ${n}, ${r}, ${s} )`}else{let i;switch(t.easing){case 0:default:i=zI.linear;break;case 1:i=zI.ease;break;case 2:i=zI.easeIn;break;case 3:i=zI.easeOut;break;case 4:i=zI.easeInOut}let[n,r,s,a]=i;e=`cubicBezier( ${n}, ${r}, ${s}, ${a} )`}return{duration:Math.max(t.duration,1e-4),easing:e}}function OJ(t){let e={delay:0,loop:-1===t.repeat||t.repeat+1};if(0===t.repeat)e.direction="normal",e.rewind=!1;else switch(t.direction){case"pingpong":e.direction="alternate",e.rewind=!1;break;case"pingpong-rewind":e.direction="alternate",e.rewind=!0;break;default:e.direction="normal",e.rewind=!1}switch(e.delay=0,e.endDelay=0,e.startOnceDelay=0,e.pingPongDelayCorrection=0,e.pingPongEndDelayCorrection=0,t.delayDirection){case"start-once":e.startOnceDelay=t.delay;break;case"start":e.delay=t.delay;break;case"end":e.endDelay=t.delay;break;case"start-end":case void 0:e.delay=t.delay,e.endDelay=t.delay}return"alternate"===e.direction&&(e.delay/=2,e.endDelay/=2,"start"===t.delayDirection?(e.pingPongDelayCorrection=e.delay,"number"==typeof e.loop&&e.loop%2===0&&(e.pingPongEndDelayCorrection=e.delay)):"end"===t.delayDirection?"number"==typeof e.loop&&e.loop%2!==0&&(e.pingPongEndDelayCorrection=e.endDelay):"start-end"===t.delayDirection&&(e.pingPongDelayCorrection=e.delay,e.pingPongEndDelayCorrection=e.endDelay)),e}var LJ={type:"beginState"},BJ={type:"completeState",isfromEntity:!1},zJ=class{constructor(t,e,i,n,r,s){if(this.object=t,this.data=n,this.sharedAssets=r,this.allowSlerp=s,this.targets={t:0},this.firstLoop=!0,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.requestRender()),0===this.targets.t||1===this.targets.t?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))},this.onChangeBegin=()=>{this.object.reversibleToState=this.to.id;let t=this.targets.t>.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=t,this.object.dispatchEvent({type:"beginState",state:t}),this.object instanceof sX||this.object.traverseEntity((t=>{t!==this.object&&t instanceof PW&&t.dispatchEvent(LJ)}))},this.onChangeComplete=()=>{this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.reversibleToState=this.to.id;let t=this.targets.t<.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=t,this.object.dispatchEvent({type:"completeState",state:t}),this.object instanceof sX||this.object.traverseEntity((t=>{t!==this.object&&t instanceof PW&&t.dispatchEvent(BJ)}))},this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=PJ(this.object,this.from.data,this.to.data,this.sharedAssets,this.allowSlerp))},void 0===e){let t=NJ(this.object,this.object.currentState===i?this.object.prevState:this.object.currentState);if(!t)throw new Error("Missing property");this.from=t}else{let t=NJ(this.object,e);if(!t)throw new Error("Missing property");this.from=t}if(void 0===i)throw new Error("Missing property");{let t=NJ(this.object,i);if(!t)throw new Error("Missing property");this.to=t}this.useCurrentState=void 0===e||void 0===i,this.params={targets:this.targets,t:1,autoplay:!1,...OJ(n),...RJ(n),change:this.onChange},this.callback=PJ(this.object,void 0===e?{}:this.from.data,void 0===i?{}:this.to.data,this.sharedAssets,this.allowSlerp)}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}},FJ=class extends _f{constructor(t,e,i,n,r){if(super(),this.eventType=t,this.data=e,this.page=i,this.shared=n,this.condition=r,this.toggleIsForward=!1,this.timelineNeedsRebuild=!1,this.hasPlayedOnce=!1,this.onTimelineChangeComplete=()=>{"normal"!==this.data.tweens[0].data.direction&&(this.toggleIsForward=!this.toggleIsForward),!1!==this.timelineNeedsRebuild&&(this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!1,isRebuild:!0}),this.timeline.play())},!e.object)throw new Error("Missing property");let s=this.page.scene.find(e.object)??this.page.uiCanvas?.find(e.object)??this.page.scene.find2DInUIObjects(e.object);if(!s)throw new Error("Missing property");if(!s.states)throw new Error("Missing property");if(this.object=s,e.tweens.length<2)throw new Error("Missing property");this.tweens=Array(this.data.tweens.length-1),this.startOnceDelay="start-once"===e.tweens[0].data.delayDirection?e.tweens[0].data.delay:0,this.init()}get playing(){return!1===this.timeline?.paused}get changeBegan(){return this.tweens.some((t=>t.changeBegan))??!1}init(){this.initialCurrentState=NJ(this.object,this.object.currentState).id,this.toggleIsForward=!1}get currentState(){return"Toggle"===this.data.runMode&&eI(this.eventType)?this.initialCurrentState:this.object.currentState}buildTimeline(){let{isForward:t=!0,needsRebuild:e=!1,isRebuild:i=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let n=OJ(this.data.tweens[0].data);i&&"number"==typeof n.loop&&n.loop--,this.timeline?.pause(),this.timeline=tJ.timeline({autoplay:!1,...n,...!0===n.loop||n.loop>1?{timelineChangeComplete:this.onTimelineChangeComplete}:{}});let r=this.tweens.findIndex((t=>t?.changeBegan));if(!0===e&&(this.timelineNeedsRebuild=!0),t){let t=-1===r?0:r;for(let e=t;e<this.data.tweens.length-1;e++){let i,s=this.data.tweens[e],a=this.data.tweens[e+1];e!==t||!0!==this.object.wasMovedByUser&&!0!==this.object.previousAction?.changeBegan?i=void 0===s.data.state?this.currentState:s.data.state:(i=void 0,this.object instanceof PW&&(this.object.wasMovedByUser=!1));let o=new zJ(this.object,i,void 0===a.data.state?this.currentState:a.data.state,a.data,this.shared,this.data.allowSlerp??!1);-1!==r&&e===t&&Object.assign(o.params,{startOnceDelay:0}),this.tweens[e]=o,this.timeline.add(o.params,this.timeline.duration+(e===t?n.delay:0))}this.timeline.duration+=n.endDelay}else{let t=-1===r?this.data.tweens.length-1:r+1;for(let e=t;e>0;e--){let i,s=this.data.tweens[e],a=this.data.tweens[e-1];e!==t||!0!==this.object.wasMovedByUser&&!0!==this.object.previousAction?.changeBegan?i=void 0===s.data.state?this.currentState:s.data.state:(i=void 0,this.object instanceof PW&&(this.object.wasMovedByUser=!1));let o=new zJ(this.object,i,void 0===a.data.state?this.currentState:a.data.state,s.data,this.shared,this.data.allowSlerp??!1);-1!==r&&e===t&&Object.assign(o.params,{startOnceDelay:0}),this.tweens[e-1]=o,this.timeline.add(o.params,this.timeline.duration+(e===t?n.endDelay:0))}this.timeline.duration+=n.delay}}catch(FI){FI instanceof Error&&console.error(FI.message)}!0===this.object.previousAction?.playing&&this.object.previousAction.pause(),this.object.previousAction=this}play(){if(!1===ZJ(this.shared,this.condition)||eI(this.eventType)&&"Once"===this.data.runMode&&this.hasPlayedOnce||(this.hasPlayedOnce=!0,this.playing))return!1;clearTimeout(this.timeoutId);let t=OJ(this.data.tweens[0].data).pingPongDelayCorrection;this.timeoutId=window.setTimeout((()=>{try{this.buildTimeline(),this.timeline.play()}catch(YT){YT instanceof Error&&console.error(YT.message)}}),this.startOnceDelay+t)}pause(){this.timeline?.pause(),clearTimeout(this.timeoutId),this.tweens=Array(this.data.tweens.length-1),delete this.timeoutId}stop(){this.pause();let t=void 0===this.data.tweens[0].data.state?this.initialCurrentState:this.data.tweens[0].data.state;this.object instanceof sX?this.object.changeSelectedState(t,{shared:this.shared}):this.object.changeSelectedState(t,{scene:this.page.scene,shared:this.shared}),this.object.currentState=t}seek(t){if(!1===ZJ(this.shared,this.condition))return!1;void 0===this.timeline&&this.buildTimeline(),this.timeline?.seek(t*this.timeline.duration,!0)}toggle(t){if(!1===ZJ(this.shared,this.condition))return!1;clearTimeout(this.timeoutId),this.toggleIsForward=t??!this.toggleIsForward,this.playing?(this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!0}),this.timeline.play()):this.timeoutId=window.setTimeout((()=>{this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()}),this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function NJ(t,e){let i,n;if("string"==typeof e?(i=e,n=t.states?.[i]):null===e&&(i=null,n=t.data),void 0!==i&&void 0!==n)return{id:i,data:n}}var UJ={type:"beginState"},VJ={type:"completeState",isfromEntity:!1},jJ={type:"requestRender"},GJ=class extends _f{constructor(t,e,i,n){super(),this.data=t,this.page=e,this.shared=i,this.condition=n,this.toggleIsForward=!1,this.posStart=new mm,this.posEnd=new mm,this.qStart=new fm,this.qEnd=new fm,this.zoomStart=1,this.zoomEnd=1}init(){}get playing(){return this.animation&&this.animation.began&&!this.animation.completed}buildAnimation(){if(!this.data.animate)return;let t=this.page.scene.find(this.data.targetCamera);if(!t||!t.visible)throw new ReferenceError("Target camera not founded or not visible");let e={t:0};this.posStart.copy(this.page.activeCamera.position),this.qStart.copy(this.page.activeCamera.quaternion),this.zoomStart=this.page.activeCamera.zoom,this.animation=tJ({targets:e,t:1,...RJ(this.data),update:()=>{0===e.t&&("Toggle"!==this.data.runMode||this.toggleIsForward?(this.posEnd.copy(t.position),this.qEnd.copy(t.quaternion),this.zoomEnd=t.zoom,this.fromCamera=this.page.activeCamera,this.switchCamera(t.uuid)):this.fromCamera&&(this.posEnd.copy(this.fromCamera.position),this.qEnd.copy(this.fromCamera.quaternion),this.zoomEnd=this.fromCamera.zoom,this.switchCamera(this.fromCamera.uuid)),this.page.activeCamera.dispatchEvent(UJ));let i=this.page.activeCamera;i.position.lerpVectors(this.posStart,this.posEnd,e.t),i.quaternion.slerpQuaternions(this.qStart,this.qEnd,e.t),i.zoom=this.zoomStart+(this.zoomEnd-this.zoomStart)*e.t,i.wasMovedBySwitchCameraAction=!0,i.updateMatrix(),i.updateMatrixWorld(),i.updateProjectionMatrix(),i.dispatchEvent(jJ),1===e.t&&i.dispatchEvent(VJ)}})}switchCamera(t){let e=this.page.activeCamera,i=this.page.scene.find(t);if(!i||!i.visible)throw new ReferenceError("Target camera not founded or not visible");this.page.switchActiveCamera(i),e.dispatchEvent({type:"cameraChange",camera:i})}play(){if(!1===ZJ(this.shared,this.condition))return!1;if(!this.playing&&this.page.activeCamera.uuid!==this.data.targetCamera)try{clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout((()=>{delete this.timeoutId,this.data.animate?(this.buildAnimation(),this.animation?.play()):this.switchCamera(this.data.targetCamera)}),1e3*this.data.delay)}catch{}}pause(){this.animation?.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}toggle(t){if(!1===ZJ(this.shared,this.condition))return!1;if(window.clearTimeout(this.timeoutId),delete this.timeoutId,t!==this.toggleIsForward)try{this.playing?(this.animation?.pause(),this.toggleIsForward=t??!this.toggleIsForward,this.buildAnimation(!0),this.animation?.play()):this.timeoutId=window.setTimeout((()=>{this.toggleIsForward=t??!this.toggleIsForward,this.data.animate?(this.animation?.pause(),this.buildAnimation(),this.animation?.play()):(this.toggleIsForward?(this.fromCamera=this.page.activeCamera,this.switchCamera(this.data.targetCamera)):this.fromCamera&&this.switchCamera(this.fromCamera.uuid),this.page.activeCamera.dispatchEvent(VJ),this.page.activeCamera.dispatchEvent(jJ))}),1e3*this.data.delay)}catch{}}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause(),this.toggleIsForward=!1}};function HJ(t){let e=t?.tracks.filter((t=>"vector"===t.ValueTypeName||"quaternion"===t.ValueTypeName)).map((t=>t.times.length));if(e?.length){let t=YP(e);return t&&t>2?t:2}return 2}var WJ=class extends _f{constructor(t,e,i,n,r){super(),this.data=t,this.page=e,this.animationControls=i,this.shared=n,this.condition=r,this.startOnceDelay=0,this.toggleIsForward=!1;let s=t.object,a=e.scene.find(t.object);a&&Array.isArray(a.identity)&&(s=a.identity[0]),this.data={...t,object:s};let o=this.animationControls.clipIdToAction[t.clipId+"/"+s];if(this.duration=o?.getClip()?.duration??1,this.data.crop2){let t=HJ(o?.getClip());this.leftFrameTime=this.data.crop2[0]/(t-1)*this.duration,this.rightFrameTime=this.data.crop2[1]/(t-1)*this.duration}else{let t=o?.getClip()?.tracks[0]?.times.length;t&&t>1?(this.leftFrameTime=this.data.crop[0]/t*this.duration,this.rightFrameTime=this.data.crop[1]/t*this.duration):(this.leftFrameTime=0,this.rightFrameTime=this.duration)}this.startOnceDelay=t.delay}get playing(){return this.threeAnimAction?.isRunning()??!1}play(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!1===ZJ(this.shared,this.condition))return!1;window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout((()=>{if(this.threeAnimAction=this.animationControls.play(this.data),!this.threeAnimAction)return;this.threeAnimAction.reset(),this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime;let e=this.data.object;Object.entries(this.animationControls.clipIdToAction).forEach((i=>{let[n,r]=i,s=n.split("/")[1];this.threeAnimAction!==r&&s===e&&r.isRunning()&&(t?r.fadeOut(.2):r.stop())})),t&&this.threeAnimAction?.fadeIn(.2)}),this.startOnceDelay)}pause(){this.threeAnimAction&&(this.threeAnimAction.paused=!0),window.clearTimeout(this.timeoutId),delete this.timeoutId}stop(){this.threeAnimAction?.fadeOut(.2)}seek(t){this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction&&(this.threeAnimAction.paused=!0,this.threeAnimAction.time=Nf.clamp(this.threeAnimAction.time+1/60*t,this.leftFrameTime,this.rightFrameTime-16e-5),this.animationControls.needsUpdate=!0,this.animationControls.requestRender())}toggle(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!1===ZJ(this.shared,this.condition))return!1;this.toggleIsForward=t??!this.toggleIsForward,this.threeAnimAction&&(this.threeAnimAction._loopCount=0),this.playing?this.threeAnimAction&&(this.threeAnimAction.timeScale=this.toggleIsForward?1:-1,this.toggleIsForward?(this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime)):this.timeoutId=window.setTimeout((()=>{if(this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction){this.toggleIsForward?(this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction.time=this.rightFrameTime,this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime),this.threeAnimAction.paused=!1,this.threeAnimAction.timeScale=this.toggleIsForward?1:-1;let t=this.data.clipId.split("/")[1];Object.entries(this.animationControls.clipIdToAction).forEach((i=>{let[n,r]=i,s=n.split("/")[1];this.threeAnimAction!==r&&s===t&&r.isRunning()&&(e?r.fadeOut(.2):r.stop())})),e&&this.threeAnimAction?.fadeIn(.2)}}),this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){let t=this.animationControls.clipIdToAction[this.data.clipId+"/"+this.data.object]?.getClip();t&&(t.duration=this.duration),this.pause()}},qJ=class{constructor(t,e,i,n,r){this.data=t,this.page=e,this.eventManager=i,this.shared=n,this.condition=r,this.timeOutId=-1,this.scene=e.scene}dispatch(){if(!1===ZJ(this.shared,this.condition))return!1;this.data.target!==this.page.uuid&&(window.clearTimeout(this.timeOutId),this.timeOutId=window.setTimeout((()=>{this.play()}),1e3*this.data.delay))}dispose(){window.clearTimeout(this.timeOutId)}play(){if(this.scene.children.every((t=>t.uuid!==this.data.target||t.data.uiScene)))return;"fade"===this.data.transition&&this.data.duration>0&&this.eventManager.eventContext.renderer.renderFromSceneForSceneTransitionPass(this.scene,this.scene.activeCamera,1e3*this.data.duration),this.eventManager.deactivate(),this.eventManager.controlsManager.deactivate();let t=this.scene.activeCamera;this.scene.updatePage(this.data.target),this.scene.traverseVisibleEntity((t=>{"ParticleSystem"===t.type&&(t.sleep(),t.wakeUp(),t.data.autoPlay?t.start():t.stop())})),this.scene.activePage.switchToPlayCamera(),this.scene.activeCamera.copyViewPlaneSize(t),DJ(this.scene.activePage,this.shared),this.eventManager.activate(),this.eventManager.controlsManager.activate(this.eventManager)}},YJ=class{constructor(t,e,i,n){this.data=t,this.page=e,this.shared=i,this.condition=n,this.evaluatedCondition=!1}checkConditions(){this.evaluatedCondition=ZJ(this.shared,this.condition)}dispatch(){if(!1===this.evaluatedCondition)return!1;let t=this.shared.getVariable(this.data.variableId),e=CN(this.data.expression,this.shared,nO.typeOfVariable(t));void 0!==e&&this.shared.updateVariable(this.data.variableId,"string"==typeof e?{textValue:e}:e)}dispose(){}},XJ=class{constructor(t,e,i,n){this.data=t,this.page=e,this.shared=i,this.condition=n,this.timeoutId=null}dispatchInner(){if(!1===ZJ(this.shared,this.condition))return!1;let t=this.shared.getDynamicVariablePlayState(this.data.variableId);if("PlayPause"===this.data.mode)void 0===this.shared.getDynamicVariableToggleIsForward(this.data.variableId)&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"===t?"Paused":"Playing");else if("Play"===this.data.mode&&"Playing"!==t)void 0===this.shared.getDynamicVariableToggleIsForward(this.data.variableId)&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing");else if("Stop"===this.data.mode&&"Stopped"!==t)this.shared.setDynamicVariablePlayState(this.data.variableId,"Stopped");else if("Pause"===this.data.mode&&"Paused"!==t)this.shared.setDynamicVariablePlayState(this.data.variableId,"Paused");else if("Restart"===this.data.mode)this.shared.setDynamicVariablePlayState(this.data.variableId,"Restarted");else if("Toggle"===this.data.mode){let e=this.shared.getDynamicVariableToggleIsForward(this.data.variableId);"Playing"===t?this.shared.setDynamicVariableToggleIsForward(this.data.variableId,void 0!==e&&!e):(this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!e),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"))}}dispatch(){let t=this.data.delay,e=this.shared.getDynamicVariablePlayState(this.data.variableId);"PlayPause"===this.data.mode&&"Playing"===e&&(t=this.data.pauseDelay),0!==t?(this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout((()=>{this.timeoutId=null,this.dispatchInner()}),t)):this.dispatchInner()}dispose(){this.timeoutId&&window.clearTimeout(this.timeoutId)}},QJ=class{constructor(t,e,i,n){this.data=t,this.page=e,this.shared=i,this.condition=n}dispatch(){if(!1===ZJ(this.shared,this.condition))return!1;("single"===this.data.target?this.data.variableId?[this.data.variableId]:[]:Object.keys(this.shared.getVariables())).forEach((t=>{this.shared.getVariable(t);let e=this.shared.data.variables.data(t)?.value;void 0!==e&&this.shared.updateVariable(t,e),this.shared.enableLocalStorageForPersistentVariables&&localStorage.removeItem(uH(t))}))}dispose(){}},KJ=class{constructor(t,e,i,n){this.data=t,this.page=e,this.shared=i,this.condition=n}dispatch(){if(!1===ZJ(this.shared,this.condition))return!1;this.data.userAPIId&&this.shared.getUserAPI(this.data.userAPIId)?.callUserAPI(this.shared)}dispose(){}};function ZJ(t,e){if(void 0===e)return!0;if(0===e.expression.length)return!1;let i=CN(e.expression,t,"boolean");return e.negate?!i:!!i}function JJ(t,e,i,n,r,s){let a={Audio:[],Video:[],Particles:[],Link:[],Destroy:[],Create:[],Reset:[],Transition:[],SwitchCamera:[],Animation:[],SceneTransition:[],SetVariable:[],DynamicVariablePlay:[],ClearLocalStorage:[],UserAPI:[]},o=e=>l=>{let{id:h,data:c}=l;try{"Audio"===c.type?SI[t.type].includes("Audio")&&a.Audio.push(new WK(h,c,s,n,e)):"Video"!==c.type||s instanceof sX?"Particles"===c.type?SI[t.type].includes("Particles")&&a.Particles.push(new qK(c,i,n,e)):"Link"===c.type?SI[t.type].includes("Link")&&a.Link.push(new QK(c,r.controlsManager,n,e)):"Create"===c.type?SI[t.type].includes("Create")&&a.Create.push(new c$(c,i,r.controlsManager,n,e)):"Destroy"===c.type?SI[t.type].includes("Destroy")&&a.Destroy.push(new KK(c,i,r.controlsManager,n,e)):"Reset"===c.type?SI[t.type].includes("Reset")&&a.Reset.push(new ZK(c,i,n,r,e)):"Transition"===c.type?SI[t.type].includes("Transition")&&a.Transition.push(new FJ(t.type,c,i,n,e)):"SwitchCamera"===c.type?SI[t.type].includes("SwitchCamera")&&a.SwitchCamera.push(new GJ(c,i,n,e)):"SceneTransition"===c.type?SI[t.type].includes("SceneTransition")&&a.SceneTransition.push(new qJ(c,i,r,n,e)):"Animation"===c.type?SI[t.type].includes("Animation")&&a.Animation.push(new WJ(c,i,r.animationControls,n,e)):"SetVariable"===c.type?SI[t.type].includes("SetVariable")&&a.SetVariable.push(new YJ(c,i,n,e)):"DynamicVariablePlay"===c.type?SI[t.type].includes("DynamicVariablePlay")&&a.DynamicVariablePlay.push(new XJ(c,i,n,e)):"Conditional"===c.type?SI[t.type].includes("Conditional")&&(c.ifActions.forEach(o({expression:c.condition,negate:!1})),c.elseActions.forEach(o({expression:c.condition,negate:!0}))):"ClearLocalStorage"===c.type?SI[t.type].includes("ClearLocalStorage")&&a.ClearLocalStorage.push(new QJ(c,i,n,e)):"UserAPI"===c.type&&SI[t.type].includes("UserAPI")&&a.UserAPI.push(new KJ(c,i,n,e)):SI[t.type].includes("Video")&&a.Video.push(new r$(h,c,s,n,e))}catch(kI){}};return e.forEach(o()),a}function $J(t){Object.values(t).forEach((t=>{t.forEach((t=>{(t instanceof WK||t instanceof r$||t instanceof qK||t instanceof WJ||t instanceof FJ||t instanceof c$||t instanceof KK||t instanceof GJ||t instanceof qJ||t instanceof ZK||t instanceof YJ||t instanceof XJ)&&t.dispose()}))}))}var t$=new Map,e$=new Map,i$=class{constructor(t,e,i){this.data=e,this.delay=0,this.status="stopped";let{layerId:n,loop:r,volume:s,delay:a}=e;if(this.object=i,void 0===n)throw new Error("Missing property");let o=function(t,e){let i;if("material"in t){let n=t.material;i=Array.isArray(n)?t.material[0].layers.find((t=>t.uuid===e)):t.material.layers.find((t=>t.uuid===e))}if(i)return i.color.texture.image.img instanceof HTMLVideoElement?i.color.texture.image.img:void 0}(i,n);o&&(this.videoElement=o,this.videoElement.loop=r===1/0,lT&&(this.videoElement.autoplay=!0),void 0!==s&&(this.videoElement.volume=s)),void 0!==a&&(this.delay=a),e$.has(i.uuid)?e$.get(i.uuid).push(this):e$.set(i.uuid,[this]),t$.set(t,this),this.pause()}mute(){!this.videoElement||(this.videoElement.muted=!0)}unMute(){!this.videoElement||(this.videoElement.muted=!1)}play(t){if(!this.videoElement)return;let e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);t?(this.mute(),this.delay+=150):e?(this.mute(),window.setTimeout((()=>{this.unMute()}),100)):this.unMute(),this.delayTimerId=window.setTimeout((()=>{if(!this.videoElement)return;let t=this.videoElement.play();void 0!==t&&t.then((t=>{})).catch((t=>{this.play()})),this.clearDelay()}),this.delay),this.status="playing"}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}pause(){!this.videoElement||(this.videoElement.pause(),this.status="paused")}stop(){!this.videoElement||(this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay())}playByToggle(){"stop"===this.data.toggle?"playing"===this.status?this.stop():(this.stop(),this.play()):"pause"===this.data.toggle?"playing"===this.status?this.pause():this.play():(this.stop(),this.play())}dispose(){!this.videoElement||(this.stop(),this.videoElement.muted=!0)}},n$=class{constructor(t){this.data=t}dispatch(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}pauseVideo(t){let e=t$.get(t);!e||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{e[this.data.interaction](),this.disposeDelay()}),this.data.delay)):e[this.data.interaction]())}pauseAllVideosFromObject(t){let e=e$.get(t);!e?.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{e.forEach((t=>t[this.data.interaction]())),this.disposeDelay()}),this.data.delay)):e.forEach((t=>t[this.data.interaction]())))}pauseAllVideos(){let t=[...e$.values()];!t.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{t.forEach((t=>{t.forEach((t=>{t[this.data.interaction]()}))})),this.disposeDelay()}),this.data.delay)):t.forEach((t=>{t.forEach((t=>{t[this.data.interaction]()}))})))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},r$=class{constructor(t,e,i,n,r){if(this.data=e,this.shared=n,this.condition=r,"play"===e.interaction)this.interaction=new i$(t,e,i);else{if("pause"!==e.interaction&&"stop"!==e.interaction)throw new Error("Missing property");this.interaction=new n$(e)}}dispatchBasic(){if(!1===ZJ(this.shared,this.condition))return!1;this.interaction instanceof i$?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(!1===ZJ(this.shared,this.condition))return!1;this.interaction instanceof i$?this.interaction.play():this.interaction.dispatch()}dispose(){this.interaction.dispose()}},s$=(()=>{let t,e,i,n;function r(i){!t&&!a$()&&e?.sharedGameControlGlobals.createdObjects.length>0&&(t=requestAnimationFrame(s)),i&&(e=i,n=i.requestRender)}function s(r){let a=i?r-i:0,o=e.sharedGameControlGlobals.createdObjects,l=e.sharedGameControlGlobals.nCreatedPerAction,h=o.length,c=0;for(;c<h;){let t=o[c];void 0===t.userData.createdTime&&(t.userData.createdTime=r),void 0===t.userData.lifetime&&void 0===t.userData.quantity||t.userData.lifetime&&r-t.userData.createdTime<t.userData.lifetime||t.userData.quantity&&l[t.userData.actionId]<=t.userData.quantity?(t.userData.velocity&&(t.position.addScaledVector(t.userData.velocity,a/1e3),t.updateMatrix(),n()),c++):(l[t.userData.actionId]>t.userData.quantity&&l[t.userData.actionId]--,o.splice(c,1),t.removeFromParent(),e.sharedGameControlGlobals.rapierWorld&&t.rigidBody?(e.sharedGameControlGlobals.colliderToEntity.delete(t.rigidBody.collider(0).handle),e.sharedGameControlGlobals.rapierWorld.removeRigidBody(t.rigidBody)):(t.bvhGeometry=void 0,e.sharedGameControlGlobals.entitiesWithTransformAnim=e.sharedGameControlGlobals.entitiesWithTransformAnim.filter((t=>void 0!==t.bvhGeometry))),h--,n())}t=c>0?requestAnimationFrame(s):void 0,i=c>0?r:void 0}return typeof document<"u"&&document.addEventListener("visibilitychange",(function(){a$()?t&&(cancelAnimationFrame(t),t=void 0,i=void 0):r()})),r})();function a$(){return!!document&&document.hidden}var o$=new fm,l$=new mm,h$=new mm,c$=class{constructor(t,e,i,n,r){this.data=t,this.page=e,this.controlsManager=i,this.shared=n,this.condition=r,this.intervalId=null,this.timeoutIdQueue=[],this.uniqueId=Nf.generateUUID(),this.dispatch=()=>{if(!1===ZJ(this.shared,this.condition))return!1;this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay)):this.dispatchInner()},this.dispatchFromStart=()=>{if(!1===ZJ(this.shared,this.condition))return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay))},this.dispatchThrottled=nT(this.dispatch,1e3/this.data.creationSpeed),this.dispatchStart=()=>{null===this.intervalId&&(this.intervalId=window.setInterval(this.dispatch,1e3/this.data.creationSpeed))},this.dispatchStop=()=>{null!==this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=null)},this.dispatchInner=()=>{this.timeoutIdQueue.shift();let t=new LB(this.object);if(t.playModeVisible=!0,t.expand(),"world"!==this.data.coordinateSystem){let e=this.data.coordinateSystem,i=this.page.scene.find(e);i&&(i.updateMatrixWorldSVD(),t.hiddenMatrix.copy(i.matrixWorldRigid))}t.scale.copy(this.object.scale),t.position.fromArray(this.data.position),t.rotation.fromArray(this.data.rotation),t.updateMatrix(),this.page.add(t);let e=this.controlsManager.sharedGameControlGlobals;e.createdObjects.push(t),void 0===e.nCreatedPerAction[this.uniqueId]?e.nCreatedPerAction[this.uniqueId]=1:e.nCreatedPerAction[this.uniqueId]++,t.updateWorldMatrix(!0,!0),t.traverseObject(this.traverseObjectCB),s$(),this.controlsManager.requestRender()},this.traverseObjectCB=t=>{let e;if(t.hasNonUniformScale&&t.updateMatrixWorldSVD(),this.controlsManager.sharedGameControlGlobals.rapierWorld){if(t instanceof hW){if(!t.objectForSample)return!0===t.object.dataPatched.physics.fusedBody&&"dynamic"===t.object.dataPatched.physics.rigidBody||void 0;if(t.objectForSample.dataPatched.physics.fusedBody)return;e=t.object}else if(t instanceof LB)e=t.object;else if(e=t,e.dataPatched.cloner?.hideBase)return!0}else{if(t instanceof hW)return;e=t instanceof LB?t.object:t}"Time"===this.data.destroy?t.userData.lifetime=1e3*this.data.lifetime:"Quantity"===this.data.destroy&&(t.userData.quantity=this.data.destroyAfterQuantity,t.userData.actionId=this.uniqueId);let i=(new mm).fromArray(this.data.velocity),n=e.dataPatched;if(!("visibility"===n.physics.enabled?!n.visible:!n.physics.enabled)&&(this.controlsManager.sharedGameControlGlobals.rapierWorld?(this.controlsManager.addRigidBody(t,e,{fromCreate:!0,dynamic:this.data.dynamic}),"Collision"===this.data.destroy&&(t.rigidBody?.collider(0).setActiveEvents(1),t.userData.hasCollisionDestroy=!0),t.matrixWorld.decompose(l$,o$,h$),i.applyQuaternion(o$),this.data.velocity.some((t=>0!==t))&&this.data.dynamic&&t.rigidBody?.setLinvel(i.divideScalar(this.controlsManager.pixelsPerMeter),!0)):("geometry"in t.object&&this.controlsManager.addBoundsTree(t),this.data.velocity.some((t=>0!==t))&&this.data.dynamic&&(t.userData.velocity=i)),!0===e.dataPatched.physics?.fusedBody))return!0};let s=this.page.scene.find(this.data.object);if(!s)throw new Error("Missing Property");if(this.object=s,"world"!==this.data.coordinateSystem&&!this.page.scene.find(this.data.coordinateSystem))throw new Error("Missing Property");s$(i)}dispose(){null!==this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timeoutIdQueue.forEach((t=>window.clearTimeout(t))),this.dispatchThrottled.cancel(),this.page.remove(...this.controlsManager.sharedGameControlGlobals.createdObjects),this.controlsManager.sharedGameControlGlobals.createdObjects=[]}},u$=.02,d$=(new mm,new mm),p$=new mm,f$=new mm,m$=new mm,g$=new mm,v$=new mm,y$=new Wm,b$=new Wm,x$=new Wm,w$=(new Wm,new fm),S$=new fm,A$=new eg(0,0,0,"YXZ"),E$=new mm(1,0,0),_$=new mm(0,1,0),C$=new mm(0,0,1),M$=new mm(1,1,1),P$=(new Bm,new eA),T$=new ym,D$={type:"requestRender"},k$={type:"updateMatrix"},I$=Math.PI/6,R$=class extends _f{constructor(t,e,i,n,r,s,a,o,l){super(),this.object=t,this.domElement=e,this.data=i,this.gloabalPhysics=n,this.controlsManager=r,this.cameraFollow=s,this.camera=a,this.page=o,this.sharedAssets=l,this.enableDamping=!0,this.hiddenMatrix0=new Wm,this.target0=new mm,this.zoom0=1,this.rotForce=1,this.moveForce=1,this.pixelsPerMeter=200,this.euler0=new eg(0,0,0,"YXZ"),this.position0Cam=new mm,this.quat0Cam=new fm,this.scale0Cam=new mm,this.hiddenMatrix0Cam=new Wm,this.threshEndTranslate=.01,this.threshEndRotate=1e-8,this.threshEndRotVel=.005,this.collider={type:"capsule",radius:40,segment:new eA(new mm(0,-40,0),new mm(0,40,0)),matrix:new Wm,position:new mm,rotation:new fm},this.euler=new eg(0,0,0,"YXZ"),this.eulerDelta=new mm,this.lastPosition=new mm,this.lastCameraQuaternion=new fm,this.lastCameraPosition=new mm,this.PI_2=Math.PI/2,this.prevMouse=new Uf,this.velocityTarget=new mm,this.velocity=new mm,this.directionXZ=new mm,this.rotVelocityStick=new mm,this.rotVelocityTarget=new mm,this.rotVelocity=new mm,this.rotDirection=new mm,this.nonColliderRotOffset=new Wm,this.nonColliderPosOffset=new Wm,this.firstPointerId=-1,this.rot=new mm,this.path=[],this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0},this.vrEulerYOffset=0,this.onObject=!1,this.actionState={},this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],this.collisionEnabled=!0,this.offsetMatrix=new Wm,this.objectToTarget=new mm,this.objectToTarget0=new mm,this.objectToCamXZ=new mm,this.objectToCamXZ0=new mm,this.targetToCamera=new mm,this.targetToCamera0=new mm,this.cameraPolarAxis0=new mm,this.targetPos=new mm,this.targetQuat=new fm,this.lerpFactorPos=(new mm).setScalar(.3),this.lerpFactorPosStart=.3,this.lerpFactorPosEnd=.3,this.lerpFactorRotStart=.3,this.lerpFactorRotEnd=.3,this.lerpFactorPosCamera=.3,this.lerpFactorRotCamera=.3,this.objXZQuat=new fm,this.objXZQuatInv=new fm,this.objXZRotMat=new Wm,this.isFirstPerson=!1,this.didHit=!1,this.groundVelocity=new mm,this.pushedVelocity=new mm,this.groundYRotation=0,this.objectRealQuat=new fm,this.colliderWorldQuat=new fm,this.groundNormal=new mm,this.groundTilt=new fm,this.groundTiltInv=new fm,this.lastHitObj=null,this.isFirstFrame=!0,this.rotationAccumWhenOrientWithCamera=0,this.navMeshPathDest=null,this.position=new mm,this.quaternion=new fm,this.scale=new mm,this.initialAction=!0,this.onPointerDown=t=>{!(t.target===this.domElement||t.target instanceof HTMLElement&&"SPLINE-VIEWER"===t.target.tagName&&t.target.shadowRoot?.contains(this.domElement))||-1!==this.firstPointerId||(this.firstPointerId=t.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),"keys"!==this.rotBy&&!cT&&!uT&&this.domElement.requestPointerLock(),this.prevMouse.set(t.clientX,t.clientY))},this.onPointerUp=t=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),"mouse"===t.pointerType&&this.domElement.ownerDocument.exitPointerLock()},this.onPointerMove=t=>{if(t.pointerId!==this.firstPointerId)return;let e=t.clientX-this.prevMouse.x,i=t.clientY-this.prevMouse.y;this.prevMouse.set(t.clientX,t.clientY),"mouse"===t.pointerType&&"keys"!==this.rotBy&&(uT&&dT<15.5&&!cT?(this.eulerDelta.y=-e*this.mouseOrbitSensitivity,this.eulerDelta.x=-i*this.mouseOrbitSensitivity):(this.eulerDelta.y=-t.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-t.movementY*this.mouseOrbitSensitivity)),"mouse"!==t.pointerType&&"drag"===this.rotByTouch&&(this.eulerDelta.y=-e*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-i*this.mouseOrbitSensitivity*5),this.controlsManager.requestRender()},this.onPointerlockChange=t=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?R$.isLocked=!0:R$.isLocked=!1},this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")},this.handleVisibilityChange=()=>{if(document?.hidden)for(let t in this.movementState)this.movementState[t]=0},this.onKeyDown=t=>{!(t.target instanceof HTMLInputElement)&&("ArrowLeft"===t.code||"ArrowUp"===t.code||"ArrowRight"===t.code||"ArrowDown"===t.code||"Space"===t.code)&&t.preventDefault();for(let e of this.keyAssignments)if(t.key.toUpperCase()===e[1]||t.key===e[1]){this.movementState[e[0]]=1;break}this.controlsManager.requestRender()},this.onKeyUp=t=>{for(let e of this.keyAssignments)if(t.key.toUpperCase()===e[1]||t.key===e[1]||t.code.slice(3,t.code.length).toUpperCase()===e[1]){this.movementState[e[0]]=0;break}},this.copyVRGamePadValues=(t,e)=>{for(let i=2;i<4;i++){let n=t.axes[i];0===e?2===i?this.movementState.movePosX=n:this.movementState.movePosZ=n:(t.buttons[3].pressed?this.movementState.jump=1:this.movementState.jump=0,2===i?(Math.abs(this.movementState.rotPosY)<.3&&Math.abs(n)>=.3&&(this.vrEulerYOffset+=n<0?1:-1),this.movementState.rotPosY=n):"fly"===this.moveMode&&(this.movementState.moveNegY=n))}},this.sharedGameControlGlobals=r.sharedGameControlGlobals,t===a&&(this.isFirstPerson=!0),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.euler0.setFromQuaternion(this.quaternion,"YXZ");let h=this.euler0.clone(),c=h.y;if(this.objectRealQuat.copy(this.quaternion),h.y=0,this.quaternion.setFromEuler(h),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),h.set(0,c,0),this.quaternion.setFromEuler(h),this.rot.setFromEuler(h),this.object.matrixAutoUpdate=!1,(this.isFirstPerson||!0===this.cameraFollow)&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom),!0===this.cameraFollow){this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),this.camera.parent?(this.camera.hiddenMatrix.copy(this.camera?.parent.matrixWorld),this.camera.matrix.copy(this.camera.matrixWorld)):this.camera.hiddenMatrix.identity(),this.camera.matrix.copy(this.camera.matrixWorld),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let t,e,i=new mm(0,0,-1).applyQuaternion(this.camera.quaternion),n=(new mm).subVectors(this.position,this.camera.position);this.objectToCamXZ.copy(n),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ),Math.abs(i.y)<1e-6?(n.y=0,i.y=0,e=n.projectOnVector(i)):e=n.y/i.y>0?i.multiplyScalar(n.y/i.y):i.multiplyScalar(n.length()),this.targetToCamera0.copy(e).negate(),t=this.camera.position.clone().add(e),this.objectToTarget0.subVectors(t,this.position);let r=(new eg).setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-r.x,r.x=0,r.z=0,r.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(r)}if(this.object instanceof PW&&(this.object.matrixAutoUpdate=!1),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.rotByTouch=i.rotByTouch??"joystick",this.rotBy=i.rotBy??"keys",this.rotationMode=i.rotationMode??"normal",this.moveMode=i.moveMode??"walk",this.collisionEnabled=i.collisionEnabled,this.speedTranslate=1*(i.speedTranslate??250),this.speedOrbit=.025*(i.speedRotate??100),this.mouseOrbitSensitivity=16e-6*(i.speedRotate??100),this.keyAssignments=i.keyAssignments.map((t=>{let e=[t[0],t[1]];return"\u25b2"===e[1]?e[1]="ArrowUp":"\u25c0"===e[1]?e[1]="ArrowLeft":"\u25bc"===e[1]?e[1]="ArrowDown":"\u25b6"===e[1]?e[1]="ArrowRight":"\u21e7"===e[1]?e[1]="Shift":"\u21b5"===e[1]?e[1]="Enter":"Space"===e[1]?e[1]=" ":"\u2318"===e[1]?e[1]="Meta":"Ctrl"===e[1]?e[1]="Control":"Esc"===e[1]&&(e[1]="Escape"),e})),"mouse"===i.rotBy){let t;t=this.keyAssignments.findIndex((t=>"rotNegX"===t[0])),-1!==t&&(this.keyAssignments[t][1]=""),t=this.keyAssignments.findIndex((t=>"rotPosX"===t[0])),-1!==t&&(this.keyAssignments[t][1]=""),t=this.keyAssignments.findIndex((t=>"rotPosY"===t[0])),-1!==t&&(this.keyAssignments[t][1]=""),t=this.keyAssignments.findIndex((t=>"rotNegY"===t[0])),-1!==t&&(this.keyAssignments[t][1]="")}this.lerpFactorPosStart=1-.02**(1/(60*(i.delayPos[0]??.3))),this.lerpFactorPosEnd=1-.02**(1/(60*(i.delayPos[1]??.3))),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/(60*(i.delayRot[0]??.3))),this.lerpFactorRotEnd=1-.02**(1/(60*(i.delayRot[1]??.3))),this.lerpFactorPosCamera=1-.02**(1/(60*(i.delayPosCamera??.3))),this.lerpFactorRotCamera=1-.02**(1/(60*(i.delayRotCamera??.3))),this.gravity=12*(this.gloabalPhysics.gravity??PR.defaultData.gravity),this.usePhysics=this.gloabalPhysics.usePhysics??PR.defaultData.usePhysics,this.jumpPower=20*i.jumpPower,this.resetYPosition=this.position.y+Math.abs(i.resetYPosition)*(this.gravity>0?1:-1),this.alignToGround=i.alignToGround??!1,this.orientMode=i.autoOrientMove?i.orientMode:"none",this.orientWith=i.orientWith??cO.defaultDataThirdPerson.orientWith,this.slopeThresh=65*Math.PI/180,"capsule"===i.collider.type?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=i.collider.height/2-i.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y,this.offset=i.collider.height*u$/this.pixelsPerMeter,this.stepThresh=.3*i.collider.height/this.pixelsPerMeter,this.colliderHeight=i.collider.height):"sphere"===i.collider.type?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0,this.offset=2*i.collider.radius*u$/this.pixelsPerMeter,this.stepThresh=2*i.collider.radius*.3/this.pixelsPerMeter,this.colliderHeight=2*i.collider.radius):(this.offset=i.collider.height*u$/this.pixelsPerMeter,this.stepThresh=.3*i.collider.height/this.pixelsPerMeter,this.colliderHeight=i.collider.height),this.collider.type=i.collider.type;let u=(new mm).fromArray(i.collider.position),d=(new fm).setFromEuler((new eg).fromArray([...i.collider.rotation,"XYZ"]));this.collider.position.copy(u).multiply(this.scale),this.collider.rotation.copy(d),this.collider.matrix.compose(u,d,M$),void 0!==i.cameraXAxis&&(this.cameraXAxis=i.cameraXAxis,this.cameraYAxis=i.cameraYAxis,this.minPolarAngle=i.cameraRotXLimits[0],this.maxPolarAngle=i.cameraRotXLimits[1],this.minAzimuthAngleRel=i.cameraRotYLimits[0],this.maxAzimuthAngleRel=i.cameraRotYLimits[1]),this.forwardDir=i.forwardDirection??"-z",this.isFirstPerson&&(this.forwardDir="-z"),this.runMultiplier=i.runMultiplier??2;let p=2*i.navmesh.destinationHelperRadius;if(p>0){let t=new HT;t.push({fi:0,data:{...cR.defaultData("light","phong"),alpha:0},id:"layer1"}),t.push({fi:0,data:{...cR.defaultData("color"),color:i.navmesh.destinationHelperColor,alpha:i.navmesh.destinationHelperColor.a},id:"layer2"});let e=new cG({layers:t},{scene:this.page.scene,shared:this.sharedAssets});this.navMeshPathDest=new rv(iz.create({parameters:{width:p,height:p/10,hollow:.7}}),e),this.navMeshPathDest.material.userData.opacity0=i.navmesh.destinationHelperColor.a}this.activate()}reset(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.object.hiddenMatrix.copy(this.hiddenMatrix0),t){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity();let t=(new eg).setFromQuaternion(this.quaternion,"YXZ"),e=t.y;this.objectRealQuat.copy(this.quaternion),t.y=0,this.quaternion.setFromEuler(t),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),t.set(0,e,0),this.quaternion.setFromEuler(t),this.rot.setFromEuler(t),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}else this.object instanceof PW?this.object.matrixAutoUpdate=!0:this.object.updateMatrix();!0===this.cameraFollow&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.controlsManager.requestRender()}activate(){this.instantiateActions(),this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.addEventListener("visibilitychange",this.handleVisibilityChange)}deactivate(){this.disposeActions(),this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.removeEventListener("visibilitychange",this.handleVisibilityChange)}dispose(){this.deactivate(),this.navMeshPathDest?.parent&&this.page.remove(this.navMeshPathDest)}instantiateActions(){let t=this.data,e=this.sharedAssets;void 0!==t.gameActions&&(this.actions={},hO.list.forEach((i=>{this.actions[i]=JJ({...t,disabled:!1,type:"GameControl"},t.gameActions[i],this.page,e,this.controlsManager.eventManager,this.object)}))),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"),this.initialAction&&(this.initialAction=!1)}disposeActions(){this.initialAction=!1,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),$J(this.actions.idle),$J(this.actions.move),$J(this.actions.run),$J(this.actions.jump)}dispatchStartEvent(t){void 0!==this.actions[t]&&(this.actionState[t]||(this.actionState[t]=!0,this.actions[t].Transition.forEach((t=>{t.play()})),this.actions[t].Animation.forEach((t=>{t.play(!1===this.initialAction)})),this.actions[t].Create.forEach((t=>{t.dispatchStart()})),this.actions[t].Audio.forEach((t=>{t.dispatchGameControl("start")})),this.actions[t].Particles.forEach((t=>{t.dispatchGameControl("start")}))))}dispatchStopEvent(t){void 0!==this.actions[t]&&(!this.actionState[t]||(this.actionState[t]=!1,this.actions[t].Transition.forEach((t=>{t.stop(),null!==t.object.currentState&&t.object.changeSelectedState(null,{scene:this.page.scene,shared:this.sharedAssets})})),this.actions[t].Create.forEach((t=>{t.dispatchStop()})),this.actions[t].Audio.forEach((t=>{t.dispatchGameControl("stop")})),this.actions[t].Particles.forEach((t=>{t.dispatchGameControl("stop")}))))}get colliderWorldPosition(){return m$.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.position)}update(t,e,i){if(this.gravity<0?this.position.y<this.resetYPosition:this.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);let n=(this.isFirstFrame?16.6:t)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let r=60*n,s=!1;if(this.usePhysics&&this.collisionEnabled){let t=g$.set(0,(0===this.velocity.y?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/120,1)*(this.gravity>0?1:-1):this.velocity.y)*n,0).divideScalar(this.pixelsPerMeter),e=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,t,this.object.rigidBody?.collider(0).shape,1,!1,16,void 0,void 0,this.object.rigidBody);if(e){this.onObject=!0,this.groundNormal.set(e.normal2.x,e.normal2.y,e.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(s=!0),0===e.collider.parent()?.bodyType()&&Math.acos(this.groundNormal.y)*(180/Math.PI)>45&&(this.onObject=!1);let t=e.collider.parent();this.groundYRotation=0,this.groundVelocity.set(0,0,0);for(let e of this.sharedGameControlGlobals.entitiesWithTransformAnim)if(e.rigidBody===t&&e.userData.isFollowingObj!==this.object.uuid){(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(m$,S$,g$),this.groundVelocity.subVectors(m$,e.prevT),this.object.getWorldPosition(g$).add(this.collider.position).sub(m$),this.groundYRotation=A$.setFromQuaternion(S$).y-e.prevR.y,v$.copy(g$).applyAxisAngle(_$,this.groundYRotation),this.groundVelocity.add(v$.sub(g$)).divideScalar(n);break}}else this.onObject=!1}if("walk"===this.moveMode&&this.collisionEnabled&&(1===this.movementState.jump&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.onObject?this.velocityTarget.y/=2:this.velocityTarget.y+=this.gravity*r),"fly"===this.moveMode&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,"+z"===this.forwardDir&&this.directionXZ.multiplyScalar(-1),this.directionXZ.manhattanLength()>0&&(this.path=[]),this.navMeshPathDest){let t=this.navMeshPathDest.material;if("walk"===this.moveMode&&this.path.length>1){this.navMeshPathDest.position.copy(this.path[this.path.length-1]),this.navMeshPathDest.parent||this.page.add(this.navMeshPathDest);let e=m$.subVectors(this.path[1],this.position),i=g$.subVectors(this.path[1],this.path[0]);e.dot(i)<0?this.path.shift():(this.directionXZ.x=i.x,this.directionXZ.z=i.z),t.opacity=t.userData.opacity0}else t.opacity-=.05*t.userData.opacity0,this.navMeshPathDest.material.opacity<=0&&this.navMeshPathDest.parent&&this.page.remove(this.navMeshPathDest)}this.directionXZ.normalize(),this.movementState.run?this.moveForce=this.runMultiplier:this.moveForce=1,this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce,this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce,("walk"===this.moveMode?this.velocityTarget.x+this.velocityTarget.z===0:0===this.velocityTarget.manhattanLength())?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),"walk"===this.moveMode&&(this.lerpFactorPos.y=1),!1===this.didHit&&0===this.pushedVelocity.manhattanLength()||!1===this.usePhysics?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**r),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**r),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**r)):this.velocity.copy(this.velocityTarget),("walk"===this.moveMode?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),this.onObject&&(this.dispatchStopEvent("jump"),this.movementState.run?(this.dispatchStopEvent("move"),this.dispatchStartEvent("run")):(this.dispatchStopEvent("run"),this.dispatchStartEvent("move"))));let a=f$.copy(this.velocity);if("none"!==this.orientMode&&!1===this.isFirstPerson){let t=g$.copy(a);t.y=0,a.set(0,a.y,t.length()*("+z"===this.forwardDir?1:-1))}if(this.directionXZ.manhattanLength()>0&&"none"!==this.orientMode&&!1===this.isFirstPerson)if("camera"===this.orientWith&&this.path.length<=1){let t=m$;this.camera.getWorldDirection(t);let e=v$.copy(_$).multiplyScalar(t.dot(_$));t.sub(e);let i=g$.copy(this.directionXZ);i.x*=-1,this.rot.y=t.angleTo(i)*(t.cross(i).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera}else this.rot.y=(this.path.length>1?0:this.euler.y)+Math.atan2(-this.directionXZ.z,this.directionXZ.x)+Math.PI/2*("+z"===this.forwardDir?1:-1);if(A$.setFromVector3(this.rot),"walk"===this.moveMode&&(A$.x=0),a.applyEuler(A$),s&&(S$.setFromUnitVectors(_$,this.groundNormal),a.applyQuaternion(S$)),i){let t=A$.set(0,this.vrEulerYOffset*I$,0);i.applyEuler(t),a.x+=i.x,a.z+=i.z,this.nonColliderPosOffset.elements[13]+=i.y*n}if(!0===this.usePhysics){let t=g$;this.pushedVelocity.set(0,0,0);for(let e of this.sharedGameControlGlobals.entitiesWithTransformAnim){let i=v$.setFromMatrixPosition(e.matrixWorld).sub(e.prevT).divideScalar(n).divideScalar(this.pixelsPerMeter),r=e.rigidBody.collider(0).castCollider(i,this.object.rigidBody.collider(0),m$.copy(a).divideScalar(this.pixelsPerMeter),n,!1);i.multiplyScalar(this.pixelsPerMeter);let s=IB.is(e)?e:e.object;if(null!==r&&this.lastHitObj!==s){let t;e instanceof LB&&(t=e);let i=this.sharedGameControlGlobals.entityToCollisionEvents[s.uuid];if(i)for(let e of i)"character"===e.data.target&&(e.dispatch(t),s.dispatchEvent(n2));this.lastHitObj=s}if(null!==r){this.pushedVelocity.copy(i),t.copy(r.normal1).applyQuaternion(e.quaternion);break}}if(0!==this.pushedVelocity.manhattanLength()){let e=t.dot(a);e<0&&a.addScaledVector(t,-e),a.add(this.pushedVelocity)}else a.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),"normal"===this.rotationMode&&(this.movementState.rotPosX||this.movementState.rotNegX)||"steer"===this.rotationMode&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||"walk"===this.moveMode)?this.rotVelocityStick.x=-this.rotDirection.x*this.speedOrbit*this.rotForce:this.rotVelocityStick.x=0,"normal"===this.rotationMode&&(this.movementState.rotPosY||this.movementState.rotNegY)||"steer"===this.rotationMode&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?this.rotVelocityStick.y=-this.rotDirection.y*this.speedOrbit*this.rotForce:this.rotVelocityStick.y=0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(n),this.rotVelocityStick),0===this.rotVelocityTarget.manhattanLength()?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**r):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**r),this.euler.x+=this.rotVelocity.x*n,this.euler.y+=this.rotVelocity.y*n+this.groundYRotation,0===this.rotVelocityTarget.y&&0===this.directionXZ.manhattanLength()?this.rotationAccumWhenOrientWithCamera=0:(!1===this.cameraFollow||"Locked"===this.cameraYAxis)&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*n),!1===this.isFirstPerson&&"none"!==this.orientMode&&this.directionXZ.manhattanLength()>0){if("radial"===this.orientMode){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle(_$,this.euler.y-this.euler0.y);let t=g$.copy(this.objectToCamXZ).normalize(),e=v$.copy(a).multiplyScalar(n);e.y=0;let i=e.sub(m$.copy(t).multiplyScalar(e.dot(t))).cross(t).y;this.euler.y-=Math.atan2(i,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*n+this.groundYRotation,0!==this.rotVelocityTarget.y&&(!1===this.cameraFollow||"Locked"===this.cameraYAxis)&&(this.euler.y=this.rot.y);if(!0===this.cameraFollow&&("walk"===this.moveMode?"Limit"===this.cameraXAxis?this.euler.x=Nf.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):this.euler.x=Nf.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):"Limit"===this.cameraXAxis&&(this.euler.x=Nf.clamp(this.euler.x,-this.PI_2,this.PI_2))),"fly"===this.moveMode?this.rot.x=this.euler.x:this.isFirstPerson&&(e?(A$.copy(e),A$.y=0):(A$.copy(this.euler),A$.y=0),this.nonColliderRotOffset.makeRotationFromEuler(A$)),e&&("walk"===this.moveMode?(this.rot.y=e.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(e),this.rot.y+=this.vrEulerYOffset*I$),w$.setFromAxisAngle(E$,this.rot.x),S$.setFromAxisAngle(_$,this.rot.y),S$.multiply(w$),w$.setFromAxisAngle(C$,this.rot.z),S$.multiply(w$),this.quaternion.copy(S$),this.objectRealQuat.multiplyQuaternions(this.quaternion,this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){let t=g$.copy(a).multiplyScalar(n/this.pixelsPerMeter),e=null;this.didHit=!1;let i=new mm;for(let n=0;n<5;n++){let r=t.length(),s=v$.copy(t).normalize();if(e=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(i),this.colliderWorldQuat,s,this.object.rigidBody?.collider(0).shape,r,!1,24,void 0,void 0,this.object.rigidBody),null===e){0===n&&0!==this.directionXZ.manhattanLength()&&(this.lastHitObj=null),i.add(t);break}{this.didHit=!0;let a=this.sharedGameControlGlobals.colliderToEntity.get(e.collider.handle);if(a!==this.lastHitObj&&0===n){this.lastHitObj=a;let t=this.sharedGameControlGlobals.entityToCollisionEvents[a?.uuid];if(t)for(let i of t)if("character"===i.data.target){let t,n=(this.sharedGameControlGlobals.rapierWorld?.getCollider(e.collider.handle))._parent;if(a.cloner)for(let e of a.cloner.children)if(e.rigidBody===n){t=e;break}i.dispatch(t),a.dispatchEvent(n2)}}let o=d$.set(e.normal2.x,e.normal2.y,e.normal2.z).applyQuaternion(this.colliderWorldQuat),l=p$.copy(s).multiplyScalar(e.toi).dot(o),h=e.toi;if(0===h&&(this.position.y+=this.offset*this.pixelsPerMeter),l>this.offset&&(h=e.toi*(l-this.offset)/l,i.addScaledVector(s,h)),t.copy(s).multiplyScalar(r-h),Math.acos(-o.y)>this.slopeThresh){let n=this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(i),r=v$.copy(e.witness2).applyQuaternion(this.colliderWorldQuat);r.y=0;let s=n.add(r);s.y+=this.stepThresh;let a=this.sharedGameControlGlobals.rapierWorld.castShape(s,this.colliderWorldQuat,t,this.object.rigidBody?.collider(0).shape,1,!1,24,void 0,void 0,this.object.rigidBody);null!==a&&0===a.toi&&(o.y=0,o.normalize())}t.addScaledVector(o,-t.dot(o))}}this.position.addScaledVector(i,this.pixelsPerMeter),this.object.rigidBody?.setTranslation(m$.copy(this.position).divideScalar(this.pixelsPerMeter),!0),this.object.rigidBody?.setRotation(w$.copy(this.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else{let t=this.onObject?1:5,e=a.multiplyScalar(n/t);for(let i=0;i<t;i++)this.position.add(e),this.collisionAdjustment(n/t)}else this.position.addScaledVector(a,n);if("walk"===this.moveMode&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.matrix.compose(this.position,this.quaternion,this.scale),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),!0===this.cameraFollow){this.updateFollowArms();let t=this.objectToTarget.add(this.position),e=this.targetToCamera.add(t);y$.lookAt(e,t,_$).setPosition(e),y$.decompose(this.targetPos,this.targetQuat,m$),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**r),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**r),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),"Limit"===this.cameraYAxis&&"cartesian"===this.orientMode&&(this.euler.y=Nf.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=Nf.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.object.dispatchEvent(k$),(!(this.path.length<2&&this.lastPosition.distanceToSquared(this.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(void 0===this.camera||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate))||"fly"!==this.moveMode&&!0!==this.onObject&&!1!==this.collisionEnabled||!(null===this.navMeshPathDest||this.navMeshPathDest.material.opacity<-.04*this.navMeshPathDest?.material?.userData.opacity0))&&(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.position),this.object.dispatchEvent(D$),!0)}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let t,e=w$.setFromAxisAngle(_$,"Limit"===this.cameraYAxis&&"radial"!==this.orientMode?Nf.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);("Locked"!==this.cameraYAxis||"radial"===this.orientMode)&&this.objectToTarget.applyQuaternion(e),t="Limit"===this.cameraXAxis?Nf.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):Nf.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let i=m$.copy(this.cameraPolarAxis0);("Locked"!==this.cameraYAxis||"radial"===this.orientMode)&&i.applyQuaternion(e);let n=S$.setFromAxisAngle(i,t);"Locked"!==this.cameraYAxis&&this.targetToCamera.applyQuaternion(e),"Locked"!==this.cameraXAxis&&this.targetToCamera.applyQuaternion(n)}groundTiltAdjustment(t){180*_$.angleTo(t)/Math.PI<15||180*_$.angleTo(t)/Math.PI>85?w$.identity():w$.setFromUnitVectors(_$,t),this.groundTilt.slerp(w$,.06),this.groundTiltInv.copy(this.groundTilt).invert()}collisionAdjustment(t){let e=p$.set(0,0,0);this.object.matrix.compose(this.position,this.quaternion,this.scale);let i=y$.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(m$,w$,g$).compose(m$,w$,M$);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach((t=>{if(t===this.object||t.isDescendantOf(this.object))return;T$.makeEmpty(),t.updateMatrixWorldSVD();let n=t.matrixWorldRigid,r=b$.copy(n).invert(),s=x$.copy(b$).multiply(i);P$.copy(this.collider.segment),P$.start.applyMatrix4(s),P$.end.applyMatrix4(s);let a=d$.copy(this.position).applyMatrix4(r);T$.expandByPoint(P$.start),T$.expandByPoint(P$.end),T$.min.addScalar(-this.collider.radius),T$.max.addScalar(this.collider.radius),t.bvhGeometry.boundsTree.shapecast({traverseBoundsOrder:t=>t.distanceToPoint(P$.end),intersectsBounds:t=>t.intersectsBox(T$),intersectsTriangle:t=>{let i=m$,r=g$,s=t.closestPointToSegment(P$,i,r);if(s<this.collider.radius){let t=this.collider.radius-s,o=r.sub(i).normalize(),l=v$.copy(a);l.addScaledVector(o,t);let h=l.applyMatrix4(n).sub(this.position);e.add(h),P$.start.addScaledVector(o,t),P$.end.addScaledVector(o,t)}}})})),T$.makeEmpty(),P$.copy(this.collider.segment),P$.start.applyMatrix4(i),P$.end.applyMatrix4(i),T$.expandByPoint(P$.start),T$.expandByPoint(P$.end),T$.min.addScalar(-this.collider.radius),T$.max.addScalar(this.collider.radius),this.sharedGameControlGlobals.staticMeshBVH?.shapecast({traverseBoundsOrder:t=>t.distanceToPoint(P$.end),intersectsBounds:t=>t.intersectsBox(T$),intersectsTriangle:t=>{let i=m$,n=g$,r=t.closestPointToSegment(P$,i,n);if(r<this.collider.radius){let t=this.collider.radius-r,s=n.sub(i).normalize();this.alignToGround&&this.groundTiltAdjustment(s),e.addScaledVector(s,t),P$.start.addScaledVector(s,t),P$.end.addScaledVector(s,t)}}}),this.onObject=Math.abs(e.y)>Math.abs(t*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let n=Math.max(0,e.length()-1e-5);e.normalize().multiplyScalar(n),this.position.add(e)}},O$=R$;O$.isLocked=!1;var L$=np(ap());function B$(t){let e=t.elements,i=e[0]**2+e[1]**2+e[2]**2,n=e[4]**2+e[5]**2+e[6]**2,r=e[8]**2+e[9]**2+e[10]**2,s=e[0]**2+e[4]**2+e[8]**2,a=e[1]**2+e[5]**2+e[9]**2,o=e[2]**2+e[6]**2+e[10]**2,l=1e-8;return i<l||n<l||r<l||s<l||a<l||o<l}function z$(t,e){let i=new Hg;if(e&&B$(e))return i.setAttribute("position",new Bg([],3)),i.setIndex([]),i;if(!t.getAttribute("position"))return i.setAttribute("position",new Bg([],3)),i.setIndex([]),i;let{positions:n,triIndices:r}=ZN(t.getAttribute("position"),t.getIndex());return i.setAttribute("position",new Bg(n,3)),i.setIndex(r),e&&i.applyMatrix4(e),i}var F$=new Wm,N$=new Wm,U$=[[0,0,0],[0,0,0],[0,0,0]];function V$(t){let e=t.elements;U$[0][0]=e[0],U$[0][1]=e[4],U$[0][2]=e[8],U$[1][0]=e[1],U$[1][1]=e[5],U$[1][2]=e[9],U$[2][0]=e[2],U$[2][1]=e[6],U$[2][2]=e[10];let{u:i,v:n}=(0,L$.SVD)(U$),r=F$.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),s=N$.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1);return r.multiply(s.transpose())}var j$=class extends YS{constructor(){super(),this.layers.enable(3),this.layers.enable(8),this.layers.enable(9)}setFromCamera(t,e){e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,-1).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):e.isPerspectiveCamera?(this.ray.origin.set(t.x,t.y,-1).unproject(e),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return t.forEach((t=>{t.visible&&this.intersectObject(t,e,i)})),i}createRaycastLineHelper(){let t=new wx({color:65280,linewidth:10}),e=new mm(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),i=new mm(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),n=this.camera.far-this.camera.near,r=(new mm).addVectors(e,i.multiplyScalar(n)),s=new Hg;return s.setFromPoints([e,r]),new Mx(s,t)}},G$=t=>t instanceof GW||t instanceof sQ;function H$(t,e){return t.distance-e.distance}function W$(t,e,i){if(KB(e)&&e.visible){LW(e)&&e.raycast(t,i);for(let n of e.children)W$(t,n,i)}}function q$(t,e,i){if(!(arguments.length>3&&void 0!==arguments[3]&&arguments[3])&&!i.some((e=>void 0!==Q$(t,e))))return[];let n=[];return e.children.forEach((e=>W$(t,e,n))),n.sort(H$),n}function Y$(t){let e=[];if(t.length){let i=t[0].object;KB(i)&&e.push(i);let n=i.parent;for(;n;)G$(n)&&e.push(n),n=n.parent}return e}function X$(t,e,i,n){let r=t.frame;if(r){let t=e[0]*r.width,s=(1-e[1])*r.height;for(let e of i){let i=e===r.uuid?r:r.find(e);if(i?.intersects(t,s))return n(i),!0}}return!1}function Q$(t,e){if(LW(e)){if(e.visible){let i=[];return e.raycast(t,i),i.length?i[0]:void 0}}else if(G$(e))return K$(t,e)}function K$(t,e){if(KB(e)&&e.visible){if(LW(e)){let i=[];if(e.raycast(t,i),i.length)return i[0]}for(let i of e.children){let e=K$(t,i);if(e)return e}}}var Z$=class{constructor(t,e,i,n,r,s,a,o){this.renderer=t,this.publish=e,this.scene=i,this.getCamera=n,this.sharedAssets=r,this.requestRender=s,this.isExport=a,this.frame=o,this.raycaster=new j$,this._useWindowEvents=!1,this.pointerWorld={x:0,y:0},this.pointerScreen={x:0,y:0},this._useWindowEvents="window"===e.mouseEventTarget,this.domElement=t.domElement,this.eventElement=this._useWindowEvents?window:t.domElement,this._domRect=this.domElement.getBoundingClientRect()}get stopRaycast(){return this.publish.stopRaycast}get page(){return this.scene.activePage}set useWindowEvents(t){this._useWindowEvents=t,this.eventElement=t?window:this.renderer.domElement}get useWindowEvents(){return this._useWindowEvents}set domRect(t){this._domRect=t}get domRect(){return this._domRect}updateRaycaster(t){let{pageX:e,pageY:i}=t.touches?.length>0?t.touches[0]:t;this.pointerWorld=function(t,e,i){return{x:(t-(i.left+window.scrollX))/i.width*2-1,y:-(e-(i.top+window.scrollY))/i.height*2+1}}(e,i,this._domRect),this.pointerScreen=function(t,e,i){return{x:(t-(i.left+window.scrollX))/i.width,y:1-(e-(i.top+window.scrollY))/i.height}}(e,i,this._domRect),this.raycaster.setFromCamera(this.pointerWorld,this.getCamera())}},J$=class{constructor(t){this.eventContext=t,this.domEventsNeeded=new Set,this.hasVideoAction=!1}connect(){}disconnect(){}},$$=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],t0=t=>$$.find((e=>{let[i,n]=e;return n===t}))?.[0],e0=t=>$$.find((e=>{let[i]=e;return i===t}))?.[1],i0=(t,e)=>{let i=t0(t);if(i){let t=new CustomEvent(i,{bubbles:!0});return Object.defineProperty(t,"target",{writable:!1,value:e}),t}},n0=class extends J${constructor(){super(...arguments),this.objectsPerEvents=new Map,this.splineEvents={},this.onBeginEvent=t=>{if(!t.eventName||!t.target||"Scroll"===t.eventName)return;let e=this.splineEvents[t0(t.eventName)]?.[t.target.uuid];if(!e)return;"Scroll"===t.eventName&&void 0!==t.deltaY&&Object.assign(e,{deltaY:t.deltaY});let{domElement:i}=this.eventContext;i.dispatchEvent(e)}}connect(){let{page:t}=this.eventContext;t.traverseEntity((t=>{if(t.data?.events.length)for(let[e,i]of $$)if(t.data.events.some((t=>t.data.type===i&&!t.data.disabled))){this.objectsPerEvents.has(e)?this.objectsPerEvents.get(e)?.push(t):this.objectsPerEvents.set(e,[t]);let n={id:t.uuid,name:t.name},r=i0(i,n),s=this.splineEvents[e];s?s[t.uuid]=r:this.splineEvents[e]={[t.uuid]:r}}})),this.objectsPerEvents.forEach((t=>{t.forEach((t=>{t.addEventListener("beginEvent",this.onBeginEvent)}))}))}disconnect(){this.objectsPerEvents.forEach((t=>{t.forEach((t=>{t.removeEventListener("beginEvent",this.onBeginEvent)}))}))}},r0=class{constructor(t,e,i,n,r,s){if(this.id=t,this.data=e,this.object=i,this.entered=!1,("KeyDown"===e.type||"KeyUp"===e.type||"KeyPress"===e.type)&&!e.key)throw new Error("Missing property");this.actions=JJ(e,e.actions,n,r,s,i)}disconnect(){$J(this.actions)}dispatchHeld(t){this.actions.Create.forEach((e=>{t&&e.dispatchThrottled.cancel(),e.dispatchThrottled()}))}dispatch(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.actions.Transition.forEach((t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())})),"MousePress"===this.data.type||"KeyPress"===this.data.type?this.entered||(this.entered=!0,this.actions.Transition.forEach((t=>t.playFromCurrent())),this.actions.Animation.forEach((t=>t.playFromCurrent())),this.actions.SwitchCamera.forEach((t=>t.playFromCurrent())),this.actions.Create.forEach((t=>t.dispatchStart()))):(this.actions.Transition.some((t=>t.playing&&"Toggle"!==t.data.runMode))||this.actions.Transition.forEach((t=>{"Toggle"===t.data.runMode?t.toggle():t.play()})),this.actions.SwitchCamera.some((t=>t.playing&&"Toggle"!==t.data.runMode))||this.actions.SwitchCamera.forEach((t=>{"Toggle"===t.data.runMode?t.toggle():t.play()})),this.actions.Animation.forEach((t=>{"Toggle"===t.data.runMode?t.toggle():t.play()}))),this.actions.Link.forEach((t=>{t.dispatch()})),this.actions.SceneTransition.forEach((t=>{t.dispatch()})),!1===t&&this.actions.Create.forEach((t=>{t.dispatch()})),this.actions.Destroy.forEach((t=>{t.dispatch()})),this.actions.Reset.forEach((t=>{t.dispatch()})),this.actions.Audio.forEach((t=>{t.dispatchBasic()})),this.actions.Video.forEach((t=>{t.dispatchBasic()})),this.actions.Particles.forEach((t=>{t.dispatchBasic()})),this.actions.SetVariable.forEach((t=>t.checkConditions())),this.actions.SetVariable.forEach((t=>t.dispatch())),this.actions.DynamicVariablePlay.forEach((t=>t.dispatch())),this.actions.ClearLocalStorage.forEach((t=>t.dispatch())),this.actions.UserAPI.forEach((t=>t.dispatch()))}dispatchRelease(){this.entered&&(this.entered=!1,this.actions.Transition.forEach((t=>t.reverseFromCurrent())),this.actions.Particles.forEach((t=>t.reverseFromCurrent())),this.actions.Animation.forEach((t=>t.reverseFromCurrent())),this.actions.SwitchCamera.forEach((t=>t.reverseFromCurrent())),this.actions.Create.forEach((t=>t.dispatchStop())))}dispatchUserEvent(t){this.actions.Transition.forEach((t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())})),t?(this.actions.Transition.forEach((t=>t.reverseFromCurrent())),this.actions.Animation.forEach((t=>t.reverseFromCurrent())),this.actions.SwitchCamera.forEach((t=>t.reverseFromCurrent()))):(this.actions.Transition.forEach((t=>t.playFromCurrent())),this.actions.Animation.forEach((t=>t.playFromCurrent())),this.actions.SwitchCamera.forEach((t=>t.playFromCurrent()))),this.actions.Link.forEach((t=>{t.dispatch()})),this.actions.SceneTransition.forEach((t=>{t.dispatch()})),this.actions.Create.forEach((t=>{t.dispatch()})),this.actions.Destroy.forEach((t=>{t.dispatch()})),this.actions.Reset.forEach((t=>{t.dispatch()})),this.actions.Audio.forEach((t=>{t.dispatchBasic()})),this.actions.Video.forEach((t=>{t.dispatchBasic()})),this.actions.Particles.forEach((t=>{t.dispatchBasic()})),this.actions.SetVariable.forEach((t=>t.checkConditions())),this.actions.SetVariable.forEach((t=>t.dispatch())),this.actions.DynamicVariablePlay.forEach((t=>t.dispatch())),this.actions.ClearLocalStorage.forEach((t=>t.dispatch())),this.actions.UserAPI.forEach((t=>t.dispatch()))}},s0=class extends J${constructor(t,e,i){super(t),this.eventManager=e,this.useForRaycastProperty=i,this.objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]},this.canvasMouseEvents=[],this.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}},this.heldKeys={},this.heldKeysPress={},this._prevObjects=[],this.sceneInterects=null,this.onCanvasRaycast=t=>{if(!0===this.useForRaycastProperty&&null===this.sceneInterects){this.eventContext.updateRaycaster(t);let{raycaster:e,page:i}=this.eventContext,n=q$(e,i,[],!0);this.sceneInterects=n,n.length&&(this.eventContext.sharedAssets.raycastProperty={x:n[0].point.x,y:n[0].point.y,z:n[0].point.z,objX:n[0].object.matrixWorld.elements[12],objY:n[0].object.matrixWorld.elements[13],objZ:n[0].object.matrixWorld.elements[14]})}},this.onCanvasMouseDown=t=>{(t.target===this.eventContext.domElement||"SPLINE-VIEWER"===t.target.tagName)&&this.canvasMouseEvents.forEach((e=>{("MouseDown"===e.data.type||"MousePress"===e.data.type)&&(this.onCanvasRaycast(t),e.dispatch())}))},this.onCanvasMouseUp=t=>{(t.target===this.eventContext.domElement||"SPLINE-VIEWER"===t.target.tagName)&&this.canvasMouseEvents.forEach((e=>{"MouseUp"===e.data.type?(this.onCanvasRaycast(t),e.dispatch()):"MousePress"===e.data.type&&e.dispatchRelease()}))},this.onMouseDown=t=>{gT.length>1||(this.eventContext.updateRaycaster(t),this.handleMouseEvent("MouseDown"))},this.onMouseUp=t=>{gT.length>1||(this.eventContext.updateRaycaster(t),this.handleMouseEvent("MouseUp"))},this.onMousePressDown=t=>{gT.length>1||(this.eventContext.updateRaycaster(t),this.handleMousePressEvent())},this.onMousePressRelease=t=>{gT.length>1||(this.eventContext.updateRaycaster(t),this.handleMousePressEvent(!0))},this.onKeyDown=t=>{this.heldKeys[t.key]||(this.handleKeyEvent(t,"KeyDown"),this.handleKeyEventHeld(t,"KeyDown",!0)),this.heldKeys[t.key]=!0},this.onKeyUp=t=>{this.handleKeyEvent(t,"KeyUp"),this.handleKeyEventHeld(t,"KeyUp",!0)},this.onKeyPressDown=t=>{this.heldKeysPress[t.key]?this.handleKeyEventHeld(t,"KeyPress"):(this.handleKeyEvent(t,"KeyPress"),this.handleKeyEventHeld(t,"KeyPress",!0)),this.heldKeysPress[t.key]=!0},this.onKeyPressUp=t=>{this.handleKeyEvent(t,"KeyPress",!0)},this.releaseHeldKey=t=>{delete this.heldKeys[t.key]},this.releaseHeldKeyPress=t=>{delete this.heldKeysPress[t.key]},this._onUserEvent=t=>{let{eventName:e,target:i,reverse:n}=t;if(!e||!i)return;let r=e0(e);r&&("MouseDown"===r||"MouseUp"===r||"MousePress"===r?(i.dispatchEvent({type:"beginEvent",eventName:r}),this.eventsPerObjects[r]?.[i.uuid]?.forEach((t=>{t.dispatchUserEvent(n)}))):("KeyDown"===r||"KeyUp"===r||"KeyPress"===r)&&(i.dispatchEvent({type:"beginEvent",eventName:r}),this.eventsPerObjects[r]?.[i.uuid]?.forEach((t=>{t.dispatchUserEvent()}))))}}connect(){let{page:t,sharedAssets:e,domElement:i}=this.eventContext,n=(i,n)=>{if(!i.data?.events.length)return;let r=["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"];for(let s of r){let r=this.eventsPerObjects[s];if(i.data.events.filter((t=>{let{data:e}=t;return e.type===s&&!0!==e.disabled})).forEach((n=>{let{id:s,data:a}=n;try{let n=new r0(s,a,i,t,e,this.eventManager);n.actions.Video.length&&(this.hasVideoAction=!0),"MouseDown"!==a.type&&"MouseUp"!==a.type&&"MousePress"!==a.type||"Canvas"!==a.mode&&"Window"!==a.mode?(r[i.uuid]?r[i.uuid].some((t=>t.id===n.id))||r[i.uuid].push(n):r[i.uuid]=[n],i instanceof IQ&&i.traverseChildren((t=>{if(!t.visible)return!0;t instanceof xH&&2!==t.data.geometry.shapeBlendNode?.operation&&(r[t.uuid]?r[t.uuid].push(n):r[t.uuid]=[n])}))):this.canvasMouseEvents.push(n)}catch(o){}})),r[i.uuid]?.length&&(this.objectsPerTypes[s].push(i instanceof sX&&("MouseDown"===s||"MouseUp"===s||"MousePress"===s)?n:i),i instanceof IQ)){let t=this.objectsPerTypes[s];i.traverseChildren((e=>{if(!e.visible)return!0;e instanceof xH&&-1===t.indexOf(e)&&t.push(e)}))}}};t.traverseEntity((t=>{(t instanceof cQ||t instanceof tQ)&&t.frame?.traverse((e=>{n(e,t)})),n(t)})),this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),i.addEventListener("pointerdown",this.onCanvasMouseDown),i.addEventListener("pointerup",this.onCanvasMouseUp),(this.objectsPerTypes.MouseDown?.length||this.useForRaycastProperty)&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMouseDown)),this.objectsPerTypes.MouseUp?.length&&(this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMouseUp)),this.objectsPerTypes.MousePress?.length&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMousePressRelease)),this.objectsPerTypes.KeyDown?.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),this.objectsPerTypes.KeyUp?.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),this.objectsPerTypes.KeyPress?.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach((t=>{let[e,i]=t;i.forEach((t=>{t.addEventListener("userEvent",this._onUserEvent)}))}))}disconnect(){let{domElement:t}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},t.removeEventListener("pointerdown",this.onCanvasMouseDown),t.removeEventListener("pointerup",this.onCanvasMouseUp),t.removeEventListener("pointerdown",this.onMouseDown),t.removeEventListener("pointerdown",this.onMousePressDown),t.removeEventListener("pointerup",this.onMouseUp),t.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach((t=>{Object.values(t).forEach((t=>{t.forEach((t=>{t.disconnect()}))}))})),this.canvasMouseEvents.forEach((t=>{t.disconnect()})),Object.entries(this.objectsPerTypes).forEach((t=>{let[e,i]=t;i.forEach((t=>{t.removeEventListener("userEvent",this._onUserEvent)}))}))}handleMouseEvent(t){let{stopRaycast:e,raycaster:i,page:n,pointerScreen:r}=this.eventContext,s=this.objectsPerTypes[t],a=s.filter((t=>!(t instanceof sX)));if((s.length||this.useForRaycastProperty)&&(!n.uiCanvas||!X$(n,[r.x,r.y],Object.keys(this.eventsPerObjects[t]),(e=>{this.handleObjectMouseEventDispatch(e,t)})))){if(e||this.useForRaycastProperty){let r;if(null===this.sceneInterects?r=q$(i,n,a,this.useForRaycastProperty):(r=this.sceneInterects,this.sceneInterects=null),this.useForRaycastProperty&&r.length&&(this.eventContext.sharedAssets.raycastProperty={x:r[0].point.x,y:r[0].point.y,z:r[0].point.z,objX:r[0].object.matrixWorld.elements[12],objY:r[0].object.matrixWorld.elements[13],objZ:r[0].object.matrixWorld.elements[14]}),e){let e=[r[0]?.uv?.x??0,r[0]?.uv?.y??0];Y$(r).forEach((i=>{i instanceof cQ&&X$(i,e,Object.keys(this.eventsPerObjects[t]),(e=>{this.handleObjectMouseEventDispatch(e,t)})),this.eventsPerObjects[t][i.uuid]&&this.handleObjectMouseEventDispatch(i,t)}))}}e||a.forEach((e=>{let n=Q$(i,e);n&&(this.handleObjectMouseEventDispatch(e,t),e instanceof cQ&&X$(e,[n?.uv?.x??0,n?.uv?.y??0],Object.keys(this.eventsPerObjects[t]),(e=>{this.handleObjectMouseEventDispatch(e,t)})))}))}}handleMousePressEvent(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e="MousePress",i=this.objectsPerTypes[e],n=i.filter((t=>!(t instanceof sX))),r=[];if(i.length){if(!t){let{stopRaycast:t,raycaster:i,page:s,pointerScreen:a}=this.eventContext,o=!1;if(s.uiCanvas&&(o=X$(s,[a.x,a.y],Object.keys(this.eventsPerObjects[e]),(t=>{r.push(t)}))),t&&!o){let t=q$(i,s,n);r=Y$(t),t.forEach((t=>{t.object instanceof cQ&&X$(t.object,[t?.uv?.x??0,t?.uv?.y??0],Object.keys(this.eventsPerObjects[e]),(t=>{r.push(t)}))}))}else n.forEach((t=>{let n=Q$(i,t);n&&(r.push(t),t instanceof cQ&&X$(t,[n?.uv?.x??0,n?.uv?.y??0],Object.keys(this.eventsPerObjects[e]),(t=>{r.push(t)})))}))}this._prevObjects.length&&this._prevObjects.forEach((t=>{r.includes(t)||this.handleObjectMouseEventDispatchRelease(t,e)})),r.length&&r.forEach((t=>{this.handleObjectMouseEventDispatch(t,e)})),this._prevObjects=r}}handleObjectMouseEventDispatch(t,e){t.dispatchEvent({type:"beginEvent",eventName:e}),this.eventsPerObjects[e]?.[t.uuid]?.forEach((t=>{t.dispatch()}))}handleObjectMouseEventDispatchRelease(t,e){t.dispatchEvent({type:"beginEvent",eventName:e}),this.eventsPerObjects[e]?.[t.uuid]?.forEach((t=>{t.dispatchRelease()}))}handleKeyEvent(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.objectsPerTypes[e].forEach((n=>{let r=this.eventsPerObjects[e][n.uuid];r.some((e=>{let{data:i}=e;return"key"in i&&i.key===t.key}))&&n.dispatchEvent({type:"beginEvent",eventName:e}),r.forEach((e=>{"key"in e.data&&e.data.key===t.key&&(i?e.dispatchRelease():e.dispatch(!0))}))}))}handleKeyEventHeld(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.objectsPerTypes[e].forEach((n=>{this.eventsPerObjects[e][n.uuid].forEach((e=>{"key"in e.data&&e.data.key===t.key&&e.dispatchHeld(i)}))}))}},a0=new mm,o0=new mm,l0=class{constructor(t,e,i,n,r){this.actionsIn=JJ(t,t.inActions,i,n,r,e),this.actionsOut=JJ(t,t.outActions,i,n,r,e)}disconnect(){$J(this.actionsIn),$J(this.actionsOut)}},h0=class extends l0{constructor(t,e,i,n,r,s){super(e,i,n,r,s),this.id=t,this.data=e,this.object=i,this.stage="out",this.objects=[],this.onUpdateMatrixWorld=()=>{for(let n of this.objects)if(!n.visible)return;let t=a0.setFromMatrixPosition(this.objects[0].matrixWorld),e=o0.setFromMatrixPosition(this.objects[1].matrixWorld),i=t.distanceTo(e)<=this.distance?"in":"out";if(this.stage!==i){this.stage=i;let t="in"===i?this.actionsIn:this.actionsOut;t.Audio.forEach((t=>t.dispatchConditional())),t.Particles.forEach((t=>t.dispatchConditional())),t.Video.forEach((t=>t.dispatchConditional())),t.Link.forEach((t=>t.dispatch())),t.Create.forEach((t=>t.dispatch())),t.Destroy.forEach((t=>t.dispatch())),t.Reset.forEach((t=>t.dispatch())),t.Transition.forEach((t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()})),t.Transition.forEach((t=>t.play())),t.Animation.forEach((t=>t.play())),t.SwitchCamera.forEach((t=>t.play())),t.SceneTransition.forEach((t=>t.dispatch())),t.SetVariable.forEach((t=>t.checkConditions())),t.SetVariable.forEach((t=>t.dispatch())),t.DynamicVariablePlay.forEach((t=>t.dispatch())),t.ClearLocalStorage.forEach((t=>t.dispatch())),t.UserAPI.forEach((t=>t.dispatch()))}};let{distance:a,fromObject:o,toObject:l}=e.condition;this.distance=a;for(let h of[o,l]){if(!h)throw new Error("Missing property");let t=n.find(h);if(!t)throw new Error("Missing property");this.objects.push(t)}}connect(){window.setTimeout((()=>{this.objects.forEach((t=>{t.addEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)})),this.onUpdateMatrixWorld()}),0)}disconnect(){super.disconnect(),this.stage="out",this.objects.forEach((t=>{t.removeEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)}))}},c0=class extends l0{constructor(t,e,i,n,r,s){super(e,i,n,r,s),this.id=t,this.data=e,this.object=i,this.onBegin=t=>{let{target:e,state:i}=t;this.toState!==i&&(this.actionsOut.Audio.forEach((t=>t.dispatchConditional())),this.actionsOut.Particles.forEach((t=>t.dispatchConditional())),this.actionsOut.Video.forEach((t=>t.dispatchConditional())),this.actionsOut.Link.forEach((t=>t.dispatch())),this.actionsOut.Create.forEach((t=>t.dispatch())),this.actionsOut.Destroy.forEach((t=>t.dispatch())),this.actionsOut.Reset.forEach((t=>t.dispatch())),this.actionsIn.Transition.forEach((t=>t.pause())),this.object.currentTransitionEvent=this,this.actionsOut.Transition.forEach((t=>t.play())),this.actionsOut.Animation.forEach((t=>t.play())),this.actionsIn.SwitchCamera.forEach((t=>t.pause())),this.actionsOut.SwitchCamera.forEach((t=>t.play())),this.actionsOut.SceneTransition.forEach((t=>t.dispatch())),this.actionsOut.SetVariable.forEach((t=>t.checkConditions())),this.actionsOut.SetVariable.forEach((t=>t.dispatch())),this.actionsOut.DynamicVariablePlay.forEach((t=>t.dispatch())),this.actionsOut.ClearLocalStorage.forEach((t=>t.dispatch())),this.actionsOut.UserAPI.forEach((t=>t.dispatch())))},this.onComplete=t=>{let{target:e,state:i}=t;this.toState===i&&(this.actionsIn.Audio.forEach((t=>t.dispatchConditional())),this.actionsIn.Particles.forEach((t=>t.dispatchConditional())),this.actionsIn.Video.forEach((t=>t.dispatchConditional())),this.actionsIn.Link.forEach((t=>t.dispatch())),this.actionsIn.Create.forEach((t=>t.dispatch())),this.actionsIn.Destroy.forEach((t=>t.dispatch())),this.actionsIn.Reset.forEach((t=>t.dispatch())),this.actionsOut.Transition.forEach((t=>t.pause())),this.actionsOut.Transition.forEach((t=>t.pause())),this.object.currentTransitionEvent=this,this.actionsIn.Transition.forEach((t=>t.play())),this.actionsIn.Animation.forEach((t=>t.play())),this.actionsOut.SwitchCamera.forEach((t=>t.pause())),this.actionsIn.SwitchCamera.forEach((t=>t.play())),this.actionsIn.SceneTransition.forEach((t=>t.dispatch())),this.actionsIn.SetVariable.forEach((t=>t.checkConditions())),this.actionsIn.SetVariable.forEach((t=>t.dispatch())),this.actionsIn.DynamicVariablePlay.forEach((t=>t.dispatch())),this.actionsOut.ClearLocalStorage.forEach((t=>t.dispatch())),this.actionsOut.UserAPI.forEach((t=>t.dispatch())))};let{condition:a}=e;if(!a.object)throw new Error("Missing property");let o=n.find(a.object)??n.scene.find2D(a.object);if(!o)throw new Error("Missing property");if(this.toObject=o,a.state&&!this.toObject.states?.[a.state])throw new Error("Missing property");this.toState=a.state}connect(){Z_(this.actionsOut).forEach((t=>{this.actionsOut[t]?.length&&this.toObject.addEventListener("beginState",this.onBegin)})),Z_(this.actionsIn).forEach((t=>{this.actionsIn[t]?.length&&this.toObject.addEventListener("completeState",this.onComplete)}))}disconnect(){super.disconnect(),Z_(this.actionsOut).forEach((t=>{this.actionsIn[t]?.length&&this.toObject.removeEventListener("beginState",this.onBegin)})),Z_(this.actionsIn).forEach((t=>{this.actionsIn[t]?.length&&this.toObject.removeEventListener("completeState",this.onComplete)}))}},u0=class extends J${constructor(t,e){super(t),this.eventManager=e,this.eventsPerConditions={Comparison:[],Distance:[],State:[]},this.hasVideoAction=!1}connect(){super.connect();let{page:t,sharedAssets:e}=this.eventContext;t.traverseEntity((i=>{if(i.data?.events.length)for(let{id:n,data:r}of i.data.events)if(!r.disabled&&"Conditional"===r.type)try{let s;"Comparison"===r.condition.type||("Distance"===r.condition.type?s=new h0(n,r,i,t,e,this.eventManager):"State"===r.condition.type&&(s=new c0(n,r,i,t,e,this.eventManager))),s&&(this.eventsPerConditions[r.condition.type].push(s),(s.actionsIn.Video.length||s.actionsOut.Video.length)&&(this.hasVideoAction=!0))}catch(_I){}})),Object.values(this.eventsPerConditions).forEach((t=>t.forEach((t=>t.connect()))))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach((t=>t.forEach((t=>t.disconnect()))))}},d0=new mm,p0=new mm,f0=new mm,m0=new wv,g0=new mm,v0=new mm,y0=new mm,b0=new fm,x0=new eg,w0=new Wm,S0=new Vf,A0=new mm,E0=new mm,_0=.2;function C0(t,e){!e||(e[0]<e[1]&&(t.x=Math.min(Math.max(t.x,e[0]),e[1])),e[2]<e[3]&&(t.y=Math.min(Math.max(t.y,e[2]),e[3])),e[4]<e[5]&&(t.z=Math.min(Math.max(t.z,e[4]),e[5])))}var M0=function(){let t=new Wm;return(e,i,n)=>{let r=e.obj;t.copy(r.hiddenMatrix),null!==r.parent&&t.premultiply(r.parent.matrixWorld),t.invert(),r.position.copy(i),"global"===e.reference&&C0(r.position,e.limits),r.position.applyMatrix4(t),"parent"===e.reference?C0(r.position,e.limits):"local"===e.reference&&(b0.copy(e.quat0).invert(),r.position.sub(e.position0),r.position.applyQuaternion(b0),C0(r.position,e.limits),b0.invert(),r.position.applyQuaternion(b0),r.position.add(e.position0)),t.multiply(n??r.matrixWorld).decompose(g0,r.quaternion,v0),r.updateMatrix(),r.hasNonUniformScale&&(r.updateMatrixWorld(),r.updateMatrixWorldSVD()),r instanceof CU&&BW(r.parent)&&r.invalidateDownstreamBooleanData(!0)}}(),P0=class{constructor(t,e,i,n,r,s,a){this.object=t,this.id=e,this.data=i,this.dropDestIds=[],this.activeIdx=null,this.wasDragEventTriggered=!1,this.resetDampingFactor=0===this.data.resetSpeed?1:8/this.data.resetSpeed+1,this.snapDampingFactor=0===this.data.snapSpeed?1:8/this.data.snapSpeed+1,this.actionsDrag=JJ(i,i.dragDropActions.drag,n,r,s,this.object),this.actionsDrop=JJ(i,i.dragDropActions.drop,n,r,s,this.object);let o=[];this.data.objects.forEach((t=>{let e=n.find(t);!e||!1!==e.data.visible&&(o.push(e),a[e.uuid]&&a[e.uuid].forEach((t=>{let e=n.find(t);!e||!1!==e.data.visible&&o.push(e)})))})),this.data.dropDestinations.forEach((t=>{let e=n.find(t);!e||!1!==e.data.visible&&(this.dropDestIds.push(e.uuid),a[e.uuid]&&a[e.uuid].forEach((t=>{let e=n.find(t);!e||!1!==e.data.visible&&this.dropDestIds.push(e.uuid)})))})),this.dragItems=o.map((t=>("locked"===this.data.planeMode&&(t.userData.lockedPlane=!0),t.userData.worldPosition0=(new mm).setFromMatrixPosition(t.matrixWorld),{obj:t,fromPosition:(new mm).setFromMatrixPosition(t.matrixWorld),pointStart:new mm,pointEnd:new mm,paused:!0,currentDampingFactor:this.data.dampingFactor,reset:!1,position0:(new mm).copy(t.position),quat0:(new fm).copy(t.quaternion),snapped:!1,orientationMatrix:new Wm,limits:this.data.limits,reference:this.data.referenceFrame})))}get activeDragItem(){return null!==this.activeIdx?this.dragItems[this.activeIdx]:null}dispose(){$J(this.actionsDrag),$J(this.actionsDrop),this.dragItems.forEach((t=>{t.fromPosition.copy(t.obj.userData.worldPosition0),t.pointStart.copy(t.fromPosition),t.pointEnd.copy(t.pointStart),t.obj.recursiveBBoxNeedsUpdate=!0,t.obj.userData.lockedPlane=void 0,t.obj.position.copy(t.position0),t.obj.quaternion.copy(t.quat0),t.obj.updateMatrix()}))}},T0=class extends J${constructor(t,e){super(t),this.eventManager=e,this.events=[],this.lastDropDestination=null,this.dragTimeout=null,this.onPointerDown=t=>{if(gT.length>1)return;this.eventContext.updateRaycaster(t);let{raycaster:e,page:i}=this.eventContext,n=i.raycastWithClones(e);if(this.lastDropDestination=null,0!==n.length){for(let t of this.events){let e=0;for(let{obj:i,pointEnd:r,pointStart:s}of t.dragItems){if(i===n[0].object||i===n[0].object.object||IB.is(i)&&i.isAncestorOf(n[0].object.uuid)){if(t.activeIdx=e,t.activeDragItem.reset=!1,t.activeDragItem.currentDampingFactor=t.data.dampingFactor,t.activeDragItem.snapped=!1,"hand"===t.data.cursor&&this.setCursor("grabbing"),this.eventManager.controlsManager.usePhysics){t.activeDragItem.obj.rigidBody&&t.activeDragItem.obj.rigidBody.setBodyType(2,!0);let e=t.activeDragItem.obj;i.hasNonUniformScale&&i.updateMatrixWorldSVD(),(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(g0,b0,v0),x0.setFromQuaternion(b0),void 0===e.prevR?(e.prevR=x0.clone(),e.prevT=g0.clone()):(e.prevR.copy(x0),e.prevT.copy(g0)),this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(t.activeDragItem.obj)}return this.calcPlaneIntersectPos(i,s,t.data.plane,t.data.referenceFrame),r.copy(s),(this.eventManager.controlsManager.usePhysics&&"dynamic"===i.data.physics?.rigidBody||!1===t.data.drop||!1===t.data.resetOnSnapFail)&&t.activeDragItem.fromPosition.setFromMatrixPosition(t.activeDragItem.obj.matrixWorld),this.activeEvent=t,void(this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1))}e++}}this.activeEvent=null}else this.activeEvent=null},this.onPointerMove=t=>{if(gT.length>1)return;this.eventContext.updateRaycaster(t);let{raycaster:e,page:i}=this.eventContext,n=i.raycastWithClones(e);if(0!==gT.length){if(this.activeEvent&&this.activeEvent.activeDragItem){let t,e=this.activeEvent.activeDragItem;if(e.snapped=!1,this.activeEvent.data.drop&&(t=n.filter((t=>e.obj!==t.object&&!e.obj.isAncestorOf(t.object.uuid)&&!(t.object instanceof GW)&&("all"===this.activeEvent.data.dropOn||this.activeEvent.dropDestIds.some((e=>e===t.object.uuid||i.scene.find(e).isAncestorOf(t.object.uuid))))))[0]),t){let i=y0.copy(t.face.normal).applyMatrix3(S0.getNormalMatrix(t.object.matrixWorld));if("center"===this.activeEvent.data.snapTo)e.fromPosition.setFromMatrixPosition(t.object.matrixWorld);else if("surface"===this.activeEvent.data.snapTo){if(e.fromPosition.copy(t.point),"bbox"===this.activeEvent.data.snapSurfaceMode){g0.copy(i).applyMatrix3(S0.setFromMatrix4(e.obj.matrixWorld).transpose());let t=e.obj;g0.x>_0?v0.x=-t.recursiveBBox.min.x:g0.x<-_0&&(v0.x=-t.recursiveBBox.max.x),g0.y>_0?v0.y=-t.recursiveBBox.min.y:g0.y<-_0&&(v0.y=-t.recursiveBBox.max.y),g0.z>_0?v0.z=-t.recursiveBBox.min.z:g0.z<-_0&&(v0.z=-t.recursiveBBox.max.z),v0.applyMatrix3(S0.invert())}else v0.copy(i).multiplyScalar(this.activeEvent.data.snapSurfaceOffset);e.fromPosition.add(v0)}this.activeEvent.data.autoOrient&&(g0.set(0,1,0).cross(i),g0.length()<1e-4&&g0.set(-1,0,0).cross(i),v0.crossVectors(y0,g0),e.orientationMatrix.makeBasis(g0,v0,i)),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart),e.currentDampingFactor=this.activeEvent.snapDampingFactor,e.snapped=!0,this.lastDropDestination!==t.object&&(this.lastDropDestination=t.object,this.activeEvent.actionsDrop.Transition.forEach((t=>{t.play()})),this.activeEvent.actionsDrop.Animation.forEach((t=>{t.play()})),this.activeEvent.actionsDrop.Audio.forEach((t=>{t.dispatchGameControl("start")})),this.activeEvent.actionsDrop.Particles.forEach((t=>{t.dispatchGameControl("start")})),this.activeEvent.actionsDrop.Create.forEach((t=>{t.dispatchThrottled()})))}else e.orientationMatrix.makeRotationFromQuaternion(e.quat0),this.lastDropDestination=null,e.currentDampingFactor=this.activeEvent.data.dampingFactor,this.calcPlaneIntersectPos(e.obj,e.pointEnd,this.activeEvent.data.plane,this.activeEvent.data.referenceFrame),this.activeEvent.actionsDrop.Transition.forEach((t=>{t.stop(),null!==t.object.currentState&&t.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})})),this.activeEvent.actionsDrop.Animation.forEach((t=>{t.stop()})),this.activeEvent.actionsDrop.Audio.forEach((t=>{t.dispatchGameControl("stop")})),this.activeEvent.actionsDrop.Particles.forEach((t=>{t.dispatchGameControl("stop")}));this.activeEvent.actionsDrag.Create.forEach((t=>{t.dispatchThrottled()})),this.activeEvent.actionsDrag.SetVariable.forEach((t=>t.checkConditions())),this.activeEvent.actionsDrag.SetVariable.forEach((t=>t.dispatch())),this.activeEvent.actionsDrag.DynamicVariablePlay.forEach((t=>t.dispatch())),this.activeEvent.actionsDrag.ClearLocalStorage.forEach((t=>t.dispatch())),this.activeEvent.actionsDrag.UserAPI.forEach((t=>t.dispatch())),!1===this.activeEvent.wasDragEventTriggered&&(this.activeEvent.wasDragEventTriggered=!0,this.activeEvent.actionsDrag.Transition.forEach((t=>{t.play()})),this.activeEvent.actionsDrag.Animation.forEach((t=>{t.play()})),this.activeEvent.actionsDrag.Audio.forEach((t=>{t.dispatchGameControl("start")})),this.activeEvent.actionsDrag.Particles.forEach((t=>{t.dispatchGameControl("start")}))),this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout((()=>{!this.activeEvent||(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Audio.forEach((t=>{t.dispatchGameControl("stop")})),this.activeEvent.actionsDrag.Particles.forEach((t=>{t.dispatchGameControl("stop")})),this.activeEvent.actionsDrag.Transition.forEach((t=>{t.stop(),null!==t.object.currentState&&t.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})})),this.activeEvent.actionsDrag.Animation.forEach((t=>{t.stop()})))}),500),this.updateDragItem(e),e.obj.dispatchEvent({type:"requestRender"})}}else{let t=!1;for(let e of this.events){for(let{obj:i}of e.dragItems)if(i===n[0]?.object||i===n[0]?.object?.object||IB.is(i)&&i.isAncestorOf(n[0]?.object.uuid)){switch(t=!0,e.data.cursor){case"hand":this.setCursor("grab");break;case"move":this.setCursor("move")}break}if(t)break}t||this.setCursor("default")}},this.onPointerUp=t=>{if(this.activeEvent&&this.activeEvent.activeDragItem){"hand"===this.activeEvent.data.cursor&&this.setCursor("grab");let t="dynamic"===this.activeEvent.activeDragItem.obj.data.physics?.rigidBody;!1===this.activeEvent.activeDragItem.snapped&&this.activeEvent.data.drop&&this.activeEvent.data.resetOnSnapFail&&(!1===this.eventManager.controlsManager.usePhysics||!t)&&(this.activeEvent.activeDragItem.reset=this.activeEvent.data.resetOnSnapFail,this.activeEvent.activeDragItem.paused=!1,this.activeEvent.activeDragItem.currentDampingFactor=this.activeEvent.resetDampingFactor),this.eventManager.controlsManager.usePhysics&&t&&(this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(),this.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0,!0),this.activeEvent.activeDragItem.paused=!0),!0===this.activeEvent.wasDragEventTriggered&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Transition.forEach((t=>{t.stop(),null!==t.object.currentState&&t.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})})),this.activeEvent.actionsDrag.Animation.forEach((t=>{t.stop()})),this.activeEvent.actionsDrag.Audio.forEach((t=>{t.dispatchGameControl("stop")})),this.activeEvent.actionsDrag.Particles.forEach((t=>{t.dispatchGameControl("stop")})),this.activeEvent.actionsDrop.SetVariable.forEach((t=>t.checkConditions())),this.activeEvent.actionsDrop.SetVariable.forEach((t=>t.dispatch())),this.activeEvent.actionsDrop.DynamicVariablePlay.forEach((t=>t.dispatch())),this.activeEvent.actionsDrop.ClearLocalStorage.forEach((t=>t.dispatch())),this.activeEvent.actionsDrop.UserAPI.forEach((t=>t.dispatch()))),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0)}}}connect(){let t={};if(this.eventContext.page.traverseEntity((e=>{e.component&&(t[e.component.uuid]?t[e.component.uuid].push(e.uuid):t[e.component.uuid]=[e.uuid])})),this.eventContext.page.traverseEntity((e=>{e.data?.events.filter((t=>"DragDrop"===t.data.type&&!t.data.disabled)).forEach((i=>{this.events.push(new P0(e,i.id,i.data,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager,t))}))})),!this.events.length)return;this.domEventsNeeded.clear(),this.domEventsNeeded.add("pointerdown");let e=this.eventContext.domElement;e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointermove",this.onPointerMove),e.addEventListener("pointerup",this.onPointerUp),this.domEventsNeeded.add("pointermove")}disconnect(){if(!this.events.length)return;this.domEventsNeeded.clear();let t=this.eventContext.domElement;t.removeEventListener("pointerdown",this.onPointerDown),t.removeEventListener("pointermove",this.onPointerMove),t.removeEventListener("pointerup",this.onPointerUp),this.events.forEach((t=>t.dispose()))}setCursor(t){this.eventContext.domElement.style.cursor=t}onAnimationFrameDamping(){for(let t of this.events)for(let e of t.dragItems)e.paused||this.updateDragItem(e,!0)}calcPlaneIntersectPos(t,e,i,n){let{getCamera:r,raycaster:s}=this.eventContext;r().getWorldDirection(p0),p0.negate();let a=b0.identity();switch("parent"===n?w0.multiplyMatrices(t.parent.matrixWorld,t.hiddenMatrix).decompose(g0,a,v0):"local"===n&&t.matrixWorld.decompose(g0,a,v0),i){case"x":g0.set(1,0,0).applyQuaternion(a),A0.copy(p0).cross(g0),E0.copy(g0).cross(A0);break;case"y":g0.set(0,1,0).applyQuaternion(a),A0.copy(p0).cross(g0),E0.copy(g0).cross(A0);break;case"z":g0.set(0,0,1).applyQuaternion(a),A0.copy(p0).cross(g0),E0.copy(g0).cross(A0);break;case"xy":E0.set(0,0,1).applyQuaternion(a);break;case"yz":E0.set(1,0,0).applyQuaternion(a);break;case"xz":E0.set(0,1,0).applyQuaternion(a);break;case"adaptive":p0.angleTo(v0.set(0,1,0))>Math.PI/6?(g0.crossVectors(v0.set(0,1,0),p0),E0.crossVectors(g0,v0)):E0.set(0,1,0);break;default:E0.copy(p0)}f0.setFromMatrixPosition(t.matrixWorld);let o=t.userData.lockedPlane?t.userData.worldPosition0:f0;if(m0.setFromNormalAndCoplanarPoint(E0,o),s.ray.intersectPlane(m0,e)&&("x"===i||"y"===i||"z"===i)){let t=v0.subVectors(e,o).dot(g0);e.copy(o).addScaledVector(g0,t)}}updateDragItem(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];f0.setFromMatrixPosition(t.obj.matrixWorld),"current"===t.reset?d0.subVectors(t.fromPosition,f0).divideScalar(t.currentDampingFactor):"original"===t.reset?(d0.subVectors(t.obj.userData.worldPosition0,f0).divideScalar(t.currentDampingFactor),t.fromPosition.copy(t.obj.userData.worldPosition0),t.pointStart.copy(t.fromPosition),t.pointEnd.copy(t.pointStart)):d0.subVectors(t.pointEnd,t.pointStart).add(t.fromPosition).sub(f0).divideScalar(t.currentDampingFactor),t.paused=!(t.currentDampingFactor>1)||d0.length()<.01,(this.activeEvent&&1===this.activeEvent.data.dampingFactor||e)&&M0(t,d0.add(f0),this.activeEvent?.data.drop&&this.activeEvent?.data.autoOrient?t.orientationMatrix:null),t.obj.dispatchEvent({type:"beginEvent",eventName:"DragDrop"}),this.eventManager.requestRender()}},D0=new mm,k0=new mm,I0=new mm,R0=new mm,O0=new wv,L0={type:"requestRender"},B0=function(){let t=new mm,e=new mm;return(i,n,r)=>r>0?(t.subVectors(i,n),t.length()<=r?i:e.copy(n).add(t.normalize().multiplyScalar(r))):n}(),z0=function(){let t=new Wm;return(e,i)=>{e.position.copy(i),null!==e.parent&&(t.copy(e.parent.matrixWorld).invert(),e.position.applyMatrix4(t)),t.copy(e.hiddenMatrix).invert(),e.position.applyMatrix4(t),e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD()),e instanceof CU&&BW(e.parent)&&e.invalidateDownstreamBooleanData(!0)}}(),F0=class{constructor(t,e,i,n,r,s){this.data=t,this.id=e,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.snapComplete=!1,this.isReset=!1,this.worldPosition0=new mm,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...lI.defaultData,...t,...void 0===t.resetOnPointerLeave&&{resetOnPointerLeave:!1}},void 0===t.target||"cursor"===t.target||(this.target=n.find(t.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.resetDampingFactor=80/this.data.resetSpeed+1,this.object.getWorldPosition(this.worldPosition0),this.actions=JJ(t,t.actions,n,r,s,i)}},N0=class extends J${constructor(t,e){super(t),this.eventManager=e,this.events=[],this.pairOfEventListeners=[],this.onMouseMove=t=>{if(!(gT.length>1)){this.eventContext.updateRaycaster(t);for(let t of this.events)void 0===t.target&&this.updateSingleEvent(t)}},this.onMouseEnter=t=>{for(let e of this.events)void 0===e.target&&(e.isReset=!1,e.currentDampingFactor=e.data.dampingFactor)},this.onMouseLeave=t=>{for(let e of this.events)void 0===e.target&&(e.data.resetOnPointerLeave&&(e.isReset=!0,e.currentDampingFactor=e.resetDampingFactor),this.updateSingleEvent(e))},this.onTargetChange=t=>()=>{this.updateSingleEvent(t)}}connect(){let{page:t}=this.eventContext;if(t.traverseEntity((e=>{let i=e.data?.events.find((t=>"Follow"===t.data.type&&!t.data.disabled));i&&(!t.data.globalPhysics.usePhysics||"dynamic"!==e.dataPatched.physics?.rigidBody)&&this.events.push(new F0(i.data,i.id,e,t,this.eventContext.sharedAssets,this.eventManager))})),!this.events.length)return;let{domElement:e,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),cT&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents||(e.addEventListener("pointerenter",this.onMouseEnter),e.addEventListener("pointerleave",this.onMouseLeave));for(let n of this.events)if(void 0!==n.target){let t=n.target,e=this.onTargetChange(n);this.pairOfEventListeners.push([t,e]),t.addEventListener("requestRender",e)}}disconnect(){if(!this.events.length)return;let{domElement:t,eventElement:e}=this.eventContext;this.domEventsNeeded.clear(),cT&&t.removeEventListener("pointerdown",this.onMouseMove),e.removeEventListener("pointermove",this.onMouseMove),t.removeEventListener("pointerenter",this.onMouseEnter),t.removeEventListener("pointerleave",this.onMouseLeave);for(let[i,n]of this.pairOfEventListeners)i.removeEventListener("requestRender",n);for(let i of this.events)i.paused=!0,i.isReset=!1,$J(i.actions)}onAnimationFrameDamping(){for(let t of this.events)t.paused||this.updateSingleEvent(t,!0)}updateSingleEvent(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.events.forEach((t=>{t.actions.Create.forEach((t=>{t.dispatchThrottled()}))}));let{plane:i,limitDistance:n,limitDistanceEnabled:r}=t.data;if(t.object.getWorldPosition(I0),t.isReset)R0.copy(t.worldPosition0);else if(t.target)t.target.getWorldPosition(R0);else{let{getCamera:t,raycaster:e}=this.eventContext;if("custom"===i?(t().getWorldDirection(k0),k0.negate(),D0.copy(k0)):"xy"===i?D0.set(0,0,1):"xz"===i?D0.set(0,1,0):"yz"===i&&D0.set(1,0,0),O0.setFromNormalAndCoplanarPoint(D0,I0),!e.ray.intersectPlane(O0,R0))return}if(!t.isReset)if(R0.distanceTo(t.worldPosition0)>n&&r&&t.target){if(t.snapComplete=!1,t.data.snapDelay&&(t.delayFinished=!1,typeof window<"u"&&null!==t.timeoutId&&(window.clearTimeout(t.timeoutId),t.timeoutId=null)),t.wasOutside=!0,!t.data.resetAfterDistanceLimit)return;R0.copy(t.worldPosition0),t.currentDampingFactor=t.resetDampingFactor}else if(t.wasOutside&&(t.data.snapDelay&&typeof window<"u"&&(t.timeoutId=window.setTimeout((()=>{t.delayFinished=!0,t.paused=!1,this.updateSingleEvent(t)}),1e3*t.data.snapDelay)),t.currentDampingFactor=t.data.dampingFactor,t.wasOutside=!1),!1===t.delayFinished)return;!1===t.data.enabledTranslation[0]&&(R0.x=I0.x),!1===t.data.enabledTranslation[1]&&(R0.y=I0.y),!1===t.data.enabledTranslation[2]&&(R0.z=I0.z);let s=B0(I0,R0,t.wasOutside?0:t.data.maxDelta);if(t.currentDampingFactor>1){let i=D0.subVectors(s,I0).divideScalar(t.currentDampingFactor);I0.add(i),e&&z0(t.object,I0),t.paused=i.length()<.01}else z0(t.object,s),t.paused=!0;t.object?.dispatchEvent({type:"beginEvent",eventName:"Follow"}),t.object.dispatchEvent(L0)}},U0=new mm,V0=new mm,j0=new Wm,G0=new fm,H0=new fm,W0=new mm,q0=new mm,Y0=new mm,X0=new mm,Q0=new wv,K0={type:"requestRender"},Z0={type:"changeRotation"},J0=function(){let t=new Wm;return function(e,i){null!==e.parent?t.multiplyMatrices(e.parent.matrixWorld,e.hiddenMatrix):t.copy(e.hiddenMatrix),i.premultiply(V$(t).invert()),e.rotation.setFromRotationMatrix(i),e.updateMatrix(),e instanceof CU&&BW(e.parent)&&e.invalidateDownstreamBooleanData(!0)}}(),$0=class{constructor(t,e,i,n){this.id=e,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.isReset=!1,this.worldQuaternion0=new fm,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...hI.defaultData,...t,...void 0===t.resetOnPointerLeave&&{resetOnPointerLeave:!1}},void 0===t.target||"cursor"===t.target||(this.target=n.find(t.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.object.getWorldQuaternion(this.worldQuaternion0),this.resetDampingFactor=80/this.data.resetSpeed+1}},t1=class extends J${constructor(){super(...arguments),this.events=[],this.pairOfEventListeners=[],this.pairOfUserEventListeners=[],this.onMouseMove=t=>{if(!(gT.length>1)){this._lastMouseEvent=t,this.eventContext.updateRaycaster(t);for(let t of this.events)void 0===t.target&&this.updateSingleEvent(t)}},this.onMouseEnter=t=>{for(let e of this.events)void 0===e.target&&(e.isReset=!1,e.currentDampingFactor=e.data.dampingFactor)},this.onMouseLeave=t=>{for(let e of this.events)void 0===e.target&&(e.data.resetOnPointerLeave&&(e.isReset=!0,e.currentDampingFactor=e.resetDampingFactor),this.updateSingleEvent(e))},this.onScroll=t=>{if(this._lastMouseEvent){let t=new PointerEvent("pointermove",{clientX:this._lastMouseEvent.clientX,clientY:this._lastMouseEvent.clientY,bubbles:!0,cancelable:!0,view:window});this.eventContext.eventElement.dispatchEvent(t)}},this.onTargetChange=t=>()=>{this.updateSingleEvent(t)},this.createUserEventListener=t=>e=>{let{eventName:i,target:n}=e;if(!i||!n)return;let r=e0(i);r&&"LookAt"===r&&this.updateSingleEvent(t)}}connect(){let{page:t}=this.eventContext;if(t.traverseEntity((e=>{let i=e.data?.events.find((t=>"LookAt"===t.data.type&&!t.data.disabled));i&&(!t.data.globalPhysics.usePhysics||"dynamic"!==e.dataPatched.physics?.rigidBody)&&this.events.push(new $0(i.data,i.id,e,t))})),!this.events.length)return;let{domElement:e,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),cT&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents?i.addEventListener("scroll",this.onScroll):(e.addEventListener("pointerenter",this.onMouseEnter),e.addEventListener("pointerleave",this.onMouseLeave));for(let n of this.events){if(void 0!==n.target){let t=this.onTargetChange(n),e=n.target;this.pairOfEventListeners.push([e,t]),e.addEventListener("requestRender",t)}let t=this.createUserEventListener(n),e=n.object;this.pairOfUserEventListeners.push([e,t]),e.addEventListener("userEvent",t)}}disconnect(){if(!this.events.length)return;let{domElement:t,eventElement:e}=this.eventContext;this.domEventsNeeded.clear(),cT&&t.removeEventListener("pointerdown",this.onMouseMove),e.removeEventListener("pointermove",this.onMouseMove),t.removeEventListener("pointerenter",this.onMouseEnter),t.removeEventListener("pointerleave",this.onMouseLeave),e.removeEventListener("scroll",this.onScroll);for(let[i,n]of this.pairOfEventListeners)i.removeEventListener("requestRender",n);for(let[i,n]of this.pairOfUserEventListeners)i.removeEventListener("userEvent",n);for(let i of this.events)i.paused=!0,i.isReset=!1}onAnimationFrameDamping(){for(let t of this.events)t.paused||this.updateSingleEvent(t)}updateSingleEvent(t){let{tilt:e,axis:i,distance:n,plane:r,limitDistance:s,enabledRotation:a,limitDistanceEnabled:o}=t.data,{getCamera:l,raycaster:h}=this.eventContext,{object:c,target:u}=t;if(c.getWorldPosition(W0),!t.isReset)if(t.target)t.target.getWorldPosition(q0);else{if("custom"===r?(l().getWorldDirection(V0),V0.negate(),Q0.setFromNormalAndCoplanarPoint(V0,W0)):("xy"===r?U0.set(0,0,1):"xz"===r?U0.set(0,1,0):"yz"===r&&U0.set(1,0,0),Q0.setFromNormalAndCoplanarPoint(U0,W0)),!h.ray.intersectPlane(Q0,q0))return;n>0&&("custom"===r||void 0===r)&&q0.addScaledVector(V0,n)}if(t.isReset||(u?"target"===e?Y0.copy(u.up).applyMatrix4(j0.extractRotation(u.matrixWorld)).normalize():a.some((t=>!1===t))?("x"===i?(X0.set(0,0,1),!1===a[2]&&X0.set(0,1,0)):"y"===i?(X0.set(1,0,0),!1===a[0]&&X0.set(0,0,1)):(X0.set(0,1,0),!1===a[1]&&X0.set(1,0,0)),Y0.copy(X0).applyQuaternion(t.worldQuaternion0).normalize()):Y0.set(0,1,0):"custom"===r?Y0.set(0,1,0):Y0.copy(U0)),t.isReset)H0.copy(t.worldQuaternion0);else if(W0.distanceTo(q0)>s&&o&&u){if(t.data.snapDelay&&(t.delayFinished=!1,typeof window<"u"&&null!==t.timeoutId&&(window.clearTimeout(t.timeoutId),t.timeoutId=null)),t.wasOutside=!0,!t.data.resetAfterDistanceLimit)return;H0.copy(t.worldQuaternion0),t.currentDampingFactor=t.resetDampingFactor}else{if(t.wasOutside&&(t.data.snapDelay&&typeof window<"u"&&(t.timeoutId=window.setTimeout((()=>{t.delayFinished=!0,t.paused=!1,this.updateSingleEvent(t)}),1e3*t.data.snapDelay)),t.currentDampingFactor=t.data.dampingFactor,t.wasOutside=!1),!1===t.delayFinished)return;(function(t,e,i,n,r,s){let a=t.elements;n1.subVectors(e,i),0===n1.lengthSq()&&(n1.z=1),n1.normalize(),i1.crossVectors(n,n1),0===i1.lengthSq()&&(1===Math.abs(n.z)?n1.x+=1e-4:n1.z+=1e-4,n1.normalize(),i1.crossVectors(n,n1)),i1.normalize(),e1.crossVectors(n1,i1),"x"===r?1===s.z?[i1,e1,n1]=[n1,i1,e1]:(i1.negate(),[i1,n1]=[n1,i1]):"y"===r?1===s.x?[i1,e1,n1]=[e1,n1,i1]:(i1.negate(),[e1,n1]=[n1,e1]):1===s.x&&(i1.negate(),[i1,e1]=[e1,i1]),a[0]=i1.x,a[4]=e1.x,a[8]=n1.x,a[1]=i1.y,a[5]=e1.y,a[9]=n1.y,a[2]=i1.z,a[6]=e1.z,a[10]=n1.z})(j0,q0,W0,Y0,i,X0),H0.setFromRotationMatrix(j0),G0.setFromUnitVectors(X0.applyQuaternion(H0),Y0),a.some((t=>!1===t))&&"target"!==e&&H0.premultiply(G0).normalize()}t.currentDampingFactor>1?(c.updateWorldMatrix(!0,!1),G0.setFromRotationMatrix(V$(c.matrixWorld)),G0.slerp(H0,1/t.currentDampingFactor),J0(c,j0.makeRotationFromQuaternion(G0)),t.paused=8*(1-G0.dot(H0))<1e-6):(J0(c,j0.makeRotationFromQuaternion(H0)),t.paused=!0),t.object?.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),c.dispatchEvent(K0),c.dispatchEvent(Z0)}},e1=new mm,i1=new mm,n1=new mm;var r1=class{constructor(t,e,i,n,r,s){this.id=t,this.data=e,this.object=i,this.entered=!1,this.actions=JJ(e,e.actions,n,r,s,i)}disconnect(){$J(this.actions)}dispatchEnter(){this.actions.Transition.forEach((t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())})),this.entered||(this.entered=!0,this.actions.Transition.forEach((t=>t.playFromCurrent())),this.actions.Animation.forEach((t=>t.play())),this.actions.Create.forEach((t=>t.dispatchStart())),this.actions.Particles.forEach((t=>t.dispatchBasic())),this.actions.Destroy.forEach((t=>t.dispatch())),this.actions.SwitchCamera.forEach((t=>t.playFromCurrent())),this.actions.SceneTransition.forEach((t=>t.dispatch())),this.actions.SetVariable.forEach((t=>t.checkConditions())),this.actions.SetVariable.forEach((t=>t.dispatch())),this.actions.DynamicVariablePlay.forEach((t=>t.dispatch())),this.actions.ClearLocalStorage.forEach((t=>t.dispatch())),this.actions.UserAPI.forEach((t=>t.dispatch())))}dispatchLeave(){this.actions.Transition.forEach((t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())})),this.entered&&(this.entered=!1,this.actions.Create.forEach((t=>t.dispatchStop())),this.actions.Transition.forEach((t=>t.reverseFromCurrent())),this.actions.Particles.forEach((t=>t.reverseFromCurrent())),this.actions.SwitchCamera.forEach((t=>t.reverseFromCurrent())))}dispatchUserEvent(t){this.actions.Transition.forEach((t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())})),t?(this.actions.Transition.forEach((t=>t.reverseFromCurrent())),this.actions.Particles.forEach((t=>t.reverseFromCurrent())),this.actions.Animation.forEach((t=>t.reverseFromCurrent())),this.actions.SwitchCamera.forEach((t=>t.reverseFromCurrent()))):(this.actions.Transition.forEach((t=>t.playFromCurrent())),this.actions.Animation.forEach((t=>t.playFromCurrent())),this.actions.Create.forEach((t=>t.dispatch())),this.actions.Particles.forEach((t=>t.dispatchBasic())),this.actions.Destroy.forEach((t=>t.dispatch())),this.actions.SwitchCamera.forEach((t=>t.playFromCurrent()))),this.actions.SceneTransition.forEach((t=>t.dispatch())),this.actions.SetVariable.forEach((t=>t.checkConditions())),this.actions.SetVariable.forEach((t=>t.dispatch())),this.actions.DynamicVariablePlay.forEach((t=>t.dispatch())),this.actions.ClearLocalStorage.forEach((t=>t.dispatch())),this.actions.UserAPI.forEach((t=>t.dispatch()))}},s1=class extends J${constructor(t,e){super(t),this.eventManager=e,this.eventsPerObjects={},this.objects=[],this.objects2D=[],this._prevObjects=[],this.onMouseDown=t=>{gT.length>1||(this.eventContext.updateRaycaster(t),this.handleMouseHoverEvent())},this.onMouseUp=t=>{gT.length>1||this.handleMouseHoverEvent(!0)},this.onMouseMove=t=>{gT.length>1||(this.eventContext.updateRaycaster(t),this.handleMouseHoverEvent())},this.onUserEvent=t=>{let{eventName:e,target:i,reverse:n}=t;if(!e||!i)return;let r=e0(e);r&&"MouseHover"===r&&(i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[i.uuid]?.forEach((t=>t.dispatchUserEvent(n))))}}connect(){let{page:t,sharedAssets:e}=this.eventContext,i=(i,n)=>{if(i.visible&&i.data?.events.length){for(let{id:n,data:s}of i.data.events)if(!s.disabled&&"MouseHover"===s.type)try{let r=new r1(n,s,i,t,e,this.eventManager);this.eventsPerObjects[i.uuid]?this.eventsPerObjects[i.uuid].push(r):this.eventsPerObjects[i.uuid]=[r]}catch(r){}this.eventsPerObjects[i.uuid]?.length&&this.objects.push(i instanceof sX?n:i)}};if(t.traverseEntity((t=>{(t instanceof cQ||t instanceof tQ)&&t.frame?.traverse((e=>{i(e,t)})),i(t)})),!this.objects.length)return;let{domElement:n}=this.eventContext;this.domEventsNeeded.clear(),cT&&(this.domEventsNeeded.add("pointerdown"),n.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),n.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),n.addEventListener("pointermove",this.onMouseMove),this.objects.forEach((t=>{t.addEventListener("userEvent",this.onUserEvent)}))}disconnect(){if(!this.objects.length)return;let{domElement:t}=this.eventContext;this.domEventsNeeded.clear(),cT&&(t.removeEventListener("pointerdown",this.onMouseDown),t.removeEventListener("pointerup",this.onMouseUp)),t.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach((t=>{t.forEach((t=>{t.disconnect()}))})),this.objects.forEach((t=>{t.removeEventListener("userEvent",this.onUserEvent)}))}handleMouseHoverEvent(){let t=[];if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){let{stopRaycast:e,raycaster:i,page:n,pointerScreen:r}=this.eventContext,s=!1;if(n.uiCanvas&&(s=X$(n,[r.x,r.y],Object.keys(this.eventsPerObjects),(e=>{t.push(e)}))),e&&!s){let e=q$(i,n,this.objects);t=Y$(e),e.forEach((e=>{e.object instanceof cQ&&X$(e.object,[e?.uv?.x??0,e?.uv?.y??0],Object.keys(this.eventsPerObjects),(e=>{t.push(e)}))}))}else this.objects.forEach((e=>{let n=Q$(i,e);n&&(t.push(e),e instanceof cQ&&X$(e,[n?.uv?.x??0,n?.uv?.y??0],Object.keys(this.eventsPerObjects),(e=>{t.push(e)})))}))}this._prevObjects.length&&this._prevObjects.forEach((e=>{t.includes(e)||(e.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[e.uuid]?.forEach((t=>t.dispatchLeave())))})),t.length&&t.forEach((t=>{t.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[t.uuid]?.forEach((t=>t.dispatchEnter()))})),this._prevObjects=t}},a1=class{constructor(t,e,i,n,r,s){this.id=t,this.data=e,this.object=i,this.scrollCounter=0,this.actions=JJ(e,e.actions,n,r,s,i)}connect(){this.scrollCounter=0}disconnect(){$J(this.actions)}dispatch(t){this.actions.Transition.forEach((t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}));let e=t>0?1:-1;this.scrollCounter+=e,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let i=this.scrollCounter/this.data.steps;this.actions.Transition.forEach((t=>t.seek(i))),this.actions.Animation.forEach((t=>t.seek(e))),this.actions.Create.forEach((t=>t.dispatchThrottled())),this.actions.SetVariable.forEach((t=>t.checkConditions())),this.actions.SetVariable.forEach((t=>t.dispatch())),this.actions.DynamicVariablePlay.forEach((t=>t.dispatch())),this.actions.ClearLocalStorage.forEach((t=>t.dispatch())),this.actions.UserAPI.forEach((t=>t.dispatch()))}dispatchUserEvent(t){this.actions.Transition.forEach((t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())})),t?(this.actions.Transition.forEach((t=>t.reverseFromCurrent())),this.actions.Animation.forEach((t=>t.reverseFromCurrent()))):(this.actions.Transition.forEach((t=>{t.playFromCurrent()})),this.actions.Animation.forEach((t=>{t.playFromCurrent()}))),this.actions.Create.forEach((t=>t.dispatchThrottled())),this.actions.SetVariable.forEach((t=>t.checkConditions())),this.actions.SetVariable.forEach((t=>t.dispatch())),this.actions.DynamicVariablePlay.forEach((t=>t.dispatch())),this.actions.ClearLocalStorage.forEach((t=>t.dispatch())),this.actions.UserAPI.forEach((t=>t.dispatch()))}},o1=class{constructor(t,e,i,n,r,s,a){this.id=t,this.data=e,this.object=i,this.domElement=s,this.eventManager=a,this.scrollStart=0,this.scrollEnd=0,this.actions=JJ(e,e.actions,n,r,a,i)}getStickyParentElement(){let t=this.domElement;for(;t;){if("sticky"===window.getComputedStyle(t).position)return t;t=t.parentElement}return null}computeScrollBounds(){let t=this.getStickyParentElement(),e=t?.parentElement,i=this.domElement.getBoundingClientRect(),n={top:i.top,bottom:i.bottom,left:i.left,right:i.right,width:i.width,height:i.height};if(e){let r=e.getBoundingClientRect(),s=window.getComputedStyle(t),a=parseFloat(s.marginTop)+parseFloat(s.marginBottom),o=parseFloat(s.top),l=parseFloat(s.bottom),h=r.height-a;if(isNaN(o)){if(!isNaN(l)){let t=document.body.clientHeight??window.innerHeight,e=window.innerWidth-(document.documentElement.clientWidth??window.innerWidth);i.bottom===t-l?(n.top+=r.top-i.height+l+e,n.bottom+=r.top-i.height+l+e):i.bottom<t-l&&(n.top-=h-i.height,n.bottom-=h-i.height)}}else i.top===o?(n.top+=r.top-o,n.bottom+=r.top-o):i.top<0&&(n.top-=h-i.height,n.bottom-=h-i.height)}let r=document.body,s=document.documentElement,a=window.pageYOffset||s.scrollTop||r.scrollTop,o=s.clientTop||r.clientTop||0,l=Math.round(n.top+a-o);if("enter"===this.data.startFrom){let t=window.innerHeight,e=n.height,i=this.data.enterAnchor,r="top"===i?t:"bottom"===i?t-e:t-.5*e;this.scrollStart=l-r}else this.scrollStart=0;this.scrollStart+=this.data.startOffset??0,this.scrollEnd=this.scrollStart+(this.data.endAfter??400),this.box=n,this.computeScroll({x:window.scrollX,y:window.scrollY})}connect(){this.computeScrollBounds()}disconnect(){$J(this.actions)}handleResize(){this.computeScrollBounds()}get isInvalidBox(){return void 0===this.box||0===this.box.width&&0===this.box.height&&0===this.box.top&&0===this.box.bottom}computeScroll(t){let{x:e,y:i}=t;this.actions.Transition.forEach((t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}));let n=this.scrollEnd-this.scrollStart,r=Math.min(1,Math.max(0,(i-this.scrollStart)/n));this.actions.Transition.forEach((t=>t.seek(r))),this.actions.Animation.forEach((t=>t.seek(r))),this.actions.Create.forEach((t=>t.dispatchThrottled())),this.actions.SetVariable.forEach((t=>t.checkConditions())),this.actions.SetVariable.forEach((t=>t.dispatch())),this.actions.DynamicVariablePlay.forEach((t=>t.dispatch())),this.actions.ClearLocalStorage.forEach((t=>t.dispatch())),this.actions.UserAPI.forEach((t=>t.dispatch()))}dispatch(t){this.isInvalidBox&&this.computeScrollBounds(),this.computeScroll(t)}dispatchUserEvent(t){this.actions.Transition.forEach((t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())})),t?(this.actions.Transition.forEach((t=>t.reverseFromCurrent())),this.actions.Animation.forEach((t=>t.reverseFromCurrent()))):(this.actions.Transition.forEach((t=>{t.playFromCurrent()})),this.actions.Animation.forEach((t=>{t.playFromCurrent()}))),this.actions.Create.forEach((t=>t.dispatchThrottled())),this.actions.SetVariable.forEach((t=>t.checkConditions())),this.actions.SetVariable.forEach((t=>t.dispatch())),this.actions.DynamicVariablePlay.forEach((t=>t.dispatch())),this.actions.ClearLocalStorage.forEach((t=>t.dispatch())),this.actions.UserAPI.forEach((t=>t.dispatch()))}},l1=class extends J${constructor(t,e){super(t),this.managers=e,this.wheelEventsPerObject=new Map,this.scrollEventsPerObject=new Map,this.isInview=!0,this.handleResize=()=>{[...this.scrollEventsPerObject.entries()].forEach((t=>{let[e,i]=t;i.forEach((t=>t.handleResize()))}))},this.onScroll=t=>{if(!this.isInview)return;let e={y:window.scrollY,x:window.scrollX};[...this.scrollEventsPerObject.entries()].forEach((t=>{let[i,n]=t;i.dispatchEvent({type:"beginEvent",eventName:"Scroll",scroll:e}),n.forEach((t=>t.dispatch(e)))}))},this.onWheel=t=>{!this.isInview||t.ctrlKey||[...this.wheelEventsPerObject.entries()].forEach((e=>{let[i,n]=e;i.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:t.deltaY}),n.forEach((e=>e.dispatch(t.deltaY)))}))},this.onUserEvent=t=>{let{eventName:e,target:i,reverse:n}=t;if(!e||!i)return;let r=e0(e);r&&"Scroll"===r&&(i.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),this.wheelEventsPerObject.get(i)?.forEach((t=>{t.dispatchUserEvent(n)})))}}connect(){let{page:t,sharedAssets:e,domElement:i,isExport:n}=this.eventContext,r=r=>{if(r.data?.events.length)for(let{id:s,data:a}of r.data.events)if(!a.disabled&&"Scroll"===a.type)if("load"!==a.trigger&&n){let n=new o1(s,a,r,t,e,i,this.managers);this.scrollEventsPerObject.has(r)?this.scrollEventsPerObject.get(r)?.push(n):this.scrollEventsPerObject.set(r,[n])}else{let i=new a1(s,a,r,t,e,this.managers);this.wheelEventsPerObject.has(r)?this.wheelEventsPerObject.get(r)?.push(i):this.wheelEventsPerObject.set(r,[i])}};t.traverseEntity((t=>{(t instanceof cQ||t instanceof tQ)&&t.frame?.traverse((t=>{r(t)})),r(t)})),this.intersectionObserver=new IntersectionObserver((t=>{let e=t[0];e&&(this.isInview=e.isIntersecting)}),{root:null}),this.intersectionObserver.observe(this.eventContext.domElement),[...this.wheelEventsPerObject.entries()].forEach((t=>{let[e,i]=t;i.forEach((t=>t.connect())),e.addEventListener("userEvent",this.onUserEvent)})),[...this.scrollEventsPerObject.entries()].forEach((t=>{let[e,i]=t;i.forEach((t=>t.connect())),e.addEventListener("userEvent",this.onUserEvent)})),[...this.wheelEventsPerObject.values()].some((t=>t.length))&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel)),[...this.scrollEventsPerObject.values()].some((t=>t.length))&&(this.domEventsNeeded.add("scroll"),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.handleResize))}disconnect(){window.removeEventListener("wheel",this.onWheel),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.handleResize),this.intersectionObserver.unobserve(this.eventContext.domElement),this.domEventsNeeded.clear(),[...this.wheelEventsPerObject.entries()].forEach((t=>{let[e,i]=t;i.forEach((t=>t.disconnect())),e.removeEventListener("userEvent",this.onUserEvent)})),[...this.scrollEventsPerObject.entries()].forEach((t=>{let[e,i]=t;i.forEach((t=>t.disconnect())),e.removeEventListener("userEvent",this.onUserEvent)}))}},h1=class{constructor(t,e,i,n,r,s){this.id=t,this.data=e,this.object=i,this.actions=JJ(e,e.actions,n,r,s,i)}disconnect(){$J(this.actions)}dispatch(){this.actions.Transition.forEach((t=>{t.play()})),this.actions.Animation.forEach((t=>{t.play()})),this.actions.SwitchCamera.forEach((t=>{t.play()})),this.actions.SceneTransition.forEach((t=>{t.dispatch()})),this.actions.Reset.forEach((t=>t.dispatch())),this.actions.SetVariable.forEach((t=>t.checkConditions())),this.actions.SetVariable.forEach((t=>t.dispatch())),this.actions.DynamicVariablePlay.forEach((t=>t.dispatch())),this.actions.ClearLocalStorage.forEach((t=>t.dispatch())),this.actions.UserAPI.forEach((t=>t.dispatch())),this.actions.Create.forEach((t=>{t.dispatchFromStart()})),this.actions.Destroy.forEach((t=>{t.dispatchFromStart()}))}dispatchAfter(t){this.actions.Audio.forEach((e=>{(e.interaction.data.triggerAfter??"any")===t&&(e.interaction instanceof GK?e.interaction.audioPlayer.play():e.interaction instanceof HK&&e.interaction.dispatch())})),this.actions.Video.forEach((e=>{let i=e.interaction.data.triggerAfter??"autoplay";i===t&&(e.interaction instanceof i$?e.interaction.play("autoplay"===i):e.interaction instanceof n$&&e.interaction.dispatch())})),this.actions.Particles.forEach((e=>{(e.data.triggerAfter??"any")===t&&e.dispatchBasic()}))}dispatchUserEvent(t){this.actions.Transition.forEach((t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())})),t?(this.actions.Transition.forEach((t=>t.reverseFromCurrent())),this.actions.Animation.forEach((t=>t.reverseFromCurrent())),this.actions.SwitchCamera.forEach((t=>t.reverseFromCurrent()))):(this.actions.Transition.forEach((t=>t.playFromCurrent())),this.actions.Animation.forEach((t=>t.playFromCurrent())),this.actions.SwitchCamera.forEach((t=>t.playFromCurrent()))),this.actions.SceneTransition.forEach((t=>t.dispatch())),this.actions.Reset.forEach((t=>t.dispatch())),this.actions.SetVariable.forEach((t=>t.checkConditions())),this.actions.SetVariable.forEach((t=>t.dispatch())),this.actions.DynamicVariablePlay.forEach((t=>t.dispatch())),this.actions.ClearLocalStorage.forEach((t=>t.dispatch())),this.actions.UserAPI.forEach((t=>t.dispatch())),this.actions.Create.forEach((t=>{t.dispatch()})),this.actions.Destroy.forEach((t=>{t.dispatch()})),this.actions.Audio.forEach((t=>{t.interaction instanceof GK?t.interaction.audioPlayer.play():t.interaction instanceof HK&&t.interaction.dispatch()})),this.actions.Video.forEach((t=>{t.interaction instanceof i$?t.interaction.play():t.interaction instanceof n$&&t.interaction.dispatch()})),this.actions.Particles.forEach((t=>{t.dispatchBasic()}))}},c1=class extends J${constructor(t,e){super(t),this.eventManager=e,this.eventsPerObject=new Map,this.eventsAfterPerObject=new Map,this.onMouseDown=()=>{[...this.eventsAfterPerObject.entries()].forEach((t=>{let[e,i]=t;e.dispatchEvent({type:"beginEvent",eventName:"Start"}),i.forEach((t=>{t.dispatchAfter("mouseDown")}))}))},this.onKeyDown=()=>{[...this.eventsAfterPerObject.entries()].forEach((t=>{let[e,i]=t;e.dispatchEvent({type:"beginEvent",eventName:"Start"}),i.forEach((t=>{t.dispatchAfter("keyDown")}))}))},this.onAny=()=>{let{domElement:t,isExport:e}=this.eventContext,i=e?document:t;i.removeEventListener("pointerdown",this.onAny),i.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach((t=>{let[e,i]=t;e.dispatchEvent({type:"beginEvent",eventName:"Start"}),i.forEach((t=>{t.dispatchAfter("any")}))}))},this.onSceneTransitionAudioVideoPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach((t=>{let[e,i]=t;e.dispatchEvent({type:"beginEvent",eventName:"Start"}),i.forEach((t=>{t.actions.Audio.forEach((t=>{t.interaction instanceof GK&&t.interaction.audioPlayer.play()})),t.actions.Video.forEach((t=>{let e=t.interaction.data.triggerAfter??"autoplay";t.interaction instanceof i$&&t.interaction.play("autoplay"===e)})),t.actions.Particles.forEach((t=>{t.dispatchBasic()}))}))}))},this.onPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach((t=>{let[e,i]=t;e.dispatchEvent({type:"beginEvent",eventName:"Start"}),i.forEach((t=>{t.dispatchAfter("autoplay")}))}))},this.onUserEvent=t=>{let{eventName:e,target:i,reverse:n}=t;if(!e||!i)return;let r=e0(e);r&&"Start"===r&&(i instanceof sX||i.dispatchEvent({type:"beginEvent",eventName:"Start"}),this.eventsPerObject.get(i)?.forEach((t=>{t.dispatchUserEvent(n)})),this.eventsAfterPerObject.get(i)?.forEach((t=>{t.dispatchUserEvent(n)})))}}connect(){let{sharedAssets:t,page:e}=this.eventContext,i=i=>{if(i.data?.events.length)for(let{id:n,data:r}of i.data.events){if(r.disabled||"Start"!==r.type)continue;let s=new h1(n,r,i,e,t,this.eventManager);(s.actions.Transition.length||s.actions.Animation.length||s.actions.SwitchCamera.length||s.actions.Create.length||s.actions.Destroy.length||s.actions.SceneTransition.length||s.actions.Reset.length||s.actions.SetVariable.length||s.actions.DynamicVariablePlay.length||s.actions.ClearLocalStorage.length||s.actions.UserAPI.length)&&(this.eventsPerObject.has(i)?this.eventsPerObject.get(i)?.push(s):this.eventsPerObject.set(i,[s])),s.actions.Audio.length&&(this.eventsAfterPerObject.has(i)?this.eventsAfterPerObject.get(i)?.push(s):this.eventsAfterPerObject.set(i,[s])),s.actions.Video.length&&(this.hasVideoAction=!0,this.eventsAfterPerObject.has(i)?this.eventsAfterPerObject.get(i)?.push(s):this.eventsAfterPerObject.set(i,[s])),s.actions.Particles.length&&(this.eventsAfterPerObject.has(i)?this.eventsAfterPerObject.get(i)?.push(s):this.eventsAfterPerObject.set(i,[s]))}};if(e.traverseEntity((t=>{(t instanceof cQ||t instanceof tQ)&&t.frame?.traverse((t=>{i(t)})),i(t)})),[...this.eventsAfterPerObject.values()].some((t=>t.length))){if(0===this.eventManager.activateCount){let{domElement:t,isExport:e}=this.eventContext,i=e?document:t;i.addEventListener("pointerdown",this.onMouseDown,{once:!0}),i.addEventListener("mousedown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),i.addEventListener("pointerdown",this.onAny),i.addEventListener("mousedown",this.onAny),document.addEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach((t=>{let[e,i]=t;e.addEventListener("userEvent",this.onUserEvent)}))}else this.onSceneTransitionAudioVideoPlay();this.onPlay()}[...this.eventsPerObject.entries()].forEach((t=>{let[e,i]=t;e.dispatchEvent({type:"beginEvent",eventName:"Start"}),i.forEach((t=>t.dispatch())),e.addEventListener("userEvent",this.onUserEvent)}))}disconnect(){if([...this.eventsAfterPerObject.values()].some((t=>t.length))){let{domElement:t,isExport:e}=this.eventContext,i=e?document:t;i.removeEventListener("pointerdown",this.onMouseDown),i.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),i.removeEventListener("pointerdown",this.onAny),i.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach((t=>{let[e,i]=t;e.removeEventListener("userEvent",this.onUserEvent),i.forEach((t=>t.disconnect()))}))}[...this.eventsPerObject.entries()].forEach((t=>{let[e,i]=t;e.removeEventListener("userEvent",this.onUserEvent),i.forEach((t=>t.disconnect()))})),this.eventsPerObject.clear(),this.eventsAfterPerObject.clear()}},u1=class{constructor(t,e,i,n,r,s){this.id=t,this.data=e,this.object=i,this.initialDisabled=!1,this.actions=JJ(e,e.actions,n,r,s,i),this.target=e.target}disconnect(){$J(this.actions)}dispatch(t){this.initialDisabled||(this.actions.Transition.forEach((t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())})),this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.actions.Transition.forEach((t=>{"Toggle"===t.data.runMode?t.toggle():t.play()})),this.actions.Animation.forEach((t=>{"Toggle"===t.data.runMode?t.toggle():t.play()})),this.actions.Reset.forEach((t=>{t.dispatch()})),this.actions.Link.forEach((t=>{t.dispatch()})),this.actions.Reset.forEach((t=>{t.dispatch()})),this.actions.Create.forEach((t=>{t.dispatch()})),this.actions.Destroy.forEach((e=>{e.dispatch(t??!1)})),this.actions.SetVariable.forEach((t=>t.checkConditions())),this.actions.SetVariable.forEach((t=>t.dispatch())),this.actions.DynamicVariablePlay.forEach((t=>t.dispatch())),this.actions.Audio.forEach((t=>{t.dispatchBasic()})),this.actions.Particles.forEach((t=>{t.dispatchBasic()})),this.actions.Video.forEach((t=>{t.dispatchBasic()})),this.actions.ClearLocalStorage.forEach((t=>t.dispatch())),this.actions.UserAPI.forEach((t=>t.dispatch())))}},d1=class extends J${constructor(t,e,i,n,r){super(t),this.sharedVariables=e,this.eventManager=i,this.needsMouse=n,this.needsRaycast=r,this.dynamicVars=[],this.variablesToWatch=[],this.prevMouseProperty=null,this.prevRaycastProperty=null,this.pauseTime=0,this.isOutOfFocus=!1,this.events=[],this.onFrame=t=>{let e=this.eventContext.sharedAssets;if(this.rafId=window.requestAnimationFrame(this.onFrame),this.isOutOfFocus)return;let i=new Date,n=[],r=[];for(let o=0;o<this.propertiesToWatch.length;o++){let{objectId:t,property:e,prevValue:i}=this.propertiesToWatch[o],n=this.eventContext.scene.find(t),s=vI.propertyPaths[e];if("width"===s[0]||"height"===s[0]||"depth"===s[0])n=n.geometry.userData.parameters[s[0]];else for(let r=0;r<s.length;r++)n=n[s[r]];null===i?this.propertiesToWatch[o].prevValue=n instanceof mm?n.clone():n:(n instanceof mm?!n.equals(i):i!==n)&&(r.push({objId:t,property:e}),n instanceof mm?this.propertiesToWatch[o].prevValue.copy(n):this.propertiesToWatch[o].prevValue=n)}for(let o=0;o<this.variablesToWatch.length;o++){let{id:t,prevValue:i}=this.variablesToWatch[o],r=e.getVariable(t);r!==i&&(n.push(t),this.variablesToWatch[o].prevValue=r)}for(let o=0;o<this.dynamicVars.length;o++){let{id:r,expectedTime:s,last:a,data:l,timerSeconds:h,startValue:c}=this.dynamicVars[o],u=1e3;if("timer"!==l.dynamicVariableType&&"stopwatch"!==l.dynamicVariableType||"number3decimal"!==l.format?"counter"===l.dynamicVariableType?u=l.updateInterval:"random"===l.dynamicVariableType&&(u=l.isStatic?1/0:l.updateInterval):u=1,-1!==s){if("Stopped"!==e.getDynamicVariablePlayState(r)&&"Restarted"!==e.getDynamicVariablePlayState(r)||(this.dynamicVars[o].last=t,this.dynamicVars[o].expectedTime=t+u,"counter"===l.dynamicVariableType&&e.getVariable(r)!==c&&(e.updateVariable(r,c),this.eventManager.requestRender()),("timer"===l.dynamicVariableType||"stopwatch"===l.dynamicVariableType)&&this.dynamicVars[o].timerSeconds!==c&&(this.dynamicVars[o].timerSeconds=c,e.updateVariable(r,lO.getFormattedTimerTime(c,l)),this.eventManager.requestRender()),"Restarted"===e.getDynamicVariablePlayState(r)&&e.setDynamicVariablePlayState(r,"Playing"),"Stopped"!==e.getDynamicVariablePlayState(r))){if("Paused"===e.getDynamicVariablePlayState(r)){void 0===this.dynamicVars[o].deltaToExpectedTime&&(this.dynamicVars[o].deltaToExpectedTime=Math.max(this.dynamicVars[o].expectedTime-t,0)),this.dynamicVars[o].last=t-(u-this.dynamicVars[o].deltaToExpectedTime),this.dynamicVars[o].expectedTime=t+this.dynamicVars[o].deltaToExpectedTime;continue}if(this.dynamicVars[o].deltaToExpectedTime=void 0,t>=s)if(this.dynamicVars[o].last=t,this.dynamicVars[o].expectedTime+=u,"random"===l.dynamicVariableType){let t=l.min+Math.random()*(l.max-l.min),i=l.decimals;t=Math.round(t*Math.pow(10,i))/Math.pow(10,i),e.updateVariable(r,t),n.push(r),this.eventManager.requestRender()}else if("counter"===l.dynamicVariableType){let t=e.getVariable(r),i=e.getDynamicVariableToggleIsForward(r)??!0,s=e.getVariable(r)+l.increment*(i?1:-1);l.hasEnd&&(s=l.increment>0?Nf.clamp(s,c,l.endValue):Nf.clamp(s,l.endValue,c),s===c&&e.setDynamicVariableToggleIsForward(r,void 0),l.repeat?s===l.endValue&&(s=c):(s===c||s===l.endValue)&&e.setDynamicVariablePlayState(r,"Paused")),s!==t&&(n.push(r),e.updateVariable(r,s),this.eventManager.requestRender())}else if("time"===l.dynamicVariableType){let t=e.getVariable(r),s=Wj(i,l);if("object"==typeof t&&"textValue"in t&&"object"==typeof s&&"textValue"in s){if(Array.isArray(t.textValue)&&Array.isArray(s.textValue)){if(t.textValue.every(((t,e)=>t===s.textValue[e])))continue}else if(t.textValue===s.textValue)continue}else if(t===s)continue;e.updateVariable(r,s),n.push(r),this.eventManager.requestRender()}else{let i=nO.isTextValue(l.endValue)?f1(l.endValue.textValue):l.endValue,s=e.getDynamicVariableToggleIsForward(r)??!0,u=h+(t-a)/1e3*("timer"===l.dynamicVariableType?-1:1)*(s?1:-1);u=Math.max(u,0),l.hasEnd&&(u="stopwatch"===l.dynamicVariableType?Nf.clamp(u,c,i):Nf.clamp(u,i,c),u===c&&e.setDynamicVariableToggleIsForward(r,void 0),l.repeat?Math.abs(u-i)<("number3decimal"===l.format?1e-4:.1)&&(u=c):(Math.abs(u-c)<("number3decimal"===l.format?1e-4:.1)||Math.abs(u-i)<("number3decimal"===l.format?1e-4:.1))&&e.setDynamicVariablePlayState(r,"Paused")),u!==h&&(n.push(r),this.dynamicVars[o].timerSeconds=u,e.updateVariable(r,lO.getFormattedTimerTime(u,l)),this.eventManager.requestRender())}}}else this.dynamicVars[o].last=t,this.dynamicVars[o].expectedTime=t+u}let s=!1;e.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=e.mouseProperty,s=!0);let a=!1;e.raycastProperty!==this.prevRaycastProperty&&(this.prevRaycastProperty=e.raycastProperty,a=!0),this.events.forEach((t=>{(n.includes(t.data.variableId)||r.find((e=>e.objId===t.data.objectId&&e.property===t.data.property))||"mouseProperty"===t.data.variableId&&s||"raycastProperty"===t.data.variableId&&a)&&(t.dispatch(),this.eventManager.requestRender())}))},this.onBlur=()=>{this.pause()},this.onFocus=()=>{this.resume()}}pause(){this.isOutOfFocus||(this.isOutOfFocus=!0,this.pauseTime=Date.now())}resume(){if(!this.isOutOfFocus)return;this.isOutOfFocus=!1;let t=Date.now()-this.pauseTime;for(let e=0;e<this.dynamicVars.length;e++)this.dynamicVars[e].last+=t,this.dynamicVars[e].expectedTime+=t}connect(){this.eventContext.page.traverseEntity((t=>{t.data?.events.filter((t=>"VariableChange"===t.data.type&&!t.data.disabled)).forEach((e=>{this.events.push(new p1(e.id,e.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))}))})),this.propertiesToWatch=this.events.filter((t=>"objectProperty"===t.data.variableId&&null!==t.data.objectId)).map((t=>({objectId:t.data.objectId,property:t.data.property,prevValue:null})));let t=this.eventContext.sharedAssets;this.sharedVariables.forEach((e=>{let i,{id:n,data:r}=e;if("dynamicVariableType"in r)if("timer"===r.dynamicVariableType||"stopwatch"===r.dynamicVariableType){let t;if(nO.isTextValue(r.value)&&Array.isArray(r.value.textValue)){let e=r.value.textValue;t=3===e.length?e[2]+60*e[1]+3600*e[0]:e[1]+60*e[0]}else t=r.value;i=t,this.dynamicVars.push({id:n,last:-1,expectedTime:-1,data:r,timerSeconds:t,startValue:i})}else"time"===r.dynamicVariableType&&t.updateVariable(n,Wj(new Date,r)),"counter"===r.dynamicVariableType&&(i=nO.isTextValue(r.value)?f1(r.value.textValue):r.value),this.dynamicVars.push({id:n,last:-1,expectedTime:-1,data:r,startValue:i});else this.events.find((t=>t.data.variableId===n))&&this.variablesToWatch.push({id:n,prevValue:t.getVariable(n)})})),this.rafId=window.requestAnimationFrame(this.onFrame),window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus)}disconnect(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),this.rafId&&(window.cancelAnimationFrame(this.rafId),this.rafId=void 0),this.events.forEach((t=>t.dispose()))}},p1=class{constructor(t,e,i,n,r,s){this.id=t,this.data=e,this.object=i,this.actions=JJ(e,e.actions,n,r,s,i)}dispatch(){let t=this.actions;t.Audio.forEach((t=>t.dispatchConditional())),t.Particles.forEach((t=>t.dispatchConditional())),t.Video.forEach((t=>t.dispatchConditional())),t.Create.forEach((t=>t.dispatch())),t.Destroy.forEach((t=>t.dispatch())),t.Reset.forEach((t=>t.dispatch())),t.Transition.forEach((t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()})),t.Transition.forEach((t=>t.play())),t.Animation.forEach((t=>t.play())),t.SwitchCamera.forEach((t=>t.play())),t.SceneTransition.forEach((t=>t.dispatch())),t.SetVariable.forEach((t=>t.checkConditions())),t.SetVariable.forEach((t=>t.dispatch())),t.DynamicVariablePlay.forEach((t=>t.dispatch())),t.ClearLocalStorage.forEach((t=>t.dispatch())),t.UserAPI.forEach((t=>t.dispatch()))}dispose(){$J(this.actions)}};function f1(t){return 3===t.length?t[2]+60*t[1]+3600*t[0]:t[1]+60*t[0]}var m1,g1,v1,y1={cs:6,ch:2,walkableSlopeAngle:90,walkableHeight:20,walkableClimb:5,walkableRadius:0,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1};PT.then((t=>{m1=t,g1=new t.Vec3,v1=new t.Vec3}));var b1=new mm,x1=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.usePhysics=t,this.isExport=e,this.onPointerDown=t=>{if(1!==gT.length)return;let{raycaster:e,page:i}=this.eventContext;this.eventContext.updateRaycaster(t);let n=i.raycastWithClones(e);if(0!==n.length){if(this.gameControl){let t=b1.copy(this.gameControl.colliderWorldPosition);t.y-=this.gameControl.colliderHeight/2,this.gameControl.path=this.computePath(t,n[0].point)}this.eventContext.requestRender()}},this.traverseWithPhysics=(t,e)=>i=>{let n;if(i instanceof hW){if(!i.objectForSample)return!0===i.object.dataPatched.physics.fusedBody&&"dynamic"===i.object.dataPatched.physics.rigidBody||void 0;if(i.objectForSample.dataPatched.physics.fusedBody)return;n=i.object}else if(i instanceof LB)n=i.object;else if(n=i,!1===n.dataPatched.cloner?.disabled&&n.dataPatched.cloner?.hideBase&&!0!==n.dataPatched.physics?.fusedBody)return!0;if(e&&!n.userData.navmesh)return;let r=n.dataPatched;if(!r.visible&&!0!==r.physics?.enabled)return!0;i.updateMatrixWorldSVD();let s=s2(r),a=n.userData.hasDestroy,o=n.userData.hasDrag,l=!1,h=!1;for(let t of r.events)!0!==t.data.disabled&&("GameControl"===t.data.type?l=!0:"Follow"===t.data.type&&(h=!0));if(l||s||h||a||o)return!0;if(this.usePhysics&&"dynamic"===r.physics?.rigidBody){if(this.usePhysics&&r.physics?.fusedBody)return!0}else if("geometry"in i&&i.geometry&&t.push(z$(i.geometry,i.matrixWorld)),this.usePhysics&&r.physics?.fusedBody)return i.traverseObject(((e,i)=>{if(0===i)return;let n;if(e instanceof hW){if(!e.objectForSample)return!0===e.object.dataPatched.physics.fusedBody&&"dynamic"===e.object.dataPatched.physics.rigidBody||void 0;if(e.objectForSample.dataPatched.physics.fusedBody)return;n=e.object}else if(e instanceof LB)n=e.object;else if(n=e,e.dataPatched.cloner?.hideBase)return!0;let r=n.dataPatched;if(!r.visible&&!0!==r.physics?.enabled)return!0;"geometry"in e&&e.geometry&&t.push(z$(e.geometry,e.matrixWorld))})),!0},this.traverseNoPhysics=(t,e)=>i=>{let n;if(i instanceof hW)return;n=i instanceof LB?i.object:i;let r=n.dataPatched;if("visibility"===r.physics.enabled?!r.visible:!r.physics.enabled)return!0;if(e&&!n.userData.navmesh)return;let s=i.geometry,a=!0===n.userData.hasDestroy,o=!0===n.userData.hasDrag;if(s2(r)||a||o||n.dataPatched.events.some((t=>!0!==t.data.disabled&&"GameControl"===t.data.type)))return!0;s&&t.push(z$(s,i.matrixWorld))},this.navmeshWasm=m1,this.navMesh=new this.navmeshWasm.NavMesh,this._workerURL=URL.createObjectURL(new Blob([(e?"\n(async function() {\n\tconst [wasmImport, wasmBinary] = await Promise.all([\n\t\timport('https://unpkg.com/@splinetool/runtime@1.9.72/build/' + 'navmesh.js'),\n\t\tfetch('https://unpkg.com/@splinetool/navmesh-wasm@1.9.72/build/' + 'navmesh.wasm').then((res) => res.arrayBuffer()),\n\t]);\n\tconst wasmModule = wasmImport.default;\n\tself.module = await wasmModule({ wasmBinary });\n\tpostMessage('ready');\n})();\n":"\n(async function() {\n\tconst [wasmImport, wasmBinary] = await Promise.all([\n\t\timport(self.location.origin + '/_libraries/navmesh.js'),\n\t\tfetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),\n\t]);\n\tconst wasmModule = wasmImport.default;\n\tself.module = await wasmModule({ wasmBinary });\n\tpostMessage('ready');\n})();\n")+"\n\nonmessage = function(messageEvent) {\n\tconst meshData = messageEvent.data;\n\tconst positions = meshData[0];\n\tconst offset = meshData[1];\n\tconst indices = meshData[2];\n\tconst indicesLength = meshData[3];\n\tconst parameters = meshData[4];\n\n\tconst module = self.module;\n\tconst rc = new module.rcConfig();\n\trc.cs = parameters.cs;\n\trc.ch = parameters.ch;\n\trc.borderSize = parameters.borderSize ? parameters.borderSize : 0;\n\trc.tileSize = parameters.tileSize ? parameters.tileSize : 0;\n\trc.walkableSlopeAngle = parameters.walkableSlopeAngle;\n\trc.walkableHeight = parameters.walkableHeight;\n\trc.walkableClimb = parameters.walkableClimb;\n\trc.walkableRadius = parameters.walkableRadius;\n\trc.maxEdgeLen = parameters.maxEdgeLen;\n\trc.maxSimplificationError = parameters.maxSimplificationError;\n\trc.minRegionArea = parameters.minRegionArea;\n\trc.mergeRegionArea = parameters.mergeRegionArea;\n\trc.maxVertsPerPoly = parameters.maxVertsPerPoly;\n\trc.detailSampleDist = parameters.detailSampleDist;\n\trc.detailSampleMaxError = parameters.detailSampleMaxError;\n\n\tif (!self.navMesh) {\n\t\tself.navMesh = new module.NavMesh();\n\t}\n\tself.navMesh.build(positions, offset, indices, indicesLength, rc);\n\n\tconst navmeshData = navMesh.getNavmeshData();\n\tconst arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);\n\tconst ret = new Uint8Array(navmeshData.size);\n\tret.set(arrView);\n\tnavMesh.freeNavmeshData(navmeshData);\n\n\tpostMessage(ret);\n}\n"])),this._worker=new Worker(this._workerURL)}init(t,e,i){this.gameControl=e,this.eventContext=i,this.setDefaultQueryExtent((new mm).setScalar(t.ch*t.walkableRadius*1.2)),this._worker.onmessage=()=>{this.createNavMesh(i.page,t,(t=>{this.buildFromNavmeshData(t.data)}))},this.eventContext.renderer.domElement.addEventListener("pointerdown",this.onPointerDown)}createNavMesh(t,e,i){e.objects.forEach((e=>{let i=t.scene.find(e);i.traverseEntity((t=>{t.userData.navmesh=!0})),i.cloner?.traverseObject((t=>{t.userData.navmesh=!0}))}));let n=[],r=(this.usePhysics?this.traverseWithPhysics:this.traverseNoPhysics)(n,"custom"===e.zones);if(t.traverseChildren(r),e.objects.forEach((e=>{let i=t.scene.find(e);i.traverseEntity((t=>{t.userData.navmesh=void 0})),i.cloner?.traverseObject((t=>{t.userData.navmesh=void 0}))})),0===n.length)return!1;let s=$O(n),{positions:a,triIndices:o}=ZN(s.getAttribute("position"),s.getIndex());return this._worker.postMessage([a,a.length/3,o,o.length,{...y1,...e}]),this._worker.onmessage=i,!0}createDebugNavGeometry(){let t,e,i=this.navMesh.getDebugNavMesh(),n=i.getTriangleCount(),r=new Uint32Array(3*n),s=new Float32Array(3*n*3);for(t=0;t<3*n;t++)r[t]=t;for(t=0;t<n;t++)for(e=0;e<3;e++){let n=i.getTriangle(t).getPoint(e);s[9*t+3*e+0]=n.x,s[9*t+3*e+1]=n.y,s[9*t+3*e+2]=n.z}let a=new Hg;return a.setIndex(new Rg(r,1)),a.setAttribute("position",new Rg(s,3)),a}getClosestPoint(t){return g1.x=t.x,g1.y=t.y,g1.z=t.z,this.navMesh.getClosestPoint(g1)}getClosestPointToRef(t,e){g1.x=t.x,g1.y=t.y,g1.z=t.z;let i=this.navMesh.getClosestPoint(g1);e.set(i.x,i.y,i.z)}getRandomPointAround(t,e){return g1.x=t.x,g1.y=t.y,g1.z=t.z,this.navMesh.getRandomPointAround(g1,e)}getRandomPointAroundToRef(t,e,i){g1.x=t.x,g1.y=t.y,g1.z=t.z;let n=this.navMesh.getRandomPointAround(g1,e);i.set(n.x,n.y,n.z)}moveAlong(t,e){return g1.x=t.x,g1.y=t.y,g1.z=t.z,v1.x=e.x,v1.y=e.y,v1.z=e.z,this.navMesh.moveAlong(g1,v1)}moveAlongToRef(t,e,i){return g1.x=t.x,g1.y=t.y,g1.z=t.z,v1.x=e.x,v1.y=e.y,v1.z=e.z,this.navMesh.moveAlong(g1,v1)}computePath(t,e){let i=this.getClosestPoint(e);if(v1.x=i.x,v1.y=i.y,v1.z=i.z,Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2)+Math.pow(e.z-i.z,2))>this.getDefaultQueryExtent().y)return[];this.getClosestPoint(t);let n=this.navMesh.computePath(g1,v1),r=n.getPointCount(),s=[];for(let a=0;a<r;a++){let t=n.getPoint(a);s.push(new mm(t.x,t.y,t.z))}return s}createCrowd(t,e){return new w1(this,t,e)}setDefaultQueryExtent(t){g1.x=t.x,g1.y=t.y,g1.z=t.z,this.navMesh.setDefaultQueryExtent(g1)}getDefaultQueryExtent(){return this.navMesh.getDefaultQueryExtent()}buildFromNavmeshData(t){let e=t.length*t.BYTES_PER_ELEMENT,i=this.navmeshWasm._malloc(e),n=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,i,e);n.set(t);let r=new this.navmeshWasm.NavmeshData;r.dataPointer=n.byteOffset,r.size=t.length,this.navMesh.buildFromNavmeshData(r),this.navmeshWasm._free(n.byteOffset)}getNavmeshData(){let t=this.navMesh.getNavmeshData(),e=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,t.dataPointer,t.size),i=new Uint8Array(t.size);return i.set(e),this.navMesh.freeNavmeshData(t),i}getDefaultQueryExtentToRef(t){let e=this.navMesh.getDefaultQueryExtent();t.set(e.x,e.y,e.z)}dispose(){this.navMesh.destroy(),this._worker.terminate(),URL.revokeObjectURL(this._workerURL),this.eventContext?.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown)}addCylinderObstacle(t,e,i){return g1.x=t.x,g1.y=t.y,g1.z=t.z,this.navMesh.addCylinderObstacle(g1,e,i)}addBoxObstacle(t,e,i){return g1.x=t.x,g1.y=t.y,g1.z=t.z,v1.x=e.x,v1.y=e.y,v1.z=e.z,this.navMesh.addBoxObstacle(g1,v1,i)}removeObstacle(t){this.navMesh.removeObstacle(t)}isSupported(){return void 0!==this.navmeshWasm}},w1=class{constructor(t,e,i){this.navmeshWasmWrapper=t,this.transforms=[],this.agents=new Array,this.reachRadii=new Array,this._agentDestinationArmed=new Array,this._agentDestination=new Array,this.crowd=new this.navmeshWasmWrapper.navmeshWasm.Crowd(e,i,this.navmeshWasmWrapper.navMesh.getNavMesh())}onReachTarget(t,e){}addAgent(t,e,i){let n=new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams;n.radius=e.radius,n.height=e.height,n.maxAcceleration=e.maxAcceleration,n.maxSpeed=e.maxSpeed,n.collisionQueryRange=e.collisionQueryRange,n.pathOptimizationRange=e.pathOptimizationRange,n.separationWeight=e.separationWeight,n.updateFlags=7,n.obstacleAvoidanceType=0,n.queryFilterType=0,n.userData=0;let r=this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z),n);return this.transforms.push(i),this.agents.push(r),this.reachRadii.push(e.reachRadius?e.reachRadius:e.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new mm(0,0,0)),r}getAgentPosition(t){return this.crowd.getAgentPosition(t)}getAgentPositionToRef(t,e){let i=this.crowd.getAgentPosition(t);e.set(i.x,i.y,i.z)}getAgentVelocity(t){return this.crowd.getAgentVelocity(t)}getAgentVelocityToRef(t,e){let i=this.crowd.getAgentVelocity(t);e.set(i.x,i.y,i.z)}getAgentNextTargetPath(t){return this.crowd.getAgentNextTargetPath(t)}getAgentNextTargetPathToRef(t,e){let i=this.crowd.getAgentNextTargetPath(t);e.set(i.x,i.y,i.z)}getAgentState(t){return this.crowd.getAgentState(t)}overOffmeshConnection(t){return this.crowd.overOffmeshConnection(t)}agentGoto(t,e){this.crowd.agentGoto(t,new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z));let i=this.agents.indexOf(t);i>-1&&(this._agentDestinationArmed[i]=!0,this._agentDestination[i].set(e.x,e.y,e.z))}agentTeleport(t,e){this.crowd.agentTeleport(t,new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z))}updateAgentParameters(t,e){let i=this.crowd.getAgentParameters(t);void 0!==e.radius&&(i.radius=e.radius),void 0!==e.height&&(i.height=e.height),void 0!==e.maxAcceleration&&(i.maxAcceleration=e.maxAcceleration),void 0!==e.maxSpeed&&(i.maxSpeed=e.maxSpeed),void 0!==e.collisionQueryRange&&(i.collisionQueryRange=e.collisionQueryRange),void 0!==e.pathOptimizationRange&&(i.pathOptimizationRange=e.pathOptimizationRange),void 0!==e.separationWeight&&(i.separationWeight=e.separationWeight),this.crowd.setAgentParameters(t,i)}removeAgent(t){this.crowd.removeAgent(t);let e=this.agents.indexOf(t);e>-1&&(this.agents.splice(e,1),this.transforms.splice(e,1),this.reachRadii.splice(e,1),this._agentDestinationArmed.splice(e,1),this._agentDestination.splice(e,1))}getAgents(){return this.agents}update(t){if(this.navmeshWasmWrapper.navMesh.update(),t<=.001)return;let e=1/60;{let i=Math.floor(t/e);i>10&&(i=10),i<1&&(i=1);let n=t/i;for(let t=0;t<i;t++)this.crowd.update(n)}for(let i=0;i<this.agents.length;i++){let t=this.agents[i],e=this.getAgentPosition(t);if(this.transforms[i].copy(e),this._agentDestinationArmed[i]){let n=e.x-this._agentDestination[i].x,r=e.z-this._agentDestination[i].z,s=this.reachRadii[i],a=this._agentDestination[i].y-this.reachRadii[i],o=this._agentDestination[i].y+this.reachRadii[i],l=n*n+r*r;e.y>a&&e.y<o&&l<s*s&&(this.onReachTarget(t,this._agentDestination[i]),this._agentDestinationArmed[i]=!1)}}}setDefaultQueryExtent(t){let e=new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z);this.crowd.setDefaultQueryExtent(e)}getDefaultQueryExtent(){return this.crowd.getDefaultQueryExtent()}getDefaultQueryExtentToRef(t){let e=this.crowd.getDefaultQueryExtent();t.set(e.x,e.y,e.z)}getCorners(t){let e,i=this.crowd.getCorners(t),n=i.getPointCount(),r=[];for(e=0;e<n;e++){let t=i.getPoint(e);r.push(new mm(t.x,t.y,t.z))}return r}dispose(){this.crowd.destroy()}};function S1(t){let e=!1;return t.scene.objects.forEach((i=>{"Page"===i.data.type&&!e&&i.data.publish.gameControlObject&&JR.traverseModuleInstances(t,i.id,((t,i,n)=>{for(let r of n)"GameControl"===r.data.type&&r.data.navmesh.enabled&&(e=!0)}))})),e}var A1={type:"change"},E1={type:"changeZoom"},_1={type:"changePan"},C1={type:"start"},M1={type:"end",changed:!0},P1={type:"end",changed:!1},T1=new fm,D1=new Uf,k1=2*Math.PI,I1=new mm,R1=new Uf,O1=new mm,L1=new fm,B1=new Wm,z1={type:"requestRender"},F1=class extends _f{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{isPlayMode:!1,isExport:!1};super(),this.object=t,this.domElement=e,this.options=i,this.enabled=!0,this.useKeyEvents=!0,this.enableDamping=!1,this.enableZoom=!0,this.enableRotate=!0,this.enablePan=!0,this.autoRotate=!1,this.rotationLimitsMode=0,this.panLimitsMode=0,this.rotationSoftLimit=2,this.panSoftLimit=2,this.hoverRotatePanMode=0,this.zoomLimitsEnabled=!1,this.mouseButtons=[0,5],this.mouseButtonsPlay=[3,4,5],this.touches=[null,gp,fp],this.offset=new mm,this.eye=new mm,this.lastPosition=new mm,this.lastQuaternion=new fm,this.current=new Uf,this.overShoot=new Uf,this.overRatio=new Uf,this.spherical=new KS,this.sphericalDelta=new KS,this.panOffset=new mm,this.panLeftV=new mm,this.panUpV=new mm,this.panV=new mm,this.rotateStart=new Uf,this.rotateEnd=new Uf,this.rotateDelta=new Uf,this.panStart=new Uf,this.panEnd=new Uf,this.panDelta=new Uf,this.dollyStart=new Uf,this.dollyEnd=new Uf,this.dollyDelta=new Uf,this.rotationRangeFactor=new Uf,this.panRangeFactor=new Uf,this.state=-1,this.zoomChanged=!1,this.isPointerDown=!1,this.isThetaFlipped=!1,this.prevScale=0,this.scale=1,this.gesture=!1,this.timer=-1,this.timerHover=-1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPhi=0,this.maxPhi=Math.PI,this.minTheta=-1/0,this.maxTheta=1/0,this.minH=0,this.maxH=Math.PI,this.minV=-1/0,this.maxV=1/0,this.autoRotateClockwise=!0,this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.resetHoverEffectOnPointerLeave=!1,this.hasChange=!1,this.useWindowEvents=!1,this.isTouchZoom=!0,this.autoRotateSpeed=2,this.dampingFactor=.125,this.zoomSpeed=2,this.rotateSpeed=1,this.panSpeed=1,this.hoverRotatePanStrength=.1,this.hoverRotateDamping=this.dampingFactor,this.thetaIsFree=!1,this.phiIsFree=!1,this.needsUpdate=!0,this.onCameraChange=t=>{this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange),this.object=t.camera,this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)},this.update=()=>{this.object.updateWorldMatrix(!0,!1),this.object.matrixWorld.decompose(O1,L1,I1),this.offset.copy(O1).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&&-1===this.state&&this.rotateLeft((!0===this.autoRotateClockwise?1:-1)*this.getAutoRotationAngle()),0!==this.rotationLimitsMode&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),2!==this.rotationLimitsMode&&(this.spherical.phi+=this.sphericalDelta.phi),(1!==this.rotationLimitsMode||!0===this.autoRotate)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&this.object.isPerspectiveCamera&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),0!==this.panLimitsMode&&(this.target.applyQuaternion(T1.copy(L1).invert()),this.panOffset.applyQuaternion(T1),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(L1),this.panOffset.applyQuaternion(L1)),2===this.panLimitsMode&&(this.panOffset.y=0),1===this.panLimitsMode&&(this.panOffset.x=0),-1!==this.state||this.gesture?(this.target.add(this.panOffset),this.panOffset.set(0,0,0)):(this.panOffset.multiplyScalar(1-this.dampingFactor),this.target.add(this.panOffset)),this.offset.setFromSpherical(this.spherical),O1.copy(this.target).add(this.offset),this.object.position.copy(this.target).add(this.offset),this.object.parent&&(B1.copy(this.object.parent.matrixWorld).invert(),this.object.position.applyMatrix4(B1));let t=this.spherical.phi%k1;if(this.eye.copy(this.offset).normalize(),this.object.up.copy(gg.DEFAULT_UP).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),t>0&&t>Math.PI||t<0&&t>-Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),-1===this.state||!0===this.enableDamping){let t=1===this.hoverRotatePanMode?this.hoverRotateDamping:this.dampingFactor;this.sphericalDelta.theta*=1-t,this.sphericalDelta.phi*=1-t}else this.sphericalDelta.set(0,0,0);return this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>.01||8*(1-this.lastQuaternion.dot(this.object.quaternion))>1e-8?(this.dispatchEvent(A1),this.object.dispatchEvent(z1),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0):(this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.object.wasMovedBySwitchCameraAction=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),!1)},this.onPointerDown=t=>{!1!==this.enabled&&("touch"===t.pointerType||"pen"===t.pointerType&&cT?this.onPointerDownTouch(t):this.onPointerDownMouse(t),-1!==this.state&&(this.isPointerDown=!0,this.dispatchEvent(C1),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp),t.stopPropagation(),"touch"===t.pointerType||"pen"===t.pointerType&&cT||this.domElement.setPointerCapture(t.pointerId)))},this.onPointerLeave=t=>{this.resetHoverEffectOnPointerLeave&&!this.useWindowEvents?(1===this.hoverRotatePanMode?(this.sphericalDelta.theta=-this.spherical.theta,this.sphericalDelta.phi=-this.spherical.phi,I1.subVectors(this.position0,this.target0),this.spherical.setFromVector3(I1),this.sphericalDelta.theta+=this.spherical.theta,this.sphericalDelta.phi+=this.spherical.phi,this.sphericalDelta.theta/=8,this.sphericalDelta.phi/=8):2===this.hoverRotatePanMode&&this.panOffset.subVectors(this.target0,this.target).divideScalar(8),this.update()):this.pointerLeaveEvent=t},this.onPointerEnter=t=>{this.resetHoverEffectOnPointerLeave||void 0===this.pointerLeaveEvent?R1.set(t.clientX-this.domElement.clientWidth/2,t.clientY-this.domElement.clientHeight/2):R1.set(t.clientX-this.pointerLeaveEvent.clientX,t.clientY-this.pointerLeaveEvent.clientY),1===this.hoverRotatePanMode?(this.rotateDelta.copy(R1).multiplyScalar(this.rotateSpeed*this.hoverRotatePanStrength).rotateAround(D1,-this.object.angleOffsetFromUp),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight),this.rotateStart.set(t.clientX,t.clientY)):2===this.hoverRotatePanMode&&(this.panDelta.copy(R1).multiplyScalar(this.panSpeed*this.hoverRotatePanStrength),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.set(t.clientX,t.clientY)),this.update()},this.onPointerMove=t=>{!1!==this.enabled&&(this.checkRaycastLock()||("touch"===t.pointerType||"pen"===t.pointerType&&cT?this.onPointerMoveTouch(t):this.onPointerMoveMouse(t),t.stopPropagation()))},this.onPointerUp=t=>{this.isPointerDown=!1,0===gT.length&&(this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)),gT.length>1&&t.preventDefault(),this.hasChange?this.dispatchEvent(M1):this.dispatchEvent(P1),this.state=-1,t&&(t.stopPropagation(),"touch"===t.pointerType||"pen"===t.pointerType&&cT||this.domElement.releasePointerCapture(t.pointerId))},this.onPointerDownMouse=t=>{let e;switch(e=this.useKeyEvents?this.mouseButtons[t.button]:this.mouseButtonsPlay[t.button],e){case 0:if(!0!==t.altKey||t.shiftKey||mT(t)){if(" "===this.key){if(!1===this.enablePan)return;this.handleMouseDownPan(t),this.state=2}}else{if(!1===this.enableRotate)return;this.handleMouseDownRotate(t),this.state=0}break;case 4:if(!1===this.enablePan)return;this.handleMouseDownPan(t),this.state=2;break;case 3:if(mT(t)||t.shiftKey){if(!1===this.enablePan)return;this.handleMouseDownPan(t),this.state=2}else{if(!1===this.enableRotate)return;this.handleMouseDownRotate(t),this.state=0}break;case 5:if(mT(t)||t.shiftKey){if(!1===this.enableRotate)return;this.handleMouseDownRotate(t),this.state=0}else{if(!1===this.enablePan)return;this.handleMouseDownPan(t),this.state=2}break;default:this.state=-1}},this.onPointerMoveMouse=t=>{switch(this.state){case 0:if(!1===this.enableRotate)return;this.handleMouseMoveRotate(t);break;case 1:if(!1===this.enableZoom)return;this.handleMouseMoveDolly(t);break;case 2:if(!1===this.enablePan)return;this.handleMouseMovePan(t)}this.object.wasMovedByUser=!0},this.onPointerDownTouch=t=>{switch(gT.length>1&&t.preventDefault(),this.touches[gT.length-1]){case pp:if(!1===this.enableRotate)return void(this.state=-1);this.handleTouchStartRotate(),this.state=3;break;case fp:if(!1===this.enablePan)return void(this.state=-1);this.handleTouchStartPan(),this.state=4;break;case mp:if(!1===this.enableZoom&&!1===this.enablePan)return;this.handleTouchStartDollyPan(),this.state=5;break;case gp:if(!1===this.enableZoom&&!1===this.enableRotate)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}},this.onPointerMoveTouch=t=>{switch(gT.length>1&&t.preventDefault(),this.state){case 3:if(!1===this.enableRotate)return;this.handleTouchMoveRotate(t),this.update();break;case 4:if(!1===this.enablePan)return;this.handleTouchMovePan(t),this.update();break;case 5:if(!1===this.enableZoom&&!1===this.enablePan)return;this.handleTouchMoveDollyPan(t),this.update();break;case 6:if(!1===this.enableZoom&&!1===this.enableRotate)return;this.handleTouchMoveDollyRotate(t),this.update();break;default:this.state=-1}this.object.wasMovedByUser=!0},this.dispatchEndDebounced=VP((()=>this.dispatchEvent(M1)),33),this.onMouseWheel=t=>{!1===this.enabled||!1===this.enableZoom&&!1===this.enablePan||this.checkRaycastLock()||(!this.options.isExport&&this.domElement.clientHeight===document.body.clientHeight&&this.domElement.clientWidth===document.body.clientWidth&&t.preventDefault(),this.dispatchEvent(C1),this.handleMouseWheel(t),this.dispatchEndDebounced(),this.object.wasMovedByUser=!0)},this.onGesture=t=>{if(t.preventDefault(),!1!==this.enabled&&!this.checkRaycastLock()&&!lT)if("gesturechange"===t.type){if(!1===this.enableZoom||!1===this.isTouchZoom)return;this.dispatchEvent(C1),t.scale>this.prevScale?this.dollyIn(this.getZoomScale()):t.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=t.scale,this.update(),this.object.wasMovedByUser=!0}else this.dispatchEvent(M1)},this.onContextMenu=t=>{t.preventDefault()},this.onTouchEnd=t=>{t.preventDefault()},this.onKeyDown=t=>{!1!==this.enabled&&(this.key=t.key," "===t.key&&this.dispatchEvent(C1))},this.onKeyUp=t=>{!1!==this.enabled&&(this.key=void 0,-1!==this.state&&"Alt"===t.key&&this.onPointerUp(gT[0])," "===t.key&&this.dispatchEvent(M1))},this.onPointerHover=t=>{"mouse"!==t.pointerType||!1===this.enabled||-1!==this.state||2===this.hoverRotatePanMode&&this.isPanOverShoot||1===this.hoverRotatePanMode&&this.isRotateOverShoot||(this.isPointerDown=!0,2===this.hoverRotatePanMode?this.handleMouseMovePan(t,this.hoverRotatePanStrength):1===this.hoverRotatePanMode&&this.handleMouseMoveRotate(t,this.hoverRotatePanStrength))},this.onBeginState=()=>{this.enabled=!1,this.needsUpdate=!1},this.onCompleteState=t=>{t.isfromEntity&&this.options.isPlayMode||(this.enabled=!0,this.needsUpdate=!0,this.object.updateUp(),this.object.getTarget(this.target))},this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.quat0=this.object.quaternion.clone(),this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.offset.copy(this.object.position).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.initialSphericalRadius=this.spherical.radius,this.addEventListenersToCamera()}dispatchEvent(t){"start"===t.type?this.hasChange=!1:this.hasChange=!0,super.dispatchEvent(t)}addEventListenersToCamera(){this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)}removeEventListenersFromCamera(){this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange)}updateUseWindowEvents(t){if(window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("pointermove",this.onPointerHover),this.useWindowEvents=t,0!==this.hoverRotatePanMode&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),0!==this.hoverRotatePanMode&&!this.useWindowEvents){let t=this.useWindowEvents?window:this.domElement;t.addEventListener("pointerleave",this.onPointerLeave),t.addEventListener("pointerenter",this.onPointerEnter)}}fromJSON(t,e){this.setEnableDampingSpeed(t.enableDamping),this.enablePan=t.enablePan,this.enableZoom=t.enableZoom,this.enableRotate=t.enableRotate,this.rotationLimitsMode=t.rotationLimitsMode,this.thetaIsFree=t.rotationHorizontalOffset.min===t.rotationHorizontalOffset.max&&t.rotationHorizontalOffset.min===Math.PI,this.phiIsFree=t.rotationVerticalOffset.min===t.rotationVerticalOffset.max&&t.rotationVerticalOffset.min===Math.PI,this.panLimitsMode=t.panLimitsMode,this.panSoftLimit=t.panSoftLimit,this.rotationSoftLimit=t.rotationSoftLimit,this.hoverRotatePanMode=t.hoverRotatePanMode,this.hoverRotateDamping=t.hoverRotateDamping??this.dampingFactor,this.useWindowEvents="window"===e,0!==this.hoverRotatePanMode&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover));let i=t.hoverRotatePanStrength/100;this.hoverRotatePanStrength=i**2,this.zoomLimitsEnabled=t.zoomLimitsEnabled,this.minZoom=t.zoomLimits.min,this.maxZoom=Math.max(t.zoomLimits.min,t.zoomLimits.max),this.minDistance=1e3/this.maxZoom,this.maxDistance=Math.max(this.minDistance,1e3/t.zoomLimits.min),this.autoRotate=t.autoRotate,this.autoRotateSpeed=t.autoRotateSpeed,this.autoRotateClockwise=t.autoRotateClockwise;let n=this.object.getTarget().applyQuaternion(T1.copy(this.object.quaternion).invert());this.minV=-t.panVerticalOffset.min+n.y,this.maxV=t.panVerticalOffset.max+n.y,this.minH=-t.panHorizontalOffset.min+n.x,this.maxH=t.panHorizontalOffset.max+n.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=N1(this.spherical.phi-t.rotationVerticalOffset.min),this.maxPhi=N1(this.spherical.phi+t.rotationVerticalOffset.max),this.minTheta=N1(N1(this.spherical.theta)-t.rotationHorizontalOffset.min),this.maxTheta=N1(N1(this.spherical.theta)+t.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,1===t.orbitTouches&&(this.touches[0]=pp),1===t.panTouches&&(this.touches[0]=fp),2===t.orbitTouches&&(this.touches[1]=gp),2===t.panTouches&&(this.touches[1]=mp),3===t.orbitTouches&&(this.touches[2]=pp),3===t.panTouches&&(this.touches[2]=fp),this.isTouchZoom=t.isTouchZoom,this.resetHoverEffectOnPointerLeave=t.resetHoverEffectOnPointerLeave??!1}connect(){if(this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture),this.domElement.addEventListener("touchend",this.onTouchEnd),0!==this.hoverRotatePanMode&&!this.useWindowEvents){let t=this.useWindowEvents?window:this.domElement;t.addEventListener("pointerleave",this.onPointerLeave),t.addEventListener("pointerenter",this.onPointerEnter)}this.pointerLeaveEvent=void 0}dispose(){this.removeEventListenersFromCamera(),this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}applyLimits(t,e,i,n,r,s,a,o){let l,h,c;this.overShoot.set(0,0),t instanceof mm?(l=t.x,h=t.y,this.current.set(this.target.x,this.target.y),c=!0):(l=t.theta,h=t.phi,this.current.set(N1(this.spherical.theta),N1(this.spherical.phi)),c=!1),0===i&&(this.current.x+=l,this.current.y+=h),(3===e||2===e)&&(!c&&this.isThetaFlipped?this.current.x>n&&this.current.x<0?this.overShoot.x=n-this.current.x:this.current.x<r&&this.current.x>0&&(this.overShoot.x=r-this.current.x):this.current.x>n?this.overShoot.x=n-this.current.x:this.current.x<r&&(this.overShoot.x=r-this.current.x)),(3===e||1===e)&&(this.current.y>s?this.overShoot.y=s-this.current.y:this.current.y<a&&(this.overShoot.y=a-this.current.y)),c||(this.overShoot.x=N1(this.overShoot.x),this.overShoot.y=N1(this.overShoot.y)),0!==i?(this.overRatio.copy(this.overShoot).divide(o),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),1===i&&(this.overRatio.x=U1(Math.abs(this.overRatio.x)),this.overRatio.y=U1(Math.abs(this.overRatio.y))),this.isPointerDown||1===i?2===i&&(this.overRatio.x>.9&&!this.thetaIsFree||this.overRatio.y>.9&&!this.phiIsFree)?this.isPointerDown=!1:(l*this.overShoot.x<0&&!this.thetaIsFree&&(l*=1-this.overRatio.x),h*this.overShoot.y<0&&!this.phiIsFree&&(h*=1-this.overRatio.y)):2===i&&(!c&&(this.overRatio.x>.002&&!this.thetaIsFree||this.overRatio.y>.002&&!this.phiIsFree)||c&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(this.thetaIsFree||(l=.05*this.overShoot.x),this.phiIsFree||(h=.05*this.overShoot.y),c?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):c?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(l+=this.overShoot.x,h+=this.overShoot.y),t instanceof mm?(t.x=l,t.y=h):(this.thetaIsFree||(t.theta=l),this.phiIsFree||(t.phi=h))}setEnableDampingSpeed(t){this.enableDamping=t,this.rotateSpeed=!0===t?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(t){this.sphericalDelta.theta-=t}rotateUp(t){this.sphericalDelta.phi-=t}panLeft(t,e){this.panLeftV.setFromMatrixColumn(e,0),this.panLeftV.multiplyScalar(-t),this.panOffset.add(this.panLeftV)}panUp(t,e){this.panUpV.setFromMatrixColumn(e,1),this.panUpV.multiplyScalar(t),this.panOffset.add(this.panUpV)}pan(t,e){let i=this.domElement;if(i&&this.object.isPerspectiveCamera){let n=this.object.position;this.panV.copy(n).sub(this.target);let r=this.panV.length();r*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*t*r/i.clientHeight,this.object.matrixWorld),this.panUp(2*e*r/i.clientHeight,this.object.matrixWorld)}else i&&this.object.isOrthographicCamera&&(this.panLeft(t*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrixWorld),this.panUp(e*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrixWorld));this.dispatchEvent(_1)}dollyOut(t){this.object.isPerspectiveCamera?this.scale/=t:this.object.isOrthographicCamera&&(this.object.zoom*=t,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(E1)}dollyIn(t){this.object.isPerspectiveCamera?this.scale*=t:this.object.isOrthographicCamera&&(this.object.zoom/=t,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(E1)}zoomOut(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getZoomScale();this.dispatchEvent(C1),this.dollyOut(t),this.dispatchEvent(M1)}zoomIn(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getZoomScale();this.dispatchEvent(C1),this.dollyIn(t),this.dispatchEvent(M1)}setZoom(t){if(this.dispatchEvent(C1),this.object.isPerspectiveCamera){let e=this.initialSphericalRadius/t/this.spherical.radius;this.scale=e}else this.object.isOrthographicCamera&&(this.object.zoom=t,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0);this.dispatchEvent(M1)}handleMouseDownRotate(t){this.rotateStart.set(t.clientX,t.clientY)}handleMouseDownDolly(t){this.dollyStart.set(t.clientX,t.clientY)}handleMouseDownPan(t){this.panStart.set(t.clientX,t.clientY)}handleMouseMoveRotate(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;void 0!==t.movementX?this.rotateDelta.set(t.movementX,t.movementY):(this.rotateEnd.set(t.clientX,t.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)),this.rotateDelta.multiplyScalar(this.rotateSpeed*e).rotateAround(D1,-this.object.angleOffsetFromUp);let i=this.domElement,n=this.useWindowEvents?window.innerHeight:i.clientHeight,r=2*Math.PI*this.rotateDelta.x/n,s=2*Math.PI*this.rotateDelta.y/n;this.rotateLeft(r),this.rotateUp(s),this.update()}handleMouseMoveDolly(t){this.dollyEnd.set(t.clientX,t.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;void 0!==t.movementX?this.panDelta.set(t.movementX,t.movementY):(this.panEnd.set(t.clientX,t.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)),this.panDelta.multiplyScalar(this.panSpeed*e),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(t){if(!1===hT&&!1===mT(t)&&!0===function(t){return 0===t.wheelDeltaY||0===t.deltaY?!(oT&&t.shiftKey&&Math.abs(t.wheelDeltaX)>=120)&&(t.wheelDeltaX?t.wheelDeltaX===-3*t.deltaX||t.wheelDeltaX===-3*window.devicePixelRatio*t.deltaX:0===t.deltaMode):t.wheelDeltaY?t.wheelDeltaY===-3*t.deltaY||t.wheelDeltaY===-3*window.devicePixelRatio*t.deltaY:0===t.deltaMode}(t)){if(!1===this.enablePan)return;this.gesture?(this.panDelta.set(-t.deltaX,-t.deltaY).multiplyScalar(this.panSpeed),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),t.altKey?this.pan(0,this.panDelta.y):t.shiftKey?this.pan(this.panDelta.x,0):this.pan(this.panDelta.x,this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout((()=>{this.gesture=!1,this.isPointerDown=!1}),30)}else{if(!1===this.enableZoom||this.gesture)return;0===t.deltaY?t.deltaX<0?this.dollyIn(this.getZoomScale()):t.deltaX>0&&this.dollyOut(this.getZoomScale()):t.deltaY<0?this.dollyIn(this.getZoomScale()):t.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){if(2===gT.length){let t=.5*(gT[0].pageX+gT[1].pageX),e=.5*(gT[0].pageY+gT[1].pageY);this.rotateStart.set(t,e)}else this.rotateStart.set(gT[0].pageX,gT[0].pageY)}handleTouchStartPan(){if(2===gT.length){let t=.5*(gT[0].pageX+gT[1].pageX),e=.5*(gT[0].pageY+gT[1].pageY);this.panStart.set(t,e)}else this.panStart.set(gT[0].pageX,gT[0].pageY)}handleTouchStartDolly(){let t=gT[0].pageX-gT[1].pageX,e=gT[0].pageY-gT[1].pageY,i=Math.sqrt(t*t+e*e);this.dollyStart.set(0,i)}handleTouchStartDollyPan(){this.enableZoom&&!0===this.isTouchZoom&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&&!0===this.isTouchZoom&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(t){if(2===gT.length){let e=AT(t),i=.5*(t.pageX+e.x),n=.5*(t.pageY+e.y);this.rotateEnd.set(i,n)}else{if(t.pointerId!==gT[0].pointerId)return;this.rotateEnd.set(t.pageX,t.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let e=this.domElement;e&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/e.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/e.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(t){if(2===gT.length){let e=AT(t),i=.5*(t.pageX+e.x),n=.5*(t.pageY+e.y);this.panEnd.set(i,n)}else{if(t.pointerId!==gT[0].pointerId)return;this.panEnd.set(t.pageX,t.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(t){let e=AT(t),i=t.pageX-e.x,n=t.pageY-e.y,r=Math.sqrt(i*i+n*n);this.dollyEnd.set(0,r),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(t){this.enableZoom&&!0===this.isTouchZoom&&this.handleTouchMoveDolly(t),this.enablePan&&this.handleTouchMovePan(t)}handleTouchMoveDollyRotate(t){this.enableZoom&&!0===this.isTouchZoom&&this.handleTouchMoveDolly(t),this.enableRotate&&this.handleTouchMoveRotate(t)}checkRaycastLock(){if(this.object.data.raycastLock){if(this.options.isPlayMode)return!1;{let t=this.options?.showCameraLock;return t&&t(),!0}}return!1}};function N1(t){let e=2*Math.PI;for(;t<=-Math.PI;)t+=e;for(;t>Math.PI;)t-=e;return t}function U1(t){return 1-Math.pow(1-t,4)}var V1,j1=class{constructor(t,e,i,n,r,s){this.id=t,this.data=e,this.object=i,this.page=n,this.currentIntersectedObjects=[],this.actions=JJ(e,e.actions,n,r,s,i),this.target=e.target,this.triggeringObjects=[];for(let a of e.triggeringObjects){let t=n.scene.find(a);t&&this.triggeringObjects.push(t)}}isValidTriggeringObject(t){return"all"===this.target||this.triggeringObjects.some((e=>e===t||e.isAncestorOf(t.uuid)||t.isAncestorOf(e.uuid)))}disconnect(){$J(this.actions)}dispatch(){this.object.destroyedInAction||(this.actions.Transition.forEach((t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())})),this.object.dispatchEvent({type:"beginEvent",eventName:"Trigger"}),this.actions.Transition.forEach((t=>{"Toggle"===t.data.runMode?t.toggle():t.play()})),this.actions.SwitchCamera.forEach((t=>{"Toggle"===t.data.runMode?t.toggle():t.play()})),this.actions.Link.forEach((t=>{t.dispatch()})),this.actions.Reset.forEach((t=>{t.dispatch()})),this.actions.Create.forEach((t=>{t.dispatch()})),this.actions.Destroy.forEach((t=>{t.dispatch(!1)})),this.actions.Audio.forEach((t=>{t.dispatchBasic()})),this.actions.Particles.forEach((t=>{t.dispatchBasic()})),this.actions.Video.forEach((t=>{t.dispatchBasic()})),this.actions.SceneTransition.forEach((t=>{t.dispatch()})),this.actions.SetVariable.forEach((t=>t.checkConditions())),this.actions.SetVariable.forEach((t=>t.dispatch())),this.actions.DynamicVariablePlay.forEach((t=>t.dispatch())),this.actions.ClearLocalStorage.forEach((t=>t.dispatch())),this.actions.UserAPI.forEach((t=>t.dispatch())))}};IT.then((t=>V1=t));var G1=new mm,H1=new fm,W1=new mm,q1=new eg(0,0,0,"YXZ"),Y1=new eg(0,0,0,"XYZ"),X1=new mm,Q1=new mm,K1=new mm(1,1,1),Z1=new fm,J1=new Wm,$1=new Wm,t2={type:"updateMatrix"},e2=new fm,i2=new Bm,n2={type:"beginEvent",eventName:"Collision"},r2={type:"beginEvent",eventName:"Trigger"};var s2=t=>t.states.some((t=>void 0!==t.data.position||void 0!==t.data.rotation||void 0!==t.data.hiddenMatrix||void 0!==t.data.cloner||void 0!==t.data.pathSnapping)),a2=class{constructor(t){this.eventContext=t,this.isEnabled=!1,this.gameControl=null,this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],entityToCollisionEvents:{},colliderToEntity:new Map,triggers:[],gamePads:[],createdObjects:[],nCreatedPerAction:{}},this.sensorToTriggerEvent={},this.eventManager=void 0,this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.collisionEvents=[],this.isExport=!1,this.processRigidBody=t=>{if(t.bodyType()!==V1.RigidBodyType.Dynamic)return;t.isSleeping()||this.nActiveRigidBodies++;let[e,i,n]=this.rigidBodyToMesh.get(t.handle);if(G1.copy(t.translation()).multiplyScalar(this.pixelsPerMeter),H1.copy(t.rotation()),e.matrixWorld.compose(G1,H1,i),e.hasNonUniformScale&&e.matrixWorld.multiply(e.shearScale),e.dispatchEvent(t2),n){let t=e.cloner;if(t&&void 0===t.objectForSample){t.matrixWorld.copy(e.matrixWorld);for(let e of t.children)e.updateMatrixWorld(!0)}for(let i of e.children)i.updateMatrixWorld(!0)}},this.accumulator=0,this.handleCollisionEvents=(t,e,i)=>{if(!1===i)return;let n,r;if(this.sensorToTriggerEvent[t]?(n=this.sensorToTriggerEvent[t],r=this.sharedGameControlGlobals.colliderToEntity.get(e)):this.sensorToTriggerEvent[e]&&(n=this.sensorToTriggerEvent[e],r=this.sharedGameControlGlobals.colliderToEntity.get(t)),n&&r&&n.isValidTriggeringObject(r))n.dispatch();else{for(let i=this.sharedGameControlGlobals.createdObjects.length-1;i>=0;i--){let n=this.sharedGameControlGlobals.createdObjects[i];if(n.userData.hasCollisionDestroy&&(n.rigidBody?.collider(0).handle===t||n.rigidBody?.collider(0).handle===e)){this.sharedGameControlGlobals.createdObjects.splice(i,1),n.removeFromParent(),requestAnimationFrame((()=>this.sharedGameControlGlobals.rapierWorld?.removeRigidBody(n.rigidBody)));break}}if(void 0!==this.gameControl?.object&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(t)){let t=this.sharedGameControlGlobals.colliderToEntity.get(e),i=this.sharedGameControlGlobals.entityToCollisionEvents[t.uuid];if(void 0===i)return;for(let n of i)"character"===n.data.target&&this.dispatchCollisionEvent(n,t,e)}else if(void 0!==this.gameControl?.object&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(e)){let e=this.sharedGameControlGlobals.colliderToEntity.get(t),i=this.sharedGameControlGlobals.entityToCollisionEvents[e.uuid];if(void 0===i)return;for(let n of i)"character"===n.data.target&&this.dispatchCollisionEvent(n,e,t)}else{let i=this.sharedGameControlGlobals.colliderToEntity.get(t),n=this.sharedGameControlGlobals.entityToCollisionEvents[i.uuid];if(void 0!==n)for(let e of n)"scene"===e.data.target&&this.dispatchCollisionEvent(e,i,t);let r=this.sharedGameControlGlobals.colliderToEntity.get(e),s=this.sharedGameControlGlobals.entityToCollisionEvents[r?.uuid];if(void 0!==s)for(let t of s)"scene"===t.data.target&&this.dispatchCollisionEvent(t,r,e)}}},this.isExport=t.isExport,this.sharedAssets=t.sharedAssets,this.renderer=t.renderer,this.requestRender=t.requestRender,this.domElement=this.renderer.domElement,this.pixelsPerMeter=200,this.gravity=this.page.data.globalPhysics.gravity}get page(){return this.eventContext.page}attachVRControllers(t){t.forEach((t=>{t.addEventListener("connected",(t=>{"gamepad"in t.data&&"axes"in t.data.gamepad&&this.sharedGameControlGlobals.gamePads.push(t.data.gamepad)}))}))}markIsDestroyTarget(){this.page.traverseVisibleEntity((t=>{let e=t.dataPatched;for(let i of e.events){if(!0===i.data.disabled)continue;let t=i.data.actions?.find((t=>"Destroy"===t.data.type))?.data;if(t)for(let e of t.objects){let t=this.page.scene.find(e);t&&(t.userData.hasDestroy=!0)}}}))}markIsDragObject(){this.page.traverseVisibleEntity((t=>{let e=t.dataPatched;for(let i of e.events)if(!0!==i.data.disabled&&"DragDrop"===i.data.type)for(let t of i.data.objects){let e=this.page.scene.find(t);e&&(e.userData.hasDrag=!0)}}))}initBVH(){let t=[];if(this.page.traverseChildren((e=>{let i;if(e instanceof hW||e instanceof HW||e instanceof AQ)return;i=e instanceof LB?e.object:e;let n=i.dataPatched;if("visibility"===n.physics?.enabled?!n.visible:!n.physics?.enabled)return!0;let r=e.geometry,s=!0===i.userData.hasDestroy,a=!0===i.userData.hasDrag;if(s2(n)||s||a||i.dataPatched.events.some((t=>!0!==t.data.disabled&&("GameControl"===t.data.type||"Follow"===t.data.type))))return e.updateMatrixWorldSVD(),this.addBoundsTree(e),!0;r&&t.push(z$(r,e.matrixWorld))})),t.length>0){let e=$O(t,!1);this.sharedGameControlGlobals.staticMeshBVH=new mB(e)}}addRigidBody(t,e,i){if(B$(t.matrixWorld))return;let n=[],r="geometry"in t?t.geometry:void 0,s=e.dataPatched;if(void 0!==r?.getAttribute("position")&&n.push(z$(r,t.shearScale)),s.physics.fusedBody){let e=this.gatherChildrenGeom(t,n);t.traverseObject(e),t.children.forEach((t=>t.updateMatrixWorld(!0)));let i=t.cloner;i&&void 0===i.objectForSample&&"dynamic"===s.physics.rigidBody&&(i.traverseObject(e),i.children.forEach((t=>t.updateMatrixWorld(!0))))}if(n.length>0){let o,l=!i.fromCreate&&"dynamic"===s.physics.rigidBody||i.fromCreate&&i.dynamic;l?(o=V1.RigidBodyDesc.dynamic(),o.setLinearDamping(s.physics.damping).setAngularDamping(s.physics.damping).setAdditionalMass(1e-9).setGravityScale(s.physics.gravityScale).enabledRotations(...s.physics.enabledRotation).enabledTranslations(...s.physics.enabledTranslation)):(i.hasTransformAnim||i.hasFollow||i.hasDrag)&&!i.fromCreate?(o=V1.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(t)):o=V1.RigidBodyDesc.fixed();let h=$O(n);(t.hasNonUniformScale?t.matrixWorldRigid:t.matrixWorld).decompose(G1,H1,W1),t.position0=G1.clone().divideScalar(this.pixelsPerMeter),t.rotation0=H1.clone(),G1.divideScalar(this.pixelsPerMeter),o.setTranslation(G1.x,G1.y,G1.z).setRotation(H1),r?h?.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter):h?.scale(W1.x/this.pixelsPerMeter,W1.y/this.pixelsPerMeter,W1.z/this.pixelsPerMeter);let c=this.sharedGameControlGlobals.rapierWorld.createRigidBody(o);l&&this.rigidBodyToMesh.set(c.handle,[t,W1.clone(),s.physics.fusedBody]);let u=!(void 0===s.geometry||"SubdivGeometry"===s.geometry.type||"NonParametricGeometry"===s.geometry.type||"BooleanGeometry"===s.geometry.type||"VectorGeometry"===s.geometry.type||"StarGeometry"===s.geometry.type||"RectangleGeometry"===s.geometry.type||"EllipseGeometry"===s.geometry.type||"TriangleGeometry"===s.geometry.type||"TorusGeometry"===s.geometry.type||"HelixGeometry"===s.geometry.type);try{this.addCollider(c,s.physics,h,e,u)}catch{try{this.addCollider(c,s.physics,h,e,!1)}catch(a){console.error(a)}}t.rigidBody=c}}addBoundsTree(t){let e=[];if(void 0!==t.geometry?.getAttribute("position")&&t.geometry?.getAttribute("position").count>0&&e.push(z$(t.geometry,t.shearScale)),t.traverseObject(this.gatherChildrenGeom(t,e)),t.children.forEach((t=>t.updateMatrixWorld(!0))),e.length>0){let i=$O(e,!1);t.bvhGeometry=i,i.getAttribute("position").count>0&&(t.bvhGeometry.boundsTree=new mB(i),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(t))}}addCollider(t,e,i,n){let r,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(0===i?.getAttribute("position").count||0===i?.getIndex()?.count)return;i&&(r="trimesh"===e.colliderType?V1.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array):V1.ColliderDesc.convexMesh(i.getAttribute("position").array,s?i.getIndex().array:void 0)),r.setFrictionCombineRule(V1.CoefficientCombineRule.Average).setRestitutionCombineRule(V1.CoefficientCombineRule.Average).setDensity(e.density).setFriction(e.friction).setRestitution(e.restitution);let a=this.sharedGameControlGlobals.rapierWorld.createCollider(r,t);this.sharedGameControlGlobals.colliderToEntity.set(a.handle,n),this.sharedGameControlGlobals.entityToCollisionEvents[n.uuid]?.some((t=>"scene"===t.target))&&a.setActiveEvents(V1.ActiveEvents.COLLISION_EVENTS)}gatherChildrenGeom(t,e){return(i,n)=>{if(0===n)return;let r;if(i instanceof hW){if(!i.objectForSample)return!0===i.object.dataPatched.physics.fusedBody&&"dynamic"===i.object.dataPatched.physics.rigidBody||void 0;if(i.objectForSample.dataPatched.physics.fusedBody)return;r=i.object}else if(i instanceof LB)r=i.object;else if(r=i,r.dataPatched.cloner?.hideBase)return!0;let s=r.dataPatched;if("visibility"===s.physics.enabled?!s.visible:!s.physics.enabled)return!0;1===n?t.hasNonUniformScale?i.matrixWorld.multiplyMatrices(t.shearScale,i.hiddenMatrix):i.matrixWorld.copy(i.hiddenMatrix):i.matrixWorld.multiplyMatrices(i.parent.matrixWorld,i.hiddenMatrix),i.matrixWorld.multiply(i.matrix);let a=i.geometry;void 0!==a?.getAttribute("position")&&e.push(z$(a,i.matrixWorld))}}activate(t){if(this.isEnabled)return;this.isEnabled=!0,this.eventManager=t,this.usePhysics=this.page.data.globalPhysics.usePhysics;let e=this.page.playCamera,i=!1,n=5,r=8,s=9,a="drag",o=this.page.data.publish.gameControlObject,l=null!==o?this.page.find(o):null,h=null;if(l)for(let d of l.data.events){if(d.data.disabled||"GameControl"!==d.data.type)continue;let t=l;for(;this.usePhysics&&null!==(t=t.parent)?.parent;)t.data.physics;d.data.collisionEnabled&&(this.needsCollisionDetection=!0),null===h&&(h=d.data)}if(this.page.traverseEntity((t=>{for(let e of t.dataPatched.events)if(!1===e.data.disabled&&"Trigger"===e.data.type)return this.needsCollisionDetection=!0,!0})),l&&h&&(!0===l.data.visible||!0===l.data.physics.enabled)){i=i||h.camera===e.uuid||l.uuid===e.uuid;let t=new O$(l,this.renderer.domElement,h,this.eventContext.page.data.globalPhysics,this,l.uuid!==e.uuid&&h.camera===e.uuid,e,this.page,this.sharedAssets);this.gameControl=t,n=h.joystickPosLoc,r=h.joystickRotLoc,s=h.jumpTouchButtonLoc,a=h.rotByTouch,cT&&h.touchControl&&(this.joystickToGameControls[n]="pos","walk"===h.moveMode&&(this.joystickToGameControls[s]="jmp"),"joystick"===a&&(this.joystickToGameControls[r]="rot"))}if(this.gameControl&&this.gameControl.data.navmesh.enabled){let t=this.gameControl.data;if(!this.navigationMeshWrapper){let e;this.navigationMeshWrapper=new x1(this.usePhysics,this.isExport),e="sphere"===t.collider.type?2*t.collider.radius:t.collider.height,e=Math.floor(e/t.navmesh.ch-1),this.navigationMeshWrapper.init({...t.navmesh,walkableHeight:e},this.gameControl,this.eventContext)}}if(!1===i){let{enableRotate:t,enablePan:i,enableZoom:n,autoRotate:r,hoverRotatePanMode:s}=this.eventManager.publish.orbitControls;(t||i||n||r||0!==s)&&(this.orbitControls=new F1(e,this.renderer.domElement,{isExport:this.isExport,isPlayMode:!0}),this.orbitControls.addEventListener("change",this.requestRender),this.orbitControls.addEventListener("end",this.requestRender),this.orbitControls.addEventListener("start",this.requestRender),this.orbitControls.fromJSON(this.eventManager.publish.orbitControls,this.eventManager.publish.mouseEventTarget),this.orbitControls.useKeyEvents=!1,this.orbitControls.addEventListenersToCamera(),this.orbitControls.connect(),this.orbitControls.update())}let c=this.renderer.domElement.width/this.renderer.getPixelRatio(),u=this.renderer.domElement.height/this.renderer.getPixelRatio();this.joystickToGameControls.forEach(((t,e)=>{let i=document.body.appendChild(document.createElement("div")),[n,r,s]=this.eventManager.eventContext.publish.joystickSizeAndXYOffset[e],a=(c-5*n)/4+n,o={},l="jmp"===t,h=l?0:n;e<10?(e<5?o.top=h/2:o.bottom=h/2,o.left=h/2+e%5*a):10===e?(o.left=h/2,o.top=u/2):(o.right=h/2,o.top=u/2),o.top?o.top-=r[1]:o.bottom+=r[1],o.left?o.left+=r[0]:o.right-=r[0];for(let c in o)o[c]+="px";if(l){let t=i.appendChild(document.createElement("div"));Object.assign(t.style,o,{position:"absolute",width:n+"px",height:n+"px",backgroundColor:`rgba(255,255,255,${"show"===s?.4:0})`,zIndex:"9999",borderRadius:n+"px",border:"show"===s?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"});let r=n/16*16*.4;return"show"===s&&(t.innerHTML=`\n\t\t\t\t\t\t<svg width="${r}" height="${.4*n}" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t\t<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t`),t.addEventListener("pointerdown",(()=>{this.gameControl.movementState.jump=1,this.requestRender()})),t.addEventListener("touchend",(t=>t.preventDefault())),void(this.joysticks[e]=[void 0,i])}let d={zone:i,mode:"static",position:o,size:n};"hide"===s&&(d.restOpacity=0);let p=UK(d);p.on("move",((e,i)=>{let n=this.gameControl;"pos"===t?i.force<.2?n.moveForce=0:(n.movementState.movePosZ=Math.sin(-i.angle.radian),n.movementState.movePosX=Math.cos(-i.angle.radian),i.force>1.2?n.movementState.run=1:n.movementState.run=0,i.force<.3?n.moveForce=(i.force-.2)/.1:n.moveForce=1):"rot"===t&&(i.force<.2?n.rotForce=0:(n.movementState.rotPosX=i.vector.y,n.movementState.rotPosY=-i.vector.x,i.force<.3?n.rotForce=(i.force-.2)/.1:n.rotForce=1)),this.requestRender()})),p.on("end",((e,i)=>{let n=this.gameControl;"pos"===t?(n.movementState.movePosZ=0,n.movementState.movePosX=0,n.moveForce=1):"rot"===t&&(n.movementState.rotPosX=0,n.movementState.rotPosY=0,n.rotForce=1)})),this.joysticks[e]=[p,i]})),this.markIsDestroyTarget(),this.markIsDragObject(),this.rebuildBVH(),this.initializationCounter++,window.setTimeout((()=>{this.collisionEvents.forEach((t=>t.initialDisabled=!1))}),80)}initPhysics(){this.sharedGameControlGlobals.rapierWorld?.free(),this.sharedGameControlGlobals.rapierWorld=new V1.World(new V1.Vector3(0,this.gravity,0)),this.events=new V1.EventQueue(!0);let t=[],e=[];if(this.page.traverseChildren((i=>{let n;if(i instanceof hW){if(!i.objectForSample)return!0===i.object.dataPatched.physics.fusedBody&&"dynamic"===i.object.dataPatched.physics.rigidBody||void 0;if(i.objectForSample.dataPatched.physics.fusedBody)return;n=i.object}else if(i instanceof LB)n=i.object;else{if(i instanceof AQ||i instanceof HW)return;if(n=i,!1===n.dataPatched.cloner?.disabled&&n.dataPatched.cloner?.hideBase&&!0!==n.dataPatched.physics?.fusedBody)return!0}let r,s=n.dataPatched;for(let t of s.events)!0!==t.data.disabled&&"GameControl"===t.data.type&&(r=t.data);if(!s.physics||("visibility"===s.physics.enabled?!s.visible:!s.physics.enabled))return!0;i.updateMatrixWorldSVD();let a=s2(s),o=!1,l=n.userData.hasDestroy,h=n.userData.hasDrag,c=!1;for(let t of s.events)if(!0!==t.data.disabled)if("Collision"===t.data.type){o=!0;let e=new u1(t.id,t.data,n,this.page,this.sharedAssets,this.eventManager);e.initialDisabled=!0,this.collisionEvents.push(e),this.sharedGameControlGlobals.entityToCollisionEvents[n.uuid]&&this.sharedGameControlGlobals.entityToCollisionEvents[n.uuid].every((e=>e.id!==t.id))?this.sharedGameControlGlobals.entityToCollisionEvents[n.uuid].push(e):this.sharedGameControlGlobals.entityToCollisionEvents[n.uuid]=[e]}else if("Follow"===t.data.type){c=!0;let e=t.data.target;i.traverseVisible((t=>{t.userData.isFollowingObj=e}))}"dynamic"===s.physics.rigidBody&&!1===s.physics.fusedBody&&(i.matrixWorldFusedFalse=i.matrixWorld.clone());let u=i.geometry;if(void 0!==r){let t=V1.RigidBodyDesc.kinematicPositionBased();(i.hasNonUniformScale?i.matrixWorldRigid:i.matrixWorld).decompose(G1,H1,W1),i.position0=G1.clone().divideScalar(this.pixelsPerMeter),i.rotation0=H1.clone(),G1.divideScalar(this.pixelsPerMeter),t.setTranslation(G1.x,G1.y,G1.z).setRotation(H1);let e,a=this.sharedGameControlGlobals.rapierWorld.createRigidBody(t);i.rigidBody=a,e="sphere"===r.collider.type?V1.ColliderDesc.ball(r.collider.radius/this.pixelsPerMeter):"capsule"===r.collider.type?V1.ColliderDesc.capsule((r.collider.height/2-r.collider.radius)/this.pixelsPerMeter,r.collider.radius/this.pixelsPerMeter):V1.ColliderDesc.cuboid(r.collider.width/this.pixelsPerMeter/2,r.collider.height/this.pixelsPerMeter/2,r.collider.depth/this.pixelsPerMeter/2),e.setFrictionCombineRule(V1.CoefficientCombineRule.Average).setRestitutionCombineRule(V1.CoefficientCombineRule.Average).setDensity(s.physics.density).setFriction(s.physics.friction).setRestitution(s.physics.restitution);let o=this.sharedGameControlGlobals.rapierWorld.createCollider(e,a);this.sharedGameControlGlobals.colliderToEntity.set(o.handle,n),G1.fromArray(r.collider.position).multiply(W1.setFromMatrixScale(n.matrixWorld)).divideScalar(this.pixelsPerMeter),o.setTranslationWrtParent(G1);let l=(new fm).setFromEuler((new eg).setFromVector3((new mm).fromArray(r.collider.rotation)));o.setRotationWrtParent(l),o.setActiveEvents(V1.ActiveEvents.COLLISION_EVENTS),this.generateSensorColliderDescs(n,!0)}else"dynamic"===s.physics.rigidBody||a||c||l||h||o?(this.addRigidBody(i,n,{hasFollow:c,hasTransformAnim:a,hasDrag:h}),this.generateSensorColliderDescs(n,s.physics.fusedBody)):(u&&t.push(z$(u,i.matrixWorld)),s.physics.fusedBody&&i.traverseObject(((e,i)=>{if(0===i)return;let n;if(e instanceof hW){if(!e.objectForSample)return!0===e.object.dataPatched.physics.fusedBody&&"dynamic"===e.object.dataPatched.physics.rigidBody||void 0;if(e.objectForSample.dataPatched.physics.fusedBody)return;n=e.object}else{if(e instanceof AQ||e instanceof HW)return;if(e instanceof LB)n=e.object;else if(n=e,n.dataPatched.cloner?.hideBase)return!0}let r=n.dataPatched;if("visibility"===r.physics.enabled?!r.visible:!r.physics.enabled)return!0;let s=e.geometry;void 0!==s?.getAttribute("position")&&t.push(z$(s,e.matrixWorld))})),this.generateSensorColliderDescs(n,s.physics.fusedBody,e));return!(!0!==s.physics?.fusedBody&&!r)||void 0})),0===t.length)return;let i=$O(t);i.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let n=V1.RigidBodyDesc.fixed(),r=this.sharedGameControlGlobals.rapierWorld.createRigidBody(n),s=V1.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array).setFrictionCombineRule(V1.CoefficientCombineRule.Multiply).setRestitutionCombineRule(V1.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(s,r);for(let[a,o]of e){let t=this.sharedGameControlGlobals.rapierWorld.createCollider(a,r);this.sensorToTriggerEvent[t.handle]=o}}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}rebuildBVH(){this.usePhysics?this.initPhysics():(this.page.traverseEntity((t=>{for(let e of t.dataPatched.events)if("Trigger"===e.data.type&&!0!==e.data.disabled){let i=new j1(e.id,e.data,t,this.page,this.sharedAssets,this.eventManager),n=(new Wm).compose(X1.fromArray(e.data.position),Z1.setFromEuler(Y1.fromArray(e.data.rotation)),K1);if("box"===e.data.triggerZone){let r=new ym;r.min.fromArray(e.data.size).multiplyScalar(-.5),r.max.fromArray(e.data.size).multiplyScalar(.5),this.sharedGameControlGlobals.triggers.push([r,n,t,i])}else this.sharedGameControlGlobals.triggers.push([e.data.radius,n,t,i])}})),this.needsCollisionDetection&&this.initBVH())}disconnectEvents(){this.collisionEvents.forEach((t=>t.disconnect())),this.sharedGameControlGlobals.triggers.forEach((t=>t[3].disconnect())),this.sharedGameControlGlobals.triggers.length=0}deactivate(){if(this.isEnabled){this.isEnabled=!1,this.page.traverse((t=>{let e=t;e.matrixWorldFusedFalse&&(e.matrixWorldFusedFalse=void 0),e.rigidBody&&(e.rigidBody=void 0),e.position0&&(e.position0=void 0),e.rotation0&&(e.rotation0=void 0)})),this.sharedGameControlGlobals.rapierWorld?.free(),this.sharedGameControlGlobals.rapierWorld=void 0,this.sharedGameControlGlobals.staticMeshBVH=void 0,this.accumulator=0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.disconnectEvents(),this.gameControl?.reset(),this.gameControl?.dispose(),this.gameControl=null,this.initializationCounter=-1,this.joysticks.forEach((t=>{let[e,i]=t;e?.destroy(),i.remove()})),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls&&(this.orbitControls.dispose(),this.orbitControls=void 0),this.navigationMeshWrapper?.dispose(),this.navigationMeshWrapper=void 0;for(let t of Object.values(this.sharedGameControlGlobals.entityToCollisionEvents))t.forEach((t=>t.disconnect()));this.sharedGameControlGlobals.entityToCollisionEvents={},this.page.updateMatrixWorld(!0)}}update(t,e,i){if(!this.isEnabled)return!0;let n=!0;if(void 0!==this.orbitControls&&this.orbitControls.needsUpdate&&(n=!this.orbitControls.update()),this.initializationCounter>=0&&this.initializationCounter<2?(this.initializationCounter++,n=!1):2===this.initializationCounter&&this.gameControl&&(n=!this.gameControl.update(t,e,i)&&n),!1===this.usePhysics&&this.checkTrigger(),this.usePhysics){let e=.016666666666666666;if(0===t)n=this.stepPhysics()&&n;else{let i=t/1e3;i<e&&i>.55*e&&(i=e),this.accumulator+=i;let r=performance.now(),s=0,a=6;for(;this.accumulator>=e&&s<a&&(n=this.stepPhysics()&&n,this.accumulator-=e,s++,!(performance.now()-r>1e3*e)););this.accumulator=this.accumulator%e}}return n}stepPhysics(){for(let t of this.sharedGameControlGlobals.entitiesWithTransformAnim){(t.hasNonUniformScale?t.matrixWorldRigid:t.matrixWorld).decompose(G1,H1,W1),q1.setFromQuaternion(H1);let e=t;void 0===e.prevR?(e.prevR=q1.clone(),e.prevT=G1.clone()):(e.prevR.copy(q1),e.prevT.copy(G1)),t.rigidBody&&(t.rigidBody.setNextKinematicTranslation(G1.divideScalar(this.pixelsPerMeter)),t.rigidBody.setNextKinematicRotation(H1))}return this.sharedGameControlGlobals.rapierWorld.step(this.events),this.events?.drainCollisionEvents(this.handleCollisionEvents),!this.updatePositions()}dispatchCollisionEvent(t,e,i){let n,r=(this.sharedGameControlGlobals.rapierWorld?.getCollider(i))._parent;if(e.cloner)for(let s of e.cloner.children)if(s.rigidBody===r){n=s;break}t.dispatch(n),e.dispatchEvent(n2)}updateUseWindowEvents(t){this.orbitControls?.updateUseWindowEvents(t)}generateSensorColliderDescs(t,e,i){let n=$1.copy(t.matrixWorld).invert();t.traverseEntity(((r,s)=>{if(!1===e&&1===s)return!0;for(let e of r.dataPatched.events)if("Trigger"===e.data.type&&!0!==e.data.disabled){let s,a=new j1(e.id,e.data,r,this.page,this.sharedAssets,this.eventManager);if(s="box"===e.data.triggerZone?V1.ColliderDesc.cuboid(...e.data.size.map((t=>t/(2*this.pixelsPerMeter)))):V1.ColliderDesc.ball(e.data.radius/this.pixelsPerMeter),s.setDensity(0).setSensor(!0).setActiveEvents(V1.ActiveEvents.COLLISION_EVENTS),X1.fromArray(e.data.position),Z1.setFromEuler(Y1.fromArray(e.data.rotation)),J1.compose(X1,Z1,K1).premultiply(r.matrixWorld),i?(J1.decompose(X1,Z1,Q1),s.setActiveCollisionTypes(V1.ActiveCollisionTypes.KINEMATIC_FIXED|V1.ActiveCollisionTypes.DYNAMIC_FIXED)):(J1.premultiply(n).decompose(X1,Z1,Q1),t.rigidBody.bodyType()===V1.RigidBodyType.Dynamic||(t.rigidBody.bodyType()===V1.RigidBodyType.Fixed?s.setActiveCollisionTypes(V1.ActiveCollisionTypes.KINEMATIC_FIXED|V1.ActiveCollisionTypes.DYNAMIC_FIXED):s.setActiveCollisionTypes(V1.ActiveCollisionTypes.KINEMATIC_KINEMATIC|V1.ActiveCollisionTypes.DYNAMIC_KINEMATIC))),X1.divideScalar(this.pixelsPerMeter),s.setTranslation(X1.x,X1.y,X1.z),s.setRotation(Z1),i)i.push([s,a]);else{let e=this.sharedGameControlGlobals.rapierWorld.createCollider(s,t.rigidBody);this.sensorToTriggerEvent[e.handle]=a}}}))}checkTrigger(){let t;for(let e=0;e<this.sharedGameControlGlobals.triggers.length;e++){let[i,n,r,s]=this.sharedGameControlGlobals.triggers[e];for(let e=0;e<this.sharedGameControlGlobals.entitiesWithTransformAnim.length;e++){let a=this.sharedGameControlGlobals.entitiesWithTransformAnim[e];if(r===a||!1===s.isValidTriggeringObject(IB.is(a)?a:a.object))continue;let o=$1.copy(r.matrixWorld).decompose(X1,e2,Q1).compose(X1,e2,K1).multiply(n),l=J1.copy(a.matrixWorld).invert().multiply(o);i instanceof ym?t=a.bvhGeometry.boundsTree.intersectsBox(i,l):(i2.radius=i,i2.center.setFromMatrixPosition(l),t=a.bvhGeometry.boundsTree.intersectsSphere(i2)),t?-1===s.currentIntersectedObjects.indexOf(a)&&(s.currentIntersectedObjects.push(a),s.dispatch(),r.dispatchEvent(r2)):s.currentIntersectedObjects=s.currentIntersectedObjects.filter((t=>t!==a))}}}};function o2(t){let e=this._clip.duration,i=this._clip.start??0,n=this.loop,r=this.time+t,s=this._loopCount,a=n===lf;if(0===t)return-1===s?r:a&&1===(1&s)?e-(r-i):r;if(2200===n){-1===s&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(r>=e)r=e;else{if(!(r<0)){this.time=r;break t}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===s&&(t>=0?(s=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),r>=e||r<i){let n=Math.floor((r-i)/(e-i));r-=(e-i)*n,s+=Math.abs(n);let o=this.repetitions-s;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,a||(r=t>0?e:i,1===this.repetitions&&(r=e)),this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){let e=t<0;this._setEndings(e,!e,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(a&&1===(1&s))return e-(r-i)}return r}var l2,h2=!1,c2=class{constructor(t,e,i,n){this.scene=t,this.requestRender=e,this.updateDisplayProgress=i,this.animationInspectorState=n,this.clipIdToAction={},this.activeClip=null,this.needsUpdate=!1,this.addClip=t=>{"Empty"===t.data.type&&t.data.animations&&t.data.animations.forEach(((e,i)=>{let n=e[0]+"/";if(Array.isArray(t.identity)?n+=t.identity[0]:n+=t.uuid,this.clipIdToAction[n])return;let r=eS.parse(JSON.parse(e[2]));t.animations[i]=r;let s=this.mixer.clipAction(r,t);!1===h2&&(Object.getPrototypeOf(s)._updateTime=o2,h2=!0),s.clampWhenFinished=!0,this.clipIdToAction[n]=s}))},this.mixer=new WS(t),this.scene.traverseEntity(this.addClip)}deleteClip(t,e){let i=this.scene.find(e);if(!i)return;let n=i.animations.find((e=>e.uuid===t));if(!n)return;let r=this.clipIdToAction[t];!r||(r.stop(),this.mixer.uncacheClip(n),delete this.clipIdToAction[t],i.animations=i.animations.filter((e=>e.uuid!==t)))}get isPlaying(){return Object.values(this.clipIdToAction).some((t=>t.isRunning()))}playFromInspector(t){this.mixer.stopAllAction();let e=this.clipIdToAction[t];!e||(e.play(),this.activeClip=e.getClip(),this.requestRender())}onExitPlayMode(){Object.values(this.clipIdToAction).forEach((t=>{t.repetitions=1/0,t.loop=2201})),this.mixer.stopAllAction(),this.requestRender()}play(t){let e=t.clipId+"/"+t.object,i=this.clipIdToAction[e];if(i)return t&&(t.repeat>=0&&(i.repetitions=t.repeat+1),"pingpong"===t.direction&&0!==t.repeat&&(i.loop=lf)),i.play(),i.paused=!1,this.requestRender(),i}resumeFromInspector(t){let e=this.clipIdToAction[t];!e||(e.play(),e.paused=!1,this.requestRender())}pauseFromInspector(t){let e=this.clipIdToAction[t];!e||(e.paused=!0)}stop(){this.mixer.stopAllAction(),this.requestRender()}update(t){if(this.needsUpdate)this.needsUpdate=!1;else if(!1===this.isPlaying||this.animationInspectorState?.isScrubbing)return;this.mixer.update(t/1e3),this.activeClip&&this.updateDisplayProgress(Math.round(this.mixer.time/this.activeClip.duration*(this.maxFrames-1)%(this.maxFrames-1))),this.requestRender()}get maxFrames(){return HJ(this.activeClip??void 0)}setProgressFromInspector(t,e){if(!this.clipIdToAction[e])return;this.activeClip!==this.clipIdToAction[e].getClip()&&this.playFromInspector(e);let i=this.clipIdToAction[e].paused;this.clipIdToAction[e].paused=!1,this.mixer.setTime(Math.min(t/(this.maxFrames-1),.9999)*this.activeClip.duration),this.requestRender(),i&&(this.clipIdToAction[e].paused=!0)}},u2=new WeakMap,d2=class extends aS{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,e,i,n){let r=new hS(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(t,(t=>{this.decodeDracoFile(t,e).catch(n)}),i,n)}decodeDracoFile(t,e,i,n){let r={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!i};return this.decodeGeometry(t,r).then(e)}decodeGeometry(t,e){let i=JSON.stringify(e);if(u2.has(t)){let e=u2.get(t);if(e.key===i)return e.promise;if(0===t.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n,r=this.workerNextTaskID++,s=t.byteLength,a=this._getWorker(r,s).then((i=>(n=i,new Promise(((i,s)=>{n._callbacks[r]={resolve:i,reject:s},n.postMessage({type:"decode",id:r,taskConfig:e,buffer:t},[t])}))))).then((t=>this._createGeometry(t.geometry)));return a.catch((()=>!0)).then((()=>{n&&r&&this._releaseTask(n,r)})),u2.set(t,{key:i,promise:a}),a}_createGeometry(t){let e=new Hg;t.index&&e.setIndex(new Rg(t.index.array,1));for(let i=0;i<t.attributes.length;i++){let n=t.attributes[i],r=n.name,s=n.array,a=n.itemSize;e.setAttribute(r,new Rg(s,a))}return e}_loadLibrary(t,e){let i=new hS(this.manager);return i.setPath(this.decoderPath),i.setResponseType(e),i.setWithCredentials(this.withCredentials),new Promise(((e,n)=>{i.load(t,e,void 0,n)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let t="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,e=[];return t?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then((e=>{let i=e[0];t||(this.decoderConfig.wasmBinary=e[1]);let n=p2.toString(),r=["/* draco decoder */",i,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r]))})),this.decoderPending}_getWorker(t,e){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){let t=new Worker(this.workerSourceURL);t._callbacks={},t._taskCosts={},t._taskLoad=0,t.postMessage({type:"init",decoderConfig:this.decoderConfig}),t.onmessage=function(e){let i=e.data;switch(i.type){case"decode":t._callbacks[i.id].resolve(i);break;case"error":t._callbacks[i.id].reject(i);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+i.type+'"')}},this.workerPool.push(t)}else this.workerPool.sort((function(t,e){return t._taskLoad>e._taskLoad?-1:1}));let i=this.workerPool[this.workerPool.length-1];return i._taskCosts[t]=e,i._taskLoad+=e,i}))}_releaseTask(t,e){t._taskLoad-=t._taskCosts[e],delete t._callbacks[e],delete t._taskCosts[e]}debug(){console.log("Task load: ",this.workerPool.map((t=>t._taskLoad)))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}};function p2(){let t,e;function i(t,e,i,n,r,s){let a=s.num_components(),o=i.num_points()*a,l=o*r.BYTES_PER_ELEMENT,h=function(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32}}(t,r),c=t._malloc(l);e.GetAttributeDataArrayForAllPoints(i,s,h,l,c);let u=new r(t.HEAPF32.buffer,c,o).slice();return t._free(c),{name:n,array:u,itemSize:a}}onmessage=function(n){let r=n.data;switch(r.type){case"init":t=r.decoderConfig,e=new Promise((function(e){t.onModuleLoaded=function(t){e({draco:t})},DracoDecoderModule(t)}));break;case"decode":let n=r.buffer,s=r.taskConfig;e.then((t=>{let e=t.draco,a=new e.Decoder,o=new e.DecoderBuffer;o.Init(new Int8Array(n),n.byteLength);try{let t=function(t,e,n,r){let s,a,o=r.attributeIDs,l=r.attributeTypes,h=e.GetEncodedGeometryType(n);if(h===t.TRIANGULAR_MESH)s=new t.Mesh,a=e.DecodeBufferToMesh(n,s);else{if(h!==t.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");s=new t.PointCloud,a=e.DecodeBufferToPointCloud(n,s)}if(!a.ok()||0===s.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+a.error_msg());let c={index:null,attributes:[]};for(let u in o){let n,a,h=self[l[u]];if(r.useUniqueIDs)a=o[u],n=e.GetAttributeByUniqueId(s,a);else{if(a=e.GetAttributeId(s,t[o[u]]),-1===a)continue;n=e.GetAttribute(s,a)}c.attributes.push(i(t,e,s,u,h,n))}return h===t.TRIANGULAR_MESH&&(c.index=function(t,e,i){let n=3*i.num_faces(),r=4*n,s=t._malloc(r);e.GetTrianglesUInt32Array(i,r,s);let a=new Uint32Array(t.HEAPF32.buffer,s,n).slice();return t._free(s),{array:a,itemSize:1}}(t,e,s)),t.destroy(s),c}(e,a,o,s),n=t.attributes.map((t=>t.array.buffer));t.index&&n.push(t.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:t},n)}catch(l){console.error(l),self.postMessage({type:"error",id:r.id,error:l.message})}finally{e.destroy(o),e.destroy(a)}}))}}}async function f2(t){if(l2){let e,i={attributeIDs:l2.defaultAttributeIDs,attributeTypes:l2.defaultAttributeTypes,useUniqueIDs:!1};try{e=await l2.decodeGeometry(new Int8Array(t).buffer,i)}catch(YT){console.error(YT)}if(e)return{index:e.index?{array:e.index.array}:void 0,attributes:Object.entries(e.attributes).map((t=>{let[e,i]=t;return{name:e,itemSize:i.itemSize,array:i.array}}))}}return null}var m2=class{constructor(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0],this._delay=500,this._distance=2,this._onMouseDown=t=>{let e=[t.clientX,t.clientY],i=(new Date).getTime();if(this._clickCount>0){let t=e[0]-this._lastPosition[0],i=e[1]-this._lastPosition[1];Math.sqrt(t*t+i*i)>this._distance&&(this._clickCount=0)}this._lastPosition=e,this._clickCount=i-this._lastTime>this._delay?1:this._clickCount+1,this._lastTime=i},this._onMouseUp=t=>{}}start(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this._target&&this.stop(),this.reset(),this._delay=e,this._distance=i,this._target=t,this._target.addEventListener("pointerdown",this._onMouseDown,!1),this._target.addEventListener("pointerup",this._onMouseUp,!1)}stop(){this._target&&(this._target.removeEventListener("pointerdown",this._onMouseDown,!1),this._target.removeEventListener("pointerup",this._onMouseUp,!1),this._target=void 0)}get clickCount(){return this._clickCount}reset(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0]}},g2=class{constructor(t,e,i,n,r,s,a,o){this.eventId=t,this.id=e,this.data=i,this.dataEvent=n,this.object=r,this.stage=!1,this.actions=JJ(n,i.actions,s,a,o,r)}disconnect(){$J(this.actions)}dispatchIn(){this.actions.Audio.forEach((t=>t.dispatchBasic())),this.actions.Particles.forEach((t=>t.dispatchBasic())),this.actions.Video.forEach((t=>t.dispatchBasic())),this.actions.Create.forEach((t=>t.dispatch())),this.actions.Destroy.forEach((t=>t.dispatch())),this.actions.Reset.forEach((t=>t.dispatch())),this.actions.Link.forEach((t=>t.dispatch())),this.actions.Transition.forEach((t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())})),this.actions.Transition.forEach((t=>t.toggle())),this.actions.Animation.forEach((t=>t.play())),this.actions.SwitchCamera.forEach((t=>t.play())),this.actions.SceneTransition.forEach((t=>t.dispatch())),this.actions.SetVariable.forEach((t=>t.checkConditions())),this.actions.SetVariable.forEach((t=>t.dispatch())),this.actions.DynamicVariablePlay.forEach((t=>t.dispatch())),this.actions.ClearLocalStorage.forEach((t=>t.dispatch())),this.actions.UserAPI.forEach((t=>t.dispatch()))}dispatchOut(){this.actions.Transition.forEach((t=>{t.toggle()}))}},v2=class extends J${constructor(t,e){super(t),this.eventManager=e,this.breakpoints=[],this.resize=(t,e)=>{this.breakpoints.forEach((i=>{let n,r=mI.deviceToSize(i.data.size),s="horizontal"===i.dataEvent.orientation?t:e;switch(i.data.operator){case"<":n=s<r[0];break;case">":n=s>r[0];break;case"<>":n=s>r[0]&&s<r[1]}i.stage!==n&&(i.stage=n,i.stage?i.dispatchIn():i.dispatchOut())}))},this.onResizeObserver=new ResizeObserver((t=>{for(let e of t){let{width:t,height:i}=e.contentRect;this.resize(t,i)}}))}connect(){let{page:t,sharedAssets:e,domElement:i}=this.eventContext;this.onResizeObserver.observe(i);let n=i=>{if(i.visible&&i.data?.events.length)for(let{data:n,id:r}of i.data.events)n.disabled||"Resize"===n.type&&n.breakpoints.forEach((s=>{let{data:a,id:o}=s;try{let s=new g2(r,o,a,n,i,t,e,this.eventManager);this.breakpoints.push(s)}catch(kI){}}))};t.traverseEntity((t=>{(t instanceof cQ||t instanceof tQ)&&t.frame?.traverse((t=>{n(t)})),n(t)}))}disconnect(){this.onResizeObserver.disconnect(),this.breakpoints.forEach((t=>{t.disconnect()})),this.breakpoints=[]}},y2=class extends J${constructor(t,e){super(t),this.eventManager=e,this.userAPIs={},this.events=[],this.onSuccess=t=>{let{userAPIId:e}=t;this.events.forEach((t=>{t.data.userAPIId===e&&t.dispatchSuccess()}))},this.onError=t=>{let{userAPIId:e}=t;this.events.forEach((t=>{t.data.userAPIId===e&&t.dispatchError()}))},this.userAPIs=t.sharedAssets.getUserAPIs()}connect(){this.eventContext.page.traverseEntity((t=>{t.data?.events.filter((t=>"API"===t.data.type&&!t.data.disabled)).forEach((e=>{this.events.push(new b2(e.id,e.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))}))})),Object.entries(this.userAPIs).forEach((t=>{let[e,i]=t;i.on("success",this.onSuccess),i.on("error",this.onError),i.autostart&&i.callUserAPI(this.eventContext.sharedAssets)}))}disconnect(){Object.entries(this.userAPIs).forEach((t=>{let[e,i]=t;i.off("success",this.onSuccess),i.off("error",this.onError)}))}},b2=class{constructor(t,e,i,n,r,s){this.id=t,this.data=e,this.object=i,this.successActions=JJ(e,e.successActions,n,r,s,i),this.errorActions=JJ(e,e.errorActions,n,r,s,i)}dispatchSuccess(){this.dispatchActions(this.successActions)}dispatchError(){this.dispatchActions(this.errorActions)}dispatchActions(t){t.Audio.forEach((t=>t.dispatchConditional())),t.Particles.forEach((t=>t.dispatchConditional())),t.Video.forEach((t=>t.dispatchConditional())),t.Create.forEach((t=>t.dispatch())),t.Destroy.forEach((t=>t.dispatch())),t.Reset.forEach((t=>t.dispatch())),t.Transition.forEach((t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()})),t.Transition.forEach((t=>t.play())),t.Animation.forEach((t=>t.play())),t.SwitchCamera.forEach((t=>t.play())),t.SceneTransition.forEach((t=>t.dispatch())),t.SetVariable.forEach((t=>t.checkConditions())),t.SetVariable.forEach((t=>t.dispatch())),t.DynamicVariablePlay.forEach((t=>t.dispatch())),t.ClearLocalStorage.forEach((t=>t.dispatch())),t.UserAPI.forEach((t=>t.dispatch()))}},x2=class extends J${constructor(t,e){super(t),this.eventManager=e,this.userWebhooks={},this.events=[],this.onMessage=t=>{let{userWebhookId:e}=t;this.events.forEach((t=>{t.data.userWebhookId===e&&t.dispatch()}))},this.userWebhooks=t.sharedAssets.getUserWebhooks()}connect(){this.eventContext.page.traverseEntity((t=>{t.data?.events.filter((t=>"WEBHOOK"===t.data.type&&!t.data.disabled)).forEach((e=>{this.events.push(new w2(e.id,e.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))}))})),Object.entries(this.userWebhooks).forEach((t=>{let[e,i]=t;i.connect(),i.on("message",this.onMessage)}))}disconnect(){Object.entries(this.userWebhooks).forEach((t=>{let[e,i]=t;i.off("message",this.onMessage),i.disconnect()}))}},w2=class{constructor(t,e,i,n,r,s){this.id=t,this.data=e,this.object=i,this.actions=JJ(e,e.actions,n,r,s,i)}dispatch(){let t=this.actions;t.Audio.forEach((t=>t.dispatchConditional())),t.Particles.forEach((t=>t.dispatchConditional())),t.Video.forEach((t=>t.dispatchConditional())),t.Create.forEach((t=>t.dispatch())),t.Destroy.forEach((t=>t.dispatch())),t.Reset.forEach((t=>t.dispatch())),t.Transition.forEach((t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()})),t.Transition.forEach((t=>t.play())),t.Animation.forEach((t=>t.play())),t.SwitchCamera.forEach((t=>t.play())),t.SceneTransition.forEach((t=>t.dispatch())),t.SetVariable.forEach((t=>t.checkConditions())),t.SetVariable.forEach((t=>t.dispatch())),t.DynamicVariablePlay.forEach((t=>t.dispatch())),t.ClearLocalStorage.forEach((t=>t.dispatch())),t.UserAPI.forEach((t=>t.dispatch()))}};var S2=new mm(0,0,1),A2=new mm,E2=new mm,_2=new Vf,C2=class{constructor(t,e,i,n,r){this.containerScene=t,this.raycaster=e,this.sharedAssets=i,this.requestRender=n,this.onExit=r,this.htmlInput=null,this.virtualInput=null,this.helper=new HY,this.doubleClickHandler=new m2,this.isDragging=!1,this.plane=new wv,this.caretInterval=0,this.planeIntersection=new mm,this.projected=new Uf,this._lastIndex=0,this._isFirstDragMove=!1,this.selectionOnDragStart=0,this.onTextMaterialChanged=()=>{let t=this.virtualInput?.data;if(void 0!==this.virtualInput&&t){let e=t.material,i=function(t,e){let i=DI.fromHex(3223857),n=.8;for(let r of t.layers){if("light"===r.data.type||"displace"===r.data.type||"fresnel"===r.data.type||"matcap"===r.data.type||"texture"===r.data.type||"toon"===r.data.type||"outline"===r.data.type||"transmission"===r.data.type||"noise"===r.data.type)continue;let t="string"==typeof r.data.alpha?Number(e.getVariable(r.data.alpha)):r.data.alpha;if("color"===r.data.type&&t>.3){i=YY(r.data.color,e),n=t;break}if(("depth"===r.data.type||"gradient"===r.data.type)&&t>.3){let t=XY(r.data);i={r:t[0],g:t[1],b:t[2]},n="string"==typeof r.data.alpha?1:r.data.alpha;break}}return{...i,a:n}}("string"==typeof e?this.sharedAssets.data.materials[e]:e,this.sharedAssets);this.helper.setCaretColor(i)}},this.stopAnimateTextCursor=()=>{clearInterval(this.caretInterval),this.helper&&(this.helper.caretMesh.visible=!1)},this.startAnimateTextCursor=()=>{this.stopAnimateTextCursor(),this.helper&&(this.helper.caretMesh.visible=!0,this.caretInterval=setInterval((()=>{this.helper&&(this.helper.caretMesh.visible=!this.helper.caretMesh.visible),this.requestRender()}),600))},this.handleCaretUpdate=t=>{if(!this.htmlInput||!this.virtualInput)return;let e=this.helper,i="ArrowLeft"===t?.key||"ArrowRight"===t?.key,n="ArrowUp"===t?.key||"ArrowDown"===t?.key;this.htmlInput.selectionStart===this.htmlInput.selectionEnd?(e.setCaretPosition(this.htmlInput.selectionStart,{horizontalKeyMove:i,verticalKeyMove:n}),this.startAnimateTextCursor()):e.setSelection(this.htmlInput.selectionStart,this.htmlInput.selectionEnd),this.requestRender()},this.containerScene.add(this.helper)}createInput(){return this.htmlInput=function(){let t=document.createElement("textarea");return t.style.position="fixed",t.style.top="200px",t.style.left="400px",t.style.zIndex="-1",t.style.border="1px solid rgba(255,0,0,0.5)",t.style.width="10px",t.style.height="500px",t.style.color="white",t.style.opacity="0.5",t.style.background="transparent",t.style.display="none",t.style.margin="0px",t.style.padding="0px",t.style.boxSizing="content-box",t.style.pointerEvents="none",t}(),this.htmlInput}connect(){}disconnect(){this.stopAnimateTextCursor(),this.helper.hide(),this.htmlInput?.remove(),this.doubleClickHandler.stop()}handleMouseDown(){if(!this.htmlInput||!this.virtualInput)return!0;this.getPointOnPlane();let t=this.doubleClickHandler.clickCount,{index:e,lineIndex:i,characterIndex:n}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,t>1?"inside":"previous")??{index:0,lineIndex:0,characterIndex:0};this.virtualInput?.wrappedText?.length&&"\n"===this.virtualInput.wrappedText[i][Math.max(0,n-1)]&&(e--,n--),this._lastIndex=e,this._isFirstDragMove=!0;let r=this.checkClickedObject();if(1===t){if(null===r)return this.onExit(this.virtualInput),!0;this.selectionOnDragStart=e,this.isDragging=!0,this.setInputSelection(e)}else r===this.virtualInput&&(2===t?this.selectClosestWord(i,n):t>2&&(this.setInputSelection(0,this.htmlInput.value.length),this.doubleClickHandler.reset()))}handleMouseUp(){this.applyRangeToTextInput(),this.isDragging=!1,this._isFirstDragMove=!1}handleMouseMove(){!this.virtualInput||(this._isFirstDragMove&&this.doubleClickHandler.clickCount>1&&(this.selectionOnDragStart=this._lastIndex,this.isDragging=!0,this.setInputSelection(this._lastIndex)),this._isFirstDragMove=!1,this.getPointOnPlane(),this.applyRangeToTextInput())}focus(t){if(this.virtualInput=t,this.updateTextInputStyles(),this.htmlInput)if(t){let t=this.data?.geometry.text;this.htmlInput.value="string"==typeof t?"":t?.textValue.toString()??""}else this.htmlInput.value=""}blur(){}get data(){let{virtualInput:t}=this;if(t)return t.dataPatched}applyRangeToTextInput(){if(!this.isDragging||!this.virtualInput||!this.htmlInput)return;let t=this.selectionOnDragStart,{index:e,lineIndex:i,characterIndex:n}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,this.doubleClickHandler.clickCount>2?"inside":"previous")??{index:0};void 0!==i&&void 0!==n&&"\n"===this.virtualInput?.wrappedText[i][n-1]&&e--,this.htmlInput.setSelectionRange(Math.min(t,e),Math.max(t,e))}checkClickedObject(){if(this.virtualInput){let t=this.raycaster.intersectObject(this.virtualInput,!1);if(t.length>0){let e=t[0];if(e.object instanceof rQ)return e.object}}return null}selectClosestWord(t,e){if(!this.virtualInput)return;let i=this.virtualInput.wrappedText,n=i[t],r=e+1,s=e;" "!==n[e]&&(r=this.findNextCharOccurence(n,e,"forward"," "),s=this.findNextCharOccurence(n,e,"backward"," "),s>0&&s++,r>=n.length-1&&t===i.length-1&&r++);let a=this.helper,o=a.getGlobalIndexFromLineAndCharIndexes(i,t,s),l=a.getGlobalIndexFromLineAndCharIndexes(i,t,r);this.setInputSelection(o,l)}findNextCharOccurence(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:" ",r=Math.max(0,t.length-1),s="forward"===i?r:0,a="forward"===i?1:-1,o=Math.max(Math.min(e,r),0);for(;o!==s;)if(o+=a,t.charAt(o)===n)return o;return s}getPointOnPlane(){let t=this.virtualInput?.data;if(this.virtualInput&&t&&this.raycaster.ray.intersectsPlane(this.plane)){null===this.planeIntersection&&(this.planeIntersection=new mm);let e=this.raycaster.ray.intersectPlane(this.plane,this.planeIntersection);if(e){this.planeIntersection.copy(this.virtualInput.worldToLocal(e));let i="number"==typeof t.geometry.width?t.geometry.width:1,n="number"==typeof t.geometry.height?t.geometry.height:1;this.projected.set(e.x+.5*i,e.y-.5*n)}}}updatePlane(){let t=this.virtualInput?.data;this.virtualInput&&t&&(_2.getNormalMatrix(this.virtualInput.matrixWorld),A2.copy(S2).applyMatrix3(_2).normalize(),this.virtualInput.localToWorld(E2.set(0,0,t.geometry.depth)),this.plane.setFromNormalAndCoplanarPoint(A2,E2))}setInputSelection(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;this.htmlInput?.setSelectionRange(t,e),setTimeout((()=>{this.htmlInput?.focus()}))}updateTextInputStyles(){let t=this.virtualInput?.data;this.virtualInput&&t&&this.htmlInput&&(this.htmlInput.style.fontSize=t.geometry.fontSize+"px",this.htmlInput.style.letterSpacing=t.geometry.letterSpacing*t.geometry.fontSize+"px",this.htmlInput.style.lineHeight=t.geometry.fontSize*t.geometry.lineHeight+"px",this.htmlInput.style.width=t.geometry.width+"px",this.htmlInput.style.height=t.geometry.height+"px",this.htmlInput.style.textAlign=function(t){return 4===t?"justify":2===t?"right":3===t?"center":"left"}(t.geometry.horizontalAlign))}};var M2=(t,e)=>{if("string"==typeof t){let i=e.data(t);if(i)return M2(i.value,e)}return nO.getDisplayedValue(t)};function P2(t,e){let i=t.text,n="";if("string"==typeof i){let t=e.variables.data(n);t&&(n=M2(t.value,e.variables))}else n=i.textValue.toString();return n}var T2=class extends J${constructor(t,e){super(t),this.eventManager=e,this._textInputs=[],this.sceneHelpers=new sx,this.helper=new HY,this._onMouseDownFocusIn=t=>{if(gT.length>1)return;this.eventContext.updateRaycaster(t);let e=null;if(this.eventContext.raycaster)for(let i of this._textInputs)if(this.eventContext.raycaster.intersectObject(i,!0).length>0){e=i;break}this.focusOnTextInput(e),this._onCaretUpdate(),this._onMouseUp(),this.textInputManager.doubleClickHandler.start(this.eventContext.domElement),this.textInputManager.doubleClickHandler._onMouseDown(t),this._onMouseDown(t)},this.onExit=()=>{let{virtualInput:t}=this.textInputManager;if(null===t)return;let e=this.textInputManager.htmlInput;this.helper.hide(),e?.setSelectionRange(e.value.length,e.value.length),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0);let{domElement:i}=this.eventContext;i.removeEventListener("pointerdown",this._onMouseDown,!1),i.removeEventListener("pointerup",this._onMouseUp,!1),i.removeEventListener("pointermove",this._onMouseMove,!1),window.removeEventListener("keydown",this._onKeyPress),this.textInputManager.doubleClickHandler.reset(),i.addEventListener("pointerdown",this._onMouseDownFocusIn),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers()},this._onMouseDown=t=>{this.eventContext.updateRaycaster(t),this.textInputManager.handleMouseDown(),this.textInputManager.virtualInput&&this.eventContext.raycaster.intersectObject(this.textInputManager.virtualInput,!0).length>0&&this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1)},this._onMouseUp=()=>{this.textInputManager.handleMouseUp(),this.eventManager.controlsManager.orbitControls&&!this.eventManager.controlsManager.orbitControls.enabled&&(this.eventManager.controlsManager.orbitControls.enabled=!0)},this._onMouseMove=t=>{this.eventContext.updateRaycaster(t),this.textInputManager.handleMouseMove()},this._onTextEdit=t=>{let{htmlInput:e,virtualInput:i,helper:n}=this.textInputManager;if(!e||!i)return;let r=e.value;i.textGeometry.setText(r).then((()=>{this.eventContext.requestRender()}));let s=i.data;n.update();let a=s.geometry.text;if("string"==typeof a){let t=a;this.eventContext.sharedAssets.updateVariable(t,{textValue:r})}this.textInputManager.updateTextInputStyles(),this._onCaretUpdate()},this._onCaretUpdate=t=>{this.textInputManager.handleCaretUpdate(t)},this._onKeyPress=t=>{"Escape"===t.key&&this.onExit()},this.textInputManager=new C2(this.sceneHelpers,t.raycaster,t.sharedAssets,t.requestRender,this.onExit)}connect(){let t=[];if(this.eventContext.scene.traverseEntity((e=>{e instanceof rQ&&t.push(e)})),this._textInputs=t,0===t.length)return;let{domElement:e}=this.eventContext;e.addEventListener("pointerdown",this._onMouseDownFocusIn),this.textInputManager.connect();let i=this.textInputManager.createInput();document.body.appendChild(i),i.style.display="none",i.addEventListener("keyup",this._onCaretUpdate),i.addEventListener("keydown",this._onCaretUpdate),i.addEventListener("beforeinput",this._onCaretUpdate),i.addEventListener("paste",this._onCaretUpdate),i.addEventListener("cut",this._onCaretUpdate),i.addEventListener("select",this._onCaretUpdate),i.addEventListener("selectstart",this._onCaretUpdate)}disconnect(){let t=this.textInputManager.htmlInput,{domElement:e}=this.eventContext;e.removeEventListener("pointerdown",this._onMouseDownFocusIn),t?.removeEventListener("keyup",this._onCaretUpdate),t?.removeEventListener("keydown",this._onCaretUpdate),t?.removeEventListener("beforeinput",this._onCaretUpdate),t?.removeEventListener("paste",this._onCaretUpdate),t?.removeEventListener("cut",this._onCaretUpdate),t?.removeEventListener("select",this._onCaretUpdate),t?.removeEventListener("selectstart",this._onCaretUpdate),this._textInputs.forEach((t=>{let e=P2(t.data.geometry,this.eventContext.sharedAssets.data);t.textGeometry.setText(e)})),e.removeEventListener("pointerdown",this._onMouseDown,!1),e.removeEventListener("pointerup",this._onMouseUp,!1),e.removeEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers(),this.textInputManager.disconnect()}focusOnTextInput(t){this.textInputManager.focus(t),this.textInputManager.onTextMaterialChanged();let e=this.textInputManager.htmlInput;if(!e||null===t)return;this.textInputManager.updateTextInputStyles(),this.eventContext.renderer.sceneHelpersOnTop=this.sceneHelpers,this.eventContext.renderer.pipeline.enableHelpers(),this.textInputManager.isDragging=!1;let i=P2(t.textGeometry.userData.parameters,this.eventContext.sharedAssets.data);e.value=i,e.setSelectionRange(0,0),this.textInputManager.helper.show(t),e.style.display="block",e.addEventListener("input",this._onTextEdit),this.textInputManager.updatePlane();let{domElement:n}=this.eventContext;n.removeEventListener("pointerdown",this._onMouseDownFocusIn),n.addEventListener("pointerdown",this._onMouseDown,!1),n.addEventListener("pointerup",this._onMouseUp,!1),n.addEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress)}},D2=class extends J${constructor(t,e){super(t),this.eventManager=e,this.events=[],this.onVoice=t=>{let{value:e,frequencies:i}=t;this.events.forEach((t=>{t.dispatch()}))}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity((t=>{t.data?.events.filter((t=>"AIAssistantListener"===t.data.type&&!t.data.disabled)).forEach((e=>{this.events.push(new k2(e.id,e.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))}))})),this.openAIRealtime.on("voice",this.onVoice))}disconnect(){this.openAIRealtime?.off("voice",this.onVoice)}},k2=class{constructor(t,e,i,n,r,s){this.id=t,this.data=e,this.object=i,this.actions=JJ(e,e.actions,n,r,s,i)}dispatch(){this.dispatchActions(this.actions)}dispatchActions(t){t.Audio.forEach((t=>t.dispatchConditional())),t.Particles.forEach((t=>t.dispatchConditional())),t.Video.forEach((t=>t.dispatchConditional())),t.Create.forEach((t=>t.dispatch())),t.Destroy.forEach((t=>t.dispatch())),t.Reset.forEach((t=>t.dispatch())),t.Transition.forEach((t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()})),t.Transition.forEach((t=>t.play())),t.Animation.forEach((t=>t.play())),t.SwitchCamera.forEach((t=>t.play())),t.SceneTransition.forEach((t=>t.dispatch())),t.SetVariable.forEach((t=>t.checkConditions())),t.SetVariable.forEach((t=>t.dispatch())),t.DynamicVariablePlay.forEach((t=>t.dispatch())),t.ClearLocalStorage.forEach((t=>t.dispatch())),t.UserAPI.forEach((t=>t.dispatch()))}},I2=class extends J${constructor(t,e){super(t),this.eventManager=e,this.events=[],this.onTriggerEvent=t=>{let{description:e,direction:i}=t,n=this.events.find((t=>t.data.description===e));n&&("backward"===i?n.dispatchReverse():n.dispatch())}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity((t=>{t.data?.events.filter((t=>"AIAssistantTrigger"===t.data.type&&!t.data.disabled)).forEach((e=>{this.events.push(new R2(e.id,e.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))}))})),this.openAIRealtime.on("trigger_event",this.onTriggerEvent))}disconnect(){this.openAIRealtime?.off("trigger_event",this.onTriggerEvent)}},R2=class{constructor(t,e,i,n,r,s){this.id=t,this.data=e,this.object=i,this.actions=JJ(e,e.actions,n,r,s,i)}dispatch(){let t=this.actions;t.Audio.forEach((t=>t.dispatchConditional())),t.Particles.forEach((t=>t.dispatchConditional())),t.Video.forEach((t=>t.dispatchConditional())),t.Create.forEach((t=>t.dispatch())),t.Destroy.forEach((t=>t.dispatch())),t.Reset.forEach((t=>t.dispatch())),t.Transition.forEach((t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()})),t.Transition.forEach((t=>t.play())),t.Animation.forEach((t=>t.play())),t.SwitchCamera.forEach((t=>t.play())),t.SceneTransition.forEach((t=>t.dispatch())),t.SetVariable.forEach((t=>t.checkConditions())),t.SetVariable.forEach((t=>t.dispatch())),t.DynamicVariablePlay.forEach((t=>t.dispatch())),t.ClearLocalStorage.forEach((t=>t.dispatch())),t.UserAPI.forEach((t=>t.dispatch()))}dispatchReverse(){let t=this.actions;t.Transition.forEach((t=>t.reverseFromCurrent())),t.Particles.forEach((t=>t.reverseFromCurrent())),t.Animation.forEach((t=>t.reverseFromCurrent())),t.SwitchCamera.forEach((t=>t.reverseFromCurrent())),t.Create.forEach((t=>t.dispatchStop()))}},O2=class{constructor(t,e,i,n,r){this.publish=t,this.controlsManager=e,this.animationControls=i,this.eventContext=n,this.sharedVariables=r,this.isEnabled=!1,this.activateCount=0,this.needsMouse=!1,this.needsRaycast=!1,this.onTouchMovePreventScroll=t=>{let e=window.parent!==window,i=document.documentElement.scrollHeight>document.documentElement.clientHeight||document.documentElement.scrollWidth>document.documentElement.clientWidth;(t.touches.length>1||this.preventTouchScroll||!1===e&&!1===i)&&t.preventDefault()},this.onMouseWheelPreventScroll=t=>{this.preventScroll&&t.preventDefault()},this.onMouseMove=t=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(t),pressed:t.buttons>0}},this.onMouseDown=t=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(t),pressed:!0}},this.onMouseUp=t=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(t),pressed:!1}},this.getMousePosition=t=>{let{domRect:e}=this.eventContext,{pageX:i,pageY:n}=t.touches?.length>0?t.touches[0]:t;return{x:i-(e.left+window.scrollX),y:n-(e.top+window.scrollY)}},this.stopRaycast=t.stopRaycast,this.preventScroll=t.preventScroll,this.preventTouchScroll=t.preventTouchScroll,this.hideCursor=t.hideCursor,this.requestRender=n.requestRender}activate(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEnabled)return;this.isEnabled=!0,this.initializeActionsDependentStates(),this.needsMouse&&(this.eventContext.domElement.addEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.addEventListener("pointerdown",this.onMouseDown)),this.handlers={Spline:new n0(this.eventContext),VariableChange:new d1(this.eventContext,this.sharedVariables,this,this.needsMouse,this.needsRaycast),API:new y2(this.eventContext,this),WEBHOOK:new x2(this.eventContext,this),AIAssistantListener:new D2(this.eventContext,this),AIAssistantTrigger:new I2(this.eventContext,this),Conditional:new u0(this.eventContext,this),Start:new c1(this.eventContext,this),Basic:new s0(this.eventContext,this,this.needsRaycast),MouseHover:new s1(this.eventContext,this),Scroll:new l1(this.eventContext,this),Follow:new N0(this.eventContext,this),DragDrop:new T0(this.eventContext,this),LookAt:new t1(this.eventContext),Resize:new v2(this.eventContext,this),Textfields:new T2(this.eventContext,this)};let{page:e,domElement:i}=this.eventContext;this.hideCursor&&(i.style.cursor="none"),e.traverseEntity((t=>{t.addEventListener("requestRender",this.requestRender)})),Object.values(this.handlers).forEach((t=>t.connect())),i.addEventListener("wheel",this.onMouseWheelPreventScroll),i.addEventListener("touchmove",this.onTouchMovePreventScroll),this.activateCount++,t||(this.eventContext.sharedAssets.openAIRealtime?.connect(),this.eventContext.sharedAssets.openAIRealtime?.start())}deactivate(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isEnabled)return;this.isEnabled=!1,this.eventContext.domElement.removeEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.removeEventListener("pointerdown",this.onMouseDown),this.eventContext.domElement.removeEventListener("pointerup",this.onMouseUp),this.eventContext.sharedAssets.mouseProperty=null,this.eventContext.sharedAssets.raycastProperty=null;let{page:e,domElement:i}=this.eventContext;if(i.style.cursor="",Object.values(this.handlers).forEach((t=>t.disconnect())),this.controlsManager.gameControl?.disposeActions(),this.controlsManager.disconnectEvents(),e.traverseEntity((t=>{t.removeEventListener("requestRender",this.requestRender),t.destroyedInAction=!1})),i.removeEventListener("touchmove",this.onTouchMovePreventScroll),i.removeEventListener("wheel",this.onMouseWheelPreventScroll),this.animationControls.onExitPlayMode(),!t){let t=this.eventContext.sharedAssets.openAIRealtime;t?.disconnect(),t?.stop().then((()=>{t?.disconnect()}))}}get isPaused(){return this.isEnabled}pause(){this.deactivate()}resume(){this.activate()}reset(){this.deactivate(!0),this.activate(!0),this.controlsManager.deactivate(),this.controlsManager.activate(this),this.controlsManager.page.updateMatrixWorld(!0),this.controlsManager.rebuildBVH()}updateUseWindowEvents(t){let e=this.isEnabled;e&&this.deactivate(),this.eventContext.useWindowEvents=t,e&&this.activate()}initializeActionsDependentStates(){let t=this.eventContext.sharedAssets;t.resetDynamicVariablePlayState();let e=i=>{if("Conditional"===i.data.type&&(i.data.ifActions.forEach(e),i.data.elseActions.forEach(e)),"Conditional"===i.data.type||"SetVariable"===i.data.type)for(let t of"Conditional"===i.data.type?i.data.condition:i.data.expression)"id"in t&&Array.isArray(t.id)&&("mouse"===t.id[0]&&(this.needsMouse=!0),"raycast"===t.id[0]&&(this.needsRaycast=!0));"DynamicVariablePlay"===i.data.type&&""!==i.data.variableId&&("Play"===i.data.mode||"PlayPause"===i.data.mode||"Toggle"===i.data.mode)&&t.setDynamicVariablePlayState(i.data.variableId,"Stopped")};this.eventContext.page.traverseEntity((t=>{if(t.data?.events.length)for(let i of t.data.events)if("VariableChange"===i.data.type&&("mouseProperty"===i.data.variableId&&(this.needsMouse=!0),"raycastProperty"===i.data.variableId&&(this.needsRaycast=!0)),"Conditional"===i.data.type)for(let t of["inActions","outActions"])i.data[t].forEach(e);else if("DragDrop"===i.data.type)for(let t of["drag","drop"])i.data.dragDropActions[t].forEach(e);else if("GameControl"===i.data.type)for(let t of["idle","move","jump","run"])i.data.gameActions[t].forEach(e);else if("Resize"===i.data.type)for(let t of i.data.breakpoints)t.data.actions.forEach(e);else"LookAt"===i.data.type||"API"===i.data.type||i.data.actions.forEach(e)}))}},L2=class{constructor(t,e,i,n,r){this._aspect=1,this.enableResponsive=!1,this._renderer=t,this._camera=e,this._frameSize=(new Uf).copy(i),this._editorSize=(new Uf).copy(n),this._aspect=e.aspect,this._fov=r??e.fov}set frameSize(t){this._frameSize.copy(t)}updateRenderer(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewport(){if(!this._renderer||!this._camera||"PerspectiveCamera"!==this._camera.cameraType)return;let t=this._frameSize.x,e=this._frameSize.y,i=this._editorSize.y;this._aspect=t/e,e<=i&&(this._camera.zoom*=i/e),this._renderer.setViewport(0,0,t,e)}updateCamera(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._camera)if("PerspectiveCamera"===this._camera.cameraType){let e=this._frameSize.y,i=this._editorSize.y,n=this._fov;if(t&&e>i){let t=function(t,e,i,n,r){return(t-e)/(i-e)*(r-n)+n}(e,1080,2160,1,15)/100;n*=e/i,n*=1-t}this._camera.aspect=this._aspect,this._camera.fov=n,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y,this.enableResponsive)}setCamera(t){this._camera=t,this._aspect=t.aspect,this._fov=t.fov}revert(){let t=window.innerWidth,e=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,t,e),this._renderer.setSize(t,e)),this._camera&&(this._camera.aspect=t/e,this._camera.fov=this._fov,this._camera.setViewplaneSize(t,e,this.enableResponsive),this._camera.updateProjectionMatrix())}};var B2=class{get sharedAssets(){return this.shared}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.shared=new pH(t.shared,e,!0,i),this.scene=new uK(t.scene,this.sharedAssets),this.shared.setEntityOpContext({scene:this.scene,shared:this.shared})}reset(t,e){this.scene.clearScene(),this.sharedAssets.reset(t.shared),this.scene.resetAfterClear(t.scene,this.sharedAssets)}resetPersonalCameraFromDocumentData(){for(let t of this.scene.children)t instanceof tQ&&!t.uiScene&&t.personalCamera.updateState(t.data.camera,{scene:this.scene,shared:this.shared})}dispose(){this.scene.dispose(),this.shared.dispose()}gc(){this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity((t=>{t instanceof xH&&t.markGeometryAsReachable(this.shared)})),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}},z2=class{constructor(t){let{x:e=10,y:i=10}=t;this._startTime=0;let n=document.getElementById("spe-perfs");n?this.element=n:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left=`${e}px`,this.element.style.top=`${i}px`}dispose(){this.element.parentElement?.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let t=performance.now()-this._startTime;this.element.innerHTML=t.toFixed(3)+" ms"}};function F2(t){let e;if(t.index)for(let i=0;i<t.index.array.length;i+=3)e=t.index.array[i],t.index.array[i]=t.index.array[i+2],t.index.array[i+2]=e}function N2(t){return t instanceof CH?"SubdivObject":"NonParametricGeometry"===t.geometry.type?"NonParametric":"Mesh"}function U2(t,e){let i=function(t,e){let i={};return t.traverseEntity((t=>{if(!t.visible||!(t instanceof CU)||"Mesh"!==t.type||Array.isArray(t.material)||t.states&&Object.keys(t.states).length)return;let n=t.parent;for(;n;){if(n instanceof CU&&t.states&&Object.keys(t.states).length)return;n=n.parent}let r=t.material.uuid,s=e.shared.materials[r];if(s){if(!uR.isMergable(s))return}else{let i=e.scene.objects.get(t.uuid)?.data;if(i&&"material"in i&&"string"!=typeof i.material){if(!uR.isMergable(i.material))return;r=uR.getHash(i.material)}}i[r]||(i[r]={});let a=i[r][N2(t)];if(a){if(a.push(t),t.cloner)for(let e of t.cloner.children)a.push(e)}else if(i[r][N2(t)]=[t],t.cloner)for(let e of t.cloner.children)i[r][N2(t)].push(e)})),i}(e,t),n=function(t){let e=0;return Object.values(t).forEach((t=>{Object.values(t).forEach((t=>{let i=t.length;i>e&&(e=i)}))})),e}(i),r=new Array(n),s=0,a=new Array(n),o=0,l=new Array(n),h=0,c=new Array(n),u=0;for(let[d,p]of Object.entries(i))for(let t of Object.values(p)){if(o=0,h=0,t.forEach((t=>{t instanceof CU&&(a[o++]=t.geometry.clone(),l[h++]=t)})),h<2)continue;for(let t=0;t<h;t++)l[t].updateWorldMatrix(!0,!1),a[t].applyMatrix4(l[t].matrixWorld),l[t].matrixWorld.determinant()<0&&F2(a[t]);let n=$O(a.slice(0,o),!1);if(n){let t;if("SubdivObject"===d)console.warn("Turning subdiv object into mesh"),t=new rv(n,l[0].material);else t=new rv(n,l[0].material);t.castShadow=l[0].castShadow,t.receiveShadow=l[0].receiveShadow,e.add(t);let a=t=>{u=0;for(let e of t)e.children&&a(e.children),e instanceof CU&&(Array.isArray(e.material)||i[e.material.uuid]&&i[e.material.uuid][N2(e)]&&i[e.material.uuid][N2(e)].length>1||(c[u++]=e));for(let i=0;i<u;i++)e.attach(c[i])};for(let e=0;e<h;e++){let t=l[e];a(t.children),r[s++]=t}}}for(let d=0;d<s;d++)r[d].removeFromParent()}var V2=np(up(),1),j2=new Uf;var G2=class{constructor(t){let{renderOnDemand:e,renderMode:i="auto"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._variablesCache=new Map,this._isPaused=!1,this._renderRequested=!1,this._skipRender=!1,this.time=performance.now(),this.dt=0,this.currentTAAFrame=0,this.disposed=!1,this._requestRenderAutoMode=()=>{this._skipRender=!1},this.requestRender=()=>{this._renderRequested=!0},this.render=t=>{if(this.time=t,this._lastTime&&(this.dt=this.time-this._lastTime),this._lastTime=this.time,this._perfs?.start(),this._renderer)if(this._isPaused||!("manual"===this.renderMode&&!this._renderRequested||"auto"===this.renderMode&&this._skipRender)){if(this._renderRequested=!1,this._skipRender=!0,this._controls&&(this._skipRender=this._controls.update(this.dt)),this._eventManager&&(this._eventManager.handlers?.Start.hasVideoAction||this._eventManager.handlers?.Basic.hasVideoAction||this._eventManager.handlers?.Conditional.hasVideoAction)&&(this._skipRender=!1),this._animationControls?.update(this.dt),this._skipRender?(this.currentTAAFrame++,this.currentTAAFrame<32?this._skipRender=!1:this.currentTAAFrame=0):this.currentTAAFrame=0,this._scene?.traverseVisibleEntity((t=>{"ParticleSystem"===t.type&&(t.update(this.dt),this._skipRender=!1)})),this._scene&&this._scene.activeCamera!==this._camera&&(this._camera=this._scene.activeCamera),this._eventManager?.isEnabled&&((this._eventManager.handlers?.Follow).onAnimationFrameDamping(),(this._eventManager.handlers?.LookAt).onAnimationFrameDamping(),(this._eventManager.handlers?.DragDrop).onAnimationFrameDamping()),this._scene&&this._camera){if(this._scene.pathConstraints.applyConstraints(this._scene),this._renderer.sceneTransitionTimeRemaining>0){this._renderer.sceneTransitionTimeRemaining-=this.dt;let t=1-this._renderer.sceneTransitionTimeRemaining/this._renderer.sceneTransitionDuration;this._renderer.pipeline.sceneTransitionPass.uniforms.mixRatio.value=t,this._skipRender=!1}else this._renderer.pipeline.sceneTransitionFromTexture=null;this._renderer.renderSplineScene(this._scene,this._camera)}this.canvas.dispatchEvent(this._renderedEvent),this._perfs?.end()}else this._perfs?.end();else this._perfs?.end()},this._resize=t=>{if(this._renderer){if(1===this._viewportMode&&this._frameView&&(this._frameView.frameSize=j2.set(this._viewportWidth,this._viewportHeight)),t){let t=this._viewportWidth,e=this._viewportHeight;this._renderer.setSize(t-1,e-1,!1),this._renderer.setSize(t,e,!1)}else this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1);if(this._camera=this._scene?.activeCamera,this._scene?.updateViewPlaneSize(this._frameView?.frameSize?.x??this._viewportWidth,this._frameView?.frameSize?.y??this._viewportHeight,this._frameView?.enableResponsive??!1),this._camera){let t=Object.values(this._data?.frames??{})[0].preset??"fullscreen";this._frameView?.setCamera(this._camera),this._frameView?.updateCamera("fullscreen"!==t),"PerspectiveCamera"===this._camera.cameraType&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()}this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect()),this._requestRenderAutoMode()}},this._debouncedResize=VP(this._resize,10),this._onScroll=t=>{this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect())},this.canvas=t,this.renderMode=e?"auto":i,this._renderedEvent=new CustomEvent("rendered",{bubbles:!0}),Object.defineProperty(this._renderedEvent,"target",{writable:!1,value:this}),window.location.search.includes("perfs")&&(this._perfs=new z2({x:10,y:10})),function(t){t.addEventListener("pointerdown",xT,!0),t.addEventListener("pointerdown",ST,!0),t.addEventListener("pointermove",ST,!0),t.addEventListener("pointerup",wT,!0),t.addEventListener("pointercancel",wT,!0),t.addEventListener("pointerleave",wT,!0),window.addEventListener("keydown",ET,!0),window.addEventListener("keyup",_T,!0)}(t)}async load(t,e,i){(function(t){let e="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";t.endsWith(".spline")?console.warn(e+" The .spline files are only meant to be used by the Editor."):t.endsWith(".splinecode")||console.warn(e)})(t),this.disposed=!1;let n=await(await fetch(t,i)).arrayBuffer();await this.start(n,{variables:e})}async start(t){let{interactive:e=!0,variables:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.disposed)return;let n=await async function(t,e){let[i,n]=wD(Gk.deserialize(new Uint8Array(t)));return JO(i),e&&e(i),n.result().data}(t);this._data=n;let r=function(t){let e=[];return t.scene.objects.traverse(((t,i)=>{"Mesh"===i.type&&"NonParametricGeometry"===i.geometry.type&&void 0!==i.geometry.data.draco&&e.push(i)})),e}(n);n.version&&(0,V2.default)(n.version,"1.9.72")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version."),await Promise.all([r.length&&(l2||(l2=new d2).setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload(),l2.decoderPending),kW(n)&&hU(),_H(n)&&FN(),JR.physicsEnabled(n.scene.objects)&&RT(),WH(n)&&PG(),tK(n)&&oK(),xG(n)&&bG(),bX(n)&&yX(),S1(n)&&TT()].filter(Boolean)),r.length&&await async function(t){for(let e of t){let t=await f2(e.geometry.data.draco);if(t){let i=e.geometry.data;t.index&&(i.index={array:t.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let n={};t.attributes.forEach((t=>{let{name:e,array:i,itemSize:r}=t;n[e]={array:i,itemSize:r,type:"Float32Array",normalized:!1}})),i.attributes=n,i.draco=void 0}}}(r),this._eventManager?.deactivate(),this._controls?.deactivate(),this._scene?.dispose();let s=new B2(n);if(s.resetPersonalCameraFromDocumentData(),this._scene=s.scene,this._sharedAssetsManager=s.sharedAssets,this._camera=this._scene.activeCamera,window.location.search.includes("merge-geometries")){let t=performance.now();U2(n,s.scene);let e=performance.now();console.log("Merged geometries in ",e-t," ms")}kW(n)&&this._scene.traverse((t=>{BW(t)&&t.recomputeBoolean()})),this._sharedAssetsManager.setRequestRender((()=>{this._requestRenderAutoMode(),this._scene?.traverse((t=>{t instanceof hW&&t.pendingMediaLoad&&t.update()}))})),this._scene?.traverse((t=>{"ParticleSystem"===t.type&&(t.wakeUp(),t.data.autoPlay?t.start():t.stop())}));let a=Object.keys(n.shared.fonts).map((t=>this._sharedAssetsManager.getFont(t).loadingPromise));if(Promise.all(a).then((()=>{s.scene.markNeedsUpdateRendererDirty(),this._requestRenderAutoMode()})),WH(n)&&function(t){if(JR.physicsEnabled(t.scene.objects))return!0;let e=!1;return t.scene.objects.traverse(((t,i)=>{if(i.events)if(Array.isArray(i.events)){for(let n of i.events)if(!0!==n.data.disabled&&"GameControl"===n.data.type&&n.data.collisionEnabled){e=!0;break}}else for(let n of Object.values(i.events))if(!0!==n.disabled&&"GameControl"===n.type&&n.collisionEnabled){e=!0;break}})),e}(n)&&await Promise.all(a),bX(n)){let t=[];this._scene.traverseEntity((e=>{(e instanceof cQ||e instanceof tQ)&&e.uiCanvas&&t.push(e.uiCanvas)})),await Promise.all(t.map((t=>t.promise)))}if(this._scene.rewriteEventsBeforeGoToPlayMode(),DJ(this._scene.activePage,this._sharedAssetsManager),!this._renderer&&(this._renderer=new NY({canvas:this.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),this._renderer.hdTransmission=!0===n.scene.publish.hdTransmission,this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.pipeline.enableUIOverlay(),this._renderer.pipeline.addEventListener("smaaloaded",this._requestRenderAutoMode),n.shared.images.SplineWatermark)){let t=this._sharedAssetsManager.getImage("SplineWatermark");await t.loadPromise;let e=t.getTexture(1001);this._renderer.pipeline.setWatermark(e)}tK(n)&&this._scene.initializeSplatViewer(),void 0!==n.scene.blueNoiseTextureData&&this._renderer.pipeline.updateBlueNoiseTexture(n.scene.blueNoiseTextureData);let o=Object.values(n.frames)[0];if(this._frameView?this._frameView.setCamera(this._camera):("fullscreen"===o.preset?(this._viewportMode=1,this.canvas.style.display="block",this.canvas.parentElement&&(this._viewportWidth=this.canvas.parentElement.clientWidth||300,this.canvas.style.width="100%"),this.canvas.parentElement&&(this._viewportHeight=this.canvas.parentElement.clientHeight||150,this.canvas.style.height="100%")):(this._viewportMode=2,this._viewportWidth=o.size[0],this._viewportHeight=o.size[1],this.canvas.style.width=`${this._viewportWidth}px`,this.canvas.style.height=`${this._viewportHeight}px`),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._frameView=new L2(this._renderer,this._camera,new Uf(this._viewportWidth,this._viewportHeight),new Uf(window.innerWidth,window.innerHeight)),this._frameView.enableResponsive=(o.allowResponsive??!1)&&"fullscreen"===o.preset),e){let t=new Z$(this._renderer,this.data.scene.publish,this._scene,(()=>this._scene.activeCamera),this._sharedAssetsManager,this._requestRenderAutoMode,!0,o);this._scene.updateMatrixWorld(!0),this._controls=new a2(t),this._animationControls=new c2(this._scene,this._requestRenderAutoMode),this._eventManager=new O2(n.scene.publish,this._controls,this._animationControls,t,n.shared.variables),this._eventManager.activate(),this._controls.activate(this._eventManager)}this._resize(),this._scene.activePage.data.postprocessing.depthOfField.enabled&&Promise.all(this._sharedAssetsManager.getImageLoadPromises()).then((()=>{this._resize(!0)})),void 0!==i&&this.setVariables(i),0===this.dt&&(this.render(performance.now()),setTimeout((()=>{this._renderer?.setAnimationLoop(this.render)}),0)),this._resizeObserverTimeout=setTimeout((()=>{!this._resizeObserver&&this.canvas.parentElement&&(this._resizeObserver=new ResizeObserver((()=>{this._viewportWidth=this.canvas.clientWidth,this._viewportHeight=this.canvas.clientHeight,this._debouncedResize()})),this._resizeObserver.observe(this.canvas.parentElement))}),300),document.addEventListener("scroll",this._onScroll)}setVariables(t){if(void 0!==this._data){let e=Object.entries(t);for(let[t,i]of e)this.setVariable(t,i)}}setVariable(t,e){let i=this._getVariableByName(t);if(i&&!("dynamicVariableType"in i.data)){let t=e;"number"==typeof i.data.value?t="number"==typeof e?e:"boolean"==typeof e?!0===e?1:0:parseFloat(e):"boolean"==typeof i.data.value?t="number"==typeof e?!!e:"boolean"==typeof e?e:"false"!==e.toLocaleLowerCase()&&!!e:"string"!=typeof i.data.value&&void 0!==i.data.value.textValue&&(t=e.toString());let n="string"==typeof t?{textValue:t}:t;this._sharedAssetsManager?.updateVariable(i.id,n),this.requestRender(),this._requestRenderAutoMode()}else void 0===i?console.warn(`No variable named ${t} was found in your Spline file. Make sure to create it from Spline editor.`):"dynamicVariableType"in i.data&&console.warn(`Dynamic variables like ${t} cannot be updated from code.`)}getVariables(){let t={};return this._data&&this._data.shared.variables.forEach((e=>{void 0===t[e.data.name]&&(t[e.data.name]=this._getVariableValue(this._sharedAssetsManager.getVariable(e.id)))})),t}getVariable(t){let e=this._getVariableByName(t);if(e){let t=this._sharedAssetsManager.getVariable(e.id);return this._getVariableValue(t)}}_getVariableValue(t){return"string"!=typeof t&&nO.isTextValue(t)?nO.getDisplayedValue(t):t}_getVariableByName(t){if(this._data){if(this._variablesCache.has(t))return this._variablesCache.get(t);let e=this._data.shared.variables.find((e=>e.data.name===t));return e&&this._variablesCache.set(t,e),e}}findObjectById(t){let e=this._scene?.getObjectByProperty("uuid",t);return this._createProxyObject(e)}findObjectByName(t){let e=this._scene?.getObjectByName(t);return this._createProxyObject(e)}getAllObjects(){let t=[];return this._scene?.traverseEntity((e=>{if(e.uuid!==GI&&!this._scene.isInvisibleObjects(e)&&!(e instanceof tQ)){let i=this._createProxyObject(e);i&&t.push(i)}})),t}getSplineEvents(){return(this._eventManager?.handlers?.Spline).splineEvents}emitEvent(t,e){(this.findObjectById(e)||this.findObjectByName(e))?.emitEvent(t)}emitEventReverse(t,e){(this.findObjectById(e)||this.findObjectByName(e))?.emitEventReverse(t)}addEventListener(t,e){this.canvas.addEventListener(t,e)}removeEventListener(t,e){this.canvas.removeEventListener(t,e)}setZoom(t){this._controls?.orbitControls instanceof F1&&this._controls?.orbitControls.setZoom(t)}get eventManager(){return this._eventManager}get controls(){return this._controls}setSize(t,e){this._viewportWidth=t,this._viewportHeight=e,this._viewportMode=2,this._resize()}setBackgroundColor(t){let{r:e,g:i,b:n,a:r}={r:0,g:0,b:0,a:1},s=new LU(e,i,n,r);try{s.setStyle(t)}catch{console.error("This is not a valid css color",t)}this._scene?.activePage.setBackgroundColor(s),this._requestRenderAutoMode()}dispose(){this.disposed=!0,this._eventManager?.deactivate(),this._scene?.dispose(),this._sharedAssetsManager?.dispose(),this._proxyObjectCache.forEach((t=>{$A.unsubscribe(t)})),this._variablesCache.clear(),this._renderer?.setAnimationLoop(null),this._renderer?.dispose(),this._renderer=void 0,this._sharedAssetsManager?.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0),void 0!==this._resizeObserverTimeout&&clearTimeout(this._resizeObserverTimeout),this.canvas.style.width="",this.canvas.style.height="",this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this._frameView&&(this._frameView=void 0),this._controls?.deactivate(),this.dt=0,function(t){t.removeEventListener("pointerdown",xT,!0),t.removeEventListener("pointerdown",ST,!0),t.removeEventListener("pointermove",ST,!0),t.removeEventListener("pointerup",wT,!0),t.removeEventListener("pointercancel",wT,!0),t.removeEventListener("pointerleave",wT,!0),window.removeEventListener("keydown",ET,!0),window.removeEventListener("keyup",_T,!0)}(this.canvas),document.removeEventListener("scroll",this._onScroll)}get isStopped(){return this._isPaused}stop(){this._isPaused||(this._renderer?.setAnimationLoop(null),this._isPaused=!0,this._eventManager?.pause(),this._controls?.orbitControls&&(this._controls.orbitControls.enabled=!1))}play(){!this._isPaused||(this._isPaused=!1,this._eventManager?.resume(),this._controls?.orbitControls&&(this._controls.orbitControls.enabled=!0),this._renderer?.setAnimationLoop(this.render))}setGlobalEvents(t){this._eventManager?.updateUseWindowEvents(t)}get data(){return this._data}_createProxyObject(t){if(null==t)return;if(this._proxyObjectCache.has(t.uuid))return this._proxyObjectCache.get(t.uuid);let e;t.traverseAncestors((t=>{t instanceof tQ&&(e=t.name)}));let i={name:t.name,uuid:t.uuid,visible:t.visible,intensity:t.intensity,position:t.position,rotation:t.rotation,scale:t.scale,type:t.data.type,page:e,parentUuid:t.parent instanceof tQ||t instanceof uK?void 0:t.parent?.uuid,emitEvent(e){t.dispatchEvent({type:"userEvent",eventName:e})},emitEventReverse(e){t.dispatchEvent({type:"userEvent",eventName:e,reverse:!0})}},n=$A(i,((e,i)=>{"object"!=typeof t[e]&&Object.getOwnPropertyDescriptor(t,e)?.writable&&(t[e]=i),this._requestRenderAutoMode(),t.updateMatrix()}));return this._proxyObjectCache.set(t.uuid,n),n}setUIWasmUrl(t){lj.skiaWasmUrl=t}},H2=__webpack_require__(446);function W2(t){return e=>{t.forEach((t=>{"function"==typeof t?t(e):null!=t&&(t.current=e)}))}}const q2=[],Y2={width:"100%",height:"100%"},X2=(0,t.forwardRef)((function(e,n){let{className:r,children:s,debounceTime:a=300,ignoreDimensions:o=q2,parentSizeStyles:l,enableDebounceLeadingCall:h=!0,resizeObserverPolyfill:c,...u}=e;const d=(0,t.useRef)(null),p=(0,t.useRef)(0),[f,m]=(0,t.useState)({width:0,height:0,top:0,left:0}),g=(0,t.useMemo)((()=>{const t=Array.isArray(o)?o:[o];return H2((e=>{m((i=>Object.keys(i).filter((t=>i[t]!==e[t])).every((e=>t.includes(e)))?i:e))}),a,{leading:h})}),[a,h,o]);return(0,t.useEffect)((()=>{const t=new(c||window.ResizeObserver)((t=>{t.forEach((t=>{const{left:e,top:i,width:n,height:r}=(null==t?void 0:t.contentRect)??{};p.current=window.requestAnimationFrame((()=>{g({width:n,height:r,top:i,left:e})}))}))}));return d.current&&t.observe(d.current),()=>{window.cancelAnimationFrame(p.current),t.disconnect(),g.cancel()}}),[g,c]),(0,i.jsx)("div",{style:{...Y2,...l},ref:W2([n,d]),className:r,...u,children:s({...f,ref:d.current,resize:g})})})),Q2=(0,t.forwardRef)(((e,n)=>{let{scene:r,style:s,onSplineMouseDown:a,onSplineMouseUp:o,onSplineMouseHover:l,onSplineKeyDown:h,onSplineKeyUp:c,onSplineStart:u,onSplineLookAt:d,onSplineFollow:p,onSplineScroll:f,onLoad:m,renderOnDemand:g=!0,children:v,...y}=e;const b=(0,t.useRef)(null),[x,w]=(0,t.useState)(!0),[S,A]=(0,t.useState)();if(S)throw S;return(0,t.useEffect)((()=>{let t;w(!0);const e=[{name:"mouseDown",cb:a},{name:"mouseUp",cb:o},{name:"mouseHover",cb:l},{name:"keyDown",cb:h},{name:"keyUp",cb:c},{name:"start",cb:u},{name:"lookAt",cb:d},{name:"follow",cb:p},{name:"scroll",cb:f}];if(b.current){async function i(){await t.load(r);for(let i of e)i.cb&&t.addEventListener(i.name,i.cb);w(!1),null==m||m(t)}t=new G2(b.current,{renderOnDemand:g}),i().catch((t=>{A(t)}))}return()=>{for(let i of e)i.cb&&t.removeEventListener(i.name,i.cb);t.dispose()}}),[r]),(0,i.jsx)(X2,{ref:n,parentSizeStyles:{overflow:"hidden",...s},debounceTime:50,...y,children:()=>(0,i.jsxs)(i.Fragment,{children:[x&&v,(0,i.jsx)("canvas",{ref:b,style:{display:x?"none":"block"}})]})})})),K2=()=>{const[e,n]=(0,t.useState)({email:"",message:""}),[r,s]=(0,t.useState)(""),[a,o]=(0,t.useState)(!1),l=t=>{n({...e,[t.target.name]:t.target.value})};return(0,i.jsx)("div",{className:"contact-container",children:(0,i.jsxs)("div",{className:"contact-wrapper",children:[(0,i.jsxs)("div",{className:"contact-box",children:[(0,i.jsx)("h2",{children:"Contact me"}),(0,i.jsxs)("form",{onSubmit:t=>{t.preventDefault(),Qd("service_8prqp5n","template_kf165uh",{user_email:e.email,message:e.message},"UAOZGnnAWi7umaC_K").then((()=>{s("Message envoy\xe9 !"),n({email:"",message:""})}),(t=>{s("Erreur lors de l'envoi."),console.error("Erreur:",t)}))},className:"contact-form",children:[(0,i.jsx)("label",{children:"Email Address:"}),(0,i.jsx)("input",{type:"email",name:"email",value:e.email,onChange:l,required:!0}),(0,i.jsx)("label",{children:"Your message:"}),(0,i.jsx)("textarea",{name:"message",value:e.message,onChange:l,required:!0}),(0,i.jsx)("button",{type:"submit",className:"download-btn  "+(a?"hovered":""),onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:a?(0,i.jsx)(wo,{size:24}):"Submit"})]}),r&&(0,i.jsx)("p",{className:"contact-message",children:r})]}),(0,i.jsx)("div",{className:"contact-image",children:(0,i.jsx)(Q2,{scene:"https://prod.spline.design/Oahm6pLrXfaV7iY5/scene.splinecode"})})]})})},Z2=()=>{const[e,n]=(0,t.useState)(!1);return(0,i.jsx)("footer",{className:"footer",children:(0,i.jsxs)("div",{className:"footer-content",children:[(0,i.jsxs)("div",{className:"footer-links",children:[(0,i.jsx)("a",{href:"https://github.com/Meryem-Khayati",target:"_blank",rel:"noopener noreferrer","aria-label":"GitHub",children:(0,i.jsx)(fo,{size:24})}),(0,i.jsx)("a",{href:"https://www.linkedin.com/in/meryem-khayati%F0%9F%87%B5%F0%9F%87%B8-0489b8271?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=android_app",target:"_blank",rel:"noopener noreferrer","aria-label":"LinkedIn",children:(0,i.jsx)(mo,{size:24})}),(0,i.jsx)("a",{href:"mailto:meryemkhayati91@gmail.com","aria-label":"Email",children:(0,i.jsx)(go,{size:24})}),(0,i.jsxs)("button",{onClick:()=>{const t="+212 689-708572";if(navigator.clipboard)navigator.clipboard.writeText(t).then((()=>{n(!0),setTimeout((()=>n(!1)),2e3)})).catch((()=>{alert("Erreur lors de la copie du num\xe9ro.")}));else{const i=document.createElement("input");i.value=t,document.body.appendChild(i),i.select();try{document.execCommand("copy"),n(!0),setTimeout((()=>n(!1)),2e3)}catch(e){alert("Erreur lors de la copie du num\xe9ro.")}document.body.removeChild(i)}},"aria-label":"Phone",className:"phone-button",children:[(0,i.jsx)(vo,{size:24}),e&&(0,i.jsx)("span",{className:"copy-message",children:"Copied!"})]})]}),(0,i.jsx)("div",{className:"footer-text",children:(0,i.jsxs)("p",{children:["\xa9 Meryem Khayati ",(new Date).getFullYear(),". All rights reserved."]})})]})})};const J2=function(){const e=(0,t.useRef)(null),r=(0,t.useRef)(null),s=(0,t.useRef)(null),a=(0,t.useRef)(null),o=(0,t.useRef)(null);return(0,i.jsxs)("div",{className:"App",children:[(0,i.jsx)(n,{aboutMeRef:e,skillsRef:r,educationRef:s,projectsRef:a,contactRef:o}),(0,i.jsx)(Xa,{contactRef:o}),(0,i.jsx)("div",{ref:e,children:(0,i.jsx)(Ao,{})}),(0,i.jsx)("div",{ref:r,children:(0,i.jsx)(Td,{})}),(0,i.jsx)("div",{ref:s,children:(0,i.jsx)(zd,{})}),(0,i.jsx)("div",{ref:a,children:(0,i.jsx)(bo,{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#121212"}})}),(0,i.jsx)(gd,{}),(0,i.jsx)("div",{ref:o,children:(0,i.jsx)(K2,{})}),(0,i.jsx)(Z2,{})]})};e.createRoot(document.getElementById("root")).render((0,i.jsx)(t.StrictMode,{children:(0,i.jsx)(J2,{})}))})()})();
//# sourceMappingURL=main.7160cf11.js.map